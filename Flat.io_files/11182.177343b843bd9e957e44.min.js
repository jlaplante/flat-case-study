"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="da8be242-0c82-5f47-9011-8ffee5af4db8")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[11182],{63404:(X,I,S)=>{S.d(I,{Ay:()=>U,km:()=>$,tE:()=>L});var E=S(914906),A=S(624740),y=S(777432),N=S(306563),D=S(483088),H=S(18033),c=S(17542),l=Object.defineProperty,u=(m,t,s)=>t in m?l(m,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[t]=s,n=(m,t,s)=>u(m,typeof t!="symbol"?t+"":t,s);const h="http://www.w3.org/2000/svg",w=["http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"],p=["http://www.w3.org/2000/xmlns/","xmlns",h];class d{constructor(t,s,r=!1){n(this,"document"),n(this,"nodesMap"),n(this,"rootsMap"),n(this,"recentId"),n(this,"recentNode"),n(this,"currentSpaceSize"),n(this,"pathProvider"),n(this,"checkParentChildLink"),this.nodesMap=new Map,this.rootsMap=new Map,this.recentId=null,this.recentNode=null,this.currentSpaceSize=null,this.pathProvider=t,this.document=s,this.checkParentChildLink=r}replacePathProviderIfNeeded(t){this.pathProvider!==t&&(this.pathProvider=t)}createElement(t){const s=this.document.createElementNS(h,t);return t==="svg"&&(s.setAttributeNS(...w),s.setAttributeNS(...p)),s}createRoot(t){const s=this.createElement("svg"),r=this.createElement("g");s.appendChild(r),this.setNode(t,r),this.rootsMap.set(t,s),this.currentSpaceSize!==null&&r.setAttribute("transform",`scale(${this.currentSpaceSize})`)}createGroup(t){const s=this.createElement("g");s.dataset.adagioX="0",s.dataset.adagioY="0",s.dataset.adagioAngle="0",this.setNode(t,s)}createGlyph(t,s,r){const i=this.createElement("path");i.dataset.adagioX="0",i.dataset.adagioY="0",i.dataset.adagioScalingY="1";const g=this.pathProvider.getPath(s,r);i.setAttribute("d",g),i.setAttribute("fill","black"),this.setNode(t,i)}createLine(t){const s=this.createElement("line");s.dataset.adagioX="0",s.dataset.adagioY="0",s.setAttribute("stroke","black"),s.setAttribute("x1","0"),s.setAttribute("x2","0"),s.setAttribute("y1","0"),s.setAttribute("y2","0"),this.setNode(t,s)}createTextNode(t,s,r){const i=this.createElement("text");i.dataset.adagioX="0",i.dataset.adagioY="0",i.setAttribute("font-size",r.fontSize.toString()),i.setAttribute("font-family",r.fontFamily),r.bold&&i.setAttribute("font-weight","bold"),r.italic&&i.setAttribute("font-style","italic"),i.setAttribute("fill","black");const g=this.document.createTextNode(s);i.appendChild(g),this.setNode(t,i)}createPathNode(t){const s=this.createElement("path");s.dataset.adagioX="0",s.dataset.adagioY="0",s.setAttribute("fill","black"),this.setNode(t,s)}createCircle(t,s){const r=this.createElement("circle");r.dataset.adagioX="0",r.dataset.adagioY="0",r.setAttribute("r",s.toString()),r.setAttribute("fill","transparent"),this.setNode(t,r)}createRectNode(t,s,r,i){const g=this.createElement("rect");g.dataset.adagioX="0",g.dataset.adagioY="0",g.setAttribute("width",s.toString()),g.setAttribute("height",r.toString()),g.setAttribute("fill","black"),i!==void 0&&g.setAttribute("rx",i.toString()),this.setNode(t,g)}setNode(t,s){this.recentId=t,this.recentNode=s,this.nodesMap.set(t,s)}setStrokeWidth(t,s){this.getNode(t).setAttribute("stroke-width",s.toString())}getNode(t){if(t===this.recentId){if(!this.recentNode)throw new Error("Unexpected");return this.recentNode}const s=this.nodesMap.get(t);if(!s)throw new Error(`There is no node at id ${t}`);return this.recentNode=s,this.recentId=t,s}setLabel(t,s){this.getNode(t).classList.add(s)}setX(t,s){const r=this.getNode(t);r.dataset.adagioX=s.toString();const i=f(r.dataset);r.setAttribute("transform",i)}setY(t,s){const r=this.getNode(t);r.dataset.adagioY=s.toString();const i=f(r.dataset);r.setAttribute("transform",i)}setRotation(t,s){const r=this.getNode(t);s?r.dataset.adagioAngle=(-s).toString():r.dataset.adagioAngle="0";const i=f(r.dataset);r.setAttribute("transform",i)}setScalingY(t,s){const r=this.getNode(t);r.dataset.adagioScalingY=s.toString();const i=f(r.dataset);r.setAttribute("transform",i)}setScalingX(t,s){const r=this.getNode(t);r.dataset.adagioScalingX=s.toString();const i=f(r.dataset);r.setAttribute("transform",i)}setX2(t,s){this.getNode(t).setAttribute("x2",s.toString())}setY2(t,s){this.getNode(t).setAttribute("y2",s.toString())}setText(t,s){const i=this.getNode(t).firstChild;if(!i)throw new Error("Unexpected");i.nodeValue=s}setPath(t,s){const r=this.getNode(t),i=`M 0 0 ${s.map(g=>g.join(" ")).join(" ")}`;r.setAttribute("d",i)}strokeQuadCurve(t,s,r,i){const g=this.getNode(t),C=`M 0 0 Q ${s.x} ${s.y} ${r.x} ${r.y}`;g.setAttribute("fill","transparent"),g.setAttribute("stroke","black"),g.setAttribute("stroke-width",i.toString()),g.setAttribute("d",C)}setColor(t,s){this.getNode(t).setAttribute("fill",s)}setOpacity(t,s){this.getNode(t).setAttribute("opacity",s.toString())}setBlur(t,s){const r=this.getNode(t),i=r.getAttribute("fill");i&&(r.style.fill=i),r.style.filter=`blur(${s}px)`}setStrokeColor(t,s){this.getNode(t).setAttribute("stroke",s)}setMixBlendMode(t,s){const r=this.getNode(t);r.style.mixBlendMode=s}setFillRule(t,s){this.getNode(t).setAttribute("fill-rule",s)}destroyRoot(t){this.rootsMap.delete(t),this.destroyNode(t)}destroyNode(t){if(this.recentId===t){if(!this.recentNode)throw new Error("Unexpected");this.recentId=null,this.recentNode=null}this.nodesMap.delete(t)}attachNodes(t,s){const r=this.getNode(s);this.getNode(t).appendChild(r)}unlinkNodes(t,s){const r=this.getNode(s),i=this.getNode(t);if(this.checkParentChildLink&&r.parentNode!==i)throw new Error("The child is not attached to the parent");try{i.removeChild(r)}catch(g){throw console.log(g),g}}setSpaceSize(t){t!==this.currentSpaceSize&&(this.currentSpaceSize=t,this.rootsMap.forEach((s,r)=>{const i=this.nodesMap.get(r);if(!i)throw new Error(`No subRoot for root ${r}`);i.setAttribute("transform",`scale(${t})`)}))}applyEdit(t){switch(t.type){case c.z.CREATE_ROOT:this.createRoot(t.id);break;case c.z.CREATE_GROUP:this.createGroup(t.id);break;case c.z.CREATE_GLYPH:this.createGlyph(t.id,t.glyphId,t.size);break;case c.z.CREATE_LINE:this.createLine(t.id);break;case c.z.CREATE_TEXT:this.createTextNode(t.id,t.text,t.options);break;case c.z.CREATE_PATH:this.createPathNode(t.id);break;case c.z.CREATE_CIRCLE:this.createCircle(t.id,t.radius);break;case c.z.CREATE_RECT:this.createRectNode(t.id,t.width,t.height,t.radius);break;case c.z.ATTACH_NODES:this.attachNodes(t.parentId,t.childId);break;case c.z.UNLINK_NODES:this.unlinkNodes(t.parentId,t.childId);break;case c.z.SET_LABEL:this.setLabel(t.id,t.label);break;case c.z.SET_X:this.setX(t.id,t.x);break;case c.z.SET_Y:this.setY(t.id,t.y);break;case c.z.SET_ROTATION:this.setRotation(t.id,t.angle);break;case c.z.SET_SCALING_Y:this.setScalingY(t.id,t.scalingY);break;case c.z.SET_SCALING_X:this.setScalingX(t.id,t.scalingX);break;case c.z.SET_X2:this.setX2(t.id,t.x2);break;case c.z.SET_STROKE_WIDTH:this.setStrokeWidth(t.id,t.width);break;case c.z.SET_Y2:this.setY2(t.id,t.y2);break;case c.z.SET_TEXT:this.setText(t.id,t.text);break;case c.z.SET_PATH:this.setPath(t.id,t.path);break;case c.z.STROKE_QUAD_QURVE:this.strokeQuadCurve(t.id,t.controlPoint,t.endPoint,t.thickness);break;case c.z.SET_COLOR:this.setColor(t.id,t.color);break;case c.z.SET_OPACITY:this.setOpacity(t.id,t.opacity);break;case c.z.SET_BLUR:this.setBlur(t.id,t.blur);break;case c.z.SET_FILL_RULE:this.setFillRule(t.id,t.fillRule);break;case c.z.SET_STROKE_COLOR:this.setStrokeColor(t.id,t.color);break;case c.z.SET_MIX_BLEND_MODE:this.setMixBlendMode(t.id,t.mode);break;case c.z.DESTROY_NODE:this.destroyNode(t.id);break;case c.z.DESTROY_ROOT:this.destroyRoot(t.id);break;default:throw new Error(`Unexpected edit type ${t.type}`)}}}function f(m){var t,s;let r=`translate(${m.adagioX} ${m.adagioY})`;if(m.adagioScalingY&&m.adagioScalingY!=="1"||m.adagioScalingX&&m.adagioScalingX!=="1"){const i=(t=m.adagioScalingX)!=null?t:"1",g=(s=m.adagioScalingY)!=null?s:"1";r=`${r} scale(${i} ${g})`}return m.adagioAngle&&m.adagioAngle!=="0"&&(r=`${r} rotate(${m.adagioAngle})`),r}function v(m,t){t.forEach(s=>m.applyEdit(s))}var x=S(267811),B=S(896587),Y=Object.defineProperty,W=(m,t,s)=>t in m?Y(m,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[t]=s,T=(m,t,s)=>W(m,typeof t!="symbol"?t+"":t,s),R=(m,t,s)=>new Promise((r,i)=>{var g=P=>{try{b(s.next(P))}catch(_){i(_)}},C=P=>{try{b(s.throw(P))}catch(_){i(_)}},b=P=>P.done?r(P.value):Promise.resolve(P.value).then(g,C);b((s=s.apply(m,t)).next())});function $(m){return{type:y.A.SVG_NODE,payload:m}}function L(m){return{type:y.A.SVG_STRING,payload:m.outerHTML}}class U{constructor(t){T(this,"abstractRenderer"),T(this,"resourcesProvider"),T(this,"document"),T(this,"getImagePayload"),T(this,"fontFaceManager"),T(this,"currentSpaceSize",1),T(this,"pathProvider",null),T(this,"musicFontName",null),T(this,"executor",null),T(this,"currentTextFonts",[]),T(this,"requestedTextFonts",[]),this.abstractRenderer=t.abstractRenderer,this.resourcesProvider=t.resourcesProvider,this.document=t.document,this.getImagePayload=t.getImagePayload,this.fontFaceManager=t.fontFaceManager}setSpaceSize(t){}setLayout(t){this.abstractRenderer.setLayout(t)}setScoreStructure(t){t.resources.musicFont!==this.musicFontName&&(this.pathProvider=null),this.musicFontName=t.resources.musicFont,this.requestedTextFonts=t.resources.textFonts.slice()}setPartPanelFormat(t){return R(this,null,function*(){yield this.abstractRenderer.setPartPanelFormat(t)})}getPathProvider(){return R(this,null,function*(){if(this.pathProvider===null){if(this.musicFontName===null)throw new Error("Music font name is not set");const t=yield this.resourcesProvider.getMusicFont(this.musicFontName),s=new H.A(t,A.default,E.A);this.pathProvider=new D.A(s)}return this.pathProvider})}renderPages(t){return R(this,null,function*(){this.loadTextFontsIfNeeded();const[s,r]=yield Promise.all([this.getExecutor(),this.abstractRenderer.renderPages(t)]);if(r===null)return null;const{pages:i,edits:g,renderedRootIds:C}=r;x.n("svg.setSpaceSize"),s.setSpaceSize(this.currentSpaceSize),x.d("svg.setSpaceSize"),x.n("svg.applyEdits"),g.forEach(_=>s.applyEdit(_)),x.d("svg.applyEdits");let b=0;const P=[];for(let _=0;_<i.length;_++){const F=i[_],O=t.pagesIndexes[b];let z=null;if(F.pageIdx===O){const G=C[b];b++;const K=s.rootsMap.get(G);if(!K)throw new Error(`No container for root ${G}`);const Z=F.width*this.currentSpaceSize,j=F.height*this.currentSpaceSize;K.setAttribute("width",Z.toString()),K.setAttribute("height",j.toString()),z=this.getImagePayload(K)}const V={metadata:F,spaceSize:this.currentSpaceSize,content:z};P.push(V)}return P})}renderCursorPages(t){return R(this,null,function*(){this.loadTextFontsIfNeeded();const[s,r]=yield Promise.all([this.getExecutor(),this.abstractRenderer.renderCursorPages(t)]);if(r===null)return null;const{pages:i,edits:g}=r;return x.n("svg.setSpaceSize"),s.setSpaceSize(this.currentSpaceSize),x.d("svg.setSpaceSize"),x.n("svg.applyEdits"),g.forEach(b=>s.applyEdit(b)),x.d("svg.applyEdits"),i.map(b=>{const P=b.rootId,_=b.width*this.currentSpaceSize,F=b.height*this.currentSpaceSize,O=s.rootsMap.get(P);if(!O)throw new Error(`No container for root ${P}`);O.setAttribute("width",_.toString()),O.setAttribute("height",F.toString());const z=this.getImagePayload(O);return{pageIdx:b.pageIdx,spaceSize:this.currentSpaceSize,content:z,width:b.width,height:b.height}})})}renderMeasuresRange(t){return R(this,null,function*(){this.loadTextFontsIfNeeded();const[s,r]=yield Promise.all([this.getExecutor(),this.abstractRenderer.renderMeasuresRange(t)]);if(r===null)return null;const{metadata:i,edits:g}=r;x.n("svg.setSpaceSize"),s.setSpaceSize(this.currentSpaceSize),x.d("svg.setSpaceSize"),x.n("svg.applyEdits"),g.forEach(P=>s.applyEdit(P)),x.d("svg.applyEdits");const C=[i.content,i.measureHeader,i.partHeader],b=[];for(let P=0;P<C.length;P++){const _=C[P],F=s.rootsMap.get(_.rootId);if(!F)throw new Error(`No container for root ${_.rootId}`);const O=_.width*this.currentSpaceSize,z=_.height*this.currentSpaceSize;F.setAttribute("width",O.toString()),F.setAttribute("height",z.toString());const V=this.getImagePayload(F);b.push(V)}return{spaceSize:this.currentSpaceSize,parts:i.parts,measures:i.measures,content:{width:i.content.width,height:i.content.height,image:b[B.A.CONTENT]},measureHeader:{width:i.measureHeader.width,height:i.measureHeader.height,image:b[B.A.MEASURES_HEADER]},partHeader:{width:i.partHeader.width,height:i.partHeader.height,image:b[B.A.PARTS_HEADER]}}})}renderPageContainingMeasure(t){return R(this,null,function*(){this.loadTextFontsIfNeeded();const[s,r]=yield Promise.all([this.getExecutor(),this.abstractRenderer.renderPageContainingMeasure(t)]);if(r===null)return null;const{pages:i,edits:g,renderedRootId:C}=r;x.n("svg.setSpaceSize"),s.setSpaceSize(this.currentSpaceSize),x.d("svg.setSpaceSize"),x.n("svg.applyEdits"),g.forEach(P=>s.applyEdit(P)),x.d("svg.applyEdits");const b=[];x.n("svg.renderPages");for(let P=0;P<i.length;P++){const _=i[P];let F=null;if(P===i.length-1){const z=s.rootsMap.get(C);if(!z)throw new Error(`No container for root ${C}`);const V=_.width*this.currentSpaceSize,G=_.height*this.currentSpaceSize;z.setAttribute("width",V.toString()),z.setAttribute("height",G.toString()),F=this.getImagePayload(z)}const O={metadata:_,spaceSize:this.currentSpaceSize,content:F};b.push(O)}return x.d("svg.renderPages"),b})}renderPartHeaderBlock(){return R(this,null,function*(){const[t,s]=yield Promise.all([this.getExecutor(),this.abstractRenderer.renderPartHeaderBlock()]);if(s===null)return null;const{metadata:r,edits:i}=s;x.n("svg.setSpaceSize.partHeader"),t.setSpaceSize(this.currentSpaceSize),x.d("svg.setSpaceSize.partHeader"),x.n("svg.applyEdits.partHeader"),i.forEach(_=>t.applyEdit(_)),x.d("svg.applyEdits.partHeader");const g=t.rootsMap.get(r.rootId);if(!g)throw new Error(`No container for parts header root ${r.rootId}`);const C=r.width*this.currentSpaceSize,b=r.height*this.currentSpaceSize;g.setAttribute("width",C.toString()),g.setAttribute("height",b.toString());const P=this.getImagePayload(g);return{width:r.width,height:r.height,image:P}})}loadTextFontsIfNeeded(){this.requestedTextFonts.length===this.currentTextFonts.length&&this.requestedTextFonts.every((t,s)=>{const r=this.currentTextFonts[s];return(0,N.Ft)(t,r)})||(this.currentTextFonts=this.requestedTextFonts,this.fontFaceManager.loadFonts(this.requestedTextFonts))}getExecutor(){return R(this,null,function*(){const t=yield this.getPathProvider();return this.executor===null?this.executor=new d(t,this.document):this.executor.replacePathProviderIfNeeded(t),this.executor})}}},137532:(X,I,S)=>{S.d(I,{A:()=>p});var E=S(172858),A=S(145100),y=Object.defineProperty,N=Object.defineProperties,D=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(d,f,v)=>f in d?y(d,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):d[f]=v,n=(d,f)=>{for(var v in f||(f={}))c.call(f,v)&&u(d,v,f[v]);if(H)for(var v of H(f))l.call(f,v)&&u(d,v,f[v]);return d},h=(d,f)=>N(d,D(f));const w={maxMeasuresInFirstSystem:null,maxMeasuresInOtherSystems:null};function p(d){const f=d.requestedPageIdx+1;if(f<0)return 0;const v=d.structure.getScoreStructure(),x=h(n({},v.displayMetrics),{firstHeaderFooterHeight:0,otherHeaderFooterHeight:0,firstSliceHeaderWidth:0,otherSlicesHeaderWidth:0,partsPanel:null,measuresPanel:null,forceDisplayMeasureNumber:!1,forceDisplayAllParts:!1,displayMeasureIdxMap:v.displayMeasureIdxMap}),B=null,Y=null,W=new E.A(B,Y),T=n(n({},v.layout),w);W.overrideLayoutData(T);let R=v.measures;if(d.lastRenderedMeasureUuid!==null){const s=d.structure.getMeasureIdxFromUuid(d.lastRenderedMeasureUuid);R=v.measures.slice(s+1)}if(R.length===0)return 0;const $=v.parts[0],L=[h(n({},$),{stavesVoices:$.stavesVoices.slice(0,1),staves:$.staves.slice(0,1)})];let U=null;const m=new A.A({partsData:L,measuresData:R,displayMetrics:x,drawingContext:W});for(let s=0;s<=f&&m.pagesProvider.hasNext();s++)U=m.pagesProvider.getNext().getPageData();if(!U)throw new Error("Failed to retrieve page data");return d.structure.getMeasureIdxFromUuid(U.lastMeasureUuid)}},145100:(X,I,S)=>{S.d(I,{A:()=>j});var E=S(340497),A=Object.defineProperty,y=(o,e,a)=>e in o?A(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,N=(o,e,a)=>y(o,typeof e!="symbol"?e+"":e,a);class D{constructor(e,a){N(this,"pageIdx"),N(this,"displayMetrics"),N(this,"systems",[]),this.pageIdx=e,this.displayMetrics=a}getAvailableHeight(){return this.displayMetrics.pageHeight}removeSystem(){throw new Error("Not implemented")}addSystemAt(e){const{system:a,systemIdx:M}=e;this.systems.splice(M,0,a)}setSystemPosition(){throw new Error("Not implemented")}getPageData(){const e=this.systems[0],M=e.parts[0].uuid,J=e.slice.measures[0].data.uuid,Q=this.systems[this.systems.length-1],et=Q.parts[Q.parts.length-1].uuid,st=Q.slice.measures[Q.slice.measures.length-1].data.uuid;let q;this.displayMetrics.pageHeight===null?q=e.getStaffHeight()+e.getTopHeight()+e.getBottomHeight()+this.displayMetrics.topMargin+this.displayMetrics.bottomMargin:q=this.displayMetrics.pageHeight+this.displayMetrics.topMargin+this.displayMetrics.bottomMargin;let tt;if(this.displayMetrics.sliceWidth===null)throw new Error("A width should be set at this point");return tt=this.displayMetrics.sliceWidth+this.displayMetrics.externalMargin+this.displayMetrics.internalMargin,{pageIdx:this.pageIdx,width:tt,height:q,firstMeasureUuid:J,lastMeasureUuid:st,firstPartUuid:M,lastPartUuid:et}}}var H=Object.defineProperty,c=(o,e,a)=>e in o?H(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,l=(o,e,a)=>c(o,typeof e!="symbol"?e+"":e,a);class u{constructor(e,a,M){l(this,"systemsProvider"),l(this,"displayMetrics"),l(this,"drawingContext"),l(this,"pageIdx",0),this.systemsProvider=e,this.drawingContext=a,this.displayMetrics=M}setMeasureIdx(e){this.systemsProvider.setMeasureIdx(e),this.pageIdx=0}setPartIdx(e){this.systemsProvider.setPartIdx(e)}hasNext(){return this.systemsProvider.hasNext()}getNext(){const e=new D(this.pageIdx,this.displayMetrics),a=e,M=this.systemsProvider;return(0,E.A)(a,M,this.drawingContext),this.pageIdx++,e}}var n=S(603371),h=Object.defineProperty,w=(o,e,a)=>e in o?h(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,p=(o,e,a)=>w(o,typeof e!="symbol"?e+"":e,a);class d{constructor(e,a){p(this,"data"),p(this,"drawingContext"),p(this,"currentPosition",null),p(this,"parent",null),this.data=e,this.drawingContext=a}getPosition(){return this.currentPosition}setPosition(e){this.currentPosition=e}getNominalWidthMidSystem(){return this.getNominalWidth()}getNominalWidth(){return this.data.quarterDuration*this.drawingContext.getQuarterToSpaceRatio()}hasSystemBreakBefore(){return!1}hasSystemBreakAfter(){return!1}hasPageBreakBefore(){return!1}hasPageBreakAfter(){return!1}}var f=S(726042),v=S(164059),x=Object.defineProperty,B=(o,e,a)=>e in o?x(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,Y=(o,e,a)=>B(o,typeof e!="symbol"?e+"":e,a);const W=.5;class T{constructor(e,a){Y(this,"slice"),Y(this,"drawingContext"),Y(this,"parts",[]),Y(this,"page",null),this.slice=e,this.drawingContext=a}hasPageBreakBefore(){return this.slice.hasPageBreakBefore()}hasPageBreakAfter(){return this.slice.hasPageBreakAfter()}isSingleInSlice(){return this.slice.hasSingleSystem()}getBottomHeight(){return(this.drawingContext.getSpaceBetweenSystems()-W)/2}getTopHeight(){return this.getBottomHeight()}getStaffHeight(){const e=this.parts.flatMap(J=>J.staves),a=this.drawingContext.getSpaceBetweenStaves(),M=(e.length-1)*a;return e.map(v.o5).reduce(f.default.add,M)}addPart(e){this.parts.push(e)}}var R=Object.defineProperty,$=(o,e,a)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,L=(o,e,a)=>$(o,typeof e!="symbol"?e+"":e,a);function U(o){new m(o).process()}class m{constructor(e){L(this,"slice"),L(this,"parts"),L(this,"systems"),L(this,"availableHeight"),L(this,"drawingContext"),L(this,"currentSystemIdx",0),L(this,"currentSystemSize",0),this.slice=e.slice,this.parts=e.slice.getParts(),this.systems=e.slice.systems,this.availableHeight=e.availableHeight,this.drawingContext=e.drawingContext}process(){this.parts.forEach(this.processPart,this)}processPart(e){const a=this.getSystem(),M=this.drawingContext.getSpaceBetweenStaves(),k=t(e,M)+M;if(this.currentSystemSize===0){this.currentSystemSize+=this.drawingContext.getSpaceBetweenSystems(),a.addPart(e),this.currentSystemSize+=k;return}this.canFitPart(k)?(a.addPart(e),this.currentSystemSize+=k):(this.currentSystemSize=0,this.currentSystemIdx++,this.processPart(e))}canFitPart(e){return this.availableHeight===null?!0:this.currentSystemSize+e<=this.availableHeight}getSystem(){if(this.currentSystemIdx===this.systems.length){const e=new T(this.slice,this.drawingContext);this.systems.push(e),this.currentSystemSize=0}return this.systems[this.currentSystemIdx]}}function t(o,e){const a=o.staves,M=(a.length-1)*e;return a.map(v.o5).reduce(f.default.add,M)}var s=Object.defineProperty,r=(o,e,a)=>e in o?s(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,i=(o,e,a)=>r(o,typeof e!="symbol"?e+"":e,a);class g{constructor(e){i(this,"isFirst"),i(this,"measures",[]),i(this,"displayMetrics"),i(this,"partsData"),i(this,"partIdx"),i(this,"drawingContext"),i(this,"systems",[]),this.isFirst=e.isFirst,this.partsData=e.partsData,this.partIdx=e.partIdx,this.displayMetrics=e.displayMetrics,this.drawingContext=e.drawingContext}getParts(){return this.partIdx>0?this.partsData.slice(this.partIdx):this.partsData}getAvailableWidth(){return this.displayMetrics.sliceWidth}getMaxNbMeasures(){return this.displayMetrics.sliceWidth===null?null:this.isFirst?this.drawingContext.getMaxNbMeasuresInFirstSystem():this.drawingContext.getMaxNbMeasuresInOtherSystems()}removeMeasure(){throw new Error("Not implemented")}updateMeasureAt(){throw new Error("Not implemented")}addMeasureAt(e,a){this.measures.splice(a,0,e)}relowPartsInSystem(){U({slice:this,availableHeight:this.displayMetrics.pageHeight,drawingContext:this.drawingContext})}hasSingleSystem(){return this.systems.length===1&&this.partIdx===0}hasPageBreakBefore(){return this.measures[0].hasPageBreakBefore()}hasPageBreakAfter(){return this.measures[this.measures.length-1].hasPageBreakAfter()}}var C=Object.defineProperty,b=(o,e,a)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,P=(o,e,a)=>b(o,typeof e!="symbol"?e+"":e,a);class _{constructor(e){P(this,"measureIdx",0),P(this,"partIdx",0),P(this,"partsData"),P(this,"measures"),P(this,"drawingContext"),P(this,"displayMetrics"),this.partsData=e.partsData,this.drawingContext=e.drawingContext,this.displayMetrics=e.displayMetrics,this.measures=e.measuresData.map(a=>new d(a,this.drawingContext))}setMeasureIdx(e){this.measureIdx=e}setPartIdx(e){this.partIdx=e}hasNext(){return this.measureIdx<this.measures.length}getNext(){const e=new g({drawingContext:this.drawingContext,displayMetrics:this.displayMetrics,partsData:this.partsData,isFirst:this.measureIdx===0,partIdx:this.partIdx}),a=this.measures,M=e;return(0,n.A)(M,a,this.measureIdx),this.measureIdx+=e.measures.length,e.relowPartsInSystem(),this.partIdx=0,e}}var F=Object.defineProperty,O=(o,e,a)=>e in o?F(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,z=(o,e,a)=>O(o,typeof e!="symbol"?e+"":e,a);class V{constructor(e){z(this,"slicesProvider"),z(this,"cachedSystems",[]),this.slicesProvider=e}setMeasureIdx(e){this.cachedSystems=[],this.slicesProvider.setMeasureIdx(e)}setPartIdx(e){this.cachedSystems=[],this.slicesProvider.setPartIdx(e)}hasNext(){return this.cachedSystems.length>0||this.slicesProvider.hasNext()}getNext(){const e=this.cachedSystems.pop();if(e)return e;const a=this.slicesProvider.getNext(),[M,...k]=a.systems;return k.reverse(),this.cachedSystems=k,M}handback(e){this.cachedSystems.push(e)}}var G=Object.defineProperty,K=(o,e,a)=>e in o?G(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,Z=(o,e,a)=>K(o,typeof e!="symbol"?e+"":e,a);class j{constructor(e){Z(this,"partsData"),Z(this,"measuresData"),Z(this,"displayMetrics"),Z(this,"pagesProvider"),this.partsData=e.partsData,this.measuresData=e.measuresData,this.displayMetrics=e.displayMetrics;const a=new _({partsData:e.partsData,measuresData:e.measuresData,displayMetrics:e.displayMetrics,drawingContext:e.drawingContext}),M=new V(a);this.pagesProvider=new u(M,e.drawingContext,e.displayMetrics)}getPagesFrom(e){const a=this.getMeasureIdx(e.measureUuid),M=this.getPartIdx(e.partUuid);this.pagesProvider.setMeasureIdx(a),this.pagesProvider.setPartIdx(M);const k=[];for(;this.pagesProvider.hasNext();){const Q=this.pagesProvider.getNext().getPageData();k.push(Q)}return k}getMeasureIdx(e){if(!e)return 0;const a=this.measuresData.findIndex(M=>M.uuid===e);if(a===-1)throw new Error(`Measure with uuid ${e} not found`);return a+1}getPartIdx(e){if(!e)return 0;const a=this.partsData.findIndex(M=>M.uuid===e);if(a===-1)throw new Error(`Part with uuid ${e} not found`);return a===this.partsData.length-1?0:a+1}}},606333:(X,I,S)=>{S.d(I,{A:()=>y,p:()=>E});const E="primitive.RemoveMultiMeasureRest",y={NAME:E}},669834:(X,I,S)=>{S.d(I,{A:()=>u});var E=S(269352);const A=["text-transform","letter-spacing","font-weight","font-style","white-space"],y=function(n){this.init(n)},N=y.prototype;N.init=function(n){this.draftSvg=n},N.isFromFont=function(){return!1},N.getComputedTextLength=function(n,h,w,p){const d=h.join(", "),f=this.getText(n,d,w,p);this.draftSvg.appendChild(f.node());const v=f.node().getComputedTextLength();return this.draftSvg.removeChild(f.node()),v},N.getXHeight=function(n,h){const w=n.join(", "),p=this.getText("xvw",w,h);this.draftSvg.appendChild(p.node());const d=p.getBBox();return this.draftSvg.removeChild(p.node()),d.height/2},N.getText=function(n,h,w,p){p=p||{};const d=new E.A("text");return d.attr("x",0),d.attr("y",0),d.attr("font-family",h),d.attr("font-size",w),A.forEach(f=>{typeof p[f]!="undefined"&&d.style(f,p[f])}),d.text(n),d};const D=y,H=function(n){this.init(n)},c=H.prototype;c.init=function(n){this.textMetric=new D(n),this.lengthCache={},this.xHeightCache={}},c.isFromFont=function(){return!1},c.getComputedTextLength=function(n,h,w,p){p=p||{};const d=l(n,h,w,p);return typeof this.lengthCache[d]=="undefined"&&this.computeTextLength(d,n,h,w,p),this.lengthCache[d]},c.computeTextLength=function(n,h,w,p,d){const f=this.textMetric.getComputedTextLength(h,w,p,d);this.lengthCache[n]=f};const l=function(n,h,w,p){return JSON.stringify({string:n,fontFamilies:h,fontSize:w,options:p})};c.getXHeight=function(n,h){const w=l(n,h);return typeof this.xHeightCache[w]=="undefined"&&this.computeTextXHeight(w,n,h),this.xHeightCache[w]},c.computeTextXHeight=function(n,h,w){const p=this.textMetric.getXHeight(h,w);this.xHeightCache[n]=p};const u=H},713335:(X,I,S)=>{S.d(I,{A:()=>H});var E=Object.defineProperty,A=(c,l,u)=>l in c?E(c,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[l]=u,y=(c,l,u)=>A(c,typeof l!="symbol"?l+"":l,u);const N="http://www.w3.org/2000/svg";class D{constructor(l){y(this,"tagName"),y(this,"attributes",{}),y(this,"children",[]),y(this,"dataset",{}),y(this,"textContent",""),y(this,"parentNode",null),y(this,"classList",{add(){}}),this.tagName=l}setAttribute(l,u){this.attributes[l]=u}setAttributeNS(l,u,n){this.setAttribute(u,n)}appendChild(l){return l.parentNode=this,this.children.push(l),l}removeChild(l){const u=this.children.indexOf(l);if(u!==-1)return this.children.splice(u,1),l.parentNode=null,l}get outerHTML(){const l=Object.entries(this.attributes).map(([n,h])=>` ${n}="${h}"`).join(""),u=this.children.map(n=>n.outerHTML).join("");return this.tagName==="#text"?this.textContent:`<${this.tagName}${l}>${this.textContent}${u}</${this.tagName}>`}get firstChild(){return this.children.length>0?this.children[0]:null}}class H{createElementNS(l,u){if(l!==N)throw new Error("Only SVG namespace supported");return new D(u)}createTextNode(l){const u=new D("#text");return u.textContent=l,u}}},777432:(X,I,S)=>{S.d(I,{A:()=>A});var E=(y=>(y.IMAGE_BITMAP="image_bitmap",y.SVG_NODE="svg_node",y.SVG_STRING="svg_string",y))(E||{});const A=E},914906:(X,I,S)=>{S.d(I,{A:()=>A});const A={glyphs:{systemBreakYes:{description:"system break",bBoxNE:[.5,1],bBoxSW:[-.5,0],path:"M128,240,L128,69,L-48,69,L-48,137,L-112,69,L-48,0,L-48,69,L128,69,L128,240,L-40,240z"},pageBreakYesPage:{description:"page break - page",bBoxNE:[.7,1.2],bBoxSW:[-.7,0],path:"M 101 290 H -101 C -110 290 -118 282 -118 273 V 34 C -118 25 -110 17 -101 17 H 101 C 110 17 118 25 118 34 V 273 C 118 282 110 290 101 290 ZM -101 307 C -119 307 -134 292 -134 273 V 34 C -134 15 -119 0 -101 0 H 101 C 119 0 134 15 134 34 V 273 C 134 292 119 307 101 307 H -101 Z"},pageBreakYesDashedLine:{description:"page break - dashed line",bBoxNE:[.7,1.2],bBoxSW:[-.7,0],path:"M -143 163 H -179 V 181 H -143 V 163 ZM -54 163 H -125 V 181 H -54 V 163 ZM 36 163 H -36 V 181 H 36 V 163 ZM 125 163 H 54 V 181 H 125 V 163 ZM 179 163 H 143 V 181 H 179 V 163 Z"},pageBreakYesArrowHead:{description:"page break - arrow head",bBoxNE:[.7,1.2],bBoxSW:[-.7,0],path:"M -90 90 L -27 145 V 36 L -90 90 Z"},pageBreakYesArrowLine:{description:"page break - arrow body",bBoxNE:[.7,1.2],bBoxSW:[-.7,0],path:"M 63 226 H -27 V 244 H 63 C 78 244 90 232 90 217 V 108 C 90 93 78 81 63 81 H -27 V 99 H 63 C 68 99 72 103 72 108 V 217 C 72 222 68 226 63 226 Z"}},fontName:"FlatIcons",fontVersion:1,meta:{"units-per-em":"1024"}}},916504:(X,I,S)=>{S.d(I,{A:()=>y});var E=S(24927);const y=(0,E.A)("flat_ux")},987876:(X,I,S)=>{S.d(I,{A:()=>H});var E=S(306563),A=Object.defineProperty,y=(u,n,h)=>n in u?A(u,n,{enumerable:!0,configurable:!0,writable:!0,value:h}):u[n]=h,N=(u,n,h)=>y(u,typeof n!="symbol"?n+"":n,h),D=(u,n,h)=>new Promise((w,p)=>{var d=x=>{try{v(h.next(x))}catch(B){p(B)}},f=x=>{try{v(h.throw(x))}catch(B){p(B)}},v=x=>x.done?w(x.value):Promise.resolve(x.value).then(d,f);v((h=h.apply(u,n)).next())});class H{constructor(n,h){N(this,"loadingMap",new Map),N(this,"loadedMap",new Map),N(this,"resourcesProvider"),N(this,"fontFaceSet"),this.resourcesProvider=n,this.fontFaceSet=h}loadFonts(n){return D(this,null,function*(){const h=n.map(w=>{const p=(0,E.Zd)(w),d=this.loadedMap.get(p);return d?Promise.resolve(d):this.loadingMap.get(p)||this._loadFont(p,w)});yield Promise.all(h)})}_loadFont(n,h){const w=D(this,null,function*(){const p=yield this.resourcesProvider.getTextFont(h),d=new FontFace(h.fontFamily,p,{weight:l(h),style:c(h)});return yield d.load(),this.fontFaceSet.add(d),this.loadedMap.set(n,d),this.loadingMap.delete(n),d});return this.loadedMap.has(n)||this.loadingMap.set(n,w),w}}function c(u){return u.italic?"italic":"normal"}function l(u){return u.bold?"bold":"normal"}}}]);})();


//# debugId=da8be242-0c82-5f47-9011-8ffee5af4db8
