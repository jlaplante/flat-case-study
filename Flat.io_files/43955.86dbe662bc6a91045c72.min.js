"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="58893524-e705-554a-a7b2-86103985c27f")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[43955],{16806:(C,U,t)=>{t.r(U),t.d(U,{default:()=>E});var g=t(52275),A=t(704621),O=t(981801),T=t(898039),D=t(793317),p=t(578918),u=t(195446),d=t(748803),o=t(483701),r=t(582711),e=t(351277),i=t(123491),P=t(129283),M=t(34679),f=t(42651);const _=function(c,I,a){this.init(c,I,a)};_.NAME="action.AddGlissandoSide";const l=_.prototype;l.name=_.NAME,l.initMeasureData=D.default,l.init=function(c,I,a){(0,g.default)(c,I),(0,A.default)(c,I),(0,O.default)(c,I),this.initMeasureData(c,I),this.opts=I,this.cancelStack=a,this.noteAtPitch=null,this.location=null,this.sanitized=!1,(0,T.default)(this.measureData,I)},l.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkPitch(),this.checkNoteAtPitch(),this.sanitizeIfNeeded(),this.checkGlissandoType(),this.checkNumber(),this.checkExistence()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new u.default},l.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},l.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},l.checkPitch=function(){e.default.check(this.opts.pitch)},l.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const I=e.default.copy(this.opts.pitch);throw new d.default(d.default.GET,I)}},l.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.number=="undefined"&&(this.opts.number=1),this.sanitized=!0)},l.checkGlissandoType=function(){P.default.check(this.opts.glissandoType)},l.checkNumber=function(){if(typeof this.opts.number!="number"||this.opts.number<0)throw new r.A(this.opts.number)},l.checkExistence=function(){const c=this.getNoteAtPitch();if(i.default.hasGlissando(c,this.opts.glissandoType,this.opts.number))throw new o.A},l.getNoteAtPitch=function(){if(this.noteAtPitch===null){const c=this.getVoice();this.noteAtPitch=(0,p.default)(c,this.opts.noteIdx,this.opts.pitch)}return this.noteAtPitch},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number};new M.A(this.measureData,c,this.cancelStack).perform(),this.updateStack()},l.updateStack=function(){const c=this.getLocation(),I={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,timePos:c.timePos,divisions:c.dpq,pitch:e.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(I)},l.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),I={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,timePos:c.timePos,divisions:c.dpq,pitch:e.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.storeAction(I)}},l.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),I=c.getPartUuid(this.opts.partIdx),a=c.getMeasureUuid(this.opts.measureIdx),m=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),h=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:I,measureUuid:a,voiceUuid:m,dpq:n,timePos:h}}return this.location},(0,f.default)(_);const E=_},121784:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(702544),A=t(31278),O=t(52275),T=t(916388),D=t(726042),p=t(383279),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.SetPartGlobalReverberation";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){(0,O.default)(e,i),this.scoreData=e,this.cancelStack=P,this.opts=i,this.location=null},o.checkPreconditions=function(){this.checkLocation(),T.A.check(this.opts.reverberation);const e=this.getCurrentReverberation();if(this.opts.reverberation===e)throw new A.default},o.checkLocation=function(){const e=this.opts.partIdx,i=this.scoreData.getNbParts();if(!D.default.isInteger(e)||e<0||e>=i)throw new g.default(e)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.setReverberation(),this.updateStack(e)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{partUuid:e.partUuid,reverberation:this.opts.reverberation}};this.cancelStack.storeAction(i)}},o.getPreviousData=function(){return{reverberation:this.getCurrentReverberation()}},o.getCurrentReverberation=function(){const e=this.scoreData.getPartHeader(this.opts.partIdx);return p.default.getGlobalReverberation(e)},o.setReverberation=function(){const e=this.scoreData.getPartHeader(this.opts.partIdx);p.default.setGlobalReverberation(e,this.opts.reverberation)},o.updateStack=function(e){const i=this.getLocation(),P={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,previousReverberation:e.reverberation}};this.cancelStack.push(P)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:e}}return this.location},(0,u.default)(d);const r=d},292734:(C,U,t)=>{t.r(U),t.d(U,{default:()=>c});var g=t(364842),A=t(857552),O=t(14822),T=t(31278),D=t(794799),p=t(123491),u=t(712947),d=t(42651),o=t(666363),r=t(2110),e=t(698716),i=t(52275),P=t(596463),M=t(981801),f=t(609817),_=t(739293),l=t(713735);class E{constructor(n,s,h){this.name=E.NAME,(0,i.default)(n,s),(0,P.A)(n,s),(0,M.default)(n,s),this.measuresScroller=(0,r.A)(n,s),this.cancelStack=h,this.opts=s,this.location=null,this.previousNote=null,(0,f.A)(this.measuresScroller,this.opts)}checkPreconditions(){this.checkLocation(),this.checkPreviousNoteIdx(),this.checkReverseRange(),this.checkNewNoteIdx()}checkLocation(){this.measuresScroller.checkMeasureIdx(this.opts.oldMeasureIdx);const n=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx);n.checkVoiceIdx(this.opts.voiceIdx),n.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.oldNoteIdx),this.measuresScroller.checkMeasureIdx(this.opts.newMeasureIdx);const h=this.measuresScroller.getMeasureData(this.opts.newMeasureIdx);h.checkVoiceIdx(this.opts.voiceIdx),h.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.newNoteIdx)}checkPreviousNoteIdx(){const n=this.getPreviousNote();if(!p.default.hasSlur(n))throw new O.A}getPreviousNote(){if(this.previousNote===null){const s=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx).getVoice(this.opts.voiceIdx);this.previousNote=s.getNote(this.opts.oldNoteIdx)}return this.previousNote}checkReverseRange(){const n=this.getPreviousNote(),s=p.default.getSlur(n),h=u.default.getType(s),v=e.A.create(this.opts.oldMeasureIdx,this.opts.oldNoteIdx);v.voiceIdx=this.opts.voiceIdx;const S=e.A.create(this.opts.newMeasureIdx,this.opts.newNoteIdx);if(h===D.A.START){const x=(0,l.A)(this.measuresScroller,v);if(!e.A.isLower(S,x)){const L=new A.default(A.default.SLUR);throw L.message="The slur start cannot be after the place where it stops",L}}else if(h===D.A.STOP){const x=(0,_.A)(this.measuresScroller,v);if(!e.A.isGreater(S,x)){const L=new A.default(A.default.SLUR);throw L.message="The slur start cannot be after the place where it stops",L}}else throw new g.default(`SlurType is not expected: (${h})`)}checkNewNoteIdx(){this.checkInterval()}checkInterval(){const n=e.A.create(this.opts.oldMeasureIdx,this.opts.oldNoteIdx);n.voiceIdx=this.opts.voiceIdx;let s=e.A.create(this.opts.newMeasureIdx,this.opts.newNoteIdx);if(e.A.isEqual(n,s))throw new T.default;if(e.A.isGreater(s,n)?s=I(this.measuresScroller,s,n):e.A.isLower(s,n)&&(s=a(this.measuresScroller,s,n)),e.A.isEqual(n,s))throw new T.default;this.opts.newMeasureIdx=s.measureIdx,this.opts.newNoteIdx=s.noteIdx}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.moveSlurSide(),this.updateCancelStack()}storeAction(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),s={partUuid:n.partUuid,voiceUuid:n.voiceUuid,oldMeasureUuid:n.oldMeasureUuid,oldDivisions:n.oldDivisions,oldTimePos:n.oldTimePos,newMeasureUuid:n.newMeasureUuid,newDivisions:n.newDivisions,newTimePos:n.newTimePos},h={actionName:this.name,opts:s};this.cancelStack.storeAction(h)}}moveSlurSide(){const n={partIdx:this.opts.partIdx,oldMeasureIdx:this.opts.oldMeasureIdx,newMeasureIdx:this.opts.newMeasureIdx,voiceIdx:this.opts.voiceIdx,oldNoteIdx:this.opts.oldNoteIdx,newNoteIdx:this.opts.newNoteIdx};new o.A(this.measuresScroller,n,this.cancelStack).perform()}updateCancelStack(){const n=this.getLocation(),s={partUuid:n.partUuid,voiceUuid:n.voiceUuid,oldMeasureUuid:n.oldMeasureUuid,oldDivisions:n.oldDivisions,oldTimePos:n.oldTimePos,newMeasureUuid:n.newMeasureUuid,newDivisions:n.newDivisions,newTimePos:n.newTimePos},h={type:this.name,noDraw:!0,opts:s};this.cancelStack.push(h)}getLocation(){if(this.location===null){const n=this.measuresScroller.getScoreData(),s=n.getPartUuid(this.opts.partIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),v=n.getMeasureUuid(this.opts.oldMeasureIdx),S=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx),x=S.getDpqValue(),R=S.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.oldNoteIdx),B=n.getMeasureUuid(this.opts.newMeasureIdx),N=this.measuresScroller.getMeasureData(this.opts.newMeasureIdx),W=N.getDpqValue(),K=N.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.newNoteIdx);this.location={partUuid:s,voiceUuid:h,oldMeasureUuid:v,oldDivisions:x,oldTimePos:R,newMeasureUuid:B,newDivisions:W,newTimePos:K}}return this.location}}Object.defineProperty(E,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"action.MoveSlurSideErase"});const c=E;function I(m,n,s){let h=null;for(let v=n.measureIdx;v>=s.measureIdx;v--){const S=m.getMeasureData(v);if(!S.hasVoice(s.voiceIdx))continue;const x=S.getVoice(s.voiceIdx);for(h===null?h=n.noteIdx:h=x.getNbNotes()-1;h>=0;h--){const L=x.getNote(h);if(!p.default.isRest(L))return e.A.create(v,h)}}throw new g.default("Should not happen")}function a(m,n,s){let h=null;for(let v=n.measureIdx;v<=s.measureIdx;v++){const S=m.getMeasureData(v);if(!S.hasVoice(s.voiceIdx))continue;const x=S.getVoice(s.voiceIdx);h===null?h=n.noteIdx:h=0;const L=x.getNbNotes();for(;h<L;h++){const R=x.getNote(h);if(!p.default.isRest(R))return e.A.create(v,h)}}throw new g.default("Should not happen")}(0,d.default)(E)},302165:(C,U,t)=>{t.r(U),t.d(U,{default:()=>d});var g=t(704621),A=t(153271),O=t(607801),T=t(143482),D=t(42651);const p=function(o,r,e){this.init(o,r,e)};p.NAME="action.AddJumpTag";const u=p.prototype;u.name=p.NAME,u.init=function(o,r,e){(0,g.default)(o,r),this.scoreData=o,this.opts=r,this.cancelStack=e,this.location=null},u.checkPreconditions=function(){this.checkLocation(),this.checkType()},u.checkLocation=function(){const o=this.scoreData.getNbMeasures(),r=this.opts.measureIdx;if(r<0||r>=o)throw new A.default(r,A.default.GET)},u.checkType=function(){O.A.tagCheck(this.opts.type)},u.getCommonContent=function(){return this.scoreData.getCommonContent()},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const o={measureIdx:this.opts.measureIdx,type:this.opts.type};new T.A(this.scoreData,o,this.cancelStack).perform(),this.updateStack()},u.updateStack=function(){const o=this.getLocation(),r={type:this.name,noDraw:!0,opts:{measureUuid:o.measureUuid,type:this.opts.type}};this.cancelStack.push(r)},u.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),r={actionName:this.name,opts:{measureUuid:o.measureUuid,type:this.opts.type}};this.cancelStack.storeAction(r)}},u.getLocation=function(){if(this.location===null){const o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:o}}return this.location},(0,D.default)(p);const d=p},361833:(C,U,t)=>{t.r(U),t.d(U,{default:()=>M});var g=t(857552),A=t(153271),O=t(661e3),T=t(701387),D=t(518558),p=t(726042),u=t(128425),d=t(407819),o=t(813263),r=t(42651),e=t(74446);const i=function(f,_,l){this.init(f,_,l)};i.NAME="action.SetTimeSignature";const P=i.prototype;P.name=i.NAME,P.init=function(f,_,l){(0,d.default)(f,_),this.scoreData=f,this.cancelStack=l,this.opts=_,this.location=null,typeof this.opts.displayedTime=="undefined"&&(this.opts.displayedTime=D.default.copy(this.opts.timeSignature)),typeof this.opts.beatsList=="undefined"&&(this.opts.beatsList=(0,o.default)(this.opts.timeSignature)),typeof this.opts.restsInsideBeams=="undefined"&&(this.opts.restsInsideBeams=!1)},P.checkPreconditions=function(){this.checkLocation(),D.default.check(this.opts.timeSignature),D.default.check(this.opts.displayedTime);const f=D.default.getNbBeats(this.opts.timeSignature);e.default.check(this.opts.beatsList,f),this.checkDifferentTime()},P.checkLocation=function(){const _=this.scoreData.getPartMeasures(0).length,l=this.opts.startMeasureIdx;let E=l;if(!p.default.isInteger(E)||E<0||E>=_)throw new A.default(E,A.default.GET);const c=this.opts.stopMeasureIdx;if(c<l)throw new g.default(g.default.MEASURE,l,c);if(E=this.opts.stopMeasureIdx,!p.default.isInteger(E)||E<0||E>=_)throw new A.default(E,A.default.GET)},P.checkDifferentTime=function(){if(!this.getMeasuresRange().some(this.isTimeDifferent,this))throw new O.default(O.default.TIME)},P.getMeasuresRange=function(){const f=this.opts.startMeasureIdx,_=this.opts.stopMeasureIdx+1;return this.getMeasures().slice(f,_)},P.getMeasures=function(){return this.scoreData.getPartMeasures(0)},P.isTimeDifferent=function(f,_){const l=_+this.opts.startMeasureIdx,E=this.scoreData.getCommonContent(),c=E.getDisplayedTime(l),I=E.getBeatsList(l),a=T.default.getAnyTime(f),m=E.hasRestsInsideBeams(l);return!D.default.isSame(a,this.opts.timeSignature)||!D.default.isSame(c,this.opts.displayedTime)||!e.default.isSame(I,this.opts.beatsList)||m!==this.opts.restsInsideBeams},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setTime()},P.storeAction=function(){if(!this.cancelStack.hasAction()){const _=this.getLocation().measureUuids.slice(),l=D.default.copy(this.opts.timeSignature),E=D.default.copy(this.opts.displayedTime),c=e.default.copy(this.opts.beatsList),I=this.opts.restsInsideBeams,a={actionName:this.name,opts:{measureUuids:_,timeSignature:l,displayedTime:E,beatsList:c,restsInsideBeams:I}};this.cancelStack.storeAction(a)}},P.getLocation=function(){if(this.location===null){const f=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:f}}return this.location},P.setTime=function(){const f=D.default.copy(this.opts.timeSignature),_=D.default.copy(this.opts.displayedTime),l=e.default.copy(this.opts.beatsList),E=this.opts.restsInsideBeams,c={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,timeSignature:f,displayedTime:_,beatsList:l,restsInsideBeams:E};new u.default(this.scoreData,c,this.cancelStack).perform()},(0,r.default)(i);const M=i},394409:(C,U,t)=>{t.r(U),t.d(U,{default:()=>I});var g=t(31278),A=t(195446),O=t(247739),T=t(123491),D=t(292681),p=t(104907),u=t(66692),d=t(76004),o=t(2835),r=t(898039),e=t(52275),i=t(704621),P=t(981801),M=t(831121),f=t(404747),_=t(793317),l=t(42651);const E=function(a,m,n){this.init(a,m,n)};E.NAME="action.ChangeGraceHeadPercu",E.isNoChange=function(a){return a instanceof g.default};const c=E.prototype;c.name=E.NAME,c.initMeasureData=_.default,c.init=function(a,m,n){(0,e.default)(a,m),(0,i.default)(a,m),(0,P.default)(a,m),this.initMeasureData(a,m),this.cancelStack=n,this.opts=m,this.sanitized=!1,this.voice=null,this.graceAtUnpitched=null,this.location=null},c.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,r.default)(this.measureData,this.opts),this.checkGraceIdx(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkInstrument(),this.checkHeadDifferent()},c.checkUnpitchedPart=function(){(0,M.default)(this.measureData)},c.checkUnpitchededPart=function(){if(this.measureData.isUnpitched())throw new A.default},c.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},c.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},c.checkNoteAtUnpitched=function(){if(typeof this.getGraceAtUnpitched()=="undefined"){const m=D.default.copy(this.opts.unpitched),n=this.opts.staffIdx||0,s=this.measureData.getStaffDetails(n),h=p.default.getNbStaffLines(s);throw new O.A(O.A.GET,m,h)}},c.checkInstrument=function(){(0,f.A)(this.measureData,this.opts)},c.checkHeadDifferent=function(){const a=this.getCurrentHead();if(this.opts.notehead===a)throw new g.default},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,r.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();const a=this.getNoteData();this.changeHead(),this.updateStack(a)},c.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,o.default)(this.measureData,this.opts),this.sanitized=!0)},c.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),m={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,divisions:a.dpq,timePos:a.timePos,graceIdx:this.opts.graceIdx,unpitched:D.default.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(m)}},c.getNoteData=function(){return{notehead:this.getCurrentHead()}},c.getCurrentHead=function(){const a=this.getGraceAtUnpitched();return T.default.getHead(a)},c.getGraceAtUnpitched=function(){if(this.graceAtUnpitched===null){const a=this.getVoice();this.graceAtUnpitched=(0,d.A)(a,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)}return this.graceAtUnpitched},c.changeHead=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:D.default.copy(this.opts.unpitched),notehead:this.opts.notehead};new u.A(this.measureData,a,this.cancelStack).perform()},c.updateStack=function(a){const m=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:m.partUuid,measureUuid:m.measureUuid,voiceUuid:m.voiceUuid,divisions:m.dpq,timePos:m.timePos,graceIdx:this.opts.graceIdx,unpitched:D.default.copy(this.opts.unpitched),notehead:a.notehead}};this.cancelStack.push(n)},c.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),m=a.getPartUuid(this.opts.partIdx),n=a.getMeasureUuid(this.opts.measureIdx),s=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),h=this.measureData.getDpqValue(),S=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:m,measureUuid:n,voiceUuid:s,dpq:h,timePos:S}}return this.location},(0,l.default)(E);const I=E},396636:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(883782),A=t(227829),O=t(513318),T=t(744572),D=t(52275),p=t(981801),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.RemoveVoice";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){(0,D.default)(e,i),(0,p.default)(e,i),this.scoreData=e,this.cancelStack=P,this.opts=i,this.location=null,this.sanitized=!1},o.checkPreconditions=function(){if(O.A.check(this.opts.voiceIdx),!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new g.default(this.opts.voiceIdx);const e=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx);if(this.scoreData.getPartStaffNbVoices(this.opts.partIdx,e)<2)throw new A.A(A.A.VOICE)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();const e=this.getPreviousData();this.removeVoice(),this.updateStack(e)},o.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.candidateMainVoiceIdx=="undefined"&&(this.opts.candidateMainVoiceIdx=null),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={partUuid:e.partUuid,voiceUuid:e.voiceUuid,candidateMainVoiceIdx:this.opts.candidateMainVoiceIdx,voiceIdx:this.opts.voiceIdx},P={actionName:this.name,opts:i};this.cancelStack.storeAction(P)}},o.getPreviousData=function(){const e=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),i=this.scoreData.getPartStaffUuid(this.opts.partIdx,e),M=this.scoreData.getPartStaffMapping(this.opts.partIdx)[e],f=M.voices.indexOf(this.opts.voiceIdx),_=M.mainVoiceIdx===this.opts.voiceIdx,l=this.scoreData.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx);return{staffUuid:i,idxInStaff:f,isMainVoice:_,voiceUuid:l}},o.removeVoice=function(){const e={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,candidateMainVoiceIdx:this.opts.candidateMainVoiceIdx};new T.A(this.scoreData,e,this.cancelStack).perform()},o.updateStack=function(e){const P={partUuid:this.getLocation().partUuid,voiceIdx:this.opts.voiceIdx,staffUuid:e.staffUuid,idxInStaff:e.idxInStaff,isMainVoice:e.isMainVoice,voiceUuid:e.voiceUuid},M={type:this.name,noDraw:!0,opts:P};this.cancelStack.push(M)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx),i=this.scoreData.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx);this.location={partUuid:e,voiceUuid:i}}return this.location},(0,u.default)(d);const r=d},410007:(C,U,t)=>{t.r(U),t.d(U,{default:()=>n});var g=t(31278),A=t(195446),O=t(160814),T=t(476943),D=t(737903),p=t(123491),u=t(351277),d=t(967104),o=t(13421),r=t(52275),e=t(704621),i=t(981801),P=t(783177),M=t(898039),f=t(287296),_=t(793317),l=t(575349),E=t(42651),c=t(694426),I=t(458057);const a=function(s,h,v){this.init(s,h,v)};a.NAME="action.AddPreBend",a.isNoChange=function(s){return s instanceof g.default};const m=a.prototype;m.name=a.NAME,m.initMeasureData=_.default,m.init=function(s,h,v){(0,r.default)(s,h),(0,e.default)(s,h),(0,i.default)(s,h),(0,P.default)(s,h),this.initMeasureData(s,h),this.cancelStack=v,this.opts=h,this.noteHead=null,this.voice=null,this.location=null},m.checkPreconditions=function(){u.default.check(this.opts.pitch),I.A.check(this.opts.alter,c.A.PRE_BEND),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,M.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitchFret(),this.checkDifferentBend()},m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new A.default},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.sanitizeIfNeeded=function(){this.opts.isConcertPitch&&(0,f.default)(this.measureData,this.opts)},m.checkNoteAtPitchFret=function(){if(typeof this.getNoteAtPitchFret()=="undefined"){const h=u.default.copy(this.opts.pitch),v=(0,D.default)(this.opts.fretData);throw new O.A(h,v)}},m.checkDifferentBend=function(){const s=this.getNoteAtPitchFret();if(!p.default.hasPreBend(s))return;const h=p.default.getPreBend(s);if(d.A.getAlter(h)===this.opts.alter)throw new g.default},m.getNoteAtPitchFret=function(){if(this.noteHead===null){let h=this.getVoice().getChord(this.opts.noteIdx);h=T.default.makeArray(h),this.noteHead=h.find(l.A,this.opts)}return this.noteHead},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addPreBend(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),h={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,pitch:u.default.copyWithoutAlter(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData),type:this.opts.type,alter:this.opts.alter,isConcertPitch:!1},v={actionName:this.name,opts:h};this.cancelStack.storeAction(v)}},m.addPreBend=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:u.default.copy(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData),alter:this.opts.alter};new o.A(this.measureData,s,this.cancelStack).perform()},m.updateStack=function(){const s=this.getLocation(),h={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,pitch:u.default.copyWithoutAlter(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData)},v={type:this.name,noDraw:!0,opts:h};this.cancelStack.push(v)},m.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),h=s.getPartUuid(this.opts.partIdx),v=s.getMeasureUuid(this.opts.measureIdx),S=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),x=this.measureData.getDpqValue(),R=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:h,measureUuid:v,voiceUuid:S,dpq:x,timePos:R}}return this.location},m.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,E.default)(a);const n=a},432384:(C,U,t)=>{t.r(U),t.d(U,{default:()=>f});var g=t(123491),A=t(209175),O=t(737296),T=t(19850),D=t(975924),p=t(52275),u=t(704621),d=t(981801),o=t(42651),r=t(793317),e=t(582458),i=t(543371);const P=function(_,l,E){this.init(_,l,E)};P.NAME=i.default.NAME;const M=P.prototype;M.initMeasureData=r.default,M.name=P.NAME,M.init=function(_,l,E){(0,p.default)(_,l),(0,u.default)(_,l),(0,d.default)(_,l),this.initMeasureData(_,l),this.cancelStack=E,this.opts=l,(0,T.default)(this.measureData,this.opts),this.previousDurationType=null,this.previousNbDots=null,this.location=null,this.action=null},M.checkPreconditions=function(){this.getAction().checkPreconditions()},M.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.recordPreviousDuration(),this.storeAction(),this.changeDuration(),this.updateStack()},M.recordPreviousDuration=function(){const l=this.getVoice().getNote(this.opts.noteIdx),E=this.measureData.getDpqValue();this.previousDurationType=(0,D.default)(l,E),this.previousNbDots=g.default.getNbDots(l)},M.changeDuration=function(){const _=this.getAction();_.cancelStack=this.cancelStack,_.perform()},M.getAction=function(){if(this.action===null){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:O.default.REPLACE,record:!1},l=null;this.action=new e.default(this.measureData,_,l)}return this.action},M.updateStack=function(){const _=this.getLocation(),l=A.default.copy(_.timeModif),E={type:this.name,noDraw:!0,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,divisions:_.dpq,timePos:_.timePos,previousNbDots:this.previousNbDots,previousDurationType:this.previousDurationType,timeModif:l}};this.cancelStack.push(E)},M.storeAction=function(){if(!this.cancelStack.hasAction()){const _=this.getLocation(),l=A.default.copy(_.timeModif),E={actionName:this.name,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,divisions:_.dpq,timePos:_.timePos,nbDots:this.opts.nbDots,durationType:this.opts.durationType,timeModif:l}};this.cancelStack.storeAction(E)}},M.getLocation=function(){if(this.location===null){const _=this.measureData.getScoreData(),l=_.getPartUuid(this.opts.partIdx),E=_.getMeasureUuid(this.opts.measureIdx),c=_.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),I=this.measureData.getDpqValue(),a=this.measureData.getVoice(this.opts.voiceIdx),m=a.getRangeSpace(0,this.opts.noteIdx),n=a.getNote(this.opts.noteIdx);let s=g.default.getTimeModif(n);s=A.default.copy(s),this.location={partUuid:l,measureUuid:E,voiceUuid:c,dpq:I,timePos:m,timeModif:s}}return this.location},M.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,o.default)(P);const f=P},444343:(C,U,t)=>{t.r(U),t.d(U,{default:()=>d});var g=t(704621),A=t(153271),O=t(607801),T=t(860137),D=t(42651);const p=function(o,r,e){this.init(o,r,e)};p.NAME="action.AddJumpCall";const u=p.prototype;u.name=p.NAME,u.init=function(o,r,e){(0,g.default)(o,r),this.scoreData=o,this.opts=r,this.cancelStack=e,this.location=null},u.checkPreconditions=function(){this.checkLocation(),this.checkType()},u.checkLocation=function(){const o=this.scoreData.getNbMeasures(),r=this.opts.measureIdx;if(r<0||r>=o)throw new A.default(r,A.default.GET)},u.checkType=function(){O.A.callCheck(this.opts.type)},u.getCommonContent=function(){return this.scoreData.getCommonContent()},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const o={measureIdx:this.opts.measureIdx,type:this.opts.type};new T.A(this.scoreData,o,this.cancelStack).perform(),this.updateStack()},u.updateStack=function(){const o=this.getLocation(),r={type:this.name,noDraw:!0,opts:{measureUuid:o.measureUuid,type:this.opts.type}};this.cancelStack.push(r)},u.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),r={actionName:this.name,opts:{measureUuid:o.measureUuid,type:this.opts.type}};this.cancelStack.storeAction(r)}},u.getLocation=function(){if(this.location===null){const o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:o}}return this.location},(0,D.default)(p);const d=p},446719:(C,U,t)=>{t.r(U),t.d(U,{default:()=>E});var g=t(737903),A=t(209175),O=t(972913),T=t(33674),D=t(890985),p=t(52275),u=t(704621),d=t(981801),o=t(783177),r=t(19850),e=t(597003),i=t(155834),P=t(737296),M=t(793317),f=t(42651);const _=function(c,I,a){this.init(c,I,a)};_.NAME="action.InsertRest";const l=_.prototype;l.name=_.NAME,l.initMeasureData=M.default,l.init=function(c,I,a){(0,p.default)(c,I),(0,u.default)(c,I),(0,d.default)(c,I),(0,o.default)(c,I),this.initMeasureData(c,I),this.cancelStack=a,this.opts=I,this.sanitized=!1,this.location=null,(0,e.A)(this.measureData,I),(0,r.default)(this.measureData,I)},l.checkPreconditions=function(){this.checkValues(),this.sanitizeIfNeeded(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkSpace()},l.checkValues=function(){(0,O.default)(this.opts)},l.checkCompatibleVoiceStaffIdx=function(){(0,T.default)(this.measureData,this.opts)},l.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkSpace=function(){const c=(0,g.default)(this.opts);c.insertMode=P.default.INSERT,(0,D.A)(this.measureData,c)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();const c=this.getContextData();this.storeAction(c);const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new i.A(this.measureData,I,this.cancelStack).perform(),this.updateStack(c)},l.getContextData=function(){let I=this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx).getAbsoluteTimeModif();return I=A.default.copy(I),{timeModif:I}},l.sanitizeIfNeeded=function(){this.sanitized||(this.sanitized=!0)},l.storeAction=function(c){if(!this.cancelStack.hasAction()){const I=this.getLocation(),a=A.default.copy(c.timeModif),m={actionName:this.name,opts:{partUuid:I.partUuid,measureUuid:I.measureUuid,voiceUuid:I.voiceUuid,staffUuid:I.staffUuid,divisions:I.dpq,timePos:I.timePos,durationType:this.opts.durationType,nbDots:this.opts.nbDots,timeModif:a}};this.cancelStack.storeAction(m)}},l.updateStack=function(c){const I=this.getLocation(),a=A.default.copy(c.timeModif),m={type:this.name,noDraw:!0,opts:{partUuid:I.partUuid,measureUuid:I.measureUuid,voiceUuid:I.voiceUuid,timePos:I.timePos,divisions:I.dpq,timeModif:a,durationType:this.opts.durationType,nbDots:this.opts.nbDots}};this.cancelStack.push(m)},l.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),I=c.getPartUuid(this.opts.partIdx),a=c.getMeasureUuid(this.opts.measureIdx),m=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=c.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),s=this.measureData.getDpqValue(),v=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:I,measureUuid:a,voiceUuid:m,staffUuid:n,dpq:s,timePos:v}}return this.location},(0,f.default)(_);const E=_},515443:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(857552),A=t(153271),O=t(31278),T=t(110976),D=t(556595),p=t(407819),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.SetTempo";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){(0,p.default)(e,i),this.scoreData=e,this.cancelStack=P,this.opts=i,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.sanitize(),T.default.check(this.opts.tempo),this.checkDifferentTempo()},o.checkLocation=function(){const i=this.scoreData.getPartMeasures(0).length,P=this.opts.startMeasureIdx;let M=P;if(M<0||M>=i)throw new A.default(M,A.default.GET);const f=this.opts.stopMeasureIdx;if(f<P)throw new g.default(g.default.MEASURE,P,f);if(M=this.opts.stopMeasureIdx,M<0||M>=i)throw new A.default(M,A.default.GET)},o.sanitize=function(){typeof this.opts.tempo=="number"&&(this.opts.tempo=T.default.createWithDefaultDisplay(this.opts.tempo))},o.checkDifferentTempo=function(){if(!this.hasDifferentTempo())throw new O.default},o.hasDifferentTempo=function(){for(let e=this.opts.startMeasureIdx;e<=this.opts.stopMeasureIdx;e++){const i=this.scoreData.getRealTempo(e);if(!T.default.isSame(i,this.opts.tempo))return!0}return!1},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setTempo()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation().measureUuids.slice(),P={actionName:this.name,opts:{measureUuids:i,tempo:this.opts.tempo}};this.cancelStack.storeAction(P)}},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:e}}return this.location},o.setTempo=function(){const e={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,tempo:T.default.copy(this.opts.tempo)};new D.A(this.scoreData,e,this.cancelStack).perform()},(0,u.default)(d);const r=d},641656:(C,U,t)=>{t.r(U),t.d(U,{default:()=>P});var g=t(443749),A=t(31278),O=t(701387),T=t(668674),D=t(726042),p=t(52275),u=t(704621),d=t(783177),o=t(408143),r=t(42651);const e=function(M,f,_){this.init(M,f,_)};e.NAME="action.AddMeasureSlash";const i=e.prototype;i.name=e.NAME,i.init=function(M,f,_){(0,p.default)(M,f),(0,u.default)(M,f),(0,d.default)(M,f),this.scoreData=M,this.cancelStack=_,this.opts=f,this.localTimePos=null,this.location=null},i.checkPreconditions=function(){this.checkLocation(),this.checkAlready()},i.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const M=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),f=O.default.getNbStaves(M),_=this.opts.staffIdx;if(!D.default.isInteger(_)||_<0||_>=f)throw new g.default(this.opts.staffIdx)},i.checkAlready=function(){const M=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(O.default.hasSlash(M,this.opts.staffIdx)){const f=O.default.getSlash(M,this.opts.staffIdx);if(T.A.isUsingStems(f)===!!this.opts.isUsingStems)throw new A.default}},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addMeasureSlash(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const M=this.getLocation(),f={actionName:this.name,opts:{partUuid:M.partUuid,measureUuid:M.measureUuid,staffUuid:M.staffUuid,isUsingStems:this.opts.isUsingStems}};this.cancelStack.storeAction(f)}},i.addMeasureSlash=function(){const M={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,isUsingStems:this.opts.isUsingStems};new o.A(this.scoreData,M,this.cancelStack).perform()},i.updateStack=function(){const M=this.getLocation(),f={type:this.name,noDraw:!0,opts:{partUuid:M.partUuid,measureUuid:M.measureUuid,staffUuid:M.staffUuid}};this.cancelStack.push(f)},i.getLocation=function(){if(this.location===null){const M=this.scoreData.getPartUuid(this.opts.partIdx),f=this.scoreData.getMeasureUuid(this.opts.measureIdx),_=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:M,measureUuid:f,staffUuid:_}}return this.location},(0,r.default)(e);const P=e},658714:(C,U,t)=>{t.r(U),t.d(U,{default:()=>d});var g=t(153271),A=t(719476),O=t(501167),T=t(704621),D=t(42651);const p=function(o,r,e){this.init(o,r,e)};p.NAME="action.AddEnding";const u=p.prototype;u.name=p.NAME,u.init=function(o,r,e){this.scoreData=o,this.cancelStack=e,this.opts=r,(0,T.default)(o,r),this.location=null},u.checkPreconditions=function(){this.checkLocation(),A.A.checkNumbers(this.opts.numbers)},u.checkLocation=function(){const o=this.scoreData.getNbMeasures(),r=this.opts.measureIdx;if(r<0||r>=o)throw new g.default(r,g.default.GET)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addEnding(),this.updateStack()},u.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),r=this.opts.numbers.slice(),e={actionName:this.name,opts:{measureUuid:o.measureUuid,numbers:r}};this.cancelStack.storeAction(e)}},u.addEnding=function(){const o=this.opts.numbers.slice(),r={measureIdx:this.opts.measureIdx,numbers:o};new O.A(this.scoreData,r,this.cancelStack).perform()},u.updateStack=function(){const o=this.getLocation(),r=this.opts.numbers.slice(),e={type:this.name,noDraw:!0,opts:{measureUuid:o.measureUuid,numbers:r}};this.cancelStack.push(e)},u.getLocation=function(){if(this.location===null){const o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:o}}return this.location},(0,D.default)(p);const d=p},676081:(C,U,t)=>{t.r(U),t.d(U,{default:()=>m});var g=t(702544),A=t(916502),O=t(195446),T=t(31278),D=t(446921),p=t(701387),u=t(377180),d=t(856219),o=t(226804),r=t(383279),e=t(721247),i=t(476943),P=t(104907),M=t(857579),f=t(52275),_=t(485594),l=t(329578),E=t(988878),c=t(42651);const I=function(n,s,h){this.init(n,s,h)};I.NAME="action.ChangeInstrument";const a=I.prototype;a.name=I.NAME,a.init=function(n,s,h){this.scoreData=n,this.cancelStack=h,this.opts=s,(0,f.default)(this.scoreData,this.opts),this.transposeActions=null,this.setClefActions=null,this.setStaffDetailsActions=null,this.sanitized=!1},a.checkPreconditions=function(){const n=this.scoreData.getNbParts(),s=this.opts.partIdx;if(s<0||s>=n)throw new g.default(s,g.default.GET);if(this.checkPitchedPart(),this.sanitizeIfNeeded(),typeof this.opts.instrumentName!="string")throw new A.default("instrumentName");d.default.checkMIDIProgram(this.opts.MIDIProgram),typeof this.opts.transpose!="undefined"?u.default.check(this.opts.transpose):this.opts.transpose=u.default.createDefault(),this.checkTransposes(),this.checkClefs(),this.checkSetClefs(),this.getNbStaves()===1&&this.checkStaffDetails()},a.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new O.default},a.checkTransposes=function(){this.getTransposeActions().forEach(function(s){try{s.action.checkPreconditions(),s.error=null}catch(h){if(s.error=h,!(h instanceof T.default))throw h}})},a.checkStaffDetails=function(){this.getSetStaffDetailsActions().forEach(function(s){s.checkPreconditions()})},a.checkClefs=function(){if(!i.default.isArray(this.opts.clefs))throw new A.default("clefs");this.opts.clefs.forEach(e.default.check)},a.checkSetClefs=function(){this.getSetClefActions().forEach(function(s){s.checkPreconditions()})},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();const n=this.getPreviousData();this.opts.noTranspose||this.transpose(),this.updateInstrument(),this.updateTranspose(),this.setClef(),this.getNbStaves()===1&&this.updateStaffDetails(),this.updateStack(n)},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.clefs=="undefined"&&(this.opts.clefs=[]),i.default.isArray(this.opts.staffDetails)||(this.opts.staffDetails=[P.default.createDefault()]),this.sanitized=!0)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.scoreData.getPartUuid(this.opts.partIdx),s=u.default.copy(this.opts.transpose),h=this.opts.clefs.map(e.default.copy),v=this.opts.staffDetails.map(P.default.copy),S={actionName:this.name,opts:{partUuid:n,MIDIProgram:this.opts.MIDIProgram,partName:this.opts.partName,abbreviation:this.opts.abbreviation||null,transpose:s,instrumentName:this.opts.instrumentName,noTranspose:!!this.opts.noTranspose,keepTuningIfSameNbStrings:this.opts.keepTuningIfSameNbStrings,clefs:h,staffDetails:v}};this.cancelStack.storeAction(S)}},a.getPreviousData=function(){const n=this.scoreData.getPartHeader(this.opts.partIdx),s={};s.partName=r.default.getName(n),r.default.hasAbbreviation(n)&&(s.abbreviation=r.default.getAbbreviation(n));const h=r.default.getScoreInstruments(n)[0];s.instrumentName=o.default.getName(h);const v=r.default.getMIDIInstruments(n)[0];s.MIDIProgram=d.default.getMIDIProgram(v);const S=this.scoreData.getMeasure(this.opts.partIdx,0),L=new M.A(S).getTranspose(0);return s.transpose=u.default.copy(L),s},a.getStaffDetailsInMeasure=function(n,s){return p.default.getWrappedStaffDetails(n).getEntry(s)},a.hasMeasuresDifferentStaffDetails=function(n,s){return n.some(function(h){const v=this.getStaffDetailsInMeasure(h,s),S=this.opts.staffDetails,x=S.length<=s?S[S.length-1]:S[s];return!P.default.isSame(v,x)},this)},a.hasSameNbStrings=function(n){const s=n[0],h=this.getStaffDetailsInMeasure(s,0),v=this.opts.staffDetails[0],S=P.default.getStaffTunings(h),x=P.default.getStaffTunings(v);return S&&x&&S.length===x.length},a.getNbStaves=function(){const n=this.scoreData.getPartContent(this.opts.partIdx);return D.A.getNbStaves(n)},a.getSetStaffDetailsActions=function(){return this.setStaffDetailsActions===null&&this.initSetStaffDetailsActions(),this.setStaffDetailsActions},a.initSetStaffDetailsActions=function(){const s=this.scoreData.getPartByIdx(this.opts.partIdx).measure,h=this.getNbStaves(),v=this.opts.staffDetails;if(this.setStaffDetailsActions=[],v.length>0){for(let S=0;S<h;S++)if(!(this.opts.keepTuningIfSameNbStrings&&S===0&&this.hasSameNbStrings(s))&&this.hasMeasuresDifferentStaffDetails(s,S)){const x={partIdx:this.opts.partIdx,staffIdx:S,staffDetails:v.length<=S?v[v.length-1]:v[S]},L=new E.default(this.scoreData,x,this.cancelStack);this.setStaffDetailsActions.push(L)}}},a.getTransposeActions=function(){return this.transposeActions===null&&this.initTransposeActions(),this.transposeActions},a.initTransposeActions=function(){this.transposeActions=[];const n=this.getNbStaves();for(let s=0;s<n;s++)this.initTransposeAction(s)},a.initTransposeAction=function(n){const s=this.getRelativeTranspose(),h=this.getNbMeasures(),v=this.scoreData.getMeasure(this.opts.partIdx,h-1),S=p.default.getDpq(v),x=p.default.getNbDivisions(v),L={partIdx:this.opts.partIdx,staffIdx:n,startMeasureIdx:0,startTimePos:0,startDpq:1,stopMeasureIdx:h-1,stopTimePos:x,stopDpq:S,transpose:u.default.copy(s),updateKeys:!0,checkLine:!1,updateHarmonies:!0,preserveTies:!0,preserveColor:!0,updateGraces:!0},B={action:new _.default(this.scoreData,L,this.cancelStack),error:null};this.transposeActions.push(B)},a.getSetClefActions=function(){return this.setClefActions===null&&this.initSetClefActions(),this.setClefActions},a.initSetClefActions=function(){const n=this.scoreData.getPartContent(this.opts.partIdx),s=D.A.getNbStaves(n),h=D.A.getMeasures(n),v=this.getNbMeasures(),S=this.opts.clefs;if(this.setClefActions=[],S.length>0){for(let x=0;x<s;x++)if(this.hasMeasuresDifferentClefs(h,x)){const L={partIdx:this.opts.partIdx,startMeasureIdx:0,stopMeasureIdx:v-1,staffIdx:x,clef:S.length<=x?S[S.length-1]:S[x]},R=new l.default(this.scoreData,L,this.cancelStack);this.setClefActions.push(R)}}},a.getRelativeTranspose=function(){const n=this.scoreData.getMeasure(this.opts.partIdx,0),h=p.default.getWrappedTranspose(n).getAnyEntry(),v=u.default.getDiff(this.opts.transpose,h);return u.default.getReverse(v)},a.getVoicesIndexes=function(){return this.scoreData.getPartVoicesIndexes(this.opts.partIdx)},a.getNbMeasures=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure.length},a.transpose=function(){this.getTransposeActions().forEach(function(s){s.error===null&&(s.action.cancelStack=this.cancelStack,s.action.perform())},this)},a.setClef=function(){this.getSetClefActions().forEach(function(s){s.cancelStack=this.cancelStack,s.perform()},this)},a.updateInstrument=function(){const s=this.scoreData.getPartsHeaders()[this.opts.partIdx];let h;typeof this.opts.partName!="undefined"?h=this.opts.partName:h=this.opts.instrumentName,r.default.setName(s,h),typeof this.opts.abbreviation!="undefined"&&this.opts.abbreviation!==null?r.default.setAbbreviation(s,this.opts.abbreviation):r.default.removeAbbreviation(s);const v=o.default.create(this.opts.instrumentName),[S]=r.default.getMIDIInstruments(s),x={};if(d.default.hasVolume(S)){const L=d.default.getVolume(S);d.default.setVolume(x,L)}if(d.default.hasReverberation(S)){const L=d.default.getReverberation(S);d.default.setReverberation(x,L)}d.default.setMIDIProgram(x,this.opts.MIDIProgram),r.default.setInstrument(s,v,x),r.default.initInstrumentsIds(s),r.default.removeSoundInferenceStatus(s)},a.updateTranspose=function(){const s=this.scoreData.getPartContent(this.opts.partIdx).measure,h=s[0];this.updateFirstMeasureTranspose(h),s.slice(1).forEach(this.updateOtherMeasureTranspose,this)},a.hasMeasuresDifferentClefs=function(n,s){return n.some(function(h){const v=this.getClefInMeasure(h,s),S=this.opts.clefs,x=S.length<=s?S[S.length-1]:S[s];return!e.default.isSame(v,x)},this)},a.getClefInMeasure=function(n,s){return p.default.getWrappedClef(n).getEntry(s)},a.updateFirstMeasureTranspose=function(n){const s=p.default.getNbStaves(n),h=p.default.getWrappedOwnTranspose(n);for(let S=0;S<s;S++)h.setEntry(u.default.copy(this.opts.transpose),S);const v=h.dumpAttribute();p.default.setOwnTranspose(n,v),this.updateOtherMeasureTranspose(n)},a.updateOtherMeasureTranspose=function(n){const s=p.default.getNbStaves(n),h=p.default.getWrappedTranspose(n);for(let S=0;S<s;S++)h.setEntry(u.default.copy(this.opts.transpose),S);const v=h.dumpAttribute();p.default.setTranspose(n,v)},a.updateStaffDetails=function(){this.getSetStaffDetailsActions().forEach(function(s){s.cancelStack=this.cancelStack,s.perform()},this)},a.updateStack=function(n){const s=this.scoreData.getPartUuid(this.opts.partIdx),h={type:this.name,noDraw:!0,opts:{partUuid:s,instrumentName:n.instrumentName,MIDIProgram:n.MIDIProgram,partName:n.partName,abbreviation:n.abbreviation||null,transpose:u.default.copy(n.transpose),keepTuningIfSameNbStrings:this.opts.keepTuningIfSameNbStrings}};this.cancelStack.push(h),this.cancelStack.stateNeedCompleteRedraw()},(0,c.default)(I);const m=I},679241:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(704621),A=t(153271),O=t(687565),T=t(31278),D=t(250769),p=t(714742),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.AddSystemBreak";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){(0,g.default)(e,i),this.scoreData=e,this.opts=i,this.cancelStack=P,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkValue(),this.checkOverlap()},o.checkLocation=function(){const e=this.scoreData.getNbMeasures(),i=this.opts.measureIdx;if(i<0||i>=e)throw new A.default(i,A.default.GET)},o.checkValue=function(){D.A.check(this.opts.value,O.A)},o.checkOverlap=function(){const e=this.getCommonContent();if(e.hasSystemBreak(this.opts.measureIdx)){const i=e.getSystemBreak(this.opts.measureIdx);if(this.opts.value===i)throw new T.default}},o.getCommonContent=function(){return this.scoreData.getCommonContent()},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e={measureIdx:this.opts.measureIdx,value:this.opts.value};new p.A(this.scoreData,e,this.cancelStack).perform(),this.updateStack()},o.updateStack=function(){const e=this.getLocation(),i={type:this.name,noDraw:!0,opts:{measureUuid:e.measureUuid,measureIdx:this.opts.measureIdx,value:this.opts.value}};this.cancelStack.push(i)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{measureUuid:e.measureUuid,measureIdx:this.opts.measureIdx,value:this.opts.value}};this.cancelStack.storeAction(i)}},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:e}}return this.location},(0,u.default)(d);const r=d},699640:(C,U,t)=>{t.r(U),t.d(U,{default:()=>p});var g=t(31278),A=t(470118),O=t(42651);const T=function(u,d,o){this.init(u,d,o)};T.NAME="action.SetTempoMarkVisibility";const D=T.prototype;D.name=T.NAME,D.init=function(u,d,o){this.scoreData=u,this.cancelStack=o,this.opts=d},D.checkPreconditions=function(){if(typeof this.opts.value!="boolean")throw new A.A(this.opts.value);const u=this.scoreData.isTempoMarkVisible();if(this.opts.value===u)throw new g.default},D.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const u=this.getPreviousData();this.setTempoMarkVisibility(),this.updateStack(u)},D.storeAction=function(){if(!this.cancelStack.hasAction()){const u={actionName:this.name,opts:{value:this.opts.value}};this.cancelStack.storeAction(u)}},D.getPreviousData=function(){return{value:this.scoreData.isTempoMarkVisible()}},D.setTempoMarkVisibility=function(){this.scoreData.setTempoMarkVisibility(this.opts.value)},D.updateStack=function(u){const d={type:this.name,noDraw:!0,opts:{previousValue:u.value}};this.cancelStack.push(d),this.cancelStack.stateNeedCompleteRedraw()},(0,O.default)(T);const p=T},713860:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(153271),A=t(31278),O=t(274486),T=t(726042),D=t(22178),p=t(704621),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.AddMultiMeasureRest";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){this.scoreData=e,this.cancelStack=P,this.opts=i,(0,p.default)(this.scoreData,i),this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checknbMeasures(),this.checkNoChange()},o.checkLocation=function(){const e=this.scoreData.getNbMeasures(),i=this.opts.measureIdx;if(!T.default.isInteger(i)||i<0||i>=e)throw new g.default(i,g.default.GET)},o.checknbMeasures=function(){O.A.checkNbMeasures(this.opts.nbMeasures)},o.checkNoChange=function(){const e=this.scoreData.getCommonContent();if(!e.hasMultiMeasureRest(this.opts.measureIdx))return;if(e.getMultiMeasureRest(this.opts.measureIdx)===this.opts.nbMeasures)throw new A.default},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addMmr(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{measureUuid:e.measureUuid,nbMeasures:this.opts.nbMeasures}};this.cancelStack.storeAction(i)}},o.addMmr=function(){const e={measureIdx:this.opts.measureIdx,nbMeasures:this.opts.nbMeasures};new D.A(this.scoreData,e,this.cancelStack).perform()},o.updateStack=function(){const e=this.getLocation(),i={type:this.name,noDraw:!0,opts:{measureUuid:e.measureUuid}};this.cancelStack.push(i)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:e}}return this.location},(0,u.default)(d);const r=d},731829:(C,U,t)=>{t.r(U),t.d(U,{default:()=>M});var g=t(153271),A=t(31278),O=t(555172),T=t(701387),D=t(350357),p=t(342762),u=t(556055),d=t(704621),o=t(519405),r=t(42651);const e=function(f,_,l){this.init(f,_,l)};e.NAME="action.AddDoubleBarline";const i=e.prototype;i.name=e.NAME,i.init=function(f,_,l){(0,d.default)(f,_),this.scoreData=f,this.cancelStack=l,this.opts=_,this.location=null},i.checkPreconditions=function(){this.checkLocation(),this.checkAlready()},i.checkLocation=function(){const f=this.opts.measureIdx,_=this.scoreData.getNbMeasures();if(f<0||f>=_)throw new g.default(f)},i.checkAlready=function(){const f=this.getAnyMeasure();if(!T.default.hasRightBarline(f))return;const _=T.default.getRightBarline(f);if(O.A.getStyle(_)===O.A.DOUBLE_LIGHT){const E="There is already a double barline in this measure.";throw new A.default(E)}},i.getAnyMeasure=function(){return this.scoreData.getMeasure(0,this.opts.measureIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFormerBarline(),this.addBarline(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),_={actionName:this.name,opts:{measureUuid:f.measureUuid}};this.cancelStack.storeAction(_)}},i.removeFormerBarline=function(){const f={measureIdx:this.opts.measureIdx,side:D.A.RIGHT},_=new u.default(this.scoreData,f,this.cancelStack);(0,o.default)(_,P)};const P=function(f){return f instanceof A.default};i.addBarline=function(){const f={measureIdx:this.opts.measureIdx,side:D.A.RIGHT,style:O.A.DOUBLE_LIGHT};new p.A(this.scoreData,f,this.cancelStack).perform()},i.updateStack=function(){const f=this.getLocation(),_={type:this.name,noDraw:!0,opts:{measureUuid:f.measureUuid}};this.cancelStack.push(_)},i.getLocation=function(){if(this.location===null){const f=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:f}}return this.location},(0,r.default)(e);const M=e},788222:(C,U,t)=>{t.r(U),t.d(U,{default:()=>d});var g=t(31278),A=t(702544),O=t(713360),T=t(641239),D=t(42651);const p=function(o,r,e){this.init(o,r,e)};p.NAME="action.MovePart";const u=p.prototype;u.name=p.NAME,u.init=function(o,r,e){this.scoreData=o,this.cancelStack=e,this.opts=r,(typeof r.previousUuid!="undefined"||typeof r.nextUuid!="undefined")&&(r.toPartIdx=(0,T.default)(o,r.previousUuid,r.nextUuid)),typeof r.fromPartUuid!="undefined"&&(r.fromPartIdx=(0,O.A)(o.getPartsHeaders(),r.fromPartUuid))},u.checkPreconditions=function(){const o=this.scoreData.getNbParts(),r=this.opts.fromPartIdx;if(r<0||r>=o)throw new A.default(r,A.default.GET);const e=this.opts.toPartIdx;if(e<0||e>o)throw new A.default(e,A.default.INSERT);if(e===r||e===r+1)throw new g.default},u.perform=function(){const o=this.getFromUuid(),r=this.getUuidsAround(o);this.scoreData.movePart(this.opts.fromPartIdx,this.opts.toPartIdx),this.updateStack(o,r);const e=this.getUuidsAround(o);this.storeAction(o,e)},u.getFromUuid=function(){return this.scoreData.getPartUuid(this.opts.fromPartIdx)},u.getUuidsAround=function(o){const r=(0,O.A)(this.scoreData.getPartsHeaders(),o);let e;r===0?e=null:e=this.scoreData.getPartUuid(r-1);const i=this.scoreData.getNbParts();let P;return r===i-1?P=null:P=this.scoreData.getPartUuid(r+1),{previousUuid:e,nextUuid:P}},u.updateStack=function(o,r){this.cancelStack=this.cancelStack.createSubstack(this.name);const e={type:this.name,opts:{fromPartUuid:o,previousUuid:r.previousUuid,nextUuid:r.nextUuid}};this.cancelStack.push(e),this.cancelStack.stateNeedCompleteRedraw()},u.storeAction=function(o,r){if(!this.cancelStack.hasAction()){const e={actionName:this.name,opts:{fromPartUuid:o,previousUuid:r.previousUuid,nextUuid:r.nextUuid}};this.cancelStack.storeAction(e)}},(0,D.default)(p);const d=p},801534:(C,U,t)=>{t.r(U),t.d(U,{default:()=>I});var g=t(436369),A=t(153271),O=t(513488),T=t(988756),D=t(31278),p=t(364842),u=t(555172),d=t(269032),o=t(701387),r=t(556055),e=t(42651),i=t(918926),P=t(244378),M=t(350357),f=t(704621),_=t(519405);const l=function(a,m,n){this.init(a,m,n)};l.NAME="action.AddRepeat";const E=l.prototype;E.name=l.NAME,E.init=function(a,m,n){(0,f.default)(a,m),this.scoreData=a,this.cancelStack=n,this.opts=m,this.location=null},E.checkPreconditions=function(){this.checkLocation(),this.checkType()},E.checkLocation=function(){const a=this.opts.measureIdx,m=this.scoreData.getNbMeasures();if(a<0||a>=m)throw new A.default(a)},E.checkType=function(){if(!d.A.isValidDirection(this.opts.direction))throw new O.A(this.opts.direction);if(this.opts.direction===d.A.DIRECTION_BACKWARD){const a=this.opts.times;if(typeof a!="number")this.opts.times=d.A.DEFAULT_NB_REPEAT;else if(!d.A.isValidTimes(a+1))throw new T.A(a)}},E.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFormerBarline(),this.shouldClearBarline()&&this.clearBarline(),this.addRepeat(),this.updateStack()},E.storeAction=function(){if(!this.cancelStack.hasAction()){const m={measureUuid:this.getLocation().measureUuid,direction:this.opts.direction};m.direction===P.A.BACKWARD&&(m.times=this.opts.times);const n={actionName:this.name,opts:m};this.cancelStack.storeAction(n)}},E.removeFormerBarline=function(){const a=this.getSide(),m={measureIdx:this.opts.measureIdx,side:a},n=new r.default(this.scoreData,m,this.cancelStack);(0,_.default)(n,c)};const c=function(a){return a instanceof D.default};E.shouldClearBarline=function(){const m=this.scoreData.getMeasure(0,this.opts.measureIdx);return this.opts.direction===P.A.BACKWARD&&o.default.hasRightBarline(m)||this.opts.direction===P.A.FORWARD&&o.default.hasLeftBarline(m)},E.clearBarline=function(){const a=this.getSide(),m={measureIdx:this.opts.measureIdx,side:a};new i.A(this.scoreData,m,this.cancelStack).perform()},E.getSide=function(){if(this.opts.direction===P.A.BACKWARD)return M.A.RIGHT;if(this.opts.direction===P.A.FORWARD)return M.A.LEFT;throw new p.default("Unexpected")},E.addRepeat=function(){const a=this.scoreData.getNbParts();for(let m=0;m<a;m++){const n=this.scoreData.getMeasure(m,this.opts.measureIdx);let s;if(this.opts.direction===P.A.BACKWARD){const h=d.A.nbRepeatToNbPlay(this.opts.times);s=u.A.createBackwardRepeat(h)}else s=u.A.createForwardRepeat();o.default.addBarline(n,s),this.updateStackRedraw(m)}},E.updateStackRedraw=function(a){const m={type:`${this.name}-subPart`,opts:{partIdx:a,measureIdx:this.opts.measureIdx,direction:this.opts.direction}};this.cancelStack.push(m),(0,g.A)(this.cancelStack,this.scoreData,this.opts)},E.updateStack=function(){const a=this.getLocation(),m={type:this.name,noDraw:!0,opts:{measureUuid:a.measureUuid,direction:this.opts.direction}};this.cancelStack.push(m)},E.getLocation=function(){if(this.location===null){const a=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:a}}return this.location},(0,e.default)(l);const I=l},825341:(C,U,t)=>{t.r(U),t.d(U,{default:()=>O});var g=t(42651);class A{constructor(D,p,u){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:A.NAME}),Object.defineProperty(this,"cancelStack",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cancelStack=u}checkPreconditions(){}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.updateStack()}storeAction(){if(!this.cancelStack.hasAction()){const D={actionName:this.name,opts:{}};this.cancelStack.storeAction(D)}}updateStack(){const D={type:this.name,noDraw:!0,opts:{}};this.cancelStack.push(D),this.cancelStack.stateNeedCompleteRedraw()}}Object.defineProperty(A,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"action.DebugFullRedraw"});const O=A;(0,g.default)(A)},828864:(C,U,t)=>{t.r(U),t.d(U,{default:()=>u});var g=t(916502),A=t(383279),O=t(52275),T=t(42651);const D=function(d,o,r){this.init(d,o,r)};D.NAME="action.ChangePartName";const p=D.prototype;p.name=D.NAME,p.init=function(d,o,r){this.scoreData=d,this.cancelStack=r,this.opts=o,(0,O.default)(this.scoreData,this.opts)},p.checkPreconditions=function(){if(this.scoreData.checkPartIdx(this.opts.partIdx),typeof this.opts.partName!="string")throw new g.default("partName");if(typeof this.opts.partAbbreviation!="string"&&this.opts.partAbbreviation!==null)throw new g.default("partAbbreviation")},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const d=this.getPreviousData();this.storeAction(),this.changePartName(),this.updateStack(d)},p.getPreviousData=function(){const d=this.scoreData.getPartHeader(this.opts.partIdx),o={};return o.partName=A.default.getName(d),A.default.hasAbbreviation(d)?o.abbreviation=A.default.getAbbreviation(d):o.abbreviation=null,o},p.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.scoreData.getPartUuid(this.opts.partIdx),o={actionName:this.name,opts:{partUuid:d,partName:this.opts.partName,partAbbreviation:this.opts.partAbbreviation}};this.cancelStack.storeAction(o)}},p.changePartName=function(){const d=this.scoreData.getPartHeader(this.opts.partIdx);A.default.setName(d,this.opts.partName),this.opts.partAbbreviation!==null?A.default.setAbbreviation(d,this.opts.partAbbreviation):A.default.removeAbbreviation(d)},p.updateStack=function(d){const r={partUuid:this.scoreData.getPartUuid(this.opts.partIdx),previousName:d.partName,previousAbbreviation:d.abbreviation},e={type:this.name,opts:r};this.cancelStack.push(e),this.cancelStack.stateNeedCompleteRedraw()},(0,T.default)(D);const u=D},833563:(C,U,t)=>{t.r(U),t.d(U,{default:()=>_});var g=t(343818),A=t(883782),O=t(31278),T=t(52275),D=t(704621),p=t(898039),u=t(981801),d=t(328225),o=t(2110),r=t(42651),e=t(739293),i=t(123491),P=t(712947),M=t(435808);class f{constructor(E,c,I){this.name=f.NAME,(0,T.default)(E,c),(0,D.default)(E,c),(0,u.default)(E,c),this.measuresScroller=(0,o.A)(E,c),this.cancelStack=I,this.opts=c,this.sideData=null,this.location=null,this.previousPlacement=null}checkPreconditions(){this.checkLocation(),this.checkIsInSlur(),M.A.check(this.opts.placement),this.checkHasSamePlacement()}checkLocation(){if(this.measuresScroller.checkMeasureIdx(this.opts.measureIdx),!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new A.default(this.opts.voiceIdx);const c=this.measuresScroller.getMeasureData(this.opts.measureIdx);c.hasVoice(this.opts.voiceIdx)&&((0,p.default)(c,this.opts),c.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx))}checkIsInSlur(){if(this.getSideData()===null)throw new g.A}checkHasSamePlacement(){if(this.getPreviousPlacement()===this.opts.placement)throw new O.default}perform(){this.getPreviousPlacement(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const E=this.measuresScroller.getMeasureData(this.opts.measureIdx);new d.A(E,this.opts,this.cancelStack).perform(),this.updateStack()}storeAction(){if(!this.cancelStack.hasAction()){const E=this.getLocation(),c={actionName:this.name,opts:{partUuid:E.partUuid,measureUuid:E.measureUuid,divisions:E.dpq,timePos:E.timePos,voiceUuid:E.voiceUuid,placement:this.opts.placement}};this.cancelStack.storeAction(c)}}updateStack(){const E=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:E.partUuid,voiceUuid:E.voiceUuid,measureUuid:E.measureUuid,timePos:E.timePos,divisions:E.dpq,previousPlacement:this.previousPlacement}};this.cancelStack.push(c)}getSideData(){return this.sideData?this.sideData:(this.sideData=(0,e.A)(this.measuresScroller,this.opts),this.sideData)}getPreviousPlacement(){if(this.previousPlacement)return this.previousPlacement;const E=this.getSideData(),a=this.measuresScroller.getMeasureData(E.measureIdx).getVoice(this.opts.voiceIdx).getNote(E.noteIdx),m=i.default.getSlur(a);return this.previousPlacement=P.default.getPlacement(m),this.previousPlacement}getLocation(){if(this.location===null){const E=this.measuresScroller.getScoreData(),c=E.getPartUuid(this.opts.partIdx),I=E.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),a=this.getSideData(),m=E.getMeasureUuid(a.measureIdx),n=this.measuresScroller.getMeasureData(a.measureIdx),s=n.getDpqValue(),v=n.getVoice(this.opts.voiceIdx).getRangeSpace(0,a.noteIdx);this.location={partUuid:c,voiceUuid:I,measureUuid:m,dpq:s,timePos:v}}return this.location}}Object.defineProperty(f,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"action.SetSlurPlacement"}),(0,r.default)(f);const _=f},855874:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(702544),A=t(31278),O=t(52275),T=t(156441),D=t(726042),p=t(383279),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.SetPartGlobalVolume";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){(0,O.default)(e,i),this.scoreData=e,this.cancelStack=P,this.opts=i,this.location=null},o.checkPreconditions=function(){this.checkLocation(),T.default.check(this.opts.volume);const e=this.getCurrentVolume();if(this.opts.volume===e)throw new A.default},o.checkLocation=function(){const e=this.opts.partIdx,i=this.scoreData.getNbParts();if(!D.default.isInteger(e)||e<0||e>=i)throw new g.default(e)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.setVolume(),this.updateStack(e)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{partUuid:e.partUuid,volume:this.opts.volume}};this.cancelStack.storeAction(i)}},o.getPreviousData=function(){return{volume:this.getCurrentVolume()}},o.getCurrentVolume=function(){const e=this.scoreData.getPartHeader(this.opts.partIdx);return p.default.getGlobalVolume(e)},o.setVolume=function(){const e=this.scoreData.getPartHeader(this.opts.partIdx);p.default.setGlobalVolume(e,this.opts.volume)},o.updateStack=function(e){const i=this.getLocation(),P={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,previousVolume:e.volume}};this.cancelStack.push(P)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:e}}return this.location},(0,u.default)(d);const r=d},860418:(C,U,t)=>{t.r(U),t.d(U,{default:()=>n});var g=t(31278),A=t(195446),O=t(160814),T=t(476943),D=t(737903),p=t(123491),u=t(351277),d=t(967104),o=t(604088),r=t(52275),e=t(704621),i=t(981801),P=t(783177),M=t(898039),f=t(287296),_=t(793317),l=t(575349),E=t(42651),c=t(694426),I=t(458057);const a=function(s,h,v){this.init(s,h,v)};a.NAME="action.AddBend",a.isNoChange=function(s){return s instanceof g.default};const m=a.prototype;m.name=a.NAME,m.initMeasureData=_.default,m.init=function(s,h,v){(0,r.default)(s,h),(0,e.default)(s,h),(0,i.default)(s,h),(0,P.default)(s,h),this.initMeasureData(s,h),this.cancelStack=v,this.opts=h,this.noteHead=null,this.voice=null,this.location=null},m.checkPreconditions=function(){u.default.check(this.opts.pitch),c.A.checkNotPreBend(this.opts.type),I.A.check(this.opts.alter,this.opts.type),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,M.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitchFret(),this.checkDifferentBend()},m.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new A.default},m.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},m.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},m.sanitizeIfNeeded=function(){this.opts.isConcertPitch&&(0,f.default)(this.measureData,this.opts)},m.checkNoteAtPitchFret=function(){if(typeof this.getNoteAtPitchFret()=="undefined"){const h=u.default.copy(this.opts.pitch),v=(0,D.default)(this.opts.fretData);throw new O.A(h,v)}},m.checkDifferentBend=function(){const s=this.getNoteAtPitchFret();if(!p.default.hasBend(s))return;const h=p.default.getBend(s),v=d.A.getType(h),S=d.A.getAlter(h);if(v===this.opts.type&&S===this.opts.alter)throw new g.default},m.getNoteAtPitchFret=function(){if(this.noteHead===null){let h=this.getVoice().getChord(this.opts.noteIdx);h=T.default.makeArray(h),this.noteHead=h.find(l.A,this.opts)}return this.noteHead},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addBend(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),h={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,pitch:u.default.copyWithoutAlter(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData),type:this.opts.type,alter:this.opts.alter,isConcertPitch:!1},v={actionName:this.name,opts:h};this.cancelStack.storeAction(v)}},m.addBend=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:u.default.copy(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData),type:this.opts.type,alter:this.opts.alter};new o.A(this.measureData,s,this.cancelStack).perform()},m.updateStack=function(){const s=this.getLocation(),h={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,pitch:u.default.copyWithoutAlter(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData)},v={type:this.name,noDraw:!0,opts:h};this.cancelStack.push(v)},m.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),h=s.getPartUuid(this.opts.partIdx),v=s.getMeasureUuid(this.opts.measureIdx),S=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),x=this.measureData.getDpqValue(),R=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:h,measureUuid:v,voiceUuid:S,dpq:x,timePos:R}}return this.location},m.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,E.default)(a);const n=a},891357:(C,U,t)=>{t.r(U),t.d(U,{default:()=>E});var g=t(52275),A=t(704621),O=t(981801),T=t(898039),D=t(793317),p=t(578918),u=t(195446),d=t(748803),o=t(926089),r=t(582711),e=t(351277),i=t(123491),P=t(129283),M=t(867346),f=t(42651);const _=function(c,I,a){this.init(c,I,a)};_.NAME="action.RemoveGlissandoSide";const l=_.prototype;l.name=_.NAME,l.initMeasureData=D.default,l.init=function(c,I,a){(0,g.default)(c,I),(0,A.default)(c,I),(0,O.default)(c,I),this.initMeasureData(c,I),this.opts=I,this.cancelStack=a,this.noteAtPitch=null,this.location=null,this.sanitized=!1,(0,T.default)(this.measureData,I)},l.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkPitch(),this.checkNoteAtPitch(),this.sanitizeIfNeeded(),this.checkGlissandoType(),this.checkNumber(),this.checkExistence()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new u.default},l.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},l.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},l.checkPitch=function(){e.default.check(this.opts.pitch)},l.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const I=e.default.copy(this.opts.pitch);throw new d.default(d.default.GET,I)}},l.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.number=="undefined"&&(this.opts.number=1),this.sanitized=!0)},l.checkGlissandoType=function(){P.default.check(this.opts.glissandoType)},l.checkNumber=function(){if(typeof this.opts.number!="number"||this.opts.number<0)throw new r.A(this.opts.number)},l.checkExistence=function(){const c=this.getNoteAtPitch();if(!i.default.hasGlissando(c,this.opts.glissandoType,this.opts.number))throw new o.A},l.getNoteAtPitch=function(){if(this.noteAtPitch===null){const c=this.getVoice();this.noteAtPitch=(0,p.default)(c,this.opts.noteIdx,this.opts.pitch)}return this.noteAtPitch},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number};new M.A(this.measureData,c,this.cancelStack).perform(),this.updateStack()},l.updateStack=function(){const c=this.getLocation(),I={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,timePos:c.timePos,divisions:c.dpq,pitch:e.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(I)},l.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),I={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,timePos:c.timePos,divisions:c.dpq,pitch:e.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.storeAction(I)}},l.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),I=c.getPartUuid(this.opts.partIdx),a=c.getMeasureUuid(this.opts.measureIdx),m=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),h=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:I,measureUuid:a,voiceUuid:m,dpq:n,timePos:h}}return this.location},(0,f.default)(_);const E=_},907574:(C,U,t)=>{t.r(U),t.d(U,{default:()=>P});var g=t(646456),A=t(726042),O=t(701387),T=t(737903),D=t(604021),p=t(316610),u=t(52275),d=t(704621),o=t(42651),r=t(589501);const e=function(M,f,_){this.init(M,f,_)};e.NAME="action.AddFiguredBassAtTimePos";const i=e.prototype;i.name=e.NAME,i.init=function(M,f,_){(0,u.default)(M,f),(0,d.default)(M,f),this.scoreData=M,this.cancelStack=_,this.opts=f,this.sanitized=!1,this.localTimePos=null,this.measure=null,this.location=null},i.checkPreconditions=function(){this.checkValue(),this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos()},i.checkValue=function(){r.A.checkFiguresData(this.opts.figuresData)},i.checkTimePos=function(){const M=this.getLocalTimePos(),f=this.getMeasure(),_=O.default.getNbDivisions(f);if(!A.default.isNumber(M)||M<0||M>=_){const l=O.default.getDpq(f);throw new g.A(M,l)}},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addFiguredBass(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const M=this.getLocation(),f=(0,T.default)(this.opts.figuresData),_={actionName:this.name,opts:{partUuid:M.partUuid,measureUuid:M.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos,figuresData:f}};this.cancelStack.storeAction(_)}},i.addFiguredBass=function(){const M=(0,T.default)(this.opts.figuresData),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,figuresData:M};new D.A(this.scoreData,f,this.cancelStack).perform()},i.getLocalTimePos=function(){if(this.localTimePos===null){const M=this.getMeasure();this.localTimePos=(0,p.A)(this.opts,M)}return this.localTimePos},i.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},i.updateStack=function(){const M=this.getLocation(),f={type:this.name,noDraw:!0,opts:{partUuid:M.partUuid,measureUuid:M.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(f)},i.getLocation=function(){if(this.location===null){const M=this.scoreData.getPartUuid(this.opts.partIdx),f=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:M,measureUuid:f}}return this.location},(0,o.default)(e);const P=e},925076:(C,U,t)=>{t.r(U),t.d(U,{default:()=>u});var g=t(31278),A=t(659140),O=t(996636),T=t(42651);const D=function(d,o,r){this.init(d,o,r)};D.NAME="action.SetJazzChordPartDisplay";const p=D.prototype;p.name=D.NAME,p.init=function(d,o,r){this.scoreData=d,this.cancelStack=r,this.opts=o},p.checkPreconditions=function(){if(A.A.check(this.opts.chordPartType),this.opts.chordPartValue!==null&&O.A.check(this.opts.chordPartType,this.opts.chordPartValue),this.scoreData.getJazzChordPartDisplay(this.opts.chordPartType)===this.opts.chordPartValue)throw new g.default},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const d=this.getPreviousData();this.setJazzChordPartDisplay(),this.updateStack(d)},p.storeAction=function(){if(!this.cancelStack.hasAction()){const d={actionName:this.name,opts:{chordPartType:this.opts.chordPartType,chordPartValue:this.opts.chordPartValue}};this.cancelStack.storeAction(d)}},p.getPreviousData=function(){return{value:this.scoreData.getJazzChordPartDisplay(this.opts.chordPartType)}},p.setJazzChordPartDisplay=function(){this.opts.chordPartValue===null?this.scoreData.removeJazzChordPartDisplay(this.opts.chordPartType):this.scoreData.setJazzChordPartDisplay(this.opts.chordPartType,this.opts.chordPartValue)},p.updateStack=function(d){const o={type:this.name,noDraw:!0,opts:{chordPartType:this.opts.chordPartType,chordPartValue:d.value}};this.cancelStack.push(o),this.cancelStack.stateNeedCompleteRedraw()},(0,T.default)(D);const u=D},975583:(C,U,t)=>{t.r(U),t.d(U,{default:()=>r});var g=t(704621),A=t(153271),O=t(320731),T=t(31278),D=t(250769),p=t(922816),u=t(42651);const d=function(e,i,P){this.init(e,i,P)};d.NAME="action.AddPageBreak";const o=d.prototype;o.name=d.NAME,o.init=function(e,i,P){(0,g.default)(e,i),this.scoreData=e,this.opts=i,this.cancelStack=P,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkValue(),this.checkOverlap()},o.checkLocation=function(){const e=this.scoreData.getNbMeasures(),i=this.opts.measureIdx;if(i<0||i>=e)throw new A.default(i,A.default.GET)},o.checkValue=function(){D.A.check(this.opts.value,O.A)},o.checkOverlap=function(){const e=this.getCommonContent();if(e.hasPageBreak(this.opts.measureIdx)){const i=e.getPageBreak(this.opts.measureIdx);if(this.opts.value===i)throw new T.default}},o.getCommonContent=function(){return this.scoreData.getCommonContent()},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e={measureIdx:this.opts.measureIdx,value:this.opts.value};new p.A(this.scoreData,e,this.cancelStack).perform(),this.updateStack()},o.updateStack=function(){const e=this.getLocation(),i={type:this.name,noDraw:!0,opts:{measureUuid:e.measureUuid,measureIdx:this.opts.measureIdx,value:this.opts.value}};this.cancelStack.push(i)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{measureUuid:e.measureUuid,measureIdx:this.opts.measureIdx,value:this.opts.value}};this.cancelStack.storeAction(i)}},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:e}}return this.location},(0,u.default)(d);const r=d}}]);})();


//# debugId=58893524-e705-554a-a7b2-86103985c27f
