"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="a91d0f53-606a-5b77-a94b-9e31eecda9f8")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[95365],{2110:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(539203);const u=h.A},3926:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(793317),u=t(123491),p=t(852363);const x=function(n,l,f){this.init(n,l,f)};x.NAME="primitive.SetNoteBeamStatus";const r=x.prototype;r.name=x.NAME,r.initMeasureData=h.default,r.init=function(n,l,f){this.initMeasureData(n,l),this.cancelStack=f,this.opts=l},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setBeamStatus(),this.updateStack()},r.setBeamStatus=function(){const l=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);u.default.setBeamStatus(l,this.opts.beamStatus)},r.updateStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const o=x,a=function(n,l,f){this.init(n,l,f)};a.NAME="composite.SetNoteBeamStatus";const s=a.prototype;s.name=a.NAME,s.initMeasureData=h.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.cancelStack=f,this.opts=l},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setBeamStatus()},s.setBeamStatus=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,beamStatus:this.opts.beamStatus};new o(this.measureData,n,this.cancelStack).perform()};const e=a},8963:(S,D,t)=>{t.d(D,{A:()=>n});var h=t(364842),u=t(666636),p=t(352363),x=t(773948),r=t(372585),o=t(345912),a=t(351277),s=t(748478),e=t(79869);function n(d,c){const i=l(d,c);if(!i)return;const I=m(i),E=a.default.getOctave(c.pitch)+I;if(E<p.default.MIN||E>p.default.MAX)throw new u.default(E)}function l(d,c){return f(c)(d,c)}function f(d){if(v(d))return e.A;if(_(d))return s.A;throw new h.default("Unexpected")}function v(d){return typeof d.timePos=="number"&&typeof d.divisions=="number"}function _(d){return typeof d.noteIdx=="number"}function m(d){const c=o.A.getSize(d),i=o.A.getType(d),I=x.A.sizeToOctaveShift(c);return i===r.A.DOWN?-I:I}},14822:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(607682);class u extends h.default{constructor(){super("There is no slur bound to move"),this.name="NoSlurToMoveError"}}},17773:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(768498),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveGhostNotePercu";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeGhostNotePercu(),this.updateStack()},o.removeGhostNotePercu=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.A)(s,this.opts.noteIdx,this.opts.unpitched);h.default.removeHeadParentheses(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},27912:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(653631);const u=h.A},32711:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(607682),u=t(209175);class p extends h.default{constructor(o){super(x(o)),Object.defineProperty(this,"timeModif",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimePosIncompatibleError",this.timeModif=u.default.copy(o)}}const x=function(r){return`The time modification [${u.default.stringify(r)}] is not compatible with the local one.`}},41261:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveCourtesyAccidental";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeCourtesyAccidental(),this.updateStack()},o.removeCourtesyAccidental=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.removeCourtesyAccidental(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},46056:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(607682);class u extends h.default{constructor(){super(p()),this.name="DoesntHaveGraceNoteError"}}const p=function(){return"Note doesn't have a grace note."}},59938:(S,D,t)=>{t.d(D,{A:()=>d});var h=t(612040),u=t(446921),p=t(930109),x=t(364842),r=t(558280),o=t(701387),a=t(852363);const s=function(c,i,I){this.init(c,i,I)};s.NAME="primitive.RemoveWedgeSide";const e=s.prototype;e.name=s.NAME,e.init=function(c,i,I){this.scoreData=c,this.cancelStack=I,this.opts=i,this.removedWedge=null,this.wedges=null,this.wedgeIdx=null},e.perform=function(){this.removeWedge(),this.updateStack()},e.removeWedge=function(){const c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),i=o.default.getWedges(c,this.opts.staffIdx),I=this.getWedgeIdx(),M=i.splice(I,1);if(this.removedWedge=M[0],this.opts.location===h.A.LEFT){const E=r.A.getWedgeUuid(this.removedWedge),P=this.scoreData.getPartContent(this.opts.partIdx);u.A.removeWedge(P,E)}o.default.setWedges(c,this.opts.staffIdx,i)},e.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,a.default)(this.cancelStack,this.scoreData,this.opts)},e.getWedgeIdx=function(){return this.wedgeIdx===null&&this.fetchWedgeIdx(),this.wedgeIdx},e.fetchWedgeIdx=function(){if(this.wedgeIdx=null,this.getWedges().some(this.checkWedge,this),this.wedgeIdx===null)throw new x.default("BadNbWedges")},e.checkWedge=function(c,i){const I=r.A.getTimePos(c),M=r.A.getLocation(c);return I<this.opts.timePos?!1:I===this.opts.timePos?M===this.opts.location?(this.wedgeIdx=i,!0):!1:!0},e.getWedges=function(){if(this.wedges===null){const c=this.getMeasure();this.wedges=o.default.getWedges(c,this.opts.staffIdx)}return this.wedges},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const n=s,l=function(c,i,I){this.init(c,i,I)};l.NAME="primitive.RemoveWedgeContinue";const f=l.prototype;f.name=l.NAME,f.init=function(c,i,I){this.scoreData=c,this.cancelStack=I,this.opts=i,this.removedWedgeDirection=null},f.perform=function(){this.removeLeftWedge(),this.removeRightWedge(),this.updateStack()},f.removeLeftWedge=function(){const c=this.getLeftMeasure();if(!o.default.hasRightWedge(c,this.opts.staffIdx)){const i="There is no right-continue wedge to remove on the left measure.";throw new x.default("MissingRightContinueWedge",i)}this.removedWedgeDirection=o.default.getRightWedge(c,this.opts.staffIdx),o.default.removeRightWedge(c,this.opts.staffIdx)},f.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},f.removeRightWedge=function(){const c=this.getRightMeasure();if(!o.default.hasLeftWedge(c,this.opts.staffIdx)){const i="There is no left-continue wedge to remove on the left measure.";throw new x.default("MissingLeftContinueWedge",i)}o.default.removeLeftWedge(c,this.opts.staffIdx)},f.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},f.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,a.default)(this.cancelStack,this.scoreData,this.opts)};const v=l,_=function(c,i,I){this.init(c,i,I)};_.NAME="composite.RemoveWedge";const m=_.prototype;m.name=_.NAME,m.init=function(c,i,I){this.scoreData=c,this.cancelStack=I,this.opts=i,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},m.searchSides=function(){const c=this.getMeasures(),i=(0,p.A)(c,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=i.startMeasureIdx,this.startTimePos=i.startTimePos,this.stopMeasureIdx=i.stopMeasureIdx,this.stopTimePos=i.stopTimePos},m.getMeasures=function(){const c=this.scoreData.getPartContent(this.opts.partIdx);return u.A.getMeasures(c)},m.removeStart=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,location:h.A.LEFT};new n(this.scoreData,c,this.cancelStack).perform()},m.removeStop=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,location:h.A.RIGHT};new n(this.scoreData,c,this.cancelStack).perform()},m.removeContinues=function(){for(let c=this.startMeasureIdx;c<this.stopMeasureIdx;c++)this.removeContinue(c)},m.removeContinue=function(c){const i={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:c};new v(this.scoreData,i,this.cancelStack).perform()};const d=_},76004:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(476943),u=t(292681),p=t(123491);const x=function(a,s,e,n){let l=a.getGraceChord(s,e);return l=h.default.makeArray(l),l.find(r,n)},r=function(a){const s=this,e=p.default.getUnpitched(a);return u.default.isSameLine(e,s)},o=x},94014:(S,D,t)=>{t.d(D,{A:()=>d});var h=t(42651),u=t(726042),p=t(701387),x=t(496819),r=t(52275),o=t(783177),a=t(704621),s=t(316610),e=t(443749),n=t(646456),l=t(607682);class f extends l.default{constructor(i){super("There is no dynamics at given position"),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="NoDynamicsAtTimePosError",this.position=i}}class v extends Error{constructor(i){const I=i||"Relative position is not provided";super(I),this.name="NoRelativePosError"}}var _=t(31278);class m{constructor(i,I,M){this.name=m.NAME,(0,r.default)(i,I),(0,a.default)(i,I),(0,o.default)(i,I),this.scoreData=i,this.cancelStack=M,this.opts=I,this.measure=null,this.dynamic=null,this.localTimePos=null,this.location=null,this.oldRelPosX=0,this.oldRelPosY=0}checkPreconditions(){this.checkLocation(),this.checkTimePos(),this.checkHasRelativePos(),this.checkHasDynamic(),this.checkNoChange()}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setPosition(),this.updateCancelStack()}setPosition(){const i=this.getDynamic();typeof this.opts.relativePos.x!="undefined"&&x.A.setOffsetX(i,this.opts.relativePos.x),typeof this.opts.relativePos.y!="undefined"&&x.A.setOffsetY(i,this.opts.relativePos.y)}checkLocation(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const i=this.getMeasure(),I=p.default.getNbStaves(i),M=this.opts.staffIdx;if(!u.default.isNumber(M)||M<0||M>=I)throw new e.default(M)}checkTimePos(){const i=this.getLocalTimePos(),I=this.getMeasure(),M=p.default.getNbDivisions(I);if(!u.default.isNumber(i)||i<0||i>M){const E=p.default.getDpq(I);throw new n.A(i,E)}}checkHasRelativePos(){if(!this.opts.relativePos||!Object.hasOwn(this.opts.relativePos,"x")&&!Object.hasOwn(this.opts.relativePos,"y"))throw new v}checkHasDynamic(){if(this.getDynamic(),this.dynamic===null)throw new f({partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq})}checkNoChange(){const i=this.getDynamic();if(this.oldRelPosX=x.A.getOffsetX(i),this.oldRelPosY=x.A.getOffsetY(i),this.opts.relativePos.x===this.oldRelPosX&&this.opts.relativePos.y===this.oldRelPosY)throw new _.default}getLocalTimePos(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,s.A)(this.opts,i)}return this.localTimePos}getDynamic(){if(this.dynamic===null){const i=this.getMeasure(),M=p.default.getDynamics(i,this.opts.staffIdx).find(E=>x.A.getTimePos(E)===this.getLocalTimePos());M&&(this.dynamic=M)}return this.dynamic}getMeasure(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure}storeAction(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),I={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,relativePos:this.opts.relativePos}};this.cancelStack.storeAction(I)}}updateCancelStack(){const i=this.getLocation(),I={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,oldRelativePos:{x:this.oldRelPosX,y:this.oldRelPosY}}};this.cancelStack.push(I)}getLocation(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),I=this.scoreData.getMeasureUuid(this.opts.measureIdx),M=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,measureUuid:I,staffUuid:M}}return this.location}}Object.defineProperty(m,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"action.SetDynamicRelativePosition"});const d=m;(0,h.default)(m)},99448:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(351277),u=t(123491),p=t(476943),x=t(67737),r=t(490884),o=t(793317);const a=function(n,l,f){this.init(n,l,f)};a.NAME="composite.DeleteGracesAtNote";const s=a.prototype;s.name=a.NAME,s.initMeasureData=o.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.cancelStack=f,this.opts=l},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const n=this.measureData.getVoice(this.opts.voiceIdx),l=n.getNbGraces(this.opts.noteIdx);for(let f=0;f<l;f++){let v=n.getGraceChord(this.opts.noteIdx,0);v=p.default.makeArray(v),v=v.slice(),v.forEach(this.removeGraceHead,this)}},s.removeGraceHead=function(n,l,f){const v=f.length;if(l===v-1)this.deleteGrace();else{let _=u.default.getPitch(n);_=h.default.copy(_),this.removeGraceFromChord(_)}},s.deleteGrace=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0},l=new x.default(this.measureData,n,this.cancelStack);l.checkPreconditions(),l.perform()},s.removeGraceFromChord=function(n){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0,pitch:n},f=new r.default(this.measureData,l,this.cancelStack);f.checkPreconditions(),f.perform()};const e=a},115847:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(971249),u=t(123491),p=t(50060),x=t(674411),r=t(852363),o=t(793317);const a=function(n,l,f){this.init(n,l,f)};a.NAME="primitive.AddLyricMelisma";const s=a.prototype;s.name=a.NAME,s.initMeasureData=o.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.cancelStack=f,this.opts=l},s.perform=function(){const l=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),f=this.createLyric();u.default.addLyric(l,f),this.updateStack()},s.createLyric=function(){const n={},l=x.A.create(h.A.STOP);return p.default.setMelisma(n,l),p.default.setLevel(n,this.opts.level),n},s.updateStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,r.default)(this.cancelStack,this.measureData,this.opts)};const e=a},130412:(S,D,t)=>{t.d(D,{A:()=>v});var h=t(476943),u=t(123491),p=t(351277),x=t(860716),r=t(298009),o=t(793317),a=t(359932),s=t(955154);const e=function(_,m,d){this.init(_,m,d)},n=e.prototype;n.initMeasureData=o.default,n.init=function(_,m,d){this.initMeasureData(_,m),this.opts=m,this.cancelStack=d,this.actions=null},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},n.perform=function(){this.getSetFretActions().forEach(this.performActionIfPossible)},n.performActionIfPossible=function(_){_.performIfPossible()},n.getSetFretActions=function(){return this.actions===null&&(this.actions=this.getChordsActions()),this.actions},n.getChordsActions=function(){const _=this.getVoice(),m=this.opts.noteIdx;if(!_.isRest(m)){let d=_.getChord(m);return d=h.default.makeArray(d),this.getChordActions(d,m)}return[]},n.getChordActions=function(_,m){const d=[];return _.forEach(function(c){if(!this.hasFretData(c)&&!l(c)){const i=u.default.getPitch(c),I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:m,pitch:p.default.copy(i),record:!0},M=new r.default(this.measureData,I,this.cancelStack);d.push(M)}},this),d.sort(f),d};function l(_){if(!u.default.hasHarmonic(_))return!1;const m=u.default.getHarmonic(_),d=x.default.getType(m);return d===s.default.NATURAL_SOUNDING||d===s.default.ARTIFICIAL_TOUCHING}function f(_,m){const d=_.opts.pitch,c=m.opts.pitch;return-p.default.naiveComparePitch(d,c)}n.hasFretData=function(_){return u.default.hasTechnical(_,a.default.STRING)&&u.default.hasTechnical(_,a.default.FRET)};const v=e},143146:(S,D,t)=>{t.d(D,{A:()=>m});var h=t(364842),u=t(123491),p=t(476943),x=t(351277),r=t(292681),o=t(737296),a=t(91894),s=t(122007),e=t(443923),n=t(217149),l=t(793317),f=t(519405);const v=function(d,c,i){this.init(d,c,i)};v.NAME="composite.RemoveVoiceNotesAfter";const _=v.prototype;_.initMeasureData=l.default,_.name=v.NAME,_.init=function(d,c,i){this.initMeasureData(d,c),this.cancelStack=i,this.opts=c},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,n.A)(this.measureData,this.opts),this.removeNotes()},_.removeNotes=function(){const d=this.getVoice(),c=d.getStopNoteIdx();for(let i=c;i>=this.opts.noteIdx;i--)d.isRest(i)?this.unlockRest(i):this.removeChord(i)},_.removeChord=function(d){let i=this.getVoice().getChord(d);i=p.default.makeArray(i).slice(),this.noteIdx=d,i.forEach(this.removeChordHead,this)},_.removeChordHead=function(d){if(u.default.hasPitch(d)){const c=u.default.getPitch(d);this.removePitched(c)}else if(u.default.hasUnpitched(d)){const c=u.default.getUnpitched(d);this.removeUnpitched(c)}else{const c="Cannot have a note neither pitched nor unpitched.";throw new h.default("Unexpected",c)}},_.removePitched=function(d){d=x.default.copy(d);const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,pitch:d,insertMode:o.default.REPLACE,keepFormer:!1},i=new a.default(this.measureData,c,this.cancelStack);(0,f.default)(i)},_.removeUnpitched=function(d){d=r.default.copy(d);const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,unpitched:d,insertMode:o.default.REPLACE},i=new s.default(this.measureData,c,this.cancelStack);(0,f.default)(i)},_.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},_.unlockRest=function(d){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:d};new e.A(this.measureData,c,this.cancelStack).perform()};const m=v},155010:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(351277),u=t(793317),p=t(825238),x=t(56807);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveHeadGlissandos";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.opts=e,this.cancelStack=n},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHeadGlissandos()},o.removeHeadGlissandos=function(){this.removeLeftGlissandos(),this.removeRightGlissandos()},o.removeLeftGlissandos=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(this.opts.pitch)};new p.A(this.measureData,s,this.cancelStack).perform()},o.removeRightGlissandos=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(this.opts.pitch)};new x.A(this.measureData,s,this.cancelStack).perform()};const a=r},158553:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(351277),u=t(793317),p=t(418621),x=t(941837);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveHeadSlides";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.opts=e,this.cancelStack=n},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHeadSlides()},o.removeHeadSlides=function(){this.removeLeftSlides(),this.removeRightSlides()},o.removeLeftSlides=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(this.opts.pitch)};new p.A(this.measureData,s,this.cancelStack).perform()},o.removeRightSlides=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(this.opts.pitch)};new x.A(this.measureData,s,this.cancelStack).perform()};const a=r},160814:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(351277),u=t(607682);const p=function(r,o){return`There is no note for the pitch [${h.default.stringify(r)}] and the fret [${o.fret}] and the string [${o.string}].`};class x extends u.default{constructor(o,a){const s=p(o,a);super(s),Object.defineProperty(this,"pitch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fretData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="NoNoteAtPitchFretError",this.pitch=o,this.fretData=a}}},172788:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(351277),u=t(123491),p=t(545496),x=t(762860);const r=function(s,e){let n;if(e.accidental!==null)n=h.default.accidentalToAlter(e.accidental);else{const l=o(s,e);n=(0,p.A)(s,e.noteIdx,e.voiceIdx,l,e.pitch,e.graceIdx)}h.default.setAlter(e.pitch,n)},o=function(s,e){if(typeof e.staffIdx!="undefined")return e.staffIdx;{const n=s.getVoice(e.voiceIdx),l=(0,x.A)(n,e.noteIdx,e.graceIdx,e.pitch);return u.default.getStaffIdx(l)}},a=r},184360:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(123491),u=t(852363),p=t(793317);const x=function(a,s,e){this.init(a,s,e)};x.NAME="primitive.RemoveArticulation";const r=x.prototype;r.name=x.NAME,r.initMeasureData=p.default,r.init=function(a,s,e){this.initMeasureData(a,s),this.cancelStack=e,this.opts=s},r.perform=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);h.default.removeArticulation(s,this.opts.articulationType),this.updateStack()},r.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a),(0,u.default)(this.cancelStack,this.measureData,this.opts)};const o=x},191524:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(377180),u=t(351277);const x=function(r,o,a){if(r=u.default.copy(r),h.default.isIdentity(a))return{pitch:r,accidental:o};a=h.default.getReverse(a);let s;return o!==null&&(s=u.default.accidentalToAlter(o),u.default.setAlter(r,s)),r=u.default.transpose(r,a,!0),o!==null&&(s=u.default.getAlter(r),o=u.default.alterToAccidental(s)),r=u.default.copyWithoutAlter(r),{pitch:r,accidental:o}}},200179:(S,D,t)=>{t.d(D,{A:()=>f});var h=t(364842),u=t(483139),p=t(15730),x=t(480317);const o=function(v,_){let m,d;if(_.forEach(function(c){if(p.A.hasUuid(v,c)){const i=(0,x.A)(v,c);m=typeof m!="undefined"?Math.min(m,i):i,d=typeof d!="undefined"?Math.max(d,i):i}}),typeof m=="undefined")throw new u.A(_[0]);return{startMeasureIdx:m,stopMeasureIdx:d}};var a=t(813864),s=t(476943),e=t(701387);const n=function(v,_){typeof _.measureUuids!="undefined"&&l(v,_)},l=function(v,_){if(s.default.isArray(_.measureUuids)&&_.measureUuids.length>0){v=(0,a.A)(v);const m=o(v.getMeasuresHeaders(),_.measureUuids);_.startMeasureIdx=m.startMeasureIdx,_.stopMeasureIdx=m.stopMeasureIdx;const d=_.measureUuids;if(delete _.measureUuids,typeof _.startTimePos!="undefined"){const c=d[0];v.hasMeasureUuid(c)||(_.startTimePos=0,_.startDpq=1)}if(typeof _.stopTimePos!="undefined"){const c=d[d.length-1];if(!v.hasMeasureUuid(c)){const I=v.getMeasure(0,_.stopMeasureIdx);_.stopDpq=e.default.getDpq(I),_.stopTimePos=e.default.getNbDivisions(I)}}}else throw new h.default("Unexpected","Cannot convert measureUuids if is not an array of uuids")},f=n},201060:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(480317);const u=h.A},212258:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveHarmonic";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeHarmonic(),this.updateStack()},o.removeHarmonic=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.removeHarmonic(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},214844:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(852363),u=t(123491),p=t(578918),x=t(793317);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveFingering";const o=r.prototype;o.initMeasureData=x.default,o.name=r.NAME,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeFingering(),this.updateStack()},o.removeFingering=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);u.default.removeFingering(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,h.default)(this.cancelStack,this.measureData,this.opts)};const a=r},217149:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(726042),u=t(82028);const x=function(r,o){const a=r.getDivisions().getDivisions(),s=h.default.lcm(a,o.divisions),e=s/a,n=s/o.divisions;o.timePos*=n;const l=r.getVoice(o.voiceIdx),f=(0,u.default)(l,e,o.timePos);o.noteIdx=f,delete o.timePos,delete o.divisions}},224874:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(173739);const u=h.A},231477:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(768498),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveColorFromNotePercu";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeColorFromNotePercu(),this.updateStack()},o.removeColorFromNotePercu=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.A)(s,this.opts.noteIdx,this.opts.unpitched);h.default.removeColor(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},244977:(S,D,t)=>{t.d(D,{A:()=>m});var h=t(364842),u=t(123491),p=t(726042),x=t(515819),r=t(259563),o=t(734677),a=t(405347),s=t(82028),e=t(964039),n=t(519405),l=t(737296),f=t(793317);const v=function(d,c,i){this.init(d,c,i)};v.NAME="composite.SplitRest";const _=v.prototype;_.initMeasureData=f.default,_.name=v.NAME,_.init=function(d,c,i){this.initMeasureData(d,c),this.cancelStack=i,this.opts=c,this.noteIdx=null,this.leftShard=null,this.rightShard=null,this.shards=[],this.floorNoteIdx=null,this.divisionsPerBeat=null,this.staffIdx=null},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.increaseDivisionsIfNeeded(),this.fetchInitialShards(),this.dispatchLeftRests(),this.dispatchRightRests(),this.changeDurations()},_.increaseDivisionsIfNeeded=function(){const d=this.measureData.getDivisions().getDivisions(),c=p.default.lcm(d,this.opts.divisions),i=c/d;i>1&&this.increaseDivisions(i);const I=c/this.opts.divisions;I>1&&(this.opts.divisions*=I,this.opts.timePos*=I)},_.increaseDivisions=function(d){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,coeff:d};new o.A(this.measureData,c,this.cancelStack).perform()},_.fetchInitialShards=function(){const d=this.getVoice(),c=d.size();let i=0;for(let M=0;M<c;M++){const E=d.getNote(M),P=u.default.getDuration(E),O=i+P;if(i<this.opts.timePos&&this.opts.timePos<O)if(d.isRest(M)){this.staffIdx=u.default.getStaffIdx(E),this.noteIdx=M,this.leftShard=this.opts.timePos-i,this.previousTimePos=i,this.rightShard=O-this.opts.timePos;return}else throw new h.default("Unexpected","cannot split a non rest.");i=O}const I=`There is no rest to be splitted at the time position [${this.opts.timePos}]`;throw new h.default("Unexpected",I)},_.dispatchLeftRests=function(){const d=this.getDivisionsPerBeat(),c=this.getDpq(),i=this.getAbsoluteTimeModif(),I=new e.A(this.previousTimePos,this.leftShard,d,c,i);I.dispatch();const M=I.getDispatchedRests();this.shards.push.apply(this.shards,M)},_.dispatchRightRests=function(){const d=this.getDivisionsPerBeat(),c=this.getDpq(),i=this.getAbsoluteTimeModif(),I=new e.A(this.opts.timePos,this.rightShard,d,c,i);I.dispatch();const M=I.getDispatchedRests();this.shards.push.apply(this.shards,M)},_.getDivisionsPerBeat=function(){if(this.divisionsPerBeat===null){const d=this.getVoiceOrTuplet();d.isTuplet()?this.divisionsPerBeat=this.getDivPerBeatFromTimeModif(d):this.divisionsPerBeat=this.getDivPerBeatFromTimeSignature()}return this.divisionsPerBeat},_.getDivPerBeatFromTimeSignature=function(){const d=this.measureData.getAnyTime(),c=x.default.getBeatQuarterDuration(d),i=this.getDpq();return x.default.quarterToDuration(c,i)},_.getDivPerBeatFromTimeModif=function(d){const c=d.getAbsoluteTimeModif(),i=d.getDurationType(),I=this.getDpq(),M=r.default.toQuarterDuration(i),E=x.default.quarterToDuration(M,I);return x.default.normalToActual(E,c)},_.changeDurations=function(){this.shards.forEach(this.changeDurationIfNeeded,this)},_.changeDurationIfNeeded=function(d,c){const I=this.getFloorNoteIdx()+c,E=this.getVoice().getNote(I);u.default.getDuration(E)!==d&&this.changeDuration(I,d)},_.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},_.changeDuration=function(d,c){const i=this.getDurationOpts(c),I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:d,durationType:i.durationType,nbDots:i.nbDots,insertMode:l.default.REPLACE},M=new a.default(this.measureData,I,this.cancelStack);(0,n.default)(M)},_.getDurationOpts=function(d){const c=this.getAbsoluteTimeModif(),i=this.getDpq();return x.default.actualDivisionsToDurationOpts(d,i,c)},_.getDpq=function(){return this.measureData.getDpqValue()},_.getAbsoluteTimeModif=function(){return this.getVoiceOrTuplet().getAbsoluteTimeModif()},_.getVoiceOrTuplet=function(){const d=this.opts.voiceIdx,c=this.getFloorNoteIdx();return this.measureData.getVoiceOrTupletForGet(d,c)},_.getFloorNoteIdx=function(){if(this.floorNoteIdx===null){const d=this.getVoice(),c=1;this.floorNoteIdx=(0,s.default)(d,c,this.opts.timePos)}return this.floorNoteIdx};const m=v},245817:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(768498),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.SetTieDirectionPercu";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e,this.note=null},o.perform=function(){this.setTieDirectionPercu(),this.updateStack(),this.isTiedWithNextMeasure()&&this.signalNextMeasure()},o.setTieDirectionPercu=function(){const s=this.getNote();h.default.setTieDirection(s,this.opts.tieDirection)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)},o.isTiedWithNextMeasure=function(){const s=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.noteIdx+1<s.getNbNotes())return!1;const e=this.getNote();return h.default.hasTieStart(e)},o.getNote=function(){if(this.note===null){const s=this.measureData.getVoice(this.opts.voiceIdx);this.note=(0,p.A)(s,this.opts.noteIdx,this.opts.unpitched)}return this.note},o.signalNextMeasure=function(){const{partIdx:s}=this.opts,e=this.opts.measureIdx+1,n={type:`${this.name}-close`,opts:{partIdx:s,measureIdx:e}};this.cancelStack.push(n),(0,x.default)(this.cancelStack,this.measureData,{partIdx:s,measureIdx:e})};const a=r},245826:(S,D,t)=>{t.d(D,{A:()=>I});var h=t(364842),u=t(123491),p=t(712947),x=t(794799),r=t(586654),o=t(271449),a=t(971280),s=t(650371),e=t(852363),n=t(793317);const l=function(M,E,P){this.init(M,E,P)};l.NAME="primitive.SetSlurIsCrossMeasure";const f=l.prototype;f.name=l.NAME,f.initMeasureData=n.default,f.init=function(M,E,P){this.initMeasureData(M,E),this.cancelStack=P,this.opts=E},f.perform=function(){this.setIsCrossMeasure(),this.updateStack()},f.setIsCrossMeasure=function(){const E=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),P=u.default.getSlur(E);this.opts.isCrossMeasure?p.default.addCrossMeasure(P):p.default.removeCrossMeasure(P)},f.updateStack=function(){const M={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isCrossMeasure:this.opts.isCrossMeasure}};this.cancelStack.push(M),(0,e.default)(this.cancelStack,this.measureData,this.opts)};const v=l;var _=t(2110),m=t(713735),d=t(739293);const c=function(M,E,P){this.init(M,E,P)};c.NAME="composite.MoveSlurSide";const i=c.prototype;i.name=c.NAME,i.init=function(M,E,P){this.measuresScroller=(0,_.A)(M,E),this.cancelStack=P,this.opts=E,this.slurType=null,this.slurPlacement=null,this.otherSide=null,this.staffIdx=null},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.getSlurData(),this.fetchOtherSide(),this.opts.newMeasureIdx!==this.opts.oldMeasureIdx&&(this.updateOtherSide(),this.updateContinues()),this.removeSlur(),this.addSlur()},i.getSlurData=function(){const P=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.opts.oldNoteIdx),O=u.default.getSlur(P);this.slurType=u.default.getSlurType(P),this.slurPlacement=p.default.getPlacement(O),this.staffIdx=u.default.getStaffIdx(P),this.slurType===x.A.START&&(this.slurUuid=p.default.getUuid(O))},i.fetchOtherSide=function(){const M={voiceIdx:this.opts.voiceIdx,measureIdx:this.opts.oldMeasureIdx,noteIdx:this.opts.oldNoteIdx};if(this.slurType===x.A.START)this.otherSide=(0,m.A)(this.measuresScroller,M);else if(this.slurType===x.A.STOP)this.otherSide=(0,d.A)(this.measuresScroller,M),this.fetchOtherSideUuid();else throw new h.default("Unexpected")},i.fetchOtherSideUuid=function(){const P=this.measuresScroller.getMeasureData(this.otherSide.measureIdx).getVoice(this.opts.voiceIdx).getNote(this.otherSide.noteIdx),O=u.default.getSlur(P);this.slurUuid=p.default.getUuid(O)},i.updateOtherSide=function(){const M=this.otherSide.measureIdx;this.opts.newMeasureIdx===M&&this.opts.oldMeasureIdx!==M?this.setIsCrossMeasure(!1):this.opts.newMeasureIdx!==M&&this.opts.oldMeasureIdx===M&&this.setIsCrossMeasure(!0)},i.setIsCrossMeasure=function(M){const E={partIdx:this.opts.partIdx,measureIdx:this.otherSide.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.otherSide.noteIdx,isCrossMeasure:M},P=this.measuresScroller.getMeasureData(E.measureIdx);new v(P,E,this.cancelStack).perform()},i.updateContinues=function(){const M=this.opts.newMeasureIdx-this.opts.oldMeasureIdx;M>0?this.updateContinuesRight(M):this.updateContinuesLeft(-M)},i.updateContinuesRight=function(M){const E=this.getContinueAction(),P=this.measuresScroller.getScoreData();for(let O=0;O<M;O++){const K=this.opts.oldMeasureIdx+O,w={partIdx:this.opts.partIdx,measureIdx:K,voiceIdx:this.opts.voiceIdx,staffIdx:this.staffIdx,slurUuid:this.slurUuid,placement:this.slurPlacement};new E(P,w,this.cancelStack).perform()}},i.updateContinuesLeft=function(M){const E=this.getContinueAction(),P=this.measuresScroller.getScoreData();for(let O=0;O<M;O++){const K=this.opts.oldMeasureIdx-(O+1),w={partIdx:this.opts.partIdx,measureIdx:K,voiceIdx:this.opts.voiceIdx,staffIdx:this.staffIdx,slurUuid:this.slurUuid};new E(P,w,this.cancelStack).perform()}},i.getContinueAction=function(){const M=this.otherSide.measureIdx,E=Math.abs(M-this.opts.oldMeasureIdx),P=Math.abs(M-this.opts.newMeasureIdx);return E>P?a.A:E<P?s.A:null},i.removeSlur=function(){const M={partIdx:this.opts.partIdx,measureIdx:this.opts.oldMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.oldNoteIdx},E=this.measuresScroller.getMeasureData(M.measureIdx);new r.A(E,M,this.cancelStack).perform()},i.addSlur=function(){const M=this.getIsCrossMeasure(),E={partIdx:this.opts.partIdx,measureIdx:this.opts.newMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.newNoteIdx,isCrossMeasure:M,type:this.slurType,placement:this.slurPlacement,slurUuid:this.slurUuid},P=this.measuresScroller.getMeasureData(E.measureIdx);new o.A(P,E,this.cancelStack).perform()},i.getIsCrossMeasure=function(){return this.opts.newMeasureIdx!==this.otherSide.measureIdx};const I=c},253916:(S,D,t)=>{t.d(D,{A:()=>v});var h=t(351277),u=t(123491),p=t(316197),x=t(793317),r=t(691309),o=t(476943);const a=function(_,m,d){this.init(_,m,d)};a.NAME="composite.RemoveHeadOrphanGlissandoStops";const s=a.prototype;s.name=a.NAME,s.initMeasureData=x.default,s.init=function(_,m,d){this.initMeasureData(_,m),this.opts=m,this.cancelStack=d,this.crossMeasure=new r.default(this.measureData,m.voiceIdx,m.noteIdx-1)},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeOrphanGlissandos()},s.removeOrphanGlissandos=function(){const _=this.getNote();u.default.getGlissandoStops(_).filter(this.isGlissandoOrphan,this).forEach(e,_)};function e(_){const m=this;u.default.removeGlissando(m,_)}s.getNote=function(){return this.crossMeasure.getRightChord().find(n,this.opts.pitch)};function n(_){const m=this,d=u.default.getPitch(_);return h.default.isSameLine(d,m)}s.isGlissandoOrphan=function(_){if(this.crossMeasure.hasLeftOverflow()&&this.opts.measureIdx-1<0||!this.crossMeasure.hasLeftVoice())return!0;const m=this.crossMeasure.getLeftVoice(),d=this.crossMeasure.getLeftNoteIdx();if(m.isRest(d))return!0;let c=m.getChord(d);c=o.default.makeArray(c);const i=p.default.getNumber(_);return c.every(l,i)};function l(_){const m=this.valueOf();return u.default.getGlissandoStarts(_).every(f,m)}function f(_){const m=this.valueOf();return p.default.getNumber(_)!==m}const v=a},264358:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(852363),u=t(123491),p=t(476943),x=t(793317),r=t(575349);const o=function(e,n,l){this.init(e,n,l)};o.NAME="primitive.RemoveBend";const a=o.prototype;a.name=o.NAME,a.initMeasureData=x.default,a.init=function(e,n,l){this.initMeasureData(e,n),this.cancelStack=l,this.opts=n,this.note=null},a.perform=function(){this.removeBend(),this.updateStack(),this.isTiedWithNextMeasure()&&this.signalNextMeasure()},a.removeBend=function(){const e=this.getNote();u.default.removeBend(e)},a.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,h.default)(this.cancelStack,this.measureData,this.opts)},a.isTiedWithNextMeasure=function(){const e=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.noteIdx+1<e.getNbNotes())return!1;const n=this.getNote();return u.default.hasTieStart(n)},a.getNote=function(){if(this.note===null){let n=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);n=p.default.makeArray(n),this.note=n.find(r.A,this.opts)}return this.note},a.signalNextMeasure=function(){const e={type:`${this.name}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx+1}};this.cancelStack.push(e),(0,h.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx+1})};const s=o},267529:(S,D,t)=>{t.d(D,{A:()=>v});var h=t(351277),u=t(123491),p=t(793317),x=t(852363);const r=function(_,m,d){this.init(_,m,d)};r.NAME="primitive.AddGraceToChord";const o=r.prototype;o.name=r.NAME,o.initMeasureData=p.default,o.init=function(_,m,d){this.initMeasureData(_,m),this.cancelStack=d,this.opts=m},o.perform=function(){const _=this.getVoice(),m=_.getGrace(this.opts.noteIdx,this.opts.graceIdx),d=this.createNote(m,_);_.addGraceToChord(d,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},o.getVoice=function(){const _=this.opts.voiceIdx;return this.measureData.getVoice(_)},o.createNote=function(_,m){const d=u.default.getDurationType(_),c={};u.default.makeGrace(c),u.default.setStaffIdx(c,this.opts.staffIdx),u.default.setVoiceIdx(c,this.opts.voiceIdx),u.default.setDurationType(c,d);const i=h.default.copy(this.opts.pitch);u.default.setPitch(c,i);const I=m.getRangeSpace(0,this.opts.noteIdx);return u.default.setTimePos(c,I),c},o.updateStack=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},m={type:this.name,opts:_};this.cancelStack.push(m),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r;var s=t(561262),e=t(200665),n=t(534512);const l=function(_,m,d){this.init(_,m,d)};l.NAME="composite.AddGraceToChord";const f=l.prototype;f.name=l.NAME,f.initMeasureData=p.default,f.init=function(_,m,d){this.initMeasureData(_,m),this.cancelStack=d,this.opts=m},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addGraceToChord(),this.isTabStaff()&&this.setFretAction(),this.updateAccidental()},f.getVoice=function(){const _=this.opts.voiceIdx;return this.measureData.getVoice(_)},f.addGraceToChord=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(this.opts.pitch)};new a(this.measureData,_,this.cancelStack).perform()},f.isTabStaff=function(){return(0,n.default)(this.measureData,this.opts)},f.setFretAction=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(this.opts.pitch),fretData:this.opts.fretData,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new e.default(this.measureData,_,this.cancelStack).performIfPossible()},f.updateAccidental=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(this.opts.pitch)};new s.A(this.measureData,_,this.cancelStack).perform()};const v=l},270259:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(607682);class u extends h.default{constructor(o){super(x(o)),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="InconsistentAttributesError",this.type=o}}Object.defineProperty(u,"KEY",{enumerable:!0,configurable:!0,writable:!0,value:"keys signatures"}),Object.defineProperty(u,"TIME",{enumerable:!0,configurable:!0,writable:!0,value:"times signatures"}),Object.defineProperty(u,"CLEF",{enumerable:!0,configurable:!0,writable:!0,value:"clefs"}),Object.defineProperty(u,"TEMPO",{enumerable:!0,configurable:!0,writable:!0,value:"tempo"}),Object.defineProperty(u,"SWING",{enumerable:!0,configurable:!0,writable:!0,value:"swing"});const p=u,x=function(r){return`The ${r} in the measure range are not all the same.`}},271449:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(794799),u=t(123491),p=t(712947),x=t(446921),r=t(852363),o=t(793317);const a=function(n,l,f){this.init(n,l,f)};a.NAME="primitive.AddSlurSide";const s=a.prototype;s.name=a.NAME,s.initMeasureData=o.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.cancelStack=f,this.opts=l},s.perform=function(){this.addSlur(),this.updateStack()},s.addSlur=function(){const l=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),f=p.default.create(this.opts.type);this.opts.type===h.A.START&&this.opts.slurUuid!=="undefined"&&(p.default.setUuid(f,this.opts.slurUuid),this.storeSlurUuid()),this.opts.isCrossMeasure&&p.default.addCrossMeasure(f),p.default.setPlacement(f,this.opts.placement),u.default.setSlur(l,f)},s.updateStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isCrossMeasure:this.opts.isCrossMeasure,type:this.opts.type}};this.cancelStack.push(n),(0,r.default)(this.cancelStack,this.measureData,this.opts)},s.storeSlurUuid=function(){const n=this.measureData.getScoreData(),l=n.getMeasureUuid(this.opts.measureIdx),f=n.getPartContent(this.opts.partIdx),v={measureUuid:l,slurUuid:this.opts.slurUuid};x.A.addSlur(f,v)};const e=a},278959:(S,D,t)=>{t.d(D,{A:()=>v});var h=t(123491),u=t(351277),p=t(561262),x=t(364842),r=t(762860),o=t(852363),a=t(793317);const s=function(_,m,d){this.init(_,m,d)};s.NAME="primitive.SetGraceAlter";const e=s.prototype;e.initMeasureData=a.default,e.name=s.NAME,e.init=function(_,m,d){this.initMeasureData(_,m),this.cancelStack=d,this.opts=m},e.perform=function(){const _=this.getGraceAtPitch(),m=u.default.getAlter(this.opts.pitch);h.default.setAlter(_,m),this.updateStack()},e.getGraceAtPitch=function(){const _=this.measureData.getVoice(this.opts.voiceIdx),m=(0,r.A)(_,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);if(typeof m=="undefined")throw new x.default("NoGraceAtPitch");return m},e.updateStack=function(){const _={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(_),(0,o.default)(this.cancelStack,this.measureData,this.opts)};const n=s,l=function(_,m,d){this.init(_,m,d)};l.NAME="composite.SetGraceAccidental";const f=l.prototype;f.initMeasureData=a.default,f.name=l.NAME,f.init=function(_,m,d){this.initMeasureData(_,m),this.cancelStack=d,this.opts=m},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setAlter(),this.updateAccidental()},f.setAlter=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:u.default.copy(this.opts.pitch)};new n(this.measureData,_,this.cancelStack).perform()},f.updateAccidental=function(){const _=this.getGraceAtPitch(),m=h.default.getStaffIdx(_),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:m,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:u.default.copy(this.opts.pitch)};new p.A(this.measureData,d,this.cancelStack).perform()},f.getGraceAtPitch=function(){const _=this.measureData.getVoice(this.opts.voiceIdx);return(0,r.A)(_,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)};const v=l},308192:(S,D,t)=>{t.d(D,{A:()=>r});var h=t(852363),u=t(606333);const p=function(o,a,s){this.init(o,a,s)};p.NAME=u.p;const x=p.prototype;x.name=p.NAME,x.init=function(o,a,s){this.scoreData=o,this.cancelStack=s,this.opts=a},x.perform=function(){this.addMiddleMeasureClef(),this.updateStack()},x.addMiddleMeasureClef=function(){this.scoreData.getCommonContent().removeMultiMeasureRest(this.opts.measureIdx)},x.updateStack=function(){const o=this.scoreData.getNbParts();for(let a=0;a<o;a++){const s={partIdx:a,measureIdx:this.opts.measureIdx},e={type:this.name,opts:s};this.cancelStack.push(e),(0,h.default)(this.cancelStack,this.scoreData,s)}};const r=p},314302:(S,D,t)=>{t.d(D,{A:()=>n});var h=t(793317),u=t(578918),p=t(852363),x=t(123491),r=t(964845),o=t(351277),a=t(359932);const s=function(l,f,v){this.init(l,f,v)};s.NAME="primitive.SetFret";const e=s.prototype;e.name=s.NAME,e.initMeasureData=h.default,e.init=function(l,f,v){this.initMeasureData(l,f),this.opts=f,this.cancelStack=v},e.perform=function(){const l=this.measureData.getVoice(this.opts.voiceIdx),f=(0,u.default)(l,this.opts.noteIdx,this.opts.pitch);this.addTechnical(f,a.default.FRET),this.addTechnical(f,a.default.STRING),this.updateCancelStack()},e.addTechnical=function(l,f){const v=r.A.getTechnicalOpts(this.opts.fretData,f);x.default.addTechnical(l,f,v)},e.updateCancelStack=function(){const l={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:o.default.copy(this.opts.pitch),fretData:this.opts.fretData}};this.cancelStack.push(l),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const n=s},316610:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(536863);const u=h.A},317534:(S,D,t)=>{t.d(D,{A:()=>c});var h=t(351277),u=t(123491),p=t(852363),x=t(793317);const r=function(i,I,M){this.init(i,I,M)};r.NAME="primitive.DeleteGraceNote";const o=r.prototype;o.name=r.NAME,o.initMeasureData=x.default,o.init=function(i,I,M){this.initMeasureData(i,I),this.cancelStack=M,this.opts=I},o.perform=function(){this.getVoice().removeGrace(this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},o.getVoice=function(){const i=this.opts.voiceIdx;return this.measureData.getVoice(i)},o.updateStack=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},I={type:this.name,opts:i};this.cancelStack.push(I),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const a=r;var s=t(645166),e=t(561262),n=t(643569),l=t(408649),f=t(424654),v=t(519405);const _=function(i,I,M){this.init(i,I,M)};_.NAME="composite.DeleteGraceNote";const m=_.prototype;m.name=_.NAME,m.initMeasureData=x.default,m.init=function(i,I,M){this.initMeasureData(i,I),this.cancelStack=M,this.opts=I},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlash();const i=this.getNoteData();this.removeColor(i),this.removeGraceSlurIfLast(),this.deleteGraceNote(),this.updateAccidental(i)},m.removeSlash=function(){const I=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx);if(!u.default.isSlashedGrace(I))return;const M={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},E=new n.default(this.measureData,M,this.cancelStack);(0,v.default)(E)},m.removeColor=function(i){if(i.color===null)return;const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(i.pitch)},M=new l.default(this.measureData,I,this.cancelStack);(0,v.default)(M)},m.getNoteData=function(){const I=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx),M=u.default.getPitch(I),E=u.default.getStaffIdx(I),P=d(I);return{staffIdx:E,pitch:h.default.copyWithoutAlter(M),color:P}};function d(i){return u.default.hasColor(i)?u.default.getColor(i):null}m.deleteGraceNote=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new a(this.measureData,i,this.cancelStack).perform()},m.updateAccidental=function(i){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:i.staffIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(i.pitch)},E=this.getVoice().getNbGraces(this.opts.noteIdx);let P;this.opts.graceIdx<E?(I.graceIdx=this.opts.graceIdx,P=new e.A(this.measureData,I,this.cancelStack)):P=new s.A(this.measureData,I,this.cancelStack),P.perform()},m.removeGraceSlurIfLast=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},I=this.getVoice(),M=I.getNote(this.opts.noteIdx);if(I.getNbGraces(this.opts.noteIdx)===1&&u.default.hasGraceSlur(M)){const P=new f.default(this.measureData,i,this.cancelStack);(0,v.default)(P)}},m.getVoice=function(){const i=this.opts.voiceIdx;return this.measureData.getVoice(i)};const c=_},322107:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(123491),u=t(476943),p=t(793317),x=t(575349),r=t(852363);const o=function(e,n,l){this.init(e,n,l)};o.NAME="primitive.RemovePreBend";const a=o.prototype;a.name=o.NAME,a.initMeasureData=p.default,a.init=function(e,n,l){this.initMeasureData(e,n),this.cancelStack=l,this.opts=n,this.note=null},a.perform=function(){this.removePreBend(),this.updateStack(),this.isTiedWithNextMeasure()&&this.signalNextMeasure()},a.removePreBend=function(){const e=this.getNote();h.default.removePreBend(e)},a.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,r.default)(this.cancelStack,this.measureData,this.opts)},a.isTiedWithNextMeasure=function(){const e=this.measureData.getVoice(this.opts.voiceIdx);if(this.noteIdx+1<e.getNbNotes())return!1;const n=this.getNote();return h.default.hasTieStart(n)},a.getNote=function(){if(this.note===null){let n=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);n=u.default.makeArray(n),this.note=n.find(x.A,this.opts)}return this.note},a.signalNextMeasure=function(){const{partIdx:e}=this.opts,n=this.opts.measureIdx+1,l={type:`${this.name}-close`,opts:{partIdx:e,measureIdx:n}};this.cancelStack.push(l),(0,r.default)(this.cancelStack,this.measureData,{partIdx:e,measureIdx:n})};const s=o},327558:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.ChangePitchedHead";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.changePitchedHead(),this.updateStack()},o.changePitchedHead=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.setHead(e,this.opts.notehead)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},328365:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(123491),u=t(852363),p=t(793317);const x=function(a,s,e){this.init(a,s,e)};x.NAME="primitive.RemoveGraceSlur";const r=x.prototype;r.initMeasureData=p.default,r.name=x.NAME,r.init=function(a,s,e){this.initMeasureData(a,s),this.cancelStack=e,this.opts=s},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeGraceSlur(),this.updateStack()},r.removeGraceSlur=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);h.default.setGraceSlur(s,!1)},r.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a),(0,u.default)(this.cancelStack,this.measureData,this.opts)};const o=x},332417:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(76004),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveColorFromGracePercu";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeColorFromGracePercu(),this.updateStack()},o.removeColorFromGracePercu=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.A)(s,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);h.default.removeColor(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},334282:(S,D,t)=>{t.d(D,{A:()=>f});var h=t(119634);const u=h.A;var p=t(643569),x=t(795510),r=t(424654),o=t(519405),a=t(793317),s=t(123491),e=t(292681);const n=function(v,_,m){this.init(v,_,m)};n.NAME="composite.DeleteGraceNotePercu";const l=n.prototype;l.name=n.NAME,l.initMeasureData=a.default,l.init=function(v,_,m){this.initMeasureData(v,_),this.cancelStack=m,this.opts=_},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlash(),this.removeColor(),this.removeGraceSlurIfLast(),this.deleteGraceNote()},l.removeSlash=function(){const _=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx);if(!s.default.isSlashedGrace(_))return;const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},d=new p.default(this.measureData,m,this.cancelStack);(0,o.default)(d)},l.removeColor=function(){const _=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx);if(!s.default.hasColor(_))return;const m=s.default.getUnpitched(_),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:e.default.copy(m)},c=new x.default(this.measureData,d,this.cancelStack);(0,o.default)(c)},l.removeGraceSlurIfLast=function(){const v={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},_=this.getVoice(),m=_.getNote(this.opts.noteIdx);if(_.getNbGraces(this.opts.noteIdx)===1&&s.default.hasGraceSlur(m)){const c=new r.default(this.measureData,v,this.cancelStack);(0,o.default)(c)}},l.deleteGraceNote=function(){const v={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new u(this.measureData,v,this.cancelStack).perform()},l.getVoice=function(){const v=this.opts.voiceIdx;return this.measureData.getVoice(v)};const f=n},334772:(S,D,t)=>{t.d(D,{A:()=>_});var h=t(364842),u=t(794799),p=t(123491),x=t(432456),r=t(925822),o=t(793317),a=t(698716);const e=function(m,d){let c=null;const i=m.getNbMeasures();for(let I=d.measureIdx;I<i;I++){const E=m.getMeasureData(I).getVoice(d.voiceIdx),P=E.size();for(c===null?c=d.noteIdx:c=0;c<P;c++){const O=a.A.create(I,c);if(a.A.isEqual(O,d))continue;const K=E.getNote(c);if(p.default.hasSlur(K))return null;if(!p.default.isRest(K))return O}}return null},l=function(m,d){let c=null;for(let i=d.measureIdx;i>=0;i--){const M=m.getMeasureData(i).getVoice(d.voiceIdx);for(c===null?c=d.noteIdx:c=M.size()-1;c>=0;c--){const E=a.A.create(i,c);if(a.A.isEqual(E,d))continue;const P=M.getNote(c);if(p.default.hasSlur(P))return null;if(!p.default.isRest(P))return E}}return null},f=function(m,d,c){this.init(m,d,c)};f.NAME="composite.DispatchSlurSide";const v=f.prototype;v.name=f.NAME,v.initMeasureData=o.default,v.init=function(m,d,c){this.initMeasureData(m,d),this.cancelStack=c,this.opts=d,this.slurType=null,this.newLocation=null},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.fetchSlurType(),this.fetchNewNoteIdx(),this.hasValidNoteIdx()?this.moveSlurSide():this.removeSlur()},v.fetchSlurType=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(p.default.hasSlur(d))this.slurType=p.default.getSlurType(d);else throw new h.default("SlurExpected")},v.fetchNewNoteIdx=function(){this.slurType===u.A.START?this.searchStartNoteIdx():this.slurType===u.A.STOP?this.searchStopNoteIdx():u.A.raiseError(this.slurType)},v.searchStartNoteIdx=function(){const m=this.measureData.getMeasuresScroller();this.newLocation=e(m,this.opts)},v.searchStopNoteIdx=function(){const m=this.measureData.getMeasuresScroller();this.newLocation=l(m,this.opts)},v.hasValidNoteIdx=function(){return this.newLocation!==null},v.moveSlurSide=function(){const m={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,oldMeasureIdx:this.opts.measureIdx,oldNoteIdx:this.opts.noteIdx,newMeasureIdx:this.newLocation.measureIdx,newNoteIdx:this.newLocation.noteIdx};new x.default(this.measureData,m,this.cancelStack).perform()},v.removeSlur=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new r.default(this.measureData,m,this.cancelStack).perform()};const _=f},337473:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(586654),u=t(971280),p=t(2110),x=t(123491),r=t(712947);const o=function(e,n,l){this.init(e,n,l)};o.NAME="composite.RemoveSlur";const a=o.prototype;a.name=o.NAME,a.getMeasuresScroller=p.A,a.init=function(e,n,l){this.measuresScroller=(0,p.A)(e,n),this.cancelStack=l,this.opts=n},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlurLeftSide(),this.removeSlurRightSide(),this.removeContinues()},a.getCurrentPlacement=function(){const l=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.opts.startNoteIdx),f=x.default.getSlur(l);return r.default.getPlacement(f)},a.removeSlurLeftSide=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.startNoteIdx},n=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);new h.A(n,e,this.cancelStack).perform()},a.removeSlurRightSide=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.stopNoteIdx},n=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);new h.A(n,e,this.cancelStack).perform()},a.removeContinues=function(){const e=this.opts.startMeasureIdx,n=this.opts.stopMeasureIdx;for(let l=e;l<n;l++)this.removeContinue(l)},a.removeContinue=function(e){const n={partIdx:this.opts.partIdx,measureIdx:e,voiceIdx:this.opts.voiceIdx},l=this.measuresScroller.getScoreData();new u.A(l,n,this.cancelStack).perform()};const s=o},342141:(S,D,t)=>{t.d(D,{A:()=>h});function h(u){let p=1;for(;typeof u[p]!="undefined";)p++;return p}},363297:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(546522);const u=h.A},369672:(S,D,t)=>{t.d(D,{A:()=>f});var h=t(364842),u=t(607682),p=t(330369),x=t(951066),r=t(31278),o=t(123491),a=t(407304),s=t(217149),e=t(793317);const n=function(v,_,m){this.init(v,_,m)};n.NAME="composite.RemoveVoiceTupletsAfter";const l=n.prototype;l.initMeasureData=e.default,l.name=n.NAME,l.init=function(v,_,m){this.initMeasureData(v,_),this.cancelStack=m,this.opts=_},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,s.A)(this.measureData,this.opts),this.measureData.clearTupletCache(this.opts.voiceIdx),this.removeTuplets()},l.removeTuplets=function(){const v=this.getVoice();let _=v.getStopNoteIdx();for(;_>=this.opts.noteIdx;){const m=v.getNote(_);if(o.default.hasTupletStop(m)){const d=this.removeTuplet(_);_-=d}else _--}},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},l.removeTuplet=function(v){const _=this.getTuplet(v),m=_.size(),d=_.getStopNoteIdx();return this.strictRemoveTuplet(d),this.clearTupletCache(),m},l.getTuplet=function(v){const _=this.opts.voiceIdx;return this.measureData.getVoiceOrTupletForGet(_,v)},l.strictRemoveTuplet=function(v){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:v},m=new a.default(this.measureData,_,this.cancelStack);try{m.checkPreconditions(),m.perform()}catch(d){if(d instanceof p.A)throw d;if(d instanceof u.default||d instanceof x.A||d instanceof r.default){const c=`An action has failed while performing a [RemoveVoiceTupletsAfter]. The score should be still consistent. Here is the error message: ${d.message}`,i=new h.default("UnexpectedError",c);throw i.parent=d,i}else throw d}},l.clearTupletCache=function(){this.measureData.clearTupletCache(this.opts.voiceIdx)};const f=n},370110:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.AddColorToNote";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.addColor(),this.updateStack()},o.addColor=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.setColor(e,this.opts.color)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},377706:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(701387),u=t(558280),p=t(889484),x=t(316610);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveWedgesFrom";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null,this.limitTimePos=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeWedgesFrom()},o.removeWedgesFrom=function(){this.getWedgesStarts().forEach(this.removeWedge,this),this.getWedgesStops().forEach(this.removeWedge,this)},o.getWedgesStarts=function(){let s=this.getWedges();return s=s.filter(u.A.isLeft),s},o.getWedgesStops=function(){let s=this.getWedges();return s=s.filter(u.A.isRight),s},o.getWedges=function(){const s=this.getMeasure();let e=h.default.getWedges(s,this.opts.staffIdx);return e=e.filter(this.isBeyoudLimit,this),e},o.isBeyoudLimit=function(s){const e=this.getLimitTimePos();return u.A.getTimePos(s)>=e},o.getLimitTimePos=function(){if(this.limitTimePos===null){const s=this.getMeasure();this.limitTimePos=(0,x.A)(this.opts,s)}return this.limitTimePos},o.removeWedge=function(s){const e=u.A.getTimePos(s),n=u.A.getStaffIdx(s),l=this.getMeasure(),f=h.default.getDpq(l),v={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:e,dpq:f,staffIdx:n};new p.default(this.scoreData,v,this.cancelStack).perform()},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},378916:(S,D,t)=>{t.d(D,{A:()=>n});var h=t(292681),u=t(123491),p=t(14302),x=t(795510),r=t(519405),o=t(793317);const a=function(l,f,v){this.init(l,f,v)};a.NAME="composite.RemoveGraceFromChordPercu";const s=a.prototype;s.name=a.NAME,s.initMeasureData=o.default,s.init=function(l,f,v){this.initMeasureData(l,f),this.cancelStack=v,this.opts=f},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const l=this.getNoteData();this.removeColor(l),this.removeGraceFromChordPercu()},s.getNoteData=function(){const f=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx),v=e(f);return{staffIdx:u.default.getStaffIdx(f),color:v}};function e(l){return u.default.hasColor(l)?u.default.getColor(l):null}s.removeGraceFromChordPercu=function(){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:h.default.copy(this.opts.unpitched)};new p.A(this.measureData,l,this.cancelStack).perform()},s.removeColor=function(l){if(l.color===null)return;const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:h.default.copy(this.opts.unpitched)},v=new x.default(this.measureData,f,this.cancelStack);(0,r.default)(v)},s.getVoice=function(){const l=this.opts.voiceIdx;return this.measureData.getVoice(l)};const n=a},379084:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(793317),u=t(762860),p=t(852363),x=t(123491),r=t(964845),o=t(359932);const a=function(n,l,f){this.init(n,l,f)};a.NAME="primitive.SetGraceFret";const s=a.prototype;s.name=a.NAME,s.initMeasureData=h.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.opts=l,this.cancelStack=f},s.perform=function(){const n=this.measureData.getVoice(this.opts.voiceIdx),l=(0,u.A)(n,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);this.addTechnical(l,o.default.FRET),this.addTechnical(l,o.default.STRING),this.updateCancelStack()},s.addTechnical=function(n,l){const f=r.A.getTechnicalOpts(this.opts.fretData,l);x.default.addTechnical(n,l,f)},s.updateCancelStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const e=a},379668:(S,D,t)=>{t.d(D,{A:()=>r});var h=t(109049),u=t(512476),p=t(813864),x=t(948507);function r(o,a,s){if(o=(0,p.A)(o),(0,u.A)(o).hasMultiMeasureRest(a.measureIdx)){const n={measureIdx:a.measureIdx},l=new h.default(o,n,s);(0,x.default)(l)}}},406765:(S,D,t)=>{t.d(D,{A:()=>n});var h=t(701387),u=t(368495),p=t(97324),x=t(253941),r=t(316610);const o=function(l,f,v){this.init(l,f,v)};o.NAME="composite.RemovePluckedRangesFrom";const a=o.prototype;a.name=o.NAME,a.init=function(l,f,v){this.scoreData=l,this.cancelStack=v,this.opts=f,this.measure=null,this.limitTimePos=null},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePluckedRangesFrom()},a.removePluckedRangesFrom=function(){this.getPluckedRangesStarts().forEach(this.removePluckedRange,this),this.getPluckedRangesStops().forEach(this.removePluckedRange,this)},a.getPluckedRangesStarts=function(){let l=this.getPluckedRanges();return l=l.filter(s),l};const s=function(l){const f=u.A.getType(l);return p.A.isStart(f)};a.getPluckedRangesStops=function(){let l=this.getPluckedRanges();return l=l.filter(e),l};const e=function(l){const f=u.A.getType(l);return p.A.isStop(f)};a.getPluckedRanges=function(){const l=this.getMeasure();let f=h.default.getPluckedRanges(l,this.opts.staffIdx);return f=f.filter(this.isBeyoudLimit,this),f},a.isBeyoudLimit=function(l){const f=this.getLimitTimePos();return u.A.getTimePos(l)>=f},a.getLimitTimePos=function(){if(this.limitTimePos===null){const l=this.getMeasure();this.limitTimePos=(0,r.A)(this.opts,l)}return this.limitTimePos},a.removePluckedRange=function(l){const f=u.A.getTimePos(l),v=u.A.getStaffIdx(l),_=this.getMeasure(),m=h.default.getDpq(_),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:f,dpq:m,staffIdx:v};new x.default(this.scoreData,d,this.cancelStack).perform()},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const n=o},408790:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(364842),u=t(123491),p=t(209175),x=t(961214),r=t(867085);const o=function(e,n,l,f){const v=a(e,n,l),_=(0,x.A)(e,v),d=(0,r.A)(e,v,_).getAbsoluteTimeModif();return p.default.isCompatible(f,d)},a=function(e,n,l){let f=0;const v=e.size();let _=0;for(;_<v&&f<l;_++){const m=e.getNote(_),d=u.default.getDuration(m);f+=d*n}if(_===v&&f<=l)throw new h.default("Unexpected");if(f===l)return _;if(e.isRest(_-1))return _-1;throw new h.default("Unreachable")},s=o},411146:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(607682);function u(r){return`Cannot at a middle measure ${r} at the begining of the measure. `}class p extends h.default{constructor(o){const a=u(o);super(a),Object.defineProperty(this,"entityType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="MiddleMeasureNullTimePosError",this.entityType=o}}Object.defineProperty(p,"PART",{enumerable:!0,configurable:!0,writable:!0,value:"part"});const x=p},416961:(S,D,t)=>{t.d(D,{A:()=>A});var h=t(529355),u=t(681670),p=t(74957),x=t(902630),r=t(364842),o=t(701387),a=t(614653),s=t(726042),e=t(210888),n=t(606106),l=t(316610),f=t(310868),v=t(381216),_=t(464173),m=t(865349),d=t(369049),c=Object.defineProperty,i=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,E=(g,T,y)=>T in g?c(g,T,{enumerable:!0,configurable:!0,writable:!0,value:y}):g[T]=y,P=(g,T)=>{for(var y in T||(T={}))I.call(T,y)&&E(g,y,T[y]);if(i)for(var y of i(T))M.call(T,y)&&E(g,y,T[y]);return g};const O=[{chordKind:_.A.MINOR_7,allDegrees:[p.A.create(3,v.A.ADD,-1),p.A.create(5,v.A.ADD,-1),p.A.create(7,v.A.ADD,0)]},{chordKind:_.A.MAJOR_7,allDegrees:[p.A.create(3,v.A.ADD,0),p.A.create(5,v.A.ADD,1),p.A.create(7,v.A.ADD,1)]},{chordKind:_.A.MAJOR_9,allDegrees:[p.A.create(3,v.A.ADD,0),p.A.create(5,v.A.ADD,1),p.A.create(7,v.A.ADD,1),p.A.create(9,v.A.ADD,0)]},{chordKind:_.A.MAJOR_11,allDegrees:[p.A.create(3,v.A.ADD,0),p.A.create(5,v.A.ADD,1),p.A.create(7,v.A.ADD,1),p.A.create(9,v.A.ADD,0),p.A.create(11,v.A.ADD,0)]},{chordKind:_.A.MAJOR_13,allDegrees:[p.A.create(3,v.A.ADD,0),p.A.create(5,v.A.ADD,1),p.A.create(7,v.A.ADD,1),p.A.create(9,v.A.ADD,0),p.A.create(11,v.A.ADD,0),p.A.create(13,v.A.ADD,0)]}],K=[..._.A.values.map(g=>({chordKind:g,allDegrees:(0,m.A)(g)})),...O];function w(g){const T=K.map(y=>{const Y=(0,d.A)(g,y);return P({distanceData:Y},y)});return T.sort(k),T[0].chordKind}function k(g,T){return g=g.distanceData,T=T.distanceData,g.total!==T.total?g.total-T.total:!g.isSameBase&&T.isSameBase?1:g.isSameBase&&!T.isSameBase?-1:0}var R=t(184469);function L(g,T){const y=(0,f.A)(g,T),Y=w({chordKind:g,allDegrees:y}),Z=(0,R.A)(Y,y);return{adagioKind:g,mxlKind:Y,mxlDegrees:Z}}var j=t(852363);const V=function(g,T,y){this.init(g,T,y)};V.NAME="primitive.AddHarmony";const J=V.prototype;J.name=V.NAME,J.init=function(g,T,y){this.scoreData=g,this.cancelStack=y,this.opts=T,this.measure=null,this.harmonyIdx=null,this.localTimePos=null},J.perform=function(){const g=this.getHarmonyIdx(),T=this.createHarmony();this.addHarmony(T,g),this.updateStack()},J.getHarmonyIdx=function(){return this.harmonyIdx===null&&this.fetchHarmonyIdx(),this.harmonyIdx},J.fetchHarmonyIdx=function(){const g=this.getMeasure(),T=o.default.getJazzHarmonies(g);if(T.some(this.tryHarmonyIdx,this),this.harmonyIdx===null){const y=T.length;this.harmonyIdx=y}},J.tryHarmonyIdx=function(g,T){const y=this.getLocalTimePos(),Y=a.default.getTimePos(g);if(Y<y)return!1;if(Y>y)return this.harmonyIdx=T,!0;{const Z="There is already an harmony at this time position.";throw new r.default("TimePosCollision",Z)}},J.createHarmony=function(){const g=h.A.copy(this.opts.root),{adagioKind:T,mxlKind:y,mxlDegrees:Y}=L(this.opts.kind,this.opts.degrees),Z=a.default.create(g,y);a.default.setAdagioKind(Z,T);const C=this.getLocalTimePos();if(a.default.setTimePos(Z,C),this.opts.bass!==null){const W=u.A.copy(this.opts.bass);a.default.setBass(Z,W)}if(a.default.setDegrees(Z,Y),a.default.setType(Z,this.opts.type),this.opts.frame){const W=x.default.copy(this.opts.frame);a.default.setFrame(Z,W)}const U=e.default.generate();return this.cancelStack.addEntityUuid({entityType:n.A.JAZZ_HARMONY,uuid:U}),a.default.setHarmonyUuid(Z,U),Z},J.addHarmony=function(g,T){const y=this.getMeasure(),Y=o.default.getJazzHarmonies(y);Y.splice(T,0,g),o.default.setJazzHarmonies(y,Y)},J.updateStack=function(){const g={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(g),(0,j.default)(this.cancelStack,this.scoreData,this.opts)},J.getDpq=function(){const g=this.getMeasure();return o.default.getDpq(g)},J.getLocalTimePos=function(){if(this.localTimePos===null){const g=this.getMeasure();if(this.localTimePos=(0,l.A)(this.opts,g),!s.default.isInteger(this.localTimePos)){const T=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new r.default("IntegerExpected",T)}}return this.localTimePos},J.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const G=V;var z=t(746822),F=t(379668);const tt=function(g,T,y){this.init(g,T,y)};tt.NAME="composite.AddHarmony";const b=tt.prototype;b.name=tt.NAME,b.init=function(g,T,y){this.scoreData=g,this.cancelStack=y,this.opts=T},b.perform=function(){this.removeMmr(),this.updateDpq(),this.addHarmony()},b.removeMmr=function(){(0,F.A)(this.scoreData,this.opts,this.cancelStack)},b.updateDpq=function(){const g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new z.A(this.scoreData,g,this.cancelStack).perform()},b.addHarmony=function(){const g=h.A.copy(this.opts.root),T=N(this.opts.bass),y=B(this.opts.frame),Y=this.opts.degrees.map(p.A.copy),Z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:g,kind:this.opts.kind,bass:T,degrees:Y,frame:y,type:this.opts.type};new G(this.scoreData,Z,this.cancelStack).perform()};const N=function(g){return g===null?g:u.A.copy(g)};function B(g){return g?x.default.copy(g):null}const H=tt;var $=t(228546);const q=function(g,T,y){this.init(g,T,y)};q.NAME="composite.AddHarmonyErase";const et=q.prototype;et.name=q.NAME,et.init=function(g,T,y){this.scoreData=g,this.cancelStack=y,this.opts=T},et.perform=function(){this.removeFormerHarmony(),this.addHarmony()},et.removeFormerHarmony=function(){const g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new $.default(this.scoreData,g,this.cancelStack).performIfPossible()},et.addHarmony=function(){const g=h.A.copy(this.opts.root),T=st(this.opts.bass),y=ot(this.opts.frame),Y=this.opts.degrees.map(p.A.copy),Z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:g,kind:this.opts.kind,bass:T,degrees:Y,type:this.opts.type,frame:y};new H(this.scoreData,Z,this.cancelStack).perform()};const st=function(g){return g===null?g:u.A.copy(g)};function ot(g){return g?x.default.copy(g):null}const A=q},418621:(S,D,t)=>{t.d(D,{A:()=>m});var h=t(351277),u=t(123491),p=t(511890),x=t(417477),r=t(793317),o=t(691309),a=t(364842);function s(d,c){const I=d.getLeftChord().find(e,c);if(I)return u.default.getPitch(I);throw new a.default("Unexpected",`There is no slide start with the number ${c}`)}function e(d){const c=this.valueOf();return u.default.getSlideStarts(d).some(n,c)}function n(d){const c=this.valueOf();return p.default.getNumber(d)===c}var l=t(519405);const f=function(d,c,i){this.init(d,c,i)};f.NAME="composite.RemoveHeadLeftSlides";const v=f.prototype;v.name=f.NAME,v.initMeasureData=r.default,v.init=function(d,c,i){this.initMeasureData(d,c),this.opts=c,this.cancelStack=i,this.crossMeasure=new o.default(this.measureData,c.voiceIdx,c.noteIdx-1)},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHeadLeftSlides()},v.removeHeadLeftSlides=function(){this.getSlideStops().map(p.default.getNumber).map(this.findLeftPitch,this).forEach(this.removeSlide,this)},v.getSlideStops=function(){const c=this.crossMeasure.getRightChord().find(_,this.opts.pitch);return u.default.getSlideStops(c)};function _(d){const c=this,i=u.default.getPitch(d);return h.default.isSameLine(i,c)}v.findLeftPitch=function(d){return s(this.crossMeasure,d)},v.removeSlide=function(d){const c=this.crossMeasure.getLeftMeasureIdx(),i=this.crossMeasure.getLeftNoteIdx(),I={partIdx:this.opts.partIdx,measureIdx:c,voiceIdx:this.opts.voiceIdx,noteIdx:i,leftPitch:h.default.copy(d),rightPitch:h.default.copy(this.opts.pitch)},M=this.crossMeasure.getLeftMeasure(),E=new x.default(M,I,this.cancelStack);(0,l.default)(E)};const m=f},424863:(S,D,t)=>{t.d(D,{A:()=>c});var h=t(372585),u=t(446921),p=t(435237),x=t(31278),r=t(345912),o=t(852363),a=t(701387);const s=function(i,I,M){this.init(i,I,M)};s.NAME="primitive.RemoveOctaveShift";const e=s.prototype;e.name=s.NAME,e.init=function(i,I,M){this.scoreData=i,this.cancelStack=M,this.opts=I,this.removedOctaveShift=null,this.octaveShifts=null,this.octaveShiftIdx=null},e.perform=function(){this.removeOctaveShift(),this.updateStack()},e.removeOctaveShift=function(){const i=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),I=a.default.getOctaveShifts(i,this.opts.staffIdx),M=this.getOctaveShiftIdx(),E=I.splice(M,1);if(this.removedOctaveShift=E[0],r.A.isStart(this.removedOctaveShift)){const P=r.A.getOctaveShiftUuid(this.removedOctaveShift),O=this.scoreData.getPartContent(this.opts.partIdx);u.A.removeOctaveShift(O,P)}a.default.setOctaveShifts(i,this.opts.staffIdx,I)},e.updateStack=function(){const i=this.getMeasure(),I=a.default.getDivisions(i),M=this.removedOctaveShift,E=r.A.getStaffIdx(M),P=r.A.getPlacement(M),O=r.A.getType(M),K=r.A.getSize(M),w={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:I,staffIdx:E,placement:P,type:O,size:K}};this.cancelStack.push(w),(0,o.default)(this.cancelStack,this.scoreData,this.opts)},e.getOctaveShiftIdx=function(){return this.octaveShiftIdx===null&&this.fetchOctaveShiftIdx(),this.octaveShiftIdx},e.fetchOctaveShiftIdx=function(){if(this.octaveShiftIdx=null,this.getOctaveShifts().some(this.checkOctaveShift,this),this.octaveShiftIdx===null)throw new x.default},e.checkOctaveShift=function(i,I){const M=r.A.getTimePos(i),E=r.A.getType(i),P=r.A.getSize(i);return M<this.opts.timePos?!1:M===this.opts.timePos?E===this.opts.type&&P===this.opts.size?(this.octaveShiftIdx=I,!0):!1:!0},e.getOctaveShifts=function(){if(this.octaveShifts===null){const i=this.getMeasure();this.octaveShifts=a.default.getOctaveShifts(i,this.opts.staffIdx)}return this.octaveShifts},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const n=s;var l=t(364842);const f=function(i,I,M){this.init(i,I,M)};f.NAME="primitive.RemoveOctaveShiftContinue";const v=f.prototype;v.name=f.NAME,v.init=function(i,I,M){this.scoreData=i,this.cancelStack=M,this.opts=I,this.removedOctaveShiftDirection=null},v.perform=function(){this.removeLeftOctaveShift(),this.removeRightOctaveShift(),this.updateStack()},v.removeLeftOctaveShift=function(){const i=this.getLeftMeasure();if(!a.default.hasRightOctaveShift(i,this.opts.staffIdx)){const I="There is no right octave shift to remove on the left measure.";throw new l.default("MissingRightContinueOctaveShift",I)}this.removedOctaveShiftDirection=a.default.getRightOctaveShift(i,this.opts.staffIdx),a.default.removeRightOctaveShift(i,this.opts.staffIdx)},v.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},v.removeRightOctaveShift=function(){const i=this.getRightMeasure();if(!a.default.hasLeftOctaveShift(i,this.opts.staffIdx)){const I="There is no left octave shift to remove on the left measure.";throw new l.default("MissingLeftContinueOctaveShift",I)}a.default.removeLeftOctaveShift(i,this.opts.staffIdx)},v.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},v.updateStack=function(){const i=this.removedOctaveShiftDirection,I=r.A.getStaffIdx(i),M=r.A.getPlacement(i),E={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:I,placement:M}};this.cancelStack.push(E),(0,o.default)(this.cancelStack,this.scoreData,this.opts)};const _=f,m=function(i,I,M){this.init(i,I,M)};m.NAME="composite.RemoveOctaveShift";const d=m.prototype;d.name=m.NAME,d.init=function(i,I,M){this.scoreData=i,this.cancelStack=M,this.opts=I,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null,this.type=null,this.size=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},d.searchSides=function(){const i=this.getMeasures(),I=(0,p.A)(i,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=I.startMeasureIdx,this.startTimePos=I.startTimePos,this.stopMeasureIdx=I.stopMeasureIdx,this.stopTimePos=I.stopTimePos,this.type=I.type,this.size=I.size},d.getMeasures=function(){const i=this.scoreData.getPartContent(this.opts.partIdx);return u.A.getMeasures(i)},d.removeStart=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,type:this.type,size:this.size};new n(this.scoreData,i,this.cancelStack).perform()},d.removeStop=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,type:h.A.STOP,size:this.size};new n(this.scoreData,i,this.cancelStack).perform()},d.removeContinues=function(){for(let i=this.startMeasureIdx;i<this.stopMeasureIdx;i++)this.removeContinue(i)},d.removeContinue=function(i){const I={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:i};new _(this.scoreData,I,this.cancelStack).perform()};const c=m},435237:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(756042);const u=h.A},438896:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(852363),u=t(364842),p=t(726042),x=t(701387);const r=function(e,n,l){this.init(e,n,l)};r.NAME="primitive.RemovePizzicato";const o=r.prototype;o.name=r.NAME,o.init=function(e,n,l){this.scoreData=e,this.cancelStack=l,this.opts=n},o.perform=function(){this.removePizzicato(),this.updateStack()},o.removePizzicato=function(){const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),n=x.default.getPizzicatos(e,this.opts.staffIdx),l=n.length;a(this.opts.pizzicatoIdx,l),n.splice(this.opts.pizzicatoIdx,1),x.default.setPizzicatos(e,this.opts.staffIdx,n)};const a=function(e,n){if(!p.default.isInteger(e)||e<0||e>=n){const l=`Invalid pizzicatoIdx: [${e}].`;throw new u.default("BadPizzicatoIdx",l)}};o.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,h.default)(this.cancelStack,this.scoreData,this.opts)};const s=r},446625:(S,D,t)=>{t.d(D,{A:()=>J});var h=t(351277),u=t(476943),p=t(123491),x=t(701387),r=t(13800);const o=r.A;var a=t(645166),s=t(130412),e=t(321097),n=t(708836),l=t(30335),f=t(691120),v=t(714015),_=t(540781),m=t(909103),d=t(244651),c=t(330179),i=t(310107),I=t(165259),M=t(793317),E=t(578918),P=t(519405),O=t(882078),K=t(253916),w=t(155010),k=t(158553),R=t(353922),L=t(760367);const j=function(G,z,F){this.init(G,z,F)};j.NAME="composite.RemoveFromChord";const V=j.prototype;V.name=j.NAME,V.initMeasureData=M.default,V.init=function(G,z,F){this.initMeasureData(G,z),this.cancelStack=F,this.opts=z,this.voice=null,this.chordHead=null},V.perform=function(){this.cancelStack=this.cancelStack.createSubstack();const G=this.getPreviousData();this.removeTie(),this.removeHammerOnPullOffs(),this.removeCourtesyAccidental(),this.removeGhostNote(),this.removeNotehead(G),this.removeFingering(),this.removeColor(),this.removeHarmonic(),this.removeBend(),this.removeTieDirection(),this.removeOrphanGlissandoStarts(),this.removeOrphanGlissandoStops(),this.removeGlissandos(),this.removeSlides(),this.removeArpeggioIfNeeded(),this.removeFromChord(),this.updateAccidental(G),this.isTab()&&this.updateChordsFrets()},V.getPreviousData=function(){const G=this.getChordHead(),z=p.default.getHead(G);return{staffIdx:p.default.getStaffIdx(G),notehead:z}},V.getChordHead=function(){if(this.chordHead===null){const G=this.getVoice();this.chordHead=(0,E.default)(G,this.opts.noteIdx,this.opts.pitch)}return this.chordHead},V.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},V.removeTie=function(){const G=this.getChordHead();if(!p.default.hasTie(G))return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,step:h.default.getStep(this.opts.pitch),octave:h.default.getOctave(this.opts.pitch)},F=new e.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeHammerOnPullOffs=function(){const G=this.getChordHead();if(!p.default.hasHammerOnPullOffStart(G)&&!p.default.hasHammerOnPullOffStop(G))return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)},F=new l.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeCourtesyAccidental=function(){const G=this.getChordHead();if(!p.default.hasCourtesyAccidental(G))return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)},F=new f.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeGhostNote=function(){const G=this.getChordHead();if(!p.default.hasHeadParentheses(G))return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)},F=new v.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeNotehead=function({notehead:G}){if(G!==R.A.NORMAL&&R.A.isValidPitched(G)){const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch),notehead:R.A.NORMAL},F=new _.default(this.measureData,z,this.cancelStack);(0,P.default)(F)}},V.removeFingering=function(){const G=this.getChordHead();if(!p.default.hasFingering(G))return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)},F=new m.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeColor=function(){const G=this.getChordHead();if(!p.default.hasColor(G))return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)},F=new d.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeHarmonic=function(){const G=this.getChordHead(),z=p.default.getPitch(G);if(!p.default.hasHarmonic(G))return;const F={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(z)},tt=new I.default(this.measureData,F,this.cancelStack);(0,P.default)(tt)},V.removeBend=function(){const G=this.getChordHead();if(!p.default.hasBend(G)||!p.default.hasFretData(G))return;const z=p.default.getFretData(G),F=h.default.copy(this.opts.pitch),tt={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:F,fretData:z},b=new c.default(this.measureData,tt,this.cancelStack);(0,P.default)(b)},V.removeTieDirection=function(){const G=this.getChordHead();if(p.default.getTieDirection(G)===L.A.AUTO)return;const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch),tieDirection:L.A.AUTO},F=new i.default(this.measureData,z,this.cancelStack);(0,P.default)(F)},V.removeOrphanGlissandoStarts=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(this.opts.pitch)};new O.A(this.measureData,G,this.cancelStack).perform()},V.removeOrphanGlissandoStops=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(this.opts.pitch)};new K.A(this.measureData,G,this.cancelStack).perform()},V.removeGlissandos=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)};new w.A(this.measureData,G,this.cancelStack).perform()},V.removeSlides=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)};new k.A(this.measureData,G,this.cancelStack).perform()},V.removeArpeggioIfNeeded=function(){const G=this.getVoice(),z=G.getNote(this.opts.noteIdx);if(!p.default.hasArpeggiate(z))return;let F=G.getChord(this.opts.noteIdx);if(F=u.default.makeArray(F),F.length===2){const tt={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},b=new n.default(this.measureData,tt,this.cancelStack);(0,P.default)(b)}},V.removeFromChord=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)};new o(this.measureData,G,this.cancelStack).perform()},V.updateAccidental=function(G){const z={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:G.staffIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)};new a.A(this.measureData,z,this.cancelStack).perform()},V.isTab=function(){const G=this.measureData.getMeasure();return x.default.isTab(G)},V.updateChordsFrets=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new s.A(this.measureData,G,this.cancelStack).perform()};const J=j},447770:(S,D,t)=>{t.d(D,{A:()=>n});var h=t(701387),u=t(345912),p=t(372585),x=t(933516),r=t(316610);const o=function(l,f,v){this.init(l,f,v)};o.NAME="composite.RemoveOctaveShiftsFrom";const a=o.prototype;a.name=o.NAME,a.init=function(l,f,v){this.scoreData=l,this.cancelStack=v,this.opts=f,this.measure=null,this.limitTimePos=null},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeOctaveShiftsFrom()},a.removeOctaveShiftsFrom=function(){this.getOctaveShiftsStarts().forEach(this.removeOctaveShift,this),this.getOctaveShiftsStops().forEach(this.removeOctaveShift,this)},a.getOctaveShiftsStarts=function(){let l=this.getOctaveShifts();return l=l.filter(s),l};const s=function(l){const f=u.A.getType(l);return f===p.A.UP||f===p.A.DOWN};a.getOctaveShiftsStops=function(){let l=this.getOctaveShifts();return l=l.filter(e),l};const e=function(l){return u.A.getType(l)===p.A.STOP};a.getOctaveShifts=function(){const l=this.getMeasure();let f=h.default.getOctaveShifts(l,this.opts.staffIdx);return f=f.filter(this.isBeyoudLimit,this),f},a.isBeyoudLimit=function(l){const f=this.getLimitTimePos();return u.A.getTimePos(l)>=f},a.getLimitTimePos=function(){if(this.limitTimePos===null){const l=this.getMeasure();this.limitTimePos=(0,r.A)(this.opts,l)}return this.limitTimePos},a.removeOctaveShift=function(l){const f=u.A.getTimePos(l),v=u.A.getStaffIdx(l),_=this.getMeasure(),m=h.default.getDpq(_),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:f,dpq:m,staffIdx:v};new x.default(this.scoreData,d,this.cancelStack).perform()},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const n=o},451183:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(852363),u=t(793317),p=t(123491);const x=function(a,s,e){this.init(a,s,e)};x.NAME="primitive.RemoveOrnament";const r=x.prototype;r.name=x.NAME,r.initMeasureData=u.default,r.init=function(a,s,e){this.initMeasureData(a,s,e),this.cancelStack=e,this.opts=s},r.perform=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),e=p.default.getOrnamentOpts(s,this.opts.ornamentType);p.default.removeOrnament(s,this.opts.ornamentType),this.updateStack(e)},r.updateStack=function(a){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,ornamentType:this.opts.ornamentType,ornamentsOpts:a,noteIdx:this.opts.noteIdx}};this.cancelStack.push(s),(0,h.default)(this.cancelStack,this.measureData,this.opts)};const o=x},486110:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(474765);const u=h.A},497306:(S,D,t)=>{t.d(D,{A:()=>_});var h=t(364842),u=t(31278),p=t(504005),x=t(310107),r=t(2110),o=t(519405),a=t(476943),s=t(123491),e=t(351277),n=t(760367);const l=function(m,d,c){this.init(m,d,c)};l.NAME="composite.AddChordsTies";const f=l.prototype;f.name=l.NAME,f.init=function(m,d,c){this.measuresScroller=(0,r.A)(m,d),this.cancelStack=c,this.opts=d},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addChordsTies()},f.addChordsTies=function(){this.opts.chordsTies.forEach(this.addChordTies,this)},f.addChordTies=function(m){let i=this.measuresScroller.getMeasureData(m.measureIdx).getVoice(m.voiceIdx).getChord(m.noteIdx);i=a.default.makeArray(i);const I=i.map(s.default.getPitch);if(I.sort(e.default.naiveComparePitch),I.length!==m.tiesList.length)throw new h.default("Unexpected","The number of notes between the dump and the actual data should be the same.");this.chordTiesData=m,I.forEach(this.addTieArc,this)},f.addTieArc=function(m,d){const c=this.chordTiesData.tiesList[d];if(c.tied){{const i={partIdx:this.opts.partIdx,measureIdx:this.chordTiesData.measureIdx,voiceIdx:this.chordTiesData.voiceIdx,noteIdx:this.chordTiesData.noteIdx,step:e.default.getStep(m),octave:e.default.getOctave(m)},I=this.measuresScroller.getMeasureData(i.measureIdx),M=new p.default(I,i,this.cancelStack);(0,o.default)(M,p.default.isAuthorizedException)}if(c.tieDirection===n.A.FLIPPED){const i={partIdx:this.opts.partIdx,measureIdx:this.chordTiesData.measureIdx,voiceIdx:this.chordTiesData.voiceIdx,noteIdx:this.chordTiesData.noteIdx,pitch:e.default.copy(m),tieDirection:c.tieDirection},I=this.measuresScroller.getMeasureData(i.measureIdx),M=new x.default(I,i,this.cancelStack);(0,o.default)(M,v)}}};function v(m){return m instanceof u.default}const _=l},509319:(S,D,t)=>{t.d(D,{A:()=>m});var h=t(378432),u=t(351277);const p=function(d,c){const i={};d.forEach(x,i);const I={error:[],valid:[]};let M=r(d,c,I);return M=s(M,I),M=n(M,I,i),v(M,I),I.valid.concat(I.error)},x=function(d){const c=this,i=a(d);c[i]=!0},r=function(d,c,i){const I=[],M={transpose:c,entries:i,wrappedPitches:I};return d.forEach(o,M),I},o=function(d){const c=this;let i;try{i=u.default.transpose(d,c.transpose,!0)}catch(P){if(P instanceof h.A){c.entries.error.push(d);return}else throw P}const I=a(d),M=a(i),E={fromPitch:d,fromKey:I,toPitch:i,toKey:M};c.wrappedPitches.push(E)},a=function(d){return d=u.default.copyWithoutAlter(d),u.default.stringify(d)},s=function(d,c){const i=[],I={entries:c,remaining:i};return d.forEach(e,I),i},e=function(d){const c=this;d.fromKey===d.toKey?c.entries.valid.push(d.fromPitch):c.remaining.push(d)},n=function(d,c,i){let I=l(d,c,i);for(;I.length!==d.length;)d=I,I=l(d,c,i);return I},l=function(d,c,i){const I=[],M={entries:c,remaining:I,usedMap:i};return d.forEach(f,M),I},f=function(d){const c=this,i=c.usedMap;i[d.toKey]?c.remaining.push(d):(delete i[d.fromKey],i[d.toKey]=!0,c.entries.valid.push(d.fromPitch))},v=function(d,c){d.forEach(_,c)},_=function(d){this.error.push(d.fromPitch)},m=p},544885:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(793317),u=t(762860),p=t(852363),x=t(123491),r=t(359932);const o=function(e,n,l){this.init(e,n,l)};o.NAME="primitive.UnsetGraceFret";const a=o.prototype;a.name=o.NAME,a.initMeasureData=h.default,a.init=function(e,n,l){this.initMeasureData(e,n),this.opts=n,this.cancelStack=l},a.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},a.getGraceAtPitch=function(){const e=this.getVoice();return(0,u.A)(e,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},a.perform=function(){const e=this.getGraceAtPitch();x.default.removeTechnical(e,r.default.FRET),x.default.removeTechnical(e,r.default.STRING),this.updateCancelStack()},a.updateCancelStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const s=o},557830:(S,D,t)=>{t.d(D,{A:()=>n});var h=t(701387),u=t(584416),p=t(868743),x=t(605268),r=t(316610);const o=function(l,f,v){this.init(l,f,v)};o.NAME="composite.RemovePedalsFrom";const a=o.prototype;a.name=o.NAME,a.init=function(l,f,v){this.scoreData=l,this.cancelStack=v,this.opts=f,this.measure=null,this.limitTimePos=null},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePedalsFrom()},a.removePedalsFrom=function(){this.getPedalsStarts().forEach(this.removePedal,this),this.getPedalsStops().forEach(this.removePedal,this)},a.getPedalsStarts=function(){let l=this.getPedals();return l=l.filter(s),l};const s=function(l){return u.A.getType(l)===p.A.START};a.getPedalsStops=function(){let l=this.getPedals();return l=l.filter(e),l};const e=function(l){return u.A.getType(l)===p.A.STOP};a.getPedals=function(){const l=this.getMeasure();let f=h.default.getPedals(l,this.opts.staffIdx);return f=f.filter(this.isBeyoudLimit,this),f},a.isBeyoudLimit=function(l){const f=this.getLimitTimePos();return u.A.getTimePos(l)>=f},a.getLimitTimePos=function(){if(this.limitTimePos===null){const l=this.getMeasure();this.limitTimePos=(0,r.A)(this.opts,l)}return this.limitTimePos},a.removePedal=function(l){const f=u.A.getTimePos(l),v=u.A.getStaffIdx(l),_=this.getMeasure(),m=h.default.getDpq(_),d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:f,dpq:m,staffIdx:v};new x.default(this.scoreData,d,this.cancelStack).perform()},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const n=o},561262:(S,D,t)=>{t.d(D,{A:()=>d});var h=t(123491),u=t(351277),p=t(916045),x=t(728675),r=t(689582),o=t(550601),a=t(545496),s=t(578918),e=t(762860),n=t(382536),l=t(793317);const f=function(c,i,I){this.init(c,i,I)};f.NAME="composite.UpdateGraceAccidental";const v=f.prototype;v.initMeasureData=l.default,v.name=f.NAME,v.init=function(c,i,I){this.initMeasureData(c,i),this.cancelStack=I,this.opts=i},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);let c=this.getPreviousAlter();c=this.updateCurrentAccidental(c),this.updateNextAccidental(c)},v.getPreviousAlter=function(){return(0,a.A)(this.measureData,this.opts.noteIdx,this.opts.voiceIdx,this.opts.staffIdx,this.opts.pitch,this.opts.graceIdx)},v.updateCurrentAccidental=function(c){const i=this.getGraceAtPitch();if(typeof i!="undefined"){const I=h.default.getPitch(i),M=u.default.getAlter(I);return this.updateAccidental(i,this.opts.noteIdx,c,this.opts.graceIdx),M}else return c},v.getGraceAtPitch=function(){const c=this.measureData.getVoice(this.opts.voiceIdx);return(0,e.A)(c,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},v.updateNextAccidental=function(c){const i=this.measureData.getVoice(this.opts.voiceIdx),I=_(i,this.opts.noteIdx,this.opts.pitch,this.opts.graceIdx);if(I!==null){const M=this.getNextNoteAtPitch(I);this.updateAccidental(M,I.noteIdx,c,I.graceIdx)}},v.getNextNoteAtPitch=function(c){const i=this.measureData.getVoice(this.opts.voiceIdx);return c.graceIdx===null?(0,s.default)(i,c.noteIdx,this.opts.pitch):(0,e.A)(i,c.noteIdx,c.graceIdx,this.opts.pitch)};const _=function(c,i,I,M){const E=new n.A(c);let P={noteIdx:i,graceIdx:M};for(;E.hasNextEntity(P.noteIdx,P.graceIdx);)if(P=E.getNextCursor(P.noteIdx,P.graceIdx),m(c,P)&&typeof(0,s.default)(c,P.noteIdx,I,P.graceIdx)!="undefined")return P;return null},m=function(c,i){return i.graceIdx!==null?!0:!c.isRest(i.noteIdx)};v.updateAccidental=function(c,i,I,M){const E=h.default.getPitch(c),P=u.default.getAlter(E);if(P===I)this.removeAccidental(i,M);else{const O=u.default.alterToAccidental(P);this.addAccidental(i,O,M)}},v.removeAccidental=function(c,i){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:c,pitch:u.default.copy(this.opts.pitch)};let M;i===null?M=new r.A(this.measureData,I,this.cancelStack):(I.graceIdx=i,M=new o.A(this.measureData,I,this.cancelStack)),M.perform()},v.addAccidental=function(c,i,I){const M={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:c,pitch:u.default.copy(this.opts.pitch),accidental:i};let E;I===null?E=new p.A(this.measureData,M,this.cancelStack):(M.graceIdx=I,E=new x.A(this.measureData,M,this.cancelStack)),E.perform()};const d=f},563310:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(123491),u=t(698716);const x=function(r,o,a){let s=null,e=null;for(let n=o.measureIdx;n>=0;n--){const l=r.getMeasureData(n);if(!l.hasVoice(o.voiceIdx))continue;const f=l.getVoice(o.voiceIdx);for(e===null?e=o.noteIdx:e=f.size()-1;e>=0;e--){const v=u.A.create(n,e);if(u.A.isEqual(v,o))continue;const _=f.getNote(e);if(h.default.hasSlur(_)||(h.default.isRest(_)||(s=v),a!==null&&u.A.isEqual(v,a)))return s}}return s}},569445:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(607682),u=t(351277);class p extends h.default{constructor(o){super(x(o)),Object.defineProperty(this,"noSentryLogging",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"line",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LineOutOfRangeError",this.line=o}}const x=function(r){return`Invalid line ${r}. The line must be between [${u.default.MIN_LINE} and ${u.default.MAX_LINE}].`}},570092:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(762860),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveColorFromGrace";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.addColor(),this.updateStack()},o.addColor=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.A)(s,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);h.default.removeColor(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},573559:(S,D,t)=>{t.d(D,{A:()=>r});var h=t(569445),u=t(351277),p=t(230373);const r=function(o,a){const s=(0,p.A)(o,a);if(s<u.default.MIN_LINE||s>u.default.MAX_LINE)throw new h.A(s)}},575349:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(525766);const u=h.A},576660:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.SetTieDirection";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e,this.note=null},o.perform=function(){this.setTieDirection(),this.updateStack(),this.isTiedWithNextMeasure()&&this.signalNextMeasure()},o.setTieDirection=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.setTieDirection(e,this.opts.tieDirection)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)},o.isTiedWithNextMeasure=function(){const s=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.noteIdx+1<s.getNbNotes())return!1;const e=this.getNote();return h.default.hasTieStart(e)},o.getNote=function(){if(this.note===null){const s=this.measureData.getVoice(this.opts.voiceIdx);this.note=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch)}return this.note},o.signalNextMeasure=function(){const{partIdx:s}=this.opts,e=this.opts.measureIdx+1,n={type:`${this.name}-close`,opts:{partIdx:s,measureIdx:e}};this.cancelStack.push(n),(0,x.default)(this.cancelStack,this.measureData,{partIdx:s,measureIdx:e})};const a=r},583904:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveGhostNote";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeGhostNote(),this.updateStack()},o.removeGhostNote=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.removeHeadParentheses(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},586654:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(123491),u=t(712947),p=t(446921),x=t(794799),r=t(852363),o=t(793317);const a=function(n,l,f){this.init(n,l,f)};a.NAME="primitive.RemoveSlurSide";const s=a.prototype;s.name=a.NAME,s.initMeasureData=o.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.cancelStack=f,this.opts=l},s.perform=function(){const n=this.removeSlur();this.updateStack(n)},s.removeSlur=function(){const l=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),f=h.default.getSlurType(l),v=h.default.getSlur(l);if(f===x.A.START){const d=u.default.getUuid(v),i=this.measureData.getScoreData().getPartContent(this.opts.partIdx);p.A.removeSlur(i,d)}const _=u.default.isCrossMeasure(v),m={slurType:f,isCrossMeasure:_};return h.default.removeSlur(l),m},s.updateStack=function(n){const l={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,type:n.slurType,isCrossMeasure:n.isCrossMeasure}};this.cancelStack.push(l),(0,r.default)(this.cancelStack,this.measureData,this.opts)};const e=a},591114:(S,D,t)=>{t.d(D,{A:()=>k});var h=t(123491),u=t(351277),p=t(691309),x=t(793317),r=t(511890),o=t(12597);function a(R){const L=R.getLeftChord(),j=R.getRightChord(),V={};return s(L,V),e(j,V),V}function s(R,L){R.forEach(function(j){h.default.getSlideStarts(j).forEach(n,L)})}function e(R,L){R.forEach(function(j){h.default.getSlideStops(j).forEach(n,L)})}function n(R){const L=this,j=r.default.getNumber(R);L[j]=!0}var l=t(342141),f=t(852363);const v=function(R,L,j){this.init(R,L,j)};v.NAME="primitive.AddSlide";const _=v.prototype;_.name=v.NAME,_.initMeasureData=x.default,_.init=function(R,L,j){this.initMeasureData(R,L),this.opts=L,this.cancelStack=j,this.crossMeasure=new p.default(this.measureData,L.voiceIdx,L.noteIdx)},_.perform=function(){this.addSlide(),this.updateStack()},_.addSlide=function(){const R=this.getNumber();this.addSlideToLeftNote(R),this.addSlideToRightNote(R)},_.getNumber=function(){const R=a(this.crossMeasure);return(0,l.A)(R)},_.addSlideToLeftNote=function(R){const j=this.crossMeasure.getLeftChord().find(m,this.opts.leftPitch),V=r.default.create(o.A.START,R);h.default.addSlide(j,V)},_.addSlideToRightNote=function(R){const j=this.crossMeasure.getRightChord().find(m,this.opts.rightPitch),V=r.default.create(o.A.STOP,R);h.default.addSlide(j,V)};function m(R){const L=this,j=h.default.getPitch(R);return u.default.isSameLine(j,L)}_.updateStack=function(){const R=this.crossMeasure.getLeftMeasureIdx(),L=this.crossMeasure.getRightMeasureIdx(),j=this.opts.partIdx,V={type:this.name,opts:{partIdx:j,measureIdx:R}};this.cancelStack.push(V),(0,f.default)(this.cancelStack,this.measureData,{partIdx:j,measureIdx:R});const J={type:`${this.name}-close`,opts:{partIdx:j,measureIdx:L}};this.cancelStack.push(J),L!==R&&(0,f.default)(this.cancelStack,this.measureData,{partIdx:j,measureIdx:L})};const d=v;var c=t(679676),i=t(519405),I=t(103219),M=t(121720),E=t(578918),P=t(669208),O=t(805396);const K=function(R,L,j){this.init(R,L,j)};K.NAME="composite.AddSlide";const w=K.prototype;w.name=K.NAME,w.initMeasureData=x.default,w.init=function(R,L,j){this.initMeasureData(R,L),this.opts=L,this.cancelStack=j,this.crossMeasure=new p.default(this.measureData,L.voiceIdx,L.noteIdx)},w.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTie(),this.removeGlissando(),this.removeTremolo(),this.addSlide()},w.removeTie=function(){if(!u.default.isSameLine(this.opts.leftPitch,this.opts.rightPitch))return;const R=this.measureData.getVoice(this.opts.voiceIdx),L=(0,E.default)(R,this.opts.noteIdx,this.opts.leftPitch);if(!h.default.hasTieStart(L))return;const j={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,step:u.default.getStep(this.opts.leftPitch),octave:u.default.getOctave(this.opts.leftPitch)},V=new c.default(this.measureData,j,this.cancelStack);(0,i.default)(V)},w.removeGlissando=function(){if((0,I.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch)){const R=(0,M.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch),L={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:u.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:u.default.copyWithoutAlter(this.opts.rightPitch),number:R},j=new P.default(this.measureData,L,this.cancelStack);(0,i.default)(j)}},w.removeTremolo=function(){const[R]=this.crossMeasure.getLeftChord();if(h.default.hasTremoloStart(R)){const L={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()},j=this.crossMeasure.getRightMeasure(),V=new O.default(j,L,this.cancelStack);(0,i.default)(V)}},w.addSlide=function(){const R={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:u.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:u.default.copyWithoutAlter(this.opts.rightPitch)};new d(this.measureData,R,this.cancelStack).perform()};const k=K},596463:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(483139),u=t(201060),p=t(243183);const x=function(s,e){typeof e.oldMeasureUuid!="undefined"&&r(s,e),typeof e.newMeasureUuid!="undefined"&&o(s,e)},r=function(s,e){if(s=(0,p.A)(s),s.hasMeasureIdxByUuid(e.oldMeasureUuid))e.oldMeasureIdx=(0,u.A)(s.getMeasuresHeaders(),e.oldMeasureUuid),delete e.oldMeasureUuid;else throw new h.A(e.oldMeasureUuid,h.A.GET)},o=function(s,e){if(s=(0,p.A)(s),s.hasMeasureIdxByUuid(e.newMeasureUuid))e.newMeasureIdx=(0,u.A)(s.getMeasuresHeaders(),e.newMeasureUuid),delete e.newMeasureUuid;else throw new h.A(e.newMeasureUuid,h.A.GET)},a=x},606106:(S,D,t)=>{t.d(D,{A:()=>u});const u={WEDGE:"wedge",TEMPO_CHANGE:"tempoChange",PEDAL:"pedal",OCTAVE_SHIFT:"octaveShift",PLUCKED_RANGE:"pluckedRange",DYNAMICS:"dynamics",WORD:"word",PIZZICATO:"pizzicato",MUTE:"mute",JAZZ_HARMONY:"jazzHarmony",FIGURED_BASS:"figuredBass",CLASSIC_HARMONY:"classicHarmony",SLUR:"slur",MIDDLE_MEASURE_CLEF:"middleMeasureClef"}},606611:(S,D,t)=>{t.d(D,{A:()=>c});var h=t(351277),u=t(737903),p=t(123491),x=t(209175),r=t(109708),o=t(762691),a=t(793317),s=t(852363);const e=function(i,I,M){this.init(i,I,M)};e.NAME="primitive.AddToChord";const n=e.prototype;n.name=e.NAME,n.initMeasureData=a.default,n.init=function(i,I,M){this.initMeasureData(i,I),this.cancelStack=M,this.opts=I},n.perform=function(){const i=this.getVoice(),I=i.getNote(this.opts.noteIdx),M=this.createNote(I);i.addNoteToChord(M,this.opts.noteIdx),this.updateCommonHistory(),this.updateStack()},n.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},n.createNote=function(i){const I=p.default.getDuration(i),M=p.default.getNbDots(i);let E=p.default.getTimeModif(i);E=x.default.copy(E);const P=h.default.copy(this.opts.pitch),O=p.default.getTimePos(i),K={};if(p.default.setStaffIdx(K,this.opts.staffIdx),p.default.setVoiceIdx(K,this.opts.voiceIdx),p.default.setDuration(K,I),p.default.setPitch(K,P),p.default.setNbDots(K,M),p.default.setTimeModif(K,E),p.default.setTimePos(K,O),this.opts.accidental!==null&&p.default.setAccidental(K,this.opts.accidental),p.default.hasArpeggiate(i)){let w=p.default.getArpeggiate(i);w=r.A.copy(w),p.default.setArpeggiate(K,w)}if(this.cancelStack.hasPayload()){const w=this.cancelStack.getPayload(),k=(0,u.default)(w.headCssClassesSet);o.default.setHeadCssClassesSet(K,k)}return K},n.updateCommonHistory=function(){if(this.cancelStack.hasPayload()){const I=this.getVoice().getNote(this.opts.noteIdx),M=this.cancelStack.getPayload(),E=(0,u.default)(M.headCssClassesSet);o.default.setGlobalCssClassesSet(I,E)}},n.updateStack=function(){const i={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,noteIdx:this.opts.noteIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,pitch:h.default.copy(this.opts.pitch),accidental:this.opts.accidental}};this.cancelStack.push(i),(0,s.default)(this.cancelStack,this.measureData,this.opts)};const l=e;var f=t(645166),v=t(298009),_=t(534512);const m=function(i,I,M){this.init(i,I,M)};m.NAME="composite.AddToChord";const d=m.prototype;d.name=m.NAME,d.initMeasureData=a.default,d.init=function(i,I,M){this.initMeasureData(i,I),this.cancelStack=M,this.opts=I},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(),this.addToChord(),this.updateAccidental(),this.isTabStaff()&&this.setFretAction()},d.addToChord=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch),accidental:null};new l(this.measureData,i,this.cancelStack).perform()},d.updateAccidental=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch)};new f.A(this.measureData,i,this.cancelStack).perform()},d.isTabStaff=function(){return(0,_.default)(this.measureData,this.opts)},d.setFretAction=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copy(this.opts.pitch),fretData:this.opts.fretData,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new v.default(this.measureData,i,this.cancelStack).performIfPossible()};const c=m},609817:(S,D,t)=>{t.d(D,{A:()=>r});var h=t(898039);const u=function(o,a){typeof a.newTimePos!="undefined"&&typeof a.oldTimePos!="undefined"&&(p(o,a),x(o,a))},p=function(o,a){const s=o.getMeasureData(a.newMeasureIdx),e={voiceIdx:a.voiceIdx,divisions:a.newDivisions,timePos:a.newTimePos};(0,h.default)(s,e),delete a.newTimePos,a.newNoteIdx=e.noteIdx},x=function(o,a){const s=o.getMeasureData(a.oldMeasureIdx),e={voiceIdx:a.voiceIdx,divisions:a.oldDivisions,timePos:a.oldTimePos};(0,h.default)(s,e),delete a.oldTimePos,a.oldNoteIdx=e.noteIdx},r=u},610860:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(351277),u=t(123491),p=t(545496),x=t(578918);const r=function(s,e){let n;if(e.accidental!==null)n=h.default.accidentalToAlter(e.accidental);else{const l=o(s,e);n=(0,p.A)(s,e.noteIdx,e.voiceIdx,l,e.pitch)}h.default.setAlter(e.pitch,n)},o=function(s,e){if(typeof e.staffIdx!="undefined")return e.staffIdx;{const n=s.getVoice(e.voiceIdx),l=(0,x.default)(n,e.noteIdx,e.pitch);return u.default.getStaffIdx(l)}},a=r},612252:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(123491);const p=function(x,r,o){let a=0;const s=x.size();let e=0;for(;e<s&&a<o;e++){const n=x.getNote(e),l=h.default.getDuration(n);a+=l*r}return e===s&&a<=o?!1:a===o||x.isRest(e-1)}},618996:(S,D,t)=>{t.d(D,{A:()=>l});var h=t(476943),u=t(123491),p=t(351277),x=t(760367);const r=function(f,v){const _=[],m={ties:_,noteIdx:v.startNoteIdx,measureIdx:v.startMeasureIdx,voiceIdx:v.voiceIdx},d=v.stopNoteIdx,c=v.stopMeasureIdx;for(;o(m,c,d);){const i=f.getMeasureData(m.measureIdx);if(i.hasVoice(v.voiceIdx)){const I=i.getVoice(v.voiceIdx);I.isRest(m.noteIdx)||a(i,m),m.noteIdx++,m.noteIdx===I.getNbNotes()&&(m.noteIdx=0,m.measureIdx++)}else m.noteIdx=0,m.measureIdx++}return _},o=function(f,v,_){return f.measureIdx<v?!0:f.measureIdx===v?f.noteIdx<_:!1},a=function(f,v){let m=f.getVoice(v.voiceIdx).getChord(v.noteIdx);if(m=h.default.makeArray(m),m.some(u.default.hasTieStart)){const d=m.map(s);d.sort(e);const c=d.map(n),i={measureIdx:v.measureIdx,noteIdx:v.noteIdx,voiceIdx:v.voiceIdx,tiesList:c};v.ties.push(i)}},s=function(f){const v=u.default.getPitch(f),_=u.default.hasTieStart(f),m=u.default.getTieDirection(f);return{pitch:v,hasTie:_,tieDirection:m}},e=function(f,v){return p.default.naiveComparePitch(f.pitch,v.pitch)};function n(f){const v={tied:f.hasTie};return v.tied&&f.tieDirection===x.A.FLIPPED&&(v.tieDirection=f.tieDirection),v}const l=r},623671:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(951066);function u(x){return`Technical [${x}] is invalid.`}class p extends h.A{constructor(r){const o=u(r);super(o),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadTechnicalTypeError",this.type=r}}},628827:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(199992);const u=h.A},632879:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(607682),u=t(351277),p=t(377180);class x extends h.default{constructor(o,a){super("This transpose would cause a pitch overflow."),Object.defineProperty(this,"transpose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pitch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="PitchOverflowError",this.transpose=a&&p.default.copy(a),this.pitch=o&&u.default.copy(o)}}},635018:(S,D,t)=>{t.d(D,{A:()=>_});var h=t(351277),u=t(123491),p=t(852363),x=t(793317);const r=function(m,d,c){this.init(m,d,c)};r.NAME="primitive.RemoveGraceFromChord";const o=r.prototype;o.name=r.NAME,o.initMeasureData=x.default,o.init=function(m,d,c){this.initMeasureData(m,d),this.cancelStack=c,this.opts=d},o.perform=function(){const m=this.getVoice(),c=m.getGraceChord(this.opts.noteIdx,this.opts.graceIdx).findIndex(this.pitchPredicate,this);m.removeGraceFromChord(this.opts.noteIdx,this.opts.graceIdx,c),this.updateStack()},o.pitchPredicate=function(m){const d=u.default.getPitch(m),c=this.opts.pitch;return h.default.isSameLine(d,c)},o.getVoice=function(){const m=this.opts.voiceIdx;return this.measureData.getVoice(m)},o.updateStack=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},d={type:this.name,opts:m};this.cancelStack.push(d),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const a=r;var s=t(561262),e=t(408649),n=t(519405);const l=function(m,d,c){this.init(m,d,c)};l.NAME="composite.RemoveGraceFromChord";const f=l.prototype;f.name=l.NAME,f.initMeasureData=x.default,f.init=function(m,d,c){this.initMeasureData(m,d),this.cancelStack=c,this.opts=d},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const m=this.getNoteData();this.removeColor(m),this.removeGraceFromChord(),this.updateAccidental(m)},f.getNoteData=function(){const d=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx),c=v(d);return{staffIdx:u.default.getStaffIdx(d),color:c}};function v(m){return u.default.hasColor(m)?u.default.getColor(m):null}f.removeGraceFromChord=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(this.opts.pitch)};new a(this.measureData,m,this.cancelStack).perform()},f.removeColor=function(m){if(m.color===null)return;const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(this.opts.pitch)},c=new e.default(this.measureData,d,this.cancelStack);(0,n.default)(c)},f.updateAccidental=function(m){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:m.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:h.default.copy(this.opts.pitch)};new s.A(this.measureData,d,this.cancelStack).perform()},f.getVoice=function(){const m=this.opts.voiceIdx;return this.measureData.getVoice(m)};const _=l},639673:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(476943),u=t(123491),p=t(793317),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveArpeggio";const o=r.prototype;o.name=r.NAME,o.initMeasureData=p.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeArpeggio(),this.updateStack()},o.removeArpeggio=function(){let e=this.getVoice().getChord(this.opts.noteIdx);e=h.default.makeArray(e),e.forEach(u.default.removeArpeggiate)},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},650371:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(701387),u=t(712947),p=t(852363);const x=function(a,s,e){this.init(a,s,e)};x.NAME="primitive.AddSlurContinue";const r=x.prototype;r.name=x.NAME,r.init=function(a,s,e){this.scoreData=a,this.cancelStack=e,this.opts=s},r.perform=function(){this.addLeftSlur(),this.addRightSlur(),this.updateStack()},r.addLeftSlur=function(){const a=this.getLeftMeasure(),s=this.createSlur();u.default.setPlacement(s,this.opts.placement),h.default.setRightSlur(a,this.opts.voiceIdx,s)},r.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},r.addRightSlur=function(){const a=this.getRightMeasure(),s=this.createSlur();u.default.setPlacement(s,this.opts.placement),h.default.setLeftSlur(a,this.opts.voiceIdx,s)},r.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},r.createSlur=function(){const a={staffIdx:this.opts.staffIdx,slurUuid:this.opts.slurUuid};return u.default.setUuid(a,this.opts.slurUuid),a},r.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx}};this.cancelStack.push(a),(0,p.default)(this.cancelStack,this.scoreData,this.opts)};const o=x},662188:(S,D,t)=>{t.d(D,{A:()=>m});var h=t(364842),u=t(836733),p=t(123491),x=t(476943),r=t(747493),o=t(539203);const a=function(d,c,i){if(typeof c.pitch!="undefined"){const I=f(d,c),M=v(d,c),E=s(c),P=e(c);let O=M.getGraceChord(E,P);O=x.default.makeArray(O),O=O.filter(p.default.hasFretData);let K=O.map(p.default.getFretData);if(K=K.filter(_,i),c.sameStringAsPreviousNotes){const w=(0,o.A)(d,c),k=(0,r.A)(w,c,c.pitch);if(k!==null&&!K.find(R=>R.string===k.string)){c.fretData=k;return}}c.fretData=(0,u.A)(c.pitch,I,K)}};function s(d){if(typeof d.noteIdx!="undefined")return d.noteIdx;{const c="Cannot convert fret to pitch since there is no noteIdx informations.";throw new h.default("Unexpected",c)}}function e(d){if(typeof d.graceIdx!="undefined")return d.graceIdx;{const c="Cannot convert fret to pitch since there is no graceIdx informations.";throw new h.default("Unexpected",c)}}function n(d){if(typeof d.voiceIdx!="undefined")return d.voiceIdx;{const c="Cannot convert fret to pitch since there is no voiceIdx informations.";throw new h.default("Unexpected",c)}}function l(d,c){if(typeof c.staffIdx!="undefined")return c.staffIdx;if(typeof c.voiceIdx!="undefined")return d.getVoiceMainStaffIdx(c.voiceIdx);{const i="Cannot convert fret to pitch since there is no staffIdx informations.";throw new h.default("Unexpected",i)}}function f(d,c){const i=l(d,c);return d.getStaffDetails(i)}function v(d,c){const i=n(c);return d.getVoice(i)}function _(d){const c=this;return d.string!==c}const m=a},667032:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(793317),p=t(578918),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveColorFromNote";const o=r.prototype;o.name=r.NAME,o.initMeasureData=u.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){this.removeColor(),this.updateStack()},o.removeColor=function(){const s=this.measureData.getVoice(this.opts.voiceIdx),e=(0,p.default)(s,this.opts.noteIdx,this.opts.pitch);h.default.removeColor(e)},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r},668341:(S,D,t)=>{t.d(D,{A:()=>l});var h=t(726042),u=t(701387),p=t(364842),x=t(852363);const r=function(f,v,_){this.init(f,v,_)};r.NAME="primitive.RemoveMiddleMeasureClef";const o=r.prototype;o.name=r.NAME,o.init=function(f,v,_){this.scoreData=f,this.cancelStack=_,this.opts=v,this.measure=null,this.clefIdx=null,this.localTimePos=null},o.perform=function(){this.removeMiddleMeasureClef(),this.updateStack()},o.removeMiddleMeasureClef=function(){const f=this.getMeasure(),v=u.default.getMiddleClefs(f,this.opts.staffIdx),_=this.opts.clefIdx;if(_<0||_>=v.length||!h.default.isInteger(_))throw new p.default("InvalidClefIdx",`The clefIdx [${_}] is invalid.`);v.splice(this.opts.clefIdx,1),u.default.setMiddleClefs(f,this.opts.staffIdx,v)},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},o.updateStack=function(){const f={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(f),(0,x.default)(this.cancelStack,this.scoreData,this.opts)};const a=r;var s=t(874868);const e=function(f,v,_){this.init(f,v,_)};e.NAME="composite.RemoveMiddleMeasureClef";const n=e.prototype;n.name=e.NAME,n.init=function(f,v,_){this.scoreData=f,this.cancelStack=_,this.opts=v},n.perform=function(){const f=this.isLastClef();this.removeMiddleMeasureClef(),f&&!this.isLastMeasure()&&this.updateNextOwnClef()},n.isLastClef=function(){const f=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),v=u.default.getMiddleClefs(f,this.opts.staffIdx);return this.opts.clefIdx===v.length-1},n.removeMiddleMeasureClef=function(){const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clefIdx:this.opts.clefIdx};new a(this.scoreData,f,this.cancelStack).perform()},n.isLastMeasure=function(){return this.opts.measureIdx===this.scoreData.getNbMeasures()-1},n.updateNextOwnClef=function(){const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx+1,staffIdx:this.opts.staffIdx};new s.A(this.scoreData,f,this.cancelStack).perform()};const l=e},675531:(S,D,t)=>{t.d(D,{A:()=>Z});var h=t(474976),u=t(748049),p=t(353922),x=t(760367),r=t(476943),o=t(123491),a=t(351277),s=t(964845),e=t(50060),n=t(603966);const l=n.A;var f=t(414208),v=t(487332),_=t(137427),m=t(30335),d=t(379097),c=t(246451),i=t(473990),I=t(115866),M=t(691120),E=t(714015),P=t(540781),O=t(909103),K=t(244651),w=t(330179),k=t(516e3),R=t(742253),L=t(310107),j=t(165259),V=t(805396),J=t(901095),G=t(765350),z=t(272980),F=t(645166),tt=t(334772),b=t(158553),N=t(882078),B=t(253916),H=t(155010),$=t(45876),q=t(218371),et=t(99448),st=t(737296),ot=t(793317),A=t(519405),g=t(257818);const T=function(C,U,W){this.init(C,U,W)};T.NAME="composite.RemoveSingleNote";const y=T.prototype;y.name=T.NAME,y.initMeasureData=ot.default,y.init=function(C,U,W){this.initMeasureData(C,U),this.cancelStack=W,this.opts=U},y.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===st.default.INSERT&&(this.removeLastNoteTie(),this.removeLastNoteHammerOnPullOff(),this.removeLastNoteGlissandos(),this.removeLastNoteSlides()),this.adaptDpqToTimeSignature(),this.adaptDpqToTuplet();const C=this.getFormerContent(),U=this.getNote();this.removeTremolo2(U),this.removeBeamStatus(U),this.untieNote(),this.removeGraces(),this.removeHammerOnPullOff(U),this.removeCourtesyAccidental(U),this.removeFingering(U),this.removeColor(U),this.removeBend(U),this.removeTieDirection(U),this.removeGhostNote(U),this.removeNotehead(U),this.removeArticulations(U),this.removeTechnicals(U),this.removeOrnaments(U),this.removeLyrics(),this.removeSlides(U),this.removeOrphanGlissandoStarts(U),this.removeOrphanGlissandoStops(U),this.removeGlissandos(U),this.dispatchSlurSide(U),this.removeHarmonic(U),this.removeSingleNote(),this.restoreSpace(U),this.updateAccidental(U);const W=this.measureData.getVoice(this.opts.voiceIdx);(0,g.A)(W,this.opts.noteIdx),this.opts.keepFormer&&this.restoreFormerContent(C)},y.adaptDpqToTimeSignature=function(){const C={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new G.A(this.measureData,C,this.cancelStack).perform()},y.adaptDpqToTuplet=function(){const C={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new z.A(this.measureData,C,this.cancelStack).perform()},y.getFormerContent=function(){const C={};return C.lyrics=this.getLyrics(),C},y.getLyrics=function(){const U=this.getVoice().getNote(this.opts.noteIdx);return o.default.getLyrics(U).map(Y)};const Y=function(C){const U=e.default.getLevel(C);if(e.default.hasLeftMelisma(C))return{level:U,isMelisma:!0};const W=e.default.getText(C),X=e.default.hasRightConnection(C);return{lyric:W,hasRightConnection:X,level:U}};y.removeLastNoteTie=function(){const C=this.getVoiceOrTuplet(),U=C.getStopNoteIdx();let W=C.getChord(U);if(W=r.default.makeArray(W),!W.some(o.default.hasTieStart))return;const X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:U},Q=new f.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeLastNoteGlissandos=function(){const C=this.getVoiceOrTuplet(),U=C.getStopNoteIdx();if(C.isRest(U))return;const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:U};new $.A(this.measureData,W,this.cancelStack).perform()},y.removeLastNoteSlides=function(){const C=this.getVoiceOrTuplet(),U=C.getStopNoteIdx();if(C.isRest(U))return;const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:U};new q.A(this.measureData,W,this.cancelStack).perform()},y.removeLastNoteHammerOnPullOff=function(){const C=this.getVoiceOrTuplet(),U=C.getStopNoteIdx();let W=C.getChord(U);if(W=r.default.makeArray(W),!W.some(o.default.hasHammerOnPullOffStart))return;const X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:U},Q=new v.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.getVoiceOrTuplet=function(){const C=this.opts.voiceIdx,U=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(C,U)},y.untieNote=function(){const C=this.getNote();if(!o.default.hasTie(C))return;const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},W=new _.default(this.measureData,U,this.cancelStack);(0,A.default)(W)},y.removeHammerOnPullOff=function(C){if(!o.default.hasHammerOnPullOffStart(C)&&!o.default.hasHammerOnPullOffStop(C))return;const U=o.default.getPitch(C),W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(U)},X=new m.default(this.measureData,W,this.cancelStack);(0,A.default)(X)},y.removeCourtesyAccidental=function(C){const U=this.getNote();if(!o.default.hasCourtesyAccidental(U))return;const W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W)},Q=new M.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeFingering=function(C){const U=this.getNote();if(!o.default.hasFingering(U))return;const W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W)},Q=new O.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeColor=function(C){const U=this.getNote();if(!o.default.hasColor(U))return;const W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W)},Q=new K.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeBend=function(C){if(!o.default.hasBend(C)||!o.default.hasFretData(C))return;const U=o.default.getFretData(C),W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W),fretData:U},Q=new w.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeTieDirection=function(C){if(o.default.getTieDirection(C)===x.A.AUTO)return;const W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W),tieDirection:x.A.AUTO},Q=new L.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeBeamStatus=function(C){if(o.default.getBeamStatus(C)!==u.A.DEFAULT){const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,beamStatus:u.A.DEFAULT},X=new R.default(this.measureData,W,this.cancelStack);(0,A.default)(X)}},y.removeGhostNote=function(C){const U=this.getNote();if(!o.default.hasHeadParentheses(U))return;const W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W)},Q=new E.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)},y.removeNotehead=function(C){const U=o.default.getHead(C);if(U!==p.A.NORMAL&&p.A.isValidPitched(U)){const W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W),notehead:p.A.NORMAL},Q=new P.default(this.measureData,X,this.cancelStack);(0,A.default)(Q)}},y.removeGraces=function(){const C={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new et.A(this.measureData,C,this.cancelStack).perform()},y.removeOrphanGlissandoStarts=function(C){const U=o.default.getPitch(C),W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copyWithoutAlter(U)};new N.A(this.measureData,W,this.cancelStack).perform()},y.removeOrphanGlissandoStops=function(C){const U=o.default.getPitch(C),W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copyWithoutAlter(U)};new B.A(this.measureData,W,this.cancelStack).perform()},y.removeGlissandos=function(C){const U=o.default.getPitch(C),W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copyWithoutAlter(U)};new H.A(this.measureData,W,this.cancelStack).perform()},y.removeHarmonic=function(C){const U=o.default.getPitch(C);if(!o.default.hasHarmonic(C))return;const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copyWithoutAlter(U)},X=new j.default(this.measureData,W,this.cancelStack);(0,A.default)(X)},y.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},y.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},y.dispatchSlurSide=function(C){if(o.default.hasSlur(C)){const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new tt.A(this.measureData,U,this.cancelStack).perform()}},y.removeSingleNote=function(){const C={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new l(this.measureData,C,this.cancelStack).perform()},y.restoreSpace=function(C){const U=o.default.getDuration(C),W=o.default.getStaffIdx(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:W,noteIdx:this.opts.noteIdx,duration:U,insertMode:this.opts.insertMode};new J.A(this.measureData,X,this.cancelStack).perform()},y.updateAccidental=function(C){const U=o.default.getStaffIdx(C),W=o.default.getPitch(C),X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:U,noteIdx:this.opts.noteIdx,pitch:a.default.copy(W)};new F.A(this.measureData,X,this.cancelStack).perform()},y.removeArticulations=function(C){let U=o.default.getArticulationsList(C);U=U.filter(h.default.isValid),U.forEach(function(W){const X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,articulationType:W};new d.default(this.measureData,X,this.cancelStack).perform()},this)},y.removeTechnicals=function(C){const U=o.default.getTechnical(C);o.default.getTechnicalList(C).forEach(function(W){const X={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,technicalType:W,technicalOpts:s.A.getTechnicalOpts(U,W)};new c.default(this.measureData,X,this.cancelStack).perform()},this)},y.removeTremolo2=function(C){if(o.default.hasTremoloStart(C)){const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},W=new V.default(this.measureData,U,this.cancelStack);(0,A.default)(W)}if(o.default.hasTremoloStop(C)){const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},W=new V.default(this.measureData,U,this.cancelStack);(0,A.default)(W)}},y.removeOrnaments=function(C){o.default.getOrnamentsList(C).forEach(function(U){const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:U};new i.default(this.measureData,W,this.cancelStack).perform()},this)},y.removeLyrics=function(){const C=this.getNote();if(o.default.getLyrics(C).length===0)return;const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},W=new I.default(this.measureData,U,this.cancelStack);(0,A.default)(W)},y.removeSlides=function(C){const U=o.default.getPitch(C),W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copyWithoutAlter(U)};new b.A(this.measureData,W,this.cancelStack).perform()},y.restoreFormerContent=function(C){this.restoreLyrics(C.lyrics)},y.restoreLyrics=function(C){C.forEach(this.restoreLyric,this)},y.restoreLyric=function(C){const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,lyric:C.lyric,hasRightConnection:C.hasRightConnection,level:C.level,isMelisma:C.isMelisma},W=new k.default(this.measureData,U,this.cancelStack);(0,A.default)(W)};const Z=T},677772:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(123491),u=t(852363),p=t(793317);const x=function(a,s,e){this.init(a,s,e)};x.NAME="primitive.RemoveGraceSlash";const r=x.prototype;r.initMeasureData=p.default,r.name=x.NAME,r.init=function(a,s,e){this.initMeasureData(a,s),this.cancelStack=e,this.opts=s},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeGraceSlash(),this.updateStack()},r.removeGraceSlash=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx);h.default.makeGrace(s)},r.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a),(0,u.default)(this.cancelStack,this.measureData,this.opts)};const o=x},679534:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(852363),u=t(364842),p=t(726042),x=t(701387);const r=function(e,n,l){this.init(e,n,l)};r.NAME="primitive.RemoveDynamic";const o=r.prototype;o.name=r.NAME,o.init=function(e,n,l){this.scoreData=e,this.cancelStack=l,this.opts=n},o.perform=function(){this.removeDynamic(),this.updateStack()},o.removeDynamic=function(){const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),n=x.default.getDynamics(e,this.opts.staffIdx),l=n.length;a(this.opts.dynamicIdx,l),n.splice(this.opts.dynamicIdx,1),x.default.setDynamics(e,this.opts.staffIdx,n)};const a=function(e,n){if(!p.default.isInteger(e)||e<0||e>=n){const l=`Invalid dynamicIdx: [${e}].`;throw new u.default("BadDynamicIdx",l)}};o.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,h.default)(this.cancelStack,this.scoreData,this.opts)};const s=r},687396:(S,D,t)=>{t.d(D,{A:()=>r});var h=t(701387),u=t(852363);const p=function(o,a,s){this.init(o,a,s)};p.NAME="primitive.RemoveMeasureRepeat";const x=p.prototype;x.name=p.NAME,x.init=function(o,a,s){this.scoreData=o,this.cancelStack=s,this.opts=a,this.measure=null},x.perform=function(){this.removeMeasureRepeat(),this.updateStack()},x.removeMeasureRepeat=function(){const o=this.getMeasure();h.default.removeMeasureRepeat(o,this.opts.staffIdx)},x.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},x.updateStack=function(){const o={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(o),(0,u.default)(this.cancelStack,this.scoreData,this.opts)};const r=p},698716:(S,D,t)=>{t.d(D,{A:()=>u});const h={};h.create=function(p,x){return{noteIdx:x,measureIdx:p}},h.isEqual=function(p,x){return p.measureIdx===x.measureIdx&&p.noteIdx===x.noteIdx},h.isGreater=function(p,x){const r=p.measureIdx-x.measureIdx;return r>0?!0:r<0?!1:p.noteIdx-x.noteIdx>0},h.isLower=function(p,x){const r=p.measureIdx-x.measureIdx;return r<0?!0:r>0?!1:p.noteIdx-x.noteIdx<0};const u=h},701043:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(364842),u=t(726042),p=t(701387),x=t(852363);const r=function(e,n,l){this.init(e,n,l)};r.NAME="primitive.RemoveWord";const o=r.prototype;o.name=r.NAME,o.init=function(e,n,l){this.scoreData=e,this.cancelStack=l,this.opts=n},o.perform=function(){this.removeWord(),this.updateStack()},o.removeWord=function(){const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),n=p.default.getWords(e,this.opts.staffIdx),l=n.length;a(this.opts.wordIdx,l),n.splice(this.opts.wordIdx,1),p.default.setWords(e,this.opts.staffIdx,n)};const a=function(e,n){if(!u.default.isInteger(e)||e<0||e>=n){const l=`Invalid wordIdx: [${e}].`;throw new h.default("BadWordIdx",l)}};o.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,x.default)(this.cancelStack,this.scoreData,this.opts)};const s=r},701236:(S,D,t)=>{t.d(D,{A:()=>_});var h=t(364842),u=t(836733),p=t(123491),x=t(476943),r=t(747493),o=t(539203);const a=function(m,d,c){if(typeof d.pitch!="undefined"){const i=l(m,d),I=f(m,d),M=s(d);let E=I.getChord(M);E=x.default.makeArray(E),E=E.filter(p.default.hasFretData);let P=E.map(p.default.getFretData);if(P=P.filter(v,c),d.sameStringAsPreviousNotes){const O=(0,o.A)(m,d),K=(0,r.A)(O,d,d.pitch);if(K!==null&&!P.find(w=>w.string===K.string)){d.fretData=K;return}}d.fretData=(0,u.A)(d.pitch,i,P)}},s=function(m){if(typeof m.noteIdx!="undefined")return m.noteIdx;{const d="Cannot convert fret to pitch since there is no noteIdx informations.";throw new h.default("Unexpected",d)}},e=function(m){if(typeof m.voiceIdx!="undefined")return m.voiceIdx;{const d="Cannot convert fret to pitch since there is no voiceIdx informations.";throw new h.default("Unexpected",d)}},n=function(m,d){if(typeof d.staffIdx!="undefined")return d.staffIdx;if(typeof d.voiceIdx!="undefined")return m.getVoiceMainStaffIdx(d.voiceIdx);{const c="Cannot convert fret to pitch since there is no staffIdx informations.";throw new h.default("Unexpected",c)}},l=function(m,d){const c=n(m,d);return m.getStaffDetails(c)},f=function(m,d){const c=e(d);return m.getVoice(c)},v=function(m){const d=this;return m.string!==d},_=a},701394:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(951066);function u(x){return`the line value [${x}] is invalid.`}class p extends h.A{constructor(r){const o=u(r);super(o),Object.defineProperty(this,"line",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadLineError",this.line=r}}},701932:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(701387),u=t(536949),p=t(618496),x=t(316610);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveWordsFrom";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null,this.limitTimePos=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeWordsFrom()},o.removeWordsFrom=function(){const s=this.getMeasure();let e=h.default.getWords(s,this.opts.staffIdx);e=e.filter(this.isBeyoudLimit,this),e.forEach(this.removeWord,this)},o.isBeyoudLimit=function(s){const e=this.getLimitTimePos();return u.A.getTimePos(s)>=e},o.getLimitTimePos=function(){if(this.limitTimePos===null){const s=this.getMeasure();this.limitTimePos=(0,x.A)(this.opts,s)}return this.limitTimePos},o.removeWord=function(s){const e=u.A.getTimePos(s),n=this.getMeasure(),l=h.default.getDpq(n),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:l};new p.default(this.scoreData,f,this.cancelStack).perform()},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},713735:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(94622);const u=h.A},714201:(S,D,t)=>{t.d(D,{A:()=>ot});var h=t(364596),u=t(701387),p=t(852363);const x=function(A,g,T){this.init(A,g,T)};x.NAME="primitive.AddOwnKey";const r=x.prototype;r.name=x.NAME,r.init=function(A,g,T){this.fullData=A,this.cancelStack=T,this.opts=g},r.perform=function(){const A=this.getMeasure(),g=u.default.getWrappedOwnKey(A),T=this.opts.staffIdx,y=o(g.getEntry(T)),Y=h.default.copy(this.opts.key);g.setEntry(Y,T);const Z=g.dumpAttribute();u.default.setOwnKey(A,Z),this.updateStack(y)};const o=function(A){return A===null?null:h.default.copy(A)};r.getMeasure=function(){return this.fullData.getPartContent(this.opts.partIdx).measure[this.opts.measureIdx]},r.updateStack=function(A){const g={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousKey:A,newKey:h.default.copy(this.opts.key)}};this.cancelStack.push(g),(0,p.default)(this.cancelStack,this.fullData,this.opts),this.opts.measureIdx>0&&(0,p.default)(this.cancelStack,this.fullData,{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1})};const a=x,s=function(A,g,T){this.init(A,g,T)};s.NAME="composite.AddOwnKeyIfNeeded";const e=s.prototype;e.name=s.NAME,e.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g,this.measure=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldAddOwnKey()&&this.addOwnKey()},e.shouldAddOwnKey=function(){return this.hasOwnKey()?this.hasDifferentOwnKey():!0},e.hasOwnKey=function(){const A=this.getMeasure();return u.default.getWrappedOwnKey(A).hasEntry(this.opts.staffIdx)},e.hasDifferentOwnKey=function(){const A=this.getKey(),g=this.getOwnKey();return!h.default.isSame(g,A)},e.getOwnKey=function(){const A=this.getMeasure();return u.default.getWrappedOwnKey(A).getEntry(this.opts.staffIdx)},e.addOwnKey=function(){const A=this.getKey(),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,key:h.default.copy(A)};new a(this.scoreData,g,this.cancelStack).perform()},e.getKey=function(){const A=this.getMeasure();return u.default.getWrappedKey(A).getEntry(this.opts.staffIdx)},e.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const n=s,l=function(A,g,T){this.init(A,g,T)};l.NAME="primitive.RemoveOwnKey";const f=l.prototype;f.name=l.NAME,f.init=function(A,g,T){this.fullData=A,this.cancelStack=T,this.opts=g},f.perform=function(){const A=this.getMeasure(),g=u.default.getWrappedOwnKey(A),T=this.opts.staffIdx,y=h.default.copy(g.getEntry(T));g.setEntry(null,T);const Y=g.dumpAttribute();u.default.setOwnKey(A,Y),this.updateStack(y)},f.getMeasure=function(){return this.fullData.getPartContent(this.opts.partIdx).measure[this.opts.measureIdx]},f.updateStack=function(A){const g={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,removedKey:A}};this.cancelStack.push(g),(0,p.default)(this.cancelStack,this.fullData,this.opts),this.opts.measureIdx>0&&(0,p.default)(this.cancelStack,this.fullData,{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1})};const v=l,_=function(A,g,T){this.init(A,g,T)};_.NAME="composite.RemoveOwnKeyIfNeeded";const m=_.prototype;m.name=_.NAME,m.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g,this.measure=null},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnKey()&&this.removeOwnKey()},m.hasOwnKey=function(){const A=this.getMeasure();return u.default.getWrappedOwnKey(A).hasEntry(this.opts.staffIdx)},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.removeOwnKey=function(){const A={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new v(this.scoreData,A,this.cancelStack).perform()};const d=_,c=0,i=function(A,g,T){this.init(A,g,T)};i.NAME="composite.UpdateNextOwnKey";const I=i.prototype;I.name=i.NAME,I.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g,this.measures=null},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasNextMeasure()&&this.updateNextKey()},I.hasNextMeasure=function(){const A=this.getNbMeasures();return this.opts.measureIdx<A-1},I.getNbMeasures=function(){return this.getMeasures().length},I.updateNextKey=function(){this.isNextMeasureKeySame()?this.removeNextOwnKey():this.isNextKeyC()?this.refreshNextCIfNeeded():this.addNextOwnKey()},I.isNextMeasureKeySame=function(){const A=this.getCurrentMeasureKey(),g=this.getNextMeasureKey();return h.default.isSame(A,g)},I.removeNextOwnKey=function(){const A=this.deriveOpts();new d(this.scoreData,A,this.cancelStack).perform()},I.isNextKeyC=function(){const A=this.getNextMeasureKey();return h.default.getFifths(A)===c},I.getNextMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx+1)},I.refreshNextCIfNeeded=function(){this.hasCurrentKeyChanged()?this.forceAddNextOwnKey():this.addNextOwnKey()},I.hasCurrentKeyChanged=function(){const A=this.getCurrentMeasureKey();return!h.default.isSame(A,this.opts.savedKey)},I.getCurrentMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx)},I.getMeasureKey=function(A){const g=this.getMeasure(A);return u.default.getWrappedKey(g).getEntry(this.opts.staffIdx)},I.getMeasure=function(A){return this.getMeasures()[A]},I.getMeasures=function(){if(this.measures===null){const A=this.scoreData.getPartContent(this.opts.partIdx);this.measures=A.measure}return this.measures},I.forceAddNextOwnKey=function(){const A=this.deriveOpts(),g=this.getNextMeasureKey();A.key=h.default.copy(g),new a(this.scoreData,A,this.cancelStack).perform()},I.addNextOwnKey=function(){const A=this.deriveOpts();new n(this.scoreData,A,this.cancelStack).perform()},I.deriveOpts=function(){return{partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.measureIdx+1}};const M=i;var E=t(737903);const P=function(A,g,T){this.init(A,g,T)};P.NAME="composite.UpdateOwnKey";const O=P.prototype;O.name=P.NAME,O.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g,this.measures=null},O.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnKey()?this.addOwnKey():this.removeOwnKey()},O.shouldHaveOwnKey=function(){return this.hasPreviousMeasure()?this.isPreviousMeasureKeyDifferent():!0},O.hasPreviousMeasure=function(){return this.opts.measureIdx>0},O.isPreviousMeasureKeyDifferent=function(){const A=this.getCurrentMeasureKey(),g=this.getPreviousMeasureKey();return!h.default.isSame(g,A)},O.getCurrentMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx)},O.getPreviousMeasureKey=function(){return this.getMeasureKey(this.opts.measureIdx-1)},O.getMeasureKey=function(A){const g=this.getMeasure(A);return u.default.getWrappedKey(g).getEntry(this.opts.staffIdx)},O.getMeasure=function(A){return this.getMeasures(A)[A]},O.getMeasures=function(){if(this.measures===null){const A=this.scoreData.getPartContent(this.opts.partIdx);this.measures=A.measure}return this.measures},O.addOwnKey=function(){const A=(0,E.default)(this.opts);new n(this.scoreData,A,this.cancelStack).perform()},O.removeOwnKey=function(){const A=(0,E.default)(this.opts);new d(this.scoreData,A,this.cancelStack).perform()};const K=P,w=function(A,g,T){this.init(A,g,T)};w.NAME="composite.UpdateInternalOwnKeyRange";const k=w.prototype;k.name=w.NAME,k.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const A=this.opts.firstMeasureIdx,g=this.opts.lastMeasureIdx;for(let T=A;T<=g;T++)this.updateMeasureOwnKey(T)},k.updateMeasureOwnKey=function(A){const g={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:A};new K(this.scoreData,g,this.cancelStack).perform()};const R=w,L=function(A,g,T){this.init(A,g,T)};L.NAME="composite.UpdateOwnKeyRange";const j=L.prototype;j.name=L.NAME,j.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g},j.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.updateInternalOwnKeyRange(),this.updateNextOwnKey()},j.updateInternalOwnKeyRange=function(){const A=(0,E.default)(this.opts);new R(this.scoreData,A,this.cancelStack).perform()},j.updateNextOwnKey=function(){const A={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.lastMeasureIdx,savedKey:h.default.copy(this.opts.savedKey)};new M(this.scoreData,A,this.cancelStack).perform()};const V=L;var J=t(628827);const G=function(A,g,T){this.init(A,g,T)};G.NAME="primitive.SetKey";const z=G.prototype;z.name=G.NAME,z.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g},z.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const A=this.setKey();this.updateStack(A)},z.setKey=function(){const A=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),g=u.default.getWrappedKey(A),T=this.opts.staffIdx,y=h.default.copy(g.getEntry(T)),Y=h.default.copy(this.opts.key);g.setEntry(Y,T);const Z=g.dumpAttribute();return u.default.setKey(A,Z),y},z.updateStack=function(A){const g={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousKey:A,newKey:h.default.copy(this.opts.key)}};this.cancelStack.push(g),(0,p.default)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0&&(0,p.default)(this.cancelStack,this.scoreData,{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1})};const F=G;var tt=t(750026);const b=function(A,g,T){this.init(A,g,T)};b.NAME="composite.SetKey";const N=b.prototype;N.name=b.NAME,N.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g,this.measureData=null},N.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setKey(),this.updateVoicesAccidentals()},N.setKey=function(){const A=h.default.copy(this.opts.key),g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,key:A};new F(this.scoreData,g,this.cancelStack).perform()},N.updateVoicesAccidentals=function(){const A=this.getMeasureData();let g=this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx);g=g.filter(A.hasVoice,A),g.forEach(this.updateVoiceAccidentals,this)},N.updateVoiceAccidentals=function(A){const g=this.getMeasureData(),T={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:A};new J.A(g,T,this.cancelStack).perform()},N.getMeasureData=function(){return this.measureData===null&&(this.measureData=(0,tt.A)(this.scoreData,this.opts.partIdx,this.opts.measureIdx)),this.measureData};const B=b,H=function(A,g,T){this.init(A,g,T)};H.NAME="composite.SetMeasuresRangeKey";const $=H.prototype;$.name=H.NAME,$.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g},$.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let A=this.opts.startMeasureIdx;A<=this.opts.stopMeasureIdx;A++)this.setMeasureKey(A)},$.setMeasureKey=function(A){const g=h.default.copy(this.opts.key),T={partIdx:this.opts.partIdx,measureIdx:A,staffIdx:this.opts.staffIdx,key:g};new B(this.scoreData,T,this.cancelStack).perform()};const q=H,et=function(A,g,T){this.init(A,g,T)};et.NAME="composite.SetKeySegment";const st=et.prototype;st.name=et.NAME,st.init=function(A,g,T){this.scoreData=A,this.cancelStack=T,this.opts=g},st.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const A=this.getKey();this.setKey(),this.updateOwnKey(A)},st.getKey=function(){const A=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),g=u.default.getWrappedKey(A),T=this.opts.staffIdx;return h.default.copy(g.getEntry(T))},st.setKey=function(){const A=h.default.copy(this.opts.key),g={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,key:A};new q(this.scoreData,g,this.cancelStack).perform()},st.updateOwnKey=function(A){const g={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,firstMeasureIdx:this.opts.startMeasureIdx,lastMeasureIdx:this.opts.stopMeasureIdx,savedKey:A};new V(this.scoreData,g,this.cancelStack).perform()};const ot=et},726800:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(125911);const u=h.A},731725:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(701387),u=t(536949),p=t(24443),x=t(316610);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemovePizzicatosFrom";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null,this.limitTimePos=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePizzicatosFrom()},o.removePizzicatosFrom=function(){const s=this.getMeasure();let e=h.default.getPizzicatos(s,this.opts.staffIdx);e=e.filter(this.isBeyoudLimit,this),e.forEach(this.removePizzicato,this)},o.isBeyoudLimit=function(s){const e=this.getLimitTimePos();return u.A.getTimePos(s)>=e},o.getLimitTimePos=function(){if(this.limitTimePos===null){const s=this.getMeasure();this.limitTimePos=(0,x.A)(this.opts,s)}return this.limitTimePos},o.removePizzicato=function(s){const e=u.A.getTimePos(s),n=this.getMeasure(),l=h.default.getDpq(n),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:l};new p.default(this.scoreData,f,this.cancelStack).perform()},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},734677:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(733982);const u=h.A},739293:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(203066);const u=h.A},746822:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(844191);const u=h.A},747493:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(476943),u=t(364596),p=t(123491),x=t(351277),r=t(595382);const o=u.default.createC();function a(n,l,f){f=e(f);for(let v=l.measureIdx;v>=0;v--){const _=n.getMeasureData(v);if(!_.hasVoice(l.voiceIdx))continue;const m=_.getVoice(l.voiceIdx);let c=m.getNbNotes()-1;for(v===l.measureIdx&&(c=l.noteIdx);c>=0;c--){if(m.isRest(c))continue;if(v!==l.measureIdx||c!==l.noteIdx){const M=h.default.makeArray(m.getChord(c)),E=s(M,f);if(E)return E}let I=m.getNbGraces(c)-1;for(v===l.measureIdx&&c===l.noteIdx&&typeof l.graceIdx!="undefined"&&(I=l.graceIdx-1);I>=0;I--){const M=h.default.makeArray(m.getGraceChord(c,I)),E=s(M,f);if(E)return E}}}return null}function s(n,l){const f=n.find(_=>{let m=p.default.getPitch(_);return m=e(m),!(!x.default.isSamePitch(m,l)||!p.default.hasFretData(_))});return f?p.default.getFretData(f):!1}function e(n){return n=r.A.normalize(n,o),x.default.getAlter(n)<0&&(n=r.A.switchEnharmonic(n,o)),n}},750026:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(290087);const u=h.A},750103:(S,D,t)=>{t.d(D,{A:()=>d});var h=t(44229);const u=h.A;var p=t(754998),x=t(547336),r=t(760367),o=t(737903),a=t(123491),s=t(292681),e=t(793317),n=t(519405),l=t(768498),f=t(278572),v=t(883740);const _=function(c,i,I){this.init(c,i,I)};_.NAME="composite.RemoveFromChordPercu";const m=_.prototype;m.name=_.NAME,m.initMeasureData=e.default,m.init=function(c,i,I){this.initMeasureData(c,i),this.cancelStack=I,this.opts=i,this.sanitized=!1,this.voice=null,this.location=null,this.chordHead=null},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTie(),this.removeGhost(),this.removeColor(),this.removeTieDirection(),this.removeFromChord()},m.removeTie=function(){const c=this.getChordHead();if(!a.default.hasTie(c))return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,"display-step":s.default.getStep(this.opts.unpitched),"display-octave":s.default.getOctave(this.opts.unpitched)},I=new p.default(this.measureData,i,this.cancelStack);(0,n.default)(I)},m.removeGhost=function(){const c=this.getChordHead();if(!a.default.hasHeadParentheses(c))return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:s.default.copy(this.opts.unpitched)},I=new x.default(this.measureData,i,this.cancelStack);(0,n.default)(I)},m.removeColor=function(){const c=this.getChordHead();if(!a.default.hasColor(c))return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:s.default.copy(this.opts.unpitched)},I=new f.default(this.measureData,i,this.cancelStack);(0,n.default)(I)},m.removeTieDirection=function(){const c=this.getChordHead();if(a.default.getTieDirection(c)===r.A.AUTO)return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:s.default.copy(this.opts.unpitched),tieDirection:r.A.AUTO},I=new v.default(this.measureData,i,this.cancelStack);(0,n.default)(I)},m.getChordHead=function(){if(this.chordHead===null){const c=this.measureData.getVoice(this.opts.voiceIdx);this.chordHead=(0,l.A)(c,this.opts.noteIdx,this.opts.unpitched)}return this.chordHead},m.removeFromChord=function(){const c=(0,o.default)(this.opts);new u(this.measureData,c,this.cancelStack).perform()};const d=_},758035:(S,D,t)=>{t.d(D,{A:()=>M});var h=t(364842),u=t(259563),p=t(209175),x=t(123491),r=t(476943),o=t(351277),a=t(292681),s=t(515819),e=t(737296),n=t(91894),l=t(582458),f=t(122007),v=t(804617),_=t(3771),m=t(443923),d=t(793317),c=t(519405);const i=function(E,P,O){this.init(E,P,O)};i.NAME="composite.RemoveTuplet";const I=i.prototype;I.name=i.NAME,I.initMeasureData=d.default,I.init=function(E,P,O){this.initMeasureData(E,P),this.cancelStack=O,this.opts=P,this.localTimeModif=null,this.totalDuration=null,this.upperTimeModif=null,this.noteIdx=null},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.gatherData(),this.increaseDivisionsIfNeeded(),this.clearContent(),this.resizeFirstNoteIfNeeded(),this.saveTotalDuration(),this.removeRestsButOne(),this.removeTuplet(),this.resizeNote()},I.gatherData=function(){const E=this.getTuplet();this.localTimeModif=p.default.copy(E.getLocalTimeModif());const P=E.getAbsoluteTimeModif();this.upperTimeModif=p.default.subtract(P,this.localTimeModif)},I.increaseDivisionsIfNeeded=function(){const E=this.getTuplet(),P=E.getDurationType(),O=E.getLocalTimeModif(),K=p.default.getShiftToWholeDurationType(O),w=P+K,k=p.default.getWholeNbDots(O),R=this.upperTimeModif,L={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:w,nbDots:k,timeModif:p.default.copy(R)};new _.A(this.measureData,L,this.cancelStack).perform()},I.saveTotalDuration=function(){const E=this.getTuplet(),P=E.getStartNoteIdx(),O=E.getStopNoteIdx();let K=0;for(let w=P;w<=O;w++){const k=E.getNote(w),R=x.default.getDuration(k);K+=R}this.totalDuration=K},I.clearContent=function(){const E=this.getTuplet(),P=E.size();let O=E.getStopNoteIdx();for(let K=1;K<P;K++)E.isRest(O)?this.unlockRest(O):this.removeChord(O),O--},I.removeChord=function(E){let O=this.getVoice().getChord(E);O=r.default.makeArray(O).slice(),this.noteIdx=E,O.forEach(this.removeChordHead,this)},I.removeChordHead=function(E){if(x.default.hasPitch(E)){const P=x.default.getPitch(E);this.removePitched(P)}else if(x.default.hasUnpitched(E)){const P=x.default.getUnpitched(E);this.removeUnpitched(P)}else{const P="Cannot have a note neither pitched nor unpitched.";throw new h.default("Unexpected",P)}},I.removePitched=function(E){E=o.default.copy(E);const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,pitch:E,insertMode:e.default.REPLACE,keepFormer:!1},O=new n.default(this.measureData,P,this.cancelStack);(0,c.default)(O)},I.removeUnpitched=function(E){E=a.default.copy(E);const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,unpitched:E,insertMode:e.default.REPLACE,keepFormer:!1},O=new f.default(this.measureData,P,this.cancelStack);(0,c.default)(O)},I.unlockRest=function(E){const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:E};new m.A(this.measureData,P,this.cancelStack).perform()},I.resizeFirstNoteIfNeeded=function(){this.needResizeFirstNote()&&this.resizeFirstNote()},I.needResizeFirstNote=function(){const E=this.getShardDuration(),P=this.getTuplet(),O=P.getStartNoteIdx(),K=P.getNote(O);return x.default.getDuration(K)!==E},I.getShardDuration=function(){const E=this.getTuplet(),P=this.measureData.getDpqValue(),O=E.getAbsoluteTimeModif(),K=E.getDurationType(),w=u.default.toQuarterDuration(K),k=s.default.quarterToDuration(w,P);return s.default.normalToActual(k,O)},I.resizeFirstNote=function(){const E=this.getTuplet(),P=E.getStartNoteIdx(),O=E.getDurationType(),K={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:P,insertMode:e.default.REPLACE,durationType:O,nbDots:0,record:!0},w=new l.default(this.measureData,K,this.cancelStack);(0,c.default)(w)},I.removeRestsButOne=function(){const P=this.getTuplet().size();for(let O=1;O<P;O++){const K={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1};new v.A(this.measureData,K,this.cancelStack).perform()}},I.removeTuplet=function(){const E=this.getNote(),O=this.getTuplet().getTupletLevel();x.default.removeTupletLevelAndOutside(E,O)},I.getTuplet=function(){const E=this.opts.voiceIdx,P=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(E,P)},I.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},I.resizeNote=function(){this.getNoteOrChord().forEach(this.resizeChordHead,this)},I.getNoteOrChord=function(){const E=this.getVoice();let P;return E.isRest(this.opts.noteIdx)?P=E.getNote(this.opts.noteIdx):P=E.getChord(this.opts.noteIdx),P=r.default.makeArray(P),P},I.getVoice=function(){const E=this.opts.voiceIdx;return this.measureData.getVoice(E)},I.resizeChordHead=function(E){const P=this.localTimeModif,O=p.default.getWholeNbDots(P);x.default.setNbDots(E,O);const K=this.upperTimeModif;x.default.setTimeModif(E,K);const w=this.totalDuration;x.default.setDuration(E,w)};const M=i},759428:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(123491),u=t(852363),p=t(793317);const x=function(a,s,e){this.init(a,s,e)};x.NAME="primitive.RemoveTechnical";const r=x.prototype;r.name=x.NAME,r.initMeasureData=p.default,r.init=function(a,s,e){this.initMeasureData(a,s),this.cancelStack=e,this.opts=s},r.perform=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);h.default.removeTechnical(s,this.opts.technicalType),this.updateStack()},r.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a),(0,u.default)(this.cancelStack,this.measureData,this.opts)};const o=x},764649:(S,D,t)=>{t.d(D,{A:()=>w});var h=t(351277),u=t(123491),p=t(691309),x=t(793317),r=t(316197),o=t(129283);function a(k){const R=k.getLeftChord(),L=k.getRightChord(),j={};return s(R,j),e(L,j),j}function s(k,R){k.forEach(function(L){u.default.getGlissandoStarts(L).forEach(n,R)})}function e(k,R){k.forEach(function(L){u.default.getGlissandoStops(L).forEach(n,R)})}function n(k){const R=this,L=r.default.getNumber(k);R[L]=!0}var l=t(342141),f=t(852363);const v=function(k,R,L){this.init(k,R,L)};v.NAME="primitive.AddGlissando";const _=v.prototype;_.name=v.NAME,_.initMeasureData=x.default,_.init=function(k,R,L){this.initMeasureData(k,R),this.opts=R,this.cancelStack=L,this.crossMeasure=new p.default(this.measureData,R.voiceIdx,R.noteIdx)},_.perform=function(){this.addGlissando(),this.updateStack()},_.addGlissando=function(){const k=this.getNumber();this.addGlissandoToLeftNote(k),this.addGlissandoToRightNote(k)},_.getNumber=function(){const k=a(this.crossMeasure);return(0,l.A)(k)},_.addGlissandoToLeftNote=function(k){const L=this.crossMeasure.getLeftChord().find(m,this.opts.leftPitch),j=r.default.create(o.default.START,k);u.default.addGlissando(L,j)},_.addGlissandoToRightNote=function(k){const L=this.crossMeasure.getRightChord().find(m,this.opts.rightPitch),j=r.default.create(o.default.STOP,k);u.default.addGlissando(L,j)};function m(k){const R=this,L=u.default.getPitch(k);return h.default.isSameLine(L,R)}_.updateStack=function(){const k=this.crossMeasure.getLeftMeasureIdx(),R=this.crossMeasure.getRightMeasureIdx(),L=this.opts.partIdx,j={type:this.name,opts:{partIdx:L,measureIdx:k}};this.cancelStack.push(j),(0,f.default)(this.cancelStack,this.measureData,{partIdx:L,measureIdx:k});const V={type:`${this.name}-close`,opts:{partIdx:L,measureIdx:R}};this.cancelStack.push(V),R!==k&&(0,f.default)(this.cancelStack,this.measureData,{partIdx:L,measureIdx:R})};const d=v;var c=t(679676),i=t(805396),I=t(519405),M=t(445330),E=t(578918),P=t(417477);const O=function(k,R,L){this.init(k,R,L)};O.NAME="composite.AddGlissando";const K=O.prototype;K.name=O.NAME,K.initMeasureData=x.default,K.init=function(k,R,L){this.initMeasureData(k,R),this.opts=R,this.cancelStack=L,this.crossMeasure=new p.default(this.measureData,R.voiceIdx,R.noteIdx)},K.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTie(),this.removeSlide(),this.removeTremolo(),this.addGlissando()},K.removeTie=function(){if(!h.default.isSameLine(this.opts.leftPitch,this.opts.rightPitch))return;const k=this.measureData.getVoice(this.opts.voiceIdx),R=(0,E.default)(k,this.opts.noteIdx,this.opts.leftPitch);if(!u.default.hasTieStart(R))return;const L={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,step:h.default.getStep(this.opts.leftPitch),octave:h.default.getOctave(this.opts.leftPitch)},j=new c.default(this.measureData,L,this.cancelStack);(0,I.default)(j)},K.removeSlide=function(){if((0,M.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch)){const k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:h.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:h.default.copyWithoutAlter(this.opts.rightPitch)},R=new P.default(this.measureData,k,this.cancelStack);(0,I.default)(R)}},K.removeTremolo=function(){const[k]=this.crossMeasure.getLeftChord();if(u.default.hasTremoloStart(k)){const R={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()},L=this.crossMeasure.getRightMeasure(),j=new i.default(L,R,this.cancelStack);(0,I.default)(j)}},K.addGlissando=function(){const k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:h.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:h.default.copyWithoutAlter(this.opts.rightPitch)};new d(this.measureData,k,this.cancelStack).perform()};const w=O},766246:(S,D,t)=>{t.d(D,{A:()=>v});var h=t(123491),u=t(351277),p=t(793317),x=t(762860),r=t(852363);const o=function(_,m,d){this.init(_,m,d)};o.NAME="primitive.AddColorToGrace";const a=o.prototype;a.name=o.NAME,a.initMeasureData=p.default,a.init=function(_,m,d){this.initMeasureData(_,m),this.cancelStack=d,this.opts=m},a.perform=function(){this.addColor(),this.updateStack()},a.addColor=function(){const _=this.measureData.getVoice(this.opts.voiceIdx),m=(0,x.A)(_,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);h.default.setColor(m,this.opts.color)},a.updateStack=function(){const _={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(_),(0,r.default)(this.cancelStack,this.measureData,this.opts)};const s=o;var e=t(408649),n=t(519405);const l=function(_,m,d){this.init(_,m,d)};l.NAME="composite.AddColorToGrace";const f=l.prototype;f.initMeasureData=p.default,f.name=l.NAME,f.init=function(_,m,d){this.initMeasureData(_,m),this.cancelStack=d,this.opts=m},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerColor()&&this.removeFormerColor(),this.addColorToGrace()},f.hasFormerColor=function(){const _=this.measureData.getVoice(this.opts.voiceIdx),m=(0,x.A)(_,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);return h.default.hasColor(m)},f.removeFormerColor=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:u.default.copy(this.opts.pitch)},m=new e.default(this.measureData,_,this.cancelStack);(0,n.default)(m)},f.addColorToGrace=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:u.default.copy(this.opts.pitch),color:this.opts.color};new s(this.measureData,_,this.cancelStack).perform()};const v=l},768498:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(476943),u=t(292681),p=t(123491);const x=function(s,e,n,l){let f=r(s,e,l);return f=h.default.makeArray(f),f.find(o,n)},r=function(s,e,n){return typeof n=="number"?s.getGraceChord(e,n):s.getChord(e)},o=function(s){const e=this,n=p.default.getUnpitched(s);return u.default.isSameLine(n,e)},a=x},777501:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(701387),u=t(721247),p=t(703447),x=t(316610);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveMiddleClefsFrom";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null,this.limitTimePos=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMiddleClefsFrom()},o.removeMiddleClefsFrom=function(){const s=this.getMeasure();let e=h.default.getMiddleClefs(s,this.opts.staffIdx);e=e.filter(this.isBeyoudLimit,this),e.forEach(this.removeMiddleClef,this)},o.isBeyoudLimit=function(s){const e=this.getLimitTimePos();return u.default.getTimePos(s)>=e},o.getLimitTimePos=function(){if(this.limitTimePos===null){const s=this.getMeasure();this.limitTimePos=(0,x.A)(this.opts,s)}return this.limitTimePos},o.removeMiddleClef=function(s){const e=u.default.getTimePos(s),n=this.getMeasure(),l=h.default.getDpq(n),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:l};new p.default(this.scoreData,f,this.cancelStack).perform()},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},819373:(S,D,t)=>{t.d(D,{A:()=>e});var h=t(793317),u=t(578918),p=t(852363),x=t(123491),r=t(351277),o=t(359932);const a=function(n,l,f){this.init(n,l,f)};a.NAME="primitive.UnsetFret";const s=a.prototype;s.name=a.NAME,s.initMeasureData=h.default,s.init=function(n,l,f){this.initMeasureData(n,l),this.opts=l,this.cancelStack=f},s.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},s.getNoteAtPitch=function(){const n=this.getVoice();return(0,u.default)(n,this.opts.noteIdx,this.opts.pitch)},s.perform=function(){const n=this.getNoteAtPitch();x.default.removeTechnical(n,o.default.FRET),x.default.removeTechnical(n,o.default.STRING),this.updateCancelStack()},s.updateCancelStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:r.default.copy(this.opts.pitch)}};this.cancelStack.push(n),(0,p.default)(this.cancelStack,this.measureData,this.opts)};const e=a},820771:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(852363),u=t(701387),p=t(614653),x=t(529355);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.RemoveHarmony";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null},o.perform=function(){const s=this.removeHarmony();this.updateStack(s)},o.removeHarmony=function(){const s=this.getMeasure(),e=u.default.getJazzHarmonies(s),n=e.splice(this.opts.harmonyIdx,1)[0];return u.default.setJazzHarmonies(s,e),n},o.updateStack=function(s){let e=p.default.getRoot(s);e=x.A.copy(e);const n=p.default.getKindValue(s),l=p.default.getTimePos(s),f=this.getDpq(),v={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:this.opts.harmonyIdx,timePos:l,dpq:f,kind:n,root:e}};this.cancelStack.push(v),(0,h.default)(this.cancelStack,this.scoreData,this.opts)},o.getDpq=function(){const s=this.getMeasure();return u.default.getDpq(s)},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},825238:(S,D,t)=>{t.d(D,{A:()=>m});var h=t(351277),u=t(123491),p=t(316197),x=t(669208),r=t(793317),o=t(691309),a=t(364842);function s(d,c){const I=d.getLeftChord().find(e,c);if(I)return u.default.getPitch(I);throw new a.default("Unexpected",`There is no glissando start with the number ${c}`)}function e(d){const c=this.valueOf();return u.default.getGlissandoStarts(d).some(n,c)}function n(d){const c=this.valueOf();return p.default.getNumber(d)===c}var l=t(519405);const f=function(d,c,i){this.init(d,c,i)};f.NAME="composite.RemoveHeadLeftGlissandos";const v=f.prototype;v.name=f.NAME,v.initMeasureData=r.default,v.init=function(d,c,i){this.initMeasureData(d,c),this.opts=c,this.cancelStack=i,this.crossMeasure=new o.default(this.measureData,c.voiceIdx,c.noteIdx-1)},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHeadLeftGlissandos()},v.removeHeadLeftGlissandos=function(){this.getGlissandoStops().map(p.default.getNumber).map(this.findLeftPitch,this).forEach(this.removeGlissando,this)},v.getGlissandoStops=function(){const c=this.crossMeasure.getRightChord().find(_,this.opts.pitch);return u.default.getGlissandoStops(c)};function _(d){const c=this,i=u.default.getPitch(d);return h.default.isSameLine(i,c)}v.findLeftPitch=function(d){return s(this.crossMeasure,d)},v.removeGlissando=function(d){const c=this.crossMeasure.getLeftMeasureIdx(),i=this.crossMeasure.getLeftNoteIdx(),I={partIdx:this.opts.partIdx,measureIdx:c,voiceIdx:this.opts.voiceIdx,noteIdx:i,leftPitch:h.default.copy(d),rightPitch:h.default.copy(this.opts.pitch)},M=this.crossMeasure.getLeftMeasure(),E=new x.default(M,I,this.cancelStack);(0,l.default)(E)};const m=f},827303:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(701387),u=t(496819),p=t(275225),x=t(316610);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveDynamicsFrom";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null,this.limitTimePos=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeDynamicsFrom()},o.removeDynamicsFrom=function(){const s=this.getMeasure();let e=h.default.getDynamics(s,this.opts.staffIdx);e=e.filter(this.isBeyoudLimit,this),e.forEach(this.removeDynamic,this)},o.isBeyoudLimit=function(s){const e=this.getLimitTimePos();return u.A.getTimePos(s)>=e},o.getLimitTimePos=function(){if(this.limitTimePos===null){const s=this.getMeasure();this.limitTimePos=(0,x.A)(this.opts,s)}return this.limitTimePos},o.removeDynamic=function(s){const e=u.A.getTimePos(s),n=this.getMeasure(),l=h.default.getDpq(n),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:l};new p.default(this.scoreData,f,this.cancelStack).perform()},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},834951:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(951066);function u(x){return`Note doesn't have fret data opts ${x}`}class p extends h.A{constructor(r){const o=u(r);super(o),Object.defineProperty(this,"technicalType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="DoesntHaveFretDataOptsError",this.technicalType=r}}},836733:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(663534);const u=h.A},850883:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(951066);function u(x){return`Note doesn't have Technical ${x}`}class p extends h.A{constructor(r){const o=u(r);super(o),Object.defineProperty(this,"technicalType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="DoesntHaveTechnicalError",this.technicalType=r}}},865123:(S,D,t)=>{t.d(D,{A:()=>c});var h=t(97324),u=t(446921),p=t(224874),x=t(852363),r=t(31278),o=t(368495),a=t(701387);const s=function(i,I,M){this.init(i,I,M)};s.NAME="primitive.RemovePluckedRangeSide";const e=s.prototype;e.name=s.NAME,e.init=function(i,I,M){this.scoreData=i,this.cancelStack=M,this.opts=I,this.removedPluckedRange=null,this.pluckedRanges=null,this.pluckedRangeIdx=null},e.perform=function(){this.removePluckedRangeSide(),this.updateStack()},e.removePluckedRangeSide=function(){const i=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),I=a.default.getPluckedRanges(i,this.opts.staffIdx),M=this.getPluckedRangeIdx(),E=I.splice(M,1);if(this.removedPluckedRange=E[0],o.A.isStart(this.removedPluckedRange)){const P=o.A.getPluckedRangeUuid(this.removedPluckedRange),O=this.scoreData.getPartContent(this.opts.partIdx);u.A.removePluckedRange(O,P)}a.default.setPluckedRanges(i,this.opts.staffIdx,I)},e.updateStack=function(){const i={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(i),(0,x.default)(this.cancelStack,this.scoreData,this.opts)},e.getPluckedRangeIdx=function(){return this.pluckedRangeIdx===null&&this.fetchPluckedRangeIdx(),this.pluckedRangeIdx},e.fetchPluckedRangeIdx=function(){if(this.pluckedRangeIdx=null,this.getPluckedRanges().some(this.checkPluckedRange,this),this.pluckedRangeIdx===null)throw new r.default},e.checkPluckedRange=function(i,I){const M=o.A.getTimePos(i),E=o.A.getType(i);return M<this.opts.timePos?!1:(M===this.opts.timePos&&E===this.opts.type&&(this.pluckedRangeIdx=I),!0)},e.getPluckedRanges=function(){if(this.pluckedRanges===null){const i=this.getMeasure();this.pluckedRanges=a.default.getPluckedRanges(i,this.opts.staffIdx)}return this.pluckedRanges},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const n=s;var l=t(364842);const f=function(i,I,M){this.init(i,I,M)};f.NAME="primitive.RemovePluckedRangeContinue";const v=f.prototype;v.name=f.NAME,v.init=function(i,I,M){this.scoreData=i,this.cancelStack=M,this.opts=I},v.perform=function(){this.removeLeftPluckedRange(),this.removeRightPluckedRange(),this.updateStack()},v.removeLeftPluckedRange=function(){const i=this.getLeftMeasure();if(!a.default.hasRightPluckedRange(i,this.opts.staffIdx)){const I="There is no right octave shift to remove on the left measure.";throw new l.default("MissingRightContinuePluckedRange",I)}a.default.removeRightPluckedRange(i,this.opts.staffIdx)},v.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},v.removeRightPluckedRange=function(){const i=this.getRightMeasure();if(!a.default.hasLeftPluckedRange(i,this.opts.staffIdx)){const I="There is no left octave shift to remove on the left measure.";throw new l.default("MissingLeftContinuePluckedRange",I)}a.default.removeLeftPluckedRange(i,this.opts.staffIdx)},v.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},v.updateStack=function(){const i={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(i),(0,x.default)(this.cancelStack,this.scoreData,this.opts)};const _=f,m=function(i,I,M){this.init(i,I,M)};m.NAME="composite.RemovePluckedRange";const d=m.prototype;d.name=m.NAME,d.init=function(i,I,M){this.scoreData=i,this.cancelStack=M,this.opts=I,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null,this.type=null,this.size=null},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},d.searchSides=function(){const i=this.getMeasures(),I=(0,p.A)(i,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=I.startMeasureIdx,this.startTimePos=I.startTimePos,this.stopMeasureIdx=I.stopMeasureIdx,this.stopTimePos=I.stopTimePos,this.type=I.type,this.size=I.size},d.getMeasures=function(){const i=this.scoreData.getPartContent(this.opts.partIdx);return u.A.getMeasures(i)},d.removeStart=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,type:this.type,size:this.size};new n(this.scoreData,i,this.cancelStack).perform()},d.removeStop=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,type:h.A.STOP,size:this.size};new n(this.scoreData,i,this.cancelStack).perform()},d.removeContinues=function(){for(let i=this.startMeasureIdx;i<this.stopMeasureIdx;i++)this.removeContinue(i)},d.removeContinue=function(i){const I={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:i};new _(this.scoreData,I,this.cancelStack).perform()};const c=m},872523:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(607682);class u extends h.default{constructor(){super("There is no plucked range at this location."),this.name="NoPluckedRangeError"}}},874868:(S,D,t)=>{t.d(D,{A:()=>I});var h=t(701387),u=t(721247),p=t(852363);const x=function(M,E,P){this.init(M,E,P)};x.NAME="primitive.AddOwnClef";const r=x.prototype;r.name=x.NAME,r.init=function(M,E,P){this.scoreData=M,this.cancelStack=P,this.opts=E},r.perform=function(){const M=this.getMeasure(),E=h.default.getWrappedOwnClef(M),P=this.opts.staffIdx,O=o(E.getEntry(P)),K=u.default.copy(this.opts.clef);E.setEntry(K,P);const w=E.dumpAttribute();h.default.setOwnClef(M,w),this.updateStack(O)};const o=function(M){return M===null?null:u.default.copy(M)};r.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},r.updateStack=function(M){const E={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousClef:M,newClef:u.default.copy(this.opts.clef)}};this.cancelStack.push(E),(0,p.default)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0&&(this.updateStackDraw(),(0,p.default)(this.cancelStack,this.scoreData,{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1}))},r.updateStackDraw=function(){const M={type:`${this.name}-draw`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(M)};const a=x,s=function(M,E,P){this.init(M,E,P)};s.NAME="composite.AddOwnClefIfNeeded";const e=s.prototype;e.name=s.NAME,e.init=function(M,E,P){this.scoreData=M,this.cancelStack=P,this.opts=E,this.measure=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnClef()&&this.addOwnClef()},e.needAddOwnClef=function(){return this.hasOwnClef()?!this.hasSameClef():!0},e.hasOwnClef=function(){const M=this.getMeasure();return h.default.getWrappedOwnClef(M).hasEntry(this.opts.staffIdx)},e.hasSameClef=function(){const M=this.getMeasure(),P=h.default.getWrappedOwnClef(M).getEntry(this.opts.staffIdx);return u.default.isSame(P,this.opts.clef)},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},e.addOwnClef=function(){const M=u.default.copy(this.opts.clef),E={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clef:M};new a(this.scoreData,E,this.cancelStack).perform()};const n=s,l=function(M,E,P){this.init(M,E,P)};l.NAME="primitive.RemoveOwnClef";const f=l.prototype;f.name=l.NAME,f.init=function(M,E,P){this.scoreData=M,this.cancelStack=P,this.opts=E},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const M=this.removeOwnClef();this.updateStack(M)},f.removeOwnClef=function(){const M=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),E=h.default.getWrappedOwnClef(M),P=this.opts.staffIdx;let O=E.getEntry(P);O=u.default.copy(O),E.setEntry(null,P);const K=E.dumpAttribute();return h.default.setOwnClef(M,K),O},f.updateStack=function(M){const E={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,removedClef:M}};this.cancelStack.push(E),(0,p.default)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0&&(this.updateStackDraw(),(0,p.default)(this.cancelStack,this.scoreData,{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1}))},f.updateStackDraw=function(){const M={type:`${this.name}-draw`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(M)};const v=l,_=function(M,E,P){this.init(M,E,P)};_.NAME="composite.RemoveOwnClefIfNeeded";const m=_.prototype;m.name=_.NAME,m.init=function(M,E,P){this.scoreData=M,this.cancelStack=P,this.opts=E,this.measure=null},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnClef()&&this.removeOwnClef()},m.hasOwnClef=function(){const M=this.getMeasure();return h.default.getWrappedOwnClef(M).hasEntry(this.opts.staffIdx)},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.removeOwnClef=function(){const M={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new v(this.scoreData,M,this.cancelStack).perform()};const d=_,c=function(M,E,P){this.init(M,E,P)};c.NAME="composite.UpdateOwnClef";const i=c.prototype;i.name=c.NAME,i.init=function(M,E,P){this.scoreData=M,this.cancelStack=P,this.opts=E,this.measures=null},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnClef()?this.addOwnClef():this.removeOwnClef()},i.shouldHaveOwnClef=function(){return this.hasPreviousMeasure()?this.isPreviousMeasureClefDifferent():!0},i.hasPreviousMeasure=function(){return this.opts.measureIdx>0},i.isPreviousMeasureClefDifferent=function(){const M=this.getCurrentMeasureClef(),E=this.getPreviousMeasureClef();return!u.default.isSame(E,M)},i.getCurrentMeasureClef=function(){return this.getMeasureClef(this.opts.measureIdx)},i.getPreviousMeasureClef=function(){const M=this.opts.staffIdx,E=this.getMeasure(this.opts.measureIdx-1);if(h.default.hasMiddleClefs(E,M)){const P=h.default.getMiddleClefs(E,M);return P[P.length-1]}else return h.default.getWrappedClef(E).getEntry(M)},i.getMeasureClef=function(M){const E=this.getMeasure(M);return h.default.getWrappedClef(E).getEntry(this.opts.staffIdx)},i.getMeasure=function(M){return this.getMeasures(M)[M]},i.getMeasures=function(){return this.measures===null&&(this.measures=this.scoreData.getPartMeasures(this.opts.partIdx)),this.measures},i.addOwnClef=function(){let M=this.getCurrentMeasureClef();M=u.default.copy(M);const E={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clef:M};new n(this.scoreData,E,this.cancelStack).perform()},i.removeOwnClef=function(){const M={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new d(this.scoreData,M,this.cancelStack).perform()};const I=c},882078:(S,D,t)=>{t.d(D,{A:()=>v});var h=t(351277),u=t(123491),p=t(316197),x=t(793317),r=t(691309),o=t(476943);const a=function(_,m,d){this.init(_,m,d)};a.NAME="composite.RemoveHeadOrphanGlissandoStarts";const s=a.prototype;s.name=a.NAME,s.initMeasureData=x.default,s.init=function(_,m,d){this.initMeasureData(_,m),this.opts=m,this.cancelStack=d,this.crossMeasure=new r.default(this.measureData,m.voiceIdx,m.noteIdx)},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeOrphanGlissandos()},s.removeOrphanGlissandos=function(){const _=this.getNote();u.default.getGlissandoStarts(_).filter(this.isGlissandoOrphan,this).forEach(e,_)};function e(_){const m=this;u.default.removeGlissando(m,_)}s.getNote=function(){return this.crossMeasure.getLeftChord().find(n,this.opts.pitch)};function n(_){const m=this,d=u.default.getPitch(_);return h.default.isSameLine(d,m)}s.isGlissandoOrphan=function(_){const m=this.measureData.getScoreData();if(this.crossMeasure.hasRightOverflow()&&this.opts.measureIdx+1>=m.getNbMeasures()||!this.crossMeasure.hasRightVoice())return!0;const d=this.crossMeasure.getRightVoice(),c=this.crossMeasure.getRightNoteIdx();if(d.isRest(c))return!0;let i=d.getChord(c);i=o.default.makeArray(i);const I=p.default.getNumber(_);return i.every(l,I)};function l(_){const m=this.valueOf();return u.default.getGlissandoStops(_).every(f,m)}function f(_){const m=this.valueOf();return p.default.getNumber(_)!==m}const v=a},883861:(S,D,t)=>{t.d(D,{A:()=>_});var h=t(123491),u=t(351277),p=t(321097),x=t(645166),r=t(852363),o=t(578918),a=t(793317);const s=function(m,d,c){this.init(m,d,c)};s.NAME="primitive.SetAlter";const e=s.prototype;e.initMeasureData=a.default,e.name=s.NAME,e.init=function(m,d,c){this.initMeasureData(m,d),this.cancelStack=c,this.opts=d},e.perform=function(){const m=this.getNoteAtPitch(),d=h.default.getAlter(m),c=u.default.getAlter(this.opts.pitch);h.default.setAlter(m,c),this.updateStack(d)},e.getNoteAtPitch=function(){const m=this.measureData.getVoice(this.opts.voiceIdx);return(0,o.default)(m,this.opts.noteIdx,this.opts.pitch)},e.updateStack=function(m){const d={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:u.default.copy(this.opts.pitch),previousAlter:m}};this.cancelStack.push(d),(0,r.default)(this.cancelStack,this.measureData,this.opts)};const n=s;var l=t(519405);const f=function(m,d,c){this.init(m,d,c)};f.NAME="composite.SetAccidental";const v=f.prototype;v.initMeasureData=a.default,v.name=f.NAME,v.init=function(m,d,c){this.initMeasureData(m,d),this.cancelStack=c,this.opts=d},v.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.untieNoteHead(),this.setAlter(),this.updateAccidental()},v.untieNoteHead=function(){const m=this.getNoteAtPitch();if(!h.default.hasTie(m))return;const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,step:u.default.getStep(this.opts.pitch),octave:u.default.getOctave(this.opts.pitch)},c=new p.default(this.measureData,d,this.cancelStack);(0,l.default)(c)},v.setAlter=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:u.default.copy(this.opts.pitch)};new n(this.measureData,m,this.cancelStack).perform()},v.updateAccidental=function(){const m=this.getNoteAtPitch(),d=h.default.getStaffIdx(m),c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:d,noteIdx:this.opts.noteIdx,pitch:u.default.copy(this.opts.pitch)};new x.A(this.measureData,c,this.cancelStack).perform()},v.getNoteAtPitch=function(){const m=this.measureData.getVoice(this.opts.voiceIdx);return(0,o.default)(m,this.opts.noteIdx,this.opts.pitch)};const _=f},887076:(S,D,t)=>{t.d(D,{A:()=>d});var h=t(868743),u=t(446921),p=t(363297),x=t(364842),r=t(584416),o=t(701387),a=t(852363);const s=function(c,i,I){this.init(c,i,I)};s.NAME="primitive.RemovePedal";const e=s.prototype;e.name=s.NAME,e.init=function(c,i,I){this.scoreData=c,this.cancelStack=I,this.opts=i,this.removedPedal=null,this.pedals=null,this.pedalIdx=null},e.perform=function(){this.removePedal(),this.updateStack()},e.removePedal=function(){const c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),i=o.default.getPedals(c,this.opts.staffIdx),I=this.getPedalIdx(),M=i.splice(I,1);if(this.removedPedal=M[0],r.A.isStart(this.removedPedal)){const E=r.A.getPedalUuid(this.removedPedal),P=this.scoreData.getPartContent(this.opts.partIdx);u.A.removePedal(P,E)}o.default.setPedals(c,this.opts.staffIdx,i)},e.updateStack=function(){const c=this.getMeasure(),i=o.default.getDivisions(c),I=this.removedPedal,M=r.A.getStaffIdx(I),E=r.A.getPlacement(I),P=r.A.getType(I),O={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:i,staffIdx:M,placement:E,type:P}};this.cancelStack.push(O),(0,a.default)(this.cancelStack,this.scoreData,this.opts)},e.getPedalIdx=function(){return this.pedalIdx===null&&this.fetchPedalIdx(),this.pedalIdx},e.fetchPedalIdx=function(){if(this.pedalIdx=null,this.getPedals().some(this.checkPedal,this),this.pedalIdx===null)throw new x.default("No pedal to remove")},e.checkPedal=function(c,i){const I=r.A.getTimePos(c),M=r.A.getType(c);return I<this.opts.timePos?!1:I===this.opts.timePos?M===this.opts.type?(this.pedalIdx=i,!0):!1:!0},e.getPedals=function(){if(this.pedals===null){const c=this.getMeasure();this.pedals=o.default.getPedals(c,this.opts.staffIdx)}return this.pedals},e.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const n=s,l=function(c,i,I){this.init(c,i,I)};l.NAME="primitive.RemovePedalContinue";const f=l.prototype;f.name=l.NAME,f.init=function(c,i,I){this.scoreData=c,this.cancelStack=I,this.opts=i,this.removedPedalDirection=null},f.perform=function(){this.removeLeftPedal(),this.removeRightPedal(),this.updateStack()},f.removeLeftPedal=function(){const c=this.getLeftMeasure();if(!o.default.hasRightPedal(c,this.opts.staffIdx)){const i="There is no right pedal to remove on the left measure.";throw new x.default("MissingRightContinuePedal",i)}this.removedPedalDirection=o.default.getRightPedal(c,this.opts.staffIdx),o.default.removeRightPedal(c,this.opts.staffIdx)},f.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},f.removeRightPedal=function(){const c=this.getRightMeasure();if(!o.default.hasLeftPedal(c,this.opts.staffIdx)){const i="There is no left pedal to remove on the left measure.";throw new x.default("MissingLeftContinuePedal",i)}o.default.removeLeftPedal(c,this.opts.staffIdx)},f.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},f.updateStack=function(){const c=this.removedPedalDirection,i=r.A.getStaffIdx(c),I=r.A.getPlacement(c),M={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:i,placement:I}};this.cancelStack.push(M),(0,a.default)(this.cancelStack,this.scoreData,this.opts)};const v=l,_=function(c,i,I){this.init(c,i,I)};_.NAME="composite.RemovePedal";const m=_.prototype;m.name=_.NAME,m.init=function(c,i,I){this.scoreData=c,this.cancelStack=I,this.opts=i,this.startMeasureIdx=null,this.startTimePos=null,this.stopMeasureIdx=null,this.stopTimePos=null},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.searchSides(),this.removeStart(),this.removeStop(),this.removeContinues()},m.searchSides=function(){const c=this.getMeasures(),i=(0,p.A)(c,this.opts.measureIdx,this.opts.staffIdx,this.opts.timePos);this.startMeasureIdx=i.startMeasureIdx,this.startTimePos=i.startTimePos,this.stopMeasureIdx=i.stopMeasureIdx,this.stopTimePos=i.stopTimePos},m.getMeasures=function(){const c=this.scoreData.getPartContent(this.opts.partIdx);return u.A.getMeasures(c)},m.removeStart=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.startMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.startTimePos,type:h.A.START};new n(this.scoreData,c,this.cancelStack).perform()},m.removeStop=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.stopMeasureIdx,staffIdx:this.opts.staffIdx,timePos:this.stopTimePos,type:h.A.STOP};new n(this.scoreData,c,this.cancelStack).perform()},m.removeContinues=function(){for(let c=this.startMeasureIdx;c<this.stopMeasureIdx;c++)this.removeContinue(c)},m.removeContinue=function(c){const i={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:c};new v(this.scoreData,i,this.cancelStack).perform()};const d=_},895615:(S,D,t)=>{t.d(D,{A:()=>b});var h=t(123491),u=t(292681),p=t(476943),x=t(50060),r=t(748049),o=t(760367),a=t(474976),s=t(737296),e=t(901095),n=t(560015);const l=n.A;var f=t(765350),v=t(272980),_=t(334772),m=t(159238),d=t(99241),c=t(793317);const i=function(N,B,H){this.init(N,B,H)};i.NAME="composite.DeleteGracesAtNotePercu";const I=i.prototype;I.name=i.NAME,I.initMeasureData=c.default,I.init=function(N,B,H){this.initMeasureData(N,B),this.cancelStack=H,this.opts=B},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const N=this.measureData.getVoice(this.opts.voiceIdx),B=N.getNbGraces(this.opts.noteIdx);for(let H=0;H<B;H++){let $=N.getGraceChord(this.opts.noteIdx,0);$=p.default.makeArray($),$=$.slice(),$.forEach(this.removeGraceHead,this)}},I.removeGraceHead=function(N,B,H){const $=H.length;if(B===$-1)this.deleteGrace();else{let q=h.default.getUnpitched(N);q=u.default.copy(q),this.removeGraceFromChord(q)}},I.deleteGrace=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0},B=new m.default(this.measureData,N,this.cancelStack);B.checkPreconditions(),B.perform()},I.removeGraceFromChord=function(N){const B={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:0,unpitched:N},H=new d.default(this.measureData,B,this.cancelStack);H.checkPreconditions(),H.perform()};const M=i;var E=t(846541),P=t(682756),O=t(547336),K=t(278572),w=t(883740),k=t(742253),R=t(473990),L=t(379097),j=t(115866),V=t(516e3),J=t(519405),G=t(257818);const z=function(N,B,H){this.init(N,B,H)};z.NAME="composite.RemoveSingleNotePercu";const F=z.prototype;F.name=z.NAME,F.initMeasureData=c.default,F.init=function(N,B,H){this.initMeasureData(N,B),this.cancelStack=H,this.opts=B},F.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===s.default.INSERT&&this.removeLastNoteTie(),this.adaptDpqToTimeSignature(),this.adaptDpqToTuplet();const N=this.getFormerContent(),B=this.getNote();this.untieNote(),this.removeColor(B),this.removeTieDirection(B),this.removeBeamStatus(B),this.removeOrnaments(B),this.removeArticulations(B),this.removeGraces(),this.removeGhost(),this.shiftSlurIfPossible(),this.removeLyrics(),this.removeNote(),this.insertRests(B);const H=this.measureData.getVoice(this.opts.voiceIdx);(0,G.A)(H,this.opts.noteIdx),this.opts.keepFormer&&this.restoreFormerContent(N)},F.removeLastNoteTie=function(){const N=this.measureData.getVoice(this.opts.voiceIdx),B=N.getStopNoteIdx();let H=N.getChord(B);if(H=p.default.makeArray(H),!H.some(h.default.hasTieStart))return;const $={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:B},q=new E.default(this.measureData,$,this.cancelStack);(0,J.default)(q)},F.adaptDpqToTimeSignature=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new f.A(this.measureData,N,this.cancelStack).perform()},F.adaptDpqToTuplet=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new v.A(this.measureData,N,this.cancelStack).perform()},F.getFormerContent=function(){const N={};return N.lyrics=this.getLyrics(),N},F.getLyrics=function(){const B=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);return h.default.getLyrics(B).map(tt)};const tt=function(N){const B=x.default.getLevel(N);if(x.default.hasLeftMelisma(N))return{level:B,isMelisma:!0};const H=x.default.getText(N),$=x.default.hasRightConnection(N);return{lyric:H,hasRightConnection:$,level:B}};F.untieNote=function(){const N=this.getNote();if(!h.default.hasTie(N))return;const B={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},H=new P.default(this.measureData,B,this.cancelStack);(0,J.default)(H)},F.removeGhost=function(){const N=this.getNote();if(!h.default.hasHeadParentheses(N))return;let B=h.default.getUnpitched(N);B=u.default.copy(B);const H={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:B},$=new O.default(this.measureData,H,this.cancelStack);(0,J.default)($)},F.removeColor=function(N){if(!h.default.hasColor(N))return;const B=h.default.getUnpitched(N),H={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:u.default.copy(B)},$=new K.default(this.measureData,H,this.cancelStack);(0,J.default)($)},F.removeTieDirection=function(N){if(h.default.getTieDirection(N)===o.A.AUTO)return;const H=h.default.getUnpitched(N),$={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:u.default.copy(H),tieDirection:o.A.AUTO},q=new w.default(this.measureData,$,this.cancelStack);(0,J.default)(q)},F.removeBeamStatus=function(N){if(h.default.getBeamStatus(N)!==r.A.DEFAULT){const H={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,beamStatus:r.A.DEFAULT},$=new k.default(this.measureData,H,this.cancelStack);(0,J.default)($)}},F.removeOrnaments=function(N){h.default.getOrnamentsList(N).forEach(function(B){const H={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:B};new R.default(this.measureData,H,this.cancelStack).perform()},this)},F.removeArticulations=function(N){let B=h.default.getArticulationsList(N);B=B.filter(a.default.isValid),B.forEach(function(H){const $={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,articulationType:H};new L.default(this.measureData,$,this.cancelStack).perform()},this)},F.removeGraces=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new M(this.measureData,N,this.cancelStack).perform()},F.getNote=function(){return this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx)},F.extractNoteDuration=function(){const B=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);return h.default.getDuration(B)},F.shiftSlurIfPossible=function(){const B=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(h.default.hasSlur(B)){const H={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new _.A(this.measureData,H,this.cancelStack).perform()}},F.removeLyrics=function(){const N=this.getNote();if(h.default.getLyrics(N).length===0)return;const B={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},H=new j.default(this.measureData,B,this.cancelStack);(0,J.default)(H)},F.removeNote=function(){new l(this.measureData,this.opts,this.cancelStack).perform()},F.insertRests=function(N){const B=h.default.getDuration(N),H=h.default.getStaffIdx(N),$={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:H,noteIdx:this.opts.noteIdx,duration:B,insertMode:this.opts.insertMode};new e.A(this.measureData,$,this.cancelStack).perform()},F.restoreFormerContent=function(N){this.restoreLyrics(N.lyrics)},F.restoreLyrics=function(N){N.forEach(this.restoreLyric,this)},F.restoreLyric=function(N){const B={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,lyric:N.lyric,hasRightConnection:N.hasRightConnection,level:N.level,isMelisma:N.isMelisma},H=new V.default(this.measureData,B,this.cancelStack);(0,J.default)(H)};const b=z},896275:(S,D,t)=>{t.d(D,{A:()=>x});var h=t(123491),u=t(698716);const x=function(r,o,a){let s=null,e=null;const n=r.getNbMeasures();for(let l=o.measureIdx;l<n;l++){const f=r.getMeasureData(l);if(!f.hasVoice(o.voiceIdx))continue;const v=f.getVoice(o.voiceIdx),_=v.size();for(e===null?e=o.noteIdx:e=0;e<_;e++){const m=u.A.create(l,e);if(u.A.isEqual(m,o))continue;const d=v.getNote(e);if(h.default.hasSlur(d)||(h.default.isRest(d)||(s=m),a!==null&&u.A.isEqual(m,a)))return s}}return s}},908576:(S,D,t)=>{t.d(D,{A:()=>s});var h=t(364842),u=t(726042),p=t(701387),x=t(852363);const r=function(e,n,l){this.init(e,n,l)};r.NAME="primitive.RemoveMute";const o=r.prototype;o.name=r.NAME,o.init=function(e,n,l){this.scoreData=e,this.cancelStack=l,this.opts=n},o.perform=function(){this.removeMute(),this.updateStack()},o.removeMute=function(){const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),n=p.default.getMutes(e,this.opts.staffIdx),l=n.length;a(this.opts.muteIdx,l),n.splice(this.opts.muteIdx,1),p.default.setMutes(e,this.opts.staffIdx,n)};const a=function(e,n){if(!u.default.isInteger(e)||e<0||e>=n){const l=`Invalid muteIdx: [${e}].`;throw new h.default("BadMuteIdx",l)}};o.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,x.default)(this.cancelStack,this.scoreData,this.opts)};const s=r},920091:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(607682);class u extends h.default{constructor(){super("Cannot move the slur bound to this location."),this.name="BadSlurLocationError"}}},922679:(S,D,t)=>{t.d(D,{A:()=>u});const u=function(){return this.measureData.getVoice(this.opts.voiceIdx)}},928025:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(701387),u=t(447819),p=t(656529),x=t(316610);const r=function(s,e,n){this.init(s,e,n)};r.NAME="composite.RemoveMutesFrom";const o=r.prototype;o.name=r.NAME,o.init=function(s,e,n){this.scoreData=s,this.cancelStack=n,this.opts=e,this.measure=null,this.limitTimePos=null},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMutesFrom()},o.removeMutesFrom=function(){const s=this.getMeasure();let e=h.default.getMutes(s,this.opts.staffIdx);e=e.filter(this.isBeyoudLimit,this),e.forEach(this.removeMute,this)},o.isBeyoudLimit=function(s){const e=this.getLimitTimePos();return u.A.getTimePos(s)>=e},o.getLimitTimePos=function(){if(this.limitTimePos===null){const s=this.getMeasure();this.limitTimePos=(0,x.A)(this.opts,s)}return this.limitTimePos},o.removeMute=function(s){const e=u.A.getTimePos(s),n=this.getMeasure(),l=h.default.getDpq(n),f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e,dpq:l};new p.default(this.scoreData,f,this.cancelStack).perform()},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const a=r},930109:(S,D,t)=>{t.d(D,{A:()=>u});var h=t(956722);const u=h.A},934664:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(607682);const u=function(){return"There is no tuplet at this location."};class p extends h.default{constructor(){const r=u();super(r),this.name="NotTupletError"}}},956750:(S,D,t)=>{t.d(D,{A:()=>p});var h=t(123491);const p=function(x,r){const o={},a=x.getMeasureData(r.startMeasureIdx);o.startDpq=a.getDpqValue();const s=a.getVoice(r.startVoiceIdx);o.startTimePos=s.getRangeSpace(0,r.startNoteIdx);const e=x.getMeasureData(r.stopMeasureIdx);o.stopDpq=e.getDpqValue();const n=e.getVoice(r.stopVoiceIdx),l=n.getNote(r.stopNoteIdx),f=h.default.getDuration(l);return o.stopTimePos=n.getRangeSpace(0,r.stopNoteIdx)+f,o}},971280:(S,D,t)=>{t.d(D,{A:()=>r});var h=t(701387),u=t(852363);const p=function(o,a,s){this.init(o,a,s)};p.NAME="primitive.RemoveSlurContinue";const x=p.prototype;x.name=p.NAME,x.init=function(o,a,s){this.scoreData=o,this.cancelStack=s,this.opts=a},x.perform=function(){const o=this.getStaffIdx();this.removeLeftSlur(),this.removeRightSlur(),this.updateStack(o)},x.getStaffIdx=function(){const o=this.getLeftMeasure();return h.default.getRightSlur(o,this.opts.voiceIdx).staffIdx},x.removeLeftSlur=function(){const o=this.getLeftMeasure();h.default.removeRightSlur(o,this.opts.voiceIdx)},x.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},x.removeRightSlur=function(){const o=this.getRightMeasure();h.default.removeLeftSlur(o,this.opts.voiceIdx)},x.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},x.updateStack=function(o){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:o}};this.cancelStack.push(a),(0,u.default)(this.cancelStack,this.scoreData,this.opts)};const r=p},980845:(S,D,t)=>{t.d(D,{A:()=>o});var h=t(701387),u=t(364596),p=t(873010);const x=function(a,s,e){this.init(a,s,e)};x.NAME="composite.TransposeKeysRange";const r=x.prototype;r.name=x.NAME,r.init=function(a,s,e){this.scoreData=a,this.cancelStack=e,this.opts=s,this.key=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const a=this.opts.startMeasureIdx,s=this.opts.stopMeasureIdx;for(let e=a;e<=s;e++){const n=this.getKey(e);this.addKey(n,e)}this.finishSegment()},r.getKey=function(a){const s=this.scoreData.getMeasure(this.opts.partIdx,a);return h.default.getWrappedKey(s).getEntry(this.opts.staffIdx)},r.addKey=function(a,s){this.hasOngoing()?this.isSameKey(a)?this.continueSegment(s):(this.finishSegment(),this.startSegment(a,s)):this.startSegment(a,s)},r.hasOngoing=function(){return this.key!==null},r.startSegment=function(a,s){this.key=u.default.copy(a),this.startMeasureIdx=s,this.stopMeasureIdx=s},r.isSameKey=function(a){return u.default.isSame(a,this.key)},r.continueSegment=function(a){this.stopMeasureIdx=a},r.finishSegment=function(){this.transposeKeySegment(this.startMeasureIdx,this.stopMeasureIdx),this.key=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},r.transposeKeySegment=function(a,s){const e=this.key,n=u.default.transpose(e,this.opts.transpose);if(!u.default.isSame(e,n)){const l={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:a,stopMeasureIdx:s,key:n},f=new p.default(this.scoreData,l,this.cancelStack);f.checkPreconditions(),f.perform()}};const o=x},987237:(S,D,t)=>{t.d(D,{A:()=>a});var h=t(123491),u=t(50060),p=t(793317),x=t(852363);const r=function(s,e,n){this.init(s,e,n)};r.NAME="primitive.AddLyric";const o=r.prototype;o.name=r.NAME,o.initMeasureData=p.default,o.init=function(s,e,n){this.initMeasureData(s,e),this.cancelStack=n,this.opts=e},o.perform=function(){const e=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),n=this.createLyric();h.default.addLyric(e,n),this.updateStack()},o.createLyric=function(){const s=u.default.create(this.opts.lyric,this.opts.syllabicType);return u.default.setLevel(s,this.opts.level),s},o.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(s),(0,x.default)(this.cancelStack,this.measureData,this.opts)};const a=r}}]);})();


//# debugId=a91d0f53-606a-5b77-a94b-9e31eecda9f8
