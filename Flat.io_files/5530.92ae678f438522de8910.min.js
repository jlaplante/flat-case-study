
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f36c5ad7-22ff-5b54-bc16-59c10694df3b")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[5530],{775:(T,O,e)=>{"use strict";e.d(O,{$9:()=>a,Ay:()=>x,M:()=>C,OE:()=>X,OZ:()=>K,T9:()=>it,Ze:()=>z,dS:()=>k,kr:()=>w,pB:()=>rt,rn:()=>et,rp:()=>R});var t=e(324074),f=e.n(t),c=e(645369),A=e.n(c),E=e(130179),d=e(550594),B=(l,g,L)=>new Promise((V,S)=>{var i=b=>{try{P(L.next(b))}catch(j){S(j)}},u=b=>{try{P(L.throw(b))}catch(j){S(j)}},P=b=>b.done?V(b.value):Promise.resolve(b.value).then(i,u);P((L=L.apply(l,g)).next())});const W=A()("flat:api");function H(l="Data"){const g=new t.AxiosError(`${l} is not available offline`);return g.response={status:0,statusText:"Network not available",data:null,headers:{},config:{}},g}function lt(l,g){return d.A.post(`${d.A.apiv2baseurl}/scores`,l,g)}function it(l,g){return d.A.put(`${d.A.apiv2baseurl}/scores/${l}`,g)}function rt(l,g){return B(this,null,function*(){var L,V;try{return yield d.A.get(`${d.A.apiv2baseurl}/scores/${l}`,{params:g})}catch(S){if(f().isAxiosError(S)&&((L=S.response)!=null&&L.status))throw S;try{const i=(V=(0,E.I1)())==null?void 0:V.getScoreById(l);if(i)return i}catch(i){throw W("ERR offline/getScore: %o",i),H("Score")}throw H("Score")}})}function dt(l){return B(this,arguments,function*({scoreId:g,params:L}){return d.A.get(`${d.A.apiv2baseurl}/scores/${g}/revisions`,{params:L})})}function tt(l,g,L){return B(this,null,function*(){return d.A.get(`${d.A.apiv2baseurl}/scores/${l}/revisions/${g}/history`,{params:L})})}function v(l){return B(this,arguments,function*({score:g,revision:L,format:V="json",params:S}){var i,u;const P=()=>d.A.getResponse(`${d.A.apiv2baseurl}/scores/${g}/revisions/${L}/${V}`,{params:S}),b=(0,E.I1)();if(V!=="json"||!b)return W("getRevisionData: network only"),P();if(L==="last"){W("getRevisionData: network first");try{return yield P()}catch(j){if(f().isAxiosError(j)&&((i=j.response)!=null&&i.status))throw j;try{const pt=(u=(0,E.I1)())==null?void 0:u.getScoreRevisionData(g,L);if(pt)return pt}catch(pt){throw W("ERR offline/getScore: %o",pt),H("Score")}throw H("Score")}}W("getRevisionData: cache first");try{return yield b.getScoreRevisionData(g,L)}catch(j){return P()}})}function D({score:l,body:g}){return d.A.post(`${d.A.apiv2baseurl}/scores/${l}/revisions`,g)}function w(l,g){return B(this,null,function*(){var L;yield d.A.delete(`${d.A.apiv2baseurl}/scores/${l}`,{params:g});try{yield(L=(0,E.I1)())==null?void 0:L.deleteScoreById(l)}catch(V){W("ERR(deleteScore) %s: %o",l,V)}})}function C(l){return B(this,null,function*(){yield d.A.post(`${d.A.apiv2baseurl}/scores/${l}/untrash`)})}function R(l,g){return B(this,null,function*(){return d.A.post(`${d.A.apiv2baseurl}/scores/${l}/fork`,g)})}function X(l,g){return B(this,null,function*(){return d.A.post(`${d.A.apiv2baseurl}/scores/${l}/likes`,{},{params:g})})}function k(l,g){return B(this,null,function*(){return d.A.delete(`${d.A.apiv2baseurl}/scores/${l}/likes`,{params:g})})}function z(l,g){return B(this,null,function*(){return d.A.post(`${d.A.apiv2baseurl}/scores/${l}/played`,{},{params:g})})}function K(l,g){return B(this,null,function*(){return d.A.post(`${d.A.apiv2baseurl}/scores/${l}/collaborators`,g)})}function et(l,g){return B(this,null,function*(){return d.A.delete(`${d.A.apiv2baseurl}/scores/${l}/collaborators/${g}`)})}function ft(l){return B(this,null,function*(){return d.A.post(`${d.A.apiv2baseurl}/scores/${l}/_queueSave`,{})})}function gt(l){return d.A.get(`${d.A.apiv2baseurl}/scores/${l}/submissions`)}function ut(l){const g={collection:l.collection,sort:"modificationDate",direction:"desc",limit:l.limit||25,next:l.next};try{return d.A.getWithPagination(`${d.A.apiv2baseurl}/collections/${g.collection}/scores`,{params:g})}catch(L){throw W("Error in list collection scores: %o",L),L}}function a(){const l="0123456789abcdef";let g="";for(let L=0;L<128;L++)g+=l.charAt(Math.floor(Math.random()*l.length));return g}function _(l){try{return api.getWithPagination(`${api.apiv2baseurl}/scores`,{params:l})}catch(g){throw W("Error in fetch listing scores: %o",g),g}}function m(l){try{return api.get(`${api.apiv2baseurl}/search/scores`,{params:l})}catch(g){throw W("Error in searchScores: %o",g),g}}const x={get:rt,listRevisions:dt,getRevisionHistory:tt,getRevisionData:v,createRevision:D,delete:w,untrash:C,fork:R,like:X,unlike:k,played:z,create:lt,update:it,addCollaborator:K,deleteCollaborator:et,queueSave:ft,listScoreSubmissions:gt,listCollectionScores:ut,generateSharingKey:a}},1072:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>d});var t=e(814779),f=e.n(t),c=e(927860),A=e.n(c),E=A()(f());E.push([T.id,`.dialog-content[data-v-0f2a4940]{display:flex;width:60vw;height:70vh}.dialog-content[data-v-0f2a4940]:not(.is-small-screen){border-radius:8px}.dialog-content[data-v-0f2a4940]:not(.is-small-screen)>:first-child{border-top-left-radius:8px;border-bottom-left-radius:8px}.dialog-content[data-v-0f2a4940]:not(.is-small-screen)>:last-child{border-top-right-radius:8px;border-bottom-right-radius:8px}.score-preview[data-v-0f2a4940]{padding:8px;background-color:var(--f-subdue-10);height:100%;flex:1 0}.side-panel[data-v-0f2a4940]{display:flex;flex-direction:column;height:100%;background-color:var(--f-white);flex:0 0 238px}.header[data-v-0f2a4940]{display:flex;align-items:center;padding:16px;border-bottom:solid 1px var(--f-subdue-10)}.header h3[data-v-0f2a4940]{flex:1 0 auto}h3[data-v-0f2a4940]{size:14px;color:var(--f-ink);font-family:var(--f-font-common);font-weight:600}.format[data-v-0f2a4940]{size:12px;color:var(--f-subdue);font-family:var(--f-font-common);font-weight:400}.export-options[data-v-0f2a4940]{flex:1 1 auto;overflow-y:auto;padding:12px 16px 16px;display:flex;flex-direction:column}.export-options[data-v-0f2a4940]>:not(:first-child){margin-top:20px}.export-options .parts-input[data-v-0f2a4940]{margin-top:26px}.export-options .more-options[data-v-0f2a4940]{align-self:end;margin-top:26px;border:0;background:#0000;padding:0;color:var(--f-subdue);font-family:var(--f-font-common);font-size:12px;font-weight:600;font-style:italic}.export-options .export-options-picker[data-v-0f2a4940]{margin-top:16px}.btn-group[data-v-0f2a4940]{padding:16px;border-top:solid 1px var(--f-subdue-10)}.btn-group button[data-v-0f2a4940]{flex-grow:1}.ready-to-export[data-v-0f2a4940] span{margin-left:10px;margin-right:10px}.dialog-content.is-small-screen[data-v-0f2a4940]{flex-direction:column-reverse;width:100%;height:initial}.dialog-content.is-small-screen .score-preview[data-v-0f2a4940]{width:100%;height:280px}.dialog-content.is-small-screen .side-panel[data-v-0f2a4940]{width:100%;height:fit-content}.powerBadge[data-v-0f2a4940]{margin-left:8px;width:16px;height:16px}.labelWithIcon[data-v-0f2a4940]{display:flex;align-items:center}@media (max-width: 1024px){.dialog-content[data-v-0f2a4940]:not(.is-small-screen){width:90vw}}
`,""]);const d=E},29220:(T,O,e)=>{"use strict";e.d(O,{e:()=>c});var t=e(6645),f=e(744056);const c=(0,t.nY)("onboardingTooltip",()=>{const A=(0,f.KR)(!1);function E(d){A.value=d}return{forcedTooltips:A,toggleForcedTooltips:E}})},110853:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>gt,getBrandingText:()=>ft,getLogoFontJson:()=>et});var t=e(269352),f=e(429145),c=e(669834),A=e(210888),E=e(475672),d=e(864409),B=e(16602),W=e(175156),H=e.n(W),lt=e(324074),it=e.n(lt),rt=e(506988),dt=e.n(rt),tt=e(645369),v=e.n(tt),D=e(281925);const w=JSON.parse(`{"en":"Score created with the free version of Flat","en-GB":"Score created with the free version of Flat","de":"Mit der kostenlosen Version von Flat erstellte Partitur","es":"Partitura creada con la versi\xF3n gratuita de Flat","fr":"Partition cr\xE9\xE9e avec la version gratuite de Flat","ja":"\u3053\u306E\u697D\u8B5C\u306FFlat\u306E\u7121\u6599\u30A2\u30AB\u30A6\u30F3\u30C8\u3067\u4F5C\u6210\u3055\u308C\u307E\u3057\u305F","ja-HIRA":"\u3053\u306E\u697D\u8B5C\u306FFlat\u306E\u7121\u6599\u30A2\u30AB\u30A6\u30F3\u30C8\u3067\u4F5C\u6210\u3055\u308C\u307E\u3057\u305F","ko":"Flat \uBB34\uB8CC \uBC84\uC804\uC73C\uB85C \uC0DD\uC131\uD55C \uC545\uBCF4","pl":"Partytura stworzona w darmowej wersji Flat","ro":"Partitur\u0103 creat\u0103 cu versiunea gratuit\u0103 a Flat","ru":"\u041F\u0430\u0440\u0442\u0438\u0442\u0443\u0440\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0430 \u0432 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 Flat","tr":"Flat'in \xFCcretsiz s\xFCr\xFCm\xFC ile olu\u015Fturulan partisyon"}`);var C=e(175145),R=(ut,a,_)=>new Promise((m,M)=>{var x=L=>{try{g(_.next(L))}catch(V){M(V)}},l=L=>{try{g(_.throw(L))}catch(V){M(V)}},g=L=>L.done?m(L.value):Promise.resolve(L.value).then(x,l);g((_=_.apply(ut,a)).next())});const X={},k="application/pdf",z=72,K=v()("flat:pdf");function et(){return{glyphs:{"small-flat-logo":{bBoxNE:[4,4],bBoxSW:[0,0],description:"small-flat-logo",path:C.O7}},fontName:"FlatLogo",fontVersion:1,meta:{"units-per-em":"1024"}}}function ft(ut="en"){let a="https://flat.io";return["fr","ja","es"].includes(ut)&&(a+=`/${ut}`),`${w[ut]||w.en} - ${a}`}class gt{constructor(a){this.$t=a,d.default.setDocument(window.document),this.methodsByNodeName={g:this.stackTransformation.bind(this),path:C.fM,text:C.j,line:C.cG,rect:C.cU,polygon:C.Or,circle:C.YH},this.fonts=new D.A}generate(a,_){return R(this,null,function*(){try{this.doc=new(H())({info:this.getScoreInformation(a),autoFirstPage:!1}),this.stream=this.doc.pipe(dt()()),this.fontsNames=[C.OH];for(let m=0;m<a.length;m++)yield this.prepareJob(a[m]);yield this.loadFonts(),this.createContainer();for(let m=0;m<a.length;m++){const M=({percentage:x,text:l})=>{_&&(x/=100,x/=a.length,x+=m/a.length,x*=100,_({percentage:x,text:l}))};yield this.exportScore(a[m],M)}return this.cleanup(),this.completePdf()}catch(m){throw this.cleanup(),m}})}getScoreInformation(a){var _;const m={Producer:"Flat",Creator:"Tutteo (https://www.tutteo.com)"};if(a.length>0){const M=a[0].scoreData;try{const x=M.adagioData;typeof M.scoreId=="string"&&(m.Subject=`https://flat.io/score/${M.scoreId}`,typeof M.revisionId=="string"&&(m.Subject+=` - Rev: ${M.revisionId}`)),typeof((_=M.account)==null?void 0:_.id)=="string"&&(m.Producer+=` (uid: ${M.account.id})`),x!=null&&x.hasTitle()&&(m.Title=x.getTitle()),x!=null&&x.hasComposer()&&(m.Author=x.getComposerStr(),x.hasArranger()&&(m.Author+=` / ${x.getArrangerStr()}`))}catch(x){M.logError(x)}}return K("metadata: %o",m),m}completePdf(){return new Promise(a=>{this.doc.end(),this.stream.on("finish",function(){a(this.toBlob(k))})})}loadFonts(){const a=this.fonts.getTtfList();return this.fontsNames=Object.keys(a),Promise.all(this.fontsNames.map(_=>this.loadFontFile(a[_],_)))}loadFontFile(a,_){return X[_]?this.doc.font(X[_],_):(K("loading fonts %s @ %",_,a),new Promise((m,M)=>{const x=[(l,g)=>(delete g.common["x-flat-request-as"],delete g.common["x-csrf-token"],l)];it().get(a,{responseType:"arraybuffer",transformRequest:x}).then(l=>{this.doc.font(l.data,_),X[_]=l.data,m()}).catch(l=>{if(a.startsWith("./")&&l.request&&l.request.readyState===4&&l.response&&l.response.data){const g=l.response.data;this.doc.font(g,_),X[_]=g,m()}if(_===C.OH)M(l);else{K("err while loading font: %o",l);const g=this.fontsNames.indexOf(_);g>=0&&this.fontsNames.splice(g,1),m()}})}))}loadMusicFont(a){return R(this,null,function*(){let _;return a.getMusicFont()===E.A.PETALUMA?_=(yield e.e(60455).then(e.bind(e,7893))).default:a.getMusicFont()===E.A.LEIPZIG?_=(yield e.e(1336).then(e.bind(e,147738))).default:a.getMusicFont()===E.A.SEBASTIAN?_=(yield e.e(25966).then(e.bind(e,599244))).default:a.getMusicFont()===E.A.LELAND?_=(yield e.e(13406).then(e.bind(e,719988))).default:a.getMusicFont()===E.A.GOOTVILLE?_=(yield e.e(29193).then(e.bind(e,368131))).default:a.getMusicFont()===E.A.FINALE_MAESTRO?_=(yield e.e(4860).then(e.bind(e,996470))).default:a.getMusicFont()===E.A.FINALE_BROADWAY?_=(yield e.e(75720).then(e.bind(e,183618))).default:a.getMusicFont()===E.A.FINALE_ASH?_=(yield e.e(71895).then(e.bind(e,105429))).default:a.getMusicFont()===E.A.FINALE_ENGRAVER?_=(yield e.e(43095).then(e.bind(e,819445))).default:a.getMusicFont()===E.A.FINALE_JAZZ?_=(yield e.e(24942).then(e.bind(e,418252))).default:a.getMusicFont()===E.A.FINALE_LEGACY?_=(yield e.e(97604).then(e.bind(e,86766))).default:_=(yield Promise.resolve().then(e.bind(e,624740))).default,_})}prepareJob(a){return R(this,null,function*(){K("prepare job %o",a),a.printJob={},a.printJob.adagioData=new f.A(a.scoreData.adagioData.exportData()),a.printJob.drawerConfig=this.getDrawerConfig(a,a.printJob.adagioData),a.printJob.musicFont=yield this.loadMusicFont(a.printJob.adagioData),this.fonts.setScoreData(a.printJob.adagioData),this.fonts.updateUsedFonts()})}exportScore(a,_){return R(this,null,function*(){K("exec job %o",a);const m=this.newSvgPage();this.domContainer.appendChild(m.node());const M=new c.A(m.node()),{adagioData:x,musicFont:l,drawerConfig:g}=a.printJob;return this.pageLayout=new B.A(x,z,M,l,g),this.gTransformsStack=[],this.drawPages({svg:m},_)})}drawPages({svg:a},_){const m=this.pageLayout.getNbMeasures();if(_){let x=`0/${m} measures drawn`;this.$t&&(x=this.$t("editor:export.progress.pdf.measure",{currentNbMeasures:0,totalNbMeasures:m})),_({percentage:0,text:x})}const M=a;return new Promise((x,l)=>{let g=0;const L=()=>R(this,null,function*(){try{if(K("render page %d",g),this.pageLayout.hasRemaining()){if((g>0||!a)&&(a=this.newSvgPage(),this.domContainer.appendChild(a.node())),yield this.pageLayout.fillNextPage(a),_){const V=this.pageLayout.measuresContainer.getNbMeasures();let S=`${V}/${m} measures drawn`;this.$t&&(S=this.$t("editor:export.progress.pdf.measure",{currentNbMeasures:V,totalNbMeasures:m})),_({percentage:V/m*100,text:S})}yield this.addPageToPdf(a.node()),a!==M&&(K("clean page"),this.domContainer.removeChild(a.node())),g++,this.pageLayout.hasRemaining()?requestAnimationFrame(()=>L()):(K("last page done"),x())}else x()}catch(V){l(V)}});requestAnimationFrame(()=>L())})}newSvgPage(){const a=new t.A("svg","page");return a.attr("id",`export-page-${A.default.generate()}`),a}getDrawerConfig(a,_){const m=a.scoreData.config.getCopy();m.displayEventsRects=!1,m.hideTiedFrets=!0,m.styleGroupChildElements=!0;const M=Object.assign({},a.options);if(M){if(m.mergeEmptyMeasures=!!M.multiMeasuresRests,delete M.multiMeasuresRests,M.parts){const x={};M.parts.forEach(l=>{x[_.getPartIdxFromUuid(l)]=!0}),m.displayOtherLinesPartsNames=M.parts.length>1,m.partsDisplayed=x,delete M.parts}Object.keys(M).forEach(x=>{m[x]=M[x]})}return M.exportBranding&&(delete M.exportBranding,m.logoFontJson=et(),m.headerBrandingText=ft(m.locale)),K("drawer %o",m),m}addPageToPdf(a){K("add page to pdf"),(0,C.HY)(this.doc,a),this.parseContent(a)}parseContent(a){const _=this.addElement(a);if(_.length){this.doc.save();const m=this.gTransformsStack;for(let x=0;x<m.length;x++)for(let l=0;l<m[x].length;l++)this.doc=this.doc[m[x][l][0]](...m[x][l][1]);const M=(0,C.lD)(a);for(let x=0;x<M.length;x++)this.doc=this.doc[M[x][0]](...M[x][1]);for(let x=0;x<_.length;x++)this.doc=this.doc[_[x][0]](..._[x][1]);this.doc.restore()}Array.from(a.childNodes).forEach(m=>{this.parseContent(m)}),a.nodeName==="g"&&this.gTransformsStack.pop()}addElement(a){let _;const m=a.nodeName;if(m!=null&&m.length&&!m.includes("#")){const M=this.methodsByNodeName[m];if(M)_=M(a,this.doc,this);else if(m!=="svg")throw new Error(`pdf: handler for "${m}" not found`)}return _||[]}createContainer(){const a=document.createElement("div");a.setAttribute("id",`export-container-${A.default.generate()}`),a.className="score-content svgToPdf",document.body.appendChild(a),this.domContainer=a}cleanup(){this.domContainer&&(document.body.removeChild(this.domContainer),this.domContainer=void 0)}stackTransformation(a){this.gTransformsStack.push((0,C.lD)(a))}}},154863:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>d});var t=e(814779),f=e.n(t),c=e(927860),A=e.n(c),E=A()(f());E.push([T.id,`.radio-wrapper[data-v-3ee12261]:not(:first-child){margin-top:12px}ul[data-v-3ee12261]{padding-left:25px;margin-top:6px}li[data-v-3ee12261]:not(:first-child){margin-top:4px}.radioContent[data-v-3ee12261]{display:flex;align-items:center}.powerBadge[data-v-3ee12261]{margin-left:8px;width:16px;height:16px}
`,""]);const d=E},171220:()=>{},172042:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>d});var t=e(814779),f=e.n(t),c=e(927860),A=e.n(c),E=A()(f());E.push([T.id,`.loader-spinner[data-v-5bcd22e4]{position:absolute}.wrapper[data-v-5bcd22e4]{width:100%;height:100%;overflow:auto;display:flex;align-items:center;justify-content:center}.draft-root[data-v-5bcd22e4]{visibility:hidden;position:absolute;width:10px;height:10px}img[data-v-5bcd22e4]{display:block;max-width:100%;max-height:100%}
`,""]);const d=E},212138:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>V,getScoreLayout:()=>_,getSmuflFont:()=>g,mergeAllPages:()=>L,processPageSvg:()=>l,setLayoutWidth:()=>m});var t=e(269352),f=e(429145),c=e(669834),A=e(726042),E=e(210888),d=e(475672),B=e(624740),W=e(864409),H=e(827494),lt=e(16602),it=e(380981),rt=e(390253),dt=e(937718),tt=e(443669),v=e(404623),D=e(898110),w=e(925230),C=Object.defineProperty,R=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,z=(S,i,u)=>i in S?C(S,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):S[i]=u,K=(S,i)=>{for(var u in i||(i={}))X.call(i,u)&&z(S,u,i[u]);if(R)for(var u of R(i))k.call(i,u)&&z(S,u,i[u]);return S},et=(S,i,u)=>new Promise((P,b)=>{var j=Z=>{try{ht(u.next(Z))}catch(at){b(at)}},pt=Z=>{try{ht(u.throw(Z))}catch(at){b(at)}},ht=Z=>Z.done?P(Z.value):Promise.resolve(Z.value).then(j,pt);ht((u=u.apply(S,i)).next())});const ft="data:image/svg+xml,",gt={trackLeftMargin:.25,trackRightMargin:.25,trackTopMargin:.25,trackBottomMargin:.25,displayEventsRects:!1,hideTiedFrets:!0},ut=new Map([[D.xp,it.A],[D.Kq,dt.A],[D.KL,lt.A]]);function a(S,i){if(i.mergeEmptyMeasures||i.mergeRests||A.default.isInteger(i.firstMeasureIdx)||A.default.isInteger(i.lastMeasureIdx)){const u=S.exportData();S=new f.A(u)}return S}function _(S){return ut.get(S)}function m(S,{dpi:i,widthUnit:u,displayWidth:P}){u===w.Jb&&(P=P*10/rt.A.MM_PER_INCH);const b=P*i;S.setWidth(b)}function M(S){S.svgResult=S.svgResult||v.Ic}function x(S){S.layout=S.layout||D.Kq,S.dpi=S.dpi||150,S.pageIdx=S.pageIdx||0}function l(S,i){const u=S.node();if(i!==null){const P=new t.A("rect");i=typeof i=="string"?i:"#fff",P.attr("fill",i),P.attr("height",u.getAttribute("height")),P.attr("width",u.getAttribute("width")),S.prepend(P)}[...u.querySelectorAll("line:not([stroke])")].forEach(P=>P.setAttribute("stroke","#000")),[...u.querySelectorAll(".step")].forEach(P=>P.setAttribute("stroke-width","1px")),[...u.querySelectorAll(".note")].forEach(P=>P.setAttribute("stroke-width","0px")),[...u.querySelectorAll(".note path, .note line")].forEach(P=>{P.style.opacity="inherit",P.style.fill===""&&(P.style.fill="inherit")})}function g(S){return et(this,null,function*(){const i=S.getMusicFont();let u;return i===d.A.PETALUMA?u=(yield e.e(60455).then(e.bind(e,7893))).default:i===d.A.LEIPZIG?u=(yield e.e(1336).then(e.bind(e,147738))).default:i===d.A.SEBASTIAN?u=(yield e.e(25966).then(e.bind(e,599244))).default:i===d.A.LELAND?u=(yield e.e(13406).then(e.bind(e,719988))).default:i===d.A.GOOTVILLE?u=(yield e.e(29193).then(e.bind(e,368131))).default:i===d.A.FINALE_MAESTRO?u=(yield e.e(4860).then(e.bind(e,996470))).default:i===d.A.FINALE_BROADWAY?u=(yield e.e(75720).then(e.bind(e,183618))).default:i===d.A.FINALE_ASH?u=(yield e.e(71895).then(e.bind(e,105429))).default:i===d.A.FINALE_ENGRAVER?u=(yield e.e(43095).then(e.bind(e,819445))).default:i===d.A.FINALE_JAZZ?u=(yield e.e(24942).then(e.bind(e,418252))).default:i===d.A.FINALE_LEGACY?u=(yield e.e(97604).then(e.bind(e,86766))).default:i===d.A.BRAVURA?u=B.default:d.A.raiseError(i),u})}function L(S){const i=S.getNbPages();if(i===1)return;const u=S.getPage(0),P=u.content,b=new H.A,j=P.getHeight();b.setDrawingContext(P.drawingContext),b.setDisplayOpts({noSystemVerticalSpaceDistribution:!1}),b.setMetrics({}),b.group=P.group;for(let at=0;at<i;at++){const yt=S.getPage(at).content.shard;b.pushShard(yt)}const ht=b.getShardsHeight()-j;b.updateChildrenBindings(),b.updateVerticalDisplay();const Z=S.getPageSize(0);u.getSvgRoot().attr("height",Z.height+ht)}class V{constructor(){W.default.setDocument(window.document)}generate(i){return et(this,arguments,function*(u,P={}){try{M(P);let b=null;P.svgStr?b=P.svgStr:b=yield this.drawScore(u.adagioData,P);const j=this.exportSvg(b,P);return this.cleanup(),j}catch(b){throw this.cleanup(),b}})}drawScore(i,u){return et(this,null,function*(){x(u);let P=this.newExportPage();const b=new c.A(P.node()),j=this.constructor.getLayoutConfig(u.displaySettings);i=a(i,j),j.displayOtherLinesPartsNames=!tt.A.canHidePartNames(i);const pt=_(u.layout),ht=yield g(i),Z=new pt(i,u.dpi,b,ht,j);u.layout===D.xp&&m(Z,u),yield Z.fillNextPage(P),u.layout===D.KL?P=yield this.getPageAtIdx(Z,u.pageIdx):u.layout===D.xp&&(yield this.drawAllContent(Z),L(Z)),l(P,u.backgroundColor);const at=P.node(),_t=at.outerHTML;return at.parentNode.removeChild(at),_t})}getPageAtIdx(i,u=0){return et(this,null,function*(){let P=i.getNbPages();for(;u>=P;){if(!i.hasRemaining())throw new Error(`The page index ${u} is above the current number of pages ${P}`);const j=this.newExportPage();yield i.fillNextPage(j),P=i.getNbPages()}return i.getPageSvg(u)})}drawAllContent(i){return et(this,null,function*(){for(;i.hasRemaining();){const u=this.newExportPage();yield i.fillNextPage(u)}})}newExportPage(){const i=new t.A("svg","page");return i.attr("id","export-svg"),this.createContainerIfNeeded(),this.domContainer.appendChild(i.node()),i}createContainerIfNeeded(){this.domContainer||this.createContainer()}createContainer(){const i=document.createElement("div");i.setAttribute("id",`export-container-${E.default.generate()}`),i.className="score-content canvasSvgExport",document.body.appendChild(i),this.domContainer=i}exportSvg(i,u){if(u.svgResult===v.zg){const P=encodeURIComponent(i);return`${ft}${P}`}if(u.svgResult===v.Ic)return new Blob([i],{type:"image/svg+xml"});throw new Error(`Invalid export target ${u.svgResult}`)}cleanup(){this.domContainer&&(document.body.removeChild(this.domContainer),this.domContainer=void 0)}static getLayoutConfig(i){return K(i?K({},i):{composer:{"font-family":"Noto Serif"},arranger:{"font-family":"Noto Serif"},copyrights:{"font-family":"Noto Serif"},harmonyText:{"font-family":"Noto Serif"},lyric:{"font-family":"Noto Serif"},lyricist:{"font-family":"Noto Serif"},measureNumber:{"font-family":"Noto Serif"},pageNumber:{"font-family":"Noto Serif"},partName:{"font-family":"Noto Serif"},pizzicato:{"font-family":"Noto Serif"},rehearsalText:{"font-family":"Noto Serif"},subtitle:{"font-family":"Noto Serif"},tempo:{"font-family":"Noto Serif"},title:{"font-family":"Noto Serif"},word:{"font-family":"Noto Serif","font-style":"italic"}},gt)}}},222729:(T,O,e)=>{var t=e(1072);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[T.id,t,""]]),t.locals&&(T.exports=t.locals);var f=e(929234).A,c=f("7e86c6fa",t,!0,{})},266761:(T,O,e)=>{"use strict";e.d(O,{B1:()=>E,al:()=>d,mk:()=>A});var t=e(59400),f=e.n(t);const c=new(f());function A(W){c.emit("experience",W)}function E(W){c.on("experience",W)}function d(W){c.off("experience",W)}var B=null},279596:(T,O,e)=>{"use strict";e.d(O,{Le:()=>f.L,N9:()=>t.A,UR:()=>A.A,oi:()=>E.A});var t=e(997092),f=e(574277),c=e(483363),A=e(704427),E=e(404083)},298271:(T,O,e)=>{var t=e(172042);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[T.id,t,""]]),t.locals&&(T.exports=t.locals);var f=e(929234).A,c=f("74b26a4c",t,!0,{})},310611:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>d});var t=e(814779),f=e.n(t),c=e(927860),A=e.n(c),E=A()(f());E.push([T.id,`.esc__4HFJ{font-size:9px;font-weight:500;cursor:pointer;padding:0;background-color:transparent;border:none}.esc__4HFJ strong{font-weight:500;color:var(--f-primary-dark)}.ScoreCommentInput_Mzxbw{gap:var(--spacing-4)}
`,""]),E.locals={esc:"esc__4HFJ",ScoreCommentInput:"ScoreCommentInput_Mzxbw"};const d=E},338854:()=>{},404083:(T,O,e)=>{"use strict";e.d(O,{A:()=>B});var t=e(238532),f=e(675736),c=e(331111),A=e(938793);const E={};E.$style=c.default;const B=(0,A.A)(f.A,[["render",t.X],["__cssModules",E]])},404421:(T,O,e)=>{"use strict";e.d(O,{A:()=>Be});var t=e(361744),f=e(555381),c=e(538065);const A={class:"score-preview"},E={class:"side-panel"},d={key:0,class:"header"},B={class:"format"},W={class:"export-options"},H={class:"labelWithIcon"},lt={class:"labelWithIcon"},it={class:"labelWithIcon"};function rt(s,o,r,Q,h,n){const U=(0,t.g2)("export-preview"),q=(0,t.g2)("PowerBadgeIcon"),F=(0,t.g2)("f-input-label"),$=(0,t.g2)("f-select-input"),Et=(0,t.g2)("loader-spinner"),Wt=(0,t.g2)("FNumberInputWithSteppers"),Ke=(0,t.g2)("ExportWidthInput"),je=(0,t.g2)("export-parts-selector"),Ve=(0,t.g2)("ExportOptionsPicker"),Xe=(0,t.g2)("FButton"),$e=(0,t.g2)("f-button"),He=(0,t.g2)("f-power-button"),Je=(0,t.g2)("FButtonGroup"),ke=(0,t.g2)("content-dialog");return(0,t.uX)(),(0,t.Wv)(ke,{onTouchstart:o[11]||(o[11]=(0,f.D$)(()=>{},["stop"])),onTouchend:o[12]||(o[12]=(0,f.D$)(()=>{},["stop"])),onClick:o[13]||(o[13]=(0,f.D$)(()=>{},["stop"])),onClose:n.manualCloseDialog,"regular-width":null,"content-scroll":Q.isSmallScreen},{default:(0,t.k6)(()=>[(0,t.Lk)("div",{class:(0,c.C4)(["dialog-content",{"is-small-screen":Q.isSmallScreen}])},[(0,t.Lk)("div",A,[(0,t.bF)(U,{"score-data":r.scoreData,"page-idx":h.pageIdx,"display-options":n.displayOptions,onSetNbPages:n.setNbPages,onSetSvgStr:n.setSvgStr,onLoadingPages:n.setLoadingPages},null,8,["score-data","page-idx","display-options","onSetNbPages","onSetSvgStr","onLoadingPages"])]),(0,t.Lk)("div",E,[s.exportJob.noDialogHeader?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",d,[(0,t.Lk)("h3",null,(0,c.v_)(s.$t("editor:export.title")),1),(0,t.Lk)("div",B,(0,c.v_)(n.getFormatName()),1)])),(0,t.Lk)("div",W,[n.showLayoutTypeInput?((0,t.uX)(),(0,t.CE)("div",{key:0,onClick:o[1]||(o[1]=(...ot)=>n.tryShowUpgradeDialog&&n.tryShowUpgradeDialog(...ot))},[(0,t.bF)(F,{"html-for":"layoutTypeInput"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",H,[(0,t.eW)((0,c.v_)(s.$t("editor:export.layout-input.label"))+" ",1),n.hasExportOptionsEnabled?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(q,{key:0,class:"powerBadge"}))])]),_:1}),(0,t.bF)($,{modelValue:h.layoutType,"onUpdate:modelValue":o[0]||(o[0]=ot=>h.layoutType=ot),values:n.layoutTypeValues,disabled:!n.hasExportOptionsEnabled,onPointerdown:n.tryShowUpgradeDialog,name:"LayoutTypeInput",id:"layoutTypeInput",size:"small"},null,8,["modelValue","values","disabled","onPointerdown"])])):(0,t.Q3)("",!0),n.showPageIdxInput?((0,t.uX)(),(0,t.CE)("div",{key:1,onClick:o[3]||(o[3]=(...ot)=>n.tryShowUpgradeDialog&&n.tryShowUpgradeDialog(...ot))},[(0,t.bF)(F,{"html-for":"pageIdxInput"},{default:(0,t.k6)(()=>[(0,t.eW)((0,c.v_)(s.$t("editor:export.page-idx-input.label")),1)]),_:1}),h.loadingPages?((0,t.uX)(),(0,t.Wv)(Et,{key:0,size:32,"line-size":3})):((0,t.uX)(),(0,t.Wv)($,{key:1,modelValue:n.pageIdxString,"onUpdate:modelValue":o[2]||(o[2]=ot=>n.pageIdxString=ot),values:n.pageIdxValues,name:"PageIndexInput",id:"pageIdxInput",size:"small"},null,8,["modelValue","values"]))])):(0,t.Q3)("",!0),n.showMeasureIdxInput?((0,t.uX)(),(0,t.CE)("div",{key:2,onClick:o[4]||(o[4]=(...ot)=>n.tryShowUpgradeDialog&&n.tryShowUpgradeDialog(...ot))},[(0,t.bF)(F,{"html-for":"startMeasureIdxInput"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",lt,[(0,t.eW)((0,c.v_)(s.$t("editor:export.measure-idx-input.start-label"))+" ",1),n.hasExportOptionsEnabled?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(q,{key:0,class:"powerBadge"}))])]),_:1}),(0,t.bF)(Wt,{disabled:!n.hasExportOptionsEnabled,onChange:n.setStartMeasureIdxShiftedDelayed,onDisabledAttempt:n.tryShowUpgradeDialog,"model-value":h.startMeasureIdx+1,min:1,max:h.nbMeasures,step:1,placeholder:"",id:"startMeasureIdxInput",size:"small"},null,8,["disabled","onChange","onDisabledAttempt","model-value","max"])])):(0,t.Q3)("",!0),n.showMeasureIdxInput?((0,t.uX)(),(0,t.CE)("div",{key:3,onClick:o[5]||(o[5]=(...ot)=>n.tryShowUpgradeDialog&&n.tryShowUpgradeDialog(...ot))},[(0,t.bF)(F,{"html-for":"stopMeasureIdxInput"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",it,[(0,t.eW)((0,c.v_)(s.$t("editor:export.measure-idx-input.stop-label"))+" ",1),n.hasExportOptionsEnabled?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(q,{key:0,class:"powerBadge"}))])]),_:1}),(0,t.bF)(Wt,{disabled:!n.hasExportOptionsEnabled,onChange:n.setStopMeasureIdxShiftedDelayed,onDisabledAttempt:n.tryShowUpgradeDialog,"model-value":h.stopMeasureIdx+1,min:1,max:h.nbMeasures,step:1,placeholder:"",id:"stopMeasureIdxInput",size:"small"},null,8,["disabled","onChange","onDisabledAttempt","model-value","max"])])):(0,t.Q3)("",!0),h.layoutType===h.LayoutType.RESPONSIVE?((0,t.uX)(),(0,t.CE)("div",{key:4,onClick:o[6]||(o[6]=(...ot)=>n.tryShowUpgradeDialog&&n.tryShowUpgradeDialog(...ot))},[(0,t.bF)(F,{"html-for":"displayWidth"},{default:(0,t.k6)(()=>[(0,t.eW)((0,c.v_)(n.widthLabel),1)]),_:1}),(0,t.bF)(Ke,{id:"displayWidth",unit:h.lengthUnit,"initial-value":h.width,onSetWidth:n.setWidthDelayed},null,8,["unit","initial-value","onSetWidth"])])):(0,t.Q3)("",!0),n.showPartsInput?((0,t.uX)(),(0,t.Wv)(je,{key:5,class:"parts-input","score-data":r.scoreData,"has-export-options-enabled":n.hasExportOptionsEnabled,onSetPartsDisplayed:n.setPartsDisplayed,onClick:n.tryShowUpgradeDialog},null,8,["score-data","has-export-options-enabled","onSetPartsDisplayed","onClick"])):(0,t.Q3)("",!0),n.showPartsInput?((0,t.uX)(),(0,t.CE)("button",{key:6,type:"button",class:"more-options",onClick:o[7]||(o[7]=(...ot)=>n.toggleMoreOptions&&n.toggleMoreOptions(...ot))},(0,c.v_)(n.showMoreOptionsText),1)):(0,t.Q3)("",!0),h.displayOptionsPicker||!n.showPartsInput?((0,t.uX)(),(0,t.Wv)(Ve,{key:7,class:"export-options-picker","score-data":r.scoreData,"initial-export-options":h.exportOptions,"can-use-options":n.hasExportOptionsEnabled,layout:h.layoutType,onSetExportOptions:n.setExportOptions,onRestrictedOptionAttempt:n.tryShowUpgradeDialog},null,8,["score-data","initial-export-options","can-use-options","layout","onSetExportOptions","onRestrictedOptionAttempt"])):(0,t.Q3)("",!0)]),(0,t.bF)(Je,null,{default:(0,t.k6)(()=>[(0,t.bF)(Xe,{theme:"outline-subdue",size:"medium",type:"button",onClick:o[8]||(o[8]=(0,f.D$)(ot=>n.manualCloseDialog(),["prevent","stop"])),"default-text":s.$t("flat:cancel")},null,8,["default-text"]),n.canExport?((0,t.uX)(),(0,t.Wv)($e,{key:0,class:(0,c.C4)({"ready-to-export":n.readyToExport}),onClick:o[9]||(o[9]=(0,f.D$)(ot=>n.performExport(),["prevent","stop"])),loading:!n.readyToExport,size:"medium","default-text":n.btnExportText,theme:"fill"},null,8,["class","loading","default-text"])):((0,t.uX)(),(0,t.Wv)(He,{key:1,"show-icon":!1,onClick:o[10]||(o[10]=(0,f.D$)(ot=>n.performExport(),["prevent","stop"])),size:"medium","default-text":"editor:export.upgrade-to-export"}))]),_:1})])],2)]),_:1},8,["onClose","content-scroll"])}var dt=e(110853),tt=e(575258),v=e(898110),D=e(925230),w=e(58163),C=e(86624),R=e(797727),X=e(316353),k=e(743161),z=e(931720),K=e(763939),et=e(941271),ft=e(612732),gt=e(71204),ut=e(227468),a=e(279596),_=e(6645);const m={class:"wrapper"},M={class:"toggleContent"},x={class:"toggleContent"},l={class:"toggleContent"},g={class:"toggleContent"},L={class:"toggleContent"},V={class:"toggleContent"},S={class:"toggleContent"},i={class:"toggleContent"};function u(s,o,r,Q,h,n){const U=(0,t.g2)("PowerBadgeIcon"),q=(0,t.g2)("toggle");return(0,t.uX)(),(0,t.CE)("div",m,[h.showHideNonTab?((0,t.uX)(),(0,t.Wv)(q,{key:0,id:"t-hideNonTab",modelValue:h.exportOptions.hideNonTab,"onUpdate:modelValue":o[0]||(o[0]=F=>h.exportOptions.hideNonTab=F),disabled:!r.canUseOptions,onClick:n.notifyRestrictedAttempt},{default:(0,t.k6)(()=>[(0,t.Lk)("div",M,[(0,t.eW)((0,c.v_)(s.$t("flat:score.export.hideNonTab"))+" ",1),r.canUseOptions?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,class:"powerBadge"}))])]),_:1},8,["modelValue","disabled","onClick"])):(0,t.Q3)("",!0),h.showHideNonKodaly?((0,t.uX)(),(0,t.Wv)(q,{key:1,id:"t-hideNonKodaly",modelValue:h.exportOptions.hideNonKodaly,"onUpdate:modelValue":o[1]||(o[1]=F=>h.exportOptions.hideNonKodaly=F),disabled:!r.canUseOptions,onClick:n.notifyRestrictedAttempt},{default:(0,t.k6)(()=>[(0,t.Lk)("div",x,[(0,t.eW)((0,c.v_)(s.$t("flat:score.export.hideNonKodaly"))+" ",1),r.canUseOptions?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,class:"powerBadge"}))])]),_:1},8,["modelValue","disabled","onClick"])):(0,t.Q3)("",!0),r.layout==="responsive"?((0,t.uX)(),(0,t.Wv)(q,{key:2,id:"t-respectSystemBreaks",modelValue:h.exportOptions.respectSystemBreaks,"onUpdate:modelValue":o[2]||(o[2]=F=>h.exportOptions.respectSystemBreaks=F),disabled:!r.canUseOptions,onClick:n.notifyRestrictedAttempt},{default:(0,t.k6)(()=>[(0,t.Lk)("div",l,[(0,t.eW)((0,c.v_)(s.$t("flat:score.export.respectSystemBreaksShort"))+" ",1),r.canUseOptions?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,class:"powerBadge"}))])]),_:1},8,["modelValue","disabled","onClick"])):(0,t.Q3)("",!0),h.showConcertPitch?((0,t.uX)(),(0,t.Wv)(q,{key:3,id:"t-concertPitch",modelValue:h.exportOptions.isConcertPitch,"onUpdate:modelValue":o[3]||(o[3]=F=>h.exportOptions.isConcertPitch=F),disabled:!r.canUseOptions,onClick:n.notifyRestrictedAttempt},{default:(0,t.k6)(()=>[(0,t.Lk)("div",g,[(0,t.eW)((0,c.v_)(s.$t("flat:score.export.concertPitch"))+" ",1),r.canUseOptions?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,class:"powerBadge"}))])]),_:1},8,["modelValue","disabled","onClick"])):(0,t.Q3)("",!0),(0,t.bF)(q,{id:"t-mergeRests",modelValue:h.exportOptions.mergeRests,"onUpdate:modelValue":o[4]||(o[4]=F=>h.exportOptions.mergeRests=F)},{default:(0,t.k6)(()=>[(0,t.Lk)("div",L,(0,c.v_)(s.$t("flat:score.export.mergeRests")),1)]),_:1},8,["modelValue"]),(0,t.bF)(q,{id:"t-mergeEmptyMeasures",modelValue:h.exportOptions.mergeEmptyMeasures,"onUpdate:modelValue":o[5]||(o[5]=F=>h.exportOptions.mergeEmptyMeasures=F),disabled:!r.canUseOptions,onClick:n.notifyRestrictedAttempt},{default:(0,t.k6)(()=>[(0,t.Lk)("div",V,[(0,t.eW)((0,c.v_)(s.$t("flat:score.export.useMultiMeasureRests"))+" ",1),r.canUseOptions?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,class:"powerBadge"}))])]),_:1},8,["modelValue","disabled","onClick"]),(0,t.bF)(q,{id:"t-hideTimeSignature",modelValue:h.exportOptions.hideTimeSignature,"onUpdate:modelValue":o[6]||(o[6]=F=>h.exportOptions.hideTimeSignature=F),disabled:!r.canUseOptions,onClick:n.notifyRestrictedAttempt},{default:(0,t.k6)(()=>[(0,t.Lk)("div",S,[(0,t.eW)((0,c.v_)(s.$t("flat:score.export.hideTimeSignature"))+" ",1),r.canUseOptions?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,class:"powerBadge"}))])]),_:1},8,["modelValue","disabled","onClick"]),r.canUseOptions?((0,t.uX)(),(0,t.Wv)(q,{key:4,id:"t-outlineColoredNotes",modelValue:h.exportOptions.outlineColoredNotes,"onUpdate:modelValue":o[7]||(o[7]=F=>h.exportOptions.outlineColoredNotes=F),onClick:n.notifyRestrictedAttempt,onChange:o[8]||(o[8]=F=>s.addExperience("editor.outline-colored-notes"))},{default:(0,t.k6)(()=>[(0,t.Lk)("div",i,(0,c.v_)(s.$t("flat:score.export.outlineColoredNotes")),1)]),_:1},8,["modelValue","onClick"])):(0,t.Q3)("",!0)])}var P=e(701387),b=e(446921),j=e(104907),pt=e(377180),ht=Object.defineProperty,Z=Object.defineProperties,at=Object.getOwnPropertyDescriptors,_t=Object.getOwnPropertySymbols,yt=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,y=(s,o,r)=>o in s?ht(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,I=(s,o)=>{for(var r in o||(o={}))yt.call(o,r)&&y(s,r,o[r]);if(_t)for(var r of _t(o))p.call(o,r)&&y(s,r,o[r]);return s},N=(s,o)=>Z(s,at(o));const st={hideNonTab:!1,hideNonKodaly:!1,isConcertPitch:!1,respectSystemBreaks:!0,mergeRests:!0,mergeEmptyMeasures:!1,outlineColoredNotes:!1,hideTimeSignature:!1},G={name:"ExportOptionsPicker",emits:["setExportOptions","restrictedOptionAttempt"],components:{PowerBadgeIcon:R.default},props:{scoreData:{type:Object,required:!0},initialExportOptions:{type:Object,required:!0},canUseOptions:{type:Boolean,required:!0},layout:{type:String,default:null}},data(){return{exportOptions:null,showConcertPitch:!1,showHideNonTab:!1,showHideNonKodaly:!1}},computed:{},watch:{exportOptions:{deep:!0,handler(){this.$emit("setExportOptions",I({},this.exportOptions))}}},created(){this.exportOptions=I(I({},st),this.initialExportOptions)},methods:N(I({},(0,_.i0)(et.B,["addExperience"])),{notifyRestrictedAttempt(){this.canUseOptions||this.$emit("restrictedOptionAttempt")}}),mounted(){const{adagioData:s}=this.scoreData,o=s.getNbParts();for(let r=0;r<o;r++){const Q=s.getPartContent(r),h=b.A.getFirstMeasure(Q),[n]=P.default.getStaffDetails(h);j.default.hasTab(n)&&(this.showHideNonTab=!0),j.default.hasKodaly(n)&&(this.showHideNonKodaly=!0);const[U]=P.default.getTranspose(h);if(pt.default.isIdentity(U)||(this.showConcertPitch=!0),this.isAllEnabled)return}}};var ct=e(759760),J=e(938793);const nt=(0,J.A)(G,[["render",u],["__scopeId","data-v-5efeea65"]]),Nt={class:"wrapper"},Bt={class:"radioContent"},Kt={key:0},jt={class:"radioContent"},Vt={key:1};function Xt(s,o,r,Q,h,n){const U=(0,t.g2)("FRadio"),q=(0,t.g2)("PowerBadgeIcon"),F=(0,t.g2)("checkbox");return(0,t.uX)(),(0,t.CE)("div",Nt,[(0,t.bF)(U,{value:h.ChoiceType.FULL,modelValue:h.choiceType,"onUpdate:modelValue":o[0]||(o[0]=$=>h.choiceType=$),id:n.getLocalChoiceId(h.ChoiceType.FULL)},{default:(0,t.k6)(()=>[(0,t.eW)((0,c.v_)(n.getChoiceName(h.ChoiceType.FULL)),1)]),_:1},8,["value","modelValue","id"]),(0,t.bF)(U,{disabled:!r.hasExportOptionsEnabled,value:h.ChoiceType.SET,modelValue:h.choiceType,"onUpdate:modelValue":o[1]||(o[1]=$=>h.choiceType=$),id:n.getLocalChoiceId(h.ChoiceType.SET)},{default:(0,t.k6)(()=>[(0,t.Lk)("div",Bt,[(0,t.eW)((0,c.v_)(n.getChoiceName(h.ChoiceType.SET))+" ",1),r.hasExportOptionsEnabled?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(q,{key:0,class:"powerBadge"}))])]),_:1},8,["disabled","value","modelValue","id"]),h.choiceType===h.ChoiceType.SET?((0,t.uX)(),(0,t.CE)("ul",Kt,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(h.partsList,$=>((0,t.uX)(),(0,t.CE)("li",{key:$.partIdx},[(0,t.bF)(F,{modelValue:$.enabled,"onUpdate:modelValue":Et=>$.enabled=Et,disabled:n.isOnlyPart($),id:n.getLocalPartId($),onChange:n.updatePartsDisplayed},{default:(0,t.k6)(()=>[(0,t.eW)((0,c.v_)($.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","id","onChange"])]))),128))])):(0,t.Q3)("",!0),(0,t.bF)(U,{disabled:!r.hasExportOptionsEnabled,value:h.ChoiceType.SINGLE,modelValue:h.choiceType,"onUpdate:modelValue":o[2]||(o[2]=$=>h.choiceType=$),id:n.getLocalChoiceId(h.ChoiceType.SINGLE)},{default:(0,t.k6)(()=>[(0,t.Lk)("div",jt,[(0,t.eW)((0,c.v_)(n.getChoiceName(h.ChoiceType.SINGLE))+" ",1),r.hasExportOptionsEnabled?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(q,{key:0,class:"powerBadge"}))])]),_:1},8,["disabled","value","modelValue","id"]),h.choiceType===h.ChoiceType.SINGLE?((0,t.uX)(),(0,t.CE)("ul",Vt,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(h.partsList,$=>((0,t.uX)(),(0,t.CE)("li",{key:$.partIdx},[(0,t.bF)(U,{value:$.partIdx.toString(),modelValue:h.singleSelectedPartIdx,"onUpdate:modelValue":o[3]||(o[3]=Et=>h.singleSelectedPartIdx=Et),id:n.getLocalPartId($),onChange:n.updateEnabledFromSingle},{default:(0,t.k6)(()=>[(0,t.eW)((0,c.v_)($.name),1)]),_:2},1032,["value","modelValue","id","onChange"])]))),128))])):(0,t.Q3)("",!0)])}var $t=e(383279),Ht=e(531070),Jt=Object.defineProperty,Ot=Object.getOwnPropertySymbols,kt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable,It=(s,o,r)=>o in s?Jt(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,zt=(s,o)=>{for(var r in o||(o={}))kt.call(o,r)&&It(s,r,o[r]);if(Ot)for(var r of Ot(o))Qt.call(o,r)&&It(s,r,o[r]);return s};const Dt="export-parts-selector-",xt={FULL:"partsAll",SET:"partsSet",SINGLE:"partsSingle"},Gt={name:"ExportPartsSelector",components:{FRadio:Ht.h,PowerBadgeIcon:R.default},emits:["setPartsDisplayed"],props:{scoreData:{type:Object,required:!0},hasExportOptionsEnabled:{type:Boolean,required:!0}},data(){return{ChoiceType:xt,choiceType:xt.FULL,partsList:[],nbParts:null,singleSelectedPartIdx:""}},computed:{nbPartsEnabled(){let s=0;return this.partsList.forEach(o=>{o.enabled&&s++}),s},partsDisplayedSet(){if(this.nbPartsEnabled===this.nbParts)return null;const s={};return this.partsList.forEach(o=>{o.enabled&&(s[o.partIdx]=!0)}),s}},watch:{choiceType(s){s===xt.FULL&&this.selectAll(),s===xt.SINGLE&&(this.selectFirstEnabled(),this.updateEnabledFromSingle())}},methods:{getChoiceName(s){return this.$t(`flat:score.export.${s}`)},selectAll(){this.partsList.forEach(s=>{s.enabled=!0}),this.updatePartsDisplayed()},isOnlyPart(s){return s.enabled&&this.nbPartsEnabled===1},getLocalPartId(s){return`${Dt}${s.partIdx}`},getLocalChoiceId(s){return`${Dt}${s}`},selectFirstEnabled(){this.partsList.some(o=>o.enabled?(this.singleSelectedPartIdx=o.partIdx.toString(),!0):!1)||(this.singleSelectedPartIdx="0")},updateEnabledFromSingle(){const s=Number.parseInt(this.singleSelectedPartIdx,10);this.partsList[s].enabled=!0,this.partsList.forEach(o=>{o.enabled=o.partIdx===s}),this.updatePartsDisplayed()},updatePartsDisplayed(){this.partsDisplayedSet===null?this.$emit("setPartsDisplayed",this.partsDisplayedSet):this.$emit("setPartsDisplayed",zt({},this.partsDisplayedSet))}},created(){const{adagioData:s}=this.scoreData,o=s.getNbParts();for(let r=0;r<o;r++){const Q=s.getPartHeader(r),h=$t.default.getName(Q),n={partIdx:r,enabled:!0,name:h};this.partsList.push(n)}this.nbParts=o}};var Qe=e(890194);const Yt=(0,J.A)(Gt,[["render",Xt],["__scopeId","data-v-3ee12261"]]),Zt={class:"wrapper"},qt={ref:"draftRoot",class:"draft-root"},te={ref:"svgDraft"},ee=["src"];function se(s,o,r,Q,h,n){const U=(0,t.g2)("loader-spinner");return(0,t.uX)(),(0,t.CE)("div",Zt,[(0,t.Lk)("div",qt,[((0,t.uX)(),(0,t.CE)("svg",te,null,512))],512),(0,t.Lk)("img",{ref:"svgContainer",class:"svg-container",src:n.imageSrc},null,8,ee),h.displayedSvgStr?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(U,{key:0,size:100,"line-size":3}))])}var oe=e(342023),re=e(429145),ne=e(669834),mt=e(212138),ae=e(443669),At=e(341715),ie=Object.defineProperty,Ct=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable,Mt=(s,o,r)=>o in s?ie(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,ue=(s,o)=>{for(var r in o||(o={}))le.call(o,r)&&Mt(s,r,o[r]);if(Ct)for(var r of Ct(o))de.call(o,r)&&Mt(s,r,o[r]);return s},Tt=(s,o,r)=>new Promise((Q,h)=>{var n=F=>{try{q(r.next(F))}catch($){h($)}},U=F=>{try{q(r.throw(F))}catch($){h($)}},q=F=>F.done?Q(F.value):Promise.resolve(F.value).then(n,U);q((r=r.apply(s,o)).next())});const pe="data:image/svg+xml,";function ce(s){return JSON.parse(JSON.stringify(s))}const he={name:"ExportPreview",components:{LoaderSpinner:k.A},emits:["setSvgStr","loadingPages","setNbPages"],props:{scoreData:{type:Object,required:!0},displayOptions:{type:Object,required:!0},pageIdx:{type:Number,default:0}},data(){return{currentDisplayOptions:null,isDrawing:!0,displayedSvgStr:""}},watch:{settedHash(s){this.currentHash!==s&&(this.$emit("setSvgStr",null),this.isDrawing||this.updateDisplay())},pageIdx(s){if(s>=0&&s<this.pages.length){const o=this.pages[s];this.displayedSvgStr=o.node().outerHTML}},displayedSvgStr(){this.displayedSvgStr&&this.$emit("setSvgStr",this.displayedSvgStr)}},computed:{currentHash(){return At.digest(this.currentDisplayOptions)},settedHash(){return At.digest(this.displayOptions)},textMetrics(){return new ne.A(this.$refs.svgDraft)},layoutType(){return this.currentDisplayOptions.layout},imageSrc(){if(!this.displayedSvgStr)return"";const s=encodeURIComponent(this.displayedSvgStr);return`${pe}${s}`}},methods:{updateDisplay(){return Tt(this,null,function*(){this.currentDisplayOptions=ue({},this.displayOptions),this.isDrawing=!0;try{this.dropSvgPages(),yield(0,t.dY)();const s=ce(this.scoreJson),o=new re.A(s),r=yield this.getSmuflFont(o),Q=mt.default.getLayoutConfig(this.currentDisplayOptions.displaySettings);Q.isAsynchronous=!0,Q.displayOtherLinesPartsNames=!ae.A.canHidePartNames(o);const h=(0,mt.getScoreLayout)(this.layoutType),n=new h(o,this.currentDisplayOptions.dpi,this.textMetrics,r,Q);for(this.layoutType===v.xp&&(0,mt.setLayoutWidth)(n,this.currentDisplayOptions),this.layoutType===v.KL&&this.$emit("loadingPages",!0);n.hasRemaining();){const U=this.getNewPageSvg();if(!U){this.$emit("loadingPages",!1),this.isDrawing=!1;return}yield n.fillNextPage(U),this.$emit("setNbPages",n.getNbPages()),this.layoutType===v.KL&&((0,mt.processPageSvg)(U,this.currentDisplayOptions.backgroundColor),this.pageIdx+1===n.getNbPages()&&(this.displayedSvgStr=U.node().outerHTML))}if(this.layoutType===v.KL&&this.$emit("loadingPages",!1),this.layoutType===v.xp&&(0,mt.mergeAllPages)(n),this.layoutType!==v.KL){const U=n.getPageSvg(0);(0,mt.processPageSvg)(U,this.currentDisplayOptions.backgroundColor),this.displayedSvgStr=U.node().outerHTML}this.isDrawing=!1}catch(s){throw this.isDrawing=!1,s}this.currentHash!==this.settedHash&&(yield this.updateDisplay())})},dropSvgPages(){this.pages.forEach(s=>s.removeFromParent()),this.pages=[]},getNewPageSvg(){if(!this.$refs.draftRoot)return null;const s=new oe.default;return this.pages.push(s),this.$refs.draftRoot.appendChild(s.node()),s},getSmuflFont(s){return Tt(this,null,function*(){return this.smuflFont===null&&(this.smuflFont=yield(0,mt.getSmuflFont)(s)),this.smuflFont})}},created(){this.pages=[],this.smuflFont=null},mounted(){const{adagioData:s}=this.scoreData;this.scoreJson=s.exportData(),this.updateDisplay()}};var Ge=e(298271);const fe=(0,J.A)(he,[["render",se],["__scopeId","data-v-5bcd22e4"]]),ge=["min","max"];function me(s,o,r,Q,h,n){return(0,t.bo)(((0,t.uX)(),(0,t.CE)("input",{type:"number",step:"0.01",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=U=>h.value=U),min:n.min,max:n.max,onInput:o[1]||(o[1]=(...U)=>n.sendValue&&n.sendValue(...U)),onChange:o[2]||(o[2]=(...U)=>n.sendValue&&n.sendValue(...U)),onKeypress:o[3]||(o[3]=(0,f.D$)(()=>{},["stop"])),onKeydown:o[4]||(o[4]=(0,f.D$)(()=>{},["stop"])),onKeyup:o[5]||(o[5]=(0,f.D$)(()=>{},["stop"]))},null,40,ge)),[[f.Jo,h.value,void 0,{number:!0}]])}var _e=e(390253),ve=Object.defineProperty,Lt=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,bt=(s,o,r)=>o in s?ve(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,xe=(s,o)=>{for(var r in o||(o={}))ye.call(o,r)&&bt(s,r,o[r]);if(Lt)for(var r of Lt(o))Ee.call(o,r)&&bt(s,r,o[r]);return s};function Pe(s){return Math.round(s*100)/100}const Rt=5,Ut=50,Se={name:"ExportOptionsPicker",emits:["setWidth","setExportOptions"],props:{unit:{type:String,required:!0},initialValue:{type:Number,required:!0}},data(){return{value:null}},computed:{min(){return this.unit===D.$t?this.convertToInch(Rt):Rt},max(){return this.unit===D.$t?this.convertToInch(Ut):Ut}},methods:{convertToInch(s){return s=s*10/_e.A.MM_PER_INCH,s=Pe(s),s},sendValue(){const s=Number.parseFloat(this.$el.value);this.$emit("setWidth",s)}},watch:{exportOptions:{deep:!0,handler(){this.$emit("setExportOptions",xe({},this.exportOptions))}}},created(){this.value=this.initialValue}},Oe=(0,J.A)(Se,[["render",me]]);var Ie=Object.defineProperty,De=Object.defineProperties,Ae=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,wt=(s,o,r)=>o in s?Ie(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,vt=(s,o)=>{for(var r in o||(o={}))Ce.call(o,r)&&wt(s,r,o[r]);if(Ft)for(var r of Ft(o))Me.call(o,r)&&wt(s,r,o[r]);return s},Pt=(s,o)=>De(s,Ae(o));const Te=8,Le={svg:96,png:150},be={displayEventsRects:!1,hideTiedFrets:!0,styleGroupChildElements:!0,usePedalLine:!0},Re={hideNonTab:!1,hideNonKodaly:!1,isConcertPitch:!1,respectSystemBreaks:!0,mergeRests:!0,mergeEmptyMeasures:!1,outlineColoredNotes:!1,hideTimeSignature:!1},Ue=15,Fe=6,we=700;function St(s,o,r,Q){s[r]&&(clearTimeout(s[r]),s[r]=null),s[r]=setTimeout(()=>{o.call(s,Q),s[r]=null},we)}function We(s){if(s===D.Jb)return Ue;if(s===D.$t)return Fe;throw new Error(`Invalid length unit: ${s}`)}const Ne={name:"ImageExport",components:{ContentDialog:C.A,FInputLabel:X.A,FSelectInput:a.N9,FNumberInputWithSteppers:gt.A,LoaderSpinner:k.A,FPowerButton:ut.QY,PowerBadgeIcon:R.default,ExportPreview:fe,ExportPartsSelector:Yt,ExportOptionsPicker:nt,ExportWidthInput:Oe},emits:["close"],props:{scoreData:{type:Object,required:!0},exportManager:{type:Object,required:!0}},data(){return{LayoutType:v.iM(),LengthUnit:D.iM(),exportBranding:!0,lengthUnit:D.$t,displayOptionsPicker:!1,layoutType:v.KL,pageIdx:0,startMeasureIdx:0,stopMeasureIdx:0,nbMeasures:null,nbInstruments:null,nbPages:null,svgStr:null,loadingPages:!1,partsDisplayed:null,exportOptions:vt({},Re),width:null}},setup(){const s=(0,K.F)(),o=(0,ft.k)(),r=(0,et.B)();return{locale:(0,t.EW)(()=>s.locale),accountFeatures:(0,t.EW)(()=>s.accountFeatures),isMusicSnippet:(0,t.EW)(()=>s.isMusicSnippet),isSmallScreen:(0,t.EW)(()=>o.isSmallScreen),addExperience:r.addExperience}},watch:{layoutType(s){s===v.KL&&(this.pageIdx=0)},nbPages(s){s!==null&&(this.pageIdx=Math.min(this.pageIdx,s-1))}},computed:Pt(vt({},(0,_.aH)(w.V,["exportJob"])),{hasExportOptionsEnabled(){return this.accountFeatures.exportOptions},canExport(){const s=this.exportJob.imageFormat||"svg";return this.isMusicSnippet||s==="png"&&this.accountFeatures.exportPng||s==="svg"&&this.accountFeatures.exportSvg},showLayoutTypeInput(){return!0},layoutTypeValues(){return v.vS().map(s=>({value:s,name:this.$t(`editor:export.layout-input.${s}`)}))},showPageIdxInput(){return this.layoutType===v.KL},pageIdxValues(){const s=this.nbPages||1,o=[];for(let r=0;r<s;r++)o.push({value:r.toString(),name:r+1});return o},pageIdxString:{set(s){this.pageIdx=Number.parseInt(s,10)},get(){return this.pageIdx.toString()}},showMeasureIdxInput(){return this.layoutType===v.Kq||this.layoutType===v.xp},displayOptions(){const s=vt(Pt(vt({},be),{partsDisplayed:this.partsDisplayed}),this.exportOptions);this.showMeasureIdxInput&&(s.firstMeasureIdx=this.startMeasureIdx,s.lastMeasureIdx=this.stopMeasureIdx),this.hasExportOptionsEnabled||(s.logoFontJson=(0,dt.getLogoFontJson)(),s.headerBrandingText=(0,dt.getBrandingText)(this.locale));const o=this.exportJob.dpi||Le[this.exportJob.imageFormat],r={layout:this.layoutType,dpi:o,displaySettings:s,backgroundColor:this.exportJob.defaultBackgroundColor};return this.layoutType===v.xp&&(r.widthUnit=this.lengthUnit,r.displayWidth=this.width),r},showPartsInput(){return this.nbParts>1},showMoreOptionsText(){return this.displayOptionsPicker?this.$t("flat:show-less-options"):this.$t("flat:show-more-options")},widthLabel(){const s=this.$t(`flat:lengthUnit.${this.lengthUnit}`);return this.$t("editor:export.width.label",{unit:s})},readyToExport(){return this.svgStr!==null},btnExportText(){return this.isMusicSnippet?"editor:export.insert":"editor:export.title"}}),methods:Pt(vt({},(0,_.i0)(z.B,["showUpgradeDialog"])),{getFormatName(){return`(*.${this.exportJob.imageFormat})`},setStartMeasureIdxShiftedDelayed(s){St(this,this.setStartMeasureIdxShifted,"setStartMeasureIdxTimeoutId",s)},setStartMeasureIdxShifted(s){this.setStartMeasureIdx(s-1)},setStartMeasureIdx(s){s=Math.max(s,0),s=Math.min(s,this.nbMeasures-1),this.startMeasureIdx=s,this.stopMeasureIdx=Math.max(this.stopMeasureIdx,this.startMeasureIdx)},setStopMeasureIdxShiftedDelayed(s){St(this,this.setStopMeasureIdxShifted,"setStopMeasureIdxTimeoutId",s)},setStopMeasureIdxShifted(s){this.setStopMeasureIdx(s-1)},setStopMeasureIdx(s){s=Math.max(s,0),s=Math.min(s,this.nbMeasures-1),this.stopMeasureIdx=s,this.startMeasureIdx=Math.min(this.stopMeasureIdx,this.startMeasureIdx)},setNbPages(s){this.nbPages=s},setSvgStr(s){this.svgStr=s},setLoadingPages(s){this.loadingPages=s},setPartsDisplayed(s){this.partsDisplayed=s},toggleMoreOptions(){this.displayOptionsPicker=!this.displayOptionsPicker},setExportOptions(s){this.exportOptions=s},setWidthDelayed(s){St(this,this.setWidth,"setWidthTimeoutId",s)},setWidth(s){this.width=Number.parseFloat(s)},manualCloseDialog(){if(this.exportJob){const s=new Error("Export dialog was closed by user");this.exportJob.reject(s)}this.$emit("close")},closeDialog(){this.$emit("close")},tryShowUpgradeDialog(){this.hasExportOptionsEnabled||this.showUpgradeDialog({feature:"exportOptions"})},performExport(){if(!this.canExport){this.showUpgradeDialog({feature:`${this.exportJob.imageFormat}Export`});return}const s=this.getExportBasePayload();this.logExportExperience(s.options),this.addExperience(`editor.export.${this.exportJob.imageFormat}Extract`),this.addExperience("editor.export"),s.format=this.exportJob.imageFormat,s.format==="png"?s.options.pngResult=this.exportJob.resultFormat:s.format==="svg"&&(s.options.svgResult=this.exportJob.resultFormat),s.options.backgroundColor=this.exportJob.defaultBackgroundColor,s.resolve=this.exportJob.resolve,s.reject=this.exportJob.reject,this.exportManager.queueExport(s),this.closeDialog()},getExportBasePayload(){return{scoreData:this.scoreData,options:vt({result:this.exportJob.resultDelivery,svgStr:this.svgStr},this.exportOptions)}},logExportExperience(s){s.hideNonTab&&this.addExperience("editor.hide-non-tab"),s.mergeEmptyMeasures&&this.addExperience("editor.multimeasures-rest"),s.outlineColoredNotes&&this.addExperience("editor.outline-colored-notes")}}),created(){const{adagioData:s}=this.scoreData;this.adagioData=s,this.nbMeasures=s.getNbMeasures(),this.nbParts=s.getNbParts();const{rangeSelect:o}=this.scoreData.scoreActions;if(o.hasRange()&&this.hasExportOptionsEnabled){this.layoutType=v.Kq;const Q=o.getLeftRightPositions();this.startMeasureIdx=s.getMeasureIdxFromUuid(Q.left.measureUuid),this.stopMeasureIdx=s.getMeasureIdxFromUuid(Q.right.measureUuid)}else this.hasExportOptionsEnabled?this.setStopMeasureIdx(Te-1):this.setStopMeasureIdx(this.nbMeasures-1);this.hasExportOptionsEnabled?this.exportJob.defaultLayout&&(this.layoutType=this.exportJob.defaultLayout):this.layoutType=v.Kq;const r=new tt.A(this.account);this.lengthUnit=r.userUnit(),this.width=We(this.lengthUnit),this.setStartMeasureIdxTimeoutId=null,this.setStopMeasureIdxTimeoutId=null,this.setWidthTimeoutId=null}};var qe=e(222729);const Be=(0,J.A)(Ne,[["render",rt],["__scopeId","data-v-0f2a4940"]])},404623:(T,O,e)=>{"use strict";e.d(O,{Ic:()=>f,vS:()=>E,xA:()=>c,zg:()=>t});const t="dataURL",f="Uint8Array",c="clipboard",A="svgString";function E(){return[t,f,c,A]}},427024:(T,O,e)=>{"use strict";e.d(O,{A:()=>dt});var t=e(939606),f=e(773067),c=e(591340),A=e(550594),E=e(324074),d=e.n(E),B=e(645369),W=e.n(B),H=(tt,v,D)=>new Promise((w,C)=>{var R=z=>{try{k(D.next(z))}catch(K){C(K)}},X=z=>{try{k(D.throw(z))}catch(K){C(K)}},k=z=>z.done?w(z.value):Promise.resolve(z.value).then(R,X);k((D=D.apply(tt,v)).next())});const lt=W()("flat:export"),it=[function(v,D){return delete D.common["x-csrf-token"],delete D.common["x-flat-request-as"],v}];function rt(tt){const v=d().defaults.headers.common["x-flat-request-as"];return v&&(tt["x-flat-request-as"]=v),tt}class dt extends t.A{constructor(v){super(v),this.handlers.mp3={fnc:"apiTaskHandler",queue:"api",extension:"mp3"},this.handlers.wav={fnc:"apiTaskHandler",queue:"api",extension:"wav"},this.handlers.soundtrap={fnc:"soundtrapHandler",queue:"api"},this.handlers.practicefirst={fnc:"apiTaskHandler",queue:"api"}}saveIfPossible(v){return H(this,arguments,function*({options:D,scoreData:w}){const C=(0,c.U)().scoreWrite;!D.noSave&&w.scoreActions&&w.scoreActions.actionsList.save&&C&&(yield w.scoreActions.executePublicAction("save",{context:"saveBeforeExport"},{muteUnavailableAction:!0}))})}apiTaskHandler(v){return H(this,null,function*(){yield this.saveIfPossible(v);const D={},w={sharingKey:v.scoreData.sharingKey};v.options.parts&&(D.parts=v.options.parts);const C=yield A.A.post(`${A.A.apiv2baseurl}/scores/${v.scoreData.scoreId}/revisions/last/${v.format}/task`,D,{params:w});return lt("task fetched %O",C),v.task=C,(0,f.V)().upsert(v),C.state==="done"?this.onceTaskDone(C,v):new Promise((R,X)=>{this.intervalId=setInterval(this.updateTask.bind(this,v,C.id,R,X),2e3)})})}updateTask(v,D,w,C){return H(this,null,function*(){lt("update task %s",D);const R=yield A.A.get(`${A.A.apiv2baseurl}/tasks/${D}`);if(v.task=R,(0,f.V)().upsert(v),lt("received task update %O",R),R.state==="done"){clearInterval(this.intervalId);const X=yield this.onceTaskDone(R,v);w(X)}else R.state==="error"&&(clearInterval(this.intervalId),C(new Error("Export task error, please contact our support")))})}onceTaskDone(v,D){return H(this,null,function*(){return D.format==="practicefirst"?(window.location=v.result.url,Promise.resolve()):this.downloadExportedFile(D)})}downloadExportedFile(v){return H(this,null,function*(){const D={sharingKey:v.scoreData.sharingKey};return v.options.parts&&(D.parts=v.options.parts.join(",")),rt(D),yield A.A.get(`${A.A.apiv2baseurl}/scores/${v.scoreData.scoreId}/revisions/last/${v.format}`,{responseType:"arraybuffer",transformRequest:it,params:D})})}apiSyncHandler(v){return H(this,arguments,function*({format:D,scoreData:w,options:C}){yield this.saveIfPossible({scoreData:w,options:C});const R={sharingKey:w.sharingKey};return C.parts&&(R.parts=C.parts.join(",")),rt(R),yield A.A.get(`${A.A.apiv2baseurl}/scores/${w.scoreId}/revisions/last/${D}`,{responseType:"arraybuffer",transformRequest:it,params:R})})}soundtrapHandler(v){return H(this,arguments,function*({scoreData:D,options:w}){yield this.saveIfPossible({scoreData:D,options:w});const C={sharingKey:D.sharingKey,url:!0};rt(C);const R=yield A.A.get(`${A.A.apiv2baseurl}/scores/${D.scoreId}/revisions/last/midi`,{params:C}),X=encodeURIComponent(this.getTitle(D)),k=encodeURIComponent(R.url);window.location=`https://www.soundtrap.com/publicapi/import/midi1/?url=${k}&title=${X}`})}}},429396:(T,O,e)=>{var t=e(310611);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[T.id,t,""]]),t.locals&&(T.exports=t.locals);var f=e(929234).A,c=f("59d77ec4",t,!0,{})},558633:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>d});var t=e(814779),f=e.n(t),c=e(927860),A=e.n(c),E=A()(f());E.push([T.id,`.wrapper .toggle-content.right[data-v-5efeea65]{margin-left:10px}.wrapper label[data-v-5efeea65]:not(:first-child){margin-top:8px}.toggleContent[data-v-5efeea65]{display:flex;align-items:center}.powerBadge[data-v-5efeea65]{margin-left:8px;width:16px;height:16px}
`,""]);const d=E},597981:(T,O,e)=>{"use strict";e.r(O),e.d(O,{default:()=>d});var t=e(814779),f=e.n(t),c=e(927860),A=e.n(c),E=A()(f());E.push([T.id,`.loader_F6SiL{display:flex;align-items:center;justify-content:center}
`,""]),E.locals={loader:"loader_F6SiL"};const d=E},616208:(T,O,e)=>{var t=e(597981);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[T.id,t,""]]),t.locals&&(T.exports=t.locals);var f=e(929234).A,c=f("541e83b2",t,!0,{})},759760:(T,O,e)=>{var t=e(558633);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[T.id,t,""]]),t.locals&&(T.exports=t.locals);var f=e(929234).A,c=f("828225b2",t,!0,{})},890194:(T,O,e)=>{var t=e(154863);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[T.id,t,""]]),t.locals&&(T.exports=t.locals);var f=e(929234).A,c=f("1856c956",t,!0,{})},898110:(T,O,e)=>{"use strict";e.d(O,{KL:()=>t,Kq:()=>f,iM:()=>E,vS:()=>A,xp:()=>c});const t="page",f="track",c="responsive";function A(){return[t,f,c]}function E(){return{PAGE:t,TRACK:f,RESPONSIVE:c}}},904973:(T,O,e)=>{"use strict";e.d(O,{A:()=>yt});var t=e(361744),f=e(538065),c=e(555381);const A=["autofocus","disabled","placeholder"];function E(p,y,I,N,st,G){const ct=(0,t.g2)("UserPicture"),J=(0,t.g2)("input-mention"),Y=(0,t.gN)("dompurify-html");return(0,t.uX)(),(0,t.CE)("form",{class:(0,f.C4)(["comment-form-v2 sv-comment",p.$style.ScoreCommentInput]),onSubmit:y[4]||(y[4]=(0,c.D$)(nt=>G.submit(),["prevent"])),ref:"commentForm",onClick:y[5]||(y[5]=nt=>G.checkSignin())},[I.showUser?((0,t.uX)(),(0,t.Wv)(ct,{key:0,user:N.account,width:I.avatarWidth},null,8,["user","width"])):(0,t.Q3)("",!0),(0,t.bF)(J,{class:"t",onUpdate:y[3]||(y[3]=nt=>G.resizeInput())},{default:(0,t.k6)(()=>[(0,t.Lk)("textarea",{class:"form-control",ref:"textarea",onKeydown:y[0]||(y[0]=(0,c.D$)(nt=>G.keydown(nt),["stop"])),onKeypress:y[1]||(y[1]=(0,c.D$)(()=>{},["stop"])),autofocus:I.autofocus,disabled:st.submitting,placeholder:G.inputPlaceholder,maxlength:"2500",rows:"1"},null,40,A),y[6]||(y[6]=(0,t.Lk)("div",{class:"inpos ddn-align"},null,-1)),I.showEscText&&G.displayEscText?(0,t.bo)(((0,t.uX)(),(0,t.CE)("button",{key:0,class:(0,f.C4)(p.$style.esc),type:"button",onClick:y[2]||(y[2]=(...nt)=>G.cancel&&G.cancel(...nt))},null,2)),[[Y,p.$t("flat:score.comments.edit-esc")]]):(0,t.Q3)("",!0)]),_:1,__:[6]})],34)}var d=e(511801),B=e(318866),W=e(674548),H=e(763939),lt=e(57500),it=e(88247),rt=e(823828),dt=e(6645);function tt(p,y,I,N,st,G){const ct=(0,t.g2)("input-mention-dropdown"),J=(0,t.gN)("dropdown");return(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",{class:(0,f.C4)(["ddn input-mention",{open:p.openDropdown}])},[(0,t.RG)(p.$slots,"default"),(0,t.bo)((0,t.bF)(ct,{class:"ddn-content",style:(0,f.Tr)(p.ddnStyle),users:p.users,"highlighted-user":p.highlightedUser,onReplace:p.replace},null,8,["style","users","highlighted-user","onReplace"]),[[c.aG,p.openDropdown&&p.userExists]])],2)),[[J,{placement:"bottom-start",dontBindClick:!0,alwaysInit:!0,positionFixed:!0}]])}const v={class:"ddn-input-mention ddn-content"},D=["onClick"],w={class:"username"};function C(p,y,I,N,st,G){const ct=(0,t.g2)("user");return(0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("ul",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(I.users,(J,Y)=>((0,t.uX)(),(0,t.CE)("li",{key:J.id,class:(0,f.C4)({highlighted:Y===I.highlightedUser})},[(0,t.Lk)("a",{onClick:nt=>G.select(J)},[(0,t.bF)(ct,{uid:J,href:"none",width:22},null,8,["uid"]),(0,t.Lk)("span",w,"@"+(0,f.v_)(J.username),1)],8,D)],2))),128))])])}var R=e(243838);const X={name:"InputMentionDropdown",components:{User:R.A},props:{users:{type:Array,default:()=>[]},highlightedUser:{type:Number,default:null}},emits:["replace"],methods:{select(p){this.$emit("replace",p)}}};var k=e(938793);const K=(0,k.A)(X,[["render",C]]);var et=(p,y,I)=>new Promise((N,st)=>{var G=Y=>{try{J(I.next(Y))}catch(nt){st(nt)}},ct=Y=>{try{J(I.throw(Y))}catch(nt){st(nt)}},J=Y=>Y.done?N(Y.value):Promise.resolve(Y.value).then(G,ct);J((I=I.apply(p,y)).next())});const ft=13,gt=27,ut=40,a=38,m={name:"input-mention",components:{InputMentionDropdown:K},data(){return{openDropdown:!1,ddnTop:0,ddnLeft:0,searchText:null,users:[],highlightedUser:0}},setup(){const{mentionSearchUser:p}=(0,rt.k)();return{mentionSearchUser:p}},computed:{ddnStyle(){return{"margin-left":`${this.ddnLeft}px`,"margin-top":`${this.ddnTop}px`}},userExists(){return!!this.users[0]}},mounted(){this.setupTextarea()},methods:{checkCurrentWord(){const{word:p,end:y}=this.getCurrentWordAndPos();return y<0||!p?(this.openDropdown=!1,!1):(this.openDropdown=p.startsWith("@"),this.searchText=p.slice(1),this.users=[],this.search(),this.highlightedUser=0,this.openDropdown)},getCurrentWordAndPos(){const p=this.getCaretPosition(this.$textarea);let y=this.$textarea.value.indexOf(" ",p.end);if(y<0&&this.$textarea.value.length>0&&(y=this.$textarea.value.length),y<0)return{};let I=/\S+$/.exec(this.$textarea.value.slice(0,y));return I&&(I=I[0]),{end:y,word:I}},getCaretPosition(p){var y;let I,N;if(p.setSelectionRange)I=p.selectionStart,N=p.selectionEnd;else if((y=document.selection)!=null&&y.createRange){const st=document.selection.createRange();I=0-st.duplicate().moveStart("character",-1e5),N=I+st.text.length}return{start:I,end:N}},search(){this.lastTimeout&&clearTimeout(this.lastTimeout),this.lastTimeout=setTimeout(()=>et(this,null,function*(){this.lastTimeout=null,this.users=[],this.highlightedUser=0,this.users=yield this.mentionSearchUser(this.searchText)}),100)},replace(p){const y=(p==null?void 0:p.username)||this.users[this.highlightedUser].username,{word:I,end:N}=this.getCurrentWordAndPos();if(N<0||!I)return;const st=N-I.length,G=this.$textarea.value,ct=`${G.slice(0,st)}@${y} ${G.slice(N)}`;this.$textarea.value=ct,this.openDropdown=!1,this.$emit("update")},clickReplace(){},setupTextarea(){const p=this.$el.querySelector("textarea");this.$textarea=p,this.$textarea&&this.bindEventsToTextarea()},bindEventsToTextarea(){this.$textarea.addEventListener("keydown",p=>{const y=()=>{p.stopPropagation(),p.preventDefault(),this.preventKeyUp=!0};if(this.openDropdown){if(p.keyCode===ft)return y(),this.replace();if(p.keyCode===gt)return this.openDropdown=!1,y();if(p.keyCode===a)return this.highlightedUser>0&&this.highlightedUser--,y();if(p.keyCode===ut)return this.highlightedUser<this.users.length-1&&this.highlightedUser++,y()}this.checkCurrentWord();{const N=e(254124)(this.$textarea,this.$textarea.selectionEnd);this.ddnTop=N.top+N.height,this.ddnLeft=N.left}return null}),this.$textarea.addEventListener("keyup",p=>{this.openDropdown||this.checkCurrentWord(),this.preventKeyUp&&(p.stopPropagation(),p.preventDefault(),this.preventKeyUp=!1)})}}},x=(0,k.A)(m,[["render",tt]]);var l=Object.defineProperty,g=Object.defineProperties,L=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,u=(p,y,I)=>y in p?l(p,y,{enumerable:!0,configurable:!0,writable:!0,value:I}):p[y]=I,P=(p,y)=>{for(var I in y||(y={}))S.call(y,I)&&u(p,I,y[I]);if(V)for(var I of V(y))i.call(y,I)&&u(p,I,y[I]);return p},b=(p,y)=>g(p,L(y)),j=(p,y,I)=>new Promise((N,st)=>{var G=Y=>{try{J(I.next(Y))}catch(nt){st(nt)}},ct=Y=>{try{J(I.throw(Y))}catch(nt){st(nt)}},J=Y=>Y.done?N(Y.value):Promise.resolve(Y.value).then(G,ct);J((I=I.apply(p,y)).next())});const pt={name:"ScoreCommentInput",props:{score:{type:Object,required:!0},edit:{type:Object,default:null},reply:{type:Object,default:null},context:{type:Object,default:null},autofocus:{type:Boolean,default:!0},showUser:{type:Boolean,default:!0},avatarWidth:{type:Number,default:36},showEscText:{type:Boolean,default:!0}},components:{UserPicture:d.A,InputMention:x},emits:["autogrow","cancel"],data(){return{submitting:!1}},setup(){const p=(0,H.F)(),{createOrEditComment:y}=(0,it.O)(),I=(0,lt.l)(),{goSignin:N}=I,st=(0,rt.k)();return{createOrEditComment:y,goSignin:N,account:(0,t.EW)(()=>p.account),isEdu:(0,t.EW)(()=>p.isEdu),userGet:st.get}},computed:{inputPlaceholder(){return this.edit?W.MR.t("flat:score.comments.edit-placeholder"):W.MR.t("flat:score.comments.add-placeholder")},displayEscText(){return this.edit||this.reply}},methods:b(P({},(0,dt.i0)(B.j,["showDialog"])),{keydown(p){const y=this.$el.getElementsByClassName("input-mention")[0].classList.contains("open");if(!this.account.id){this.goSignin();return}if(this.submitting){p.preventDefault();return}p.keyCode===13?(y||(p.ctrlKey||p.shiftKey?(this.$refs.textarea.value+=`
`,this.autogrow.autogrowFn(),this.$emit("autogrow")):this.submit(p)),p.preventDefault()):p.keyCode===27&&this.cancel()},submit(p){var y,I;if(!((y=this.account.community)!=null&&y.acceptedCodeOfConduct)&&!this.isEdu&&!this.context&&this.score.privacy==="public"){p.preventDefault(),this.showDialog("communityOnboarding");return}if(this.submitting)return;this.submitting=!0;const N={rawComment:this.$refs.textarea.value};N.comment=N.rawComment,this.reply&&(N.replyTo=this.reply.id),this.context&&(N.context=this.context),this.createOrEditComment({scoreId:this.score.id,comment:((I=this.edit)==null?void 0:I.id)||void 0,sharingKey:this.score.sharingKey,body:N}).then(()=>{this.$refs.textarea.value="",this.autogrow.autogrowFn(),this.submitting=!1,this.cancel()}).catch(()=>{this.submitting=!1})},resizeInput(){this.autogrow.autogrowFn(),this.$emit("autogrow")},cancel(){this.$emit("cancel")},checkSignin(){this.account.id||this.goSignin()}}),mounted(){return j(this,null,function*(){{const p=e(492552);this.autogrow=new p(this.$refs.textarea,15)}if(this.edit)this.$refs.textarea.value=this.edit.rawComment||this.edit.comment,this.autogrow.autogrowFn();else if(this.reply){const p=yield this.userGet(this.reply.user);this.$refs.textarea.value=`@${p.username} `}this.autofocus&&this.$refs.textarea.focus(),this.$emit("autogrow")})}};var ht=e(429396),Z=e.n(ht);const at={};at.$style=Z();const yt=(0,k.A)(pt,[["render",E],["__cssModules",at]])},925230:(T,O,e)=>{"use strict";e.d(O,{$t:()=>f,Jb:()=>t,iM:()=>A,vS:()=>c});const t="cm",f="inch";function c(){return[t,f]}function A(){return{CENTIMETER:t,INCH:f}}},938486:(T,O,e)=>{"use strict";e.d(O,{h:()=>w});var t=e(361744),f=e(538065);function c(C,R,X,k,z,K){const et=(0,t.g2)("loader-spinner");return(0,t.uX)(),(0,t.CE)("div",{class:(0,f.C4)(["d-backdrop",C.$style.loader])},[(0,t.bF)(et,{size:32,"line-size":2,"line-bg-color":"transparent","line-fg-color":"#fff"})],2)}var A=e(743161);const E={name:"DialogLoader",components:{LoaderSpinner:A.A}};var d=e(616208),B=e.n(d),W=e(938793);const H={};H.$style=B();const it=(0,W.A)(E,[["render",c],["__cssModules",H]]);function rt(C,R,X,k,z,K){return(0,t.uX)(),(0,t.CE)("div")}var dt=e(459356);const tt={name:"DialogLoaderFailure",created(){(0,dt.O)().displayError({error:this.$t("flat:offline.err-loading-page")})}},D=(0,W.A)(tt,[["render",rt]]),w=C=>(0,t.$V)({loader:C,loadingComponent:it,errorComponent:D})}}]);})();


//# debugId=f36c5ad7-22ff-5b54-bc16-59c10694df3b
