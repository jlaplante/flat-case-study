"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="60cee287-1224-58f6-91e8-8f8232a5aef7")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[37798],{64994:(R,A,t)=>{t.r(A),t.d(A,{default:()=>p});var v=t(646456),x=t(990937),O=t(726042),U=t(701387),T=t(614653),I=t(800893),L=t(316610),M=t(52275),g=t(704621),f=t(42651);const m=function(s,e,c){this.init(s,e,c)};m.NAME="action.RemoveClassicHarmonyAtTimePos",m.isAuthorizedException=function(s){return s instanceof x.A};const n=m.prototype;n.name=m.NAME,n.init=function(s,e,c){(0,M.default)(s,e),(0,g.default)(s,e),this.scoreData=s,this.cancelStack=c,this.opts=e,this.localTimePos=null,this.measure=null,this.harmonyIdx=null,this.location=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){let s=!0;try{this.checkPreconditions()}catch(e){if(m.isAuthorizedException(e))s=!1;else throw e}return s},n.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos(),this.checkHarmony()},n.checkTimePos=function(){const s=this.getLocalTimePos(),e=this.getMeasure(),c=U.default.getNbDivisions(e);if(!O.default.isNumber(s)||s<0||s>=c){const a=U.default.getDpq(e);throw new v.A(s,a)}},n.checkHarmony=function(){this.fetchHarmonyIdx()},n.perform=function(){this.storeAction();const e=U.default.getClassicHarmonies(this.getMeasure())[this.getHarmonyIdx()],c=T.default.getFunction(e),a=T.default.getKindValue(e),o=T.default.getInversion(e),u=T.default.getAlter(e),E={chordFunction:c,kind:a,inversion:o,alter:u};T.default.hasSecondaryFunction(e)&&(E.secondaryFunction=T.default.getSecondaryFunction(e),E.secondaryAlter=T.default.getSecondaryAlter(e),E.secondaryKind=T.default.getSecondaryKind(e),E.secondaryInversion=T.default.getSecondaryInversion(e)),this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeClassicHarmony(),this.updateStack(E)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos}};this.cancelStack.storeAction(e)}},n.removeClassicHarmony=function(){const s=this.getHarmonyIdx(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:s};new I.A(this.scoreData,e,this.cancelStack).perform()},n.getHarmonyIdx=function(){return this.harmonyIdx===null&&this.fetchHarmonyIdx(),this.harmonyIdx},n.fetchHarmonyIdx=function(){this.harmonyIdx=null;const s=this.getMeasure();if(U.default.getClassicHarmonies(s).some(this.checkHarmonyTimePos,this),this.harmonyIdx===null){const c=this.getLocalTimePos(),a=U.default.getDpq(s);throw new x.A(c,a)}},n.checkHarmonyTimePos=function(s,e){const c=this.getLocalTimePos(),a=T.default.getTimePos(s);return a<c?!1:(a===c&&(this.harmonyIdx=e),!0)},n.getLocalTimePos=function(){if(this.localTimePos===null){const s=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,s)}return this.localTimePos},n.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},n.updateStack=function(s){const e=this.getLocation(),c={partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,alter:s.alter,chordFunction:s.chordFunction,kind:s.kind,inversion:s.inversion};s.secondaryFunction&&(c.secondaryFunction=s.secondaryFunction,c.secondaryAlter=s.secondaryAlter,c.secondaryKind=s.secondaryKind,c.secondaryInversion=s.secondaryInversion);const a={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(a)},n.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:s,measureUuid:e}}return this.location},(0,f.default)(m);const p=m},150892:(R,A,t)=>{t.r(A),t.d(A,{default:()=>n});var v=t(718477),x=t(726042),O=t(614653),U=t(701387),T=t(64994),I=t(800893),L=t(52275),M=t(704621),g=t(42651);const f=function(p,s,e){this.init(p,s,e)};f.NAME="action.RemoveClassicHarmonyAtIdx";const m=f.prototype;m.name=f.NAME,m.init=function(p,s,e){(0,L.default)(p,s),(0,M.default)(p,s),this.scoreData=p,this.cancelStack=e,this.opts=s,this.location=null},m.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkHarmonyIdx()},m.checkHarmonyIdx=function(){const p=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),s=U.default.getNbClassicHarmonies(p),e=this.opts.harmonyIdx;if(!x.default.isInteger(e)||e<0||e>=s)throw new v.A(e)},m.perform=function(){const s=U.default.getClassicHarmonies(this.getMeasure())[this.opts.harmonyIdx],e=O.default.getTimePos(s),c=U.default.getDpq(this.getMeasure()),a=O.default.getFunction(s),o=O.default.getKindValue(s),u=O.default.getInversion(s);this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(e,c),this.removeClassicHarmony(),this.updateStack(e,c,a,o,u)},m.storeAction=function(p,s){if(!this.cancelStack.hasAction()){const e=this.getLocation(),c={actionName:T.default.NAME,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,dpq:s,timePos:p}};this.cancelStack.storeAction(c)}},m.removeClassicHarmony=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:this.opts.harmonyIdx};new I.A(this.scoreData,p,this.cancelStack).perform()},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},m.updateStack=function(p,s,e,c,a){const o=this.getLocation(),u={type:T.default.NAME,noDraw:!0,opts:{partUuid:o.partUuid,measureUuid:o.measureUuid,timePos:p,dpq:s,chordFunction:e,kind:c,inversion:a}};this.cancelStack.push(u)},m.getLocation=function(){if(this.location===null){const p=this.scoreData.getPartUuid(this.opts.partIdx),s=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:p,measureUuid:s}}return this.location},(0,g.default)(f);const n=f},365479:(R,A,t)=>{t.r(A),t.d(A,{default:()=>a});var v=t(153271),x=t(857552),O=t(661e3),U=t(195446),T=t(443749),I=t(701387),L=t(364596),M=t(726042),g=t(67271),f=t(52275),m=t(407819),n=t(640021),p=t(783177),s=t(42651);const e=function(o,u,E){this.init(o,u,E)};e.NAME="action.SetKey";const c=e.prototype;c.name=e.NAME,c.init=function(o,u,E){(0,f.default)(o,u),(0,m.default)(o,u),(0,n.default)(o,u),(0,p.default)(o,u),this.scoreData=o,this.cancelStack=E,this.opts=u,this.location=null},c.checkPreconditions=function(){L.default.check(this.opts.key),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentKey()},c.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new U.default},c.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const o=this.opts.startMeasureIdx,u=this.opts.stopMeasureIdx;if(u-o<0)throw new x.default(x.default.MEASURE,o,u);const l=this.getFirstMeasure(),P=I.default.getNbStaves(l),S=this.opts.staffIdx;if(!M.default.isInteger(S)||S<0||S>=P)throw new T.default(S,T.default.GET)},c.checkMeasureIdx=function(o){const u=this.scoreData.getNbMeasures();if(!M.default.isInteger(o)||o<0||o>=u)throw new v.default(o,v.default.GET)},c.checkDifferentKey=function(){if(!this.hasSomeDifferent())throw new O.default(O.default.KEY)},c.hasSomeDifferent=function(){for(let o=this.opts.startMeasureIdx;o<=this.opts.stopMeasureIdx;o++){const u=this.getKey(o);if(!L.default.isSame(u,this.opts.key))return!0}return!1},c.getKey=function(o){const u=this.scoreData.getMeasure(this.opts.partIdx,o);return I.default.getWrappedKey(u).getEntry(this.opts.staffIdx)},c.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setKey()},c.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),u=o.measureUuids.slice(),E=L.default.copy(this.opts.key),l={actionName:this.name,opts:{partUuid:o.partUuid,measureUuids:u,staffUuid:o.staffUuid,key:E}};this.cancelStack.storeAction(l)}},c.getLocation=function(){if(this.location===null){const o=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),u=this.scoreData.getPartUuid(this.opts.partIdx),E=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:u,measureUuids:o,staffUuid:E}}return this.location},c.setKey=function(){const o=L.default.copy(this.opts.key),u={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,key:o};new g.default(this.scoreData,u,this.cancelStack).perform()},(0,s.default)(e);const a=e},389603:(R,A,t)=>{t.r(A),t.d(A,{default:()=>p});var v=t(162977),x=t(646456),O=t(701387),U=t(726042),T=t(515819),I=t(704621),L=t(999874),M=t(245770),g=t(25087),f=t(42651);const m=function(s,e,c){this.init(s,e,c)};m.NAME="action.RemoveTempoChangeAtTimePos";const n=m.prototype;n.name=m.NAME,n.init=function(s,e,c){(0,I.default)(s,e),this.scoreData=s,this.cancelStack=c,this.opts=e,this.measureData=null,this.location=null},n.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},n.checkLocation=function(){this.scoreData.checkMeasureIdx(this.opts.measureIdx)},n.checkTimePos=function(){const s=this.opts.timePos,e=this.opts.dpq;if(!U.default.isInteger(s)||s<0)throw new x.A(s,e);if(!U.default.isInteger(e)||e<1)throw new x.A(s,e);const c=this.getMeasure(),a=O.default.getQuarterDuration(c);if(T.default.divisionsToQuarter(s,e)>=a)throw new x.A(s,e)},n.getMeasure=function(){return this.scoreData.getMeasure(0,this.opts.measureIdx)},n.checkExistence=function(){if(!this.hasTempoChange())throw new v.A},n.hasTempoChange=function(){const s=this.getCommonContent(),e=s.getTempoChanges(this.opts.measureIdx),c=s.getLeftTempoChange(this.opts.measureIdx);return(0,M.A)(c,e,this.opts.timePos,this.opts.dpq)!==null},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const s=this.getPreviousData();this.removeTempoChange(),this.updateStack(s)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{measureUuid:s.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(e)}},n.getPreviousData=function(){const s=this.getCommonContent(),e=(0,L.A)(s,this.opts.measureIdx,this.opts.timePos,this.opts.dpq),c=this.scoreData.getMeasureUuid(e.startMeasureIdx),a=this.scoreData.getMeasureUuid(e.stopMeasureIdx);return{startMeasureUuid:c,startTimePos:e.startTimePos,startDpq:e.startDpq,stopMeasureUuid:a,stopTimePos:e.stopTimePos,stopDpq:e.stopDpq,type:e.type}},n.getCommonContent=function(){return this.scoreData.getCommonContent()},n.removeTempoChange=function(){const s={measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new g.A(this.scoreData,s,this.cancelStack).perform()},n.updateStack=function(s){const e={type:this.name,noDraw:!0,opts:{startMeasureUuid:s.startMeasureUuid,startTimePos:s.startTimePos,startDpq:s.startDpq,stopMeasureUuid:s.stopMeasureUuid,stopTimePos:s.stopTimePos,stopDpq:s.stopDpq,type:s.type}};this.cancelStack.push(e)},n.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(0),e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:s,measureUuid:e}}return this.location},(0,f.default)(m);const p=m},474188:(R,A,t)=>{t.r(A),t.d(A,{default:()=>C});var v=t(364842),x=t(883782),O=t(737296),U=t(737903),T=t(292681),I=t(209175),L=t(123491),M=t(890985),g=t(404747),f=t(831121),m=t(2835),n=t(52275),p=t(704621),s=t(981801),e=t(783177),c=t(19850),a=t(655035),o=t(59377),u=t(551303),E=t(676611),l=t(793317),P=t(33674),S=t(972913),d=t(244138),_=t(519405),i=t(42651);const r=function(D,y,B){this.init(D,y,B)};r.NAME="action.AddSingleNotePercu";const h=r.prototype;h.name=r.NAME,h.initMeasureData=l.default,h.init=function(D,y,B){(0,n.default)(D,y),(0,p.default)(D,y),(0,s.default)(D,y),(0,e.default)(D,y),this.initMeasureData(D,y),this.cancelStack=B,this.temporaryStack=null,this.opts=y,this.location=null},h.checkPreconditions=function(){this.checkCommonElements(),this.checkTimeLocation(),this.checkSpace(),this.isVoiceDisplayed()||this.displayVoice(),this.hasNoteIdx()||this.inferNoteIdx()},h.checkCommonElements=function(){this.checkUnpitched(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),(0,S.default)(this.opts),this.sanitize(),this.checkInstrument(),this.fillHeadIfMissing()},h.checkUnpitched=function(){(0,f.default)(this.measureData)},h.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new x.default(this.opts.voiceIdx)},h.checkCompatibleVoiceStaffIdx=function(){(0,P.default)(this.measureData,this.opts)},h.sanitize=function(){typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts),typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=O.default.REPLACE)},h.checkInstrument=function(){(0,g.A)(this.measureData,this.opts)},h.fillHeadIfMissing=function(){typeof this.opts.notehead=="undefined"&&(this.opts.notehead=(0,a.default)(this.measureData,this.opts.partIdx,this.opts.unpitched))},h.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else if(this.hasNoteIdx())this.checkNoteIdx();else throw new v.default("Unexpected")},h.hasTimePos=function(){return typeof this.opts.timePos=="number"&&typeof this.opts.divisions=="number"&&typeof this.opts.timeModif!="undefined"},h.checkTimePos=function(){const D=this.measureData.getMeasure();(0,d.default)(D,this.opts.timePos,this.opts.divisions)},h.hasNoteIdx=function(){return typeof this.opts.noteIdx=="number"},h.checkNoteIdx=function(){const D=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.insertMode===O.default.REPLACE)D.checkNoteIdx(this.opts.noteIdx);else if(this.opts.insertMode===O.default.INSERT)D.checkInsertionIdx(this.opts.noteIdx);else throw new v.default("unreachable")},h.checkSpace=function(){(0,M.A)(this.measureData,this.opts)},h.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},h.displayVoice=function(){const D={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},y=this.getTemporaryStack(),B=new u.default(this.measureData,D,y);(0,_.default)(B)},h.inferNoteIdx=function(){const D=this.getTemporaryStack();(0,c.default)(this.measureData,this.opts,D)},h.getTemporaryStack=function(){return this.temporaryStack===null&&(this.temporaryStack=new o.default(`${this.name}.checkPreconditions`)),this.temporaryStack},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.temporaryStack!==null&&this.cancelStack.push(this.temporaryStack),this.storeAction();const D=(0,U.default)(this.opts);new E.A(this.measureData,D,this.cancelStack).perform(),this.updateStack()},h.storeAction=function(){if(!this.cancelStack.hasAction()){const D=this.getLocation(),y=T.default.copy(this.opts.unpitched),B=I.default.copy(D.timeModif),K={actionName:this.name,opts:{partUuid:D.partUuid,measureUuid:D.measureUuid,voiceUuid:D.voiceUuid,staffUuid:D.staffUuid,divisions:D.dpq,timePos:D.timePos,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:y,notehead:this.opts.notehead,insertMode:this.opts.insertMode,timeModif:B}};this.cancelStack.storeAction(K)}},h.updateStack=function(){const D=this.getLocation(),y={type:this.name,noDraw:!0,opts:{partUuid:D.partUuid,measureUuid:D.measureUuid,voiceUuid:D.voiceUuid,timePos:D.timePos,divisions:D.dpq,unpitched:T.default.copy(this.opts.unpitched),insertMode:this.opts.insertMode}};this.cancelStack.push(y)},h.getLocation=function(){if(this.location===null){const D=this.measureData.getScoreData(),y=D.getPartUuid(this.opts.partIdx),B=D.getMeasureUuid(this.opts.measureIdx),K=D.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),j=D.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),k=this.measureData.getDpqValue(),W=this.measureData.getVoice(this.opts.voiceIdx),N=W.getNote(this.opts.noteIdx);let V=L.default.getTimeModif(N);V=I.default.copy(V);const F=W.getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:y,measureUuid:B,staffUuid:K,voiceUuid:j,dpq:k,timePos:F,timeModif:V}}return this.location},(0,i.default)(r);const C=r},491531:(R,A,t)=>{t.r(A),t.d(A,{default:()=>i});var v=t(364842),x=t(195446),O=t(883782),U=t(351277),T=t(614426),I=t(793317),L=t(19405),M=t(972913),g=t(610860),f=t(476031),m=t(33674),n=t(890985),p=t(573559),s=t(714898),e=t(244138),c=t(19850),a=t(8963),o=t(519405),u=t(59377),E=t(671863),l=t(551303),P=t(42651),S=t(737296);const d=function(r,h,C){this.init(r,h,C)};d.NAME="action.AddSingleNote";const _=d.prototype;_.name=d.NAME,_.initMeasureData=I.default,_.init=function(r,h,C){this.initMeasureData(r,h),this.cancelStack=C,this.temporaryStack=null,this.opts=h},_.checkPreconditions=function(){this.checkCommonElements(),this.checkTimeLocation(),this.checkSpace(),this.isVoiceDisplayed()||this.displayVoice(),this.hasNoteIdx()||this.inferNoteIdx(),this.postCheckSanitize()},_.checkCommonElements=function(){this.checkValues(),this.checkPitchedPart(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),this.sanitize(),this.checkPitch(),this.opts.checkLine&&(0,p.A)(this.measureData,this.opts),(0,a.A)(this.measureData,this.opts)},_.checkValues=function(){(0,M.default)(this.opts),(0,L.default)(this.opts),this.opts.accidental!==null&&T.default.check(this.opts.accidental)},_.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new x.default},_.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new O.default(this.opts.voiceIdx)},_.checkCompatibleVoiceStaffIdx=function(){(0,m.default)(this.measureData,this.opts)},_.sanitize=function(){typeof this.opts.line!="undefined"&&(0,f.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,s.default)(this.measureData,this.opts),typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=S.default.REPLACE),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0)},_.checkPitch=function(){U.default.check(this.opts.pitch)},_.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else if(this.hasNoteIdx())this.checkNoteIdx();else throw new v.default("Unexpected")},_.hasTimePos=function(){return typeof this.opts.timePos=="number"&&typeof this.opts.divisions=="number"&&typeof this.opts.timeModif!="undefined"},_.checkTimePos=function(){const r=this.measureData.getMeasure();(0,e.default)(r,this.opts.timePos,this.opts.divisions)},_.hasNoteIdx=function(){return typeof this.opts.noteIdx=="number"},_.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},_.checkSpace=function(){(0,n.A)(this.measureData,this.opts)},_.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},_.displayVoice=function(){const r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},h=this.getTemporaryStack(),C=new l.default(this.measureData,r,h);(0,o.default)(C)},_.inferNoteIdx=function(){const r=this.getTemporaryStack();(0,c.default)(this.measureData,this.opts,r)},_.getTemporaryStack=function(){return this.temporaryStack===null&&(this.temporaryStack=new u.default(`${this.name}.checkPreconditions`)),this.temporaryStack},_.postCheckSanitize=function(){(0,g.A)(this.measureData,this.opts)},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.temporaryStack!==null&&this.cancelStack.push(this.temporaryStack);const r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:U.default.copy(this.opts.pitch),fretData:this.opts.fretData,insertMode:this.opts.insertMode,checkLine:this.opts.checkLine,keepFormer:this.opts.keepFormer,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new E.A(this.measureData,r,this.cancelStack).perform()},(0,P.default)(d);const i=d},529724:(R,A,t)=>{t.r(A),t.d(A,{default:()=>c});var v=t(153271),x=t(661e3),O=t(857552),U=t(270259),T=t(701387),I=t(518558),L=t(726042),M=t(74446),g=t(655469),f=t(954361),m=t(407819),n=t(813263),p=t(42651);const s=function(a,o,u){this.init(a,o,u)};s.NAME="action.SetTimeSegment";const e=s.prototype;e.name=s.NAME,e.init=function(a,o,u){(0,m.default)(a,o),this.scoreData=a,this.cancelStack=u,this.opts=o,this.firstTime=null,this.location=null,typeof this.opts.displayedTime=="undefined"&&(this.opts.displayedTime=I.default.copy(this.opts.timeSignature)),typeof this.opts.beatsList=="undefined"&&(this.opts.beatsList=(0,n.default)(this.opts.timeSignature)),typeof this.opts.restsInsideBeams=="undefined"&&(this.opts.restsInsideBeams=!1)},e.checkPreconditions=function(){I.default.check(this.opts.timeSignature),I.default.check(this.opts.displayedTime);const a=I.default.getNbBeats(this.opts.timeSignature);M.default.check(this.opts.beatsList,a),this.checkLocation(),this.checkDifferentTime(),this.checkCurrentConsistent()},e.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const a=this.opts.startMeasureIdx,o=this.opts.stopMeasureIdx;if(o-a<0)throw new O.default(O.default.MEASURE,a,o)},e.checkMeasureIdx=function(a){const o=this.scoreData.getNbMeasures();if(!L.default.isInteger(a)||a<0||a>=o)throw new v.default(a,v.default.GET)},e.checkDifferentTime=function(){const a=this.getFirstTime(),o=this.opts.timeSignature,u=this.getFirstDisplayedTime(),E=this.opts.displayedTime,l=this.getFirstBeatsList(),P=this.opts.beatsList,S=this.getFirstRestsInsideBeams(),d=this.opts.restsInsideBeams;if(I.default.isSame(o,a)&&I.default.isSame(E,u)&&M.default.isSame(P,l)&&S===d)throw new x.default(x.default.TIME,I.default.copy(a),I.default.copy(o))},e.checkCurrentConsistent=function(){const a=this.scoreData.getCommonContent(),o=this.getFirstDisplayedTime(),u=this.getFirstTime(),E=this.getFirstBeatsList(),l=this.getFirstRestsInsideBeams();for(let P=this.opts.startMeasureIdx+1;P<=this.opts.stopMeasureIdx;P++){const S=this.getTime(P),d=a.getDisplayedTime(P),_=a.getBeatsList(P),i=a.hasRestsInsideBeams(P);if(!I.default.isSame(S,u)||!I.default.isSame(d,o)||!M.default.isSame(_,E)||i!==l)throw new U.A(U.A.TIME)}},e.getFirstDisplayedTime=function(){return this.scoreData.getCommonContent().getDisplayedTime(this.opts.startMeasureIdx)},e.getFirstBeatsList=function(){return this.scoreData.getCommonContent().getBeatsList(this.opts.startMeasureIdx)},e.getFirstRestsInsideBeams=function(){return this.scoreData.getCommonContent().hasRestsInsideBeams(this.opts.startMeasureIdx)},e.getFirstTime=function(){return this.firstTime===null&&(this.firstTime=this.getTime(this.opts.startMeasureIdx)),this.firstTime},e.getTime=function(a){const o=this.scoreData.getMeasure(0,a);return T.default.getWrappedTime(o).getAnyEntry()},e.getFirstMeasure=function(){return this.scoreData.getMeasure(0,this.opts.startMeasureIdx)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();let a=this.getFirstTime();a=I.default.copy(a);let o=this.getFirstDisplayedTime();o=I.default.copy(o);let u=this.getFirstBeatsList();u=M.default.copy(u);const E=this.getFirstRestsInsideBeams();this.setTimeSegment(),this.updateStack(a,o,u,E),this.formatContent()},e.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation().measureUuids.slice(),u=I.default.copy(this.opts.timeSignature),E=I.default.copy(this.opts.displayedTime),l=M.default.copy(this.opts.beatsList),P=this.opts.restsInsideBeams,S={actionName:this.name,opts:{measureUuids:o,timeSignature:u,displayedTime:E,beatsList:l,restsInsideBeams:P}};this.cancelStack.storeAction(S)}},e.setTimeSegment=function(){const a=I.default.copy(this.opts.timeSignature),o=I.default.copy(this.opts.displayedTime),u=M.default.copy(this.opts.beatsList),E=this.opts.restsInsideBeams,l={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,timeSignature:a,displayedTime:o,beatsList:u,restsInsideBeams:E};new g.A(this.scoreData,l,this.cancelStack).perform()},e.updateStack=function(a,o,u,E){const P=this.getLocation().measureUuids.slice(),S=I.default.copy(this.opts.timeSignature),d=I.default.copy(this.opts.displayedTime),_=M.default.copy(this.opts.beatsList),i=this.opts.restsInsideBeams,r={type:this.name,noDraw:!0,opts:{measureUuids:P,previousTime:a,previousDisplayedTime:o,previousBeatsList:u,previousRestsInsideBeams:E,newTime:S,newDisplayedTime:d,newBeatsList:_,newRestsInsideBeams:i}};this.cancelStack.push(r)},e.getLocation=function(){if(this.location===null){const a=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:a}}return this.location},e.formatContent=function(){let a=this.opts.startMeasureIdx;for(;a<=this.opts.stopMeasureIdx;a++){const o=this.scoreData.getNbParts();for(let u=0;u<o;u++){const E={partIdx:u,measureIdx:a};new f.A(this.scoreData,E,this.cancelStack).perform()}}},(0,p.default)(s);const c=s},551303:(R,A,t)=>{t.r(A),t.d(A,{default:()=>m});var v=t(31278),x=t(883782),O=t(11076),U=t(793317),T=t(52275),I=t(704621),L=t(981801),M=t(42651);const g=function(n,p,s){this.init(n,p,s)};g.NAME="action.ShowMeasureVoices";const f=g.prototype;f.name=g.NAME,f.initMeasureData=U.default,f.init=function(n,p,s){(0,T.default)(n,p),(0,I.default)(n,p),(0,L.default)(n,p),this.initMeasureData(n,p),this.cancelStack=s,this.opts=p,this.location=null},f.checkPreconditions=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new x.default(this.opts.voiceIdx);if(this.measureData.hasVoice(this.opts.voiceIdx))throw new v.default},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.showMeasureVoice(),this.updateStack()},f.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),p={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid},s={actionName:this.name,opts:p};this.cancelStack.storeAction(s)}},f.showMeasureVoice=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new O.A(this.measureData,n,this.cancelStack).perform()},f.updateStack=function(){const n=this.getLocation(),p={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid},s={type:this.name,noDraw:!0,opts:p};this.cancelStack.push(s)},f.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),p=n.getPartUuid(this.opts.partIdx),s=n.getMeasureUuid(this.opts.measureIdx),e=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx);this.location={partUuid:p,measureUuid:s,voiceUuid:e}}return this.location},(0,M.default)(g);const m=g},606752:(R,A,t)=>{t.r(A),t.d(A,{default:()=>f});var v=t(99923),x=t(818880),O=t(721247),U=t(364596),T=t(737903),I=t(104907),L=t(42651);const M=function(m,n,p){this.init(m,n,p)};M.NAME="action.AddStaffPercu";const g=M.prototype;g.name=M.NAME,g.init=function(m,n,p){this.scoreData=m,this.cancelStack=p,this.opts=n,this.action=null},g.checkPreconditions=function(){if(!this.scoreData.isPartUnpitched(this.opts.partIdx))throw new v.A;this.getAction().checkPreconditions()},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const m=this.getAction();m.cancelStack=this.cancelStack,m.perform()},g.getAction=function(){if(this.action===null){const m=(0,T.default)(this.opts);m.clef=O.default.createPercussion(),m.key=U.default.createC(),m.staffDetails={},I.default.setNbStaffLines(m.staffDetails,this.opts.nbStaffLines),this.action=new x.default(this.scoreData,m,this.cancelStack)}return this.action},(0,L.default)(M);const f=M},818880:(R,A,t)=>{t.r(A),t.d(A,{default:()=>_});var v=t(443749),x=t(195446),O=t(276265),U=t(857579),T=t(80465),I=t(275646),L=t(726042),M=t(383279),g=t(446921),f=t(701387),m=t(721247),n=t(364596),p=t(518558),s=t(377180),e=t(104907),c=t(35802),a=t(123491),o=t(737903),u=t(843678),E=t(42651);const l=function(i,r,h){this.init(i,r,h)};l.NAME="action.AddStaffCreation";const P=l.prototype;P.name=l.NAME,P.init=function(i,r,h){this.scoreData=i,this.cancelStack=h,this.opts=r,this.needUpdateNotesStaffIdx=!1,this.sanitized=!1},P.checkPreconditions=function(){const i=this.scoreData.getPartContent(this.opts.partIdx),r=g.A.getNbStaves(i),h=this.opts.staffIdx;if(h<0||h>r)throw new v.default(h,v.default.INSERT);m.default.check(this.opts.clef),typeof this.opts.key!="undefined"?n.default.check(this.opts.key):n.default.check(this.opts.concertKey),this.opts.transpose&&s.default.check(this.opts.transpose),this.opts.staffDetails&&e.default.check(this.opts.staffDetails);const C=this.opts.partIdx;this.scoreData.isPartUnpitched(C)&&this.checkUnpitchedOpts(),this.sanitizeIfNeeded(),this.checkVoicesData()},P.checkUnpitchedOpts=function(){if(!n.default.isC(this.opts.key)||!m.default.isPercussion(this.opts.clef)||typeof this.opts.transpose!="undefined"&&!s.default.isIdentity(this.opts.transpose))throw new x.default},P.checkVoicesData=function(){(0,I.A)(this.scoreData,this.opts.partIdx,this.opts.voicesData)},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.opts.concertKey&&this.convertConcertKey(),this.updatePartHeader();const i=this.scoreData.getPartContent(this.opts.partIdx),r=g.A.getMeasures(i),h=r[0],C=r.slice(1);this.updateFirstMeasure(h),this.updateOtherMeasures(C),this.updateOwnTimeSignatures(r),this.updateStack()},P.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.voicesData=="undefined"&&this.generateVoicesData(),this.sanitized=!0)},P.generateVoicesData=function(){this.opts.voicesData=(0,T.A)(this.scoreData,this.opts.partIdx)},P.convertConcertKey=function(){let i;typeof this.opts.transpose!="undefined"?i=this.opts.transpose:i=s.default.createDefault(),this.opts.key=n.default.reverseTranspose(this.opts.concertKey,i)},P.updatePartHeader=function(){const i=this.scoreData.getPartHeader(this.opts.partIdx),r=M.default.getStaffMapping(i),h=(0,o.default)(this.opts.voicesData);h.staffUuid=this.opts.staffUuid,r.splice(this.opts.staffIdx,0,h),M.default.setStaffMapping(i,r);const C=M.default.getVoiceMapping(i);this.updateVoiceMapping(C),M.default.setVoiceMapping(i,C),u.default.forEach(this.opts.voiceIdxToUuidMapping,d,i)},P.updateVoiceMapping=function(i){u.default.forEach(i,this.updateVoiceMappingEntry,this);const r={voiceMapping:i,staffIdx:this.opts.staffIdx};this.opts.voicesData.voices.forEach(S,r)},P.updateVoiceMappingEntry=function(i,r,h){r=r.map(this.updateVoiceStaff,this),h[i]=r},P.updateVoiceStaff=function(i){return i<this.opts.staffIdx?i:(this.needUpdateNotesStaffIdx=!0,i+1)};const S=function(i){const r=this;r.voiceMapping[i]=[r.staffIdx]},d=function(i,r){const h=this;i=L.default.intPart(i),M.default.recordVoiceUuid(h,i,r)};P.updateFirstMeasure=function(i){this.fillAttributes(i),this.fillOwnAttributes(i);const r=f.default.getNbStaves(i);f.default.setOwnNbStaves(i,r+1),this.shiftMeasureNotesStaffIdxIfNeeded(i),this.addVoice(i,0)},P.updateOtherMeasures=function(i){i.forEach(this.updateOtherMeasure,this)},P.updateOtherMeasure=function(i,r){this.fillAttributes(i),this.fillEmptyOwnAttributes(i);const h=f.default.getNbStaves(i);f.default.setNbStaves(i,h+1),this.shiftMeasureNotesStaffIdxIfNeeded(i);const C=r+1;this.addVoice(i,C)},P.fillAttributes=function(i){const r={getAttributes:f.default.getAttributes,getWrappedTime:f.default.getWrappedTime,getWrappedClef:f.default.getWrappedClef,getWrappedKey:f.default.getWrappedKey,getWrappedTranspose:f.default.getWrappedTranspose,getWrappedStaffDetails:f.default.getWrappedStaffDetails,setAttributes:f.default.setAttributes},h=(0,o.default)(this.opts);typeof h.transpose=="undefined"&&(h.transpose=s.default.createDefault()),typeof h.staffDetails=="undefined"&&(h.staffDetails=e.default.createDefault()),this.fillAttributesContent(i,r,h)},P.fillOwnAttributes=function(i){const r={getAttributes:f.default.getOwnAttributes,getWrappedTime:f.default.getWrappedOwnTime,getWrappedClef:f.default.getWrappedOwnClef,getWrappedKey:f.default.getWrappedOwnKey,getWrappedTranspose:f.default.getWrappedOwnTranspose,getWrappedStaffDetails:f.default.getWrappedOwnStaffDetails,setAttributes:f.default.setOwnAttributes};this.fillAttributesContent(i,r,this.opts)},P.fillAttributesContent=function(i,r,h){const C=r.getAttributes(i),D=r.getWrappedTime(i),y=(0,o.default)(D.getAnyEntry());D.insertEntry(y,this.opts.staffIdx);const B=D.dumpAttribute();c.default.setTime(C,B);const K=r.getWrappedClef(i),j=(0,o.default)(h.clef);K.insertEntry(j,this.opts.staffIdx);const k=K.dumpAttribute();c.default.setClef(C,k);const W=r.getWrappedKey(i),N=(0,o.default)(h.key);W.insertEntry(N,this.opts.staffIdx);const V=W.dumpAttribute();c.default.setKey(C,V);const F=r.getWrappedTranspose(i),G=h.transpose?(0,o.default)(h.transpose):null;F.insertEntry(G,this.opts.staffIdx);const z=F.dumpAttribute();c.default.setTranspose(C,z);const H=r.getWrappedStaffDetails(i),X=h.staffDetails?(0,o.default)(h.staffDetails):null;H.insertEntry(X,this.opts.staffIdx);const Q=H.dumpAttribute();c.default.setStaffDetails(C,Q),r.setAttributes(i,C)},P.fillEmptyOwnAttributes=function(i){const r=f.default.getOwnAttributes(i),h=f.default.getWrappedOwnTime(i);h.insertEntry(null,this.opts.staffIdx);const C=h.dumpAttribute();c.default.setTime(r,C);const D=f.default.getWrappedOwnClef(i);D.insertEntry(null,this.opts.staffIdx);const y=D.dumpAttribute();c.default.setClef(r,y);const B=f.default.getWrappedOwnKey(i);B.insertEntry(null,this.opts.staffIdx);const K=B.dumpAttribute();c.default.setKey(r,K);const j=f.default.getWrappedOwnTranspose(i);j.insertEntry(null,this.opts.staffIdx);const k=j.dumpAttribute();c.default.setTranspose(r,k);const W=f.default.getWrappedOwnStaffDetails(i);W.insertEntry(null,this.opts.staffIdx);const N=W.dumpAttribute();c.default.setStaffDetails(r,N),f.default.setOwnAttributes(i,r)},P.shiftMeasureNotesStaffIdxIfNeeded=function(i){this.needUpdateNotesStaffIdx&&f.default.getNotes(i).forEach(this.shiftNoteStaffIdx,this)},P.shiftNoteStaffIdx=function(i){let r=a.default.getStaffIdx(i);r>=this.opts.staffIdx&&(r++,a.default.setStaffIdx(i,r))},P.addVoice=function(i,r){const h=new U.A(i),C=h.getVoicesList();this.opts.voicesData.voices.forEach(function(D){C.insertVoice(D);const y={partIdx:this.opts.partIdx,measureIdx:r,voiceIdx:D,staffIdx:this.opts.staffIdx};new O.A(h,y).perform()},this)},P.updateOwnTimeSignatures=function(i){const r=i.length;for(let h=1;h<r;h++){const C=i[h-1],D=i[h],B=f.default.getWrappedTime(C).getEntry(this.opts.staffIdx),j=f.default.getWrappedTime(D).getEntry(this.opts.staffIdx);if(!p.default.isSame(B,j)){const k=f.default.getWrappedOwnTime(D),W=p.default.copy(j);k.setEntry(W,this.opts.staffIdx);const N=k.dumpAttribute();f.default.setOwnTime(D,N)}}},P.updateStack=function(){const i={type:this.name,opts:{partIdx:this.opts.partIdx,voiceIdx:this.opts.staffIdx,clef:(0,o.default)(this.opts.clef),key:(0,o.default)(this.opts.key),staffDetails:this.opts.staffDetails}};this.cancelStack.push(i),this.cancelStack.stateNeedCompleteRedraw()},(0,E.default)(l);const _=l},855424:(R,A,t)=>{t.r(A),t.d(A,{default:()=>c});var v=t(718477),x=t(726042),O=t(614653),U=t(701387),T=t(529355),I=t(681670),L=t(74957),M=t(228546),g=t(820771),f=t(52275),m=t(704621),n=t(42651);const p=function(a,o,u){this.init(a,o,u)};p.NAME="action.RemoveHarmony";const s=p.prototype;s.name=p.NAME,s.init=function(a,o,u){(0,f.default)(a,o),(0,m.default)(a,o),this.scoreData=a,this.cancelStack=u,this.opts=o,this.location=null},s.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkHarmonyIdx()},s.checkHarmonyIdx=function(){const a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),o=U.default.getNbJazzHarmonies(a),u=this.opts.harmonyIdx;if(!x.default.isInteger(u)||u<0||u>=o)throw new v.A(u)},s.perform=function(){const o=U.default.getJazzHarmonies(this.getMeasure())[this.opts.harmonyIdx],u=O.default.getTimePos(o),E=U.default.getDpq(this.getMeasure()),l=O.default.getRoot(o),P=O.default.getKindValue(o),S=e(o);let d=O.default.getDegrees(o);d=d.map(L.A.copy),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(u,E),this.removeHarmony(),this.updateStack(u,E,l,P,S,d)};const e=function(a){if(O.default.hasBass(a)){let o=O.default.getBass(a);return o=I.A.copy(o),o}else return null};s.storeAction=function(a,o){if(!this.cancelStack.hasAction()){const u=this.getLocation(),E={actionName:M.default.NAME,opts:{partUuid:u.partUuid,measureUuid:u.measureUuid,dpq:o,timePos:a}};this.cancelStack.storeAction(E)}},s.removeHarmony=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:this.opts.harmonyIdx};new g.A(this.scoreData,a,this.cancelStack).perform()},s.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},s.updateStack=function(a,o,u,E,l,P){const S=this.getLocation(),d={type:M.default.NAME,noDraw:!0,opts:{partUuid:S.partUuid,measureUuid:S.measureUuid,timePos:a,dpq:o,root:T.A.copy(u),kind:E,bass:l,degrees:P}};this.cancelStack.push(d)},s.getLocation=function(){if(this.location===null){const a=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:o}}return this.location},(0,n.default)(p);const c=p},886723:(R,A,t)=>{t.r(A),t.d(A,{default:()=>p});var v=t(646456),x=t(990937),O=t(726042),U=t(701387),T=t(589501),I=t(737344),L=t(316610),M=t(52275),g=t(704621),f=t(42651);const m=function(s,e,c){this.init(s,e,c)};m.NAME="action.RemoveFiguredBassAtTimePos",m.isAuthorizedException=function(s){return s instanceof x.A};const n=m.prototype;n.name=m.NAME,n.init=function(s,e,c){(0,M.default)(s,e),(0,g.default)(s,e),this.scoreData=s,this.cancelStack=c,this.opts=e,this.localTimePos=null,this.measure=null,this.figuredBassIdx=null,this.location=null},n.performIfPossible=function(){this.isPossible()&&this.perform()},n.isPossible=function(){let s=!0;try{this.checkPreconditions()}catch(e){if(m.isAuthorizedException(e))s=!1;else throw e}return s},n.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos(),this.checkFiguredBass()},n.checkTimePos=function(){const s=this.getLocalTimePos(),e=this.getMeasure(),c=U.default.getNbDivisions(e);if(!O.default.isNumber(s)||s<0||s>=c){const a=U.default.getDpq(e);throw new v.A(s,a)}},n.checkFiguredBass=function(){this.fetchFiguredBassIdx()},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=U.default.getFiguredBasses(this.getMeasure())[this.getFiguredBassIdx()],c=T.A.getFiguresData(e);this.removeFiguredBass(),this.updateStack(c)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos}};this.cancelStack.storeAction(e)}},n.removeFiguredBass=function(){const s=this.getFiguredBassIdx(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,figuredBassIdx:s};new I.A(this.scoreData,e,this.cancelStack).perform()},n.getFiguredBassIdx=function(){return this.figuredBassIdx===null&&this.fetchFiguredBassIdx(),this.figuredBassIdx},n.fetchFiguredBassIdx=function(){this.figuredBassIdx=null;const s=this.getMeasure();if(U.default.getFiguredBasses(s).some(this.checkFiguredBassTimePos,this),this.figuredBassIdx===null){const c=this.getLocalTimePos(),a=U.default.getDpq(s);throw new x.A(c,a)}},n.checkFiguredBassTimePos=function(s,e){const c=this.getLocalTimePos(),a=T.A.getTimePos(s);return a<c?!1:(a===c&&(this.figuredBassIdx=e),!0)},n.getLocalTimePos=function(){if(this.localTimePos===null){const s=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,s)}return this.localTimePos},n.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},n.updateStack=function(s){const e=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,figuresData:s}};this.cancelStack.push(c)},n.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:s,measureUuid:e}}return this.location},(0,f.default)(m);const p=m},939193:(R,A,t)=>{t.r(A),t.d(A,{default:()=>S});var v=t(278243),x=t(247739),O=t(31278),U=t(404747),T=t(831121),I=t(2835),L=t(898039),M=t(52275),g=t(704621),f=t(981801),m=t(655035),n=t(244771),p=t(737903),s=t(476943),e=t(123491),c=t(292681),a=t(104907),o=t(793317),u=t(42651);const E=function(d,_,i){this.init(d,_,i)};E.NAME="action.ChangeHeadPercu",E.isNoChange=function(d){return d instanceof O.default};const l=E.prototype;l.name=E.NAME,l.initMeasureData=o.default,l.init=function(d,_,i){(0,M.default)(d,_),(0,g.default)(d,_),(0,f.default)(d,_),this.initMeasureData(d,_),this.cancelStack=i,this.opts=_,this.sanitized=!1,this.voice=null,this.location=null,(0,L.default)(this.measureData,this.opts)},l.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkInstrument(),this.checkUpdate()},l.checkUnpitched=function(){(0,T.default)(this.measureData)},l.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},l.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},l.checkNotRest=function(){if(this.getVoice().isRest(this.opts.noteIdx))throw new v.A},l.checkPitch=function(){if(this.getChord().findIndex(P,this.opts.unpitched)===-1){const i=c.default.copy(this.opts.unpitched),r=this.opts.staffIdx||0,h=this.measureData.getStaffDetails(r),C=a.default.getNbStaffLines(h);throw new x.A(x.A.GET,i,C)}};const P=function(d){const _=e.default.getUnpitched(d),i=this;return c.default.isSameLine(_,i)};l.getChord=function(){const _=this.getVoice().getChord(this.opts.noteIdx);return s.default.makeArray(_)},l.checkInstrument=function(){(0,U.A)(this.measureData,this.opts)},l.checkUpdate=function(){const _=this.getChord().find(P,this.opts.unpitched),i=e.default.getHead(_);if(this.opts.notehead===i)throw new O.default;e.default.checkNotLocked(_)},l.perform=function(){this.sanitizeIfNeeded(),typeof this.opts.notehead=="undefined"&&(this.opts.notehead=(0,m.default)(this.measureData,this.opts.partIdx,this.opts.unpitched)),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const _=this.getChord().find(P,this.opts.unpitched),i=e.default.getHead(_),r=(0,p.default)(this.opts);new n.A(this.measureData,r,this.cancelStack).perform(),this.updateStack(i)},l.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,I.default)(this.measureData,this.opts),this.sanitized=!0)},l.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),_=c.default.copy(this.opts.unpitched),i={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,divisions:d.dpq,timePos:d.timePos,unpitched:_,notehead:this.opts.notehead}};this.cancelStack.storeAction(i)}},l.updateStack=function(d){const _=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,timePos:_.timePos,divisions:_.dpq,unpitched:c.default.copy(this.opts.unpitched),previousNotehead:d}};this.cancelStack.push(i)},l.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),_=d.getPartUuid(this.opts.partIdx),i=d.getMeasureUuid(this.opts.measureIdx),r=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),h=this.measureData.getDpqValue(),D=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:_,measureUuid:i,voiceUuid:r,dpq:h,timePos:D}}return this.location},(0,u.default)(E);const S=E},942867:(R,A,t)=>{t.r(A),t.d(A,{default:()=>S});var v=t(247739),x=t(404747),O=t(831121),U=t(2835),T=t(52275),I=t(704621),L=t(981801),M=t(783177),g=t(898039),f=t(655035),m=t(889580),n=t(737903),p=t(476943),s=t(123491),e=t(292681),c=t(104907),a=t(793317),o=t(33674),u=t(42651);const E=function(d,_,i){this.init(d,_,i)};E.NAME="action.AddToChordPercu",E.isNoChange=function(d){return d instanceof v.A&&d.action===v.A.INSERT};const l=E.prototype;l.name=E.NAME,l.initMeasureData=a.default,l.init=function(d,_,i){(0,T.default)(d,_),(0,I.default)(d,_),(0,L.default)(d,_),(0,M.default)(d,_),this.initMeasureData(d,_),this.cancelStack=i,this.opts=_,this.sanitized=!1,this.voice=null,this.location=null,(0,g.default)(this.measureData,this.opts)},l.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkInstrument()},l.checkUnpitched=function(){(0,O.default)(this.measureData)},l.checkCompatibleVoiceStaffIdx=function(){(0,o.default)(this.measureData,this.opts)},l.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},l.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},l.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},l.checkPitch=function(){if(this.getChord().findIndex(P,this.opts.unpitched)!==-1){const i=e.default.copy(this.opts.unpitched),r=this.measureData.getStaffDetails(this.opts.staffIdx),h=c.default.getNbStaffLines(r);throw new v.A(v.A.INSERT,i,h)}};const P=function(d){const _=s.default.getUnpitched(d),i=this;return e.default.isSameLine(_,i)};l.getChord=function(){const _=this.getVoice().getChord(this.opts.noteIdx);return p.default.makeArray(_)},l.checkInstrument=function(){(0,x.A)(this.measureData,this.opts)},l.perform=function(){this.sanitizeIfNeeded(),typeof this.opts.notehead=="undefined"&&(this.opts.notehead=(0,f.default)(this.measureData,this.opts.partIdx,this.opts.unpitched)),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const d=(0,n.default)(this.opts);new m.A(this.measureData,d,this.cancelStack).perform(),this.updateStack()},l.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,U.default)(this.measureData,this.opts),this.sanitized=!0)},l.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),_=e.default.copy(this.opts.unpitched),i={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,staffUuid:d.staffUuid,divisions:d.dpq,timePos:d.timePos,unpitched:_,notehead:this.opts.notehead}};this.cancelStack.storeAction(i)}},l.updateStack=function(){const d=this.getLocation(),_={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq,unpitched:e.default.copy(this.opts.unpitched)}};this.cancelStack.push(_)},l.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),_=d.getPartUuid(this.opts.partIdx),i=d.getMeasureUuid(this.opts.measureIdx),r=d.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),h=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),C=this.measureData.getDpqValue(),y=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:_,measureUuid:i,voiceUuid:h,staffUuid:r,dpq:C,timePos:y}}return this.location},(0,u.default)(E);const S=E}}]);})();


//# debugId=60cee287-1224-58f6-91e8-8f8232a5aef7
