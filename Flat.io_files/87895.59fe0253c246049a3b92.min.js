"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="24cbb888-840c-5437-acac-4045aff68290")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[87895],{13302:(N,M,t)=>{t.r(M),t.d(M,{default:()=>U});var g=t(704621),O=t(904719),T=t(153271),I=t(49323),A=t(42651);const v=function(m,f,h){this.init(m,f,h)};v.NAME="action.RemoveJumpCall";const P=v.prototype;P.name=v.NAME,P.init=function(m,f,h){(0,g.default)(m,f),this.scoreData=m,this.opts=f,this.cancelStack=h,this.location=null},P.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},P.checkLocation=function(){const m=this.scoreData.getNbMeasures(),f=this.opts.measureIdx;if(f<0||f>=m)throw new T.default(f,T.default.GET)},P.checkExistence=function(){if(!this.getCommonContent().hasJumpCall(this.opts.measureIdx))throw new O.A},P.getCommonContent=function(){return this.scoreData.getCommonContent()},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const f=this.getCommonContent().getJumpCall(this.opts.measureIdx);this.storeAction(f),this.removeJumpCall(),this.updateStack(f)},P.updateStack=function(m){const f=this.getLocation(),h={type:this.name,noDraw:!0,opts:{measureUuid:f.measureUuid,type:m}};this.cancelStack.push(h)},P.removeJumpCall=function(){const m={measureIdx:this.opts.measureIdx};new I.A(this.scoreData,m,this.cancelStack).perform()},P.storeAction=function(m){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{measureUuid:f.measureUuid,type:m}};this.cancelStack.storeAction(h)}},P.getLocation=function(){if(this.location===null){const m=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:m}}return this.location},(0,A.default)(v);const U=v},51384:(N,M,t)=>{t.r(M),t.d(M,{default:()=>d});var g=t(443749),O=t(607682),T=t(31278),I=t(701387),A=t(838603),v=t(726042),P=t(52275),U=t(704621),m=t(783177),f=t(785440),h=t(42651);const u=function(a,r,i){this.init(a,r,i)};u.NAME="action.AddMeasureRepeat";const l=u.prototype;l.name=u.NAME,l.init=function(a,r,i){(0,P.default)(a,r),(0,U.default)(a,r),(0,m.default)(a,r),this.scoreData=a,this.cancelStack=i,this.opts=r,this.localTimePos=null,this.location=null},l.checkPreconditions=function(){this.checkLocation(),this.checkParam(),this.checkNotFirstMeasure(),this.checkSameMeasureDuration(),this.checkAlready()},l.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),r=I.default.getNbStaves(a),i=this.opts.staffIdx;if(!v.default.isInteger(i)||i<0||i>=r)throw new g.default(this.opts.staffIdx)},l.checkParam=function(){A.A.checkPatternNbMeasures(this.opts.patternNbMeasures)},l.checkNotFirstMeasure=function(){if(this.opts.measureIdx===0)throw new O.default("No previous measure to repeat","FirstOfScore")},l.checkSameMeasureDuration=function(){const a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),r=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx-1),i=I.default.getQuarterDuration(a),o=I.default.getQuarterDuration(r);if(i!==o)throw new O.default("The measure has a different duration than the previous one","DifferentMeasureDuration")},l.checkAlready=function(){const a=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(I.default.hasMeasureRepeat(a,this.opts.staffIdx))throw new T.default},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addMeasureRepeat(),this.updateStack()},l.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffUuid:a.staffUuid,patternNbMeasures:this.opts.patternNbMeasures}};this.cancelStack.storeAction(r)}},l.addMeasureRepeat=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,patternNbMeasures:this.opts.patternNbMeasures,nbSlashes:this.opts.patternNbMeasures,patternMeasureIdx:0};new f.A(this.scoreData,a,this.cancelStack).perform()},l.updateStack=function(){const a=this.getLocation(),r={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,staffUuid:a.staffUuid}};this.cancelStack.push(r)},l.getLocation=function(){if(this.location===null){const a=this.scoreData.getPartUuid(this.opts.partIdx),r=this.scoreData.getMeasureUuid(this.opts.measureIdx),i=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:a,measureUuid:r,staffUuid:i}}return this.location},(0,h.default)(u);const d=u},54890:(N,M,t)=>{t.r(M),t.d(M,{default:()=>p});var g=t(364842),O=t(227829),T=t(701387),I=t(737903),A=t(518558),v=t(364596),P=t(721247),U=t(74446),m=t(529724),f=t(873010),h=t(698649),u=t(551303),l=t(569860),d=t(925301),a=t(889346),r=t(961770),i=t(764591),o=t(324318),s=t(704621),e=t(379668),n=t(857579),c=t(852363),_=t(42651);const E=function(D,C,B){this.init(D,C,B)};E.NAME="action.RemoveMeasure";const x=E.prototype;x.name=E.NAME,x.init=function(D,C,B){this.scoreData=D,this.cancelStack=B,this.opts=C,this.uuids=null,(0,s.default)(this.scoreData,this.opts)},x.checkPreconditions=function(){if(this.scoreData.getMeasure(0,this.opts.measureIdx),this.scoreData.getPartContent(0).measure.length<=1)throw new O.A(O.A.MEASURE)},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const D=this.getPreviousNextUuids();this.storeAction(D),(0,e.A)(this.scoreData,this.opts,this.cancelStack),this.clearMeasureColumn(),this.clearNextMeasureRepeatIfNeeded(),this.recordTimeSignature(D),this.recordAttributes(D),this.recordVoices(D),this.removeMeasures(),this.removeCommonContentMeasure(),this.removeHeader(),this.wasLastMeasure()&&this.restoreFinalBarline(),this.signalAttributesUpdated(),this.updateStack(D)},x.clearMeasureColumn=function(){const D={measureIdx:this.opts.measureIdx,clearBarlines:!0};new r.A(this.scoreData,D,this.cancelStack).perform()},x.clearNextMeasureRepeatIfNeeded=function(){this.shouldClearNextMeasureRepeat()&&this.clearNextMeasureRepeat()},x.shouldClearNextMeasureRepeat=function(){if(this.opts.measureIdx===0)return!0;const D=this.scoreData.getNbMeasures();if(this.opts.measureIdx+1>=D)return!1;const C=this.scoreData.getMeasure(0,this.opts.measureIdx-1),B=this.scoreData.getMeasure(0,this.opts.measureIdx+1),R=T.default.getQuarterDuration(C),L=T.default.getQuarterDuration(B);return R!==L},x.clearNextMeasureRepeat=function(){const D={measureIdx:this.opts.measureIdx+1};new o.A(this.scoreData,D,this.cancelStack).perform()},x.recordTimeSignature=function(D){const C=this.scoreData.getMeasure(0,this.opts.measureIdx);let B=T.default.getAnyTime(C);B=A.default.copy(B);const R=this.scoreData.getCommonContent();let L=R.getDisplayedTime(this.opts.measureIdx);L=A.default.copy(L);let k=R.getBeatsList(this.opts.measureIdx);k=U.default.copy(k);const W=R.hasRestsInsideBeams(this.opts.measureIdx),G={type:m.default.NAME,noDraw:!0,opts:{measureUuids:[D.measureUuid],previousTime:B,previousDisplayedTime:L,previousBeatsList:k,previousRestsInsideBeams:W}};this.cancelStack.push(G)},x.recordAttributes=function(D){const C=this.scoreData.getNbParts();for(let B=0;B<C;B++)this.recordPartAttributes(B,D)},x.recordPartAttributes=function(D,C){if(this.scoreData.isPartUnpitched(D))return;const B=this.scoreData.getPartUuid(D),R=this.scoreData.getMeasure(D,this.opts.measureIdx),L=new n.A(R),k=T.default.getNbStaves(R);for(let W=0;W<k;W++){let G=L.getKey(W);G=v.default.copy(G);const j={type:f.default.NAME,noDraw:!0,opts:{partUuid:B,measureUuids:[C.measureUuid],previousKey:G,staffIdx:W}};this.cancelStack.push(j);let y=L.getClef(W);y=P.default.copy(y);const X={type:h.default.NAME,noDraw:!0,opts:{partUuid:B,measureUuids:[C.measureUuid],previousClef:y,staffIdx:W}};this.cancelStack.push(X)}},x.recordVoices=function(D){const C=this.scoreData.getNbParts();for(let B=0;B<C;B++)this.recordPartVoices(B,D)},x.recordPartVoices=function(D,C){const B=this.scoreData.getPartUuid(D),R=this.scoreData.getMeasure(D,this.opts.measureIdx),L=new n.A(R),k=this.scoreData.getPartVoicesIndexes(D);k.forEach(function(W){if(!L.hasVoice(W)){const G={partUuid:B,measureUuid:C.measureUuid,voiceIdx:W},j={type:u.default.NAME,noDraw:!0,opts:G};this.cancelStack.push(j)}},this),k.forEach(function(W){if(L.hasVoice(W)){const G={partUuid:B,measureUuid:C.measureUuid,voiceIdx:W},j={type:l.default.NAME,noDraw:!0,opts:G};this.cancelStack.push(j)}},this)},x.removeMeasures=function(){const D=this.scoreData.getPartsContents();for(let C=0;C<D.length;C++){const B=this.adaptOption(this.opts,C);new d.A(this.scoreData,B,this.cancelStack).perform()}},x.removeCommonContentMeasure=function(){const D={measureIdx:this.opts.measureIdx};new i.A(this.scoreData,D,this.cancelStack).perform()},x.wasLastMeasure=function(){return this.scoreData.getPartContent(0).measure.length===this.opts.measureIdx},x.restoreFinalBarline=function(){if(this.shouldRestoreFinalBarline()){const D={measureIdx:this.opts.measureIdx-1};new a.A(this.scoreData,D,this.cancelStack).perform()}},x.shouldRestoreFinalBarline=function(){const C=this.scoreData.getMeasure(0,this.opts.measureIdx-1);return!T.default.hasRightBarline(C)||T.default.getRightBarlineStyle(C)==="light"},x.signalAttributesUpdated=function(){this.opts.measureIdx>0&&this.signalMeasureAttributesUpdated(this.opts.measureIdx-1);const D=this.scoreData.getNbMeasures();this.opts.measureIdx<D&&this.signalMeasureAttributesUpdated(this.opts.measureIdx)},x.signalMeasureAttributesUpdated=function(D){this.scoreData.getPartsContents().forEach(function(B,R){const L={type:"primitive.updateAttributes",opts:{measureIdx:D,partIdx:R}};this.cancelStack.push(L),(0,c.default)(this.cancelStack,this.scoreData,{measureIdx:D,partIdx:R})},this)},x.adaptOption=function(D,C){const B=(0,I.default)(D);return B.partIdx=C,B},x.removeHeader=function(){this.scoreData.removeMeasureHeader(this.opts.measureIdx)},x.getPreviousNextUuids=function(){if(this.uuids===null){const D={previousUuid:this.opts.measureIdx-1<0?null:this.scoreData.getMeasureUuid(this.opts.measureIdx-1),nextUuid:this.opts.measureIdx+1>=this.scoreData.getNbMeasuresHeaders()?null:this.scoreData.getMeasureUuid(this.opts.measureIdx+1),measureUuid:this.scoreData.getMeasureUuid(this.opts.measureIdx)};if(D.previousUuid===D.measureUuid||D.nextUuid===D.measureUuid){const C=`The removed measure uuid [${D.measureUuid}] also apprears on the surroundings. `,B=new g.default("Inconsistency",C);throw B.measureUuid=D.measureUuid,B}this.uuids=D}return this.uuids},x.updateStack=function(D){const C={type:this.name,noDraw:!0,opts:{previousUuid:D.previousUuid,nextUuid:D.nextUuid,measureUuid:D.measureUuid}};this.cancelStack.push(C)},x.storeAction=function(D){if(!this.cancelStack.hasAction()){const C={actionName:this.name,opts:{previousUuid:D.previousUuid,nextUuid:D.nextUuid,measureUuid:D.measureUuid}};this.cancelStack.storeAction(C)}},(0,_.default)(E);const p=E},59153:(N,M,t)=>{t.r(M),t.d(M,{default:()=>U});var g=t(147507),O=t(793317),T=t(52275),I=t(704621),A=t(42651);const v=function(m,f,h){this.init(m,f,h)};v.NAME="action.ClearVoice";const P=v.prototype;P.name=v.NAME,P.initMeasureData=O.default,P.init=function(m,f,h){(0,T.default)(m,f),(0,I.default)(m,f),this.initMeasureData(m,f),this.cancelStack=h,this.opts=f},P.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx)},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),typeof this.opts.removeFloating=="undefined"&&(this.opts.removeFloating=!0),this.storeAction();const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,removeFloating:this.opts.removeFloating};new g.A(this.measureData,m,this.cancelStack).perform()},P.storeAction=function(){if(!this.cancelStack.hasAction()){const m=this.measureData.getScoreData(),f={actionName:this.name,opts:{partUuid:m.getPartUuid(this.opts.partIdx),measureUuid:m.getMeasureUuid(this.opts.measureIdx),voiceIdx:this.opts.voiceIdx,removeFloating:this.opts.removeFloating}};this.cancelStack.storeAction(f)}},(0,A.default)(v);const U=v},111262:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(292681),O=t(259563),T=t(2835),I=t(33674),A=t(52275),v=t(704621),P=t(981801),U=t(783177),m=t(898039),f=t(831121),h=t(655035),u=t(519405),l=t(974116),d=t(200808),a=t(793317),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.InsertSlashedGraceNotePercu";const o=i.prototype;o.name=i.NAME,o.initMeasureData=a.default,o.init=function(e,n,c){(0,A.default)(e,n),(0,v.default)(e,n),(0,P.default)(e,n),(0,U.default)(e,n),this.initMeasureData(e,n),this.cancelStack=c,this.opts=n,(0,m.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null,this.insertGraceAction=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.getInsertGraceAction().checkPreconditions()},o.checkUnpitchedPart=function(){(0,f.default)(this.measureData)},o.checkCompatibleVoiceStaffIdx=function(){(0,I.default)(this.measureData,this.opts)},o.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},o.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.insertGraceNote(),this.addSlash()},o.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,T.default)(this.measureData,this.opts),this.fillHeadIfMissing(),this.sanitized=!0)},o.fillHeadIfMissing=function(){typeof this.opts.notehead=="undefined"&&(this.opts.notehead=(0,h.default)(this.measureData,this.opts.partIdx,this.opts.unpitched))},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,staffUuid:e.staffUuid,graceIdx:this.opts.graceIdx,timePos:e.timePos,divisions:e.dpq,unpitched:g.default.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(n)}},o.insertGraceNote=function(){this.getInsertGraceAction().perform()},o.getInsertGraceAction=function(){if(this.insertGraceAction===null){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:O.default.EIGHT,unpitched:g.default.copy(this.opts.unpitched),notehead:this.opts.notehead};this.insertGraceAction=new l.default(this.measureData,e,this.cancelStack)}return this.insertGraceAction},o.addSlash=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},n=new d.default(this.measureData,e,this.cancelStack);(0,u.default)(n)},o.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),n=e.getPartUuid(this.opts.partIdx),c=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),E=e.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),x=this.measureData.getDpqValue(),D=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:n,measureUuid:c,voiceUuid:_,staffUuid:E,dpq:x,timePos:D}}return this.location},(0,r.default)(i);const s=i},147765:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(52275),O=t(217692),T=t(783177),I=t(316610),A=t(701387),v=t(726042),P=t(646456),U=t(857552),m=t(303443),f=t(443749),h=t(723631),u=t(767260),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddPedalAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,g.default)(i,o),(0,O.A)(i,o),(0,T.default)(i,o),this.scoreData=i,this.opts=o,this.cancelStack=s,this.location=null,this.measuresSlice=null,this.wrappedPedalDirections=null},a.checkPreconditions=function(){this.checkLocation(),this.checkValues()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange()},a.checkStartTimePos=function(){const i=this.getStartMeasure(),o={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},s=(0,I.A)(o,i),e=A.default.getNbDivisions(i);if(!v.default.isNumber(s)||s<0||s>=e){const n=A.default.getDpq(i);throw new P.A(s,n)}},a.checkStopTimePos=function(){const i=this.getStopMeasure(),o={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},s=(0,I.A)(o,i),e=A.default.getNbDivisions(i);if(!v.default.isNumber(s)||s<0||s>e){const n=A.default.getDpq(i);throw new P.A(s,n)}},a.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},a.checkRevertRange=function(){const i=this.opts.startMeasureIdx,o=this.opts.stopMeasureIdx,s=o-i;if(s<0)throw new U.default(U.default.MEASURE,i,o);if(s===0){const e=v.default.lcm(this.opts.startDpq,this.opts.stopDpq),n=this.opts.startTimePos*e/this.opts.startDpq,c=this.opts.stopTimePos*e/this.opts.stopDpq;if(n>c)throw new U.default(U.default.TIME_POS,n,c);if(n===c)throw new m.A(m.A.TIME_POS)}},a.checkValues=function(){this.checkStaffIdx(),h.A.check(this.opts.placement)},a.checkStaffIdx=function(){const i=this.getStartMeasure(),o=A.default.getNbStaves(i),s=this.opts.staffIdx;if(!v.default.isInteger(s)||s<0||s>=o)throw new f.default(s)},a.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addPedal(),this.updateStack()},a.addPedal=function(){const i={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement};new u.A(this.scoreData,i,this.cancelStack).perform()},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={actionName:this.name,opts:{partUuid:i.partUuid,startMeasureUuid:i.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:i.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffUuid:i.staffUuid,placement:this.opts.placement}};this.cancelStack.storeAction(o)}},a.updateStack=function(){const i=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffUuid:i.staffUuid}};this.cancelStack.push(o)},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),s=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx),e=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,startMeasureUuid:o,stopMeasureUuid:s,staffUuid:e}}return this.location},(0,l.default)(d);const r=d},149851:(N,M,t)=>{t.r(M),t.d(M,{default:()=>d});var g=t(31278),O=t(505657),T=t(123491),I=t(474976),A=t(795639),v=t(898039),P=t(793317),U=t(52275),m=t(704621),f=t(981801),h=t(42651);const u=function(a,r,i){this.init(a,r,i)};u.NAME="action.AddArticulations";const l=u.prototype;l.initMeasureData=P.default,l.name=u.NAME,l.init=function(a,r,i){(0,U.default)(a,r),(0,m.default)(a,r),(0,f.default)(a,r),this.initMeasureData(a,r),this.cancelStack=i,this.opts=r,(0,v.default)(this.measureData,this.opts),this.location=null},l.checkPreconditions=function(){this.checkLocation(),this.checkParam()},l.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},l.checkParam=function(){if(!I.default.isValid(this.opts.articulationType))throw new O.A(this.opts.articulationType);const r=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(T.default.hasArticulations(r)&&T.default.hasArticulation(r,this.opts.articulationType))throw new g.default},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx};new A.A(this.measureData,a,this.cancelStack).perform(),this.updateStack()},l.updateStack=function(){const a=this.getLocation(),r={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,articulationType:this.opts.articulationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.push(r)},l.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,articulationType:this.opts.articulationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(r)}},l.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),r=a.getPartUuid(this.opts.partIdx),i=a.getMeasureUuid(this.opts.measureIdx),o=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),s=this.measureData.getDpqValue(),n=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:r,measureUuid:i,voiceUuid:o,dpq:s,timePos:n}}return this.location},(0,h.default)(u);const d=u},167090:(N,M,t)=>{t.d(M,{A:()=>v});var g=t(364842),O=t(951066);class T extends O.A{constructor(U){const m=`The split policy ${U} is invalid.`;super(m),Object.defineProperty(this,"splitPolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadSplitStaffPolicyError",this.splitPolicy=U}}const I={PART:"part",MEASURE:"measure"};I.DEFAULT=I.PART;const A=[I.PART,I.MEASURE];I.getValues=function(){return A.slice()},I.check=function(P){if(!I.isValid(P))throw new T(P)},I.isValid=function(P){return A.includes(P)},I.raiseError=function(P){const U=new g.default(`Invalid SplitStaffPolicy: ${P}`);return U.splitPolicy=P,U};const v=I},174511:(N,M,t)=>{t.r(M),t.d(M,{default:()=>h});var g=t(857552),O=t(153271),T=t(270259),I=t(31278),A=t(777345),v=t(70862),P=t(407819),U=t(42651);const m=function(u,l,d){this.init(u,l,d)};m.NAME="action.SetSwingSegment";const f=m.prototype;f.name=m.NAME,f.init=function(u,l,d){(0,P.default)(u,l),this.scoreData=u,this.cancelStack=d,this.opts=l,this.location=null},f.checkPreconditions=function(){this.checkLocation(),A.default.check(this.opts.swing),this.checkDifferentSwing(),this.checkCurrentConsistent()},f.checkLocation=function(){const l=this.scoreData.getPartMeasures(0).length,d=this.opts.startMeasureIdx;let a=d;if(a<0||a>=l)throw new O.default(a,O.default.GET);const r=this.opts.stopMeasureIdx;if(r<d)throw new g.default(g.default.MEASURE,d,r);if(a=this.opts.stopMeasureIdx,a<0||a>=l)throw new O.default(a,O.default.GET)},f.checkDifferentSwing=function(){if(!this.hasDifferentSwing())throw new I.default},f.hasDifferentSwing=function(){const u=this.getFirstSwing();return!A.default.isSame(u,this.opts.swing)},f.checkCurrentConsistent=function(){const u=this.getFirstSwing();for(let l=this.opts.startMeasureIdx+1;l<=this.opts.stopMeasureIdx;l++){const d=this.scoreData.getSwing(l);if(!A.default.isSame(d,u))throw new T.A(T.A.SWING)}},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const u=this.getPreviousData();this.setSwing(),this.updateStack(u)},f.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation().measureUuids.slice(),d={actionName:this.name,opts:{measureUuids:l,swing:A.default.copy(this.opts.swing)}};this.cancelStack.storeAction(d)}},f.getPreviousData=function(){const u=this.getFirstSwing();return{swing:A.default.copy(u)}},f.getFirstSwing=function(){return this.scoreData.getSwing(this.opts.startMeasureIdx)},f.setSwing=function(){const u={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,swing:A.default.copy(this.opts.swing)};new v.A(this.scoreData,u,this.cancelStack).perform()},f.updateStack=function(u){const d=this.getLocation().measureUuids.slice(),a={type:this.name,noDraw:!0,opts:{measureUuids:d,previousSwing:A.default.copy(u.swing)}};this.cancelStack.push(a)},f.getLocation=function(){if(this.location===null){const u=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:u}}return this.location},(0,U.default)(m);const h=m},180740:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(86316),O=t(319731),T=t(910748),I=t(615059),A=t(42651),v=t(704621),P=t(344361),U=t(120055),m=t(519405);const f=function(d,a,r){this.init(d,a,r)};f.NAME="action.RemoveRehearsalWithUpdate";const h=f.prototype;h.name=f.NAME,h.init=function(d,a,r){this.scoreData=d,this.cancelStack=r,this.opts=a,(0,v.default)(this.scoreData,a),this.location=null,this.removeAction=null},h.checkPreconditions=function(){this.checkRemoveAction(),this.checkAutoRehearsal()},h.checkRemoveAction=function(){this.getRemoveAction().checkPreconditions()},h.checkAutoRehearsal=function(){if(!this.scoreData.getCommonContent().hasRehearsalAuto(this.opts.measureIdx))throw new g.A},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performRemoveAction(),this.updateRehearsals()},h.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{measureUuid:d.measureUuid}};this.cancelStack.storeAction(a)}},h.getLocation=function(){if(this.location===null){const d=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:d}}return this.location},h.performRemoveAction=function(){const d=this.getRemoveAction();d.cancelStack=this.cancelStack,d.perform()},h.getRemoveAction=function(){if(this.removeAction===null){const d={measureIdx:this.opts.measureIdx},a=null;this.removeAction=new I.default(this.scoreData,d,a)}return this.removeAction},h.updateRehearsals=function(){this.getList().forEach(this.performAction,this)},h.getList=function(){const d=this.scoreData.getCommonContent();let a=(0,P.A)(d);return(0,U.A)(a),a=a.filter(u),a};const u=function(d){return d.Action!==null};h.performAction=function(d){const a={measureIdx:d.measureIdx};d.Action===T.default&&(a.rehearsal=d.value,a.type=O.A.AUTO);const r=new d.Action(this.scoreData,a,this.cancelStack);(0,m.default)(r)},(0,A.default)(f);const l=f},186552:(N,M,t)=>{t.r(M),t.d(M,{default:()=>f});var g=t(407819),O=t(153271),T=t(857552),I=t(31278),A=t(296440),v=t(777345),P=t(42651);const U=function(h,u,l){this.init(h,u,l)};U.NAME="action.SetSwing";const m=U.prototype;m.name=U.NAME,m.init=function(h,u,l){(0,g.default)(h,u),this.scoreData=h,this.cancelStack=l,this.opts=u,this.location=null},m.checkPreconditions=function(){this.checkLocation(),v.default.check(this.opts.swing),this.checkDifferentSwing()},m.checkLocation=function(){const u=this.scoreData.getPartMeasures(0).length,l=this.opts.startMeasureIdx;let d=l;if(d<0||d>=u)throw new O.default(d,O.default.GET);const a=this.opts.stopMeasureIdx;if(a<l)throw new T.default(T.default.MEASURE,l,a);if(d=this.opts.stopMeasureIdx,d<0||d>=u)throw new O.default(d,O.default.GET)},m.checkDifferentSwing=function(){if(!this.hasDifferentSwing())throw new I.default},m.hasDifferentSwing=function(){for(let h=this.opts.startMeasureIdx;h<=this.opts.stopMeasureIdx;h++){const u=this.scoreData.getSwing(h);if(!v.default.isSame(u,this.opts.swing))return!0}return!1},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setSwing()},m.storeAction=function(){if(!this.cancelStack.hasAction()){const u=this.getLocation().measureUuids.slice(),l={actionName:this.name,opts:{measureUuids:u,swing:v.default.copy(this.opts.swing)}};this.cancelStack.storeAction(l)}},m.getLocation=function(){if(this.location===null){const h=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:h}}return this.location},m.setSwing=function(){const h={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,swing:v.default.copy(this.opts.swing)};new A.A(this.scoreData,h,this.cancelStack).perform()},(0,P.default)(U);const f=U},196270:(N,M,t)=>{t.r(M),t.d(M,{default:()=>i});var g=t(443749),O=t(646456),T=t(411146),I=t(195446),A=t(951657),v=t(701387),P=t(721247),U=t(726042),m=t(52275),f=t(704621),h=t(783177),u=t(316610),l=t(711333),d=t(42651);const a=function(o,s,e){this.init(o,s,e)};a.NAME="action.AddMiddleMeasureClefAtTimePos";const r=a.prototype;r.name=a.NAME,r.init=function(o,s,e){(0,m.default)(o,s),(0,f.default)(o,s),(0,h.default)(o,s),this.scoreData=o,this.cancelStack=e,this.opts=s,this.localTimePos=null,this.location=null},r.checkPreconditions=function(){this.checkLocation(),this.checkPitchedPart(),this.checkTimePos(),this.checkParam()},r.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const o=this.getMeasure(),s=v.default.getNbStaves(o);if(this.opts.staffIdx<0||this.opts.staffIdx>=s)throw new g.default(this.opts.staffIdx)},r.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new I.default},r.checkTimePos=function(){const o=this.getLocalTimePos(),s=this.getMeasure(),e=v.default.getNbDivisions(s);if(!U.default.isNumber(o)||o<0||o>=e){const n=v.default.getDpq(s);throw new O.A(o,n)}if(this.opts.timePos===0)throw new T.A(T.A.MEASURE)},r.getLocalTimePos=function(){if(this.localTimePos===null){const o=this.getMeasure();this.localTimePos=(0,u.A)(this.opts,o)}return this.localTimePos},r.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},r.checkParam=function(){if(P.default.check(this.opts.clef),P.default.isTab(this.opts.clef))throw new A.default("TAB");if(P.default.isPercussion(this.opts.clef))throw new A.default("percussion")},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addClef(),this.updateStack()},r.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),s=P.default.copy(this.opts.clef),e={actionName:this.name,opts:{partUuid:o.partUuid,measureUuid:o.measureUuid,staffUuid:o.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,clef:s}};this.cancelStack.storeAction(e)}},r.addClef=function(){const o=P.default.copy(this.opts.clef),s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,clef:o};new l.A(this.scoreData,s,this.cancelStack).perform()},r.updateStack=function(){const o=this.getLocation(),s={type:this.name,noDraw:!0,opts:{partUuid:o.partUuid,measureUuid:o.measureUuid,staffUuid:o.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(s)},r.getLocation=function(){if(this.location===null){const o=this.scoreData.getPartUuid(this.opts.partIdx),s=this.scoreData.getMeasureUuid(this.opts.measureIdx),e=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:o,measureUuid:s,staffUuid:e}}return this.location},(0,d.default)(a);const i=a},200808:(N,M,t)=>{t.r(M),t.d(M,{default:()=>u});var g=t(31278),O=t(123491),T=t(130600),I=t(898039),A=t(52275),v=t(704621),P=t(981801),U=t(793317),m=t(42651);const f=function(l,d,a){this.init(l,d,a)};f.NAME="action.AddGraceSlash",f.isNoChange=function(l){return l instanceof g.default};const h=f.prototype;h.name=f.NAME,h.initMeasureData=U.default,h.init=function(l,d,a){(0,A.default)(l,d),(0,v.default)(l,d),(0,P.default)(l,d),this.initMeasureData(l,d),this.cancelStack=a,this.opts=d,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null},h.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,I.default)(this.measureData,this.opts),this.checkGraceIdx(),this.checkNoSlash()},h.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},h.checkNoSlash=function(){const d=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx);if(O.default.isSlashedGrace(d))throw new g.default},h.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addGraceSlash(),this.updateStack()},h.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation(),d={actionName:this.name,opts:{partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid,divisions:l.dpq,timePos:l.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(d)}},h.addGraceSlash=function(){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new T.A(this.measureData,l,this.cancelStack).perform()},h.updateStack=function(){const l=this.getLocation(),d={type:this.name,noDraw:!0,opts:{partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid,divisions:l.dpq,timePos:l.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.push(d)},h.getLocation=function(){if(this.location===null){const l=this.measureData.getScoreData(),d=l.getPartUuid(this.opts.partIdx),a=l.getMeasureUuid(this.opts.measureIdx),r=l.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),i=this.measureData.getDpqValue(),s=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:d,measureUuid:a,voiceUuid:r,dpq:i,timePos:s}}return this.location},(0,m.default)(f);const u=f},223628:(N,M,t)=>{t.r(M),t.d(M,{default:()=>m});var g=t(153271),O=t(31278),T=t(615059),I=t(180740),A=t(42651),v=t(519405);const P=function(f,h,u){this.init(f,h,u)};P.NAME="action.RemoveRehearsalMain";const U=P.prototype;U.name=P.NAME,U.init=function(f,h,u){this.scoreData=f,this.cancelStack=u,this.opts=h,this.location=null},U.checkPreconditions=function(){this.checkLocation(),this.checkHasRehearsal()},U.checkLocation=function(){const f=this.scoreData.getNbMeasures(),h=this.opts.measureIdx;if(h<0||h>=f)throw new g.default(h,g.default.GET)},U.checkHasRehearsal=function(){if(!this.scoreData.getCommonContent().hasRehearsal(this.opts.measureIdx))throw new O.default},U.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.performAction()},U.performAction=function(){const f=this.getActionConstructor(),h={measureIdx:this.opts.measureIdx},u=new f(this.scoreData,h,this.cancelStack);(0,v.default)(u)},U.getActionConstructor=function(){return this.isRehearsalAuto()?I.default:T.default},U.isRehearsalAuto=function(){return this.scoreData.getCommonContent().hasRehearsalAuto(this.opts.measureIdx)},(0,A.default)(P);const m=P},229185:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(443749),O=t(857552),T=t(303443),I=t(646456),A=t(746796),v=t(924784),P=t(723631),U=t(995677),m=t(701387),f=t(726042),h=t(796851),u=t(52275),l=t(217692),d=t(783177),a=t(316610),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.AddWedgeAtTimePos";const o=i.prototype;o.name=i.NAME,o.init=function(e,n,c){(0,u.default)(e,n),(0,l.A)(e,n),(0,d.default)(e,n),this.scoreData=e,this.cancelStack=c,this.opts=n,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkValues()},o.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange()},o.checkStartTimePos=function(){const e=this.getStartMeasure(),n={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},c=(0,a.A)(n,e),_=m.default.getNbDivisions(e);if(!f.default.isNumber(c)||c<0||c>=_){const E=m.default.getDpq(e);throw new I.A(c,E)}},o.checkStopTimePos=function(){const e=this.getStopMeasure(),n={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},c=(0,a.A)(n,e),_=m.default.getNbDivisions(e);if(!f.default.isNumber(c)||c<0||c>_){const E=m.default.getDpq(e);throw new I.A(c,E)}},o.checkRevertRange=function(){const e=this.opts.startMeasureIdx,n=this.opts.stopMeasureIdx,c=n-e;if(c<0)throw new O.default(O.default.MEASURE,e,n);if(c===0){const _=f.default.lcm(this.opts.startDpq,this.opts.stopDpq),E=this.opts.startTimePos*_/this.opts.startDpq,x=this.opts.stopTimePos*_/this.opts.stopDpq;if(E>x)throw new O.default(O.default.TIME_POS,E,x);if(E===x)throw new T.A(T.A.TIME_POS)}},o.checkValues=function(){this.checkStaffIdx(),P.A.check(this.opts.placement),U.A.check(this.opts.type)},o.checkStaffIdx=function(){const e=this.getStartMeasure(),n=m.default.getNbStaves(e),c=this.opts.staffIdx;if(!f.default.isInteger(c)||c<0||c>=n)throw new g.default(c)},o.checkParam=function(){if(!P.A.isValid(this.opts.placement))throw new A.A(this.opts.placement);if(!U.A.isValid(this.opts.wedge))throw new v.A(this.opts.wedge)},o.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},o.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addWedge(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n={actionName:this.name,opts:{partUuid:e.partUuid,startMeasureUuid:e.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:e.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffUuid:e.staffUuid,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.storeAction(n)}},o.addWedge=function(){const e={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement,type:this.opts.type};new h.A(this.scoreData,e,this.cancelStack).perform()},o.updateStack=function(){const e=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffUuid:e.staffUuid}};this.cancelStack.push(n)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx),n=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),c=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx),_=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:e,staffUuid:_,startMeasureUuid:n,stopMeasureUuid:c}}return this.location},(0,r.default)(i);const s=i},233113:(N,M,t)=>{t.r(M),t.d(M,{default:()=>d});var g=t(31278),O=t(123491),T=t(244616),I=t(209175),A=t(223306),v=t(19850),P=t(52275),U=t(704621),m=t(981801),f=t(793317),h=t(42651);const u=function(a,r,i){this.init(a,r,i)};u.NAME="action.AddColorToRest",u.isNoChange=function(a){return a instanceof g.default};const l=u.prototype;l.name=u.NAME,l.initMeasureData=f.default,l.init=function(a,r,i){(0,P.default)(a,r),(0,U.default)(a,r),(0,m.default)(a,r),this.initMeasureData(a,r),this.cancelStack=i,this.opts=r,this.noteHead=null,this.voice=null,this.location=null},l.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,v.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkRest(),this.checkValues(),this.checkDifferentColor()},l.checkValues=function(){T.default.check(this.opts.color)},l.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},l.checkRest=function(){this.getVoice().checkRest(this.opts.noteIdx)},l.checkDifferentColor=function(){const a=this.getNote();if(O.default.hasColor(a)&&O.default.getColor(a)===this.opts.color)throw new g.default},l.getNote=function(){if(this.noteHead===null){const a=this.getVoice();this.noteHead=a.getNote(this.opts.noteIdx)}return this.noteHead},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addColorToRest(),this.updateStack()},l.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r=I.default.copy(a.timeModif),i={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,divisions:a.dpq,timePos:a.timePos,timeModif:r,color:this.opts.color},o={actionName:this.name,opts:i};this.cancelStack.storeAction(o)}},l.addColorToRest=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,color:this.opts.color};new A.default(this.measureData,a,this.cancelStack).perform()},l.updateStack=function(){const a=this.getLocation(),r={partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,divisions:a.dpq,timePos:a.timePos},i={type:this.name,noDraw:!0,opts:r};this.cancelStack.push(i)},l.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),r=a.getPartUuid(this.opts.partIdx),i=a.getMeasureUuid(this.opts.measureIdx),o=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),s=this.measureData.getDpqValue(),e=this.getVoice(),n=e.getRangeSpace(0,this.opts.noteIdx),c=e.getNote(this.opts.noteIdx);let _=O.default.getTimeModif(c);_=I.default.copy(_),this.location={partUuid:r,measureUuid:i,voiceUuid:o,dpq:s,timePos:n,timeModif:_}}return this.location},l.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,h.default)(u);const d=u},244491:(N,M,t)=>{t.r(M),t.d(M,{default:()=>p});var g=t(278243),O=t(195446),T=t(807205),I=t(742735),A=t(737903),v=t(123491),P=t(351277),U=t(504005),m=t(708836),f=t(955832),h=t(805396),u=t(691309),l=t(325600),d=t(52275),a=t(704621),r=t(981801),i=t(898039),o=t(852363),s=t(519405),e=t(793317),n=t(42651),c=t(645166);const _=function(D,C,B){this.init(D,C,B)};_.NAME="action.AddTie";const E=_.prototype;E.name=_.NAME,E.initMeasureData=e.default,E.init=function(D,C,B){(0,d.default)(D,C),(0,a.default)(D,C),(0,r.default)(D,C),this.initMeasureData(D,C),this.cancelStack=B,this.opts=C,(0,i.default)(this.measureData,C),this.crossMeasure=new u.default(this.measureData,C.voiceIdx,C.noteIdx),this.location=null},E.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanTie()},E.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},E.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},E.isLeftRest=function(){return this.crossMeasure.isLeftRest()},E.isRightRest=function(){return this.crossMeasure.isRightRest()},E.checkCanTie=function(){if(this.crossMeasure.hasRightGrace())throw new T.A(this.name,"right not cannot have graces notes attached.");const D=this.getLeftChord(),C=this.getRightChord();if(!I.A.canTieChords(D,C))throw new T.A(this.name,"nothing can be tied")},E.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeRightArpeggio(),this.removeTremolo2IfNeeded();const D=this.getLeftChord(),C=this.getRightChord(),B=I.A.getUntiedPairs(D,C),R=B.map(x);this.removeRightPreBends(B),I.A.tieChords(D,C),this.isLastOfMeasure()&&this.updateRightAccidentals(B),this.updateStack(R)},E.storeAction=function(){if(!this.cancelStack.hasAction()){const D=this.getLocation(),C={actionName:this.name,opts:{partUuid:D.partUuid,measureUuid:D.measureUuid,divisions:D.dpq,timePos:D.timePos,voiceUuid:D.voiceUuid}};this.cancelStack.storeAction(C)}},E.removeRightArpeggio=function(){const D=this.crossMeasure.getRightMeasure(),C=D.getVoice(this.opts.voiceIdx),B=this.crossMeasure.getRightNoteIdx(),R=C.getNote(B);if(!v.default.hasArpeggiate(R))return;const L={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx()},k=new m.default(D,L,this.cancelStack);(0,s.default)(k)},E.getLeftChord=function(){return this.crossMeasure.getLeftChord()},E.getRightChord=function(){return this.crossMeasure.getRightChord()};const x=function(D){const C=v.default.getPitch(D.left);return P.default.copy(C)};E.removeRightPreBends=function(D){D.forEach(this.removeRightPreBend,this)},E.removeRightPreBend=function({right:D}){if(!v.default.hasFretData(D)||!v.default.hasPreBend(D)||!v.default.hasBend(D))return;const C=v.default.getFretData(D),B=v.default.getPitch(D),R={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),pitch:P.default.copy(B),fretData:(0,A.default)(C)},L=this.crossMeasure.getRightMeasure(),k=new f.default(L,R,this.cancelStack);(0,s.default)(k)},E.removeTremolo2IfNeeded=function(){const[D]=this.crossMeasure.getLeftChord();if(v.default.hasTremoloStart(D)){const C={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()},B=this.crossMeasure.getRightMeasure(),R=new h.default(B,C,this.cancelStack);(0,s.default)(R)}},E.isLastOfMeasure=function(){const B=this.crossMeasure.getLeftMeasure().getVoice(this.opts.voiceIdx).getNbNotes();return this.opts.noteIdx===B-1},E.updateRightAccidentals=function(D){D.forEach(C=>{let B=v.default.getPitch(C.right);const R=v.default.getStaffIdx(C.right),L=this.crossMeasure.getRightMeasure(),k=this.crossMeasure.getRightMeasureIdx(),W=this.crossMeasure.getRightNoteIdx();B=P.default.copy(B);const G={partIdx:this.opts.partIdx,measureIdx:k,voiceIdx:this.opts.voiceIdx,staffIdx:R,noteIdx:W,pitch:B};new c.A(L,G,this.cancelStack).perform()})},E.updateStack=function(D){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx(),D.forEach(this.addAction,this)},E.addAction=function(D){const C=this.getLocation(),B={type:U.default.NAME,opts:{partIdx:this.opts.partIdx,partUuid:C.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:C.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:C.timePos,divisions:C.dpq,voiceUuid:C.voiceUuid,pitch:P.default.copy(D)}};this.cancelStack.push(B),(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const R={type:`${U.default.NAME}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:P.default.copy(D)}};this.cancelStack.push(R),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},E.getLocation=function(){if(this.location===null){const D=this.measureData.getScoreData(),C=D.getPartUuid(this.opts.partIdx),B=this.crossMeasure.getLeftMeasureIdx(),R=D.getMeasureUuid(B),L=D.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),k=this.crossMeasure.getLeftMeasure().getDpqValue(),W=this.crossMeasure.getLeftVoice(),G=this.crossMeasure.getLeftNoteIdx(),j=(0,l.A)(W,G);this.location={partUuid:C,measureUuid:R,voiceUuid:L,dpq:k,timePos:j}}return this.location},(0,n.default)(_);const p=_},258392:(N,M,t)=>{t.r(M),t.d(M,{default:()=>n});var g=t(31278),O=t(195446),T=t(748803),I=t(123491),A=t(351277),v=t(341046),P=t(481741),U=t(578918),m=t(19405),f=t(476031),h=t(898039),u=t(52275),l=t(704621),d=t(981801),a=t(783177),r=t(287296),i=t(793317),o=t(42651);const s=function(c,_,E){this.init(c,_,E)};s.NAME="action.AddFingerings",s.isNoChange=function(c){return c instanceof g.default};const e=s.prototype;e.name=s.NAME,e.initMeasureData=i.default,e.init=function(c,_,E){(0,u.default)(c,_),(0,l.default)(c,_),(0,d.default)(c,_),(0,a.default)(c,_),this.initMeasureData(c,_),this.cancelStack=E,this.opts=_,this.noteHead=null,this.voice=null,this.location=null},e.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,h.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkDifferentFingering()},e.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},e.checkValues=function(){(0,m.default)(this.opts),v.A.check(this.opts.fingering)},e.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},e.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},e.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,f.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,r.default)(this.measureData,this.opts)},e.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const _=A.default.copy(this.opts.pitch);throw new T.default(T.default.GET,_)}},e.checkDifferentFingering=function(){const c=this.getNoteAtPitch();if(I.default.hasFingering(c)&&I.default.getFingering(c)===this.opts.fingering)throw new g.default},e.getNoteAtPitch=function(){if(this.noteHead===null){const c=this.getVoice();this.noteHead=(0,U.default)(c,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addFingering(),this.updateStack()},e.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),_={partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,fingering:this.opts.fingering},E={actionName:this.name,opts:_};this.cancelStack.storeAction(E)}},e.addFingering=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copy(this.opts.pitch),fingering:this.opts.fingering};new P.A(this.measureData,c,this.cancelStack).perform()},e.updateStack=function(){const c=this.getLocation(),_={partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch)},E={type:this.name,noDraw:!0,opts:_};this.cancelStack.push(E)},e.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),_=c.getPartUuid(this.opts.partIdx),E=c.getMeasureUuid(this.opts.measureIdx),x=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),C=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:_,measureUuid:E,voiceUuid:x,dpq:p,timePos:C,isConcertPitch:!1}}return this.location},e.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,o.default)(s);const n=s},263494:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(217692),O=t(316610),T=t(701387),I=t(726042),A=t(646456),v=t(857552),P=t(303443),U=t(909748),m=t(302667),f=t(42651);const h=function(d,a,r){this.init(d,a,r)};h.NAME="action.AddTempoChangeAtTimePos";const u=h.prototype;u.name=h.NAME,u.init=function(d,a,r){(0,g.A)(d,a),this.scoreData=d,this.opts=a,this.cancelStack=r,this.location=null,this.measuresSlice=null,this.wrappedPedalDirections=null},u.checkPreconditions=function(){this.checkLocation(),this.checkValues()},u.checkLocation=function(){this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange()},u.checkStartTimePos=function(){const d=this.getStartMeasure(),a={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},r=(0,O.A)(a,d),i=T.default.getNbDivisions(d);if(!I.default.isNumber(r)||r<0||r>=i){const o=T.default.getDpq(d);throw new A.A(r,o)}},u.checkStopTimePos=function(){const d=this.getStopMeasure(),a={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},r=(0,O.A)(a,d),i=T.default.getNbDivisions(d);if(!I.default.isNumber(r)||r<0||r>i){const o=T.default.getDpq(d);throw new A.A(r,o)}},u.getStopMeasure=function(){return this.scoreData.getMeasure(0,this.opts.stopMeasureIdx)},u.checkRevertRange=function(){const d=this.opts.startMeasureIdx,a=this.opts.stopMeasureIdx,r=a-d;if(r<0)throw new v.default(v.default.MEASURE,d,a);if(r===0){const i=I.default.lcm(this.opts.startDpq,this.opts.stopDpq),o=this.opts.startTimePos*i/this.opts.startDpq,s=this.opts.stopTimePos*i/this.opts.stopDpq;if(o>s)throw new v.default(v.default.TIME_POS,o,s);if(o===s)throw new P.A(P.A.TIME_POS)}},u.checkValues=function(){U.A.check(this.opts.type)},u.getStartMeasure=function(){return this.scoreData.getMeasure(0,this.opts.startMeasureIdx)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addTempoChange(),this.updateStack()},u.addTempoChange=function(){const d={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,type:this.opts.type};new m.A(this.scoreData,d,this.cancelStack).perform()},u.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{startMeasureUuid:d.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:d.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,type:this.opts.type}};this.cancelStack.storeAction(a)}},u.updateStack=function(){const d=this.getLocation(),a={type:this.name,noDraw:!0,opts:{measureUuid:d.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,type:this.opts.type}};this.cancelStack.push(a)},u.getLocation=function(){if(this.location===null){const d=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),a=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx);this.location={startMeasureUuid:d,stopMeasureUuid:a}}return this.location},(0,f.default)(h);const l=h},283696:(N,M,t)=>{t.r(M),t.d(M,{default:()=>m});var g=t(793317),O=t(52275),T=t(704621),I=t(195446),A=t(411365),v=t(42651);const P=function(f,h,u){this.init(f,h,u)};P.NAME="action.SetMeasureFrets";const U=P.prototype;U.name=P.NAME,U.initMeasureData=g.default,U.init=function(f,h,u){(0,O.default)(f,h),(0,T.default)(f,h),this.initMeasureData(f,h),this.opts=h,this.cancelStack=u,this.location=null},U.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx)},U.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new I.default},U.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new A.A(this.measureData,f,this.cancelStack).perform(),this.updateStack()},U.updateStack=function(){const f=this.getLocation(),h={type:this.name,noDraw:!0,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(h)},U.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(h)}},U.getLocation=function(){if(this.location===null){const f=this.measureData.getScoreData(),h=f.getPartUuid(this.opts.partIdx),u=f.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:h,measureUuid:u}}return this.location},(0,v.default)(P);const m=P},296825:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(8567),O=t(57572),T=t(883782),I=t(837283),A=t(993608),v=t(701387),P=t(515819),U=t(726042),m=t(152436),f=t(857579),h=t(52275),u=t(704621),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddRestCrossMeasure";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,h.default)(i,o),(0,u.default)(i,o),this.scoreData=i,this.cancelStack=s,this.opts=o,this.location=null,this.measureData=null},a.checkPreconditions=function(){this.checkLocation(),this.checkPosition(),this.checkDuration()},a.checkLocation=function(){this.getMeasureData(),this.checkVoiceIdx();const i=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),o=v.default.getQuarterDuration(i),s=this.opts.quarterPosition;if(!U.default.isNumber(s)||s<0||s>=o)throw new g.A(s)},a.getMeasureData=function(){if(this.measureData===null){const i=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new f.A(i)}return this.measureData},a.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new T.default(this.opts.voiceIdx)},a.checkPosition=function(){const i=this.opts.quarterPosition;if(!P.default.isValidQuarter(i))throw new I.A(i)},a.checkDuration=function(){const i=this.opts.quarterDuration;if(P.default.isValidQuarter(i)){if(i===0)throw new O.A(i)}else throw new A.A(i)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addRestCrossMeasure()},a.addRestCrossMeasure=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,forceShowVoice:this.opts.forceShowVoice};new m.A(this.scoreData,i,this.cancelStack).perform()},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,forceShowVoice:!!this.opts.forceShowVoice}};this.cancelStack.storeAction(o)}},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:i,measureUuid:o}}return this.location},(0,l.default)(d);const r=d},321875:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(735696),O=t(465439),T=t(31278),I=t(793317),A=t(898039),v=t(52275),P=t(704621),U=t(981801),m=t(737903),f=t(123491),h=t(726042),u=t(724095),l=t(723631),d=t(138717),a=t(609260),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.AddOrnament";const o=i.prototype;o.initMeasureData=I.default,o.name=i.NAME,o.init=function(e,n,c){(0,v.default)(e,n),(0,P.default)(e,n),(0,U.default)(e,n),this.initMeasureData(e,n),this.cancelStack=c,this.opts=(0,m.default)(n),this.location=null,(0,A.default)(this.measureData,this.opts)},o.checkPreconditions=function(){this.checkLocation(),this.checkOrnamentsOptsContent(),this.checkParam()},o.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const e=this.measureData.getVoice(this.opts.voiceIdx);e.checkNoteIdx(this.opts.noteIdx),e.checkNotRest(this.opts.noteIdx)},o.checkParam=function(){if(!u.A.isValid(this.opts.ornamentType))throw new g.A(this.opts.ornamentType);const n=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(f.default.hasOrnaments(n)&&f.default.hasOrnament(n,this.opts.ornamentType,this.opts.ornamentsOpts))throw new T.default},o.checkOrnamentsOptsContent=function(){switch(typeof this.opts.ornamentsOpts=="undefined"&&(this.opts.ornamentsOpts={}),this.opts.ornamentType){case u.A.TREMOLO:{const e=parseInt(this.opts.ornamentsOpts.nbBeam,10);if(!h.default.isInteger(e)||e<1||e>5)throw new O.A("nbBeam");break}case u.A.MORDENT:case u.A.INVERTED_MORDENT:{const e=this.opts.ornamentsOpts;if(typeof e.departure!="undefined"){if(!l.A.isValid(e.departure))throw new O.A("departure");delete e.approach}if(typeof e.approach!="undefined"&&!l.A.isValid(e.approach))throw new O.A("approach");if(typeof e.long=="undefined")e.long=d.A.NO;else if(!d.A.isValid(e.long))throw new O.A("long");break}default:break}},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:this.opts.ornamentType,ornamentsOpts:this.opts.ornamentsOpts};new a.A(this.measureData,e,this.cancelStack).perform(),this.updateStack()},o.updateStack=function(){const e=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,timePos:e.timePos,divisions:e.dpq,ornamentType:this.opts.ornamentType}};this.cancelStack.push(n)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,timePos:e.timePos,divisions:e.dpq,ornamentType:this.opts.ornamentType,ornamentsOpts:this.opts.ornamentsOpts}};this.cancelStack.storeAction(n)}},o.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),n=e.getPartUuid(this.opts.partIdx),c=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),E=this.measureData.getDpqValue(),p=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:n,measureUuid:c,voiceUuid:_,dpq:E,timePos:p}}return this.location},(0,r.default)(i);const s=i},329578:(N,M,t)=>{t.r(M),t.d(M,{default:()=>i});var g=t(153271),O=t(661e3),T=t(857552),I=t(195446),A=t(443749),v=t(951657),P=t(701387),U=t(721247),m=t(726042),f=t(624539),h=t(52275),u=t(407819),l=t(783177),d=t(42651);const a=function(o,s,e){this.init(o,s,e)};a.NAME="action.SetClef";const r=a.prototype;r.name=a.NAME,r.init=function(o,s,e){(0,u.default)(o,s),(0,h.default)(o,s),(0,l.default)(o,s),this.scoreData=o,this.cancelStack=e,this.opts=s,this.location=null},r.checkPreconditions=function(){this.checkClef(),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentClef()},r.checkClef=function(){if(U.default.check(this.opts.clef),U.default.isTab(this.opts.clef))throw new v.default("TAB")},r.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new I.default},r.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const o=this.opts.startMeasureIdx,s=this.opts.stopMeasureIdx;if(s-o<0)throw new T.default(T.default.MEASURE,o,s);const n=this.getFirstMeasure(),c=P.default.getNbStaves(n),_=this.opts.staffIdx;if(!m.default.isInteger(_)||_<0||_>=c)throw new A.default(_,A.default.GET)},r.checkMeasureIdx=function(o){const s=this.scoreData.getNbMeasures();if(!m.default.isInteger(o)||o<0||o>=s)throw new g.default(o,g.default.GET)},r.checkDifferentClef=function(){if(!this.hasSomeDifferent())throw new O.default(O.default.CLEF)},r.hasSomeDifferent=function(){for(let o=this.opts.startMeasureIdx;o<=this.opts.stopMeasureIdx;o++){const s=this.getClef(o);if(!U.default.isSame(s,this.opts.clef))return!0}return!1},r.getClef=function(o){const s=this.scoreData.getMeasure(this.opts.partIdx,o);return P.default.getWrappedClef(s).getEntry(this.opts.staffIdx)},r.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.setClef()},r.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),s=o.measureUuids.slice(),e=U.default.copy(this.opts.clef),n={actionName:this.name,opts:{partUuid:o.partUuid,measureUuids:s,staffUuid:o.staffUuid,clef:e}};this.cancelStack.storeAction(n)}},r.getLocation=function(){if(this.location===null){const o=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),s=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:s,measureUuids:o,staffUuid:e}}return this.location},r.setClef=function(){const o=U.default.copy(this.opts.clef),s={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,clef:o};new f.A(this.scoreData,s,this.cancelStack).perform()},(0,d.default)(a);const i=a},341259:(N,M,t)=>{t.r(M),t.d(M,{default:()=>U});var g=t(153271),O=t(443061),T=t(414),I=t(704621),A=t(42651);const v=function(m,f,h){this.init(m,f,h)};v.NAME="action.RemoveEnding";const P=v.prototype;P.name=v.NAME,P.init=function(m,f,h){this.scoreData=m,this.cancelStack=h,this.opts=f,(0,I.default)(this.scoreData,f),this.location=null},P.checkPreconditions=function(){this.checkLocation(),this.checkHasEnding()},P.checkLocation=function(){const m=this.scoreData.getNbMeasures(),f=this.opts.measureIdx;if(f<0||f>=m)throw new g.default(f,g.default.GET)},P.checkHasEnding=function(){if(!this.scoreData.getCommonContent().hasEnding(this.opts.measureIdx))throw new O.A},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const m=this.getPreviousData();this.storeAction(),this.removeEnding(),this.updateStack(m)},P.getPreviousData=function(){let f=this.scoreData.getCommonContent().getEnding(this.opts.measureIdx);return f=f.slice(),{numbers:f}},P.storeAction=function(){if(!this.cancelStack.hasAction()){const m=this.getLocation(),f={actionName:this.name,opts:{measureUuid:m.measureUuid}};this.cancelStack.storeAction(f)}},P.removeEnding=function(){const m={measureIdx:this.opts.measureIdx};new T.A(this.scoreData,m,this.cancelStack).perform()},P.updateStack=function(m){const f=this.getLocation(),h=m.numbers.slice(),u={type:this.name,noDraw:!0,opts:{measureUuid:f.measureUuid,numbers:h}};this.cancelStack.push(u)},P.getLocation=function(){if(this.location===null){const m=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:m}}return this.location},(0,A.default)(v);const U=v},342735:(N,M,t)=>{t.r(M),t.d(M,{default:()=>n});var g=t(883782),O=t(443749),T=t(392725),I=t(734246),A=t(513318),v=t(323161),P=t(987901),U=t(890439),m=t(726042),f=t(446921),h=t(210888),u=t(149658),l=t(52275),d=t(783177),a=t(248703),r=t(371706),i=t(42651);const o=!1,s=function(c,_,E){this.init(c,_,E)};s.NAME="action.AddVoices";const e=s.prototype;e.name=s.NAME,e.init=function(c,_,E){(0,l.default)(c,_),(0,d.default)(c,_),this.scoreData=c,this.cancelStack=E,this.opts=_,this.location=null,this.sanitized=!1},e.checkPreconditions=function(){if(this.sanitizeIfNeeded(),A.A.check(this.opts.voiceIdx),v.A.check(this.opts.voiceUuid),this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new g.default(this.opts.voiceIdx,g.default.INSERT);(0,r.A)(this.scoreData,this.opts);const c=this.scoreData.getPartContent(this.opts.partIdx),_=f.A.getNbStaves(c),E=this.opts.staffIdx;if(!m.default.isInteger(E)||E<0||E>=_)throw new O.default(E);const x=this.scoreData.getPartStaffNbVoices(this.opts.partIdx,E);if(x===P.A.MAX_NB_VOICES_PER_STAFF)throw new T.A;const p=this.opts.idxInStaff;if(!m.default.isInteger(p)||p<0||p>x)throw new I.A(p)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();const c=this.getPreviousData();this.updateStack(c),this.addVoice()},e.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.isMainVoice=="undefined"&&(this.opts.isMainVoice=o),typeof this.opts.voiceIdx=="undefined"&&(this.opts.voiceIdx=this.generateVoiceIdx()),typeof this.opts.voiceUuid=="undefined"&&(this.opts.voiceUuid=h.default.generate()),typeof this.opts.show=="undefined"&&(this.opts.show=!0),this.sanitized=!0)},e.generateVoiceIdx=function(){const c=this.scoreData.getPartVoicesIndexes(this.opts.partIdx),_=U.Ay.fromList(c),E=0,x={};return(0,a.A)(_,x,E)},e.storeAction=function(){const c=this.getLocation(),_={partUuid:c.partUuid,voiceIdx:this.opts.voiceIdx,staffUuid:c.staffUuid,idxInStaff:this.opts.idxInStaff,isMainVoice:this.opts.isMainVoice,voiceUuid:this.opts.voiceUuid},E={actionName:this.name,opts:_};!this.cancelStack.hasAction()&&!this.opts.isSubAction?this.cancelStack.storeAction(E):this.cancelStack.storeAddAction(E)},e.getPreviousData=function(){return{mainVoiceIdx:this.scoreData.getPartStaffMainVoiceIdx(this.opts.partIdx,this.opts.staffIdx)}},e.addVoice=function(){const c={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,idxInStaff:this.opts.idxInStaff,isMainVoice:this.opts.isMainVoice,voiceUuid:this.opts.voiceUuid};new u.A(this.scoreData,c,this.cancelStack).perform()},e.updateStack=function(c){const E={partUuid:this.getLocation().partUuid,formerMainVoiceIdx:c.mainVoiceIdx,voiceUuid:this.opts.voiceUuid,voiceIdx:this.opts.voiceIdx},x={type:this.name,noDraw:!0,opts:E};this.cancelStack.push(x)},e.getLocation=function(){if(this.location===null){const c=this.scoreData.getPartUuid(this.opts.partIdx),_=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:c,staffUuid:_}}return this.location},(0,i.default)(s);const n=s},353012:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(145638),O=t(443749),T=t(646456),I=t(701387),A=t(726042),v=t(446921),P=t(162621),U=t(52275),m=t(704621),f=t(783177),h=t(316610),u=t(363297),l=t(887076),d=t(42651);const a=function(s,e,n){this.init(s,e,n)};a.NAME="action.RemovePedalClosedAtTimePos";const r=a.prototype;r.name=a.NAME,r.init=function(s,e,n){(0,U.default)(s,e),(0,m.default)(s,e),(0,f.default)(s,e),this.scoreData=s,this.cancelStack=n,this.opts=e,this.localTimePos=null,this.measureData=null,this.location=null},r.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},r.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const s=this.getMeasure(),e=I.default.getNbStaves(s),n=this.opts.staffIdx;if(!A.default.isInteger(n)||n<0||n>=e)throw new O.default(n)},r.checkTimePos=function(){const s=this.getLocalTimePos(),e=this.getMeasure(),n=I.default.getNbDivisions(e);if(!A.default.isNumber(s)||s<0||s>=n){const c=I.default.getDpq(e);throw new T.A(s,c)}},r.checkExistence=function(){if(!this.hasPedal())throw new g.A},r.hasPedal=function(){const s=this.getLocalTimePos(),e=this.getMeasure(),n=I.default.getPedals(e,this.opts.staffIdx),c=i(e,this.opts.staffIdx);return(0,P.A)(c,n,s)!==null},r.getLocalTimePos=function(){if(this.localTimePos===null){const s=this.getMeasure();this.localTimePos=(0,h.A)(this.opts,s)}return this.localTimePos},r.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const i=function(s,e){return I.default.hasLeftPedal(s,e)?I.default.getLeftPedal(s,e):null};r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const s=this.getPreviousData();this.removePedal(),this.updateStack(s)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,staffUuid:s.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(e)}},r.getPreviousData=function(){const s=this.getLocalTimePos(),e=this.scoreData.getPartContent(this.opts.partIdx),n=v.A.getMeasures(e),c=(0,u.A)(n,this.opts.measureIdx,this.opts.staffIdx,s),_=this.scoreData.getMeasureUuid(c.startMeasureIdx),E=this.scoreData.getMeasureUuid(c.stopMeasureIdx),x=this.scoreData.getMeasure(this.opts.partIdx,c.startMeasureIdx),p=I.default.getDpq(x),D=this.scoreData.getMeasure(this.opts.partIdx,c.stopMeasureIdx),C=I.default.getDpq(D);return{startMeasureUuid:_,startTimePos:c.startTimePos,stopTimePos:c.stopTimePos,startDpq:p,stopMeasureUuid:E,stopDpq:C,placement:c.placement}},r.removePedal=function(){const s=this.getLocalTimePos(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:s};new l.A(this.scoreData,e,this.cancelStack).perform()},r.updateStack=function(s){const e=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,startMeasureUuid:s.startMeasureUuid,startTimePos:s.startTimePos,startDpq:s.startDpq,stopMeasureUuid:s.stopMeasureUuid,stopTimePos:s.stopTimePos,stopDpq:s.stopDpq,staffUuid:e.staffUuid,placement:s.placement}};this.cancelStack.push(n)},r.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getMeasureUuid(this.opts.measureIdx),n=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:s,staffUuid:n,measureUuid:e}}return this.location},(0,d.default)(a);const o=a},392557:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(20230),O=t(209175),T=t(123491),I=t(793317),A=t(52275),v=t(704621),P=t(981801),U=t(701643),m=t(975924),f=t(42651);const h=function(d,a,r){this.init(d,a,r)};h.NAME="action.DeleteRest";const u=h.prototype;u.name=h.NAME,u.initMeasureData=I.default,u.init=function(d,a,r){(0,A.default)(d,a),(0,v.default)(d,a),(0,P.default)(d,a),this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,this.sanitized=!1,this.voice=null,this.location=null,(0,U.A)(this.measureData,a)},u.checkPreconditions=function(){this.sanitizeIfNeeded(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkRest()},u.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},u.checkRest=function(){this.getVoice().checkRest(this.opts.noteIdx)},u.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},u.perform=function(){const d=this.getPreviousData();this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(d);const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new g.A(this.measureData,a,this.cancelStack).perform(),this.updateStack(d)},u.getPreviousData=function(){const a=this.getVoice().getNote(this.opts.noteIdx),r=T.default.getNbDots(a),i=this.measureData.getDpqValue(),o=(0,m.default)(a,i);let s=T.default.getTimeModif(a);s=O.default.copy(s);const e=T.default.getStaffIdx(a),c=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,e);return{nbDots:r,durationType:o,timeModif:s,staffUuid:c}},u.storeAction=function(d){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r=O.default.copy(d.timeModif),i={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,divisions:a.dpq,timePos:a.timePos,durationType:d.durationType,nbDots:d.nbDots,timeModif:r}};this.cancelStack.storeAction(i)}},u.sanitizeIfNeeded=function(){this.sanitized||(this.sanitized=!0)},u.updateStack=function(d){const a=this.getLocation(),r=O.default.copy(d.timeModif),i={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,staffUuid:d.staffUuid,timePos:a.timePos,divisions:a.dpq,timeModif:r,durationType:d.durationType,nbDots:d.nbDots}};this.cancelStack.push(i)},u.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),a=d.getPartUuid(this.opts.partIdx),r=d.getMeasureUuid(this.opts.measureIdx),i=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:r,voiceUuid:i,dpq:o,timePos:e}}return this.location},(0,f.default)(h);const l=h},401157:(N,M,t)=>{t.r(M),t.d(M,{default:()=>E});var g=t(52275),O=t(217692),T=t(783177),I=t(316610),A=t(701387),v=t(726042),P=t(377180),U=t(364842),m=t(646456),f=t(857552),h=t(303443),u=t(443749),l=t(195446),d=t(31278),a=t(723631),r=t(372585),i=t(773948),o=t(485594),s=t(567198),e=t(42651);const n=function(x,p,D){this.init(x,p,D)};n.NAME="action.AddOctaveShiftAtTimePos";const c=n.prototype;c.name=n.NAME,c.init=function(x,p,D){(0,g.default)(x,p),(0,O.A)(x,p),(0,T.default)(x,p),this.scoreData=x,this.opts=p,this.cancelStack=D,this.location=null,this.transposeAction=null},c.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkValues(),this.sanitize(),this.opts.transpose&&this.checkCanTranspose()},c.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new l.default},c.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange(),this.checkStaffIdx()},c.checkStartTimePos=function(){const x=this.getStartMeasure(),p={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},D=(0,I.A)(p,x),C=A.default.getNbDivisions(x);if(!v.default.isNumber(D)||D<0||D>=C){const B=A.default.getDpq(x);throw new m.A(D,B)}},c.checkStopTimePos=function(){const x=this.getStopMeasure(),p={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},D=(0,I.A)(p,x),C=A.default.getNbDivisions(x);if(!v.default.isNumber(D)||D<0||D>C){const B=A.default.getDpq(x);throw new m.A(D,B)}},c.checkRevertRange=function(){const x=this.opts.startMeasureIdx,p=this.opts.stopMeasureIdx,D=p-x;if(D<0)throw new f.default(f.default.MEASURE,x,p);if(D===0){const C=v.default.lcm(this.opts.startDpq,this.opts.stopDpq),B=this.opts.startTimePos*C/this.opts.startDpq,R=this.opts.stopTimePos*C/this.opts.stopDpq;if(B>R)throw new f.default(f.default.TIME_POS,B,R);if(B===R)throw new h.A(h.A.TIME_POS)}},c.checkStaffIdx=function(){const x=this.getStartMeasure(),p=A.default.getNbStaves(x),D=this.opts.staffIdx;if(!v.default.isInteger(D)||D<0||D>=p)throw new u.default(D)},c.checkValues=function(){a.A.check(this.opts.placement),i.A.check(this.opts.size)},c.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},c.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},c.sanitize=function(){typeof this.opts.transpose=="undefined"&&(this.opts.transpose=!1),typeof this.opts.transposeOverrided=="undefined"&&(this.opts.transposeOverrided=!1),typeof this.opts.preserveTies=="undefined"&&(this.opts.preserveTies=!1),typeof this.opts.updateGraces=="undefined"&&(this.opts.updateGraces=!1),typeof this.opts.updateOverridedGraces=="undefined"&&(this.opts.updateOverridedGraces=!1),typeof this.opts.preserveOverridedTies=="undefined"&&(this.opts.preserveOverridedTies=!1)},c.checkCanTranspose=function(){const x=this.getTransposeAction();try{x.checkPreconditions(),this.canTranspose=!0}catch(p){if(p instanceof f.default||p instanceof d.default)this.canTranspose=!1;else throw p}},c.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.transpose&&this.canTranspose){const x=this.getTransposeAction();x.cancelStack=this.cancelStack,x.perform()}this.addOctaveShift(),this.updateStack()},c.storeAction=function(){if(!this.cancelStack.hasAction()){const x=this.getLocation(),p={actionName:this.name,opts:{partUuid:x.partUuid,startMeasureUuid:x.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:x.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffUuid:x.staffUuid,placement:this.opts.placement,size:this.opts.size,transpose:this.opts.transpose,transposeOverrided:this.opts.transposeOverrided,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,preserveOverridedTies:this.opts.preserveOverridedTies,updateOverridedGraces:this.opts.updateOverridedGraces,preserveColor:!!this.opts.preserveColor}};this.cancelStack.storeAction(p)}},c.getTransposeAction=function(){if(this.transposeAction===null){const x=this.getTransposeValue(),p={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffIdx:this.opts.staffIdx,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,preserveColor:this.opts.preserveColor,transpose:x,checkLine:!1},D=null;this.transposeAction=new o.default(this.scoreData,p,D)}return this.transposeAction},c.getTransposeValue=function(){const x=P.default.createDefault(),p=_(this.opts.placement);let D=i.A.sizeToOctaveShift(this.opts.size);return D*=p,P.default.setOctaveChange(x,D),x};const _=function(x){if(x===a.A.ABOVE)return 1;if(x===a.A.BELOW)return-1;throw new U.default("Unexpedted")};c.addOctaveShift=function(){const x=this.getType(),p={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement,type:x,size:this.opts.size,transposeOverrided:this.opts.transposeOverrided,updateOverridedGraces:this.opts.updateOverridedGraces,preserveOverridedTies:this.opts.preserveOverridedTies,preserveColor:this.opts.preserveColor};new s.A(this.scoreData,p,this.cancelStack).perform()},c.getType=function(){if(this.isAbove())return r.A.DOWN;if(this.isBelow())return r.A.UP;throw new U.default("Unexpedted")},c.isAbove=function(){return this.opts.placement===a.A.ABOVE},c.isBelow=function(){return this.opts.placement===a.A.BELOW},c.updateStack=function(){const x=this.getLocation(),p={type:this.name,noDraw:!0,opts:{partUuid:x.partUuid,measureUuid:x.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffUuid:x.staffUuid}};this.cancelStack.push(p)},c.getLocation=function(){if(this.location===null){const x=this.scoreData.getPartUuid(this.opts.partIdx),p=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),D=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx),C=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:x,staffUuid:C,startMeasureUuid:p,stopMeasureUuid:D}}return this.location},(0,e.default)(n);const E=n},402359:(N,M,t)=>{t.r(M),t.d(M,{default:()=>i});var g=t(436369),O=t(364842),T=t(31278),I=t(153271),A=t(513488),v=t(857899),P=t(269032),U=t(701387),m=t(555172),f=t(918926),h=t(889346),u=t(350357),l=t(704621),d=t(42651);const a=function(o,s,e){this.init(o,s,e)};a.NAME="action.RemoveRepeat";const r=a.prototype;r.name=a.NAME,r.init=function(o,s,e){(0,l.default)(o,s),this.scoreData=o,this.cancelStack=e,this.opts=s,this.location=null},r.checkPreconditions=function(){this.checkLocation(),this.checkType(),this.checkExistence()},r.checkLocation=function(){const o=this.opts.measureIdx,s=this.scoreData.getNbMeasures();if(o<0||o>=s)throw new I.default(o)},r.checkType=function(){if(!P.A.isValidDirection(this.opts.direction))throw new A.A(this.opts.direction)},r.checkExistence=function(){const s=this.scoreData.getMeasure(0,this.opts.measureIdx),e=U.default.getBarlines(s);if(this.opts.direction===P.A.DIRECTION_FORWARD){if(!v.A.hasRepeatForward(e))throw new T.default}else if(this.opts.direction===P.A.DIRECTION_BACKWARD){if(!v.A.hasRepeatBackward(e))throw new T.default}else throw new O.default("Unexpected")},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();let o=null;this.opts.direction===P.A.DIRECTION_BACKWARD&&(o=this.getNbRepeat()),this.removeBarline(),this.opts.direction===P.A.DIRECTION_BACKWARD&&this.clearRightBarline(),this.updateStack(o)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),s={actionName:this.name,opts:{measureUuid:o.measureUuid,direction:this.opts.direction}};this.cancelStack.storeAction(s)}},r.getNbRepeat=function(){const s=this.scoreData.getMeasure(0,this.opts.measureIdx),e=U.default.getRightBarline(s),n=m.A.getRepeat(e);return P.A.getNbRepeat(n)},r.removeBarline=function(){const o={measureIdx:this.opts.measureIdx,side:this.getSide()};new f.A(this.scoreData,o,this.cancelStack).perform()},r.getSide=function(){if(this.opts.direction===P.A.DIRECTION_FORWARD)return u.A.LEFT;if(this.opts.direction===P.A.DIRECTION_BACKWARD)return u.A.RIGHT;throw new O.default("Unexpected")},r.clearRightBarline=function(){const o={measureIdx:this.opts.measureIdx};new h.A(this.scoreData,o,this.cancelStack).perform()},r.updateStack=function(o){const e={measureUuid:this.getLocation().measureUuid,direction:this.opts.direction};e.direction===P.A.DIRECTION_BACKWARD&&(e.times=o);const n={type:this.name,noDraw:!0,opts:e};this.cancelStack.push(n),(0,g.A)(this.cancelStack,this.scoreData,this.opts)},r.getLocation=function(){if(this.location===null){const o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:o}}return this.location},(0,d.default)(a);const i=a},402924:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(862790),O=t(443749),T=t(646456),I=t(701387),A=t(726042),v=t(446921),P=t(544342),U=t(52275),m=t(704621),f=t(783177),h=t(316610),u=t(930109),l=t(59938),d=t(42651);const a=function(s,e,n){this.init(s,e,n)};a.NAME="action.RemoveWedgeClosedAtTimePos";const r=a.prototype;r.name=a.NAME,r.init=function(s,e,n){(0,U.default)(s,e),(0,m.default)(s,e),(0,f.default)(s,e),this.scoreData=s,this.cancelStack=n,this.opts=e,this.localTimePos=null,this.measureData=null,this.location=null},r.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},r.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const s=this.getMeasure(),e=I.default.getNbStaves(s),n=this.opts.staffIdx;if(!A.default.isInteger(n)||n<0||n>=e)throw new O.default(n)},r.checkTimePos=function(){const s=this.getLocalTimePos(),e=this.getMeasure(),n=I.default.getNbDivisions(e);if(!A.default.isNumber(s)||s<0||s>=n){const c=I.default.getDpq(e);throw new T.A(s,c)}},r.checkExistence=function(){if(!this.hasWedge())throw new g.A},r.hasWedge=function(){const s=this.getLocalTimePos(),e=this.getMeasure(),n=I.default.getWedges(e,this.opts.staffIdx),c=i(e,this.opts.staffIdx);return(0,P.A)(c,n,s)!==null},r.getLocalTimePos=function(){if(this.localTimePos===null){const s=this.getMeasure();this.localTimePos=(0,h.A)(this.opts,s)}return this.localTimePos},r.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const i=function(s,e){return I.default.hasLeftWedge(s,e)?I.default.getLeftWedge(s,e):null};r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const s=this.getPreviousData();this.removeWedge(),this.updateStack(s)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,staffUuid:s.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(e)}},r.getPreviousData=function(){const s=this.getLocalTimePos(),e=this.scoreData.getPartContent(this.opts.partIdx),n=v.A.getMeasures(e),c=(0,u.A)(n,this.opts.measureIdx,this.opts.staffIdx,s),_=this.scoreData.getMeasureUuid(c.startMeasureIdx),E=this.scoreData.getMeasureUuid(c.stopMeasureIdx),x=this.scoreData.getMeasure(this.opts.partIdx,c.startMeasureIdx),p=I.default.getDpq(x),D=this.scoreData.getMeasure(this.opts.partIdx,c.stopMeasureIdx),C=I.default.getDpq(D);return{startMeasureUuid:_,startTimePos:c.startTimePos,stopTimePos:c.stopTimePos,startDpq:p,stopMeasureUuid:E,stopDpq:C,placement:c.placement,type:c.type}},r.removeWedge=function(){const s=this.getLocalTimePos(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:s};new l.A(this.scoreData,e,this.cancelStack).perform()},r.updateStack=function(s){const e=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,startMeasureUuid:s.startMeasureUuid,startTimePos:s.startTimePos,startDpq:s.startDpq,stopMeasureUuid:s.stopMeasureUuid,stopTimePos:s.stopTimePos,stopDpq:s.stopDpq,staffUuid:e.staffUuid,placement:s.placement,type:s.type}};this.cancelStack.push(n)},r.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getMeasureUuid(this.opts.measureIdx),n=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:s,staffUuid:n,measureUuid:e}}return this.location},(0,d.default)(a);const o=a},412502:(N,M,t)=>{t.r(M),t.d(M,{default:()=>a});var g=t(279140),O=t(99923),T=t(123491),I=t(737903),A=t(515819),v=t(737296),P=t(349386),U=t(972913),m=t(974106),f=t(492380),h=t(793317),u=t(42651);const l=function(r,i,o){this.init(r,i,o)};l.NAME="action.AddChordPercuCrossMeasure2";const d=l.prototype;d.initMeasureData=h.default,d.name=l.NAME,d.init=function(r,i,o){this.initMeasureData(r,i),this.cancelStack=o,this.opts=i,this.addChordPercuAction=null},d.checkPreconditions=function(){(0,U.default)(this.opts),this.checkUnpitchedPart(),this.checkLocation(),this.checkAvailableSpace(),this.checkNoteData()},d.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new O.A},d.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},d.checkAvailableSpace=function(){let r=this.getRequiredDuration();const i=this.getActualDuration();if(!(i>r)){{if(i===r)return;r-=i}if(this.isTuplet()){const o=this.getAvailableSpace();o<r&&this.raiseNotEnoughSpace(r,o)}}},d.getRequiredDuration=function(){const r=this.measureData.getDpqValue(),i=this.getTimeModif();return(0,P.default)(this.opts,r,i)},d.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},d.getActualDuration=function(){const i=this.getVoice().getNote(this.opts.noteIdx);return T.default.getDuration(i)},d.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},d.getAvailableSpace=function(){const r=this.getVoiceOrTupletForGet(),i=this.opts.noteIdx+1;return r.getSpaceFromIdx(i)},d.raiseNotEnoughSpace=function(r,i){const o=this.getVoiceOrTupletForGet(),s=this.measureData.getDpqValue(),e=o.getAbsoluteTimeModif();throw new g.default(r,i,s,e)},d.getVoiceOrTupletForGet=function(){const r=this.opts.voiceIdx,i=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(r,i)},d.checkNoteData=function(){this.getAddChordPercuAction().checkPreconditions()},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addNote();const r=this.getRequiredDuration();this.getActualDuration()!==r&&this.changeDuration()},d.addNote=function(){const r=this.getAddChordPercuAction();r.cancelStack=this.cancelStack,r.perform()},d.getAddChordPercuAction=function(){if(this.addChordPercuAction===null){const r=this.getActualDurationOpts(),i=(0,I.default)(this.opts.instruments),o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,insertMode:v.default.REPLACE,durationType:r.durationType,nbDots:r.nbDots,instruments:i};this.addChordPercuAction=new f.default(this.measureData,o,this.cancelStack)}return this.addChordPercuAction},d.getActualDurationOpts=function(){const i=this.getVoice().getNote(this.opts.noteIdx),o=this.measureData.getDpqValue(),s=T.default.getNormalQuarterDuration(i,o);return A.default.quarterToDurationOpts(s)},d.changeDuration=function(){const r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots},i=new m.default(this.measureData,r,this.cancelStack);i.checkPreconditions(),i.perform()},d.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,u.default)(l);const a=l},417843:(N,M,t)=>{t.r(M),t.d(M,{default:()=>x});var g=t(195446),O=t(737903),T=t(351277),I=t(614426),A=t(259563),v=t(19405),P=t(172788),U=t(610860),m=t(476031),f=t(33674),h=t(573559),u=t(52275),l=t(704621),d=t(981801),a=t(783177),r=t(898039),i=t(8963),o=t(714898),s=t(586142),e=t(793317),n=t(42651);const c=function(p,D,C){this.init(p,D,C)};c.NAME="action.InsertGraceNote";const _=c.prototype;_.name=c.NAME,_.initMeasureData=e.default,_.init=function(p,D,C){(0,u.default)(p,D),(0,l.default)(p,D),(0,d.default)(p,D),(0,a.default)(p,D),this.initMeasureData(p,D),this.cancelStack=C,this.opts=D,(0,r.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null},_.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.checkPitch(),this.opts.checkLine&&(0,h.A)(this.measureData,this.opts),(0,i.A)(this.measureData,this.opts)},_.checkValues=function(){A.default.check(this.opts.durationType),(0,v.default)(this.opts),this.opts.accidental!==null&&I.default.check(this.opts.accidental)},_.checkPitch=function(){T.default.check(this.opts.pitch)},_.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g.default},_.checkCompatibleVoiceStaffIdx=function(){(0,f.default)(this.measureData,this.opts)},_.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},_.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},_.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.insertGraceNote(),this.updateStack()},_.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,o.default)(this.measureData,this.opts),E(this.measureData,this.opts),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)};const E=function(p,D){const B=p.getVoice(D.voiceIdx).getNbGraces(D.noteIdx);D.graceIdx<B?(0,P.A)(p,D):(0,U.A)(p,D)};_.storeAction=function(){if(!this.cancelStack.hasAction()){const p=this.getLocation(),D={actionName:this.name,opts:{partUuid:p.partUuid,measureUuid:p.measureUuid,voiceUuid:p.voiceUuid,staffUuid:p.staffUuid,graceIdx:this.opts.graceIdx,timePos:p.timePos,divisions:p.dpq,durationType:this.opts.durationType,pitch:T.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine,removeGlissandos:!!this.opts.removeGlissandos,sameStringAsPreviousNotes:!!this.opts.sameStringAsPreviousNotes}};typeof this.opts.fretData!="undefined"&&(D.opts.fretData=(0,O.default)(this.opts.fretData)),this.cancelStack.storeAction(D)}},_.insertGraceNote=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType,fretData:this.opts.fretData,pitch:T.default.copy(this.opts.pitch),removeGlissandos:!!this.opts.removeGlissandos,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new s.A(this.measureData,p,this.cancelStack).perform()},_.updateStack=function(){const p=this.getLocation(),D={type:this.name,noDraw:!0,opts:{partUuid:p.partUuid,measureUuid:p.measureUuid,voiceUuid:p.voiceUuid,graceIdx:this.opts.graceIdx,timePos:p.timePos,divisions:p.dpq}};this.cancelStack.push(D)},_.getLocation=function(){if(this.location===null){const p=this.measureData.getScoreData(),D=p.getPartUuid(this.opts.partIdx),C=p.getMeasureUuid(this.opts.measureIdx),B=p.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),R=p.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),L=this.measureData.getDpqValue(),W=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:D,measureUuid:C,staffUuid:B,voiceUuid:R,dpq:L,timePos:W}}return this.location},(0,n.default)(c);const x=c},422259:(N,M,t)=>{t.r(M),t.d(M,{default:()=>B});var g=t(195446),O=t(753932),T=t(8567),I=t(57572),A=t(748803),v=t(883782),P=t(837283),U=t(993608),m=t(737903),f=t(726042),h=t(701387),u=t(377180),l=t(351277),d=t(515819),a=t(733291),r=t(857579),i=t(33674),o=t(52275),s=t(704621),e=t(564748),n=t(42651);const c=function(R,L,k){this.init(R,L,k)};c.NAME="action.AddChordCrossMeasure",c.convertPitchesToHeads=function(R){const L=R.pitches;delete R.pitches,R.heads=L.map(D)};const _=c.prototype;_.name=c.NAME,_.init=function(R,L,k){(0,o.default)(R,L),(0,s.default)(R,L),this.scoreData=R,this.cancelStack=k,this.opts=L,this.location=null,this.sanitized=!1,this.measureData=null},_.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.sanitizeIfNeeded(),this.checkPitches(),this.checkPosition(),this.checkDuration()},_.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new g.default},_.checkLocation=function(){this.getMeasureData(),this.checkVoiceIdx(),(0,i.default)(this.scoreData,this.opts);const R=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),L=h.default.getQuarterDuration(R),k=this.opts.quarterPosition;if(!f.default.isNumber(k)||k<0||k>=L)throw new T.A(k)},_.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new v.default(this.opts.voiceIdx)},_.getMeasureData=function(){if(this.measureData===null){const R=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.measureData=new r.A(R)}return this.measureData},_.checkPitches=function(){if(this.opts.heads.length===0)throw new O.A;this.opts.heads.forEach(E),this.checkPitchCollision()};const E=function(R){l.default.check(R.pitch)};_.checkPitchCollision=function(){const R=this.opts.heads.map(x);R.sort(l.default.compareLine);const L=R.length;for(let k=0;k<L-1;k++){const W=R[k],G=R[k+1];if(l.default.isSameLine(W,G)){const j=l.default.copyWithoutAlter(W);throw new A.default(A.default.INSERT,j)}}};const x=function(R){return l.default.copy(R.pitch)};_.checkPosition=function(){const R=this.opts.quarterPosition;if(!d.default.isValidQuarter(R))throw new P.A(R)},_.checkDuration=function(){const R=this.opts.quarterDuration;if(d.default.isValidQuarter(R)){if(R===0)throw new I.A(R)}else throw new U.A(R)},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addChordCrossMeasure()},_.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.pitches!="undefined"&&this.convertPitchesToHeads(),this.opts.isConcertPitch&&this.transposePitches(),this.sanitized=!0)},_.convertPitchesToHeads=function(){c.convertPitchesToHeads(this.opts)},_.transposePitches=function(){const L=this.getMeasureData().getTranspose(this.opts.staffIdx);if(!u.default.isUnison(L)){let k=this.opts.heads.map(p);k=(0,e.A)(k,L),this.opts.heads=k.map(D)}};const p=function(R){return R.pitch},D=function(R){return R=l.default.copy(R),{pitch:R}};_.addChordCrossMeasure=function(){const R=this.opts.heads.map(C),L={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,heads:R};new a.A(this.scoreData,L,this.cancelStack).perform()};const C=function(R){const k={pitch:l.default.copy(R.pitch)};return typeof R.fretData!="undefined"&&(k.fretData=(0,m.default)(R.fretData)),k};_.storeAction=function(){if(!this.cancelStack.hasAction()){const R=this.getLocation(),L={actionName:this.name,opts:{partUuid:R.partUuid,measureUuid:R.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,heads:this.opts.heads.map(C)}};this.cancelStack.storeAction(L)}},_.getLocation=function(){if(this.location===null){const R=this.scoreData.getPartUuid(this.opts.partIdx),L=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:R,measureUuid:L}}return this.location},(0,n.default)(c);const B=c},429240:(N,M,t)=>{t.r(M),t.d(M,{default:()=>U});var g=t(704621),O=t(153271),T=t(31278),I=t(21467),A=t(42651);const v=function(m,f,h){this.init(m,f,h)};v.NAME="action.RemovePageBreak";const P=v.prototype;P.name=v.NAME,P.init=function(m,f,h){(0,g.default)(m,f),this.scoreData=m,this.opts=f,this.cancelStack=h,this.location=null},P.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},P.checkLocation=function(){const m=this.scoreData.getNbMeasures(),f=this.opts.measureIdx;if(f<0||f>=m)throw new O.default(f,O.default.GET)},P.checkExistence=function(){if(!this.getCommonContent().hasPageBreak(this.opts.measureIdx))throw new T.default},P.getCommonContent=function(){return this.scoreData.getCommonContent()},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const f=this.getCommonContent().getPageBreak(this.opts.measureIdx);this.storeAction(f);const h={measureIdx:this.opts.measureIdx};new I.A(this.scoreData,h,this.cancelStack).perform(),this.updateStack(f)},P.updateStack=function(m){const f=this.getLocation(),h={type:this.name,noDraw:!0,opts:{measureUuid:f.measureUuid,measureIdx:this.opts.measureIdx,value:m}};this.cancelStack.push(h),this.cancelStack.stateNeedCompleteRedraw()},P.storeAction=function(m){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{measureUuid:f.measureUuid,measureIdx:this.opts.measureIdx,value:m}};this.cancelStack.storeAction(h)}},P.getLocation=function(){if(this.location===null){const m=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:m}}return this.location},(0,A.default)(v);const U=v},434497:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(646456),O=t(96410),T=t(351692),I=t(726042),A=t(701387),v=t(614653),P=t(744163),U=t(316610),m=t(52275),f=t(704621),h=t(798459),u=t(42651),l=t(640231);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddClassicHarmonyAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,m.default)(i,o),(0,f.default)(i,o),this.scoreData=i,this.cancelStack=s,this.opts=o,this.sanitized=!1,this.localTimePos=null,this.measure=null,this.location=null},a.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkValue(),this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos()},a.checkValue=function(){(0,h.A)(this.opts),this.opts.chordFunction=v.default.getGoodCaseChordFunction(this.opts.chordFunction,this.opts.kind),l.A.isAugmentedSixth(this.opts.kind)&&(this.opts.inversion=O.A.AUGMENTED_SIXTH,this.opts.chordFunction="IV"),this.opts.secondaryFunction&&(this.opts.secondaryFunction=v.default.getGoodCaseChordFunction(this.opts.secondaryFunction,this.opts.secondaryKind),l.A.isAugmentedSixth(this.opts.secondaryKind)&&(this.opts.secondaryInversion=O.A.AUGMENTED_SIXTH,this.opts.secondaryFunction="IV"))},a.checkTimePos=function(){const i=this.getLocalTimePos(),o=this.getMeasure(),s=A.default.getNbDivisions(o);if(!I.default.isNumber(i)||i<0||i>=s){const e=A.default.getDpq(o);throw new g.A(i,e)}},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addClassicHarmony(),this.updateStack()},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.inversion=="undefined"&&(this.opts.inversion=O.A.DEFAULT),typeof this.opts.alter=="undefined"&&(this.opts.alter=T.A.DEFAULT),this.opts.secondaryFunction&&(typeof this.opts.secondaryInversion=="undefined"&&(this.opts.secondaryInversion=O.A.DEFAULT),typeof this.opts.secondaryAlter=="undefined"&&(this.opts.secondaryAlter=T.A.DEFAULT)),this.sanitized=!0)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={partUuid:i.partUuid,measureUuid:i.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos,chordFunction:this.opts.chordFunction,alter:this.opts.alter,kind:this.opts.kind,inversion:this.opts.inversion};this.opts.secondaryFunction&&(o.secondaryFunction=this.opts.secondaryFunction,o.secondaryAlter=this.opts.secondaryAlter,o.secondaryKind=this.opts.secondaryKind,o.secondaryInversion=this.opts.secondaryInversion);const s={actionName:this.name,opts:o};this.cancelStack.storeAction(s)}},a.addClassicHarmony=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,chordFunction:this.opts.chordFunction,alter:this.opts.alter,kind:this.opts.kind,inversion:this.opts.inversion};this.opts.secondaryFunction&&(i.secondaryFunction=this.opts.secondaryFunction,i.secondaryAlter=this.opts.secondaryAlter,i.secondaryKind=this.opts.secondaryKind,i.secondaryInversion=this.opts.secondaryInversion),new P.A(this.scoreData,i,this.cancelStack).perform()},a.getLocalTimePos=function(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,U.A)(this.opts,i)}return this.localTimePos},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},a.updateStack=function(){const i=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(o)},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:i,measureUuid:o}}return this.location},(0,u.default)(d);const r=d},460547:(N,M,t)=>{t.r(M),t.d(M,{default:()=>i});var g=t(228785),O=t(857552),T=t(303443),I=t(123491),A=t(52275),v=t(217692),P=t(809577),U=t(2110),m=t(739293),f=t(713735),h=t(981801),u=t(146543),l=t(42651),d=t(435808);const a=function(o,s,e){this.init(o,s,e)};a.NAME="action.AddSlur";const r=a.prototype;r.name=a.NAME,r.init=function(o,s,e){(0,A.default)(o,s),(0,v.A)(o,s),(0,h.default)(o,s),this.measuresScroller=(0,U.A)(o,s),this.cancelStack=e,this.opts=s,(0,P.A)(this.measuresScroller,this.opts),this.location=null},r.checkPreconditions=function(){this.opts.placement=this.opts.placement||d.A.DEFAULT,this.checkLocation(),this.checkNotRest(),this.opts.overwrite||this.checkOverlap(),d.A.check(this.opts.placement)},r.checkLocation=function(){this.measuresScroller.checkMeasureIdx(this.opts.startMeasureIdx);const o=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);o.checkVoiceIdx(this.opts.voiceIdx),o.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.startNoteIdx),this.measuresScroller.checkMeasureIdx(this.opts.stopMeasureIdx);const e=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);e.checkVoiceIdx(this.opts.voiceIdx),e.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.stopNoteIdx),this.checkRevertRange()},r.checkRevertRange=function(){const o=this.opts.startMeasureIdx,s=this.opts.stopMeasureIdx,e=s-o;if(e<0)throw new O.default(O.default.MEASURE,o,s);if(e===0){const n=this.opts.startNoteIdx,c=this.opts.stopNoteIdx;if(n>c)throw new O.default(O.default.NOTE,n,c);if(n===c)throw new T.A(T.A.NOTE)}},r.checkNotRest=function(){this.measuresScroller.getMeasureData(this.opts.startMeasureIdx).getVoice(this.opts.voiceIdx).checkNotRest(this.opts.startNoteIdx),this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx).getVoice(this.opts.voiceIdx).checkNotRest(this.opts.stopNoteIdx)},r.checkOverlap=function(){this.checkInternalSlur(),this.checkLeftSlur(),this.checkRightSlur()},r.checkInternalSlur=function(){const o=this.opts.startMeasureIdx,s=this.opts.stopMeasureIdx;let e=null;const n=this.opts.startNoteIdx,c=this.opts.stopNoteIdx;for(let _=o;_<=s;_++){const E=this.measuresScroller.getMeasureData(_);if(!E.hasVoice(this.opts.voiceIdx))continue;const x=E.getVoice(this.opts.voiceIdx);let p;for(_!==s?p=x.getNbNotes()-1:p=c,e===null?e=n:e=0;e<=p;e++){const D=x.getNote(e);if(I.default.hasSlur(D))throw new g.A}}},r.checkLeftSlur=function(){const o={measureIdx:this.opts.startMeasureIdx,noteIdx:this.opts.startNoteIdx,voiceIdx:this.opts.voiceIdx};if((0,m.A)(this.measuresScroller,o)!==null)throw new g.A},r.checkRightSlur=function(){const o={measureIdx:this.opts.stopMeasureIdx,noteIdx:this.opts.stopNoteIdx,voiceIdx:this.opts.voiceIdx};if((0,f.A)(this.measuresScroller,o)!==null)throw new g.A},r.getVoice=function(){return this.measuresScroller.getVoice(this.opts.voiceIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const o={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,startNoteIdx:this.opts.startNoteIdx,stopNoteIdx:this.opts.stopNoteIdx,overwrite:!!this.opts.overwrite,placement:this.opts.placement};new u.A(this.measuresScroller,o,this.cancelStack).perform(),this.updateStack()},r.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),s={actionName:this.name,opts:{partUuid:o.partUuid,startMeasureUuid:o.startMeasureUuid,startDivisions:o.startDpq,startTimePos:o.startTimePos,stopMeasureUuid:o.stopMeasureUuid,stopDivisions:o.stopDpq,stopTimePos:o.stopTimePos,voiceUuid:o.voiceUuid,overwrite:!!this.opts.overwrite,placement:this.opts.placement}};this.cancelStack.storeAction(s)}},r.updateStack=function(){const o=this.getLocation(),s={type:this.name,noDraw:!0,opts:{partUuid:o.partUuid,measureUuid:o.startMeasureUuid,divisions:o.startDpq,timePos:o.startTimePos,voiceUuid:o.voiceUuid}};this.cancelStack.push(s)},r.getLocation=function(){if(this.location===null){const o=this.measuresScroller.getScoreData(),s=o.getPartUuid(this.opts.partIdx),e=o.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=o.getMeasureUuid(this.opts.startMeasureIdx),c=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx),_=c.getDpqValue(),x=c.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.startNoteIdx),p=o.getMeasureUuid(this.opts.stopMeasureIdx),D=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx),C=D.getDpqValue(),R=D.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.stopNoteIdx);this.location={partUuid:s,startMeasureUuid:n,voiceUuid:e,startDpq:_,startTimePos:x,stopMeasureUuid:p,stopDpq:C,stopTimePos:R}}return this.location},(0,l.default)(a);const i=a},478996:(N,M,t)=>{t.r(M),t.d(M,{default:()=>k});var g=t(364842),O=t(31278),T=t(883782),I=t(737903),A=t(726042),v=t(123491),P=t(292681),U=t(209175),m=t(515819),f=t(737296),h=t(878363),u=t(831121),l=t(2835),d=t(52275),a=t(704621),r=t(981801),i=t(783177),o=t(898039),s=t(655035),e=t(244138),n=t(82028),c=t(405347),_=t(474188),E=t(939193),x=t(942867),p=t(793317),D=t(33674),C=t(372933),B=t(42651);const R=function(W,G,j){this.init(W,G,j)};R.NAME="action.AddNotePercu";const L=R.prototype;L.name=R.NAME,L.initMeasureData=p.default,L.init=function(W,G,j){(0,d.default)(W,G),(0,a.default)(W,G),(0,r.default)(W,G),(0,i.default)(W,G),this.initMeasureData(W,G),this.cancelStack=j,this.opts=G,this.actions=[],this.location=null},L.checkPreconditions=function(){this.checkCommonElements(),this.hasNoteRef()&&this.convertNoteRef(),this.checkTimeLocation(),this.isVoiceDisplayed()&&this.isChord()&&this.opts.insertMode===f.default.REPLACE?(this.hasNoteIdx()||this.inferNoteIdx(),this.addChordActions()):this.addSingleNoteAction()},L.checkCommonElements=function(){this.checkUnpitched(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx(),this.sanitize()},L.checkUnpitched=function(){(0,u.default)(this.measureData)},L.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new T.default(this.opts.voiceIdx)},L.checkCompatibleVoiceStaffIdx=function(){(0,D.default)(this.measureData,this.opts)},L.sanitize=function(){typeof this.opts.line!="undefined"&&(0,l.default)(this.measureData,this.opts),typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=f.default.REPLACE)},L.hasNoteRef=function(){return typeof this.opts.noteIdxRef=="number"&&typeof this.opts.voiceIdxRef=="number"},L.convertNoteRef=function(){(0,C.default)(this.measureData,this.opts)},L.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else if(this.hasNoteIdx())this.checkNoteIdx();else throw new g.default("Unexpected")},L.hasTimePos=function(){return typeof this.opts.timePos=="number"&&typeof this.opts.divisions=="number"&&typeof this.opts.timeModif!="undefined"},L.checkTimePos=function(){const W=this.measureData.getMeasure();(0,e.default)(W,this.opts.timePos,this.opts.divisions)},L.hasNoteIdx=function(){return typeof this.opts.noteIdx=="number"},L.checkNoteIdx=function(){const W=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.insertMode===f.default.REPLACE)W.checkNoteIdx(this.opts.noteIdx);else if(this.opts.insertMode===f.default.INSERT)W.checkInsertionIdx(this.opts.noteIdx);else throw new g.default("unreachable")},L.inferNoteIdx=function(){(0,o.default)(this.measureData,this.opts)},L.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},L.isChord=function(){let W;const G=this.measureData.getVoice(this.opts.voiceIdx);if(this.hasNoteIdx())W=this.opts.noteIdx;else if(this.hasTimePos()){const j=this.measureData.getDpqValue(),y=A.default.lcm(j,this.opts.divisions),X=this.opts.timePos*y/this.opts.divisions,F=y/j;W=(0,n.default)(G,F,X)}else throw new g.default("Unexpected");return!G.isRest(W)},L.addChordActions=function(){if(this.addHeadInsertion(),this.noChange()&&this.addHeadChange(),this.needChangeDuration()&&this.addDurationChange(),this.noChange())throw new O.default},L.addHeadChange=function(){const W=(0,I.default)(this.opts);this.addAction(E.default,W)},L.addHeadInsertion=function(){const W=(0,I.default)(this.opts);this.addAction(x.default,W)},L.needChangeDuration=function(){const W=m.default.durationOptsToQuarter(this.opts),j=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),y=this.measureData.getDpqValue(),X=v.default.getNormalQuarterDuration(j,y);return W!==X},L.addDurationChange=function(){const W=(0,I.default)(this.opts);this.addAction(c.default,W)},L.addAction=function(W,G){const j=new W(this.measureData,G,this.cancelStack);try{j.checkPreconditions(),this.actions.push(j)}catch(y){if(!W.isNoChange(y))throw y}},L.noChange=function(){return this.actions.length===0},L.addSingleNoteAction=function(){const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:P.default.copy(this.opts.unpitched),notehead:this.opts.notehead,insertMode:this.opts.insertMode,keepFormer:this.opts.keepFormer};if(this.hasTimePos())W.divisions=this.opts.divisions,W.timePos=this.opts.timePos,W.timeModif=U.default.copy(this.opts.timeModif);else if(this.hasNoteIdx())W.noteIdx=this.opts.noteIdx;else throw new g.default("Unexpected");const G=new _.default(this.measureData,W,this.cancelStack);G.checkPreconditions(),this.opts.noteIdx=G.opts.noteIdx,this.actions.push(G)},L.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performActions()},L.storeAction=function(){var W;if(!this.cancelStack.hasAction()){const G=this.getLocation(),j=P.default.copy(this.opts.unpitched),y=U.default.copy(G.timeModif);let X=this.opts.notehead;typeof this.opts.notehead=="undefined"&&(X=(0,s.default)(this.measureData,this.opts.partIdx,j));const F={actionName:this.name,opts:{partUuid:G.partUuid,measureUuid:G.measureUuid,voiceUuid:G.voiceUuid,staffUuid:G.staffUuid,divisions:G.dpq,timePos:G.timePos,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:j,notehead:X,insertMode:this.opts.insertMode,timeModif:y,formatRests:!!this.opts.formatRests,keepFormer:!!this.opts.keepFormer,source:(W=this.opts.source)!=null?W:h.default.UNKNOWN}};this.cancelStack.storeAction(F)}},L.performActions=function(){this.actions.forEach(this.performAction,this)},L.performAction=function(W){W.cancelStack=this.cancelStack,W.perform()},L.getLocation=function(){if(this.location===null){const W=this.measureData.getScoreData(),G=W.getPartUuid(this.opts.partIdx),j=W.getMeasureUuid(this.opts.measureIdx),y=W.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),X=W.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),F=this.measureData.getDpqValue(),J=this.measureData.getVoice(this.opts.voiceIdx),w=J.getRangeSpace(0,this.opts.noteIdx),b=J.getNote(this.opts.noteIdx);let Z=v.default.getTimeModif(b);Z=U.default.copy(Z),this.location={partUuid:G,measureUuid:j,staffUuid:y,voiceUuid:X,dpq:F,timePos:w,timeModif:Z}}return this.location},(0,B.default)(R);const k=R},492380:(N,M,t)=>{t.r(M),t.d(M,{default:()=>d});var g=t(753932),O=t(247739),T=t(292681),I=t(104907),A=t(478996),v=t(793317),P=t(519405),U=t(831121),m=t(404747),f=t(42651);const h=function(a,r,i){this.init(a,r,i)};h.NAME="action.AddChordPercu";const u=h.prototype;u.name=h.NAME,u.initMeasureData=v.default,u.init=function(a,r,i){this.initMeasureData(a,r),this.cancelStack=i,this.opts=r,this.actions=null},u.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkInstruments(),this.checkNoteIdx(),this.checkRest(),this.getActions()[0].checkPreconditions()},u.checkUnpitched=function(){(0,U.default)(this.measureData)},u.checkInstruments=function(){if(this.opts.instruments.length===0)throw new g.A;this.opts.instruments.forEach(this.checkInstrument,this),this.checkPitchCollision()},u.checkInstrument=function(a){const r=T.default.copy(a.unpitched),i={partIdx:this.opts.partIdx,notehead:a.notehead,unpitched:r};(0,m.A)(this.measureData,i)},u.checkPitchCollision=function(){const a=this.opts.instruments.map(l).slice();a.sort(T.default.compare);const r=a.length;for(let i=0;i<r-1;i++){const o=a[i],s=a[i+1];if(T.default.isSameLine(o,s)){const e=T.default.copy(o),n=this.measureData.getStaffDetails(this.opts.staffIdx),c=I.default.getNbStaffLines(n);throw new O.A(O.A.INSERT,e,c)}}};const l=function(a){return a.unpitched};u.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},u.checkRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkRest(this.opts.noteIdx)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);let a=this.getActions();a[0].cancelStack=this.cancelStack,a[0].perform(),a=a.slice(1),a.forEach(this.performSubAction,this)},u.performSubAction=function(a){a.cancelStack=this.cancelStack,(0,P.default)(a)},u.getActions=function(){return this.actions===null&&(this.actions=this.opts.instruments.map(this.createAction,this)),this.actions},u.createAction=function(a){const r=T.default.copy(a.unpitched),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,unpitched:r,notehead:a.notehead,insertMode:this.opts.insertMode},o=null;return new A.default(this.measureData,i,o)},(0,f.default)(h);const d=h},515561:(N,M,t)=>{t.r(M),t.d(M,{default:()=>e});var g=t(31278),O=t(195446),T=t(748803),I=t(123491),A=t(351277),v=t(321562),P=t(578918),U=t(19405),m=t(476031),f=t(898039),h=t(52275),u=t(704621),l=t(981801),d=t(783177),a=t(287296),r=t(793317),i=t(42651);const o=function(n,c,_){this.init(n,c,_)};o.NAME="action.AddCourtesyAccidentals",o.isNoChange=function(n){return n instanceof g.default};const s=o.prototype;s.name=o.NAME,s.initMeasureData=r.default,s.init=function(n,c,_){(0,h.default)(n,c),(0,u.default)(n,c),(0,l.default)(n,c),(0,d.default)(n,c),this.initMeasureData(n,c),this.cancelStack=_,this.opts=c,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,f.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkNoCourtesy()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},s.checkValues=function(){(0,U.default)(this.opts)},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts)},s.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const c=A.default.copy(this.opts.pitch);throw new T.default(T.default.GET,c)}},s.checkNoCourtesy=function(){const n=this.getNoteAtPitch();if(I.default.hasCourtesyAccidental(n))throw new g.default},s.getNoteAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,P.default)(n,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addCourtesyAccidental(),this.updateStack()},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),c={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},_={actionName:this.name,opts:c};this.cancelStack.storeAction(_)}},s.addCourtesyAccidental=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copy(this.opts.pitch)};new v.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(){const n=this.getLocation(),c={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch)},_={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(_)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),c=n.getPartUuid(this.opts.partIdx),_=n.getMeasureUuid(this.opts.measureIdx),E=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),x=this.measureData.getDpqValue(),D=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:c,measureUuid:_,voiceUuid:E,dpq:x,timePos:D,isConcertPitch:!1}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,i.default)(o);const e=o},526881:(N,M,t)=>{t.r(M),t.d(M,{default:()=>x});var g=t(364842),O=t(153271),T=t(483139),I=t(986084),A=t(592999),v=t(694816),P=t(889346),U=t(355102),m=t(739253),f=t(846181),h=t(704275),u=t(160580),l=t(853204),d=t(726042),a=t(737903),r=t(210888),i=t(601770),o=t(701387),s=t(201060),e=t(411782),n=t(852363),c=t(42651);const _=function(p,D,C){this.init(p,D,C)};_.NAME="action.AddMeasure";const E=_.prototype;E.name=_.NAME,E.init=function(p,D,C){this.scoreData=p,this.cancelStack=C,this.opts=D},E.checkPreconditions=function(){if(this.hasGivenMeasureUuid()){if(!this.isValidUuid(this.opts.measureUuid))throw new T.A(this.opts.measureUuid,T.A.INSERT);if(this.scoreData.hasMeasureIdxByUuid(this.opts.measureUuid))throw new I.A(this.opts.measureUuid);if(this.hasGivenPreviousUuid()&&this.opts.measureUuid===this.opts.previousUuid)throw new A.A(this.opts.measureUuid,A.A.MEASURE);if(this.hasGivenNextUuid()&&this.opts.measureUuid===this.opts.nextUuid)throw new A.A(this.opts.measureUuid,A.A.MEASURE)}if(this.hasGivenPreviousUuid()||this.hasGivenNextUuid())this.checkLocationUuids();else{const p=this.scoreData.getNbMeasures(),D=this.opts.measureIdx;if(!d.default.isInteger(D)||D<0||D>p)throw new O.default(D,O.default.INSERT)}},E.checkLocationUuids=function(){(0,e.A)(this.scoreData,this.opts)},E.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(this.hasGivenPreviousUuid()||this.hasGivenNextUuid())&&(this.opts.measureIdx=this.getIdxFromUuids());const p=this.getLocation();this.addMeasureHeader(),this.storeAction(p),this.isInsertingAtEnd()||(this.removeTies(),this.removeHammerOnPullOffs(),this.removeGlissandos(),this.removeSlides()),this.addMeasures(),this.addCommonContentMeasure(),this.updateOwnTime(),this.hasInsertedAtEnd()&&this.updateFinalBarlines(),this.hasInsertedAtStart()&&this.updateNextOwnTime(),this.signalAttributesUpdated(),this.updateStack()},E.isInsertingAtEnd=function(){const D=this.scoreData.getPartContent(0).measure;return this.opts.measureIdx===D.length},E.removeTies=function(){const p=(0,a.default)(this.opts);new U.A(this.scoreData,p,this.cancelStack).perform()},E.removeHammerOnPullOffs=function(){const p=(0,a.default)(this.opts);new m.A(this.scoreData,p,this.cancelStack).perform()},E.removeGlissandos=function(){const p=(0,a.default)(this.opts);new f.A(this.scoreData,p,this.cancelStack).perform()},E.removeSlides=function(){const p=(0,a.default)(this.opts);new h.A(this.scoreData,p,this.cancelStack).perform()},E.addMeasures=function(){this.scoreData.getPartsContents().forEach(function(D,C){const B=this.adaptOption(this.opts,C);new v.A(this.scoreData,B,this.cancelStack).perform()},this)},E.addCommonContentMeasure=function(){const p={measureIdx:this.opts.measureIdx};new u.A(this.scoreData,p,this.cancelStack).perform()},E.addMeasureHeader=function(){const p=this.createMeasureHeader();this.scoreData.insertMeasureHeader(p,this.opts.measureIdx)},E.createMeasureHeader=function(){return this.hasGivenMeasureUuid()?i.A.create(this.opts.measureUuid):{}},E.updateOwnTime=function(){const p={startMeasureIdx:this.opts.measureIdx,stopMeasureIdx:this.opts.measureIdx};new l.A(this.scoreData,p,this.cancelStack).perform()},E.hasInsertedAtEnd=function(){const D=this.scoreData.getPartContent(0).measure;return this.opts.measureIdx===D.length-1},E.updateFinalBarlines=function(){const p={measureIdx:this.opts.measureIdx};new P.A(this.scoreData,p,this.cancelStack).perform(),this.removePreviousEndingBarlineIfAny()},E.removePreviousEndingBarlineIfAny=function(){const D=this.scoreData.getMeasure(0,this.opts.measureIdx-1);if(o.default.hasFinalBarline(D)){const C={measureIdx:this.opts.measureIdx-1};new P.A(this.scoreData,C,this.cancelStack).perform()}},E.hasInsertedAtStart=function(){return this.opts.measureIdx===0},E.signalAttributesUpdated=function(){this.opts.measureIdx>0&&this.signalMeasureAttributesUpdated(this.opts.measureIdx-1);const p=this.scoreData.getNbMeasures();this.opts.measureIdx+1<p&&this.signalMeasureAttributesUpdated(this.opts.measureIdx+1)},E.signalMeasureAttributesUpdated=function(p){this.scoreData.getPartsContents().forEach(function(C,B){const R={type:"primitive.updateAttributes",opts:{measureIdx:p,partIdx:B}};this.cancelStack.push(R),(0,n.default)(this.cancelStack,this.scoreData,{measureIdx:p,partIdx:B})},this)},E.updateNextOwnTime=function(){const p=this.opts.measureIdx+1,D={startMeasureIdx:p,stopMeasureIdx:p};new l.A(this.scoreData,D,this.cancelStack).perform()},E.adaptOption=function(p,D){const C=(0,a.default)(p);return C.partIdx=D,C},E.hasGivenMeasureUuid=function(){return typeof this.opts.measureUuid!="undefined"},E.hasGivenPreviousUuid=function(){return typeof this.opts.previousUuid!="undefined"},E.hasGivenNextUuid=function(){return typeof this.opts.nextUuid!="undefined"},E.isValidUuid=function(p){return!!(typeof p=="string"&&r.default.isValid(p))},E.hasUuid=function(p){return this.isValidUuid(p)&&this.scoreData.hasMeasureIdxByUuid(p)},E.getIdxFromUuids=function(){if(this.hasUuid(this.opts.previousUuid))return this.getIdxFromUuid(this.opts.previousUuid)+1;if(this.hasUuid(this.opts.nextUuid))return this.getIdxFromUuid(this.opts.nextUuid);if(this.opts.previousUuid===null)return 0;if(this.opts.nextUuid===null)return this.scoreData.getNbMeasures();throw new g.default("Unexpected")},E.getIdxFromUuid=function(p){return(0,s.A)(this.scoreData.getMeasuresHeaders(),p)},E.updateStack=function(){const p={type:this.name,noDraw:!0,opts:{measureUuid:this.scoreData.getMeasureUuid(this.opts.measureIdx)}};this.cancelStack.push(p)},E.storeAction=function(p){const D=this.scoreData.getMeasureUuid(this.opts.measureIdx),C={actionName:this.name,opts:{previousUuid:p.previousUuid,nextUuid:p.nextUuid,measureUuid:D}};!this.cancelStack.hasAction()&&!this.opts.isSubAction?this.cancelStack.storeAction(C):this.cancelStack.storeAddAction(C)},E.getLocation=function(){const p=this.opts.measureIdx-1<0?null:this.scoreData.getMeasureUuid(this.opts.measureIdx-1),D=this.scoreData.getNbMeasures(),C=this.opts.measureIdx>=D?null:this.scoreData.getMeasureUuid(this.opts.measureIdx);if(this.hasGivenMeasureUuid()&&(this.opts.measureUuid===p||this.opts.measureUuid===C)){const R=`The added measure uuid [${this.opts.measureUuid}] also apprears on the location. `,L=new g.default("Inconsistency",R);throw L.measureUuid=this.opte.measureUuid,L}return{previousUuid:p,nextUuid:C}},(0,c.default)(_);const x=_},531981:(N,M,t)=>{t.r(M),t.d(M,{default:()=>_});var g=t(364842),O=t(227829),T=t(702544),I=t(383279),A=t(226804),v=t(856219),P=t(721247),U=t(364596),m=t(377180),f=t(737903),h=t(104907),u=t(908969),l=t(857579),d=t(52275),a=t(805490),r=t(860301),i=t(644317),o=t(42651),s=t(549553),e=t(519405);const n=function(E,x,p){this.init(E,x,p)};n.NAME="action.RemovePart";const c=n.prototype;c.name=n.NAME,c.init=function(E,x,p){this.scoreData=E,this.cancelStack=p,this.opts=x,(0,d.default)(this.scoreData,this.opts),typeof x.recordContent=="undefined"&&(x.recordContent=!0)},c.checkPreconditions=function(){const E=this.scoreData.getNbParts(),x=this.opts.partIdx;if(x<0||x>=E)throw new T.default(x,T.default.GET);if(E<2)throw new O.A(O.A.PART)},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const E=this.getPreviousNextUuids(),x=this.getPreviousData();this.storeAction(E),this.opts.recordContent&&(this.removeMeasures(),this.ungroup()),this.scoreData.removePart(this.opts.partIdx),this.updateStack(E,x)},c.getPreviousNextUuids=function(){const E=this.scoreData.getPartUuid(this.opts.partIdx);let x;this.opts.partIdx>0?x=this.scoreData.getPartUuid(this.opts.partIdx-1):x=null;let p;const D=this.scoreData.getNbParts();if(this.opts.partIdx<D-1?p=this.scoreData.getPartUuid(this.opts.partIdx+1):p=null,x===E||p===E){const C=`The removed part uuid [${this.opts.partUuid}] also apprears on the surroundings. `,B=new g.default("Inconsistency",C);throw B.partUuid=this.opte.partUuid,B}return{previousUuid:x,partUuid:E,nextUuid:p}},c.getPreviousData=function(){const E=this.scoreData.getPartHeader(this.opts.partIdx),x=I.default.getStaffMapping(E),p={};p.name=I.default.getName(E),I.default.hasAbbreviation(E)&&(p.abbreviation=I.default.getAbbreviation(E)),p.volume=I.default.getGlobalVolume(E);const D=this.scoreData.getMeasure(this.opts.partIdx,0),C=new l.A(D);let B;if(this.scoreData.isPartUnpitched(this.opts.partIdx)){p.partType=u.A.UNPITCHED;const R=I.default.getUnpitchedMapping(E);p.pitchMapping=(0,a.A)(R,E),p.instrumentsList=I.default.getUnpitchedInstrumentsList(E),B=C.getStaffDetails(0),p.nbStaffLines=h.default.getNbStaffLines(B),p.voicesData=(0,f.default)(x[0]),p.voiceIdxToUuidMapping=(0,f.default)(I.default.getVoiceIdxToUuidMapping(E)),p.staffUuid=I.default.getStaffUuid(E,0)}else{p.partType=u.A.NORMAL;const R=I.default.getScoreInstruments(E)[0];p.instrumentName=A.default.getName(R);const L=I.default.getMIDIInstruments(E)[0];p.MIDIProgram=v.default.getMIDIProgram(L),p.hasQuarterTone=I.default.hasQuarterTone(E);const k=[],W=C.getNbStaves();for(let G=0;G<W;G++){const j={},y=C.getClef(G);j.clef=P.default.copy(y);const X=C.getKey(G);j.key=U.default.copy(X);const F=C.getTranspose(G);j.transpose=m.default.copy(F),B=C.getStaffDetails(G),h.default.hasStaffTuning(B)&&(j.staffDetails=h.default.copy(B)),j.voicesData=(0,f.default)(x[G]),j.voiceIdxToUuidMapping=(0,r.A)(j.voicesData.voices,E),j.staffUuid=I.default.getStaffUuid(E,G),k.push(j)}p.staves=k}return p},c.storeAction=function(E){if(!this.cancelStack.hasAction()){const x={actionName:this.name,opts:{partUuid:E.partUuid}};this.cancelStack.storeAction(x)}},c.removeMeasures=function(){const E=this.scoreData.getNbMeasures();for(let x=0;x<E;x++)this.removeMeasure(x)},c.removeMeasure=function(E){const x={partIdx:this.opts.partIdx,measureIdx:E};new i.A(this.scoreData,x,this.cancelStack).perform()},c.ungroup=function(){const E=this.scoreData.getPartHeader(this.opts.partIdx);if(I.default.isGroupedWithPrevious(E)){const x={partIdx:this.opts.partIdx,isGroupedWithPrevious:!1},p=new s.default(this.scoreData,x,this.cancelStack);(0,e.default)(p)}},c.updateStack=function(E,x){const p={previousUuid:E.previousUuid,nextUuid:E.nextUuid,partUuid:E.partUuid,name:x.name,partType:x.partType,volume:x.volume};typeof x.abbreviation!="undefined"&&(p.abbreviation=x.abbreviation),x.partType===u.A.UNPITCHED?(p.instrumentsList=x.instrumentsList,p.pitchMapping=x.pitchMapping,p.nbStaffLines=x.nbStaffLines,p.voicesData=(0,f.default)(x.voicesData),p.voiceIdxToUuidMapping=(0,f.default)(x.voiceIdxToUuidMapping),p.staffUuid=x.staffUuid):x.partType===u.A.NORMAL?(p.instrumentName=x.instrumentName,p.MIDIProgram=x.MIDIProgram,p.staves=(0,f.default)(x.staves),p.hasQuarterTone=x.hasQuarterTone):u.A.raiseError(p.partType);const D={type:this.name,opts:p};this.cancelStack.push(D),this.cancelStack.stateNeedCompleteRedraw()},(0,o.default)(n);const _=n},534250:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(31278),O=t(247739),T=t(123491),I=t(292681),A=t(104907),v=t(244616),P=t(427842),U=t(76004),m=t(2835),f=t(898039),h=t(52275),u=t(704621),l=t(981801),d=t(831121),a=t(793317),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.AddColorToGracePercu",i.isNoChange=function(e){return e instanceof g.default};const o=i.prototype;o.name=i.NAME,o.initMeasureData=a.default,o.init=function(e,n,c){(0,h.default)(e,n),(0,u.default)(e,n),(0,l.default)(e,n),this.initMeasureData(e,n),this.cancelStack=c,this.opts=n,this.noteHead=null,this.voice=null,this.location=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,f.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),v.default.check(this.opts.color),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkColor()},o.checkUnpitchedPart=function(){(0,d.default)(this.measureData)},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},o.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts)},o.checkNoteAtUnpitched=function(){if(typeof this.getGraceAtUnpitched()=="undefined"){const n=I.default.copy(this.opts.unpitched),c=this.opts.staffIdx||0,_=this.measureData.getStaffDetails(c),E=A.default.getNbStaffLines(_);throw new O.A(O.A.GET,n,E)}},o.checkColor=function(){const e=this.getGraceAtUnpitched();if(T.default.hasColor(e)&&T.default.getColor(e)===this.opts.color)throw new g.default},o.getGraceAtUnpitched=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,U.A)(e,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)}return this.noteHead},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addColorToGracePercu(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,graceIdx:this.opts.graceIdx,unpitched:I.default.copy(this.opts.unpitched),color:this.opts.color},c={actionName:this.name,opts:n};this.cancelStack.storeAction(c)}},o.addColorToGracePercu=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:I.default.copy(this.opts.unpitched),color:this.opts.color};new P.A(this.measureData,e,this.cancelStack).perform()},o.updateStack=function(){const e=this.getLocation(),n={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,graceIdx:this.opts.graceIdx,unpitched:I.default.copy(this.opts.unpitched)},c={type:this.name,noDraw:!0,opts:n};this.cancelStack.push(c)},o.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),n=e.getPartUuid(this.opts.partIdx),c=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),E=this.measureData.getDpqValue(),p=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:n,measureUuid:c,voiceUuid:_,dpq:E,timePos:p,isConcertPitch:!1}}return this.location},o.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(i);const s=i},540042:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(31278),O=t(123491),T=t(259563),I=t(52275),A=t(704621),v=t(981801),P=t(898039),U=t(42363),m=t(793317),f=t(42651);const h=function(d,a,r){this.init(d,a,r)};h.NAME="action.ChangeGraceDuration";const u=h.prototype;u.name=h.NAME,u.initMeasureData=m.default,u.init=function(d,a,r){(0,I.default)(d,a),(0,A.default)(d,a),(0,v.default)(d,a),this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,(0,P.default)(this.measureData,this.opts),this.location=null},u.checkPreconditions=function(){this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const d=this.measureData.getVoice(this.opts.voiceIdx);d.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.checkDifferentDuration();const a=d.getGrace(this.opts.noteIdx,this.opts.graceIdx);O.default.checkNotLocked(a)},u.checkValues=function(){T.default.check(this.opts.durationType)},u.checkDifferentDuration=function(){if(this.getCurrentDurationType()===this.opts.durationType)throw new g.default},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const d=this.getNoteData();this.changeGraceDuration(),this.updateStack(d)},u.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType}};this.cancelStack.storeAction(a)}},u.getNoteData=function(){return{durationType:this.getCurrentDurationType()}},u.getCurrentDurationType=function(){const a=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx);return O.default.getDurationType(a)},u.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},u.changeGraceDuration=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType};new U.A(this.measureData,d,this.cancelStack).perform()},u.updateStack=function(d){const a=this.getLocation(),r={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,timePos:a.timePos,divisions:a.dpq,graceIdx:this.opts.graceIdx,oldDurationType:d.durationType,newDurationType:this.opts.durationType}};this.cancelStack.push(r)},u.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),a=d.getPartUuid(this.opts.partIdx),r=d.getMeasureUuid(this.opts.measureIdx),i=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:r,voiceUuid:i,dpq:o,timePos:e}}return this.location},(0,f.default)(h);const l=h},541381:(N,M,t)=>{t.d(M,{A:()=>v});var g=t(364842),O=t(951066);class T extends O.A{constructor(U){const m=`The structure type ${U} is invalid.`;super(m),Object.defineProperty(this,"structureType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadStructureTypeError",this.structureType=U}}const I={PART:"part",STAFF:"staff"},A=[I.PART,I.STAFF];I.getValues=function(){return A.slice()},I.check=function(P){if(!I.isValid(P))throw new T(P)},I.isValid=function(P){return A.includes(P)},I.raiseError=function(P){const U=new g.default(`Invalid StructureType: ${P}`);return U.structureType=P,U};const v=I},549553:(N,M,t)=>{t.r(M),t.d(M,{default:()=>f});var g=t(702544),O=t(31278),T=t(52275),I=t(726042),A=t(383279),v=t(42651),P=t(607682);const U=function(h,u,l){this.init(h,u,l)};U.NAME="action.SetPartGroupWithPrevious";const m=U.prototype;m.name=U.NAME,m.init=function(h,u,l){(0,T.default)(h,u),this.scoreData=h,this.cancelStack=l,this.opts=u,this.location=null},m.checkPreconditions=function(){if(this.checkLocation(),typeof this.opts.isGroupedWithPrevious!="boolean"){const u=new P.default(`Invalid isGroupedWithPrevious: ${this.opts.isGroupedWithPrevious}`);throw u.isGroupedWithPrevious=this.opts.isGroupedWithPrevious,u}const h=this.getCurrentValue();if(this.opts.isGroupedWithPrevious===h)throw new O.default},m.checkLocation=function(){const h=this.opts.partIdx,u=this.scoreData.getNbParts();if(!I.default.isInteger(h)||h<0||h>=u)throw new g.default(h)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const h=this.getPreviousData();this.setGroupedWithPrevious(),this.updateStack(h)},m.storeAction=function(){if(!this.cancelStack.hasAction()){const h=this.getLocation(),u={actionName:this.name,opts:{partUuid:h.partUuid,isGroupedWithPrevious:this.opts.isGroupedWithPrevious}};this.cancelStack.storeAction(u)}},m.getPreviousData=function(){return{isGroupedWithPrevious:this.getCurrentValue()}},m.getCurrentValue=function(){const h=this.scoreData.getPartHeader(this.opts.partIdx);return A.default.isGroupedWithPrevious(h)},m.setGroupedWithPrevious=function(){const h=this.scoreData.getPartHeader(this.opts.partIdx);this.opts.isGroupedWithPrevious?A.default.groupWithPrevious(h):A.default.unGroup(h)},m.updateStack=function(h){const u=this.getLocation(),l={type:this.name,noDraw:!0,opts:{partUuid:u.partUuid,isGroupedWithPrevious:h.isGroupedWithPrevious}};this.cancelStack.push(l),this.cancelStack.stateNeedCompleteRedraw()},m.getLocation=function(){if(this.location===null){const h=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:h}}return this.location},(0,v.default)(U);const f=U},549878:(N,M,t)=>{t.r(M),t.d(M,{default:()=>m});var g=t(951066),O=t(31278),T=t(195446),I=t(42651),A=t(52275),v=t(21591),P=t(383279);class U{constructor(h,u,l){this.name=U.NAME,this.location=null,(0,A.default)(h,u),this.scoreData=h,this.cancelStack=l,this.opts=u}checkPreconditions(){this.scoreData.checkPartIdx(this.opts.partIdx),this.checkPitchedPart(),this.checkHasQuartertone(),this.checkNoChange()}checkPitchedPart(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new T.default}checkHasQuartertone(){if(typeof this.opts.hasQuarterTone!="boolean"){const h=new g.A(`The 'hasQuarterTone' value ${this.opts.hasQuarterTone} is invalid, it must be a boolean.`,"BadHasQuarterToneValue");throw h.hasQuarterTone=this.opts.hasQuarterTone,h}}checkNoChange(){if(this.getFormerValue()===this.opts.hasQuarterTone)throw new O.default}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const h=this.getFormerValue();this.setHasQuarterTone(),this.updateStack(h)}storeAction(){if(!this.cancelStack.hasAction()){const u={partUuid:this.getLocation().partUuid,hasQuarterTone:this.opts.hasQuarterTone},l={actionName:this.name,opts:u};this.cancelStack.storeAction(l)}}getFormerValue(){const h=this.scoreData.getPartHeader(this.opts.partIdx);return P.default.hasQuarterTone(h)}setHasQuarterTone(){const h={partIdx:this.opts.partIdx,hasQuarterTone:this.opts.hasQuarterTone};new v.A(this.scoreData,h,this.cancelStack).perform()}updateStack(h){const u=this.getLocation(),l={type:this.name,noDraw:!0,opts:{partUuid:u.partUuid,hasQuarterTone:h}};this.cancelStack.push(l)}getLocation(){if(this.location===null){const h=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:h}}return this.location}}Object.defineProperty(U,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"action.SetHasQuarterTone"});const m=U;(0,I.default)(U)},554657:(N,M,t)=>{t.r(M),t.d(M,{default:()=>c});var g=t(465439),O=t(803562),T=t(954546),I=t(820023),A=t(195446),v=t(31278),P=t(793317),U=t(898039),m=t(52275),f=t(704621),h=t(981801),u=t(737903),l=t(726042),d=t(123491),a=t(209175),r=t(724095),i=t(47740),o=t(42651);const s=4,e=function(_,E,x){this.init(_,E,x)};e.NAME="action.AddTremolo2";const n=e.prototype;n.initMeasureData=P.default,n.name=e.NAME,n.init=function(_,E,x){(0,m.default)(_,E),(0,f.default)(_,E),(0,h.default)(_,E),this.initMeasureData(_,E),this.cancelStack=x,this.opts=(0,u.default)(E),this.location=null,(0,U.default)(this.measureData,this.opts)},n.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkParam(),this.checkNoChange(),this.checkDurations()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new A.default},n.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const _=this.measureData.getVoice(this.opts.voiceIdx);_.checkNoteIdx(this.opts.noteIdx),_.checkNotRest(this.opts.noteIdx),_.checkNoteIdx(this.opts.noteIdx+1),_.checkNotRest(this.opts.noteIdx+1)},n.checkParam=function(){const _=parseInt(this.opts.nbBeams,10);if(!l.default.isInteger(_)||_<1||_>5)throw new g.A("nbBeams")},n.checkNoChange=function(){const E=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!d.default.hasTremoloStart(E))return;const{nbBeam:x}=d.default.getOrnamentOpts(E,r.A.TREMOLO);if(x===this.opts.nbBeams)throw new v.default},n.checkDurations=function(){const _=this.measureData.getVoice(this.opts.voiceIdx),E=_.getNote(this.opts.noteIdx),x=_.getNote(this.opts.noteIdx+1),p=d.default.getDuration(E),D=d.default.getDuration(x);if(p!==D)throw new O.A;const C=d.default.getTimeModif(E),B=d.default.getTimeModif(x);if(!a.default.isSame(C,B))throw new T.A;const R=this.measureData.getDpqValue();if(d.default.getNormalQuarterDuration(E,R)===s)throw new I.A},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addTremolo2(),this.updateStack()},n.addTremolo2=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,nbBeams:this.opts.nbBeams};new i.A(this.measureData,_,this.cancelStack).perform()},n.updateStack=function(){const _=this.getLocation(),E={type:this.name,noDraw:!0,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,timePos:_.timePos,divisions:_.dpq}};this.cancelStack.push(E)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const _=this.getLocation(),E={actionName:this.name,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,timePos:_.timePos,divisions:_.dpq,nbBeams:this.opts.nbBeams}};this.cancelStack.storeAction(E)}},n.getLocation=function(){if(this.location===null){const _=this.measureData.getScoreData(),E=_.getPartUuid(this.opts.partIdx),x=_.getMeasureUuid(this.opts.measureIdx),p=_.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),D=this.measureData.getDpqValue(),B=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:E,measureUuid:x,voiceUuid:p,dpq:D,timePos:B}}return this.location},(0,o.default)(e);const c=e},556055:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(22942),O=t(153271),T=t(31278),I=t(364842),A=t(555172),v=t(269032),P=t(726042),U=t(402359),m=t(42651),f=t(633210),h=t(350357),u=t(704621),l=t(519405);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.RemoveBarline";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,u.default)(i,o),this.scoreData=i,this.cancelStack=s,this.opts=o,this.location=null},a.checkPreconditions=function(){this.checkLocation(),this.checkAction()},a.checkLocation=function(){const i=this.opts.measureIdx,o=this.scoreData.getNbMeasures();if(!P.default.isInteger(i)||i<0||i>=o)throw new O.default(i);if(!A.A.isValidLocation(this.opts.side))throw new g.A(this.opts.side)},a.checkAction=function(){if(this.opts.side===h.A.LEFT)this.initLeftAction();else if(this.opts.side===h.A.RIGHT)this.initRightAction();else throw new I.default("Unexpected")},a.initRightAction=function(){if(this.action=null,this.action=this.initRemoveDoubleBarline(),this.action===null&&(this.action=this.initRemoveRepeatRight(),this.action===null))throw new T.default},a.initRemoveDoubleBarline=function(){const i={measureIdx:this.opts.measureIdx},o=null,s=new f.default(this.scoreData,i,o);return this.tryAction(s)},a.initRemoveRepeatRight=function(){const i={measureIdx:this.opts.measureIdx,direction:v.A.DIRECTION_BACKWARD},o=null,s=new U.default(this.scoreData,i,o);return this.tryAction(s)},a.initLeftAction=function(){if(this.action=null,this.action=this.initRemoveRepeatLeft(),this.action===null)throw new T.default},a.initRemoveRepeatLeft=function(){const i={measureIdx:this.opts.measureIdx,direction:v.A.DIRECTION_FORWARD},o=null,s=new U.default(this.scoreData,i,o);return this.tryAction(s)},a.tryAction=function(i){try{i.checkPreconditions()}catch(o){if(o instanceof T.default)return null;l.default.requalifyException(i,o)}return i},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeBarline()},a.removeBarline=function(){this.action.cancelStack=this.cancelStack,this.action.perform()},(0,m.default)(d);const r=d},563276:(N,M,t)=>{t.r(M),t.d(M,{default:()=>n});var g=t(278243),O=t(99923),T=t(807205),I=t(742735),A=t(123491),v=t(292681),P=t(946330),U=t(691309),m=t(325600),f=t(52275),h=t(704621),u=t(981801),l=t(898039),d=t(852363),a=t(793317),r=t(42651);const i=function(c,_,E){this.init(c,_,E)};i.NAME="action.AddTiePercu";const o=i.prototype;o.name=i.NAME,o.initMeasureData=a.default,o.init=function(c,_,E){(0,f.default)(c,_),(0,h.default)(c,_),(0,u.default)(c,_),this.initMeasureData(c,_),this.cancelStack=E,this.opts=_,(0,l.default)(this.measureData,_),this.crossMeasure=new U.default(this.measureData,_.voiceIdx,_.noteIdx),this.location=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanTie()},o.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new O.A},o.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},o.isLeftRest=function(){return this.crossMeasure.isLeftRest()},o.isRightRest=function(){return this.crossMeasure.isRightRest()},o.checkCanTie=function(){if(this.crossMeasure.hasRightGrace())throw new T.A(this.name,"right not cannot have graces notes attached.");const c=this.getLeftChord(),_=this.getRightChord();if(!I.A.canTieChords(c,_,!0))throw new T.A(this.name,"nothing can be tied")},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getLeftChord(),_=this.getRightChord(),E=s(c,_);I.A.tieChords(c,_,!0),this.updateStack(E)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),_={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,divisions:c.dpq,timePos:c.timePos,voiceUuid:c.voiceUuid}};this.cancelStack.storeAction(_)}},o.getLeftChord=function(){return this.crossMeasure.getLeftChord()},o.getRightChord=function(){return this.crossMeasure.getRightChord()};const s=function(c,_){return I.A.getUntiedPairs(c,_,!0).map(e)},e=function(c){const _=A.default.getUnpitched(c.left);return v.default.copy(_)};o.updateStack=function(c){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx(),c.forEach(this.addAction,this)},o.addAction=function(c){const _=this.getLocation(),E={type:P.default.NAME,opts:{partIdx:this.opts.partIdx,partUuid:_.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:_.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:_.timePos,divisions:_.dpq,voiceUuid:_.voiceUuid,unpitched:v.default.copy(c)}};this.cancelStack.push(E),(0,d.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const x={type:`${P.default.NAME}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:v.default.copy(c)}};this.cancelStack.push(x),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,d.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},o.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),_=c.getPartUuid(this.opts.partIdx),E=this.crossMeasure.getLeftMeasureIdx(),x=c.getMeasureUuid(E),p=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),D=this.crossMeasure.getLeftMeasure().getDpqValue(),C=this.crossMeasure.getLeftVoice(),B=this.crossMeasure.getLeftNoteIdx(),R=(0,m.A)(C,B);this.location={partUuid:_,measureUuid:x,voiceUuid:p,dpq:D,timePos:R}}return this.location},(0,r.default)(i);const n=i},569860:(N,M,t)=>{t.r(M),t.d(M,{default:()=>u});var g=t(31278),O=t(883782),T=t(227829),I=t(449455),A=t(52275),v=t(704621),P=t(981801),U=t(793317),m=t(42651);const f=function(l,d,a){this.init(l,d,a)};f.NAME="action.HideMeasureVoices";const h=f.prototype;h.name=f.NAME,h.initMeasureData=U.default,h.init=function(l,d,a){(0,A.default)(l,d),(0,v.default)(l,d),(0,P.default)(l,d),this.initMeasureData(l,d),this.cancelStack=a,this.opts=d,this.location=null},h.checkPreconditions=function(){const l=this.measureData.getScoreData();if(!l.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new O.default(this.opts.voiceIdx);if(!this.measureData.hasVoice(this.opts.voiceIdx))throw new g.default;const d=l.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx);if(this.measureData.getStaffNbVoices(d)<2)throw new T.A(T.A.DISPLAYED_VOICE)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.hideMeasureVoice(),this.updateStack()},h.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation(),d={partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid},a={actionName:this.name,opts:d};this.cancelStack.storeAction(a)}},h.hideMeasureVoice=function(){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new I.A(this.measureData,l,this.cancelStack).perform()},h.updateStack=function(){const l=this.getLocation(),d={partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid},a={type:this.name,noDraw:!0,opts:d};this.cancelStack.push(a)},h.getLocation=function(){if(this.location===null){const l=this.measureData.getScoreData(),d=l.getPartUuid(this.opts.partIdx),a=l.getMeasureUuid(this.opts.measureIdx),r=l.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx);this.location={partUuid:d,measureUuid:a,voiceUuid:r}}return this.location},(0,m.default)(f);const u=f},580668:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(195446),O=t(351277),T=t(123491),I=t(476943),A=t(737296),v=t(91894),P=t(793317),U=t(519405),m=t(42651);const f=!1,h=function(d,a,r){this.init(d,a,r)};h.NAME="action.RemoveChord";const u=h.prototype;u.name=h.NAME,u.initMeasureData=P.default,u.init=function(d,a,r){this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,this.sanitized=!1,this.voice=null},u.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest()},u.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g.default},u.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},u.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},u.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},u.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeChord()},u.removeChord=function(){let d=this.getChord();d=d.slice(),d.forEach(this.removeChordHead,this)},u.getChord=function(){let a=this.getVoice().getChord(this.opts.noteIdx);return a=I.default.makeArray(a),a},u.removeChordHead=function(d,a,r){let i=T.default.getPitch(d);i=O.default.copy(i);const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,formatRests:this.opts.formatRests,pitch:i,keepFormer:!1};a===r.length-1?o.insertMode=this.opts.insertMode:o.insertMode=A.default.REPLACE;const s=new v.default(this.measureData,o,this.cancelStack);(0,U.default)(s)},u.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=A.default.REPLACE),typeof this.opts.formatRests=="undefined"&&(this.opts.formatRests=f),this.sanitized=!0)},(0,m.default)(h);const l=h},594306:(N,M,t)=>{t.r(M),t.d(M,{default:()=>B});var g=t(793317),O=t(52275),T=t(704621),I=t(981801),A=t(783177),v=t(898039),P=t(325600),U=t(927403),m=t(476031),f=t(766457),h=t(19405),u=t(714898),l=t(691309),d=t(195446),a=t(278243),r=t(748803),i=t(727867),o=t(31278),s=t(359932),e=t(369790),n=t(737903),c=t(123491),_=t(351277),E=t(724926),x=t(457147),p=t(42651);const D=function(R,L,k){this.init(R,L,k)};D.NAME="action.AddHammerOnPullOff";const C=D.prototype;C.name=D.NAME,C.initMeasureData=g.default,C.init=function(R,L,k){(0,O.default)(R,L),(0,T.default)(R,L),(0,I.default)(R,L),(0,A.default)(R,L),this.initMeasureData(R,L),this.opts=L,this.cancelStack=k,this.location=null,this.leftNote=null,this.rightNote=null,this.technicalType=null,this.sanitized=!1,(0,v.default)(this.measureData,L),this.crossMeasure=new l.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},C.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkTabPart(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkCompatibility(),this.checkExistence()},C.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new d.default},C.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},C.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},C.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new a.A},C.isLeftRest=function(){return this.crossMeasure.isLeftRest()},C.isRightRest=function(){return this.crossMeasure.isRightRest()},C.checkTabPart=function(){(0,U.A)(this.measureData,this.opts)},C.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,u.default)(this.measureData,this.opts),typeof this.opts.fretData!="undefined"&&this.convertExistingFretToPitch(),this.sanitized=!0)},C.convertExistingFretToPitch=function(){const R={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,fretData:(0,n.default)(this.opts.fretData)};this.opts.pitch=(0,f.A)(this.measureData,R)},C.checkPitch=function(){(0,h.default)(this.opts)},C.checkCompatibility=function(){let R;const L=this.getLeftNote();if(typeof L=="undefined")throw R={msgPrefix:"there is no left note"},new r.default(R,this.opts.pitch);if(!c.default.hasFretData(L))throw new i.A(this.opts.pitch);if(typeof this.getRightNote()=="undefined")throw R={msgPrefix:"there is no right note"},new r.default(R,this.opts.pitch)},C.checkExistence=function(){const R=this.getLeftNote();if(c.default.hasHammerOnPullOffStart(R))throw new o.default},C.hasStartTechnical=function(R){const L=this.getTechnicalType(),k=this.getTechnicalOpts(e.A.START);return c.default.hasTechnical(R,L,k)},C.hasStopTechnical=function(R){const L=this.getTechnicalType(),k=this.getTechnicalOpts(e.A.STOP);return c.default.hasTechnical(R,L,k)},C.getTechnicalOpts=function(R){return{hammerOnPullOff:E.A.create(R)}},C.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const R=this.getTechnicalType(),L={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,technicalType:R,pitch:_.default.copy(this.opts.pitch),noSlur:this.opts.noSlur};new x.A(this.measureData,L,this.cancelStack).perform(),this.updateStack()},C.getTechnicalType=function(){if(this.technicalType===null){const R=this.getLeftNote(),L=this.getRightNote(),k=c.default.getPitch(R),W=c.default.getPitch(L);_.default.naiveComparePitch(k,W)>0?this.technicalType=s.default.PULL_OFF:this.technicalType=s.default.HAMMER_ON}return this.technicalType},C.getRightNote=function(){if(this.rightNote===null){const R=this.getLeftNote(),L=this.crossMeasure.getRightChord(),k=c.default.getFretData(R);this.rightNote=L.find(this.stringPredicate,k)}return this.rightNote},C.getLeftNote=function(){if(this.leftNote===null){const R=this.crossMeasure.getLeftChord();this.leftNote=R.find(this.pitchPredicate,this)}return this.leftNote},C.pitchPredicate=function(R){const L=c.default.getPitch(R);return _.default.isSameLine(L,this.opts.pitch)},C.stringPredicate=function(R){const L=c.default.getFretData(R),k=this;return c.default.hasFretData(R)?L.string===k.string:!1},C.storeAction=function(){if(!this.cancelStack.hasAction()){const R=this.getLocation(),L={actionName:this.name,opts:{partUuid:R.partUuid,measureUuid:R.measureUuid,voiceUuid:R.voiceUuid,timePos:R.timePos,divisions:R.dpq,pitch:_.default.copy(this.opts.pitch),noSlur:!!this.opts.noSlur}};this.cancelStack.storeAction(L)}},C.updateStack=function(){const R=this.getLocation(),L={type:this.name,noDraw:!0,opts:{partUuid:R.partUuid,measureUuid:R.measureUuid,voiceUuid:R.voiceUuid,timePos:R.timePos,divisions:R.dpq,pitch:_.default.copy(this.opts.pitch)}};this.cancelStack.push(L)},C.getLocation=function(){if(this.location===null){const R=this.measureData.getScoreData(),L=R.getPartUuid(this.opts.partIdx),k=this.crossMeasure.getLeftMeasureIdx(),W=R.getMeasureUuid(k),G=R.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),j=this.crossMeasure.getLeftMeasure().getDpqValue(),y=this.crossMeasure.getLeftVoice(),X=this.crossMeasure.getLeftNoteIdx(),F=(0,P.A)(y,X);this.location={partUuid:L,measureUuid:W,voiceUuid:G,dpq:j,timePos:F}}return this.location},(0,p.default)(D);const B=D},615059:(N,M,t)=>{t.r(M),t.d(M,{default:()=>m});var g=t(153271),O=t(31278),T=t(842328),I=t(704621),A=t(561248),v=t(42651);const P=function(f,h,u){this.init(f,h,u)};P.NAME="action.RemoveRehearsal";const U=P.prototype;U.name=P.NAME,U.init=function(f,h,u){this.scoreData=f,this.cancelStack=u,this.opts=h,(0,I.default)(this.scoreData,h),this.location=null},U.checkPreconditions=function(){this.checkLocation(),this.checkHasRehearsal()},U.checkLocation=function(){const f=this.scoreData.getNbMeasures(),h=this.opts.measureIdx;if(h<0||h>=f)throw new g.default(h,g.default.GET)},U.checkHasRehearsal=function(){if(!this.scoreData.getCommonContent().hasRehearsal(this.opts.measureIdx))throw new O.default},U.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const f=this.getPreviousData();this.storeAction(),this.removeRehearsal(),this.updateStack(f)},U.getPreviousData=function(){const h=this.scoreData.getCommonContent().getRehearsal(this.opts.measureIdx),u=A.A.getText(h),l=A.A.getType(h);return{rehearsal:u,type:l}},U.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{measureUuid:f.measureUuid}};this.cancelStack.storeAction(h)}},U.removeRehearsal=function(){const f={measureIdx:this.opts.measureIdx};new T.A(this.scoreData,f,this.cancelStack).perform()},U.updateStack=function(f){const h=this.getLocation(),u={type:this.name,noDraw:!0,opts:{measureUuid:h.measureUuid,rehearsal:f.rehearsal,type:f.type}};this.cancelStack.push(u)},U.getLocation=function(){if(this.location===null){const f=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:f}}return this.location},(0,v.default)(P);const m=P},627931:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(753932),O=t(748803),T=t(195446),I=t(351277),A=t(737903),v=t(846947),P=t(42651),U=t(793317),m=t(519405),f=t(573559),h=t(33674);const u=function(i,o,s){this.init(i,o,s)};u.NAME="action.AddChord";const l=u.prototype;l.name=u.NAME,l.initMeasureData=U.default,l.init=function(i,o,s){this.initMeasureData(i,o),this.cancelStack=s,this.opts=o,this.actions=null,this.sanitized=!1},l.checkPreconditions=function(){this.checkPitchedPart(),this.sanitizeIfNeeded(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkRest(),this.checkPitches(),this.getActions()[0].checkPreconditions()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},l.checkCompatibleVoiceStaffIdx=function(){(0,h.default)(this.measureData,this.opts)},l.checkPitches=function(){if(this.opts.heads.length===0)throw new g.A;this.opts.heads.forEach(d),this.opts.checkLine&&this.opts.heads.forEach(this.checkLineOverflow,this),this.checkPitchCollision()};const d=function(i){I.default.check(i.pitch)};l.checkLineOverflow=function(i){const o={pitch:I.default.copy(i.pitch),staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};(0,f.A)(this.measureData,o)},l.checkPitchCollision=function(){const i=this.opts.heads.map(a);i.sort(I.default.compareLine);const o=i.length;for(let s=0;s<o-1;s++){const e=i[s],n=i[s+1];if(I.default.isSameLine(e,n)){const c=I.default.copyWithoutAlter(e);throw new O.default(O.default.INSERT,c)}}};const a=function(i){return I.default.copy(i.pitch)};l.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkRest(this.opts.noteIdx)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();let i=this.getActions();i[0].cancelStack=this.cancelStack,i[0].perform(),i=i.slice(1),i.forEach(this.performSubAction,this)},l.performSubAction=function(i){i.cancelStack=this.cancelStack,(0,m.default)(i)},l.getActions=function(){return this.actions===null&&(this.actions=this.opts.heads.map(this.createAction,this)),this.actions},l.createAction=function(i){const o=I.default.getAlter(i.pitch),s=I.default.alterToAccidental(o),e=I.default.copyWithoutAlter(i.pitch),n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:e,accidental:s,insertMode:this.opts.insertMode,checkLine:this.opts.checkLine};typeof i.fretData!="undefined"&&(n.fretData=(0,A.default)(i.fretData));const c=null;return new v.default(this.measureData,n,c)},l.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)},(0,P.default)(u);const r=u},633210:(N,M,t)=>{t.r(M),t.d(M,{default:()=>u});var g=t(31278),O=t(153271),T=t(701387),I=t(555172),A=t(918926),v=t(889346),P=t(350357),U=t(704621),m=t(42651);const f=function(l,d,a){this.init(l,d,a)};f.NAME="action.RemoveDoubleBarline";const h=f.prototype;h.name=f.NAME,h.init=function(l,d,a){(0,U.default)(l,d),this.scoreData=l,this.cancelStack=a,this.opts=d,this.location=null},h.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},h.checkLocation=function(){const l=this.opts.measureIdx,d=this.scoreData.getNbMeasures();if(l<0||l>=d)throw new O.default(l)},h.checkExistence=function(){if(!this.hasDoubleBarline())throw new g.default},h.hasDoubleBarline=function(){const d=this.scoreData.getMeasure(0,this.opts.measureIdx);return!(!T.default.hasRightBarline(d)||T.default.getRightBarlineStyle(d)!==I.A.DOUBLE_LIGHT)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeBarline(),this.clearRightBarline(),this.updateStack()},h.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation(),d={actionName:this.name,opts:{measureUuid:l.measureUuid,direction:this.opts.direction}};this.cancelStack.storeAction(d)}},h.removeBarline=function(){const l={measureIdx:this.opts.measureIdx,side:P.A.RIGHT};new A.A(this.scoreData,l,this.cancelStack).perform()},h.clearRightBarline=function(){const l={measureIdx:this.opts.measureIdx};new v.A(this.scoreData,l,this.cancelStack).perform()},h.updateStack=function(){const l=this.getLocation(),d={type:this.name,noDraw:!0,opts:{measureUuid:l.measureUuid,direction:this.opts.direction}};this.cancelStack.push(d)},h.getLocation=function(){if(this.location===null){const l=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:l}}return this.location},(0,m.default)(f);const u=f},636254:(N,M,t)=>{t.r(M),t.d(M,{default:()=>a});var g=t(443749),O=t(195446),T=t(951657),I=t(701387),A=t(721247),v=t(52275),P=t(704621),U=t(783177),m=t(42651),f=t(31278),h=t(205528),u=t(388909);const l=function(r,i,o){this.init(r,i,o)};l.NAME="action.SetClefSingleMeasure";const d=l.prototype;d.name=l.NAME,d.init=function(r,i,o){(0,v.default)(r,i),(0,P.default)(r,i),(0,U.default)(r,i),this.scoreData=r,this.cancelStack=o,this.opts=i,this.location=null},d.checkPreconditions=function(){this.checkLocation(),this.checkPitchedPart(),this.checkParam(),this.checkDifferent()},d.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const r=this.getMeasure(),i=I.default.getNbStaves(r);if(this.opts.staffIdx<0||this.opts.staffIdx>=i)throw new g.default(this.opts.staffIdx)},d.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new O.default},d.checkParam=function(){if(A.default.check(this.opts.clef),A.default.isTab(this.opts.clef))throw new T.default("TAB");if(A.default.isPercussion(this.opts.clef))throw new T.default("percussion")},d.checkDifferent=function(){const{clef:r}=this.getPreviousData();if(A.default.isSame(r,this.opts.clef))throw new f.default},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const r=this.getPreviousData();this.storeAction(),this.setClef(),this.updateOwnClef(),this.updateStack(r)},d.storeAction=function(){if(!this.cancelStack.hasAction()){const r=this.getLocation(),i=A.default.copy(this.opts.clef),o={actionName:this.name,opts:{partUuid:r.partUuid,measureUuid:r.measureUuid,staffUuid:r.staffUuid,clef:i}};this.cancelStack.storeAction(o)}},d.getPreviousData=function(){const r=this.getMeasure();return{clef:I.default.getWrappedClef(r).getEntry(this.opts.staffIdx)}},d.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},d.setClef=function(){const r=A.default.copy(this.opts.clef),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clef:r};new u.A(this.scoreData,i,this.cancelStack).perform()},d.updateOwnClef=function(){const r={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.measureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new h.A(this.scoreData,r,this.cancelStack).perform()},d.updateStack=function({clef:r}){const i=this.getLocation();r=A.default.copy(r);const o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,clef:r}};this.cancelStack.push(o)},d.getLocation=function(){if(this.location===null){const r=this.scoreData.getPartUuid(this.opts.partIdx),i=this.scoreData.getMeasureUuid(this.opts.measureIdx),o=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:r,measureUuid:i,staffUuid:o}}return this.location},(0,m.default)(l);const a=l},652504:(N,M,t)=>{t.r(M),t.d(M,{default:()=>q});var g=t(364842),O=t(607682),T=t(702544),I=t(916502),A=t(799945),v=t(156441),P=t(426191),U=t(701387),m=t(35802),f=t(518558),h=t(364596),u=t(721247),l=t(377180),d=t(226804),a=t(856219),r=t(383279),i=t(737903),o=t(210888),s=t(104907),e=t(777345),n=t(110976),c=t(74446),_=t(641239),E=t(677585),x=t(875777),p=t(596888),D=t(752582),C=t(700068),B=t(221385),R=t(770978),L=t(818880),k=t(547985),W=t(42651),G=t(195647);const j=function(S,K,V){this.init(S,K,V)};j.NAME="action.AddPart";const y=j.prototype;y.name=j.NAME,y.init=function(S,K,V){this.scoreData=S,this.cancelStack=V,this.opts=K,this.sanitized=!1},y.checkPreconditions=function(){this.hasGivenPartUuid()&&(0,E.default)(this.scoreData,this.opts),this.sanitizeIfNeeded();const S=this.scoreData.getNbParts(),K=this.opts.partIdx;if(typeof K!="number"||K<0||K>S)throw new T.default(K,T.default.INSERT);if(typeof this.opts.instrumentName!="string")throw new I.default("instrumentName");a.default.checkMIDIProgram(this.opts.MIDIProgram);const V=this.opts.staves;if(V.length===0)throw new O.default("there must be at least one staff definition","NO_STAFF_DEF");if(!this.scoreData.hasTime())throw new A.default("time");if(!this.scoreData.hasNbMeasures())throw new A.default("nbMeasures");V.forEach(this.checkStaff,this),this.checkVoicesData()},y.checkStaff=function(S,K){if(S.key)h.default.check(S.key);else if(S.concertKey)h.default.check(S.concertKey);else if(this.scoreData.hasContent())S.concertKey=this.scoreData.getConcertKey();else throw new O.default(`key definition is missing for staff ${K}. `,"NO_KEY_DEF");if(u.default.check(S.clef),S.transpose&&l.default.check(S.transpose),S.staffDetails&&(s.default.check(S.staffDetails),this.opts.hasQuarterTone&&(s.default.hasKodaly(S.staffDetails)||s.default.hasStaffTuning(S.staffDetails))))throw new G.default},y.checkVoicesData=function(){const S=this.opts.staves.map(X);(0,p.default)(S),(0,C.default)(this.opts.staves),(0,B.default)(this.opts.staves)};const X=function(S){return typeof S.voicesData!="undefined"?S.voicesData:null};y.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name);const S=this.getPreviousNextUuid(),K=this.scoreData.getNbMeasures(),V=[];for(let H=0;H<K;H++)V.push(this.scoreData.getTime(H));const z=w(K,V);this.fillBarlines(z),this.hasParts()||(this.fillMeasureUuids(),this.fillCommonContent());const Q=this.createPartHeader();this.hasGivenPartUuid()&&this.scoreData.setPartUuid(Q,z,this.opts.partUuid),this.scoreData.insertPart(Q,z,this.opts.partIdx),this.storeAction(S),this.fillStaves(),this.updateStack(),this.opts.fillKeys&&this.fillKeys()},y.sanitizeIfNeeded=function(){this.sanitized||((typeof this.opts.previousUuid!="undefined"||typeof this.opts.nextUuid!="undefined")&&(this.opts.partIdx=(0,_.default)(this.scoreData,this.opts.previousUuid,this.opts.nextUuid),delete this.opts.previousUuid,delete this.opts.nextUuid),typeof this.opts.volume=="undefined"&&(this.opts.volume=v.default.DEFAULT),this.generateVoicesData(),this.sanitized=!0)},y.generateVoicesData=function(){let S=this.opts.staves.map(X);S=(0,x.default)(S),this.opts.staves.forEach(J,S),this.opts.staves.forEach(D.default),this.opts.staves.forEach(F)};const F=function(S){typeof S.staffUuid=="undefined"&&(S.staffUuid=o.default.generate())},J=function(S,K){const V=this;S.voicesData=V[K]},w=function(S,K){const V=[],z=K[0],Q=b(z);V.push(Q);for(let $=0;$<S-1;$++){const Y=K[$+1],tt=Z(Y);V.push(tt)}return{measure:V}},b=function(S){const K=Z(S),V=U.default.getAttributes(K),z=(0,i.default)(V);return U.default.setOwnAttributes(K,z),K},Z=function(S){const K={note:[]},V={divisions:"1"};m.default.setNbStaves(V,0);const z=new P.default(0,f.default);return z.addGlobalEntry(S),S=(0,i.default)(z.dumpAttribute()),m.default.setTime(V,S),U.default.setAttributes(K,V),U.default.setSound(K,{}),K};y.fillBarlines=function(S){S.measure.forEach(this.fillMeasureBarlines,this)},y.fillMeasureBarlines=function(S,K,V){const z=K===V.length-1;if(this.scoreData.hasContent()){const Q=this.scoreData.getMeasure(0,K);if(U.default.hasBarlines(Q)){const H=U.default.getBarlines(Q);U.default.setBarlines(S,(0,i.default)(H))}}else z&&U.default.addFinalBarlines(S)},y.hasParts=function(){return this.scoreData.getNbParts()>0},y.fillMeasureUuids=function(){const S=this.scoreData.getMeasuresHeaders(),K=this.scoreData.getNbMeasures();(0,R.default)(S,K)},y.fillCommonContent=function(){const S=this.scoreData.getNbMeasures(),K=this.scoreData.getTempo(0),V=n.default.createWithDefaultDisplay(K),z=this.scoreData.getSwing(0),Q=this.scoreData.getCommonContent();for(let H=0;H<S;H++){Q.addMeasure(H,n.default.copy(V),e.default.copy(z)),H===0&&(Q.setOwnTempo(H,n.default.copy(V)),Q.setOwnSwing(H,e.default.copy(z)));let $=this.scoreData.getTime(H);$=f.default.copy($),Q.setDisplayedTime(H,$);let Y=this.scoreData.getBeatsList(H);Y=c.default.copy(Y),Q.setBeatsList(H,Y)}},y.createPartHeader=function(){let S;typeof this.opts.partName!="undefined"?S=this.opts.partName:S=this.opts.instrumentName;const K=r.default.create(S);typeof this.opts.abbreviation!="undefined"&&this.opts.abbreviation!==null&&r.default.setAbbreviation(K,this.opts.abbreviation);const V=d.default.create(this.opts.instrumentName),z={};return a.default.setMIDIProgram(z,this.opts.MIDIProgram),r.default.setInstrument(K,V,z),r.default.setGlobalVolume(K,this.opts.volume),this.opts.hasQuarterTone&&r.default.setHasQuarterTone(K,!0),K},y.fillStaves=function(){this.opts.staves.forEach(this.fillStaff,this)},y.fillStaff=function(S,K){const V=(0,i.default)(S);V.staffIdx=K,V.partIdx=this.opts.partIdx,new L.default(this.scoreData,V,this.cancelStack).perform()},y.hasGivenPartUuid=function(){return typeof this.opts.partUuid!="undefined"},y.isValidUuid=function(S){return typeof S=="string"&&o.default.isValid(S)},y.updateStack=function(){const S={type:this.name,opts:{partUuid:this.scoreData.getPartUuid(this.opts.partIdx)}};this.cancelStack.push(S),this.cancelStack.stateNeedCompleteRedraw()},y.storeAction=function(S){const K=this.opts.staves.map(i.default);if(!this.cancelStack.hasAction()){const V={actionName:this.name,opts:{partUuid:this.scoreData.getPartUuid(this.opts.partIdx),previousUuid:S.previousUuid,nextUuid:S.nextUuid,instrumentName:this.opts.instrumentName,MIDIProgram:this.opts.MIDIProgram,partName:this.opts.partName,abbreviation:this.opts.abbreviation||null,staves:K,volume:this.opts.volume,hasQuarterTone:!!this.opts.hasQuarterTone,fillKeys:!!this.opts.fillKeys}};this.cancelStack.storeAction(V)}},y.getPreviousNextUuid=function(){const S=this.opts.partIdx===0?null:this.scoreData.getPartUuid(this.opts.partIdx-1),K=this.scoreData.getNbParts(),V=this.opts.partIdx===K?null:this.scoreData.getPartUuid(this.opts.partIdx);if(this.hasGivenPartUuid()&&(this.opts.partUuid===S||this.opts.partUuid===V)){const Q=`The added measure uuid [${this.opts.partUuid}] also apprears on the previousNextUuid. `,H=new g.default("Inconsistency",Q);throw H.partUuid=this.opte.partUuid,H}return{previousUuid:S,nextUuid:V}},y.fillKeys=function(){const S={partIdx:this.opts.partIdx};new k.default(this.scoreData,S,this.cancelStack).perform()},(0,W.default)(j);const q=j},652804:(N,M,t)=>{t.r(M),t.d(M,{default:()=>e});var g=t(31278),O=t(195446),T=t(748803),I=t(123491),A=t(351277),v=t(815749),P=t(578918),U=t(19405),m=t(476031),f=t(898039),h=t(52275),u=t(981801),l=t(704621),d=t(783177),a=t(287296),r=t(793317),i=t(42651);const o=function(n,c,_){this.init(n,c,_)};o.NAME="action.AddGhostNotes",o.isNoChange=function(n){return n instanceof g.default};const s=o.prototype;s.name=o.NAME,s.initMeasureData=r.default,s.init=function(n,c,_){(0,h.default)(n,c),(0,l.default)(n,c),(0,u.default)(n,c),(0,d.default)(n,c),this.initMeasureData(n,c),this.cancelStack=_,this.opts=c,this.sanitized=!1,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,f.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkNoGhost()},s.checkValues=function(){(0,U.default)(this.opts)},s.checkPitch=function(){A.default.check(this.opts.pitch)},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const c=A.default.copy(this.opts.pitch);throw new T.default(T.default.GET,c)}},s.checkNoGhost=function(){const n=this.getNoteAtPitch();if(I.default.hasHeadParentheses(n))throw new g.default},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,f.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.removeGhostNote(),this.updateStack()},s.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts),this.checkNoteAtPitch(),this.sanitized=!0)},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),c={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch)},_={actionName:this.name,opts:c};this.cancelStack.storeAction(_)}},s.removeGhostNote=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copy(this.opts.pitch)};new v.A(this.measureData,n,this.cancelStack).perform()},s.getNoteAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,P.default)(n,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},s.updateStack=function(){const n=this.getLocation(),c={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch)},_={type:this.name,noDraw:!0,opts:c};this.cancelStack.push(_)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),c=n.getPartUuid(this.opts.partIdx),_=n.getMeasureUuid(this.opts.measureIdx),E=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),x=this.measureData.getDpqValue(),D=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:c,measureUuid:_,voiceUuid:E,dpq:x,timePos:D}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,i.default)(o);const e=o},658727:(N,M,t)=>{t.r(M),t.d(M,{default:()=>n});var g=t(364842),O=t(443749),T=t(195446),I=t(7451),A=t(260962),v=t(430411),P=t(52275),U=t(275646),m=t(80465),f=t(752582),h=t(271347),u=t(377443),l=t(658098),d=t(737903),a=t(210888),r=t(721247),i=t(537546),o=t(42651);const s=function(c,_,E){this.init(c,_,E)};s.NAME="action.AddStaff";const e=s.prototype;e.name=s.NAME,e.init=function(c,_,E){(0,P.default)(c,_),this.scoreData=c,this.cancelStack=E,this.opts=_,this.sanitized=!1,this.location=null},e.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.checkNotTab(),this.checkNotKodaly(),this.checkNotUnpitched(),this.convertUuidToStaffIdx(),this.checkStaffIdx(),r.default.check(this.opts.clef),this.sanitizeIfNeeded(),i.default.check(this.opts.staffUuid),this.checkVoicesData(),(0,l.A)(this.scoreData,this.opts)},e.checkNotTab=function(){if(this.scoreData.isPartTab(this.opts.partIdx))throw new I.A},e.checkNotKodaly=function(){if(this.scoreData.isPartKodaly(this.opts.partIdx))throw new A.A},e.checkNotUnpitched=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new T.default},e.convertUuidToStaffIdx=function(){if(typeof this.opts.previousUuid!="undefined"||typeof this.opts.nextUuid!="undefined"){const c=this.scoreData.getPartHeader(this.opts.partIdx);this.opts.staffIdx=(0,u.A)(c,this.opts.previousUuid,this.opts.nextUuid),delete this.opts.previousUuid,delete this.opts.nextUuid}},e.checkStaffIdx=function(){const c=this.scoreData.getPartNbStaves(this.opts.partIdx),_=this.opts.staffIdx;if(_<0||_>c)throw new O.default(_,O.default.INSERT)},e.checkVoicesData=function(){(0,U.A)(this.scoreData,this.opts.partIdx,this.opts.voicesData);const c=this.scoreData.getPartHeader(this.opts.partIdx);(0,h.A)(c,this.opts.voiceIdxToUuidMapping)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addStaff(),this.updateStack()},e.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.voicesData=="undefined"&&this.generateVoicesData(),(0,f.default)(this.opts),typeof this.opts.staffUuid=="undefined"&&(this.opts.staffUuid=a.default.generate()),this.sanitized=!0)},e.generateVoicesData=function(){this.opts.voicesData=(0,m.A)(this.scoreData,this.opts.partIdx)},e.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),_=this.getPreviousNextUuid(),E={partUuid:c.partUuid,previousUuid:_.previousUuid,nextUuid:_.nextUuid,staffUuid:this.opts.staffUuid,staffIdx:this.opts.staffIdx,voicesData:(0,d.default)(this.opts.voicesData),clef:r.default.copy(this.opts.clef),voiceIdxToUuidMapping:(0,d.default)(this.opts.voiceIdxToUuidMapping)},x={actionName:this.name,opts:E};this.cancelStack.storeAction(x)}},e.getPreviousNextUuid=function(){const c=this.opts.staffIdx,_=this.opts.partIdx,E=c===0?null:this.scoreData.getPartStaffUuid(_,c-1),x=this.scoreData.getPartNbStaves(_),p=c===x?null:this.scoreData.getPartStaffUuid(_,c);if(this.opts.staffUuid===E||this.opts.staffUuid===p){const C=`The added stafff uuid [${this.opts.staffUuid}] also apprears on the previousNextUuid. `,B=new g.default("Inconsistency",C);throw B.staffUuid=this.opte.staffUuid,B}return{previousUuid:E,nextUuid:p}},e.addStaff=function(){const c={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffUuid:this.opts.staffUuid,voicesData:(0,d.default)(this.opts.voicesData),clef:r.default.copy(this.opts.clef),voiceIdxToUuidMapping:(0,d.default)(this.opts.voiceIdxToUuidMapping)};new v.A(this.scoreData,c,this.cancelStack).perform()},e.updateStack=function(){const c=this.getLocation(),_={type:this.name,opts:{partUuid:c.partUuid,staffUuid:this.opts.staffUuid,staffIdx:this.opts.staffIdx}};this.cancelStack.push(_),this.cancelStack.stateNeedCompleteRedraw()},e.getLocation=function(){if(this.location===null){const c=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:c}}return this.location},(0,o.default)(s);const n=s},663273:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(31278),O=t(247739),T=t(123491),I=t(292681),A=t(104907),v=t(114714),P=t(768498),U=t(2835),m=t(898039),f=t(52275),h=t(704621),u=t(981801),l=t(831121),d=t(793317),a=t(42651);const r=function(s,e,n){this.init(s,e,n)};r.NAME="action.AddGhostNotePercus",r.isNoChange=function(s){return s instanceof g.default};const i=r.prototype;i.name=r.NAME,i.initMeasureData=d.default,i.init=function(s,e,n){(0,f.default)(s,e),(0,h.default)(s,e),(0,u.default)(s,e),this.initMeasureData(s,e),this.cancelStack=n,this.opts=e,this.noteHead=null,this.voice=null,this.location=null},i.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,m.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkNoGhost()},i.checkUnpitchedPart=function(){(0,l.default)(this.measureData)},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,U.default)(this.measureData,this.opts)},i.checkNoteAtUnpitched=function(){if(typeof this.getNoteAtUnpitched()=="undefined"){const e=I.default.copy(this.opts.unpitched),n=this.opts.staffIdx||0,c=this.measureData.getStaffDetails(n),_=A.default.getNbStaffLines(c);throw new O.A(O.A.GET,e,_)}},i.checkNoGhost=function(){const s=this.getNoteAtUnpitched();if(T.default.hasHeadParentheses(s))throw new g.default},i.getNoteAtUnpitched=function(){if(this.noteHead===null){const s=this.getVoice();this.noteHead=(0,P.A)(s,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addGhostNotePercu(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,unpitched:I.default.copy(this.opts.unpitched)},n={actionName:this.name,opts:e};this.cancelStack.storeAction(n)}},i.addGhostNotePercu=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:I.default.copy(this.opts.unpitched)};new v.A(this.measureData,s,this.cancelStack).perform()},i.updateStack=function(){const s=this.getLocation(),e={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,unpitched:I.default.copy(this.opts.unpitched)},n={type:this.name,noDraw:!0,opts:e};this.cancelStack.push(n)},i.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),e=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),c=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),x=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:n,voiceUuid:c,dpq:_,timePos:x,isConcertPitch:!1}}return this.location},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,a.default)(r);const o=r},669784:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(364842),O=t(443749),T=t(227829),I=t(702544),A=t(195446),v=t(7451),P=t(526377),U=t(52275),m=t(783177),f=t(860301),h=t(446921),u=t(737903),l=t(701387),d=t(721247),a=t(42651);const r=function(s,e,n){this.init(s,e,n)};r.NAME="action.RemoveStaff";const i=r.prototype;i.name=r.NAME,i.init=function(s,e,n){(0,U.default)(s,e),(0,m.default)(s,e),this.scoreData=s,this.cancelStack=n,this.opts=e,this.location=null},i.checkPreconditions=function(){const s=this.scoreData.getNbParts(),e=this.opts.partIdx;if(e<0||e>=s)throw new I.default(e);this.checkNotUnpitched(),this.checkNotTab();const n=this.scoreData.getPartContent(e),c=h.A.getNbStaves(n),_=this.opts.staffIdx;if(_<0||_>=c)throw new O.default(_);if(c===1)throw new T.A(T.A.STAFF)},i.checkNotUnpitched=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new A.default},i.checkNotTab=function(){if(this.scoreData.isPartTab(this.opts.partIdx))throw new v.A},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const s=this.getUuids();this.storeAction(s);const e=this.getPreviousData();this.removeStaff(),this.updateStack(e,s)},i.getUuids=function(){const s=this.opts.partIdx,e=this.opts.staffIdx,n=this.scoreData.getPartStaffUuid(s,e);let c;e>0?c=this.scoreData.getPartStaffUuid(s,e-1):c=null;let _;const E=this.scoreData.getPartNbStaves(s);if(e<E-1?_=this.scoreData.getPartStaffUuid(s,e+1):_=null,c===n||_===n){const x=`The removed part uuid [${this.opts.partUuid}] also apprears on the surroundings. `,p=new g.default("Inconsistency",x);throw p.partUuid=this.opte.partUuid,p}return{previousUuid:c,staffUuid:n,nextUuid:_}},i.storeAction=function(s){if(!this.cancelStack.hasAction()){const n={partUuid:this.getLocation().partUuid,staffUuid:s.staffUuid,staffIdx:this.opts.staffIdx},c={actionName:this.name,opts:n};this.cancelStack.storeAction(c)}},i.getPreviousData=function(){const s=this.scoreData.getPartStaffMapping(this.opts.partIdx),e=this.scoreData.getPartHeader(this.opts.partIdx);let n=s[this.opts.staffIdx];n=(0,u.default)(n),delete n.staffUuid;const c=(0,f.A)(n.voices,e),_=this.scoreData.getMeasure(this.opts.partIdx,0);let x=l.default.getWrappedClef(_).getEntry(this.opts.staffIdx);return x=d.default.copy(x),{voicesData:n,voiceIdxToUuidMapping:c,clef:x}},i.removeStaff=function(){const s={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx};new P.A(this.scoreData,s,this.cancelStack).perform()},i.updateStack=function(s,e){const n=this.getLocation(),c=(0,u.default)(s.voicesData),_=(0,u.default)(s.voiceIdxToUuidMapping),E={type:this.name,opts:{partUuid:n.partUuid,staffUuid:e.staffUuid,staffIdx:this.opts.staffIdx,previousUuid:e.previousUuid,nextUuid:e.nextUuid,voicesData:c,voiceIdxToUuidMapping:_,clef:d.default.copy(s.clef)}};this.cancelStack.push(E),this.cancelStack.stateNeedCompleteRedraw()},i.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:s}}return this.location},(0,a.default)(r);const o=r},674431:(N,M,t)=>{t.r(M),t.d(M,{default:()=>m});var g=t(793317),O=t(52275),T=t(704621),I=t(195446),A=t(192994),v=t(42651);const P=function(f,h,u){this.init(f,h,u)};P.NAME="action.UnsetMeasureFrets";const U=P.prototype;U.name=P.NAME,U.initMeasureData=g.default,U.init=function(f,h,u){(0,O.default)(f,h),(0,T.default)(f,h),this.initMeasureData(f,h),this.opts=h,this.cancelStack=u,this.location=null},U.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx)},U.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new I.default},U.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new A.A(this.measureData,f,this.cancelStack).perform(),this.updateStack()},U.updateStack=function(){const f=this.getLocation(),h={type:this.name,noDraw:!0,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.push(h)},U.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceIdx:this.opts.voiceIdx}};this.cancelStack.storeAction(h)}},U.getLocation=function(){if(this.location===null){const f=this.measureData.getScoreData(),h=f.getPartUuid(this.opts.partIdx),u=f.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:h,measureUuid:u}}return this.location},(0,v.default)(P);const m=P},678366:(N,M,t)=>{t.r(M),t.d(M,{default:()=>c});var g=t(31278),O=t(195446),T=t(748803),I=t(123491),A=t(351277),v=t(550006),P=t(578918),U=t(19405),m=t(476031),f=t(898039),h=t(52275),u=t(704621),l=t(981801),d=t(783177),a=t(287296),r=t(793317),i=t(42651),o=t(955154),s=t(860716);const e=function(_,E,x){this.init(_,E,x)};e.NAME="action.AddHarmonic",e.isNoChange=function(_){return _ instanceof g.default};const n=e.prototype;n.name=e.NAME,n.initMeasureData=r.default,n.init=function(_,E,x){(0,h.default)(_,E),(0,u.default)(_,E),(0,l.default)(_,E),(0,d.default)(_,E),this.initMeasureData(_,E),this.cancelStack=x,this.opts=E,this.noteHead=null,this.voice=null,this.location=null},n.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,f.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkDifferentFingering()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},n.checkValues=function(){(0,U.default)(this.opts),o.default.check(this.opts.type)},n.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},n.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},n.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts)},n.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const E=A.default.copy(this.opts.pitch);throw new T.default(T.default.GET,E)}},n.checkDifferentFingering=function(){const _=this.getNoteAtPitch();if(I.default.hasHarmonic(_)){const E=I.default.getHarmonic(_);if(s.default.getType(E)===this.opts.type)throw new g.default}},n.getNoteAtPitch=function(){if(this.noteHead===null){const _=this.getVoice();this.noteHead=(0,P.default)(_,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addHarmonic(),this.updateStack()},n.storeAction=function(){if(!this.cancelStack.hasAction()){const _=this.getLocation(),E={partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,divisions:_.dpq,timePos:_.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,type:this.opts.type},x={actionName:this.name,opts:E};this.cancelStack.storeAction(x)}},n.addHarmonic=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copy(this.opts.pitch),type:this.opts.type};new v.A(this.measureData,_,this.cancelStack).perform()},n.updateStack=function(){const _=this.getLocation(),E={partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,divisions:_.dpq,timePos:_.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch)},x={type:this.name,noDraw:!0,opts:E};this.cancelStack.push(x)},n.getLocation=function(){if(this.location===null){const _=this.measureData.getScoreData(),E=_.getPartUuid(this.opts.partIdx),x=_.getMeasureUuid(this.opts.measureIdx),p=_.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),D=this.measureData.getDpqValue(),B=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:E,measureUuid:x,voiceUuid:p,dpq:D,timePos:B,isConcertPitch:!1}}return this.location},n.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,i.default)(e);const c=e},684592:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(680875),O=t(817490),T=t(123491),I=t(209175),A=t(601277),v=t(993581),P=t(793317),U=t(19850),m=t(52275),f=t(704621),h=t(981801),u=t(766472),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddNotations";const a=d.prototype;a.initMeasureData=P.default,a.name=d.NAME,a.init=function(i,o,s){(0,m.default)(i,o),(0,f.default)(i,o),(0,h.default)(i,o),this.initMeasureData(i,o),this.cancelStack=s,this.opts=o,this.location=null,(0,u.default)(o),(0,U.default)(this.measureData,this.opts)},a.checkPreconditions=function(){this.checkLocation(),this.checkParam()},a.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},a.checkParam=function(){if(!A.default.isValid(this.opts.notationType))throw new O.A(this.opts.notationType);const o=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(T.default.hasNotations(o)&&T.default.hasNotation(o,this.opts.notationType))throw new g.A(this.opts.notationType)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx};new v.A(this.measureData,i,this.cancelStack).perform(),this.updateStack()},a.updateStack=function(){const i=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,voiceUuid:i.voiceUuid,notationType:this.opts.notationType,timePos:i.timePos,divisions:i.dpq}};this.cancelStack.push(o)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o=I.default.copy(i.timeModif),s={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,voiceUuid:i.voiceUuid,notationType:this.opts.notationType,timePos:i.timePos,divisions:i.dpq,timeModif:o}};this.cancelStack.storeAction(s)}},a.getLocation=function(){if(this.location===null){const i=this.measureData.getScoreData(),o=i.getPartUuid(this.opts.partIdx),s=i.getMeasureUuid(this.opts.measureIdx),e=i.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),c=this.measureData.getVoice(this.opts.voiceIdx),_=c.getRangeSpace(0,this.opts.noteIdx),E=c.getNote(this.opts.noteIdx);let x=T.default.getTimeModif(E);x=I.default.copy(x),this.location={partUuid:o,measureUuid:s,voiceUuid:e,dpq:n,timePos:_,timeModif:x}}return this.location},(0,l.default)(d);const r=d},684705:(N,M,t)=>{t.r(M),t.d(M,{default:()=>x});var g=t(195446),O=t(737903),T=t(351277),I=t(614426),A=t(259563),v=t(19405),P=t(172788),U=t(610860),m=t(476031),f=t(33674),h=t(52275),u=t(704621),l=t(981801),d=t(783177),a=t(898039),r=t(714898),i=t(519405),o=t(417843),s=t(200808),e=t(793317),n=t(42651);const c=function(p,D,C){this.init(p,D,C)};c.NAME="action.InsertSlashedGraceNote";const _=c.prototype;_.name=c.NAME,_.initMeasureData=e.default,_.init=function(p,D,C){(0,h.default)(p,D),(0,u.default)(p,D),(0,l.default)(p,D),(0,d.default)(p,D),this.initMeasureData(p,D),this.cancelStack=C,this.opts=D,(0,a.default)(this.measureData,this.opts),this.sanitized=!1,this.insertGraceAction=null,this.location=null},_.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.getInsertGraceAction().checkPreconditions()},_.checkValues=function(){(0,v.default)(this.opts),this.opts.accidental!==null&&I.default.check(this.opts.accidental)},_.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new g.default},_.checkCompatibleVoiceStaffIdx=function(){(0,f.default)(this.measureData,this.opts)},_.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},_.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},_.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.insertGraceNote(),this.addSlash()},_.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,r.default)(this.measureData,this.opts),E(this.measureData,this.opts),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)};const E=function(p,D){const B=p.getVoice(D.voiceIdx).getNbGraces(D.noteIdx);D.graceIdx<B?(0,P.A)(p,D):(0,U.A)(p,D)};_.storeAction=function(){if(!this.cancelStack.hasAction()){const p=this.getLocation(),D={actionName:this.name,opts:{partUuid:p.partUuid,measureUuid:p.measureUuid,voiceUuid:p.voiceUuid,staffUuid:p.staffUuid,graceIdx:this.opts.graceIdx,timePos:p.timePos,divisions:p.dpq,pitch:T.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine,removeGlissandos:!!this.opts.removeGlissandos,sameStringAsPreviousNotes:!!this.opts.sameStringAsPreviousNotes}};typeof this.opts.fretData!="undefined"&&(D.opts.fretData=(0,O.default)(this.opts.fretData)),this.cancelStack.storeAction(D)}},_.insertGraceNote=function(){const p=this.getInsertGraceAction();p.cancelStack=this.cancelStack,p.perform()},_.getInsertGraceAction=function(){if(this.insertGraceAction===null){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:A.default.EIGHT,pitch:T.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,fretData:this.opts.fretData,removeGlissandos:!!this.opts.removeGlissandos,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes},D=null;this.insertGraceAction=new o.default(this.measureData,p,D)}return this.insertGraceAction},_.addSlash=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},D=new s.default(this.measureData,p,this.cancelStack);(0,i.default)(D)},_.getLocation=function(){if(this.location===null){const p=this.measureData.getScoreData(),D=p.getPartUuid(this.opts.partIdx),C=p.getMeasureUuid(this.opts.measureIdx),B=p.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),R=p.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),L=this.measureData.getDpqValue(),W=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:D,measureUuid:C,voiceUuid:B,staffUuid:R,dpq:L,timePos:W}}return this.location},(0,n.default)(c);const x=c},698649:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(153271),O=t(661e3),T=t(857552),I=t(270259),A=t(195446),v=t(443749),P=t(951657),U=t(701387),m=t(721247),f=t(726042),h=t(12906),u=t(52275),l=t(407819),d=t(783177),a=t(42651);const r=function(s,e,n){this.init(s,e,n)};r.NAME="action.SetClefSegment";const i=r.prototype;i.name=r.NAME,i.init=function(s,e,n){(0,l.default)(s,e),(0,u.default)(s,e),(0,d.default)(s,e),this.scoreData=s,this.cancelStack=n,this.opts=e,this.location=null,this.firstClef=null},i.checkPreconditions=function(){this.checkClef(),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentClef(),this.checkCurrentConsistent()},i.checkClef=function(){if(m.default.check(this.opts.clef),m.default.isTab(this.opts.clef))throw new P.default("TAB")},i.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new A.default},i.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const s=this.opts.startMeasureIdx,e=this.opts.stopMeasureIdx;if(e-s<0)throw new T.default(T.default.MEASURE,s,e);const c=this.getFirstMeasure(),_=U.default.getNbStaves(c),E=this.opts.staffIdx;if(!f.default.isInteger(E)||E<0||E>=_)throw new v.default(E,v.default.GET)},i.checkMeasureIdx=function(s){const e=this.scoreData.getNbMeasures();if(!f.default.isInteger(s)||s<0||s>=e)throw new g.default(s,g.default.GET)},i.checkDifferentClef=function(){const s=this.getFirstClef(),e=this.opts.clef;if(m.default.isSame(e,s))throw new O.default(O.default.CLEF,m.default.copy(s),m.default.copy(e))},i.checkCurrentConsistent=function(){const s=this.getFirstClef();for(let e=this.opts.startMeasureIdx+1;e<=this.opts.stopMeasureIdx;e++){const n=this.getClef(e);if(!m.default.isSame(n,s))throw new I.A(I.A.CLEF)}},i.getFirstClef=function(){return this.firstClef===null&&(this.firstClef=this.getClef(this.opts.startMeasureIdx)),this.firstClef},i.getClef=function(s){const e=this.scoreData.getMeasure(this.opts.partIdx,s);return U.default.getWrappedClef(e).getEntry(this.opts.staffIdx)},i.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();let s=this.getFirstClef();s=m.default.copy(s),this.setClefSegment(),this.updateStack(s)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e=s.measureUuids.slice(),n=m.default.copy(this.opts.clef),c={actionName:this.name,opts:{partUuid:s.partUuid,measureUuids:e,staffUuid:s.staffUuid,clef:n}};this.cancelStack.storeAction(c)}},i.setClefSegment=function(){const s=m.default.copy(this.opts.clef),e={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,clef:s};new h.A(this.scoreData,e,this.cancelStack).perform()},i.updateStack=function(s){const e=this.getLocation(),n=e.measureUuids.slice(),c=m.default.copy(this.opts.clef),_={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuids:n,staffUuid:e.staffUuid,previousClef:s,newClef:c}};this.cancelStack.push(_)},i.getLocation=function(){if(this.location===null){const s=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),e=this.scoreData.getPartUuid(this.opts.partIdx),n=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:e,measureUuids:s,staffUuid:n}}return this.location},(0,a.default)(r);const o=r},729400:(N,M,t)=>{t.r(M),t.d(M,{default:()=>x});var g=t(753932),O=t(8567),T=t(57572),I=t(247739),A=t(99923),v=t(883782),P=t(837283),U=t(993608),m=t(292681),f=t(701387),h=t(515819),u=t(726042),l=t(104907),d=t(430318),a=t(857579),r=t(33674),i=t(52275),o=t(704621),s=t(404747),e=t(42651);const n=function(p,D,C){this.init(p,D,C)};n.NAME="action.AddChordPercuCrossMeasure";const c=n.prototype;c.name=n.NAME,c.init=function(p,D,C){(0,i.default)(p,D),(0,o.default)(p,D),this.scoreData=p,this.cancelStack=C,this.opts=D,this.location=null,this.measureData=null},c.checkPreconditions=function(){this.checkUnpitched(),this.checkLocation(),this.checkInstruments(),this.checkPosition(),this.checkDuration()},c.checkUnpitched=function(){if(!this.scoreData.isPartUnpitched(this.opts.partIdx))throw new A.A},c.checkLocation=function(){this.getMeasureData(),this.checkVoiceIdx(),(0,r.default)(this.scoreData,this.opts);const p=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),D=f.default.getQuarterDuration(p),C=this.opts.quarterPosition;if(!u.default.isNumber(C)||C<0||C>=D)throw new O.A(C)},c.checkVoiceIdx=function(){if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new v.default(this.opts.voiceIdx)},c.getMeasureData=function(){if(this.measureData===null){const p=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),D=null;this.measureData=new a.A(p,this.opts.measureIdx,D,this.scoreData)}return this.measureData},c.checkInstruments=function(){if(this.opts.instruments.length===0)throw new g.A;this.opts.instruments.forEach(this.checkInstrument,this),this.checkPitchCollision()},c.checkInstrument=function(p){const D=m.default.copy(p.unpitched),C={partIdx:this.opts.partIdx,notehead:p.notehead,unpitched:D},B=this.getMeasureData();(0,s.A)(B,C)},c.checkPitchCollision=function(){const p=this.opts.instruments.map(_).slice();p.sort(m.default.compare);const D=p.length;for(let C=0;C<D-1;C++){const B=p[C],R=p[C+1];if(m.default.isSameLine(B,R)){const L=m.default.copy(B),W=this.getMeasureData().getStaffDetails(this.opts.staffIdx),G=l.default.getNbStaffLines(W);throw new I.A(I.A.INSERT,L,G)}}};const _=function(p){return p.unpitched};c.checkPosition=function(){const p=this.opts.quarterPosition;if(!h.default.isValidQuarter(p))throw new P.A(p)},c.checkDuration=function(){const p=this.opts.quarterDuration;if(h.default.isValidQuarter(p)){if(p===0)throw new T.A(p)}else throw new U.A(p)},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addChordPercuCrossMeasure()},c.addChordPercuCrossMeasure=function(){const p=this.opts.instruments.map(E),D={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,instruments:p};new d.A(this.scoreData,D,this.cancelStack).perform()},c.storeAction=function(){if(!this.cancelStack.hasAction()){const p=this.getLocation(),D=this.opts.instruments.map(E),C={actionName:this.name,opts:{partUuid:p.partUuid,measureUuid:p.measureUuid,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration,instruments:D}};this.cancelStack.storeAction(C)}};const E=function(p){return{unpitched:m.default.copy(p.unpitched),notehead:p.notehead}};c.getLocation=function(){if(this.location===null){const p=this.scoreData.getPartUuid(this.opts.partIdx),D=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:p,measureUuid:D}}return this.location},(0,e.default)(n);const x=n},744264:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(31278),O=t(247739),T=t(123491),I=t(292681),A=t(104907),v=t(244616),P=t(728451),U=t(768498),m=t(2835),f=t(898039),h=t(52275),u=t(704621),l=t(981801),d=t(831121),a=t(793317),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.AddColorToNotePercu",i.isNoChange=function(e){return e instanceof g.default};const o=i.prototype;o.name=i.NAME,o.initMeasureData=a.default,o.init=function(e,n,c){(0,h.default)(e,n),(0,u.default)(e,n),(0,l.default)(e,n),this.initMeasureData(e,n),this.cancelStack=c,this.opts=n,this.noteHead=null,this.voice=null,this.location=null},o.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,f.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),v.default.check(this.opts.color),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkColor()},o.checkUnpitchedPart=function(){(0,d.default)(this.measureData)},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts)},o.checkNoteAtUnpitched=function(){if(typeof this.getNoteAtUnpitched()=="undefined"){const n=I.default.copy(this.opts.unpitched),c=this.opts.staffIdx||0,_=this.measureData.getStaffDetails(c),E=A.default.getNbStaffLines(_);throw new O.A(O.A.GET,n,E)}},o.checkColor=function(){const e=this.getNoteAtUnpitched();if(T.default.hasColor(e)&&T.default.getColor(e)===this.opts.color)throw new g.default},o.getNoteAtUnpitched=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,U.A)(e,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addColorToNotePercu(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,unpitched:I.default.copy(this.opts.unpitched),color:this.opts.color},c={actionName:this.name,opts:n};this.cancelStack.storeAction(c)}},o.addColorToNotePercu=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:I.default.copy(this.opts.unpitched),color:this.opts.color};new P.A(this.measureData,e,this.cancelStack).perform()},o.updateStack=function(){const e=this.getLocation(),n={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,unpitched:I.default.copy(this.opts.unpitched)},c={type:this.name,noDraw:!0,opts:n};this.cancelStack.push(c)},o.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),n=e.getPartUuid(this.opts.partIdx),c=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),E=this.measureData.getDpqValue(),p=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:n,measureUuid:c,voiceUuid:_,dpq:E,timePos:p,isConcertPitch:!1}}return this.location},o.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(i);const s=i},744731:(N,M,t)=>{t.r(M),t.d(M,{default:()=>i});var g=t(279140),O=t(195446),T=t(737903),I=t(123491),A=t(351277),v=t(515819),P=t(737296),U=t(349386),m=t(972913),f=t(974106),h=t(627931),u=t(793317),l=t(42651);const d=function(o,s,e){this.init(o,s,e)};d.NAME="action.AddChordCrossMeasure2";const a=d.prototype;a.initMeasureData=u.default,a.name=d.NAME,a.init=function(o,s,e){this.initMeasureData(o,s),this.cancelStack=e,this.opts=s,this.sanitized=!1,this.addChordAction=null},a.checkPreconditions=function(){this.sanitizeIfNeeded(),(0,m.default)(this.opts),this.checkPitchedPart(),this.checkLocation(),this.checkAvailableSpace(),this.checkNoteData()},a.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},a.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},a.checkAvailableSpace=function(){let o=this.getRequiredDuration();const s=this.getActualDuration();if(!(s>o)){{if(s===o)return;o-=s}if(this.isTuplet()){const e=this.getAvailableSpace();e<o&&this.raiseNotEnoughSpace(o,e)}}},a.getRequiredDuration=function(){const o=this.measureData.getDpqValue(),s=this.getTimeModif();return(0,U.default)(this.opts,o,s)},a.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},a.getActualDuration=function(){const s=this.getVoice().getNote(this.opts.noteIdx);return I.default.getDuration(s)},a.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},a.getAvailableSpace=function(){const o=this.getVoiceOrTupletForGet(),s=this.opts.noteIdx+1;return o.getSpaceFromIdx(s)},a.raiseNotEnoughSpace=function(o,s){const e=this.getVoiceOrTupletForGet(),n=this.measureData.getDpqValue(),c=e.getAbsoluteTimeModif();throw new g.default(o,s,n,c)},a.getVoiceOrTupletForGet=function(){const o=this.opts.voiceIdx,s=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(o,s)},a.checkNoteData=function(){this.getAddChordAction().checkPreconditions()},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.addNote();const o=this.getRequiredDuration();this.getActualDuration()!==o&&this.changeDuration()},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)},a.addNote=function(){const o=this.getAddChordAction();o.cancelStack=this.cancelStack,o.perform()},a.getAddChordAction=function(){if(this.addChordAction===null){const o=this.getActualDurationOpts(),s=this.opts.heads.map(r),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,insertMode:P.default.REPLACE,durationType:o.durationType,nbDots:o.nbDots,heads:s,checkLine:this.opts.checkLine};this.addChordAction=new h.default(this.measureData,e,this.cancelStack)}return this.addChordAction};const r=function(o){const e={pitch:A.default.copy(o.pitch)};return typeof o.fretData!="undefined"&&(e.fretData=(0,T.default)(o.fretData)),e};a.getActualDurationOpts=function(){const s=this.getVoice().getNote(this.opts.noteIdx),e=this.measureData.getDpqValue(),n=I.default.getNormalQuarterDuration(s,e);return v.default.quarterToDurationOpts(n)},a.changeDuration=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots},s=new f.default(this.measureData,o,this.cancelStack);s.checkPreconditions(),s.perform()},a.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,l.default)(d);const i=d},747670:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(52275),O=t(217692),T=t(783177),I=t(316610),A=t(701387),v=t(726042),P=t(646456),U=t(857552),m=t(303443),f=t(443749),h=t(195446),u=t(723631),l=t(97324),d=t(458670),a=t(42651);const r=function(s,e,n){this.init(s,e,n)};r.NAME="action.AddPluckedRangeAtTimePos";const i=r.prototype;i.name=r.NAME,i.init=function(s,e,n){(0,g.default)(s,e),(0,O.A)(s,e),(0,T.default)(s,e),this.scoreData=s,this.opts=e,this.cancelStack=n,this.location=null},i.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkValues()},i.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new h.default},i.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx),this.checkStartTimePos(),this.checkStopTimePos(),this.checkRevertRange(),this.checkStaffIdx()},i.checkStartTimePos=function(){const s=this.getStartMeasure(),e={dpq:this.opts.startDpq,timePos:this.opts.startTimePos},n=(0,I.A)(e,s),c=A.default.getNbDivisions(s);if(!v.default.isNumber(n)||n<0||n>=c){const _=A.default.getDpq(s);throw new P.A(n,_)}},i.checkStopTimePos=function(){const s=this.getStopMeasure(),e={dpq:this.opts.stopDpq,timePos:this.opts.stopTimePos},n=(0,I.A)(e,s),c=A.default.getNbDivisions(s);if(!v.default.isNumber(n)||n<0||n>c){const _=A.default.getDpq(s);throw new P.A(n,_)}},i.checkRevertRange=function(){const s=this.opts.startMeasureIdx,e=this.opts.stopMeasureIdx,n=e-s;if(n<0)throw new U.default(U.default.MEASURE,s,e);if(n===0){const c=v.default.lcm(this.opts.startDpq,this.opts.stopDpq),_=this.opts.startTimePos*c/this.opts.startDpq,E=this.opts.stopTimePos*c/this.opts.stopDpq;if(_>E)throw new U.default(U.default.TIME_POS,_,E);if(_===E)throw new m.A(m.A.TIME_POS)}},i.checkStaffIdx=function(){const s=this.getStartMeasure(),e=A.default.getNbStaves(s),n=this.opts.staffIdx;if(!v.default.isInteger(n)||n<0||n>=e)throw new f.default(n)},i.checkValues=function(){u.A.check(this.opts.placement),l.A.checkInternal(this.opts.type)},i.getStartMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},i.getStopMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addPluckedRange(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,startMeasureUuid:s.startMeasureUuid,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureUuid:s.stopMeasureUuid,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,staffUuid:s.staffUuid,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.storeAction(e)}},i.addPluckedRange=function(){const s={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,placement:this.opts.placement,type:this.opts.type};new d.A(this.scoreData,s,this.cancelStack).perform()},i.updateStack=function(){const s=this.getLocation(),e={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.startMeasureUuid,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,staffUuid:s.staffUuid}};this.cancelStack.push(e)},i.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getMeasureUuid(this.opts.startMeasureIdx),n=this.scoreData.getMeasureUuid(this.opts.stopMeasureIdx),c=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:s,staffUuid:c,startMeasureUuid:e,stopMeasureUuid:n}}return this.location},(0,a.default)(r);const o=r},757785:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(31278),O=t(46056),T=t(881540),I=t(123491),A=t(52275),v=t(704621),P=t(981801),U=t(898039),m=t(793317),f=t(42651);const h=function(d,a,r){this.init(d,a,r)};h.NAME="action.AddGraceSlur",h.isNoChange=function(d){return d instanceof g.default};const u=h.prototype;u.name=h.NAME,u.initMeasureData=m.default,u.init=function(d,a,r){(0,A.default)(d,a),(0,v.default)(d,a),(0,P.default)(d,a),this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null,(0,U.default)(this.measureData,this.opts)},u.checkPreconditions=function(){this.checkNoteIdx(),this.checkNotRest(),this.checkHasGraceNote(),this.checkHasGraceSlur()},u.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},u.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},u.checkHasGraceNote=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).hasGrace(this.opts.noteIdx))throw new O.A},u.checkHasGraceSlur=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(I.default.hasGraceSlur(a))throw new g.default},u.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addGraceSlur(),this.updateStack()},u.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,divisions:d.dpq,timePos:d.timePos}};this.cancelStack.storeAction(a)}},u.addGraceSlur=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new T.A(this.measureData,d,this.cancelStack).perform()},u.updateStack=function(){const d=this.getLocation(),a={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq}};this.cancelStack.push(a)},u.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),a=d.getPartUuid(this.opts.partIdx),r=d.getMeasureUuid(this.opts.measureIdx),i=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:r,voiceUuid:i,dpq:o,timePos:e}}return this.location},(0,f.default)(h);const l=h},764150:(N,M,t)=>{t.r(M),t.d(M,{default:()=>h});var g=t(857552),O=t(153271),T=t(270259),I=t(31278),A=t(110976),v=t(566178),P=t(407819),U=t(42651);const m=function(u,l,d){this.init(u,l,d)};m.NAME="action.SetTempoSegment";const f=m.prototype;f.name=m.NAME,f.init=function(u,l,d){(0,P.default)(u,l),this.scoreData=u,this.cancelStack=d,this.opts=l,this.location=null},f.checkPreconditions=function(){this.checkLocation(),this.sanitize(),A.default.check(this.opts.tempo),this.checkDifferentTempo(),this.checkCurrentConsistent()},f.checkLocation=function(){const l=this.scoreData.getPartMeasures(0).length,d=this.opts.startMeasureIdx;let a=d;if(a<0||a>=l)throw new O.default(a,O.default.GET);const r=this.opts.stopMeasureIdx;if(r<d)throw new g.default(g.default.MEASURE,d,r);if(a=this.opts.stopMeasureIdx,a<0||a>=l)throw new O.default(a,O.default.GET)},f.sanitize=function(){typeof this.opts.tempo=="number"&&(this.opts.tempo=A.default.createWithDefaultDisplay(this.opts.tempo))},f.checkDifferentTempo=function(){if(!this.hasDifferentTempo())throw new I.default},f.hasDifferentTempo=function(){const u=this.getFirstTempo();return!A.default.isSame(u,this.opts.tempo)},f.checkCurrentConsistent=function(){const u=this.getFirstTempo();for(let l=this.opts.startMeasureIdx+1;l<=this.opts.stopMeasureIdx;l++){const d=this.scoreData.getRealTempo(l);if(!A.default.isSame(d,u))throw new T.A(T.A.TEMPO)}},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const u=this.getPreviousData();this.setTempo(),this.updateStack(u)},f.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation().measureUuids.slice(),d=A.default.copy(this.opts.tempo),a={actionName:this.name,opts:{measureUuids:l,tempo:d}};this.cancelStack.storeAction(a)}},f.getPreviousData=function(){return{tempo:this.getFirstTempo()}},f.getFirstTempo=function(){return this.scoreData.getRealTempo(this.opts.startMeasureIdx)},f.setTempo=function(){const u=A.default.copy(this.opts.tempo),l={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,tempo:u};new v.A(this.scoreData,l,this.cancelStack).perform()},f.updateStack=function(u){const d=this.getLocation().measureUuids.slice(),a=A.default.copy(u.tempo),r={type:this.name,noDraw:!0,opts:{measureUuids:d,previousTempo:a}};this.cancelStack.push(r)},f.getLocation=function(){if(this.location===null){const u=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx);this.location={measureUuids:u}}return this.location},(0,U.default)(m);const h=m},792273:(N,M,t)=>{t.r(M),t.d(M,{default:()=>l});var g=t(99923),O=t(292681),T=t(123491),I=t(476943),A=t(737296),v=t(122007),P=t(793317),U=t(519405),m=t(42651);const f=!1,h=function(d,a,r){this.init(d,a,r)};h.NAME="action.RemoveChordPercu";const u=h.prototype;u.name=h.NAME,u.initMeasureData=P.default,u.init=function(d,a,r){this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,this.sanitized=!1,this.voice=null},u.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest()},u.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new g.A},u.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},u.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},u.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},u.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeChord()},u.removeChord=function(){let d=this.getChord();d=d.slice(),d.forEach(this.removeChordHead,this)},u.getChord=function(){let a=this.getVoice().getChord(this.opts.noteIdx);return a=I.default.makeArray(a),a},u.removeChordHead=function(d,a,r){let i=T.default.getUnpitched(d);i=O.default.copy(i);const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,formatRests:this.opts.formatRests,unpitched:i,keepFormer:!1};a===r.length-1?o.insertMode=this.opts.insertMode:o.insertMode=A.default.REPLACE;const s=new v.default(this.measureData,o,this.cancelStack);(0,U.default)(s)},u.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=A.default.REPLACE),typeof this.opts.formatRests=="undefined"&&(this.opts.formatRests=f),this.sanitized=!0)},(0,m.default)(h);const l=h},796213:(N,M,t)=>{t.r(M),t.d(M,{default:()=>q});var g=t(364842),O=t(702544),T=t(799945),I=t(606752),A=t(426191),v=t(701387),P=t(35802),U=t(518558),m=t(383279),f=t(737903),h=t(210888),u=t(777345),l=t(110976),d=t(74446),a=t(863244),r=t(886190),i=t(156441),o=t(537546),s=t(641239),e=t(555308),n=t(805578),c=t(677585),_=t(514756),E=t(752582),x=t(700068),p=t(714151),D=t(175086),C=t(238647),B=t(452175),R=t(243073),L=t(355832),k=t(770978),W=t(42651);const G="Drumset",j="Drs.",y=5,X=function(S,K,V){this.init(S,K,V)};X.NAME="action.AddPartPercu";const F=X.prototype;F.name=X.NAME,F.init=function(S,K,V){this.scoreData=S,this.cancelStack=V,this.opts=K,this.sanitized=!1,(typeof K.previousUuid!="undefined"||typeof K.nextUuid!="undefined")&&(K.partIdx=(0,s.default)(S,K.previousUuid,K.nextUuid),delete K.previousUuid,delete K.nextUuid)},F.checkPreconditions=function(){this.hasGivenPartUuid()&&(0,c.default)(this.scoreData,this.opts),this.sanitizeIfNeeded();const S=this.scoreData.getNbParts(),K=this.opts.partIdx;if(typeof K!="number"||K<0||K>S)throw new O.default(K,O.default.INSERT);if(!this.scoreData.hasTime())throw new T.default("time");if(!this.scoreData.hasNbMeasures())throw new T.default("nbMeasures");const V=this.checkInstruments();this.checkPitchMapping(V),a.default.checkPercu(this.opts.nbStaffLines),this.checkVoicesData(),o.default.check(this.opts.staffUuid)},F.isValidUuid=function(S){return!!(typeof S=="string"&&h.default.isValid(S))},F.checkInstruments=function(){return(0,p.default)(this.opts.instrumentsList)},F.checkPitchMapping=function(S){this.opts.pitchMapping&&!this.opts.unpitchedMapping&&(this.opts.unpitchedMapping=this.opts.pitchMapping),(0,B.default)(this.opts.unpitchedMapping,S),(0,R.default)(this.opts.unpitchedMapping,S)},F.checkVoicesData=function(){(0,_.default)(this.opts.voicesData),(0,x.default)([this.opts])},F.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();const S=this.getLocation(),K=this.scoreData.getNbMeasures(),V=[];for(let H=0;H<K;H++)V.push(this.scoreData.getTime(H));const z=w(K,V);this.fillBarlines(z),this.hasParts()||(this.fillCommonContent(),this.fillMeasureUuids());const Q=this.createPartHeader();this.hasGivenPartUuid()&&this.scoreData.setPartUuid(Q,z,this.opts.partUuid),this.scoreData.insertPart(Q,z,this.opts.partIdx),this.fillUnpitchedMapping(Q),this.storeAction(S),this.fillStaff(),this.updateStack()},F.sanitizeIfNeeded=function(){this.sanitized||((typeof this.opts.previousUuid!="undefined"||typeof this.opts.nextUuid!="undefined")&&(this.opts.partIdx=(0,s.default)(this.scoreData,this.opts.previousUuid,this.opts.nextUuid),delete this.opts.previousUuid,delete this.opts.nextUuid),typeof this.opts.nbStaffLines=="undefined"&&(this.opts.nbStaffLines=y),this.opts.instrumentsList.forEach(J),typeof this.opts.volume=="undefined"&&(this.opts.volume=i.default.DEFAULT),typeof this.opts.voicesData=="undefined"&&this.generateVoicesData(),(0,E.default)(this.opts),typeof this.opts.staffUuid=="undefined"&&(this.opts.staffUuid=h.default.generate()),this.sanitized=!0)};const J=function(S){typeof S.MIDIProgram=="undefined"&&(S.MIDIProgram=r.default.UNPITCHED_PROGRAM)};F.generateVoicesData=function(){this.opts.voicesData={mainVoiceIdx:0,voices:[0]}};const w=function(S,K){const V=[],z=K[0],Q=b(z);V.push(Q);for(let $=0;$<S-1;$++){const Y=K[$+1],tt=Z(Y);V.push(tt)}return{measure:V}},b=function(S){const K=Z(S),V=v.default.getAttributes(K),z=(0,f.default)(V);return v.default.setOwnAttributes(K,z),K},Z=function(S){const K={note:[]},V={divisions:"1"};P.default.setNbStaves(V,0);const z=new A.default(0,U.default);return z.addGlobalEntry(S),S=(0,f.default)(z.dumpAttribute()),P.default.setTime(V,S),v.default.setAttributes(K,V),v.default.setSound(K,{}),K};F.fillBarlines=function(S){S.measure.forEach(this.fillMeasureBarlines,this)},F.fillMeasureBarlines=function(S,K,V){const z=K===V.length-1;if(this.scoreData.hasContent()){const Q=this.scoreData.getMeasure(0,K);if(v.default.hasBarlines(Q)){const H=v.default.getBarlines(Q);v.default.setBarlines(S,(0,f.default)(H))}}else z&&v.default.addFinalBarlines(S)},F.hasParts=function(){return this.scoreData.getNbParts()>0},F.fillMeasureUuids=function(){const S=this.scoreData.getMeasuresHeaders(),K=this.scoreData.getNbMeasures();(0,k.default)(S,K)},F.fillCommonContent=function(){const S=this.scoreData.getNbMeasures(),K=this.scoreData.getTempo(0),V=l.default.createWithDefaultDisplay(K),z=this.scoreData.getSwing(0),Q=this.scoreData.getCommonContent();for(let H=0;H<S;H++){Q.addMeasure(H,l.default.copy(V),u.default.copy(z)),H===0&&(Q.setOwnTempo(H,l.default.copy(V)),Q.setOwnSwing(H,u.default.copy(z)));let $=this.scoreData.getTime(H);$=U.default.copy($),Q.setDisplayedTime(H,$);let Y=this.scoreData.getBeatsList(H);Y=d.default.copy(Y),Q.setBeatsList(H,Y)}},F.createPartHeader=function(){const S=this.getName(),K=m.default.create(S);if(this.hasAbbreviation()){const z=this.getAbbreviation();m.default.setAbbreviation(K,z)}const V=(0,e.default)(this.opts.instrumentsList);return m.default.setInstruments(K,V.score,V.MIDI),m.default.setGlobalVolume(K,this.opts.volume),K},F.getName=function(){return typeof this.opts.name=="string"?this.opts.name:G},F.hasAbbreviation=function(){return typeof this.opts.name=="undefined"?!0:typeof this.opts.abbreviation!="undefined"},F.getAbbreviation=function(){if(typeof this.opts.name=="undefined")return j;if(typeof this.opts.abbreviation=="string")return this.opts.abbreviation;throw new g.default("unreachable")},F.fillStaff=function(){const S={staffIdx:0,partIdx:this.opts.partIdx,nbStaffLines:this.opts.nbStaffLines,voicesData:(0,f.default)(this.opts.voicesData),voiceIdxToUuidMapping:(0,f.default)(this.opts.voiceIdxToUuidMapping),staffUuid:this.opts.staffUuid};new I.default(this.scoreData,S,this.cancelStack).perform()},F.hasGivenPartUuid=function(){return typeof this.opts.partUuid!="undefined"},F.updateStack=function(){const S={partUuid:this.scoreData.getPartUuid(this.opts.partIdx)},K={type:this.name,opts:S};this.cancelStack.push(K),this.cancelStack.stateNeedCompleteRedraw()},F.fillUnpitchedMapping=function(S){const K=m.default.getMIDIInstruments(S),V=(0,D.default)(K),z=(0,C.default)(this.opts.unpitchedMapping,V);m.default.setUnpitchedMapping(S,z)},F.storeAction=function(S){if(!this.cancelStack.hasAction()){const K=(0,n.default)(this.opts.unpitchedMapping),V=(0,f.default)(this.opts.instrumentsList),z=(0,f.default)(this.opts.voicesData),Q=(0,f.default)(this.opts.voiceIdxToUuidMapping),H={partUuid:this.scoreData.getPartUuid(this.opts.partIdx),staffUuid:this.opts.staffUuid,name:this.getName(),previousUuid:S.previousUuid,nextUuid:S.nextUuid,unpitchedMapping:K,instrumentsList:V,voiceIdxToUuidMapping:Q,nbStaffLines:this.opts.nbStaffLines,voicesData:z,volume:this.opts.volume};if(!this.opts.testContext){const Y=(0,L.default)(K);H.pitchMapping=Y}this.hasAbbreviation()&&(H.abbreviation=this.getAbbreviation());const $={actionName:this.name,opts:H};this.cancelStack.storeAction($)}},F.getLocation=function(){const S=this.opts.partIdx===0?null:this.scoreData.getPartUuid(this.opts.partIdx-1),K=this.scoreData.getNbParts(),V=this.opts.partIdx===K?null:this.scoreData.getPartUuid(this.opts.partIdx);if(this.hasGivenPartUuid()&&(this.opts.partUuid===S||this.opts.partUuid===V)){const Q=`The added measure uuid [${this.opts.partUuid}] also apprears on the location. `,H=new g.default("Inconsistency",Q);throw H.partUuid=this.opte.partUuid,H}return{previousUuid:S,nextUuid:V}},(0,W.default)(X);const q=X},824566:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(443749),O=t(746796),T=t(646456),I=t(723631),A=t(701387),v=t(726042),P=t(956112),U=t(52275),m=t(704621),f=t(783177),h=t(316610),u=t(198100),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddMuteAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,U.default)(i,o),(0,m.default)(i,o),(0,f.default)(i,o),this.scoreData=i,this.cancelStack=s,this.opts=o,this.localTimePos=null,this.location=null},a.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const i=this.getMeasure(),o=A.default.getNbStaves(i),s=this.opts.staffIdx;if(!v.default.isInteger(s)||s<0||s>=o)throw new g.default(s)},a.checkTimePos=function(){const i=this.getLocalTimePos(),o=this.getMeasure(),s=A.default.getNbDivisions(o);if(!v.default.isNumber(i)||i<0||i>=s){const e=A.default.getDpq(o);throw new T.A(i,e)}},a.getLocalTimePos=function(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,h.A)(this.opts,i)}return this.localTimePos},a.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},a.checkParam=function(){if(!I.A.isValid(this.opts.placement))throw new O.A(this.opts.placement);P.A.check(this.opts.type)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addMute(),this.updateStack()},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type}};this.cancelStack.storeAction(o)}},a.addMute=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new u.A(this.scoreData,i,this.cancelStack).perform()},a.updateStack=function(){const i=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(o)},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx),s=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,measureUuid:o,staffUuid:s}}return this.location},(0,l.default)(d);const r=d},830056:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(443749),O=t(746796),T=t(447472),I=t(646456),A=t(723631),v=t(857546),P=t(882934),U=t(701387),m=t(726042),f=t(1838),h=t(52275),u=t(704621),l=t(783177),d=t(316610),a=t(574023),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.AddDynamicAtTimePos";const o=i.prototype;o.name=i.NAME,o.init=function(e,n,c){(0,h.default)(e,n),(0,u.default)(e,n),(0,l.default)(e,n),this.scoreData=e,this.cancelStack=c,this.opts=n,this.localTimePos=null,this.location=null},o.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},o.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const e=this.getMeasure(),n=U.default.getNbStaves(e),c=this.opts.staffIdx;if(!m.default.isInteger(c)||c<0||c>=n)throw new g.default(c)},o.checkTimePos=function(){const e=this.getLocalTimePos(),n=this.getMeasure(),c=U.default.getNbDivisions(n);if(!m.default.isNumber(e)||e<0||e>=c){const _=U.default.getDpq(n);throw new I.A(e,_)}},o.getLocalTimePos=function(){if(this.localTimePos===null){const e=this.getMeasure();this.localTimePos=(0,d.A)(this.opts,e)}return this.localTimePos},o.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},o.checkParam=function(){if(!A.A.isValid(this.opts.placement))throw new O.A(this.opts.placement);f.A.check(this.opts.style);const e=this.getSoundDynamic();if(!P.A.isValidDynamic(e))throw new T.A(e)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addDynamic(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n=this.getSoundDynamic(),c={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,staffUuid:e.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:n}};this.cancelStack.storeAction(c)}},o.addDynamic=function(){const e=this.getSoundDynamic(),n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:e};new a.A(this.scoreData,n,this.cancelStack).perform()},o.getSoundDynamic=function(){return typeof this.opts.sound!="undefined"&&this.opts.sound!==null?this.opts.sound:v.A.getDefaultIntensityForStyle(this.opts.style)},o.updateStack=function(){const e=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,staffUuid:e.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(n)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx),n=this.scoreData.getMeasureUuid(this.opts.measureIdx),c=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:e,measureUuid:n,staffUuid:c}}return this.location},(0,r.default)(i);const s=i},842086:(N,M,t)=>{t.r(M),t.d(M,{default:()=>U});var g=t(704621),O=t(405563),T=t(153271),I=t(522665),A=t(42651);const v=function(m,f,h){this.init(m,f,h)};v.NAME="action.RemoveJumpTag";const P=v.prototype;P.name=v.NAME,P.init=function(m,f,h){(0,g.default)(m,f),this.scoreData=m,this.opts=f,this.cancelStack=h,this.location=null},P.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},P.checkLocation=function(){const m=this.scoreData.getNbMeasures(),f=this.opts.measureIdx;if(f<0||f>=m)throw new T.default(f,T.default.GET)},P.checkExistence=function(){if(!this.getCommonContent().hasJumpTag(this.opts.measureIdx))throw new O.A},P.getCommonContent=function(){return this.scoreData.getCommonContent()},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const f=this.getCommonContent().getJumpTag(this.opts.measureIdx);this.storeAction(f);const h={measureIdx:this.opts.measureIdx};new I.A(this.scoreData,h,this.cancelStack).perform(),this.updateStack(f)},P.updateStack=function(m){const f=this.getLocation(),h={type:this.name,noDraw:!0,opts:{measureUuid:f.measureUuid,type:m}};this.cancelStack.push(h)},P.storeAction=function(m){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{measureUuid:f.measureUuid,type:m}};this.cancelStack.storeAction(h)}},P.getLocation=function(){if(this.location===null){const m=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:m}}return this.location},(0,A.default)(v);const U=v},846275:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(443749),O=t(746796),T=t(646456),I=t(723631),A=t(701387),v=t(726042),P=t(512386),U=t(52275),m=t(704621),f=t(783177),h=t(316610),u=t(77852),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddWordAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,U.default)(i,o),(0,m.default)(i,o),(0,f.default)(i,o),this.scoreData=i,this.cancelStack=s,this.opts=o,this.localTimePos=null,this.location=null},a.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const i=this.getMeasure(),o=A.default.getNbStaves(i),s=this.opts.staffIdx;if(!v.default.isInteger(s)||s<0||s>=o)throw new g.default(s)},a.checkTimePos=function(){const i=this.getLocalTimePos(),o=this.getMeasure(),s=A.default.getNbDivisions(o);if(!v.default.isNumber(i)||i<0||i>=s){const e=A.default.getDpq(o);throw new T.A(i,e)}},a.getLocalTimePos=function(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,h.A)(this.opts,i)}return this.localTimePos},a.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},a.checkParam=function(){if(!I.A.isValid(this.opts.placement))throw new O.A(this.opts.placement);P.A.check(this.opts.text)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.text=P.A.trim(this.opts.text),this.storeAction(),this.addWord(),this.updateStack()},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text}};this.cancelStack.storeAction(o)}},a.addWord=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text};new u.A(this.scoreData,i,this.cancelStack).perform()},a.updateStack=function(){const i=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(o)},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx),s=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,measureUuid:o,staffUuid:s}}return this.location},(0,l.default)(d);const r=d},846947:(N,M,t)=>{t.r(M),t.d(M,{default:()=>G});var g=t(31278),O=t(195446),T=t(748803),I=t(883782),A=t(364842),v=t(737296),P=t(878363),U=t(476031),m=t(33674),f=t(898039),h=t(52275),u=t(704621),l=t(981801),d=t(783177),a=t(714898),r=t(244138),i=t(82028),o=t(372933),s=t(405347),e=t(491531),n=t(287179),c=t(381642),_=t(42651),E=t(351277),x=t(209175),p=t(123491),D=t(737903),C=t(726042),B=t(793317),R=t(515819);const L=!1,k=function(j,y,X){this.init(j,y,X)};k.NAME="action.AddNote";const W=k.prototype;W.name=k.NAME,W.initMeasureData=B.default,W.init=function(j,y,X){(0,h.default)(j,y),(0,u.default)(j,y),(0,l.default)(j,y),(0,d.default)(j,y),this.initMeasureData(j,y),this.cancelStack=X,this.opts=y,this.actions=[],this.location=null},W.checkPreconditions=function(){this.checkCommonElements(),this.hasNoteRef()&&this.convertNoteRef(),this.sanitize(),this.checkTimeLocation(),this.isVoiceDisplayed()&&this.isChord()&&this.opts.insertMode===v.default.REPLACE?(this.hasNoteIdx()||this.inferNoteIdx(),this.addChordActions()):this.addSingleNoteAction()},W.checkCommonElements=function(){this.checkPitchedPart(),this.checkVoiceIdx(),this.checkCompatibleVoiceStaffIdx()},W.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},W.checkVoiceIdx=function(){if(!this.measureData.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new I.default(this.opts.voiceIdx)},W.checkCompatibleVoiceStaffIdx=function(){(0,m.default)(this.measureData,this.opts)},W.hasNoteRef=function(){return typeof this.opts.noteIdxRef=="number"&&typeof this.opts.voiceIdxRef=="number"},W.convertNoteRef=function(){(0,o.default)(this.measureData,this.opts)},W.sanitize=function(){typeof this.opts.line!="undefined"&&(0,U.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts),typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=v.default.REPLACE),typeof this.opts.formatRests=="undefined"&&(this.opts.formatRests=L),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),typeof this.opts.keepFormer=="undefined"&&(this.opts.keepFormer=!0)},W.checkTimeLocation=function(){if(this.hasTimePos())this.checkTimePos();else if(this.hasNoteIdx())this.checkNoteIdx();else throw new A.default("Unexpected")},W.hasTimePos=function(){return typeof this.opts.timePos=="number"&&typeof this.opts.divisions=="number"&&typeof this.opts.timeModif!="undefined"},W.checkTimePos=function(){const j=this.measureData.getMeasure();(0,r.default)(j,this.opts.timePos,this.opts.divisions)},W.hasNoteIdx=function(){return typeof this.opts.noteIdx=="number"},W.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},W.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},W.isChord=function(){let j;const y=this.measureData.getVoice(this.opts.voiceIdx);if(this.hasNoteIdx())j=this.opts.noteIdx;else if(this.hasTimePos()){const X=this.measureData.getDpqValue(),F=C.default.lcm(X,this.opts.divisions),J=this.opts.timePos*F/this.opts.divisions,w=F/X;j=(0,i.default)(y,w,J)}else throw new A.default("Unexpected");return!y.isRest(j)},W.inferNoteIdx=function(){(0,f.default)(this.measureData,this.opts)},W.addChordActions=function(){if(this.addHeadInsertion(),this.noChange()&&this.isStrictAdd())throw new T.default(T.default.INSERT,E.default.copy(this.opts.pitch));if(this.noChange()&&this.addAccidentalChange(),this.needChangeDuration()&&this.addDurationChange(),this.noChange())throw new g.default},W.addAccidentalChange=function(){const j={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:E.default.copy(this.opts.pitch),accidental:this.opts.accidental,record:!1};this.addAction(n.default,j)},W.addHeadInsertion=function(){const j={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:E.default.copy(this.opts.pitch),fretData:this.opts.fretData,accidental:this.opts.accidental,checkLine:this.opts.checkLine,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes,record:!1};this.addAction(c.default,j)},W.needChangeDuration=function(){const j=R.default.durationOptsToQuarter(this.opts),X=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),F=this.measureData.getDpqValue(),J=p.default.getNormalQuarterDuration(X,F);return j!==J},W.addDurationChange=function(){const j={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests,record:!1};this.addAction(s.default,j)},W.addAction=function(j,y){const X=new j(this.measureData,y,this.cancelStack);try{X.checkPreconditions(),this.actions.push(X)}catch(F){if(!j.isNoChange(F))throw F}},W.noChange=function(){return this.actions.length===0},W.addSingleNoteAction=function(){const j={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,pitch:E.default.copy(this.opts.pitch),fretData:this.opts.fretData,insertMode:this.opts.insertMode,accidental:this.opts.accidental,checkLine:this.opts.checkLine,keepFormer:this.opts.keepFormer,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};if(this.hasTimePos())j.divisions=this.opts.divisions,j.timePos=this.opts.timePos,j.timeModif=x.default.copy(this.opts.timeModif);else if(this.hasNoteIdx())j.noteIdx=this.opts.noteIdx;else throw new A.default("Unexpected");const y=new e.default(this.measureData,j,this.cancelStack);y.checkPreconditions(),this.opts.noteIdx=y.opts.noteIdx,this.actions.push(y)},W.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.performActions(),this.updateCancelStack()},W.performActions=function(){this.actions.forEach(this.performAction,this)},W.performAction=function(j){j.cancelStack=this.cancelStack,j.perform()},W.updateCancelStack=function(){const j=this.getLocation(),y={type:this.name,noDraw:!0,opts:{partUuid:j.partUuid,measureUuid:j.measureUuid,voiceUuid:j.voiceUuid,divisions:j.dpq,timePos:j.timePos,pitch:E.default.copy(this.opts.pitch),insertMode:this.opts.insertMode}};this.cancelStack.push(y)},W.storeAction=function(){var j;if(!this.cancelStack.hasAction()){const y=this.getLocation(),X=x.default.copy(y.timeModif),F={partUuid:y.partUuid,measureUuid:y.measureUuid,voiceUuid:y.voiceUuid,staffUuid:y.staffUuid,divisions:y.dpq,timePos:y.timePos,pitch:E.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,nbDots:this.opts.nbDots,durationType:this.opts.durationType,insertMode:this.opts.insertMode,formatRests:!!this.opts.formatRests,timeModif:X,checkLine:this.opts.checkLine,keepFormer:this.opts.keepFormer,sameStringAsPreviousNotes:!!this.opts.sameStringAsPreviousNotes,source:(j=this.opts.source)!=null?j:P.default.UNKNOWN};typeof this.opts.fretData!="undefined"&&(F.fretData=(0,D.default)(this.opts.fretData));const J={actionName:this.name,opts:F};this.cancelStack.storeAction(J)}},W.getLocation=function(){if(this.location===null){const j=this.measureData.getScoreData(),y=j.getPartUuid(this.opts.partIdx),X=j.getMeasureUuid(this.opts.measureIdx),F=j.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),J=j.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),w=this.measureData.getDpqValue(),b=this.measureData.getVoice(this.opts.voiceIdx),Z=b.getRangeSpace(0,this.opts.noteIdx),q=b.getNote(this.opts.noteIdx);let S=p.default.getTimeModif(q);S=x.default.copy(S),this.location={partUuid:y,measureUuid:X,staffUuid:J,voiceUuid:F,dpq:w,timePos:Z,timeModif:S}}return this.location},W.isStrictAdd=function(){return!!this.opts.isStrictAdd},(0,_.default)(k);const G=k},867734:(N,M,t)=>{t.r(M),t.d(M,{default:()=>U});var g=t(704621),O=t(153271),T=t(31278),I=t(986925),A=t(42651);const v=function(m,f,h){this.init(m,f,h)};v.NAME="action.RemoveSystemBreak";const P=v.prototype;P.name=v.NAME,P.init=function(m,f,h){(0,g.default)(m,f),this.scoreData=m,this.opts=f,this.cancelStack=h,this.location=null},P.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},P.checkLocation=function(){const m=this.scoreData.getNbMeasures(),f=this.opts.measureIdx;if(f<0||f>=m)throw new O.default(f,O.default.GET)},P.checkExistence=function(){if(!this.getCommonContent().hasSystemBreak(this.opts.measureIdx))throw new T.default},P.getCommonContent=function(){return this.scoreData.getCommonContent()},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const f=this.getCommonContent().getSystemBreak(this.opts.measureIdx);this.storeAction(f);const h={measureIdx:this.opts.measureIdx};new I.A(this.scoreData,h,this.cancelStack).perform(),this.updateStack(f)},P.updateStack=function(m){const f=this.getLocation(),h={type:this.name,noDraw:!0,opts:{measureUuid:f.measureUuid,measureIdx:this.opts.measureIdx,value:m}};this.cancelStack.push(h),this.cancelStack.stateNeedCompleteRedraw()},P.storeAction=function(m){if(!this.cancelStack.hasAction()){const f=this.getLocation(),h={actionName:this.name,opts:{measureUuid:f.measureUuid,measureIdx:this.opts.measureIdx,value:m}};this.cancelStack.storeAction(h)}},P.getLocation=function(){if(this.location===null){const m=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:m}}return this.location},(0,A.default)(v);const U=v},900110:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(443749),O=t(746796),T=t(646456),I=t(723631),A=t(701387),v=t(726042),P=t(603581),U=t(52275),m=t(704621),f=t(783177),h=t(316610),u=t(225254),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.AddPizzicatoAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(i,o,s){(0,U.default)(i,o),(0,m.default)(i,o),(0,f.default)(i,o),this.scoreData=i,this.cancelStack=s,this.opts=o,this.localTimePos=null,this.location=null},a.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkParam()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const i=this.getMeasure(),o=A.default.getNbStaves(i),s=this.opts.staffIdx;if(!v.default.isInteger(s)||s<0||s>=o)throw new g.default(s)},a.checkTimePos=function(){const i=this.getLocalTimePos(),o=this.getMeasure(),s=A.default.getNbDivisions(o);if(!v.default.isNumber(i)||i<0||i>=s){const e=A.default.getDpq(o);throw new T.A(i,e)}},a.getLocalTimePos=function(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,h.A)(this.opts,i)}return this.localTimePos},a.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},a.checkParam=function(){if(!I.A.isValid(this.opts.placement))throw new O.A(this.opts.placement);P.A.check(this.opts.type)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addPizzicato(),this.updateStack()},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type}};this.cancelStack.storeAction(o)}},a.addPizzicato=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new u.A(this.scoreData,i,this.cancelStack).perform()},a.updateStack=function(){const i=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(o)},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx),s=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,measureUuid:o,staffUuid:s}}return this.location},(0,l.default)(d);const r=d},902224:(N,M,t)=>{t.r(M),t.d(M,{default:()=>a});var g=t(5520),O=t(623671),T=t(837921),I=t(123491),A=t(359932),v=t(95126),P=t(793317),U=t(898039),m=t(52275),f=t(704621),h=t(981801),u=t(42651);const l=function(r,i,o){this.init(r,i,o)};l.NAME="action.AddTechnical";const d=l.prototype;d.initMeasureData=P.default,d.name=l.NAME,d.init=function(r,i,o){(0,m.default)(r,i),(0,f.default)(r,i),(0,h.default)(r,i),this.initMeasureData(r,i),this.cancelStack=o,this.opts=i,this.location=null,this.sanitized=!1,(0,U.default)(this.measureData,this.opts)},d.checkPreconditions=function(){this.checkLocation(),this.checkContentOpts(),this.checkParam(),this.sanitizeIfNeeded()},d.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const r=this.measureData.getVoice(this.opts.voiceIdx);r.checkNoteIdx(this.opts.noteIdx),r.checkNotRest(this.opts.noteIdx)},d.checkContentOpts=function(){switch(this.opts.technicalType){default:break}},d.checkTechnicalOpts=function(){if(typeof this.opts.technicalOpts=="undefined")throw new T.A("technicalOpts")},d.checkParam=function(){if(!A.default.isCommonValid(this.opts.technicalType))throw new O.A(this.opts.technicalType);const i=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(I.default.hasTechnicals(i)&&I.default.hasTechnical(i,this.opts.technicalType,this.opts.technicalOpts))throw new g.A(this.opts.technicalType)},d.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.record=="undefined"&&(this.opts.record=!0),this.sanitized=!0)},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts,noteIdx:this.opts.noteIdx};new v.A(this.measureData,r,this.cancelStack).perform(),this.opts.record&&this.updateStack()},d.updateStack=function(){const r=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:r.partUuid,measureUuid:r.measureUuid,voiceUuid:r.voiceUuid,timePos:r.timePos,divisions:r.dpq,technicalType:this.opts.technicalType}};this.cancelStack.push(i)},d.storeAction=function(){if(!this.cancelStack.hasAction()){const r=this.getLocation(),i={actionName:this.name,opts:{partUuid:r.partUuid,measureUuid:r.measureUuid,voiceUuid:r.voiceUuid,timePos:r.timePos,divisions:r.dpq,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts}};this.cancelStack.storeAction(i)}},d.getLocation=function(){if(this.location===null){const r=this.measureData.getScoreData(),i=r.getPartUuid(this.opts.partIdx),o=r.getMeasureUuid(this.opts.measureIdx),s=r.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getDpqValue(),c=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:i,measureUuid:o,voiceUuid:s,dpq:e,timePos:c}}return this.location},(0,u.default)(l);const a=l},907893:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(416821),O=t(143200),T=t(876338),I=t(123491),A=t(209175),v=t(702868),P=t(259563),U=t(798656),m=t(975924),f=t(793317),h=t(52275),u=t(704621),l=t(981801),d=t(701643),a=t(42651);const r=function(s,e,n){this.init(s,e,n)};r.NAME="action.AddTuplet";const i=r.prototype;i.name=r.NAME,i.initMeasureData=f.default,i.init=function(s,e,n){(0,h.default)(s,e),(0,u.default)(s,e),(0,l.default)(s,e),this.initMeasureData(s,e),this.cancelStack=n,this.opts=e,this.location=null,(0,d.A)(this.measureData,this.opts)},i.checkPreconditions=function(){this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotTuplet(),this.checkTupletCompatibility(),this.checkShardDuration()},i.checkValues=function(){v.A.check(this.opts.tupletType)},i.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},i.checkNotTuplet=function(){const e=this.getVoiceOrTupletForGet().getAbsoluteTimeModif();if(!A.default.isNormal(e))throw new g.A},i.checkTupletCompatibility=function(){const s=this.getNote(),e=I.default.getNbDots(s),n=v.A.getTimeModif(this.opts.tupletType);if(A.default.getWholeNbDots(n)!==e)throw new T.A},i.checkShardDuration=function(){const s=this.getNote(),e=this.getDurationType(s),n=v.A.getTimeModif(this.opts.tupletType),c=A.default.getShiftToShardDurationType(n),_=e+c;if(!P.default.isValid(_))throw new O.A},i.getDurationType=function(s){const e=this.measureData.getDivisionsPerQuarterValue();return(0,m.default)(s,e)},i.getNote=function(){return this.getVoiceOrTupletForGet().getNote(this.opts.noteIdx)},i.getVoiceOrTupletForGet=function(){const s=this.opts.voiceIdx,e=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(s,e)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addTuplet(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e=this.getNote(),n=I.default.getNbDots(e),c=(0,m.default)(e,s.dpq);let _=I.default.getTimeModif(e);_=A.default.copy(_);const E={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,durationType:c,nbDots:n,timeModif:_,tupletType:this.opts.tupletType}};this.cancelStack.storeAction(E)}},i.addTuplet=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,tupletType:this.opts.tupletType};new U.A(this.measureData,s,this.cancelStack).perform()},i.updateStack=function(){const s=this.getLocation(),e={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,timePos:s.timePos,divisions:s.dpq,tupletType:this.opts.tupletType}};this.cancelStack.push(e)},i.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),e=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),c=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),x=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:n,voiceUuid:c,dpq:_,timePos:x}}return this.location},(0,a.default)(r);const o=r},908617:(N,M,t)=>{t.r(M),t.d(M,{default:()=>e});var g=t(247739),O=t(292681),T=t(104907),I=t(2835),A=t(33674),v=t(831121),P=t(52275),U=t(704621),m=t(981801),f=t(783177),h=t(898039),u=t(76004),l=t(404747),d=t(655035),a=t(768268),r=t(793317),i=t(42651);const o=function(n,c,_){this.init(n,c,_)};o.NAME="action.AddGraceToChordPercu";const s=o.prototype;s.name=o.NAME,s.initMeasureData=r.default,s.init=function(n,c,_){(0,P.default)(n,c),(0,U.default)(n,c),(0,m.default)(n,c),(0,f.default)(n,c),this.initMeasureData(n,c),this.cancelStack=_,this.opts=c,(0,h.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null},s.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.measureData.getVoice(this.opts.voiceIdx).checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeed(),this.checkInstrument(),this.checkPitchCollision()},s.checkUnpitchedPart=function(){(0,v.default)(this.measureData)},s.checkCompatibleVoiceStaffIdx=function(){(0,A.default)(this.measureData,this.opts)},s.checkPitchCollision=function(){const n=this.measureData.getVoice(this.opts.voiceIdx);if(typeof(0,u.A)(n,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)!="undefined"){const _=O.default.copy(this.opts.unpitched),E=this.measureData.getStaffDetails(this.opts.staffIdx),x=T.default.getNbStaffLines(E);throw new g.A(g.A.INSERT,_,x)}},s.checkInstrument=function(){(0,l.A)(this.measureData,this.opts)},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeed(),this.fillHeadIfMissing(),this.storeAction(),this.addGraceToChord(),this.updateStack()},s.sanitizeIfNeed=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,I.default)(this.measureData,this.opts),this.sanitized=!0)},s.fillHeadIfMissing=function(){typeof this.opts.notehead=="undefined"&&(this.opts.notehead=(0,d.default)(this.measureData,this.opts.partIdx,this.opts.unpitched))},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),c={actionName:this.name,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,staffUuid:n.staffUuid,graceIdx:this.opts.graceIdx,timePos:n.timePos,divisions:n.dpq,unpitched:O.default.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(c)}},s.addGraceToChord=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:O.default.copy(this.opts.unpitched),notehead:this.opts.notehead};new a.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(){const n=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,timePos:n.timePos,divisions:n.dpq,graceIdx:this.opts.graceIdx,unpitched:O.default.copy(this.opts.unpitched)}};this.cancelStack.push(c)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),c=n.getPartUuid(this.opts.partIdx),_=n.getMeasureUuid(this.opts.measureIdx),E=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),x=n.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),p=this.measureData.getDpqValue(),C=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:c,measureUuid:_,voiceUuid:E,staffUuid:x,dpq:p,timePos:C}}return this.location},(0,i.default)(o);const e=o},910748:(N,M,t)=>{t.r(M),t.d(M,{default:()=>f});var g=t(153271),O=t(726042),T=t(366160),I=t(319731),A=t(239174),v=t(42651),P=t(704621);const U=function(h,u,l){this.init(h,u,l)};U.NAME="action.AddRehearsal";const m=U.prototype;m.name=U.NAME,m.init=function(h,u,l){this.scoreData=h,this.cancelStack=l,this.opts=u,(0,P.default)(h,u),this.location=null},m.checkPreconditions=function(){this.checkLocation(),typeof this.opts.type=="undefined"&&(this.opts.type=I.A.DEFAULT),I.A.check(this.opts.type),T.A.check(this.opts.type,this.opts.rehearsal)},m.checkLocation=function(){const h=this.scoreData.getNbMeasures(),u=this.opts.measureIdx;if(!O.default.isInteger(u)||u<0||u>=h)throw new g.default(u,g.default.GET)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addRehearsal(),this.updateStack()},m.storeAction=function(){if(!this.cancelStack.hasAction()){const h=this.getLocation(),u={actionName:this.name,opts:{measureUuid:h.measureUuid,rehearsal:this.opts.rehearsal,type:this.opts.type}};this.cancelStack.storeAction(u)}},m.addRehearsal=function(){const h={measureIdx:this.opts.measureIdx,rehearsal:this.opts.rehearsal,type:this.opts.type};new A.A(this.scoreData,h,this.cancelStack).perform()},m.updateStack=function(){const h=this.getLocation(),u={type:this.name,noDraw:!0,opts:{measureUuid:h.measureUuid}};this.cancelStack.push(u)},m.getLocation=function(){if(this.location===null){const h=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:h}}return this.location},(0,v.default)(U);const f=U},934013:(N,M,t)=>{t.r(M),t.d(M,{default:()=>d});var g=t(31278),O=t(615428),T=t(195446),I=t(123491),A=t(898039),v=t(52275),P=t(704621),U=t(981801),m=t(793317),f=t(237934),h=t(42651);const u=function(a,r,i){this.init(a,r,i)};u.NAME="action.AddArpeggio",u.isNoChange=function(a){return a instanceof g.default};const l=u.prototype;l.initMeasureData=m.default,l.name=u.NAME,l.init=function(a,r,i){(0,v.default)(a,r),(0,P.default)(a,r),(0,U.default)(a,r),this.initMeasureData(a,r),this.cancelStack=i,this.opts=r,(0,A.default)(this.measureData,this.opts),this.location=null},l.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkUsage()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},l.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},l.checkUsage=function(){const a=this.measureData.getVoice(this.opts.voiceIdx);if(!a.isChord(this.opts.noteIdx))throw new O.A;const r=a.getNote(this.opts.noteIdx);if(I.default.hasArpeggiate(r)){const i="There is already an arpeggio at this location.";throw new g.default(i)}},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),typeof this.opts.record=="undefined"&&(this.opts.record=!0),this.storeAction(),this.addArpeggio(),this.updateStack()},l.addArpeggio=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new f.A(this.measureData,a,this.cancelStack).perform()},l.updateStack=function(){const a=this.getLocation(),r={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.push(r)},l.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,divisions:a.dpq,timePos:a.timePos}};this.cancelStack.storeAction(r)}},l.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),r=a.getPartUuid(this.opts.partIdx),i=a.getMeasureUuid(this.opts.measureIdx),o=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),s=this.measureData.getDpqValue(),n=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:r,measureUuid:i,voiceUuid:o,dpq:s,timePos:n}}return this.location},l.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,h.default)(u);const d=u},937955:(N,M,t)=>{t.r(M),t.d(M,{default:()=>s});var g=t(153271),O=t(857552),T=t(883782),I=t(195446),A=t(7451),v=t(377180),P=t(857579),U=t(554097),m=t(583443),f=t(52275),h=t(407819),u=t(640021),l=t(793317),d=t(954939),a=t(628827),r=t(42651);const i=function(e,n,c){this.init(e,n,c)};i.NAME="action.TransposeVoice";const o=i.prototype;o.name=i.NAME,o.init=function(e,n,c){(0,f.default)(e,n),(0,h.default)(e,n),(0,u.default)(e,n),this.scoreData=e,this.cancelStack=c,this.opts=n,this.location=null,this.sanitized=!1},o.checkPreconditions=function(){this.checkLocation(),this.sanitizedIfNeeded(),this.checkPitchedPart(),this.checkNotTab(),v.default.check(this.opts.transpose),this.checkPitchOverflow()},o.checkLocation=function(){const n=this.getMeasures().length,c=this.opts.startMeasureIdx;let _=c;if(_<0||_>=n)throw new g.default(_,g.default.GET);const E=this.opts.stopMeasureIdx;if(E<c)throw new O.default(O.default.MEASURE,c,E);if(_=this.opts.stopMeasureIdx,_<0||_>=n)throw new g.default(_,g.default.GET);if(!this.scoreData.hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new T.default(this.opts.voiceIdx,T.default.GET)},o.sanitizedIfNeeded=function(){this.sanitized||(typeof this.opts.checkNotTab=="undefined"&&(this.opts.checkNotTab=!0),typeof this.opts.allowDoubleAccidentals=="undefined"&&(this.opts.allowDoubleAccidentals=!1),this.sanitized=!0)},o.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new I.default},o.checkNotTab=function(){if(this.opts.checkNotTab&&this.scoreData.isPartTab(this.opts.partIdx))throw new A.A},o.checkPitchOverflow=function(){this.getMeasuresRange().forEach(function(n){const c=new P.A(n);if(c.hasVoice(this.opts.voiceIdx)){const _=c.getVoice(this.opts.voiceIdx);(0,U.A)(_,this.opts.transpose,this.opts.allowDoubleAccidentals);const E=c.getClefs();(0,m.A)(_,this.opts.transpose,E,this.opts.allowDoubleAccidentals)}},this)},o.getMeasuresRange=function(){const e=this.opts.startMeasureIdx,n=this.opts.stopMeasureIdx+1;return this.getMeasures().slice(e,n)},o.getMeasures=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.isIdentity()||(this.transpose(),this.isUnison()||this.updateMeasuresRangeAccidentals(),this.updateStack())},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),n=e.measureUuids.slice(),c=v.default.copy(this.opts.transpose),_={actionName:this.name,opts:{partUuid:e.partUuid,measureUuids:n,voiceIdx:this.opts.voiceIdx,transpose:c,allowDoubleAccidentals:this.opts.allowDoubleAccidentals}};this.cancelStack.storeAction(_)}},o.isIdentity=function(){return v.default.isIdentity(this.opts.transpose)},o.transpose=function(){const e={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,firstMeasureIdx:this.opts.startMeasureIdx,lastMeasureIdx:this.opts.stopMeasureIdx,transpose:v.default.copy(this.opts.transpose),allowDoubleAccidentals:this.opts.allowDoubleAccidentals};new d.A(this.scoreData,e,this.cancelStack).perform()},o.isUnison=function(){return v.default.isUnison(this.opts.transpose)},o.updateMeasuresRangeAccidentals=function(){const e=this.opts.startMeasureIdx,n=this.opts.stopMeasureIdx;for(let c=e;c<=n;c++)this.updateMeasureAccidentals(c)},o.updateMeasureAccidentals=function(e){const n={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:e},c={};l.default.call(c,this.scoreData,n);const _=c.measureData;_.hasVoice(n.voiceIdx)&&new a.A(_,n,this.cancelStack).perform()},o.updateStack=function(){const e=this.getLocation(),n=e.measureUuids.slice(),c=v.default.copy(this.opts.transpose),_={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuids:n,voiceIdx:this.opts.voiceIdx,transpose:c,allowDoubleAccidentals:this.opts.allowDoubleAccidentals}};this.cancelStack.push(_)},o.getLocation=function(){if(this.location===null){const e=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),n=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:n,measureUuids:e}}return this.location},(0,r.default)(i);const s=i},946330:(N,M,t)=>{t.r(M),t.d(M,{default:()=>n});var g=t(278243),O=t(247739),T=t(99923),I=t(807205),A=t(123491),v=t(292681),P=t(742735),U=t(691309),m=t(898039),f=t(325600),h=t(52275),u=t(704621),l=t(981801),d=t(852363),a=t(793317),r=t(831250),i=t(803192),o=t(42651);const s=function(c,_,E){this.init(c,_,E)};s.NAME="action.AddTieArcPercu";const e=s.prototype;e.name=s.NAME,e.initMeasureData=a.default,e.lineToDestUnpitched=r.A,e.init=function(c,_,E){(0,h.default)(c,_),(0,u.default)(c,_),(0,l.default)(c,_),this.initMeasureData(c,_),this.cancelStack=E,this.opts=_,(0,m.default)(this.measureData,_),this.crossMeasure=new U.default(this.measureData,_.voiceIdx,_.noteIdx),this.location=null},e.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.lineToDestUnpitched(),this.checkUnpitched()},e.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new T.A},e.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},e.isLeftRest=function(){return this.crossMeasure.isLeftRest()},e.isRightRest=function(){return this.crossMeasure.isRightRest()},e.checkUnpitched=function(){if(this.crossMeasure.hasRightGrace())throw new I.A(this.name,"right not cannot have graces notes attached.");const c=this.getLeftChord(),_=this.getRightChord(),E=(0,i.A)(this.measureData,this.opts),x=c.find(this.unpitchedPredicate,this);if(typeof x=="undefined")throw new O.A(O.A.GET,this.opts,E);const p=_.find(this.unpitchedPredicate,this);if(typeof p=="undefined")throw new O.A(O.A.GET,this.opts,E);const D=A.default.getUnpitched(x),C=A.default.getUnpitched(p);if(!v.default.isSame(D,C))throw new I.A(this.name,"notes must have the same pitch");const B=A.default.getHead(x),R=A.default.getHead(p);if(B!==R)throw new I.A(this.name,"notes must have the same head");if(P.A.areNotesTied(x,p))throw new I.A(this.name,"notes are already tied")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getLeftChord(),_=this.getRightChord(),E=c.find(this.unpitchedPredicate,this),x=_.find(this.unpitchedPredicate,this),p=v.default.copy(A.default.getUnpitched(E));P.A.tieNotes(E,x),this.updateStack(p)},e.unpitchedPredicate=function(c){const _=A.default.getUnpitched(c);return v.default.isSameLine(_,this.opts)},e.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),_={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,divisions:c.dpq,timePos:c.timePos,voiceUuid:c.voiceUuid,"display-octave":this.opts["display-octave"],"display-step":this.opts["display-step"]}};this.cancelStack.storeAction(_)}},e.getLeftChord=function(){return this.crossMeasure.getLeftChord()},e.getRightChord=function(){return this.crossMeasure.getRightChord()},e.updateStack=function(c){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const _=this.getLocation(),E={type:this.name,opts:{partUuid:_.partUuid,partIdx:this.opts.partIdx,measureUuid:_.measureUuid,measureIdx:this.opts.leftMeasureIdx,noteIdx:this.opts.leftNoteIdx,timePos:_.timePos,divisions:_.dpq,voiceUuid:_.voiceUuid,unpitched:v.default.copy(c)}};this.cancelStack.push(E),(0,d.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const x={type:`${this.name}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:v.default.copy(c)}};this.cancelStack.push(x),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,d.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},e.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),_=c.getPartUuid(this.opts.partIdx),E=this.crossMeasure.getLeftMeasureIdx(),x=c.getMeasureUuid(E),p=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),D=this.crossMeasure.getLeftMeasure().getDpqValue(),C=this.crossMeasure.getLeftVoice(),B=this.crossMeasure.getLeftNoteIdx(),R=(0,f.A)(C,B);this.location={partUuid:_,measureUuid:x,voiceUuid:p,dpq:D,timePos:R}}return this.location},(0,o.default)(s);const n=s},974106:(N,M,t)=>{t.r(M),t.d(M,{default:()=>r});var g=t(279140),O=t(31278),T=t(476943),I=t(123491),A=t(349386),v=t(972913),P=t(52275),U=t(704621),m=t(981801),f=t(898039),h=t(270912),u=t(793317),l=t(42651);const d=function(i,o,s){this.init(i,o,s)};d.NAME="action.ChangeDurationCrossMeasure",d.isNoChange=function(i){return i instanceof O.default};const a=d.prototype;a.initMeasureData=u.default,a.name=d.NAME,a.init=function(i,o,s){(0,P.default)(i,o),(0,U.default)(i,o),(0,m.default)(i,o),this.initMeasureData(i,o),this.cancelStack=s,this.opts=o,(0,f.default)(this.measureData,this.opts),this.location=null},a.checkPreconditions=function(){(0,v.default)(this.opts),this.checkLocation(),this.checkAvailableSpace(),this.checkNotLocked()},a.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},a.checkAvailableSpace=function(){let i=this.getRequiredDuration();const o=this.getActualDuration();if(!(o>i)){{if(o===i)throw new O.default;i-=o}if(this.isTuplet()){const s=this.getAvailableSpace();s<i&&this.raiseNotEnoughSpace(i,s)}}},a.checkNotLocked=function(){let o=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);o=T.default.makeArray(o),o.forEach(I.default.checkNotLocked)},a.getRequiredDuration=function(){const i=this.measureData.getDpqValue(),o=this.getTimeModif();return(0,A.default)(this.opts,i,o)},a.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},a.getActualDuration=function(){const o=this.getVoice().getNote(this.opts.noteIdx);return I.default.getDuration(o)},a.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},a.isRest=function(){return this.getVoice().isRest(this.opts.noteIdx)},a.getAvailableSpace=function(){const i=this.getVoiceOrTupletForGet(),o=this.opts.noteIdx+1;return i.getSpaceFromIdx(o)},a.raiseNotEnoughSpace=function(i,o){const s=this.getVoiceOrTupletForGet(),e=this.measureData.getDpqValue(),n=s.getAbsoluteTimeModif();throw new g.default(i,o,e,n)},a.getVoiceOrTupletForGet=function(){const i=this.opts.voiceIdx,o=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(i,o)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.changeDuration()},a.changeDuration=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,durationType:this.opts.durationType,nbDots:this.opts.nbDots,forceShowVoice:this.opts.forceShowVoice};new h.A(this.measureData,i,this.cancelStack).perform()},a.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),o={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,timePos:i.timePos,divisions:i.dpq,voiceUuid:i.voiceUuid,insertMode:this.opts.insertMode,durationType:this.opts.durationType,forceShowVoice:!!this.opts.forceShowVoice,nbDots:this.opts.nbDots}};this.cancelStack.storeAction(o)}},a.getLocation=function(){if(this.location===null){const i=this.measureData.getScoreData(),o=i.getPartUuid(this.opts.partIdx),s=i.getMeasureUuid(this.opts.measureIdx),e=i.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),_=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:s,voiceUuid:e,dpq:n,timePos:_}}return this.location},(0,l.default)(d);const r=d},974116:(N,M,t)=>{t.r(M),t.d(M,{default:()=>o});var g=t(292681),O=t(259563),T=t(2835),I=t(33674),A=t(404747),v=t(52275),P=t(704621),U=t(981801),m=t(783177),f=t(898039),h=t(831121),u=t(655035),l=t(826557),d=t(793317),a=t(42651);const r=function(s,e,n){this.init(s,e,n)};r.NAME="action.InsertGraceNotePercu";const i=r.prototype;i.name=r.NAME,i.initMeasureData=d.default,i.init=function(s,e,n){(0,v.default)(s,e),(0,P.default)(s,e),(0,U.default)(s,e),(0,m.default)(s,e),this.initMeasureData(s,e),this.cancelStack=n,this.opts=e,(0,f.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null},i.checkPreconditions=function(){this.checkValues(),this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceInsertionIdx(),this.sanitizeIfNeeded(),this.checkInstrument()},i.checkValues=function(){O.default.check(this.opts.durationType)},i.checkUnpitchedPart=function(){(0,h.default)(this.measureData)},i.checkCompatibleVoiceStaffIdx=function(){(0,I.default)(this.measureData,this.opts)},i.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},i.checkGraceInsertionIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkGraceInsertionIdx(this.opts.noteIdx,this.opts.graceIdx)},i.checkInstrument=function(){(0,A.A)(this.measureData,this.opts)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.fillHeadIfMissing(),this.storeAction(),this.insertGraceNote(),this.updateStack()},i.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,T.default)(this.measureData,this.opts),this.sanitized=!0)},i.fillHeadIfMissing=function(){typeof this.opts.notehead=="undefined"&&(this.opts.notehead=(0,u.default)(this.measureData,this.opts.partIdx,this.opts.unpitched))},i.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,staffUuid:s.staffUuid,graceIdx:this.opts.graceIdx,timePos:s.timePos,divisions:s.dpq,durationType:this.opts.durationType,unpitched:g.default.copy(this.opts.unpitched),notehead:this.opts.notehead}};this.cancelStack.storeAction(e)}},i.insertGraceNote=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType,unpitched:g.default.copy(this.opts.unpitched),notehead:this.opts.notehead};new l.A(this.measureData,s,this.cancelStack).perform()},i.updateStack=function(){const s=this.getLocation(),e={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,graceIdx:this.opts.graceIdx,timePos:s.timePos,divisions:s.dpq}};this.cancelStack.push(e)},i.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),e=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),c=s.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),_=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),E=this.measureData.getDpqValue(),p=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:n,staffUuid:c,voiceUuid:_,dpq:E,timePos:p}}return this.location},(0,a.default)(r);const o=r},988878:(N,M,t)=>{t.r(M),t.d(M,{default:()=>i});var g=t(52275),O=t(104907),T=t(701387),I=t(726042),A=t(446921),v=t(794741),P=t(575502),U=t(195446),m=t(443749),f=t(912858),h=t(31278),u=t(339455),l=t(42651),d=t(819795);const a=function(o,s,e){this.init(o,s,e)};a.NAME="action.SetStaffDetails";const r=a.prototype;r.name=a.NAME,r.init=function(o,s,e){(0,g.default)(o,s),this.scoreData=o,this.cancelStack=e,this.opts=s,this.location=null,this.previousStaffDetails=null,this.sanitized=!1},r.checkPreconditions=function(){this.checkStaffDetails(),this.opts.preserveFrets&&(this.checkPreserveFrets(),this.opts.updateFrets=!1),this.checkPitchedPart(),this.checkLocation(),this.checkNoTuningChange(),this.checkRecorderTabs(),this.checkBrassFingering(),this.sanitizeIfNeeded(),this.checkNoChange()},r.checkStaffDetails=function(){O.default.check(this.opts.staffDetails)},r.checkPreserveFrets=function(){if(!O.default.hasStaffTuning(this.opts.staffDetails))throw new f.A;const o=this.getPreviousStaffDetails();if(!O.default.hasSameStaffTuning(o,this.opts.staffDetails))throw new f.A},r.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new U.default},r.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx);const o=this.getFirstMeasure(),s=T.default.getNbStaves(o),e=this.opts.staffIdx;if(!I.default.isInteger(e)||e<0||e>=s)throw new m.default(e,m.default.GET)},r.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.updateFrets=="undefined"&&(this.opts.updateFrets=!0),this.sanitized=!0)},r.checkNoChange=function(){if(this.opts.updateFrets)return;const o=this.getPreviousStaffDetails();if(O.default.isSame(o,this.opts.staffDetails))throw new h.default},r.checkNoTuningChange=function(){if(typeof this.opts.updateFrets!="undefined")return;const o=this.getPreviousStaffDetails();O.default.isSameTuningData(o,this.opts.staffDetails)&&(this.opts.updateFrets=!1)},r.checkBrassFingering=function(){if(typeof this.opts.staffDetails["$adagio-brassFingerings"]=="undefined")return;const o=O.default.getBrassFingering(this.opts.staffDetails);P.A.check(o)},r.checkRecorderTabs=function(){if(typeof this.opts.staffDetails["$adagio-recorderTabs"]=="undefined")return;const o=O.default.getRecorderTabs(this.opts.staffDetails);v.A.check(o)},r.getFirstMeasure=function(){const o=this.scoreData.getPartContent(this.opts.partIdx);return A.A.getFirstMeasure(o)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const o=this.getPreviousStaffDetails();this.storeAction();const s={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:O.default.copy(this.opts.staffDetails),updateFrets:this.opts.updateFrets,preserveFrets:this.opts.preserveFrets};new u.A(this.scoreData,s,this.cancelStack).perform(),this.updateStack(o)},r.getPreviousStaffDetails=function(){if(this.previousStaffDetails===null){const o=this.getFirstMeasure(),s=T.default.getWrappedStaffDetailsOrDefault(o);this.previousStaffDetails=O.default.copy(s.getEntry(this.opts.staffIdx)),d.A.removeStaffIdx(this.previousStaffDetails)}return this.previousStaffDetails},r.updateStack=function(o){const s=this.getLocation(),e=O.default.copy(o),n={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,staffIdx:this.opts.staffIdx,staffDetails:e,updateFrets:!1}};this.cancelStack.push(n),this.cancelStack.stateNeedCompleteRedraw()},r.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),s=O.default.copy(this.opts.staffDetails),e={actionName:this.name,opts:{partUuid:o.partUuid,staffIdx:this.opts.staffIdx,staffDetails:s,updateFrets:this.opts.updateFrets,preserveFrets:!!this.opts.preserveFrets}};this.cancelStack.storeAction(e)}},r.getLocation=function(){if(this.location===null){const o=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:o}}return this.location},(0,l.default)(a);const i=a},991868:(N,M,t)=>{t.r(M),t.d(M,{default:()=>f});var g=t(59153),O=t(793317),T=t(52275),I=t(704621),A=t(443749),v=t(726042),P=t(42651);const U=function(h,u,l){this.init(h,u,l)};U.NAME="action.ClearStaffVoices";const m=U.prototype;m.name=U.NAME,m.initMeasureData=O.default,m.init=function(h,u,l){(0,T.default)(h,u),(0,I.default)(h,u),this.initMeasureData(h,u),this.cancelStack=l,this.opts=u},m.checkPreconditions=function(){const h=this.measureData.getNbStaves(),u=this.opts.staffIdx;if(!v.default.isInteger(u)||u<0||u>=h)throw new A.default(u)},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),typeof this.opts.removeFloating=="undefined"&&(this.opts.removeFloating=!0),this.storeAction();let u=this.measureData.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx);u=u.filter(this.measureData.hasVoice,this.measureData),u.forEach(this.clearVoice,this)},m.clearVoice=function(h){const u={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:h,removeFloating:this.opts.removeFloating};new g.default(this.measureData,u,this.cancelStack).perform()},m.storeAction=function(){if(!this.cancelStack.hasAction()){const h=this.measureData.getScoreData(),u={actionName:this.name,opts:{partUuid:h.getPartUuid(this.opts.partIdx),measureUuid:h.getMeasureUuid(this.opts.measureIdx),staffIdx:this.opts.staffIdx,removeFloating:this.opts.removeFloating}};this.cancelStack.storeAction(u)}},(0,P.default)(U);const f=U}}]);})();


//# debugId=24cbb888-840c-5437-acac-4045aff68290
