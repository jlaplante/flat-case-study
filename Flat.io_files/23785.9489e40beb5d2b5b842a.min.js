
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="e954bb57-fb04-5d99-906e-fdee8af5a48d")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[23785],{12741:(b,S,s)=>{"use strict";s.d(S,{A:()=>G});var t=s(361744),c=s(538065),C=s(557854),g=s(649331),p=s(432367);const B={key:0},N=(0,t.pM)({__name:"PartName",props:{part:{},displayOriginalName:{type:Boolean,default:!1},displayHqBadge:{type:Boolean,default:!0}},setup(Z){const F=Z,st=(0,t.EW)(()=>{var L;const R="group-keyboards";return p.A[((L=F.part.metas)==null?void 0:L.iconGroupKey)||R]||p.A[R]}),z=(0,t.EW)(()=>{var L,R;const W=F.part,A=(L=W.name)==null?void 0:L.trim();if(A&&A.length>0)return A;const J=(R=W.abbreviation)==null?void 0:R.trim();if(J&&J.length>0)return J;let et=(0,g.Bd)().t("flat:score.parts.unknown-name");return W.idx!==void 0&&(et+=` ${W.idx+1}`),et}),_=(0,t.EW)(()=>{var L;return((L=F.part.metas)==null?void 0:L.title)||F.part.name}),M=(0,t.EW)(()=>F.displayOriginalName&&_.value!==z.value);return(L,R)=>{var W;const A=(0,t.gN)("dompurify-html");return(0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)(L.$style.partName)},[st.value?(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",{key:0,class:(0,c.C4)(L.$style.icon)},null,2)),[[A,st.value,"svg"]]):(0,t.Q3)("",!0),L.displayHqBadge&&((W=L.part.metas)!=null&&W.hq)?((0,t.uX)(),(0,t.Wv)(C.A,{key:1})):(0,t.Q3)("",!0),(0,t.Lk)("div",{class:(0,c.C4)(L.$style.text)},[(0,t.Lk)("span",null,(0,c.v_)(z.value),1),M.value?((0,t.uX)(),(0,t.CE)("span",B,"\xA0("+(0,c.v_)(_.value)+")",1)):(0,t.Q3)("",!0)],2)],2)}}});var tt=s(98238),j=s.n(tt),lt=s(938793);const x={};x.$style=j();const G=(0,lt.A)(N,[["__cssModules",x]])},69587:(b,S,s)=>{"use strict";s.d(S,{S:()=>t});const t=120},75848:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`input[type=range]{appearance:none;-webkit-appearance:none;width:100%;height:23px;background:transparent;overflow:none}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none}input[type=range]:focus{outline:none}input[type=range]::-ms-track{width:100%;cursor:pointer;background:transparent;border-color:transparent;color:transparent}input[type=range]::-webkit-slider-thumb{background:var(--color-neutral-0);box-shadow:0 0 #0000,0 0 0 1px #363c5014,0 1px 8px #363c5024;width:12px;height:12px;top:-5px;border:none;border-radius:50%;cursor:pointer;position:relative;transition:all .2s ease-in-out}input[type=range]::-moz-range-thumb{background:var(--color-neutral-0);box-shadow:0 0 #0000,0 0 0 1px #363c5014,0 1px 8px #363c5024;width:12px;height:12px;top:-5px;border:none;border-radius:50%;cursor:pointer;position:relative;transition:all .2s ease-in-out}input[type=range]::-ms-thumb{background:var(--color-neutral-0);box-shadow:0 0 #0000,0 0 0 1px #363c5014,0 1px 8px #363c5024;width:12px;height:12px;top:-5px;border:none;border-radius:50%;cursor:pointer;position:relative;transition:all .2s ease-in-out}input[type=range]::not(:disabled):hover::-webkit-slider-thumb{box-shadow:0 0 0 8px #e5dee60d,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]::not(:disabled):hover::-moz-range-thumb{box-shadow:0 0 0 8px #e5dee60d,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]::not(:disabled):hover::-ms-thumb{box-shadow:0 0 0 8px #e5dee60d,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]::not(:disabled):focus::-webkit-slider-thumb{box-shadow:0 0 0 8px #e5dee61a,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]::not(:disabled):focus::-moz-range-thumb{box-shadow:0 0 0 8px #e5dee61a,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]::not(:disabled):focus::-ms-thumb{box-shadow:0 0 0 8px #e5dee61a,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]:active::-webkit-slider-thumb{box-shadow:0 0 0 8px #e5dee626,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]:active::-moz-range-thumb{box-shadow:0 0 0 8px #e5dee626,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]:active::-ms-thumb{box-shadow:0 0 0 8px #e5dee626,0 0 0 1px #363c5014,0 1px 8px #363c5024}input[type=range]:disabled{cursor:not-allowed}input[type=range]:disabled::-webkit-slider-thumb{cursor:not-allowed;background:var(--f-grey-disabled-content, #b7b7b7);filter:drop-shadow(0px 1px 8px rgba(54,60,80,.14)) drop-shadow(0px 0px 0px rgba(54,60,80,.08))}input[type=range]:disabled::-moz-range-thumb{cursor:not-allowed;background:var(--f-grey-disabled-content, #b7b7b7);filter:drop-shadow(0px 1px 8px rgba(54,60,80,.14)) drop-shadow(0px 0px 0px rgba(54,60,80,.08))}input[type=range]:disabled::-ms-thumb{cursor:not-allowed;background:var(--f-grey-disabled-content, #b7b7b7);filter:drop-shadow(0px 1px 8px rgba(54,60,80,.14)) drop-shadow(0px 0px 0px rgba(54,60,80,.08))}input[type=range]::-webkit-slider-runnable-track{width:100%;height:3px;cursor:pointer;animate:.2s;background:var(--f-ink-20, #D5D6DA);border-radius:5px}input[type=range]::-moz-range-track{width:100%;height:3px;cursor:pointer;animate:.2s;background:var(--f-ink-20, #D5D6DA);border-radius:5px}input[type=range]::-ms-track{width:100%;height:3px;cursor:pointer;animate:.2s;background:var(--f-ink-20, #D5D6DA);border-radius:5px}input[type=range]::-moz-range-progress{background-color:var(--surface-buttons-brand-primary)}input[type=range]::-ms-fill-lower{background:var(--surface-buttons-brand-primary)}input[type=range].active::-webkit-slider-runnable-track{background:var(--surface-buttons-brand-primary)}
`,""]);const B=p},98238:(b,S,s)=>{var t=s(232579);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("4428017d",t,!0,{})},131003:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function C(tt,j){return(0,t.uX)(),(0,t.CE)("svg",c,j[0]||(j[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.3968 4C14.6678 4 14.9448 4.212 15.0168 4.482L16.0958 8.529L17.9998 6.185C18.1738 5.97 18.4888 5.938 18.7038 6.112C18.9178 6.286 18.9508 6.601 18.7758 6.815L16.4138 9.723L18.7598 18.518C18.8308 18.784 18.6678 19 18.3898 19H16.8878V19.5C16.8878 19.776 16.6738 20 16.3838 20H15.3928C15.1138 20 14.8878 19.768 14.8878 19.5V19H8.8878V19.5C8.8878 19.776 8.67381 20 8.38381 20H7.39281C7.11381 20 6.88781 19.768 6.88781 19.5V19H5.38681C5.11081 19 4.94481 18.788 5.01681 18.518L8.75981 4.482C8.83081 4.216 9.11582 4 9.37882 4H14.3968ZM16.7868 15H6.98981L6.18981 18H17.5868L16.7868 15ZM13.3976 16C13.6686 16 13.8876 16.232 13.8876 16.5C13.8876 16.776 13.6726 17 13.3976 17H10.3786C10.1076 17 9.8876 16.768 9.8876 16.5C9.8876 16.224 10.1036 16 10.3786 16H13.3976ZM15.6348 10.682L12.9388 14H16.5198L15.6348 10.682ZM14.1198 5H9.65682L7.25681 14H11.6498L15.3168 9.488L14.1198 5ZM12.3833 10C12.6623 10 12.8883 10.232 12.8883 10.5C12.8883 10.776 12.6743 11 12.3833 11H11.3923C11.1143 11 10.8883 10.768 10.8883 10.5C10.8883 10.224 11.1023 10 11.3923 10H12.3833ZM12.3837 8C12.6617 8 12.8877 8.232 12.8877 8.5C12.8877 8.776 12.6737 9 12.3837 9H11.3927C11.1137 9 10.8877 8.768 10.8877 8.5C10.8877 8.224 11.1017 8 11.3927 8H12.3837ZM12.3837 6C12.6617 6 12.8877 6.232 12.8877 6.5C12.8877 6.776 12.6737 7 12.3837 7H11.3927C11.1137 7 10.8877 6.768 10.8877 6.5C10.8877 6.224 11.1017 6 11.3927 6H12.3837Z"},null,-1)]))}var g=s(938793);const p={},N=(0,g.A)(p,[["render",C]])},135519:(b,S,s)=>{"use strict";s.d(S,{d:()=>x});var t=s(645369),c=s.n(t),C=s(6645),g=s(744056),p=s(361744),B=s(26292),N=s(27219),tt=s(727137);const j=c()("flat:kb"),lt=q=>JSON.parse(JSON.stringify(q)),x=(0,C.nY)("keyboard",()=>{const q=(0,g.KR)([]),G=(0,g.KR)(!1),Z=(0,g.KR)("pitched"),F=(0,p.EW)(()=>{const W={};return q.value.forEach(A=>{W[A.action]=W[A.action]||[],W[A.action].push(lt(A))}),W}),st=(0,p.EW)(()=>{const W={},A=F.value;return Object.keys(A).forEach(J=>{W[J]=(0,B.WN)(A[J])}),W}),z=(0,p.EW)(()=>{const W={},A=[...q.value],J=N.actions;return N.displayableGroups.forEach(U=>{for(let et=A.length-1;et>=0;et--){const $=A[et],r=J[$.action];if(!r||!r.groups||!r.groups.includes(U)||r.groups.includes("noKbUi")||Z.value==="tab"&&($.mode==="regular"||$.staff==="unpitched")||Z.value==="pitched"&&($.mode==="tab"||$.staff==="unpitched")||Z.value==="unpitched"&&($.mode||$.staff==="pitched")||$.uuid&&$.action==="addUnpitchedNote")continue;W[U]||(W[U]=[]);let a=W[U].find(f=>f.action===$.action);a||(a={action:$.action,shortcuts:[]},W[U].unshift(a)),a.shortcuts.push($),A.splice(et,1)}}),A.length>0&&j("remaining shortcuts not displayed: %o",A.map(U=>U.action)),W});function _(W){Z.value=W}function M(){const W=(0,tt.x)();W.isTab?_("tab"):W.isPitchedPart?_("pitched"):W.isUnpitchedPart&&_("unpitched")}function L(W){G.value=W}function R(W){q.value=lt(W)}return{displayFilter:Z,backspacePressed:G,shortcutsByAction:F,shortcutsByDisplayableGroup:z,mainShortcutByAction:st,setDisplayFilterFromCursorContext:M,setBackspacePressed:L,setShortcuts:R,setDisplayFilter:_}})},154982:(b,S,s)=>{"use strict";s.d(S,{A:()=>Kt});var t=s(361744),c=s(538065),C=s(744056),g=s(555381),p=s(591340),B=s(909696),N=s(885147),tt=s(57500),j=s(544582),lt=(wt,gt,dt)=>new Promise((Dt,At)=>{var Lt=yt=>{try{mt(dt.next(yt))}catch(bt){At(bt)}},pt=yt=>{try{mt(dt.throw(yt))}catch(bt){At(bt)}},mt=yt=>yt.done?Dt(yt.value):Promise.resolve(yt.value).then(Lt,pt);mt((dt=dt.apply(wt,gt)).next())});const x=["aria-label"],q=["aria-label"],G=(0,t.pM)({__name:"VolumeMaster",props:{scoreData:{}},setup(wt){const gt=wt,dt=(0,C.KR)(0);function Dt(){return lt(this,null,function*(){yield gt.scoreData.scoreActions.executePublicAction("setMasterVolume",{volume:dt.value}),At()})}function At(){return lt(this,null,function*(){dt.value=yield gt.scoreData.scoreActions.executePrivateAction("getMasterVolume")})}return At(),(Lt,pt)=>((0,t.uX)(),(0,t.CE)("div",{"aria-label":Lt.$t("editor:masterVolume.adjust"),role:"region",class:(0,c.C4)(Lt.$style.master)},[(0,t.Lk)("span",{class:(0,c.C4)(Lt.$style.name)},(0,c.v_)(Lt.$t("editor:masterVolume.title")),3),(0,t.bo)((0,t.Lk)("input",{"aria-label":Lt.$t("editor:masterVolume.adjust"),class:(0,c.C4)({active:dt.value>0}),type:"range",min:"0",max:"100",step:"1",onChange:pt[0]||(pt[0]=(0,g.D$)(mt=>Dt(),["stop"])),onClick:pt[1]||(pt[1]=(0,g.D$)(()=>{},["stop"])),"onUpdate:modelValue":pt[2]||(pt[2]=mt=>dt.value=mt)},null,42,q),[[g.Jo,dt.value,void 0,{number:!0}]])],10,x))}});var Z=s(384984),F=s.n(Z),st=s(938793);const z={};z.$style=F();const M=(0,st.A)(G,[["__cssModules",z]]);var L=s(12741),R=s(502762);const W={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"25",viewBox:"0 0 24 25",fill:"currentColor"};function A(wt,gt){return(0,t.uX)(),(0,t.CE)("svg",W,gt[0]||(gt[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19 16.3843C19 16.9396 18.552 17.3939 18 17.3939H17.396C17.768 16.7478 18 15.8593 18 14.8699C18 13.8805 17.768 12.9819 17.396 12.3459H18C18.552 12.3459 19 12.8002 19 13.3555V16.3843ZM16 17.3939C15.448 17.3939 15 16.2632 15 14.8699C15 13.4766 15.448 12.3459 16 12.3459C16.552 12.3459 17 13.4766 17 14.8699C17 16.2632 16.552 17.3939 16 17.3939ZM6.604 12.3459C6.232 12.9819 6 13.8805 6 14.8699C6 15.8593 6.232 16.7478 6.604 17.3939H6C5.448 17.3939 5 16.9396 5 16.3843V13.3555C5 12.8002 5.448 12.3459 6 12.3459H6.604ZM8 12.3459C8.552 12.3459 9 13.4766 9 14.8699C9 16.2632 8.552 17.3939 8 17.3939C7.448 17.3939 7 16.2632 7 14.8699C7 13.4766 7.448 12.3459 8 12.3459ZM18.985 11.6089C18.988 11.518 19 11.4271 19 11.3363C19 7.42911 15.866 4.26904 12 4.26904C8.134 4.26904 5 7.42911 5 11.3363C5 11.4271 5.012 11.518 5.015 11.6089C4.70709 11.7824 4.45067 12.0358 4.27223 12.3428C4.09379 12.6499 3.99981 12.9995 4 13.3555V16.3843C4 17.4949 4.895 18.4035 6 18.4035H7C7.196 18.4035 7.383 18.3631 7.562 18.3127C7.704 18.3631 7.849 18.4035 8 18.4035C9.104 18.4035 10 16.8184 10 14.8699C10 12.9214 9.104 11.3363 8 11.3363C7.85 11.3363 7.704 11.3666 7.562 11.4271C7.37965 11.3711 7.19056 11.3406 7 11.3363H6C6 7.99449 8.686 5.27865 12 5.27865C15.313 5.27865 18 7.99449 18 11.3363H17C16.804 11.3363 16.617 11.3767 16.438 11.4271C16.2996 11.3672 16.1506 11.3363 16 11.3363C14.895 11.3363 14 12.9214 14 14.8699C14 16.8184 14.895 18.4035 16 18.4035C16.15 18.4035 16.296 18.3631 16.438 18.3127C16.618 18.3631 16.804 18.4035 17 18.4035V20.4227H18V18.4035C19.104 18.4035 20 17.4949 20 16.3843V13.3555C20 12.5983 19.588 11.9521 18.985 11.6089Z"},null,-1)]))}const J={},et=(0,st.A)(J,[["render",A]]),$={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"25",viewBox:"0 0 24 25",fill:"currentColor"};function r(wt,gt){return(0,t.uX)(),(0,t.CE)("svg",$,gt[0]||(gt[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8.26667 9.89824L11.4667 7.88441V17.5766L8.26667 15.552V9.89824ZM7.2 14.8843H5.6C5.3056 14.8843 5.06667 14.6474 5.06667 14.3459V11.1151C5.06667 10.8136 5.3056 10.5767 5.6 10.5767H7.2V14.8843ZM5.06667 9.49978C4.47787 9.49978 4 9.98439 4 10.5767V14.8843C4 15.4766 4.47787 15.9613 5.06667 15.9613H7.2L12.5333 19.192V6.26904L7.2 9.49978H5.06667Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.2071 9.82153L13.5 15.5835L12.7928 14.8696L18.5 9.10763L19.2071 9.82153Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.5 9.10763L19.2071 14.8696L18.5 15.5835L12.7928 9.82153L13.5 9.10763Z"},null,-1)]))}const a={},d=(0,st.A)(a,[["render",r]]);var v=(wt,gt,dt)=>new Promise((Dt,At)=>{var Lt=yt=>{try{mt(dt.next(yt))}catch(bt){At(bt)}},pt=yt=>{try{mt(dt.throw(yt))}catch(bt){At(bt)}},mt=yt=>yt.done?Dt(yt.value):Promise.resolve(yt.value).then(Lt,pt);mt((dt=dt.apply(wt,gt)).next())});const T=["disabled"],E=["disabled"],k=(0,t.pM)({__name:"VolumePartSettings",props:{scoreData:{},part:{}},setup(wt){const gt=wt,dt=(0,C.KR)(0),Dt=(0,C.KR)(0),At=(0,j.o)(),Lt=(0,t.EW)(()=>At.isPerformerMode),pt=(0,t.EW)(()=>gt.part.uuid),mt=(0,t.EW)(()=>At.partsById[pt.value]),yt=(0,t.EW)(()=>!!At.currentPartsPlaying[pt.value]);function bt(){dt.value=(mt.value.volume||0)*100,Dt.value=(mt.value.reverb||0)*100}function Vt(){const nt=gt.scoreData.scoreActions;mt.value.solo?nt.executePublicAction("unsetPartSoloMode",{partUuid:pt.value}):nt.executePublicAction("setPartSoloMode",{partUuid:pt.value})}function Xt(){const nt=gt.scoreData.scoreActions;mt.value.mute?nt.executePublicAction("unmutePart",{partUuid:pt.value}):nt.executePublicAction("mutePart",{partUuid:pt.value})}function Ft(){return v(this,null,function*(){yield gt.scoreData.scoreActions.executePublicAction("setPartVolume",{partUuid:pt.value,volume:dt.value,isLocalOnly:!0}),bt()})}function $t(){return v(this,null,function*(){yield gt.scoreData.scoreActions.executePublicAction("setPartReverb",{partUuid:pt.value,reverberation:Dt.value,isLocalOnly:!0}),bt()})}return bt(),(nt,ft)=>((0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)([nt.$style.partSettings,"no-select"])},[(0,t.Lk)("button",{class:(0,c.C4)({[nt.$style.solo]:!0,[nt.$style.active]:mt.value.solo}),"aria-label":"Switch solo for the part",disabled:Lt.value,onClick:ft[0]||(ft[0]=(0,g.D$)(Ut=>Vt(),["stop"]))},[(0,t.bF)(et)],10,T),(0,t.Lk)("button",{class:(0,c.C4)({[nt.$style.muted]:!0,[nt.$style.active]:mt.value.mute}),"aria-label":"Switch mute for the part",disabled:Lt.value,onClick:ft[1]||(ft[1]=(0,g.D$)(Ut=>Xt(),["stop"]))},[(0,t.bF)(d)],10,E),(0,t.Lk)("div",{class:(0,c.C4)(nt.$style.label)},(0,c.v_)(nt.$t("flat:score.playback.mix-panel.volume")),3),(0,t.Lk)("div",{class:(0,c.C4)(nt.$style.volume)},[(0,t.bo)((0,t.Lk)("input",{"aria-label":"Adjust volume for the part",class:(0,c.C4)({active:yt.value}),type:"range",min:"0",max:"100",step:"1",onChange:ft[2]||(ft[2]=(0,g.D$)(Ut=>Ft(),["stop"])),onClick:ft[3]||(ft[3]=(0,g.D$)(()=>{},["stop"])),"onUpdate:modelValue":ft[4]||(ft[4]=Ut=>dt.value=Ut)},null,34),[[g.Jo,dt.value,void 0,{number:!0}]])],2),(0,t.Lk)("div",{class:(0,c.C4)([nt.$style.label,nt.$style.reverbLabel])},(0,c.v_)(nt.$t("flat:score.playback.mix-panel.reverb")),3),(0,t.Lk)("div",{class:(0,c.C4)(nt.$style.reverb)},[(0,t.bo)((0,t.Lk)("input",{"aria-label":"Adjust reverb for the part",class:(0,c.C4)({active:Dt.value>0}),type:"range",min:"0",max:"100",step:"1",onChange:ft[5]||(ft[5]=(0,g.D$)(Ut=>$t(),["stop"])),onClick:ft[6]||(ft[6]=(0,g.D$)(()=>{},["stop"])),"onUpdate:modelValue":ft[7]||(ft[7]=Ut=>Dt.value=Ut)},null,34),[[g.Jo,Dt.value,void 0,{number:!0}]])],2)],2))}});var Y=s(906225),ct=s.n(Y);const it={};it.$style=ct();const Ot=(0,st.A)(k,[["__cssModules",it]]),It=["aria-label"],I=(0,t.pM)({__name:"VolumePart",props:{scoreData:{},part:{}},setup(wt){const gt=wt;return(dt,Dt)=>((0,t.uX)(),(0,t.CE)("div",{"aria-label":`Adjust volume for ${dt.part.name}`,role:"region"},[(0,t.bF)(L.A,{part:dt.part,class:(0,c.C4)(dt.$style.partName)},null,8,["part","class"]),(0,t.bF)(Ot,{"score-data":dt.scoreData,part:dt.part},null,8,["score-data","part"])],8,It))}});var h=s(823661),y=s.n(h);const D={};D.$style=y();const V=(0,st.A)(I,[["__cssModules",D]]),Q=["href"],at=(0,t.pM)({__name:"PlaybackVolume",props:{scoreData:{},audio:{}},setup(wt){const gt=wt,dt=(0,j.o)(),Dt=(0,tt.l)(),At=(0,p.U)(),Lt=(0,B.q6)(),pt=(0,t.EW)(()=>dt.partsById),mt=(0,t.EW)(()=>Lt.parts),yt=(0,t.EW)(()=>At.scoreWrite),bt=(0,t.EW)(()=>mt.value.filter(nt=>{var ft;return(ft=pt.value[nt.uuid])==null?void 0:ft.hash})),Vt=(0,t.EW)(()=>{var nt;return yt.value&&((nt=window.flatappname)==null?void 0:nt.includes("scoreditor"))}),Xt=(0,t.EW)(()=>`${Dt.helpUrl}/music-notation-software/audio-settings/#local-audio-settings`);function Ft(){gt.scoreData.scoreActions.executePublicAction("persistLocalPartsAudioSettings")}function $t(){gt.scoreData.scoreActions.executePublicAction("resetLocalPartsAudioSettings")}return(nt,ft)=>{const Ut=(0,t.g2)("f-button");return(0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)(nt.$style.PlaybackVolume)},[(0,t.Lk)("div",{class:(0,c.C4)(nt.$style.tracks)},[(0,t.bF)(M,{"score-data":nt.scoreData},null,8,["score-data"]),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(bt.value,kt=>((0,t.uX)(),(0,t.Wv)(V,{key:pt.value[kt.uuid].hash,"score-data":nt.scoreData,part:kt},null,8,["score-data","part"]))),128))],2),Vt.value&&(0,C.R1)(dt).displayQuickVolumeButtons?((0,t.uX)(),(0,t.CE)("div",{key:0,class:(0,c.C4)(nt.$style.footer)},[(0,t.Lk)("div",{class:(0,c.C4)(nt.$style.persistButtons)},[(0,t.bF)(Ut,{size:"small",class:(0,c.C4)(nt.$style.btnVolumeSave),onClick:ft[0]||(ft[0]=(0,g.D$)(kt=>Ft(),["stop"])),defaultText:"flat:volume.save-local-button"},null,8,["class"]),(0,t.bF)(Ut,{theme:"outline",size:"small",class:(0,c.C4)(nt.$style.btnVolumeReset),onClick:ft[1]||(ft[1]=(0,g.D$)(kt=>$t(),["stop"])),defaultText:"flat:volume.reset-local-button"},null,8,["class"])],2),(0,t.Lk)("a",{href:Xt.value,target:"_blank",rel:"noopener",class:(0,c.C4)(nt.$style.volumePersistHelp)},[(0,t.bF)((0,C.R1)(N.A)),(0,t.Lk)("span",null,(0,c.v_)(nt.$t("flat:score.playback.saveInfo")),1)],10,Q)],2)):(0,t.Q3)("",!0)],2)}}});var _t=s(680049),Pt=s.n(_t);const Ct={};Ct.$style=Pt();const Kt=(0,st.A)(at,[["__cssModules",Ct]])},175145:(b,S,s)=>{"use strict";s.d(S,{HY:()=>M,O7:()=>j,OH:()=>q,Or:()=>et,Th:()=>F,YH:()=>$,cG:()=>J,cU:()=>U,fM:()=>L,j:()=>A,lD:()=>f});var t=s(303953),c=s(645369),C=s.n(c);const g=C()("flat:pdf"),p=/\w+\s*\(.+?\)/g,B=/(\w+)\s*\((.+),?\)/i,N=/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,?[\s+]?(\d+)?[\s+]?/i,tt=["translate","rotate","scale"],j="M 1006 835 C 996 918 917 997 834 1007 C 619 1030 404 1030 189 1007 C 106 997 27 918 17 835 C -6 620 -6 405 17 190 C 27 107 106 28 189 18 C 404 -5 619 -5 834 18 C 917 28 996 107 1006 190 C 1029 405 1029 620 1006 835 ZM 210 511 C 203 511 197 513 191 517 C 175 527 171 548 182 564 L 367 833 C 377 849 399 853 414 842 C 429 831 433 810 423 795 L 238 525 C 231 516 221 511 210 511 ZM 258 439 L 529 833 C 539 849 560 853 576 842 C 591 831 595 810 584 795 L 314 400 C 307 391 297 386 286 386 C 279 386 273 387 267 391 C 251 402 247 423 258 439 ZM 305 177 C 298 177 291 179 285 183 C 270 194 266 215 277 230 L 690 833 C 701 849 722 853 737 842 C 753 831 757 810 746 795 L 332 192 C 326 182 315 177 305 177 ZM 494 192 C 488 182 477 177 466 177 C 460 177 453 179 447 183 C 432 194 428 215 439 230 L 709 625 C 720 640 741 644 756 634 C 772 623 776 602 765 586 L 494 192 ZM 841 461 L 656 192 C 650 182 639 177 628 177 C 622 177 615 179 609 183 C 594 193 590 215 600 230 L 785 500 C 796 515 817 519 832 508 C 848 498 852 477 841 461 Z",lt={white:"#fff"},x="transparent",q="Century Schoolbook L",G="Century Schoolbook L Italic",Z=t.A.fontsUrl||`${t.A.assetsurl}/fonts`,F={[q]:`${Z}/CenturySchL-Roma.ttf?v2`,[G]:`${Z}/CenturySchL-Ital.ttf?v2`,"Petaluma Script":`${Z}/PetalumaScript-1.10.ttf`,"Noto Serif":`${Z}/notoserif-933357819c8cce88b6f80348ce2387380adf7c84.ttf`,"Noto Serif Italic":`${Z}/notoserif-f84d9e5e94767e1000d2c9eac83dbe658121a600.ttf`,"Noto Serif Bold":`${Z}/notoserif-04eadd418eca06ead9adfbf746299d433f97f218.ttf`,"Noto Serif Bold Italic":`${Z}/notoserif-5337d7643bf43db93cf5ef4820e09f9f451abbcc.ttf`};function st(d){return d=d.match(N),!d||d.length<4?"":Number.parseInt(d[4],10)===0?x:`#${`0${Number.parseInt(d[1],10).toString(16)}`.slice(-2)}${`0${Number.parseInt(d[2],10).toString(16)}`.slice(-2)}${`0${Number.parseInt(d[3],10).toString(16)}`.slice(-2)}`}function z(d){const v=lt[d];return v||(d[0]==="#"?d:st(d))}function _(d){const v={};return Array.from(d.attributes).forEach(T=>{v[T.name]=T.value.split("px")[0]}),v}function M(d,v){var T;const E=_(v),k={};return(T=E.width)!=null&&T.length&&E.height&&E.height.length&&(k.size=[Number(E.width),Number(E.height)]),d.addPage(k),d}function L(d){const v=[],T=d.getAttribute("d");if(!T||!T.length)return v;let E=d.style.fill;E==="none"?E=x:E!=null&&E.length?E=z(E):E="black";let k=d.style.stroke;if(k?k=z(k):k=null,k===null&&E===x)return v;const Y=d.style["stroke-width"];Y&&v.push(["lineWidth",[Y]]),v.push(["path",[T]]);let ct;const it=[];return E!==x&&k===null?(ct="fill",it.push(E||"black")):k!==null&&E===x?(ct="stroke",it.push(k||"black"),v.push(["stroke",[k||"black"]])):(ct="fillAndStroke",it.push(E||"black"),it.push(k||"black")),d.getAttribute("fill-rule")==="evenodd"&&it.push("even-odd"),v.push([ct,it]),v}function R(d,v){const T=document.createElement("canvas"),E=T.getContext("2d"),k=d.getBoundingClientRect(),Y=_(d),ct=400/96;return k.width===0||k.height===0?null:(T.width=k.width*ct,T.height=k.height*ct,E.globalAlpha=0,E.fillStyle="#fff",E.fillRect(0,0,T.width,T.height),E.textBaseline="bottom",E.font=[Y["font-style"]||Y["FONT-STYLE"],`${(Y["font-size"]||Y["FONT-SIZE"])*ct}px`,Y["font-family"]||Y["FONT-FAMILY"]].join(" "),E.fillStyle=Y.fill||"#000",E.globalAlpha=1,E.fillText(v,0,T.height),["image",[T.toDataURL(),0,0,{width:k.width}]])}function W(d,v){if(!v._font||!v._font.font||!v._font.font.cmap||!v._font.font.cmap.unicode)return g("No font or TTF CMAP found"),!1;const T=v._font.font.cmap.unicode.codeMap;for(let E=0;E<d.length;E++)if(!T[d.charCodeAt(E)])return!0;return!1}function A(d,v,T){const E=(d.innerText||d.textContent).replace("\u266D","b"),k=[],Y=_(d);let ct=Y["font-family"]||Y["FONT-FAMILY"];const it=Y["font-size"]||Y["FONT-SIZE"],Bt=Y["font-style"]||Y["FONT-STYLE"],Ot=Y["font-weight"]||Y["FONT-WEIGHT"],It=Y["text-anchor"]||Y["TEXT-ANCHOR"],I=Y.fill||Y.FILL,h=d.getBoundingClientRect();if(E!=null&&E.length){const y=-it;if(It==="middle"?k.push(["translate",[-h.width/2,y]]):It==="end"?k.push(["translate",[-h.width,y]]):k.push(["translate",[0,y]]),I&&k.push(["fill",[I]]),W(E,v)){const D=R(d,E);D&&k.push(D)}else it&&k.push(["fontSize",[it]]),Ot==="bold"&&(ct+=" Bold"),Bt==="italic"&&(ct+=" Italic"),T.fontsNames.indexOf(ct)<0&&(ct=ct.replace(" Bold","").replace(" Italic",""),T.fontsNames.indexOf(ct)<0&&(ct=T.fontsNames[0],T.fontsNames.indexOf(ct)<0&&(ct=q))),k.push(["font",[ct]]),k.push(["text",[E,0,0,{lineBreak:!1}]])}return k}function J(d){var v;const T=[],E=_(d),k=E["stroke-width"]||E["STROKE-WIDTH"];if((v=E.x1)!=null&&v.length&&E.y1&&E.y1.length&&E.x2&&E.x2.length&&E.y2&&E.y2.length){if(k!=null&&k.length&&T.push(["lineWidth",[k]]),T.push(["lineCap",["butt"]],["moveTo",[E.x1,E.y1]],["lineTo",[E.x2,E.y2]]),E["stroke-dasharray"]&&E["stroke-dasharray"].length>0){const Y=E["stroke-dasharray"].split(",");Y.length===2&&T.push(["dash",[Y[0],{space:Y[1]}]])}T.push(["stroke",[]])}return T}function U(d){var v;const T=[],E=_(d);if(E.class!=="rect-mea"&&E.width&&E.width.length&&E.height&&E.height.length&&(T.push(["rect",[0,0,E.width,E.height]]),(v=E.style)!=null&&v.length)){const k=E.style.split("fill: ")[1];if(k!=null&&k.length){const Y=k.split(";")[0];Y!=null&&Y.length&&T.push(["fill",[z(Y)]])}}return T}function et(d){const v=[],T=_(d);if(T.points){T.points=T.points.trim();const E=T.points.split(" ");if(E.length>0){for(let k=0;k<E.length;k++){E[k]=E[k].split(",");for(let Y=0;Y<E[k].length;Y++)E[k][Y]=Number.parseFloat(E[k][Y])}v.push(["polygon",E],["fill",["black"]])}}return v}function $(d){const v=[],T=_(d);return v.push(["circle",[Number.parseFloat(T.cx),Number.parseFloat(T.cy),Number.parseFloat(T.r)]],["fill",["black"]]),v}function r(d){const v=[];return d!=null&&d.length&&d.match(p).forEach(E=>{const k={},Y=E.match(B);Y.length===3&&(k.name=Y[1],k.args=Y[2].split(" ").map(ct=>Number.parseFloat(ct.replace(",","").trim())),k.name==="translate"&&k.args.length===1&&k.args.push(0),v.push(k))}),v}function a(d){const v=[];return d.forEach(T=>{tt.includes(T.name)&&(T.name==="scale"?v.push([T.name,[Math.max(...T.args)]]):v.push([T.name,T.args]))}),v}function f(d){let v=[];const T=d.getAttribute("transform");if(T!=null&&T.length){const E=r(T);if(E.length){const k=a(E);k.length&&(v=k)}}return v}},221543:(b,S,s)=>{var t=s(370746);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("9448a3ca",t,!0,{})},227259:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.metronome_Zy7rl{display:flex;flex-direction:column;padding:0;margin:0;list-style:none}.btn_dE9ch{cursor:pointer;appearance:none;border:0;text-align:left;display:flex;align-items:center;gap:8px;background:none;padding:8px;color:var(--text-general-primary)}.btn_dE9ch.active_Fym7q{background:var(--surface-buttons-brand-secondary);border-radius:var(--radius-minimal);color:var(--text-general-brand-default)}.btn_dE9ch:not(.active_Fym7q){padding-right:32px}.text_Qflf3{flex:1 1 auto;white-space:nowrap}
`,""]),p.locals={metronome:"metronome_Zy7rl",btn:"btn_dE9ch",active:"active_Fym7q",text:"text_Qflf3"};const B=p},232579:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.partName_mkv10{display:inline-flex;align-items:center;gap:8px}.icon_GgXhC{display:flex}.text_BDgiN{font:var(--text-sm-regular);overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
`,""]),p.locals={partName:"partName_mkv10",icon:"icon_GgXhC",text:"text_BDgiN"};const B=p},234010:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.partName_lirc5{margin-bottom:8px;width:100%}
`,""]),p.locals={partName:"partName_lirc5"};const B=p},258230:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"};function C(tt,j){return(0,t.uX)(),(0,t.CE)("svg",c,j[0]||(j[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.6 5V6.07733C16.6251 6.58933 18.9333 9.21333 18.9333 12.3813C18.9333 15.5493 16.6251 18.1733 13.6 18.6853V19.7627C17.2171 19.24 20 16.136 20 12.3813C20 8.616 17.2171 5.52267 13.6 5ZM16.8 12.3813C16.8 10.504 15.4069 8.95733 13.6 8.70133V9.768C14.8171 10.0133 15.7333 11.0907 15.7333 12.3813C15.7333 13.672 14.8171 14.7493 13.6 14.9947V16.0613C15.4069 15.7947 16.8 14.2587 16.8 12.3813ZM8.26667 9.576L11.4667 7.58133V17.1813L8.26667 15.176V9.576ZM7.2 14.5147H5.6C5.3056 14.5147 5.06667 14.28 5.06667 13.9813V10.7813C5.06667 10.4827 5.3056 10.248 5.6 10.248H7.2V14.5147ZM5.06667 9.18133C4.47787 9.18133 4 9.66133 4 10.248V14.5147C4 15.1013 4.47787 15.5813 5.06667 15.5813H7.2L12.5333 18.7813V5.98133L7.2 9.18133H5.06667Z"},null,-1)]))}var g=s(938793);const p={},N=(0,g.A)(p,[["render",C]])},261318:(b,S,s)=>{"use strict";s.d(S,{A:()=>j});var t=s(737903),c=s(706305),C=s(645369),g=s.n(C),p=s(717045);const B=g()("flat:collaborators"),N="#0B7BE8",tt={"#F62459":0,"#1ABC9C":0,"#9B59B6":0,"#D35400":0,"#F1C40F":0,"#65E892":0,"#8E44AD":0,"#81CFE0":0,"#F46D6D":0,"#F2784B":0,"#BE90D4":0,"#FF94C7":0,"#ADEBBE":0,"#FDE3A7":0,"#3498DB":0,"#D789D7":0,"#F39C12":0,"#C0392B":0,"#E760BF":0,"#E74C3C":0,"#2980B9":0,"#E67E22":0,"#FFA87B":0,"#FDA4CF":0};class j{constructor(x,q){var G;this.ownColor=N,this.colors=Object.assign({},tt),this.colorsCodes=Object.keys(this.colors),this.collaborators={},this.score=x,this.account=q,this.account||(this.account={});const Z=(0,t.default)(x.collaborators);for(let F=0;F<Z.length;F++){const st=(G=Z[F].user)==null?void 0:G.id;if(st&&(this.collaborators[st]=Z[F],st===this.account.id&&x)){const{SET_AUTH_USER_COLLAB_RIGHTS:z}=(0,c.j)();z({scoreId:x.id,collaborator:(0,t.default)(Z[F])})}}this.account.id&&this.setOnline(this.account.id),B("loaded")}isCollaborator(){return this.collaborators[this.account.id]&&!this.collaborators[this.account.id]._frontendOnly}getNextColor(){let x,q=0;return this.colorsCodes.forEach(G=>{(!x||this.colors[G]<q)&&(q=this.colors[G],x=G)}),this.colors[x]++,x}setOnline(x){var q;if((q=this.collaborators[x])!=null&&q.session)return this.collaborators[x];B("setOnline %s",x);const G=this.account.id===x?this.ownColor:this.getNextColor(),Z={color:G,style:{"border-color":G}};this.collaborators[x]?this.collaborators[x].session=Z:this.collaborators[x]={aclWrite:!0,aclRead:!0,user:x,_frontendOnly:!0,session:Z};const{setCollaborator:F}=(0,p.n)();return F({uid:x,collaborator:this.collaborators[x]}),this.collaborators[x]}setOffline(x){var q;if((q=this.collaborators[x])!=null&&q.session){this.collaborators[x].session.color&&this.colors[this.collaborators[x].session.color]--,delete this.collaborators[x].session;const{setCollaborator:G}=(0,p.n)();G({uid:x,collaborator:this.collaborators[x]})}}getOnlineCollaborators(){const x={};for(const q in this.collaborators)this.collaborators[q].session&&(x[q]=this.collaborators[q]);return x}getUserColor(x){return typeof this.collaborators[x]!="undefined"&&typeof this.collaborators[x].session!="undefined"?this.collaborators[x].session.color:this.ownColor}}},276329:(b,S,s)=>{"use strict";s.d(S,{A:()=>x});var t=s(361744),c=s(538065);const C=s.p+"img/70245f6cc60181f40425.svg",g={class:"main-errors forbidden"},p={key:0,class:"buttons-container"};function B(q,G,Z,F,st,z){const _=(0,t.g2)("f-button");return(0,t.uX)(),(0,t.CE)("div",g,[G[1]||(G[1]=(0,t.Lk)("div",{class:"icon"},[(0,t.Lk)("img",{src:C})],-1)),(0,t.Lk)("div",null,[(0,t.Lk)("h3",null,(0,c.v_)(q.$t("flat:score.request-access.title")),1),Z.displayCta&&!F.isInIframe?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.bF)(_,{onClick:G[0]||(G[0]=M=>z.goHome()),"default-text":"flat:nav.go-home"})])):(0,t.Q3)("",!0)])])}var N=s(229384);const tt={name:"ScoreError403",props:{displayCta:{type:Boolean,default:!0}},setup(){return{isInIframe:N.GZ}},methods:{goHome(){window.location="/"}}};var j=s(938793);const x=(0,j.A)(tt,[["render",B]])},300243:(b,S,s)=>{"use strict";s.d(S,{default:()=>N});var t=s(391522),c=s(270093),C=s(938793);const g={},p={};p.$style=c.default;const N=(0,C.A)(g,[["render",t.X],["__cssModules",p]])},305392:(b,S,s)=>{"use strict";s.d(S,{AE:()=>D,M1:()=>H,Mt:()=>h,zv:()=>y});var t=s(485344),c=s(653934),C=s(680772),g=s(274496),p=s(135239),B=s(532285),N=s(304567),tt=s(596585),j=s(841421),lt=s(173240),x=s(506797),q=s(207006),G=s(494131),Z=s(11812),F=s(928830),st=s(906158),z=s(883939),_=s(758645),M=s(900269),L=s(168160),R=s(610786),W=s(782421),A=s(473461),J=s(804338),U=s(228424),et=s(378781),$=s(34432),r=s(181762),a=s(658589),f=s(311856),d=s(494458),v=s(735455),T=s(847700),E=Object.defineProperty,k=Object.defineProperties,Y=Object.getOwnPropertyDescriptors,ct=Object.getOwnPropertySymbols,it=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable,Ot=(V,Q,at)=>Q in V?E(V,Q,{enumerable:!0,configurable:!0,writable:!0,value:at}):V[Q]=at,It=(V,Q)=>{for(var at in Q||(Q={}))it.call(Q,at)&&Ot(V,at,Q[at]);if(ct)for(var at of ct(Q))Bt.call(Q,at)&&Ot(V,at,Q[at]);return V},I=(V,Q)=>k(V,Y(Q));const h=["notehead-anchor","range-select-anchor","wedge-anchor","slur-anchor","octave-anchor","pluckedRange-anchor","tempo-anchor","pedal-anchor","dynamic","pizzicato","mute","pedal","wedgeLines","slur","octaveShift","chord","tabFrame","tempoChange","pluckedRange","metronome","swing","clef-pitched","timeSignature","keySignature","rehearsal","word","lyricLine","classicChord","figure","part-name","title","subtitle","lyricist","arranger","composer","rights","systemBreak","nextSystemBreak","pageBreak","nextPageBreak","repeatTimes"],y={"notehead-anchor":x.A,"range-select-anchor":R.A,"wedge-anchor":v.A,"slur-anchor":et.A,"octave-anchor":G.A,"pluckedRange-anchor":L.A,"tempo-anchor":f.A,"pedal-anchor":z.A,dynamic:p.A,systemBreak:r.A,nextSystemBreak:r.A,pageBreak:Z.A,nextPageBreak:Z.A,pizzicato:_.A,mute:j.A,pedal:st.A,wedgeLines:d.A,slur:U.A,octaveShift:q.A,pluckedRange:M.A,chord:t.A,tempoChange:a.A,metronome:J.A,swing:$.A,"clef-pitched":C.A,timeSignature:J.A,keySignature:J.A,rehearsal:W.A,repeatTimes:A.A,word:T.A,lyricLine:tt.A,classicChord:c.A,head:lt.A,"part-name":F.A,title:g.A,subtitle:g.A,lyricist:g.A,arranger:g.A,composer:g.A,rights:g.A,tabFrame:N.A,figure:B.A},D={"notehead-anchor":x.A,"range-select-anchor":R.A,"wedge-anchor":v.A,"slur-anchor":et.A,"octave-anchor":G.A,"pluckedRange-anchor":L.A,"tempo-anchor":f.A,"pedal-anchor":z.A},H=I(It({},y),{wedge:d.A,octave:q.A,pluckedRange:M.A})},309260:(b,S,s)=>{var t=s(227259);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("671d8bee",t,!0,{})},320698:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.sc-aud-ctrls>*{pointer-events:auto}.power-box{pointer-events:none}
`,""]);const B=p},330957:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.btnMetronome_wroRc{color:var(--f-subdue)}.ddnMetronome_pBl22{margin:0 8px}.sc-instrument-visualisation_QoXv8{margin-left:15px;color:var(--f-subdue)}.sc-instrument-visualisation_QoXv8.active_rZxX_{color:var(--f-primary)}.control-item_vg2F5.disabled_uqtAh{background:#3579b4}.control-item_vg2F5.disabled_uqtAh .play_cdblA{fill:#2f5b8c}.play_cdblA{fill:var(--f-primary)}.stop_mrbIl{fill:var(--f-subdue)}
`,""]),p.locals={btnMetronome:"btnMetronome_wroRc",ddnMetronome:"ddnMetronome_pBl22","sc-instrument-visualisation":"sc-instrument-visualisation_QoXv8",active:"active_rZxX_","control-item":"control-item_vg2F5",disabled:"disabled_uqtAh",play:"play_cdblA",stop:"stop_mrbIl"};const B=p},339413:(b,S,s)=>{"use strict";s.d(S,{A:()=>et});var t=s(856219),c=s(701387),C=s(383279),g=s(989353),p=s(544582),B=s(941271),N=s(303953),tt=s(916504),j=s(444104),lt=s.n(j),x=s(645369),q=s.n(x),G=s(744056),Z=s(121648),F=s(591340),st=s(334931),z=Object.defineProperty,_=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,R=($,r,a)=>r in $?z($,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):$[r]=a,W=($,r)=>{for(var a in r||(r={}))M.call(r,a)&&R($,a,r[a]);if(_)for(var a of _(r))L.call(r,a)&&R($,a,r[a]);return $},A=($,r,a)=>R($,typeof r!="symbol"?r+"":r,a),J=($,r,a)=>new Promise((f,d)=>{var v=k=>{try{E(a.next(k))}catch(Y){d(Y)}},T=k=>{try{E(a.throw(k))}catch(Y){d(Y)}},E=k=>k.done?f(k.value):Promise.resolve(k.value).then(v,T);E((a=a.apply($,r)).next())});const U=q()("flat:audio");class et{constructor(r,a,f={}){A(this,"data"),A(this,"instrumentList"),A(this,"instrumentListHash"),A(this,"instrumentManager"),A(this,"bufferList"),A(this,"soundfonts"),A(this,"interaction"),A(this,"cursor"),A(this,"transport"),A(this,"pendingPlay"),A(this,"preloadSamples"),A(this,"loaded"),A(this,"loading"),A(this,"tracksObjects"),A(this,"defaultTrack"),A(this,"altPlayer"),A(this,"playing"),A(this,"pausing"),A(this,"recordingAudio"),A(this,"sliderAnimId"),A(this,"audioRecordingAnimId"),A(this,"metronomeTickCallback"),A(this,"nbMeasures"),A(this,"formerReader"),A(this,"i18next"),A(this,"addPlayAttempt"),U("Loading Audio.ts"),this.data=null,this.instrumentList=[],this.interaction=r,this.cursor=r.cursor,this.bufferList={},this.pendingPlay=!1,this.preloadSamples=!0,this.loaded=!1,this.loading=!1,this.instrumentManager=new g.fm,this.tracksObjects={},this.defaultTrack=null,this.altPlayer=null,this.playing=!1,this.pausing=!1,this.recordingAudio=!1,this.sliderAnimId=null,this.audioRecordingAnimId=null,this.metronomeTickCallback=null,this.soundfonts=null,this.addPlayAttempt=f.addPlayAttempt,this.initDacapo(),a&&this.setData(a)}initDacapo(){try{g.Ay.init()}catch(r){this.displayDacapoError(r)}}setData(r){U("setData"),this.instrumentManager||(this.instrumentManager=new g.fm),this.data=r,this.instrumentList=r.getPartsHeaders(),this.instrumentListHash||this.hasInstrumentsListChanged(),this.instrumentManager.setData(r),this.loaded||this.loadVolumePreferences(),this.setLoaded(!1),this.transport=new g.oK(this.data,this.instrumentManager),this.transport.setStateCallback(this.stateCallback.bind(this)),this.instrumentManager.setTransport(this.transport),this.formerReader?this.formerReader.setData(this.data):this.formerReader=new g.mP(null,this.data),this.defaultTrack&&(this.useTrack(this.defaultTrack.id),this.defaultTrack=null)}load(){return J(this,null,function*(){if(U("load"),!this.data||!this.instrumentManager)return U("no data or manager set"),Promise.reject(new Error("data or manager not set"));if(this.loaded&&!this.hasInstrumentsListChanged()){U("already loaded, or no change in instruments list");return}yield this.initInstruments(),U("instruments loaded"),this.applyVolumePreferences(),this.instrumentManager.selectInstrument(0),this.wipeRawSoundfonts()})}retrySoundfontsLoading(){const r=Object.keys(this.bufferList),a=[];(0,p.o)().setHideRetry(),this.setLoading(!0);for(let f=0;f<r.length;f++){const d=r[f],v=this.bufferList[d];if(v.hasMissingSoundfonts()){const T=v.retrySoundfontsLoading();a.push(T)}}return Promise.all(a).then(this.completeLoading.bind(this)).catch(this.completeLoading.bind(this))}initInstruments(){if(U("initInstruments"),!g.Ay.AudioContexts.context)return Promise.reject(new Error("[Audio] The AudioContext is null or undefined"));if(!this.instrumentList||this.instrumentList.length===0)return Promise.reject(new Error("[Audio] The instrumentList doesn't exist or is empty"));this.instrumentManager.resetInstruments();const a=this.createSamplers().map((f,d)=>(U(`going to load instruments for part ${d}`),this.loadPartInstruments(f)));return this.loadVolumePreferences(),Promise.all(a).finally(this.completeLoading.bind(this))}reloadInstruments(){return U("reloadInstruments"),this.initInstruments()}createSamplers(){U("createSamplers");const r=[];for(let a=0;a<this.instrumentList.length;a++){const f=new g.LC(a),d=this.data.getPartHeader(a),v=this.getPartInstrumentsConfig(a,d);f.setHeader(d),f.setInstrumentInfo(v),this.data.isPartUnpitched(a)&&f.setDrumSet(!0);const T=C.default.getGlobalVolume(d)/100,E=C.default.getGlobalReverberation(d);f.setVolume(T),f.setReverb(E),f.connectTo(g.Ay.mainOutput),this.instrumentManager.addInstrument(f,a),r.push({generator:f,instrumentsConfig:v})}return r}getPartInstrumentsConfig(r,a){if(!this.data)throw new Error("No data set");typeof a=="undefined"&&(a=this.data.getPartHeader(r));let f={};const d=C.default.getMIDIInstruments(a);if(this.data.isPartUnpitched(r))f=this.fetchDrumsetSoundfontsInfo(d);else{const v=t.default.getMIDIProgram(d[0]);v in g._T?f[v]=g._T[v]:f[1]=g._T[1]}return f}fetchDrumsetSoundfontsInfo(r){const a={};for(let f=0;f<r.length;f++){const d=Number.parseInt(r[f]["midi-program"],10);typeof d=="number"&&d in g.tc?a[d]=g.tc[d]:a[1]=g.tc[1]}return a}loadPartInstruments(r){const a=Object.keys(r.instrumentsConfig),f=[];for(let d=0;d<a.length;d++){const v=Number.parseInt(a[d],10);U(`loading instrument associated with MIDI program ${v}`);const T=r.instrumentsConfig[v];f.push(this.loadInstrument(T,v,r.generator))}return Promise.all(f)}loadInstrument(r,a,f){U(`loadInstrument ${r.id}`);let d,v;return!r||!r.id?Promise.reject(new Error("Unvalid instrumentConfig provided")):(typeof this.bufferList[r.id]=="undefined"?(this.setLoading(!0),U(`load ${r.id} using new sfBuffer`),d=new g.mX,d.init(r),v=d.loadSoundfont(this.soundfonts),this.bufferList[r.id]=d):(U(`${r.id} is already loaded, re-using existing sfBuffer`),d=this.bufferList[r.id],v=d.waitUntilSoundfontLoaded()),f.addSFBuffer(a,d),v.catch(T=>{T&&T.xhrCallback!=="onabort"&&this.logError(T,{level:"warning"})}).then(()=>{U(`${r.id} loaded`)}))}completeLoading(){const r=this.getMissingSoundfontsIds();U("completeLoading: all loaded = %s (miss: %o)",this.hasAllSoundfontsLoaded(),r),this.setLoading(!1),this.setLoaded(!0),this.hasAllSoundfontsLoaded()?(this.preloadSamples=!1,this.pendingPlay&&(this.play(),this.pendingPlay=!1)):(0,p.o)().setShowRetry()}hasAllSoundfontsLoaded(){const r=Object.keys(this.bufferList);for(let a=0;a<r.length;a++){const f=r[a];if(this.bufferList[f].hasMissingSoundfonts())return!1}return!0}wipeRawSoundfonts(){this.soundfonts=null}hasInstrumentsListChanged(){const r=this.instrumentList.map(f=>f["midi-instrument"]),a=lt()(JSON.stringify(r));return a!==this.instrumentListHash?(this.instrumentListHash=a,!0):!1}setLoading(r){this.loading=r,(0,p.o)().setLoading(r)}setLoaded(r){this.loaded=r,(0,p.o)().setLoaded(r)}getPartSoundfontsIds(r){if(!this.data)throw new Error("No data set");const a=[],f=this.getPartInstrumentsConfig(r);return Object.entries(f).forEach(([v,T])=>{!T||!T.id||a.includes(T.id)||(a.push(T.id),T.children&&Object.values(T.children).forEach(k=>{const Y=k.id||k;a.includes(Y)||a.push(Y)}))}),a}getSoundfontsIds(){if(!this.data)throw new Error("No data set");const r=[];for(let a=0;a<this.instrumentList.length;a++)this.getPartSoundfontsIds(a).forEach(d=>{r.includes(d)||r.push(d)});return r}setSoundfonts(r){typeof r=="string"&&(r=JSON.parse(r)),this.soundfonts=r}setSingleSoundfont(r,a){typeof a=="string"&&(a=JSON.parse(a)),(this.soundfonts===null||typeof this.soundfonts!="object")&&(this.soundfonts={}),this.soundfonts[r]=a}setInstrumentNote(r,a,f){this.soundfonts||(this.soundfonts={}),this.soundfonts[r]||(this.soundfonts[r]={}),this.soundfonts[r][a]=f}resetInstruments(){U("resetInstruments..."),this.bufferList={},this.instrumentManager.resetInstruments()}play(r={}){U("play");const a=(0,p.o)();if(a.remainingPlays===0){if(!this.pausing)return}else if(a.disablePlayback&&!r.sliderMode)throw new Error("An error occured and playback has been disabled");if(!this.transport)throw new Error("No transport object set");if(r.forceClassicPlayback===void 0&&(0,F.U)().env==="performance"&&(r.forceClassicPlayback=!0),this.loading){this.pendingPlay=!0;return}if(!this.loaded&&!r.sliderMode&&(a.currentTrack===null||r.forceClassicPlayback)){this.pendingPlay=!0,this.load();return}r.sliderMode||a.currentTrack&&!r.forceClassicPlayback?this.transport.enableSliderMode(r.forceMetronome):this.transport.disableSliderMode();let f=0;if(r.measureStart!==void 0?f=r.measureStart:this.cursor.isInit()&&!this.playing&&(f=this.cursor.getPositionIdx().measureIdx),a.hasPlaysLimit&&!this.playing&&(f=0),!this.pausing&&!r.forceClassicPlayback&&this.altPlayer&&a.currentTrack!==null&&"setLoopRange"in this.altPlayer){const d=(0,Z.W)();d.range?this.altPlayer.setLoopRange(d.range):this.altPlayer.disableLoop()}this.transport.start(f,r)}stop(){if(U("stop"),this.cleanUp(),!this.transport)throw new Error("No transport object set");this.transport.stop(),this.playing=!1,this.pausing=!1,(0,p.o)().setStop()}pause(){if(this.cleanUp(),!this.transport)throw new Error("No transport object set");this.pausing=!0,this.transport.pause(),(0,p.o)().setPause()}restart(){if(!this.transport)throw new Error("No transport object set");this.transport.restart().catch(r=>{this.displayDacapoError(r)})}stopIfPlaying(){(this.pausing||this.playing)&&this.stop()}playToggle(){this.playing?this.stop():this.play()}pauseToggle(){this.pausing||!this.playing?this.play():this.pause()}playStopResumeToggle(){!this.playing||this.pausing?this.play():this.stop()}goBeginning(){(0,p.o)().hasPlaysLimit||(this.pausing&&this.play(),this.playing&&this.restart())}stateCallback(r,a){var f;if(r){this.logError(r),this.displayDacapoError(r),r instanceof g.MC&&this.stop();return}U("[stateCallback] received player state %s",a);const d=(0,p.o)();a==="start"?(!this.playing&&!this.pausing&&(d.remainingPlays===0?window.requestAnimationFrame(this.stop.bind(this)):d.hasPlaysLimit&&(d.setDecrementRemainingPlays(),this.addPlayAttempt&&this.addPlayAttempt())),(!this.playing||this.pausing)&&(window.requestAnimationFrame(this.recurPosition.bind(this)),this.playing=!0,this.interaction.scoreData.resetSoundQueue(),this.nbMeasures=(f=this.data)==null?void 0:f.getNbMeasures(),this.pausing=!1,d.setStart(),this.addExperience("editor.player"))):a==="stop"||a==="end"?(this.cleanUp(),this.pausing=!1,this.playing=!1,d.setStop()):a==="pause"?(this.cleanUp(),this.pausing=!0,d.setPause()):this.logError(new Error(`Unhandled playback state "${a}"`))}recurPosition(){return J(this,null,function*(){if(!this.transport){this.stop();return}let r=this.transport.getSliderPosition();const a=(0,p.o)();if(this.altPlayer&&a.currentTrack!==null){const f=(0,Z.W)();f.range&&this.altPlayer.loopInRange?(yield this.altPlayer.loopInRange(r,f.range))&&r===null&&(r=this.transport.getSliderPosition()):f.range||this.altPlayer.disableLoop(),this.altPlayer.getCurrentTime().then(d=>{a.setTrackCurrentTime(d)})}a.setPos(r),this.sliderAnimId=window.requestAnimationFrame(this.recurPosition.bind(this))})}sendDataUpdate(){if(U("sendDataUpdate"),!this.data)throw new Error("No data set");if(!this.transport)throw new Error("No transport object set");this.transport.setNewData(this.data)}getMasterVolume(){return this.instrumentManager?this.instrumentManager.getMasterVolume():1}setMasterVolume(r){try{return g.Ay.mainOutput.setGain(r)}catch(a){throw new Error(`${a.message}volume value was "${r.toString()}"`)}}loadVolumePreferences(){var r;U("loadVolumePreferences() from score data to store");const a=this.instrumentList.map(f=>f.uuid);(0,p.o)().setEnsureParts(a),a.forEach(f=>{if(!this.data)throw new Error("No data set");const d=this.data.uuidGetPartHeader(f);this.setPartVolume(f,C.default.getGlobalVolume(d)/100),this.setPartReverb(f,C.default.getGlobalReverberation(d)/100)}),(r=this.interaction)!=null&&r.score&&tt.A.remove(`score-audio.volume:${this.interaction.score.id}`)}applyVolumePreferences(){U("applyVolumePreferences() from store to Dacapo audio nodes");const r=(0,p.o)();for(let a=0;a<this.instrumentList.length;a++){const d=this.instrumentList[a].uuid;if(r.parts[a]){const v=r.parts[a].volume,T=r.parts[a].reverb;this.setPartVolume(d,v),this.setPartReverb(d,T)}}}getPartVolume(r){if(!this.loaded)return 1;const a=this.normalizePartToIdx(r);return this.instrumentManager.getInstrumentVolume(a)}setPartVolume(r,a=1){U("set part %s volume to %s",r,a),(0,p.o)().setPartVolume({part:r,volume:a});const f=this.normalizePartToIdx(r);if(!this.loaded)return a;try{this.instrumentManager.setInstrumentVolume(f,a)}catch(d){throw new Error(`${d.message} Volume value was "${a}". index was "${f}"`)}return a}getPartReverb(r){if(!this.loaded)return 0;const a=this.normalizePartToIdx(r);return this.instrumentManager.getInstrumentReverb(a)/100}setPartReverb(r,a=0){U("set part %s reverb to %s",r,a),(0,p.o)().setPartReverb({part:r,reverb:a});const f=this.normalizePartToIdx(r);if(!this.loaded)return a;try{this.instrumentManager.setInstrumentReverb(f,a*100)}catch(d){throw new Error(`${d.message} Reverb value was "${a}". index was "${f}"`)}return a}setPartSoloMode(r){this.instrumentManager&&(typeof r=="string"&&(0,p.o)().setPartSolo({part:r,solo:!0}),this.unmuteInstrument(r),r=this.normalizePartToIdx(r),this.instrumentManager.setInstrumentSolo(r))}unsetPartSoloMode(r){this.instrumentManager&&(typeof r=="string"&&(0,p.o)().setPartSolo({part:r,solo:!1}),r=this.normalizePartToIdx(r),this.instrumentManager.unsetInstrumentSolo(r))}getPartSoloMode(r){if(!this.instrumentManager)throw new Error("No instrument manager set");return r=this.normalizePartToIdx(r),this.instrumentManager.isInstrumentSolo(r)}muteInstrument(r){if(this.instrumentManager){this.unsetPartSoloMode(r),typeof r=="string"&&(0,p.o)().setPartMute({part:r,mute:!0}),r=this.normalizePartToIdx(r),this.instrumentManager.muteInstrument(r);return}}unmuteInstrument(r){if(this.instrumentManager){typeof r=="string"&&(0,p.o)().setPartMute({part:r,mute:!1}),r=this.normalizePartToIdx(r),this.instrumentManager.unmuteInstrument(r);return}}getPartMuteMode(r){return this.instrumentManager?(r=this.normalizePartToIdx(r),this.instrumentManager.isInstrumentMuted(r)):!1}setTracksObjects(r,a={dontLoad:!1}){for(let d=0;d<r.length;d++)this.tracksObjects[r[d].id]=r[d],r[d].default&&(this.defaultTrack=r[d]);const f=(0,p.o)();!a.dontLoad&&this.defaultTrack&&this.transport?(this.useTrack(this.defaultTrack.id),this.defaultTrack=null):f.restrictToAudioTracks&&(r.length>0?this.useTrack(r[0].id):f.forceDisablePlayback()),f.setLoadedTracks(!0)}setTrackObject(r){this.tracksObjects[r.id]=r}useTrack(r,a={}){if(a.element=a.element||"editor-video",a.exceptions===void 0&&(a.exceptions=!1),!this.transport)throw new Error("No transport object set");if(!this.formerReader)throw new Error("An instance of the old Dacapo reader is necessary to use tracks");this.setMetronomeMode(g.Gk.DISABLED);const f=(0,p.o)();if(!r)return this.stop(),this.transport.disableAltPlayer(),this.cleanTrackDOM(),f.setCurrentTrack(null),null;if(!this.tracksObjects[r]){const E=new Error(`Track for not found: ${r}`);if(a.exceptions)throw E;return U(E),null}const d=this.tracksObjects[r];if(a.anchorList=a.anchorList||d.synchronizationPoints,a.anchorList&&(a.anchorList=JSON.parse(JSON.stringify(a.anchorList))),!a.force&&this.transport.trackIdIsCurrentlyUsed(r))return U("already using track %s",r),null;f.setCurrentTrack(r),U("loading track %s (type = %s)",r,d.type),this.stop(),this.cleanTrackDOM();let v;const T={element:a.element,anchorList:a.anchorList};if(d.type==="youtube")T.videoId=d.mediaId,T.width="100%",T.height="100%",v=(0,G.IG)(new g.N1(this.formerReader,T));else if(d.type==="soundcloud")T.trackUrl=d.url,v=(0,G.IG)(new g.yq(this.formerReader,T));else if(d.type==="vimeo")T.videoId=d.mediaId,v=(0,G.IG)(new g.G1(this.formerReader,T));else if(d.type==="audio"&&d.url)if(a.forceDefaultSync){const E=(0,g.Ck)(a.element,d.url);v=new g.R_({reader:this.transport.reader,htmlElem:E,url:d.url})}else v=new g.zT(this.formerReader),v.setElement(a.element,d.url),a.anchorList&&v.setAnchorList(a.anchorList);else if(d.type==="external")v=new g.tB(this.formerReader),v.setDuration(d.totalTime),a.anchorList&&v.setAnchorList(a.anchorList);else throw new Error(`Unsupported track type: ${d.type}`);return v.setCallbackState(this.stateCallback.bind(this)),v.getDuration().then(E=>{f.setCurrentTrackDuration(E)}),this.transport.setAltPlayer(r,v),this.transport.enableAltPlayer(r),this.altPlayer=v,this.transport.getAvailablePlaybackSpeedList().then(E=>{E!==null&&f.setAvailablePlaybackRates(E)}),this.addExperience("score.track.play"),null}useTrackiOS(r,a={}){if(!this.transport)throw new Error("No transport object set");if(!this.formerReader)throw new Error("An instance of the old Dacapo reader is necessary to use tracks");if(a.anchorList=a.anchorList||r.synchronizationPoints,a.anchorList&&(a.anchorList=JSON.parse(JSON.stringify(a.anchorList))),!a.force&&this.transport.trackIdIsCurrentlyUsed(r.id))return U("already using track %s",r.id),null;const f=(0,p.o)();f.setCurrentTrack(r.id),U("loading track %s (type = %s)",r.id,r.type),this.stop(),this.cleanTrackDOM();const d=new g.tB(this.formerReader);return d.setDuration(r.totalTime),a.anchorList&&d.setAnchorList(a.anchorList),d.setCallbackState(this.stateCallback.bind(this)),d.getDuration().then(v=>{f.setCurrentTrackDuration(v)}),this.transport.setAltPlayer(r.id,d),this.transport.enableAltPlayer(r.id),this.altPlayer=d,this.addExperience("score.track.play"),null}getTrackAudioBuffer(){if(!this.transport)throw new Error("No transport object set");return this.transport.getTrackAudioBuffer()}getTrackAudioTag(){return this.altPlayer instanceof g.zT?this.altPlayer.getAudioTag():null}seekTrackTo(r){if(U(`seekTrackTo ${r}`),!this.altPlayer)return null;if(!Number.isFinite(r)||r<0)throw new Error(`The time provided to seekTrackTo() is invalid: ${r}`);return this.altPlayer.seekTo(r),null}cleanTrackDOM(){const r=document.getElementById("editor-video");if(r)for(;r.firstChild;)r.removeChild(r.firstChild)}updateSliderTime(r){if(!this.transport)throw new Error("No transport object set");if(!this.altPlayer)throw new Error("No alternative player set");const a=this.altPlayer.getSliderLocation(r),f=(0,p.o)();f.setPos(a),f.setTrackCurrentTime(r)}getMatchingTrackTimeForLocation(r){return this.altPlayer?this.altPlayer.getTimeFromLocation(r):null}loadMetronome(r){if(!this.instrumentManager)throw new Error("No instrument manager");if(!this.transport)throw new Error("No transport object set");let a=g.Gk.DISABLED;typeof r=="undefined"&&this.soundfonts&&this.soundfonts.metronome&&(r=this.soundfonts);const f=new g.D_(r);f.connectTo(g.Ay.mainOutput),f.switchOn(),this.transport.setMetronome(f),tt.A.get("score-audio.metronomeDisabled")===!1&&(a=g.Gk.COUNT_IN),this.setMetronomeMode(a,{saveInLocalStorage:!1})}getMetronomeMode(){return(0,p.o)().metronomeMode}setMetronomeMode(r,{time:a,saveInLocalStorage:f,stopCurrentSequence:d,trackAction:v}={}){if(a=a!=null?a:0,f=f!=null?f:!0,d=d!=null?d:!0,v=v!=null?v:!1,!this.transport)throw new Error("No transport object set");U(`Audio.setMetronomeMode(mode = ${r}, time = ${a}, saveInLocalStorage = ${f}, stopCurrentSequence = ${d})`),this.transport.setMetronomeMode(r),(0,p.o)().setMetronomeMode(r),f&&tt.A.set("score-audio.metronomeDisabled",r===g.Gk.DISABLED),v&&this.addExperience("editor.metronome")}getMetronomeCountIn(){(0,g.gx)(this.transport,"No transport object set");const r=this.transport.getMetronomeCountdownInfo();return r.sequences=2,r}setGlobalPlaybackSpeed(r){if(!this.transport)throw new Error("No transport object set");this.playing||this.pausing||((0,p.o)().setPlaybackSpeed(r),this.transport.setGlobalPlaybackSpeed(r))}getGlobalPlaybackSpeed(){if(!this.transport)throw new Error("No transport object set");return this.transport.getGlobalPlaybackSpeed()}initAudioRecorder(){U("initAudioRecorder"),(0,g.gx)(this.transport,"No transport object set");const r="vmsg.wasm",a="wasm-polyfill.js";let f="";N.A.env==="development"&&(f="/dist");const d=N.A.bundles||{};let v=r;"vmsg.wasm"in d&&d["vmsg.wasm"]&&(v=d["vmsg.wasm"]);let T=a;"wasm-polyfill.js"in d&&d["wasm-polyfill.js"]&&(T=d["wasm-polyfill.js"]),this.transport.initAudioRecorder(`${N.A.assetsurl}${f}/js/`,v,T)}handleAudioRecordingError(r){let a=r.message;r.name==="NotAllowedError"&&(this.i18next?a+=`: ${this.i18next.t("flat:audio-recording.errors.denied-access")}`:a+=": Please allow Flat to access your computer microphone in your browser settings and refresh the page to continue."),(0,p.o)().setMediaAccessDenied(a)}startAudioRecording(){return J(this,arguments,function*(r={}){U("startAudioRecording"),(0,g.gx)(this.transport,"No transport object set");const a=(0,p.o)();this.transport.audioRecorder||this.initAudioRecorder();try{yield this.transport.startAudioListening()}catch(d){this.handleAudioRecordingError(d);return}const f=0;try{this.audioRecordingAnimId=requestAnimationFrame(this.updateAudioRecordingStatus.bind(this)),r.metronomeSequence&&a.startRecordCountIn(),r.metronomeTickCb&&(this.metronomeTickCallback=r.metronomeTickCb),yield this.transport.startAudioRecording(r)}catch(d){throw a.finishRecordCountIn(),d}if(r.sliderTracking){const v=(0,p.o)().metronomeMode===g.Gk.CONTINUOUS;this.play({sliderMode:!r.playBacktrack,forceMetronome:v,measureStart:f,forceClassicPlayback:!0})}this.recordingAudio=!0,a.setRecord()})}stopAudioRecording(){if((0,g.gx)(this.transport,"No transport object set"),!this.recordingAudio)return null;this.playing&&this.stop();const r=this.transport.stopAudioRecording();return this.audioRecordingAnimId!==null&&cancelAnimationFrame(this.audioRecordingAnimId),this.recordingAudio=!1,(0,p.o)().setStopRecord(),r}getRecordedAudioBuffer(){return(0,g.gx)(this.transport,"No transport object set"),this.transport.getRecordedAudioBuffer()}getRecordedArrayBuffer(){return(0,g.gx)(this.transport,"No transport object set"),this.transport.getRecordedArrayBuffer()}convertArrayBufferToBase64(r){return(0,g.Mw)(r)}updateAudioRecordingStatus(){if((0,g.gx)(this.transport,"No transport object set"),this.metronomeTickCallback&&!this.transport.hasRecordingStarted()&&this.transport.isMetronomeClickTime())this.metronomeTickCallback();else{const r=this.transport.getAverageAudioInputPower(),a=this.transport.getAudioRecordingTime(),f=(0,p.o)();f.setRecordTime(a),f.setAvgAudioInputPower(r)}this.audioRecordingAnimId=requestAnimationFrame(this.updateAudioRecordingStatus.bind(this))}resetAudioRecording(){(0,g.gx)(this.transport,"No transport object set"),(0,p.o)().setResetRecord(),this.transport.audioRecorder?this.initAudioRecorder():this.transport.resetAudioRecording()}getMissingSoundfontsIds(){const r=Object.keys(this.bufferList);let a=[];for(let f=0;f<r.length;f++){const d=r[f],v=this.bufferList[d];if(v.hasMissingSoundfonts()){const T=v.getMissingSoundfontsIds();a=a.concat(T)}}return(0,p.o)().setMissingSfIds(a),a}displayDacapoError(r,a=!0){const f=(0,p.o)();if(r){if(r instanceof g.fW){f.setErrorDisplayUi({code:"connection-overflow",params:{bound:r.maxConnections}});return}if(r instanceof g.RL){f.setErrorDisplayUi({code:"compat"});return}if(r instanceof g.MC&&(r.keepPlaybackActive=!0),r instanceof g.jd&&(r.i18n="dacapo.errors.stucked-waapi",this.addExperience("editor.stuck-waapi")),a){const d={message:r.message,keepPlaybackActive:!1};r instanceof g.dv&&(d.keepPlaybackActive=r.keepPlaybackActive),f.setError(d)}this.logError(r)}}logError(r,a={}){a.extra=a.extra||a||{},a.logger="dacapo",this&&(a.extra["audio:missingInstru"]=this.getMissingSoundfontsIds()),this.interaction.logError(r,a)}playNote(r){if(!this.data)throw new Error("No data set");if((0,p.o)().restrictPlayNote||!this.instrumentManager||!this.loaded)return;r=W({},r||this.cursor.getPositionIdx()),r.partUuid&&Object.assign(r,st.A.positionUuidToIdx(this.data,r));const f=this.data.getMeasure(r.partIdx,r.measureIdx);c.default.hasSlash(f,r.staffIdx)||(U("play note at pos %o",r),this.instrumentManager.playNoteAtPosition(r))}normalizePartToIdx(r){return typeof r=="number"?r:this.data.getPartIdxFromUuid(r)}addExperience(r){(0,B.B)().addExperience(r)}setI18next(r){this.i18next=r}cleanUp(){this.sliderAnimId&&(U("[cleanUp] cancel slider callback"),window.cancelAnimationFrame(this.sliderAnimId),this.sliderAnimId=null)}}},370746:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.scoreDrawer_oX0Rb{display:flex;width:100%}.scoreDrawer_oX0Rb .pages_Qn9SM{background-color:#fff}.scoreDrawer_oX0Rb.track_qYg36{overflow:hidden}.scoreDrawer_oX0Rb.track_qYg36 .partContent_ggPS5{display:flex;flex-direction:column;width:0;flex:1 1 100%}.scoreDrawer_oX0Rb.track_qYg36 .pages_Qn9SM{overflow:auto;flex-grow:1;position:relative;background:linear-gradient(to right,#fff,#fff,#ffffff80 1.5em),radial-gradient(farthest-side at 0 50%,#22222280,#ffffff80);background-color:#fff;background-repeat:no-repeat;background-attachment:local,scroll;background-size:100% 100%,.75em 100%;height:100%}.page_UErUd{justify-content:space-between}.page_UErUd:before,.page_UErUd:after{content:""}.partHeaderBlock_o7R6R{flex-shrink:0;display:flex;flex-direction:column}.hideBlock_g0mn0{background-color:#fff;flex-shrink:0;flex-grow:0;z-index:1}.partsPanel_tq_I3{position:relative;flex-shrink:0;overflow:hidden}.measuresPanel_QGejd{position:relative;background:#fff;flex-shrink:0;overflow:hidden}
`,""]),p.locals={scoreDrawer:"scoreDrawer_oX0Rb",pages:"pages_Qn9SM",track:"track_qYg36",partContent:"partContent_ggPS5",page:"page_UErUd",partHeaderBlock:"partHeaderBlock_o7R6R",hideBlock:"hideBlock_g0mn0",partsPanel:"partsPanel_tq_I3",measuresPanel:"measuresPanel_QGejd"};const B=p},384984:(b,S,s)=>{var t=s(699247);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("5dcfa763",t,!0,{})},396747:(b,S,s)=>{"use strict";s.d(S,{A:()=>x});var t=s(361744),c=s(538065);const C=s.p+"img/69a23db81f431c41dfbc.svg",g={class:"main-errors not-found"},p={key:0,class:"buttons-container"};function B(q,G,Z,F,st,z){const _=(0,t.g2)("f-button");return(0,t.uX)(),(0,t.CE)("div",g,[G[1]||(G[1]=(0,t.Lk)("div",{class:"icon"},[(0,t.Lk)("img",{src:C})],-1)),(0,t.Lk)("div",null,[(0,t.Lk)("h3",null,(0,c.v_)(q.$t("flat:score.not-found.title")),1),Z.displayCta&&!z.isInIframe?((0,t.uX)(),(0,t.CE)("div",p,[(0,t.bF)(_,{onClick:G[0]||(G[0]=M=>z.goHome()),"default-text":"flat:nav.go-home"})])):(0,t.Q3)("",!0)])])}var N=s(229384);const tt={name:"ScoreError404",props:{displayCta:{type:Boolean,default:!0}},computed:{isInIframe(){return N.GZ}},methods:{goHome(){window.location="/"}}};var j=s(938793);const x=(0,j.A)(tt,[["render",B]])},410296:(b,S,s)=>{"use strict";s.d(S,{A:()=>_});var t=s(931720),c=s(653154),C=s(544582),g=s(941271),p=s(459356),B=s(6645),N=s(727825),tt=Object.defineProperty,j=Object.defineProperties,lt=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,Z=(M,L,R)=>L in M?tt(M,L,{enumerable:!0,configurable:!0,writable:!0,value:R}):M[L]=R,F=(M,L)=>{for(var R in L||(L={}))q.call(L,R)&&Z(M,R,L[R]);if(x)for(var R of x(L))G.call(L,R)&&Z(M,R,L[R]);return M},st=(M,L)=>j(M,lt(L)),z=(M,L,R)=>new Promise((W,A)=>{var J=$=>{try{et(R.next($))}catch(r){A(r)}},U=$=>{try{et(R.throw($))}catch(r){A(r)}},et=$=>$.done?W($.value):Promise.resolve($.value).then(J,U);et((R=R.apply(M,L)).next())});const _={data(){return{pendingRecordingStart:!1,percentProgress:0,currentPlaybackTimeStr:"00:00",canPlay:!1,isPlaying:!1,uploading:!1,recordedData:null}},computed:st(F(F({},(0,B.aH)(N.N,["score"])),(0,B.aH)(C.o,["recording","loading","recorded"])),{currentTime(){return this.currentPlaybackTimeStr}}),methods:st(F(F(F({},(0,B.i0)(t.B,["showUpgradeDialog"])),(0,B.i0)(g.B,["addExperience"])),(0,B.i0)(p.O,["displayError"])),{init(){this.currentPlaybackTimeStr="00:00",this.percentProgress=0,this.canPlay=!1,this.isPlaying=!1,this.uploading=!1},stopAudioRecording(){return z(this,null,function*(){try{this.mp3DataBlob=yield this.audio.stopAudioRecording(),this.recordedData=this.audio.getRecordedAudioBuffer(),this.mp3Url=URL.createObjectURL(this.mp3DataBlob),this.audioTag=new Audio(this.mp3Url),this.audioTag.setAttribute("crossOrigin","anonymous"),this.$el.appendChild(this.audioTag),this.audioTag.addEventListener("canplay",()=>{this.canPlay=!0}),this.audioTag.addEventListener("play",()=>{this.audioTag.currentTime>0?this.audio.play({forceClassicPlayback:!0,sliderMode:!0}):this.audio.play({forceClassicPlayback:!0,sliderMode:!0,measureStart:0})}),this.audioTag.addEventListener("pause",()=>{this.audio.pause()}),this.audioTag.addEventListener("ended",()=>{this.percentProgress=100,this.stopRecordingPlayback(),this.audio.stop()}),this.audioTag.addEventListener("error",(L,R)=>{(0,c.vV)(R)});const M=this.$refs["progress-bar"];M&&(M.onclick=this.clickProgressBar),this.addExperience("score.audio-recording.recorded")}catch(M){this.displayError({error:M}),(0,c.vV)(M)}})},toggleRecordingPlayback(){this.isPlaying?this.pauseRecording():this.playbackRecording()},playbackRecording(){this.isPlaying||(this.audioTag.play(),this.isPlaying=!0,this.updateTimer=setInterval(()=>this.updatePlaybackBar(),500))},pauseRecording(){this.audioTag.pause(),this.isPlaying=!1,clearInterval(this.updateTimer)},stopRecordingPlayback(){this.isPlaying&&(this.audioTag.pause(),this.isPlaying=!1,clearInterval(this.updateTimer))},updatePlaybackBar(){if(!this.audioTag)return;const M=this.audioTag.currentTime,L=this.audioTag.duration;this.percentProgress=(M/L).toFixed(3)*100;const R=`0${Math.floor(M/60)}`.substr(-2),W=`0${Math.floor(M%60)}`.substr(-2);this.currentPlaybackTimeStr=`${R}:${W}`},clickProgressBar(M){const R=this.$refs["progress-bar"].getClientRects()[0],W=(M.pageX-R.x)/R.width;this.audioTag.currentTime=W*this.audioTag.duration,this.updatePlaybackBar()}})}},416568:(b,S,s)=>{var t=s(986027);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("cb8f6352",t,!0,{})},430590:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.partSettings_OyErE{background:var(--surface-general-brand-quinary);border-radius:4px;padding:8px;display:grid;grid-template-columns:24px 28px 1fr 4fr;align-items:center;column-gap:4px;font:var(--text-xs-regular)}.row_P8qdO{display:flex}.solo__7guO,.muted_HOGU1{appearance:none;background:var(--surface-general-brand-quinary);border:0;cursor:pointer;padding:0;display:flex}.solo__7guO.active_IcjeU{color:var(--icons-buttons-brand-primary)}.muted_HOGU1.active_IcjeU{color:var(--f-safe-red, #de001f)}.volume_fHj71,.reverb_WiQG8{flex:1 1 auto;display:flex}.reverbLabel_P1NjH{grid-column-start:3}.label_iF4G4{white-space:nowrap;padding-right:8px}
`,""]),p.locals={partSettings:"partSettings_OyErE",row:"row_P8qdO",solo:"solo__7guO",muted:"muted_HOGU1",active:"active_IcjeU",volume:"volume_fHj71",reverb:"reverb_WiQG8",reverbLabel:"reverbLabel_P1NjH",label:"label_iF4G4"};const B=p},467606:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.badge_yZPY9{background-color:var(--surface-general-brand-primary);color:var(--text-buttons-primary);font-weight:600;font-size:12px;line-height:16px;border-radius:4px;padding:4px 6px}
`,""]),p.locals={badge:"badge_yZPY9"};const B=p},486822:(b,S,s)=>{"use strict";b.exports=s.p+"img/e0e69ea27bd207982e8b.svg"},502762:(b,S,s)=>{"use strict";var t=s(824977),c=s.n(t)},522698:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function C(tt,j){return(0,t.uX)(),(0,t.CE)("svg",c,j[0]||(j[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.3968 4C14.6678 4 14.9448 4.212 15.0168 4.482L16.0958 8.529L17.9998 6.185C18.1738 5.97 18.4888 5.938 18.7038 6.112C18.9178 6.286 18.9508 6.601 18.7758 6.815L16.4138 9.723L17.3598 13.268C17.1228 13.384 16.8968 13.528 16.6988 13.722L16.4488 13.732L15.6348 10.682L13.6108 13.173C13.2978 13.293 13.0038 13.475 12.7508 13.725C12.3928 14.095 12.1678 14.539 12.0688 15H6.98981L6.18981 18H12.4878C12.2648 18.304 12.1128 18.643 12.0458 19H8.88781V19.5C8.88781 19.776 8.67381 20 8.38381 20H7.39281C7.11381 20 6.88781 19.768 6.88781 19.5V19H5.38681C5.11081 19 4.94481 18.788 5.01681 18.518L8.75981 4.482C8.83081 4.216 9.11581 4 9.37881 4H14.3968ZM14.1461 15.146C14.3421 14.951 14.6581 14.951 14.8531 15.146L16.5001 16.793L18.1461 15.146C18.3421 14.951 18.6581 14.951 18.8531 15.146C19.0491 15.342 19.0491 15.658 18.8531 15.854L17.2071 17.5L18.8531 19.146C19.0491 19.342 19.0491 19.658 18.8531 19.854C18.6581 20.049 18.3421 20.049 18.1461 19.854L16.5001 18.207L14.8531 19.854C14.6581 20.049 14.3421 20.049 14.1461 19.854C13.9511 19.658 13.9511 19.342 14.1461 19.146L15.7931 17.5L14.1461 15.854C13.9511 15.658 13.9511 15.342 14.1461 15.146ZM12.0506 16C12.1176 16.356 12.2676 16.695 12.4896 17H10.3786C10.1076 17 9.88761 16.768 9.88761 16.5C9.88761 16.224 10.1036 16 10.3786 16H12.0506ZM14.1198 5H9.65681L7.25681 14H11.6498L15.3168 9.488L14.1198 5ZM12.3833 10C12.6623 10 12.8883 10.232 12.8883 10.5C12.8883 10.776 12.6743 11 12.3833 11H11.3923C11.1143 11 10.8883 10.768 10.8883 10.5C10.8883 10.224 11.1023 10 11.3923 10H12.3833ZM12.3837 8C12.6617 8 12.8877 8.232 12.8877 8.5C12.8877 8.776 12.6737 9 12.3837 9H11.3927C11.1137 9 10.8877 8.768 10.8877 8.5C10.8877 8.224 11.1017 8 11.3927 8H12.3837ZM12.3837 6C12.6617 6 12.8877 6.232 12.8877 6.5C12.8877 6.776 12.6737 7 12.3837 7H11.3927C11.1137 7 10.8877 6.768 10.8877 6.5C10.8877 6.224 11.1017 6 11.3927 6H12.3837Z"},null,-1)]))}var g=s(938793);const p={},N=(0,g.A)(p,[["render",C]])},557854:(b,S,s)=>{"use strict";s.d(S,{A:()=>st});var t=s(361744),c=s(538065),C=s(674548),g=Object.defineProperty,p=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,tt=(z,_,M)=>_ in z?g(z,_,{enumerable:!0,configurable:!0,writable:!0,value:M}):z[_]=M,j=(z,_)=>{for(var M in _||(_={}))B.call(_,M)&&tt(z,M,_[M]);if(p)for(var M of p(_))N.call(_,M)&&tt(z,M,_[M]);return z};const lt=(0,t.pM)({__name:"HqBadge",props:{tooltip:{}},setup(z){const _=z,M={text:C.MR.t("flat:score.create-modal.instruments.hq-desc"),placement:"top",appendTo:"parent",maxWidth:350},L=(0,t.EW)(()=>j(j({},M),_.tooltip));return(R,W)=>{const A=(0,t.gN)("tooltip");return(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",{ref:"badge",class:(0,c.C4)(R.$style.badge)},[(0,t.eW)((0,c.v_)(R.$t("flat:score.create-modal.instruments.hq")),1)],2)),[[A,L.value]])}}});var x=s(975986),q=s.n(x),G=s(938793);const Z={};Z.$style=q();const st=(0,G.A)(lt,[["__cssModules",Z]])},558948:(b,S,s)=>{"use strict";s.d(S,{A:()=>Re});var t=s(361744),c=s(538065);function C(n,e,o,i,l,u){return(0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)(["score-drawer global-editor score-content",u.cssClasses]),id:"svg-content"},[i.layout==="track"?((0,t.uX)(),(0,t.CE)("div",{key:0,class:(0,c.C4)(n.$style.partHeaderBlock)},[(0,t.Lk)("div",{class:(0,c.C4)(n.$style.hideBlock),ref:"hideBlock"},null,2),((0,t.uX)(),(0,t.CE)("svg",{ref:"partsPanel",class:(0,c.C4)(n.$style.partsPanel),onPointerup:e[0]||(e[0]=(...P)=>u.cyclePartsPanelMode&&u.cyclePartsPanelMode(...P))},null,34))],2)):(0,t.Q3)("",!0),(0,t.Lk)("div",{class:(0,c.C4)(n.$style.partContent),ref:"horizontalScrollable"},[i.layout==="track"?((0,t.uX)(),(0,t.CE)("svg",{key:0,ref:"measuresPanel",class:(0,c.C4)(n.$style.measuresPanel)},null,2)):(0,t.Q3)("",!0),(0,t.Lk)("div",{class:(0,c.C4)(n.$style.pages),ref:"pages"},null,2)],2)],2)}var g=s(653154),p=s(645369),B=s.n(p),N=s(616877),tt=s.n(N),j=s(744056),lt=s(782027),x=s(269352),q=s(669834),G=s(364842),Z=s(737903),F=s(726042),st=s(210888),z=s(475672),_=s(864409),M=s(16602),L=s(380981),R=s(937718),W=s(572520),A=s(779197),J=s(229384),U=s(544582),et=s(870760),$=s(340052);function r(){const n=document,e=n.documentElement,[o]=n.getElementsByTagName("body");return{w:window.innerWidth||e.clientWidth||o.clientWidth,h:window.innerHeight||e.clientHeight||o.clientHeight}}var a=s(257053),f=s(803002),d=s(909696),v=s(599284),T=s(773153),E=s(305392),k=s(506797);const Y=500,ct=500,it=B()("editor:touch");function Bt(n,e){const o=Math.max(e.x-n.x,0,n.x-(e.x+e.width)),i=Math.max(e.y-n.y,0,n.y-(e.y+e.height));return Math.sqrt(o*o+i*i)<=15}class Ot{constructor({scoreActions:e,cursor:o,svgTools:i,rangeSelect:l}){this.scoreActions=e,this.cursor=o,this.adagioCursor=o.adagioCursor,this.svgTools=i,this.rangeSelect=l,this.hadRangeSelect=!1,this.MouseDown=null,this.MouseMoveDown=null,this.Mouseclick=null,this.write=null,this.touchHandlerBound=this.touchHandler.bind(this),this.isScrolling=!1,this.isLongTouch=!1,this.longTouchId=null,this.currentTapData=null,this.previousTapData=null,this.touchMode=null,this.vibrationStore=(0,T.R)()}setHandlers({MouseDown:e,MouseMoveDown:o,Mouseclick:i,write:l}){this.MouseDown=e,this.MouseMoveDown=o,this.Mouseclick=i,this.write=l}touchHandler(e){if(e.touches.length===2)return this.touchMode="pinch",this.touchPinch(e);if(e.type==="touchstart")this.touchMode==="pinch"&&e.touches.length<2&&(it("Stop pinching"),this.touchMode=null),this.touchStartHandler(e);else{if(this.touchMode==="pinch")return e.preventDefault();e.type==="touchmove"?this.touchMoveHandler(e):e.type==="touchend"&&this.touchEndHandler(e)}return null}touchPinch(e){it("touchPinch"),this.disableLongTouch();const o=Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[0].clientY-e.touches[1].clientY)*(e.touches[0].clientY-e.touches[1].clientY));if(e.type==="touchstart"){this.touchPinchDistLast=o;const i=this.cursor.horizontalScrollableElement.getBoundingClientRect();let l=i;this.cursor.verticalScrollableElement!==this.cursor.horizontalScrollableElement&&(l=this.cursor.verticalScrollableElement.getBoundingClientRect());const P=(e.touches[0].clientX+e.touches[1].clientX)/2-i.x;this.percentageX=P/this.cursor.horizontalScrollableElement.clientWidth;const w=(e.touches[0].clientY+e.touches[1].clientY)/2-l.y;this.percentageY=w/this.cursor.verticalScrollableElement.clientHeight}else if(e.type==="touchend")this.touchPinchDistLast=null;else{const i=o-this.touchPinchDistLast;Math.abs(i/10)>1&&(i>0?this.scoreActions.executePublicAction("zoomIn",{percentageX:this.percentageX,percentageY:this.percentageY}):this.scoreActions.executePublicAction("zoomOut",{percentageX:this.percentageX,percentageY:this.percentageY}),this.touchPinchDistLast=o)}e.preventDefault()}touchStartHandler(e){it("touchStartHandler"),this.isScrolling=!1,this.isLongTouch=!1,this.connectedElem=null,this.connectedNotehead=null;const o=f.A.getEventTarget(e);if(!o||!o.classList.contains("adagio-event-rect")&&!this.svgTools.findParent(o,"measure"))return;const i=this.MouseDown.buildElem(e);this.connectEventWithAnchor(i)||this.connectEventWithSelectedElem(i)||(this.connectEventWithSelectedNotehead(e),this.touchStartTimestamp=e.timeStamp,this.touchStartEvent=e,this.startLongTouchTimer(e),this.setMouseOrigin(e),this.recordCurrentTapData())}connectEventWithAnchor(e){const o=e.interacElem,i=(0,v.H)().interactiveElemSet,l=[].slice.apply(o.classList).find(O=>E.AE[O]&&i[O]);if(!l)return!1;const u=this.cursor.colorsVoices,P=new E.AE[l]({elem:o,pos:e.posX,color:u[0],scoreData:this.cursor.interaction.data,adagioCursor:this.adagioCursor,svgTools:this.svgTools,scoreActions:this.scoreActions,touch:this.touch,cursor:this.cursor,rangeSelect:this.rangeSelect});return P.notSelected?!1:(this.formerSelected=this.cursor.selectedElem,this.cursor.setSelected(P),P.highLight(),it("Connect with an anchor: %s",this.cursor.selectedElem.type),this.connectedElem=this.cursor.selectedElem,!0)}connectEventWithSelectedElem(e){const o=e.interacElem;return this.cursor.selectedElem&&this.cursor.selectedElem.elem===o?(it("Connect with selected elem: %s",this.cursor.selectedElem.type),this.connectedElem=this.cursor.selectedElem,!0):!1}connectEventWithSelectedNotehead(e){if(!this.write||this.cursor.noteInfo.isRest)return;const o=this.cursor.getNote();if(!o||!o.head)return;const i={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},l=o.head.getBoundingClientRect();if(!Bt(i,l))return;const u=this.cursor.colorsVoices;this.connectedNotehead=new k.A({elem:o.head,pos:this.cursor.getPositionUuid(),color:u[0],scoreData:this.cursor.interaction.data,svgTools:this.svgTools,scoreActions:this.scoreActions,cursor:this.cursor}),it("Connect with an notehead")}startLongTouchTimer(e){this.longTouchId!==null&&clearTimeout(this.longTouchId),this.longTouchId=setTimeout(()=>{this.longTouchId=null,this.longTouchHandler(e)},Y)}longTouchHandler(e){it("longTouchHandler, starting range selection"),this.isLongTouch=!0;const o=this.MouseDown.buildElem(e);this.cursor.changeFocus(o.posX),this.cursor.clearSelected(),this.rangeSelect.reset(),this.rangeSelect.selectRange(o.posX),this.vibrationStore.vibrate([50])}setMouseOrigin(e){if(e.pageX!==void 0)this.mousex=e.pageX,this.mousey=e.pageY;else if(e.changedTouches&&e.changedTouches.length>0)this.mousex=e.changedTouches[0].pageX,this.mousey=e.changedTouches[0].pageY;else{const o=this.svgTools.getEventTarget(e);this.mousex=this.svgTools.getCoord(o).x,this.mousey=this.svgTools.getCoord(o).y}}recordCurrentTapData(){this.currentTapData={mousex:this.mousex,mousey:this.mmousey,timestamp:Date.now()}}touchMoveHandler(e){if(this.isScrolling){it("touchMoveHandler - scrolling");return}const o={type:"touchmove",pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY,clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,buttons:1,target:document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)};if(!this.hasMoveEnough(o)){this.isScrolling||e.preventDefault();return}if(this.disableDoubleTap(),this.disableLongTouch(),this.connectedNotehead&&!this.isLongTouch&&(this.cursor.setSelected(this.connectedNotehead),this.connectedElem=this.connectedNotehead),this.isLongTouch||this.connectedElem){this.isLongTouch?it("touchMoveHandler - long touch"):it("touchMoveHandler - move connected elem %s",this.connectedElem.type);const i=f.A.getEventTarget(o);(i!=null&&i.classList.contains("adagio-event-rect")||this.svgTools.findParent(i,"measure"))&&(it("touchMoveHandler - calling elem move handler"),this.MouseMoveDown.processEvent(o)),e.preventDefault();return}it("touchMoveHandler - start scrolling"),this.isScrolling=!0}disableDoubleTap(){it("disableDoubleTap"),this.currentTapData=null,this.previousTapData=null}touchEndHandler(e){if(this.isLongTouch||this.isScrolling){it("touchEndHandler - scrolling or long touch"),this.isScrolling=!1,this.isLongTouch=!1,e.preventDefault();return}this.disableLongTouch(),it("touchEndHandler");const o={type:"touchend",pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY,clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,target:document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)};if(this.connectedElem){it("trying to call up handler for %s",this.connectedElem.type);const l=f.A.getEventTarget(o);this.cursor.selectedElem.up&&this.cursor.selectedElem.opts?(this.cursor.selectedElem.up(),this.cursor.clearSelected()):this.cursor.selectedElem&&l&&this.svgTools.findParent(l,this.cursor.selectedElem.type)===this.cursor.selectedElem.elem||(l!=null&&l.classList.contains("adagio-event-rect")||l&&this.svgTools.findParent(l,"measure"))&&this.Mouseclick.processEvent(o,!0),this.connectedElem=null,e.preventDefault();return}if(this.isDoubleTab(e)){this.displayActionMenu(),e.preventDefault();return}this.previousTapData=this.currentTapData;const i=f.A.getEventTarget(e);if(i!=null&&i.classList.contains("adagio-event-rect")||this.svgTools.findParent(i,"measure")){it("Trying to call down handler");const l=!0;this.MouseDown.processEvent(e,l),this.Mouseclick.processEvent(o,l)}else this.write&&(i.classList.contains("part-name")||i.classList.contains("title")||i.classList.contains("subtitle")||i.classList.contains("lyricist")||i.classList.contains("arranger")||i.classList.contains("composer")||i.classList.contains("rights"))?this.MouseDown.select(i):(this.cursor.clearSelected(),this.rangeSelect.reset());e.preventDefault()}disableLongTouch(){this.longTouchId!==null&&(clearTimeout(this.longTouchId),this.longTouchId=null)}isDoubleTab(e){if(!this.previousTapData)return it("no Double tap"),!1;if(Date.now()-this.previousTapData.timestamp>ct)return it("Double tap too slow"),!1;const o=f.A.getEventTarget(e);if(!o.classList.contains("adagio-event-rect")&&!this.svgTools.findParent(o,"measure"))return it("Double tap outside edition parts"),!1;const i=4,l=this.previousTapData.mousex-e.pageX,u=this.previousTapData.mousey-e.pageY;return Math.sqrt(l*l+u*u)>i?(it("Double tap too far"),!1):(it("Double tap detected"),!0)}displayActionMenu(){it("displayActionMenu"),this.rangeSelect.reset(),(0,d.q6)().openActionMenuPaste()}hasMoveEnough(e){const i=this.mousex-e.pageX,l=this.mousey-e.pageY;return Math.sqrt(i*i+l*l)>4}}var It=s(941271),I=s(351277),h=s(610786);const y=["range-select-anchor"],D={"range-select-anchor":h.A};class H{constructor(e,o){this.cursor=e,this.svgTools=o,this.color=this.cursor.colorsVoices[0]}buildElem(e,o){const i={},l=f.A.getEventTarget(e),u=this.svgTools.findParent(l,"measure"),P=this.svgTools.getElementsByClassName(u,"voice");let O;this.cursor.getPositionIdx().voiceIdxInStaff>=P.length?O=P[0]:O=P[this.cursor.getPositionIdx().voiceIdxInStaff];let w=this.svgTools.getElementsByClassName(O,"head");i.headX=this.svgTools.getCloserElem(e,w),i.posX=this.svgTools.findInformation(i.headX);let rt=this.gatherElems(e);this.fillLineOrString(e,i.posX);const Tt=this.getAnchor(e,rt,o);return Tt?i.interacElem=Tt:(rt.length>0&&(w=w.filter(St=>this.svgTools.isPointInsideElem(e,St,o||2))),rt=rt.concat(w),i.interacElem=this.svgTools.getCloserElem(e,rt)),i}getAnchor(e,o,i){return o=o.filter(l=>this.svgTools.isPointInsideElem(e,l,i||2)),o=o.filter(l=>Array.from(l.classList).some(u=>D[u])),o.length===1?o[0]:null}sortPos(e,o){const i=o.posX,l=o.headX,u=o.interacElem;this.cursor.hidden||this.rangeSelect.hasRange()?this.handleNotSamePos(e,u,i):this.touch&&o.interacElem!==o.headX?this.handleNotSamePos(e,u,i):this.cursor.samePos(i)&&this.isEnoughInX(e,l,i)&&this.isBetweenBounds(i)?this.handleSamePos(e,l,i):this.cursor.samePosLeft(i)&&!this.cursor.isLeftPosSlash()&&this.isEnoughInX(e,l,i)&&this.isBetweenBounds(i)?this.handleSameLeftPos(e,l,i):this.handleNotSamePos(e,u,i)}gatherElems(e,o){const i=f.A.getEventTarget(e),l=this.svgTools.findParent(i,"staff");let u=[];return y.forEach(P=>{let O=this.svgTools.getElementsByClassName(l,P);O=[].slice.call(O),u=u.concat(O)},this),u=u.filter(P=>this.svgTools.isPointInsideElem(e,P,o||2)),u}isBetweenBounds(e){return!(typeof e.line!="undefined"&&(e.line>I.default.MAX_LINE||e.line<I.default.MIN_LINE))}handleSamePos(){}handleSameLeftPos(){}handleNotSamePos(){}isEnoughInX(e,o,i){let l=3;return this.svgTools.getBBox(o).width===0&&typeof i.string!="undefined"&&(l=this.svgTools.stringSize),this.svgTools.isEnoughInX(e,o,l)}fillLineOrString(e,o){const i=f.A.getEventTarget(e),l=this.svgTools.findParent(i,"staff");this.svgTools.isTab(l)?o.string=this.svgTools.getLine(e,l):o.line=this.svgTools.getLine(e,l)}fillHeadLineOrString(e,o){const i=this.svgTools.findParent(e,"staff");this.svgTools.isTab(i)?o.string=this.svgTools.getHeadLine(e,i):o.line=this.svgTools.getHeadLine(e,i)}colorElem(e,o){e.style.fill=o}uncolorElem(e){const o=e.getAttribute("data-adagio-note-color");o?e.style.fill=o:e.style.fill=""}}class V extends H{constructor({svgTools:e,cursor:o,rangeSelect:i}){super(o,e),this.rangeSelect=i}processEvent(e,o,i){const l=this.buildElem(e,i);this.touch=o,this.sortPos(e,l);const u=l.posX;this.rangeSelect.hasRange()||(this.cursor.changeFocus(u),(0,It.B)().addExperience("editor.move"))}handleSamePos(e,o,i){const l=o.classList.contains("head-TAB");this.touch&&!l&&this.fillHeadLineOrString(o,i)}handleSameLeftPos(e,o,i){this.handleSamePos(e,o,i,!0)}handleNotSamePos(e,o,i){o.classList.contains("head")&&(typeof i.string=="undefined"&&this.fillHeadLineOrString(o,i),e.shiftKey&&!this.rangeSelect.hasRange()&&this.rangeSelect.selectRange(this.cursor.getPositionUuid(),{refAction:"MouseclickRo",refEvent:e}),e.shiftKey&&this.rangeSelect.selectRange(i,{refAction:"MouseclickRo",refEvent:e}))}}const Q=B()("flat:mouseRO");class at extends H{constructor({svgTools:e,cursor:o,rangeSelect:i}){super(o,e),this.rangeSelect=i}processEvent(e,o,i){this.touch=o;const l=this.buildElem(e,i);this.sortPos(e,l),!e.shiftKeyy&&!l.interacElem.classList.contains("range-select-anchor")&&this.rangeSelect.reset()}handleNotSamePos(e,o,i){![].slice.apply(o.classList).find(u=>D[u])||!this.svgTools.isPointInsideElem(e,o,2)?this.cursor.clearSelected():(this.select(o,i),e.stopPropagation(),e.preventDefault())}select(e){const o=Array.from(e.classList).find(l=>D[l]);if(!o)return Q("actions to interact with selected elements are note enabled"),null;const i=new D[o]({elem:e,color:this.color[0],scoreData:this.cursor.interaction.data,adagioCursor:this.adagioCursor,svgTools:this.svgTools,scoreActions:this.scoreActions,touch:this.touch,cursor:this.cursor,rangeSelect:this.rangeSelect});return i.notSelected?Q("instance returned notSelected, skip cursor selection"):(this.cursor.setSelected(i),i.highLight()),i}}class _t extends H{constructor({cursor:e,svgTools:o}){super(e,o),this.highlightElem=null}processEvent(e,o){const i=this.buildElem(e,o);this.updateHighlightElem(i.headX)}updateHighlightElem(e){this.cleanHighlightElem(),this.colorElem(e,this.color),this.highlightElem=e}cleanHighlightElem(){const e=this.cursor.getNote();this.highlightElem&&this.svgTools.isStillInDom(this.highlightElem)&&(e===null||this.highlightElem!==e.head)&&this.uncolorElem(this.highlightElem),this.highlightElem=null}}class Pt extends H{constructor({cursor:e,svgTools:o,rangeSelect:i}){super(e,o),this.rangeSelect=i}processEvent(e,o){const i=this.buildElem(e,o);this.cursor.adagioCursor.removeCursor(),this.cursor.selectedElem&&typeof this.cursor.selectedElem.move!="undefined"?this.cursor.selectedElem.move(i,{refAction:"MouseMoveDownRo",refEvent:e}):this.rangeSelect.selectRange(i.posX,{refAction:"MouseMoveDownRo",refEvent:e})}}var Ct=s(878363),Mt=s(121648),Kt=s(414787),wt=s(292681),gt=s(851023),dt=s(349860),Dt=s(602494);function At(n){let e;e||(e=n.getAttribute("data-onboarding-color")),e||(e=n.getAttribute("data-adagio-note-color")),e?n.style.fill=e:n.style.fill=""}function Lt(n){let e;e||(e=n.getAttribute("data-onboarding-opacity")),e||(e=n.getAttribute("data-adagio-key-opacity")),e?n.style.opacity=e:n.style.opacity=1}function pt(n){let e;e||(e=n.getAttribute("data-onboarding-transition")),e&&setTimeout(()=>{n.style.transition=e},16)}class mt{constructor(e,o,i){this.cursor=e,this.svgTools=o,this.rangeSelect=i,this.color=this.cursor.colorsVoices}buildElem(e,o){const i={};let l;const u=f.A.getEventTarget(e),P=this.svgTools.findParent(u,"measure");let O=this.svgTools.getElementsByClassName(P,"voice");this.cursor.getPositionIdx().voiceIdxInStaff>=O.length?O=O[0]:O=O[this.cursor.getPositionIdx().voiceIdxInStaff],l=this.svgTools.getElementsByClassName(O,"head"),i.headX=this.svgTools.findNearestHeadX(e,O),i.posX=this.svgTools.findInformation(i.headX),i.isLeftOfNote=this.svgTools.isLeftOfNote(e,i.headX);let w=this.gatherElems(e);this.fillLineOrString(e,i.posX);const rt=this.getAnchor(e,w,o);return rt?i.interacElem=rt:(w.length>0&&(l=l.filter(Tt=>this.svgTools.isPointInsideElem(e,Tt,o||2))),w=w.concat(l),i.interacElem=this.svgTools.getCloserElem(e,w)),this.ensureLargeLyricsEdgeCase(e,i),i}getAnchor(e,o,i){return o=o.filter(l=>this.svgTools.isPointInsideElem(e,l,i||2)),o=o.filter(l=>Array.from(l.classList).some(u=>E.AE[u])),o.length===1?o[0]:null}ensureLargeLyricsEdgeCase(e,o){if(!o.interacElem.classList.contains("lyricLine"))return;const i=this.svgTools.findParent(o.interacElem,"lyric");o.posX.noteIdx=Number.parseInt(i.getAttribute("data-adagio-note-idx"),10)||o.posX.noteIdx}sortPos(e,o){const i=o.posX,l=o.headX,u=o.interacElem;this.cursor.hidden||this.rangeSelect.hasRange()||(0,Mt.W)().textMode?this.handleNotSamePos(e,u,i):(0,v.H)().tbAddNoteEnabled?this.touch&&o.interacElem!==o.headX?this.handleNotSamePos(e,u,i):this.cursor.samePos(i)&&this.isEnoughInX(e,l,i)&&this.isBetweenBounds(i)?this.handleSamePos(e,l,i):this.cursor.config.get().editionMode===Dt.i&&this.cursor.samePos(i)&&o.isLeftOfNote?this.handleSamePos(e,l,i):this.cursor.config.get().editionMode===Dt.xU&&this.cursor.samePosLeft(i)&&!this.cursor.isLeftPosSlash()&&this.isEnoughInX(e,l,i)&&this.isBetweenBounds(i)?this.handleSameLeftPos(e,l,i):this.handleNotSamePos(e,u,i):this.handleNotSamePos(e,u,i)}gatherElems(e,o){const i=f.A.getEventTarget(e),l=this.svgTools.findParent(i,"staff");let u=[];return E.Mt.forEach(P=>{if(!(0,v.H)().interactiveElemSet[P])return;let O=this.svgTools.getElementsByClassName(l,P);O=[].slice.call(O),u=u.concat(O)},this),u=u.filter(P=>this.svgTools.isPointInsideElem(e,P,o||2)),u}isBetweenBounds(e){return!(typeof e.line!="undefined"&&(e.line>I.default.MAX_LINE||e.line<I.default.MIN_LINE))}getNoteAtLine(e,o){if(!e.isRest&&typeof o!="undefined"){for(let i=0;i<e.lines.length;i++)if(e.lines[i]===o)return i}return null}handleSamePos(){}handleNotSamePos(){}isEnoughInX(e,o,i){let l=3;return this.svgTools.getBBox(o).width===0&&typeof i.string!="undefined"&&(l=this.svgTools.stringSize),this.svgTools.isEnoughInX(e,o,l)}buildUnpitchedArgs(e){let o=null;const{scoreData:i}=this.cursor.interaction,l=(0,gt.A)(i.adagioData,e),u=Kt.A.lineToPitch(e.line,l.nbStaffLines),P=wt.default.stringify(u),O=l.pitchMapping[P];if(typeof O!="undefined"){const w=(0,Mt.W)().upcomingAttributes.unpitchedHead;w&&O[w]?o=w:o=O.default}return o}fillLineOrString(e,o){const i=f.A.getEventTarget(e),l=this.svgTools.findParent(i,"staff");l&&(this.svgTools.isTab(l)?o.string=this.svgTools.getLine(e,l):o.line=this.svgTools.getLine(e,l))}fillHeadLineOrString(e,o){const i=this.svgTools.findParent(e,"staff");this.svgTools.isTab(i)?o.string=this.svgTools.getHeadLine(e,i):o.line=this.svgTools.getHeadLine(e,i)}colorElem(e,o){e.style.transition="none",e.style.fill=o,e.style.opacity=1}getGoodColor(e,o){return e.classList[0]==="head"?this.cursor.getColorVoiceUuid(o):this.color[0]}checkAndColorLine(e,o){(0,dt.b9)(e,o)}checkAndCleanLine(e){(0,dt.$2)(e)}checkAndColorStroke(e,o){(0,dt.hL)(e,o)}checkAndCleanStroke(e){(0,dt.l0)(e)}uncolorElem(e){At(e),Lt(e),pt(e)}}class yt extends mt{constructor({svgTools:e,cursor:o,scoreActions:i,rangeSelect:l,adagioCursor:u,mouseCtx:P}){super(o,e,l),this.scoreActions=i,this.adagioCursor=u,this.mouseCtx=P}processEvent(e,o,i){const l=this.buildElem(e,i);this.touch=o,this.sortPos(e,l)}handleSamePos(e,o,i,l){const u=o.classList.contains("head-TAB"),P=this.touch&&!u;if(this.rangeSelect.hasRange()||this.mouseCtx.hadRangeSelect||(0,Mt.W)().textMode)return;const w=this.cursor.getNote();if(w!==null&&this.isNoteMmr(w.note))return;let rt;if(!l)rt=this.cursor.noteInfo;else{const St=Object.assign({},i);St.isConcertPitch=this.cursor.isConcertPitch,rt=this.cursor.interaction.data.getNoteData(St)}let Tt="normal";P&&this.fillHeadLineOrString(o,i),this.cursor.staffStyle==="unpitched"&&(Tt=this.buildUnpitchedArgs(i)),typeof i.string!="undefined"?this.changeFocusAndPlay(i):!P&&this.isBetweenBounds(i)&&this.getNoteAtLine(rt,i.line)===null?typeof Tt=="string"&&((0,It.B)().addExperience("editor.addnote.mouse"),l?this.scoreActions.executePublicAction("addPreviousNoteAtLine",{line:i.line,source:Ct.default.MOUSE}):this.scoreActions.executePublicAction("addNoteAtLine",{head:Tt,line:i.line,validateUnpitchedMapping:!0,source:Ct.default.MOUSE})):this.changeFocusAndPlay(i),this.adagioCursor.removeCursor()}isNoteMmr(e){return Array.from(e.classList).includes("multiMeasureRest")}handleSameLeftPos(e,o,i){this.handleSamePos(e,o,i,!0)}handleNotSamePos(e,o,i){(o.classList.contains("head")||o.classList.contains("notehead-anchor"))&&(typeof i.string=="undefined"&&this.fillHeadLineOrString(o,i),e.shiftKey&&!this.rangeSelect.hasRange()&&this.rangeSelect.selectRange(this.cursor.getPositionUuid(),{refAction:"Mouseclick",refEvent:e}),this.changeFocusAndPlay(i),e.shiftKey&&this.rangeSelect.selectRange(i,{refAction:"Mouseclick",refEvent:e}))}changeFocusAndPlay(e){var o;this.cursor.changeFocus(e),(0,It.B)().addExperience("editor.move"),(o=this.cursor.interaction)!=null&&o.audio&&this.cursor.interaction.audio.playNote(e)}}const bt=B()("flat:mouse");class Vt extends mt{constructor({svgTools:e,cursor:o,adagioCursor:i,scoreActions:l,rangeSelect:u}){super(o,e,u),this.adagioCursor=i,this.scoreActions=l}processEvent(e,o,i){this.touch=o;const l=this.buildElem(e,i);this.sortPos(e,l),!e.shiftKey&&!l.interacElem.classList.contains("range-select-anchor")&&this.rangeSelect.reset()}handleSamePos(e,o,i){this.svgTools.isPointInsideElem(e,o,2)?(this.select(o,i),e.stopPropagation(),e.preventDefault()):this.cursor.clearSelected()}handleSameLeftPos(e,o,i){this.handleSamePos(e,o,i)}handleNotSamePos(e,o,i){const l=(0,v.H)().interactiveElemSet;![].slice.apply(o.classList).find(P=>E.zv[P]&&l[P])||!this.svgTools.isPointInsideElem(e,o,2)?this.cursor.clearSelected():(this.select(o,i),e.stopPropagation(),e.preventDefault())}select(e,o){const i=(0,v.H)().interactiveElemSet,l=[].slice.apply(e.classList).find(P=>E.zv[P]&&i[P]);if(!l)return bt("actions to interact with selected elements are not enabled"),null;const u=new E.zv[l]({elem:e,pos:o,color:this.color[0],scoreData:this.cursor.interaction.data,adagioCursor:this.adagioCursor,svgTools:this.svgTools,scoreActions:this.scoreActions,touch:this.touch,cursor:this.cursor,rangeSelect:this.rangeSelect});return u.notSelected?bt("instance returned notSelected, skip cursor selection"):(this.cursor.setSelected(u),u.highLight()),u}}var Xt=s(668674),Ft=s(353922),$t=Object.defineProperty,nt=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable,kt=(n,e,o)=>e in n?$t(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,jt=(n,e)=>{for(var o in e||(e={}))ft.call(e,o)&&kt(n,o,e[o]);if(nt)for(var o of nt(e))Ut.call(e,o)&&kt(n,o,e[o]);return n};class ce extends mt{constructor({cursor:e,svgTools:o,adagioCursor:i,rangeSelect:l}){super(e,o,l),this.adagioCursor=i,this.highlightElem=null}processEvent(e,o){this.destroyUnpitchedTooltip();const i=this.buildElem(e,o);this.sortPos(e,i)}handleNotSamePos(e,o,i){this.adagioCursor.removeCursor(),this.updateHighlightElem(o,i)}handleSamePos(e,o,i,l){let u;this.cleanHighlightElem();const P=this.getSlash(i),O=this.cursor.getNote();if(O!==null&&this.isNoteMmr(O.note)){this.adagioCursor.removeCursor();return}P!==null?u=this.drawSlashCursor(e,i,l):this.cursor.staffStyle==="unpitched"?u=this.drawUnpitchedCursor(e,i,l):typeof i.string!="undefined"?u=this.drawStringCursor(e,i,l):u=this.drawClassicCursor(e,i,l),u?this.colorElem(u.elem,this.color[this.cursor.getPositionIdx().voiceIdxInStaff]):this.adagioCursor.removeCursor()}isNoteMmr(e){return Array.from(e.classList).includes("multiMeasureRest")}getSlash(e){return this.cursor.getPositionUuid().measureUuid===e.measureUuid?this.cursor.measureInfo.slash:(e=JSON.parse(JSON.stringify(e)),this.adagioCursor.getScoreData().getStaffMeasure(e).slash)}handleSameLeftPos(e,o,i){this.handleSamePos(e,o,i,!0)}drawClassicCursor(e,o,i){const l=this.adagioCursor.getScoreData(),u=i?l.getNoteData(jt({},this.cursor.leftPos)).durationType:this.cursor.currentDuration.durationType;if(typeof o.graceIdx!="undefined"&&o.graceIdx!==null)return this.adagioCursor.drawGraceCursor(o,u);const P=this.cursor.config.get().editionMode===Dt.i;return this.adagioCursor.drawNoteCursor(o,u,0,P)}drawSlashCursor(e,o,i){if(!Xt.A.isUsingStems(this.cursor.measureInfo.slash))return null;const l=this.adagioCursor.getScoreData(),u=i?l.getNoteData(jt({},this.cursor.leftPos)).durationType:this.cursor.currentDuration.durationType,P=3,O=Ft.A.SLASH;return this.adagioCursor.drawPercuCursor(o,{line:P,durationType:u,notehead:O})}drawUnpitchedCursor(e,o,i){const l=this.buildUnpitchedArgs(o),u=this.adagioCursor.getScoreData(),P=i?u.getNoteData(jt({},this.cursor.leftPos)).durationType:this.cursor.currentDuration.durationType;let O;return l&&(typeof o.graceIdx=="undefined"?O=this.adagioCursor.drawPercuCursor(o,{line:o.line,durationType:P,notehead:l}):O=this.adagioCursor.drawGracePercuCursor(o,{line:o.line,durationType:P,notehead:l})),O?(this.createUnpitchedTooltip(o.line),O):null}createUnpitchedTooltip(e){let o;this.cursor.cursorDrawer.polygone?o=this.cursor.cursorDrawer.polygone.elem:o=this.cursor.cursorDrawer.group.elem,this.destroyUnpitchedTooltip(),(0,d.q6)().openUnpitchedTooltip({elem:o,line:e})}drawStringCursor(e,o,i){o.fretData={string:o.string,fret:0};const l=this.adagioCursor.getScoreData(),u=i?l.getNoteData(jt({},this.cursor.leftPos)).durationType:this.cursor.currentDuration.durationType;return this.adagioCursor.drawTabCursorByFret(o,u,this.cursor.currentDuration.nbDots)}updateHighlightElem(e,o){if(this.cleanHighlightElem(),!this.isSelectedElem(e)&&!this.isAuthorized(e)){const i=this.getGoodColor(e,o);this.colorElem(e,i),this.checkAndColorLine(e,i),this.checkAndColorStroke(e,i),this.highlightElem=e}}cleanHighlightElem(){const e=this.cursor.getNote();this.highlightElem&&this.svgTools.isStillInDom(this.highlightElem)&&!this.isSelectedElem(this.highlightElem)&&!this.isSelectedMmr(e,this.highlightElem)&&(e===null||this.highlightElem!==e.head)&&(this.uncolorElem(this.highlightElem),this.checkAndCleanLine(this.highlightElem),this.checkAndCleanStroke(this.highlightElem)),this.highlightElem=null}isSelectedMmr(e,o){if(!e)return!1;const{note:i}=e;return!i||!Array.from(i.classList).includes("multiMeasureRest")?!1:i===o.parentElement}isSelectedElem(e){var o;const{selectedElem:i}=this.cursor;return i?!!(i.elem===e||(o=i.elems)!=null&&o.includes(e)):!1}isAuthorized(e){return e.classList[0].includes("anchor")}destroyUnpitchedTooltip(){(0,d.q6)().closeUnpitchedTooltip()}}class ue extends mt{constructor({cursor:e,svgTools:o,rangeSelect:i}){super(e,o,i)}processEvent(e,o){const i=this.buildElem(e,o);this.cursor.adagioCursor.removeCursor(),this.cursor.selectedElem&&typeof this.cursor.selectedElem.move!="undefined"?this.cursor.selectedElem.move(i,{refAction:"MouseMoveDown",refEvent:e}):this.rangeSelect.selectRange(i.posX,{refAction:"MouseMoveDown",refEvent:e})}}class he{constructor({scoreActions:e,cursor:o,svgTools:i,rangeSelect:l}){this.scoreActions=e,this.cursor=o,this.adagioCursor=o.adagioCursor,this.svgTools=i,this.rangeSelect=l,this.hadRangeSelect=!1,this.mousemoveBound=this.mousemove.bind(this),this.mousedownBound=this.mousedown.bind(this),this.mouseupBound=this.mouseup.bind(this),this.mouseoutBound=this.mouseout.bind(this),this.dblclickBound=this.dblclick.bind(this),this.touch=new Ot({scoreActions:e,cursor:o,svgTools:i,rangeSelect:l}),this.touchHandlerBound=this.touch.touchHandlerBound}buildRw(){this.Mousemove=new ce({cursor:this.cursor,svgTools:this.svgTools,adagioCursor:this.adagioCursor,rangeSelect:this.rangeSelect}),this.Mouseclick=new yt({cursor:this.cursor,svgTools:this.svgTools,scoreActions:this.scoreActions,rangeSelect:this.rangeSelect,adagioCursor:this.adagioCursor,mouseCtx:this}),this.MouseDown=new Vt({cursor:this.cursor,svgTools:this.svgTools,scoreActions:this.scoreActions,adagioCursor:this.adagioCursor,rangeSelect:this.rangeSelect}),this.MouseMoveDown=new ue({cursor:this.cursor,svgTools:this.svgTools,scoreActions:this.scoreActions,rangeSelect:this.rangeSelect}),this.updateTouchHandlers()}buildRo(){this.Mousemove=new _t({cursor:this.cursor,svgTools:this.svgTools}),this.Mouseclick=new V({cursor:this.cursor,svgTools:this.svgTools,rangeSelect:this.rangeSelect}),this.MouseDown=new at({cursor:this.cursor,svgTools:this.svgTools,rangeSelect:this.rangeSelect}),this.MouseMoveDown=new Pt({cursor:this.cursor,svgTools:this.svgTools,scoreActions:this.scoreActions,rangeSelect:this.rangeSelect}),this.updateTouchHandlers()}updateTouchHandlers(){this.touch.setHandlers({write:this.write,MouseDown:this.MouseDown,Mouseclick:this.Mouseclick,MouseMoveDown:this.MouseMoveDown})}setRight(e){this.write=e,e?this.buildRw():this.buildRo()}mousemove(e){const o=f.A.getEventTarget(e);(o!=null&&o.classList.contains("adagio-event-rect")||this.svgTools.findParent(o,"measure"))&&(e.buttons===1&&this.hasMoveEnough(e)?this.MouseMoveDown.processEvent(e):this.Mousemove.processEvent(e))}mousedown(e,o){this.hadRangeSelect=this.rangeSelect.hasRange();const i=f.A.getEventTarget(e);i!=null&&i.classList.contains("adagio-event-rect")||this.svgTools.findParent(i,"measure")?(this.MouseDown.processEvent(e,o),this.setMouseOrigin(e)):this.write&&(i.classList.contains("part-name")||i.classList.contains("title")||i.classList.contains("subtitle")||i.classList.contains("lyricist")||i.classList.contains("arranger")||i.classList.contains("composer")||i.classList.contains("rights"))?this.MouseDown.select(i):o&&this.cursor.selectedElem&&this.cursor.clearSelected()}mouseup(e,o){var i;const l=f.A.getEventTarget(e);(i=this.cursor.selectedElem)!=null&&i.up&&this.cursor.selectedElem.opts?(this.cursor.selectedElem.up(),this.cursor.clearSelected()):this.cursor.selectedElem&&l&&this.svgTools.findParent(l,this.cursor.selectedElem.type)===this.cursor.selectedElem.elem||(l!=null&&l.classList.contains("adagio-event-rect")||l&&this.svgTools.findParent(l,"measure"))&&this.Mouseclick.processEvent(e,o),this.mousex=0,this.mousey=0,this.hadRangeSelect=this.rangeSelect.hasRange()}mouseover(){}mouseout(e){const{relatedTarget:o}=e;(o===null||!this.svgTools.svgContent||!this.svgTools.svgContent.contains(o))&&e.buttons!==1&&this.cursor.selectedElem&&this.cursor.selectedElem.up&&this.cursor.selectedElem.opts&&(this.cursor.selectedElem.up(),this.cursor.clearSelected())}dblclick(){}hasMoveEnough(e){const i=this.mousex-e.pageX,l=this.mousey-e.pageY;return Math.sqrt(i*i+l*l)>4}setMouseOrigin(e){if(e.pageX!==void 0)this.mousex=e.pageX,this.mousey=e.pageY;else if(e.changedTouches&&e.changedTouches.length>0)this.mousex=e.changedTouches[0].pageX,this.mousey=e.changedTouches[0].pageY;else{const o=this.svgTools.getEventTarget(e);this.mousex=this.svgTools.getCoord(o).x,this.mousey=this.svgTools.getCoord(o).y}}}var fe=s(88247),Qt=s(591340);const ge=`M17.991 1.8c0-.99-.801-1.8-1.791-1.8H1.8C.81 0 0 .81 0 1.8v10.8c0 .99.81 1.8 1.8
1.8h12.6L18 18l-.009-16.2Zm-4.491 9h-9a.903.903 0 0 1-.9-.9c0-.495.405-.9.9-.9h9c.495 0
.9.405.9.9s-.405.9-.9.9Zm0-2.7h-9a.903.903 0 0 1-.9-.9c0-.495.405-.9.9-.9h9c.495 0
.9.405.9.9s-.405.9-.9.9Zm0-2.7h-9a.903.903 0 0 1-.9-.9c0-.495.405-.9.9-.9h9c.495 0 .9.405.9.9s-.405.9-.9.9Z`,pe="var(--f-score-selection, var(--f-primary-30))",Jt=.7;function me(n,e){return n.uuidToIdx(e)}function Zt(){const n=new x.A("circle");return n.attr("r",9),n.style("stroke-width",2).style("opacity",1).style("fill","none").style("stroke","var(--f-score-voice-0)").style("pointer-events","none"),n}function qt(n){const e=()=>{n.style("fill","none"),document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e)};document.addEventListener("mouseup",e),document.addEventListener("touchend",e)}function te(n,e,o){return n.getMeasureEnclosingStaffElem(o.partIdx,o.staffIdx,e.startMeasureIdx)}function ve(n,e,o){return n.getSpaceAboveStaff(o.partIdx,o.staffIdx,e.startMeasureIdx)}function ee(n,e,o){return n.getStaffInnerHeight(o.partIdx,o.staffIdx,e.startMeasureIdx)}function ye(n,e,{partIdx:o,staffIdx:i}){const l=e.startMeasureIdx;let u=n.getMeasurePosXInStaff(o,l);if(typeof e.startTimePos!="undefined"){const P=n.getTimePosXInMeasure(o,i,l,e.startTimePos,e.startDpq);u+=P;const O=n.getSpaceSize()*Jt;u-=O}return u}function se(n,e,{partIdx:o,staffIdx:i}){const l=e.stopMeasureIdx;let u=n.getMeasurePosXInStaff(o,l);if(typeof e.stopTimePos!="undefined"){const P=n.getTimePosXInMeasure(o,i,l,e.stopTimePos,e.stopDpq);u+=P;const O=n.getSpaceSize()*Jt;u-=O}else{const P=n.getMeasureWidth(o,l);u+=P}return u}function _e(n){n.removeFromParent()}class Ee{constructor(e){this.rects=[],this.anchors=[],this.anchorsPositions=[],this.pulledAnchor=null,this.topRightStaff=null,this.topRightX=null,this.topRightY=null,this.interaction=e,this.adagioDrawer=null,this.position=null,this.icon=null,this.iconDisplayed=!1}setAdagioDrawer(e){this.adagioDrawer=e}reset(){this.cleanRect(),this.position=null,this.interaction.closeInlinePopover&&this.interaction.closeInlinePopover()}setAnchorsPositions(e){this.anchorsPositions=e.map(o=>me(this.adagioDrawer,o))}setPulledAnchor(e){this.pulledAnchor=e}setPosition(e){this.position=e,this.refresh()}refresh(){this.cleanRect(),this.position&&this.adagioDrawer&&(this.drawRects(),this.isTouch()?this.openActionMenu():this.useIcon()&&this.bindIcon())}isTouch(){return typeof document!="undefined"&&"ontouchstart"in document}openActionMenu(){(0,d.q6)().openActionMenuRange()}closeActionMenu(){(0,d.q6)().closeActionMenuRange()}useIcon(){return(0,Qt.U)().env==="editor"&&(0,fe.O)().canCreateNewCommentsThread&&(0,d.q6)().isCloudScore}cleanRect(){this.rects.forEach(_e),this.rects=[],this.topRightStaff=null,this.topRightX=null,this.topRightY=null,this.anchors.forEach(_e),this.anchors=[],this.icon&&this.iconDisplayed&&(this.icon.removeFromParent(),this.iconDisplayed=!1),this.closeActionMenu()}drawRects(){const e={startMeasureIdx:this.position.startMeasureIdx,stopMeasureIdx:this.position.stopMeasureIdx},o=this.adagioDrawer.splitMeasuresRangeBySlices(e);this.rectBoundsList=o.map(this.sliceToRectBounds,this),this.position.partsStaves.forEach(this.drawPartStaff,this)}sliceToRectBounds(e,o,i){const l=o===0,u=o===i.length-1,P={startMeasureIdx:e.startMeasureIdx,stopMeasureIdx:e.stopMeasureIdx};return l&&(P.startTimePos=this.position.startTimePos,P.startDpq=this.position.startDpq),u&&(P.stopTimePos=this.position.stopTimePos,P.stopDpq=this.position.stopDpq),P}drawPartStaff(e,o){if(this.partStaffIdx=o,this.partRectBoundsList=this.rectBoundsList.filter(this.isSystemDisplayed,this),this.partRectBoundsList.forEach(this.drawRect,this),o===0){const i=this.rects.length;this.topRightRect=this.rects[i-1]}}isSystemDisplayed(e){const o=this.position.partsStaves[this.partStaffIdx];return te(this.adagioDrawer,e,o)!==null}drawAnchors(e,o,i){const u=this.position.partsStaves[this.partStaffIdx],P=this.anchorsPositions[0].measureIdx===e.startMeasureIdx&&this.anchorsPositions[0].partIdx===u.partIdx&&this.anchorsPositions[0].staffIdx===u.staffIdx,O=this.anchorsPositions[1].measureIdx===e.stopMeasureIdx&&this.anchorsPositions[1].partIdx===u.partIdx&&this.anchorsPositions[1].staffIdx===u.staffIdx;if(P){const w=Zt();this.pulledAnchor==="left"&&(qt(w),w.style("fill","var(--f-score-voice-0)")),w.attr("class","range-select-anchor left"),w.attr("transform",`translate(${i.left-5}, ${i.top})`),o.node().append(w.node()),this.anchors.push(w)}if(O){const w=Zt();this.pulledAnchor==="right"&&(qt(w),w.style("fill","var(--f-score-voice-0)")),w.attr("class","range-select-anchor right"),w.attr("transform",`translate(${i.right+5}, ${i.top})`),o.node().append(w.node()),this.anchors.push(w)}}drawRect(e,o){var i;const l=this.position.partsStaves[this.partStaffIdx],u=te(this.adagioDrawer,e,l),P=ve(this.adagioDrawer,e,l),O=ee(this.adagioDrawer,e,l),w=ye(this.adagioDrawer,e,l),rt=se(this.adagioDrawer,e,l),Tt=rt-w,St=new x.A("rect");St.attr("class","selection-rect").attr("x",w).attr("width",Tt).attr("y",P).attr("height",O).attr("rx",2).attr("fill",pe).style("mix-blend-mode","darken").style("pointer-events","none"),u.node().append(St.node()),this.rects.push(St),this.isTopRight(o)&&(this.topRightStaff=u,this.topRightX=rt,this.topRightY=P),(i=this.anchorsPositions)!=null&&i.length&&this.drawAnchors(e,u,{left:w,right:rt,top:P+O/2})}isTopRight(e){return this.partStaffIdx===0&&e===this.partRectBoundsList.length-1}bindIcon(){if(this.topRightStaff===null)return;const e=this.getIcon();this.topRightStaff.append(e);const i=8;e.attr("transform",`translate(${this.topRightX+i}, ${this.topRightY-i-5})`);const l=this.iconPath.node().getBBox(),u=-l.x-l.width/2,P=-l.y-l.height/2;this.iconPath.attr("transform",`translate(${u}, ${P})`),this.iconDisplayed=!0}getIcon(){if(this.icon===null){this.icon=new x.A("g");const e=new x.A("circle"),o=new x.A("path");this.icon.append(e),this.icon.append(o),o.attr("d",ge),e.attr("id","inline-comment-icon-container").attr("r",20).attr("fill","white").attr("stroke","#EAEAEC"),o.attr("fill","#2F3446"),o.attr("class","range-inline-comment-icon"),this.iconPath=o;const i=u=>{(0,d.q6)().openInlineCommentPopover(),u.stopPropagation()},l=this.icon.node();l.addEventListener("click",i,!0),l.addEventListener("touchstart",i,!0)}return this.icon}}var Pe=s(472838),oe=s(342023);const Se="2px";class Me{constructor(e,o,i){this.partUuid=e,this.interaction=o,this.color=i,this.posX=null,this.height=null,this.system=null,this.svgLine=null}setMeasureData(e){const o=e.partsMap.get(this.partUuid);if(o!==this.system){this.system=o;const i=o.getContentGroup(),l=this.getSvgLine();i.append(l),this.posX=null,this._tryUpdateHeight()}}setPosX(e){if(e!==this.posX){this.posX=e;const o=this.getSvgLine(),l=this.interaction.svgTools.svg[0].node().createSVGTransform();l.setTranslate(e,0),o.node().transform.baseVal.initialize(l),this._tryUpdateHeight()}}_tryUpdateHeight(){const e=this.system.getHeight();e!==this.height&&(this.height=e,this.getSvgLine().attr("y2",e))}destroy(){this.svgLine!==null&&(this.svgLine.removeFromParent(),this.svgLine=null,this.system=null)}getElem(){return this.getSvgLine()}getSvgLine(){return this.svgLine===null&&(this.svgLine=new oe.default("line"),this.svgLine.attr("x1",0),this.svgLine.attr("x2",0),this.svgLine.attr("y1",0),this.svgLine.attr("stroke-width",Se),this.svgLine.attr("stroke",this.color),this.svgLine.attr("style","will-change: transform"),this.svgLine.attr("data-cy","audio-slider-line")),this.svgLine}}const De="2px",Ce="4px";class ie{constructor(e,o,i){this.partUuid=e,this.interaction=o,this.color=i,this.posX=null,this.height=null,this.system=null,this.svgRectangle=null,this.measures=null}setMeasureData(e){const o=e.partsMap.get(this.partUuid);if(o!==this.system){this.system=o;const i=o.getContentGroup(),l=this.getSvgRectangle();i.append(l),this.posX=null;const u=o.content.getStaff(0);this.measures=u.measures.map(P=>({width:P.getWidth(),pos:P.getXPos()})),this._tryUpdateHeight()}}setPosX(e){const o=this._findMeasure(e);if(e=o.pos,e!==this.posX){this.posX=e;const i=this.getSvgRectangle(),u=this.interaction.svgTools.svg[0].node().createSVGTransform();u.setTranslate(e,0),i.node().transform.baseVal.initialize(u),i.attr("width",o.width),this._tryUpdateHeight()}}_findMeasure(e){const o=this.measures.findIndex(i=>i.pos>e);return o<0?this.measures[this.measures.length-1]:this.measures[o-1]}_tryUpdateHeight(){const e=this.system.getHeight();e!==this.height&&(this.height=e,this.getSvgRectangle().attr("height",e))}destroy(){this.svgRectangle!==null&&(this.svgRectangle.removeFromParent(),this.svgRectangle=null,this.system=null)}getElem(){return this.getSvgRectangle()}getSvgRectangle(){return this.svgRectangle===null&&(this.svgRectangle=new oe.default("rect"),this.svgRectangle.attr("x",0),this.svgRectangle.attr("y",0),this.svgRectangle.attr("width",0),this.svgRectangle.attr("height",0),this.svgRectangle.attr("rx",Ce),this.svgRectangle.attr("stroke-width",De),this.svgRectangle.attr("stroke",this.color),this.svgRectangle.attr("fill","none"),this.svgRectangle.attr("style","will-change: transform")),this.svgRectangle}}var Ae=(n,e,o)=>new Promise((i,l)=>{var u=w=>{try{O(o.next(w))}catch(rt){l(rt)}},P=w=>{try{O(o.throw(w))}catch(rt){l(rt)}},O=w=>w.done?i(w.value):Promise.resolve(w.value).then(u,P);O((o=o.apply(n,e)).next())});const xt=B()("flat:slider"),re=1;function Te({currentMeasure:n,nextMeasure:e,quarterFromMeasureStart:o}){if(!F.default.isInteger(n)||n<0)throw new Error(`Invalid measureIdx :<${n}>`);if(typeof e!="undefined"&&e!==null&&(!F.default.isInteger(e)||e<0))throw new Error(`Invalid nextMeasureIdx :<${e}>`);if(!F.default.isNumber(o)||o<0)throw new Error(`Invalid quarterFromMeasureStart: <${o}>`)}class ae{constructor(e,o,i){const l=(0,d.q6)();this.interaction=e,this.scoreDrawer=o,this.lowCpu=i,this.mobileMode=l.displayMobileEditor,this.color=e.colorSlider||"var(--f-primary)",this.measureDataMap=new Map,this.linesMap=new Map,this.drawnMeasureIdx=null,this.scrollingToMeasureIdx=null,this.rafQueued=!1,this.topPartUuid=null,this.measureIdx=null,this.nextMeasureIdx=null,this.quarterTimePos=null,this.editionId=null,this.scrollHandler=this._humanScroll.bind(this),this.autoScroll=!0,this.nbMeasuresWithoutAutoScroll=0}_humanScroll(){xt("_humanScroll()"),this.autoScroll=!1,this.nbMeasuresWithoutAutoScroll=0}loadSlider(e,o,i){return xt("loadSlider())"),!this.interaction.svgTools.svg||!e?-1:(e!==this.drawer&&(this.drawer=e,this._clearCache()),this.verticalScrollable=o,this.verticalScrollable.addEventListener("mousewheel",this.scrollHandler),this.verticalScrollable.addEventListener("DOMMouseScroll",this.scrollHandler),this.verticalScrollable.addEventListener("touchmove",this.scrollHandler),this.horizontalScrollable=i,this.horizontalScrollable!==this.verticalScrollable&&(this.horizontalScrollable.addEventListener("mousewheel",this.scrollHandler),this.horizontalScrollable.addEventListener("DOMMouseScroll",this.scrollHandler),this.horizontalScrollable.addEventListener("touchmove",this.scrollHandler)),this.autoScroll=!0,this.nbMeasuresWithoutAutoScroll=0,(0,Qt.U)().env==="embed"&&o.offsetHeight<600&&(this.mobileMode=!0),0)}updateLineThrottled(e){return Ae(this,null,function*(){return this.currentTime=e,this.rafQueued?!0:(this.rafQueued=!0,yield(0,Pe.default)(),this.rafQueued=!1,this.updateLine(this.currentTime))})}updateLine(e){if(!e)return xt("no currentTime provided"),!1;if(xt("updateLine({currentMeasure: %d, quarterFromMeasureStart: %f, nextMeasure: %d})",e.currentMeasure,e.quarterFromMeasureStart,e.nextMeasure),e.currentMeasure===null)return!0;if(Te(e),!this.drawer||!this.drawer.isSyncWithData()||this.drawer.displayLockedState)return xt("no drawer, or not in sync with data"),this._clearCache(),this._clearLines(),!0;this.editionId!==this.drawer.editionId&&(xt("drawn content has changed since last slider update"),this._clearCache(),this._clearLines()),this.editionId=this.drawer.editionId;const o=e.currentMeasure,i=this.drawer.getNbMeasures();if(o>=i)throw new Error(`The measureIdx <${o}> is outside the score.`);if(!this.scoreDrawer.isMeasureDisplayed(o))return xt("The measure %d is not yet displayed",o),this.scoreDrawer.forceDisplayMeasure(o),this._clearLines(),!0;if(this.measureIdx=o,typeof e.nextMeasure!="undefined"){if(this.nextMeasureIdx=e.nextMeasure,this.nextMeasureIdx!==null&&this.nextMeasureIdx>=i)throw new Error(`The next measureIdx <${this.nextMeasureIdx}> is outside the score.`)}else this.nextMeasureIdx=o+1,this.nextMeasureIdx===i&&(this.nextMeasureIdx=null);this.quarterTimePos=e.quarterFromMeasureStart;const l=this.drawnMeasureIdx;if(!this._isAtMeasureEnd())xt("inside measure"),this._displayLineInCurrentMeasure();else if(this.nextMeasureIdx===null)xt("last measure"),this._displayLineInCurrentMeasure();else if(!this.scoreDrawer.isMeasureDisplayed(this.nextMeasureIdx))xt("next measure is not displayed"),this.scoreDrawer.forceDisplayMeasure(this.nextMeasureIdx),this._displayLineInCurrentMeasure();else{const u=this._computeDisplayLimitQuarterPos();this._shouldDisplayLineInNextMeasure(u)?(xt("display at begining of next measure"),this._displayLineInNextMeasure(u)):(xt("display at end of current measure"),this._displayLineInCurrentMeasureEnd(u))}return this._scrollToLine(l),!0}_clearCache(){xt("_clearCache"),this.measureDataMap.clear()}_isAtMeasureEnd(){const e=this._getMeasureData(this.measureIdx);return this.quarterTimePos>e.lastItemQuarterPos}_displayLineInCurrentMeasure(){this._updateLinesMapIfNeeded(this.measureIdx);const e=this._getMeasureData(this.measureIdx);let i=e.anyStaff.getTimePosXInMeasure(e.measureIdxInStaff,this.quarterTimePos,1);i+=e.posX,this._updateLinesPos(i)}_computeDisplayLimitQuarterPos(){const e=this._getMeasureData(this.measureIdx),o=e.width-e.lastItemPos,l=this._getMeasureData(this.nextMeasureIdx).spaceBeforeContent,u=o+l,P=o/u;return(e.quarterDuration-e.lastItemQuarterPos)*P+e.lastItemQuarterPos}_shouldDisplayLineInNextMeasure(e){return this.quarterTimePos>e}_displayLineInNextMeasure(e){this._updateLinesMapIfNeeded(this.nextMeasureIdx);const o=this._getMeasureData(this.measureIdx),i=this.quarterTimePos-e,l=o.quarterDuration-e,u=i/l,P=this._getMeasureData(this.nextMeasureIdx);let O=P.spaceBeforeContent*u;O+=P.posX,this._updateLinesPos(O)}_displayLineInCurrentMeasureEnd(e){this._updateLinesMapIfNeeded(this.measureIdx);const o=this._getMeasureData(this.measureIdx),i=this.quarterTimePos-o.lastItemQuarterPos,l=e-o.lastItemQuarterPos,u=i/l;let P=(o.width-o.lastItemPos)*u;P+=o.lastItemPos,P+=o.posX,this._updateLinesPos(P)}_updateLinesPos(e){this.linesMap.forEach(o=>o.setPosX(e))}_updateLinesMapIfNeeded(e){if(this.drawnMeasureIdx===e)return;const o=new Map,i=this._getMeasureData(e);i.partsMap.forEach((l,u)=>{let P;if(this.linesMap.has(u))P=this.linesMap.get(u),this.linesMap.delete(u);else{const O=this._getSliderConstructor();P=new O(u,this.interaction,this.color)}o.set(u,P)}),this.linesMap.forEach(l=>l.destroy()),this.linesMap=o,this.linesMap.forEach(l=>l.setMeasureData(i)),this.drawnMeasureIdx=e,this.topPartUuid=i.topPartUuid}_getSliderConstructor(){return this.lowCpu?ie:Me}_getMeasureData(e){if(!this.measureDataMap.has(e)){const o={partsMap:new Map,anyStaff:null,topPartUuid:null,measureIdxInStaff:null,posX:null,spaceBeforeContent:null,quarterDuration:null,width:null,lastItemQuarterPos:null,lastItemPos:null},l=this.drawer.uuidGetFirstShardForMeasure({measureIdx:e}).getSystems();l.forEach(Ht=>o.partsMap.set(Ht.getPartUuid(),Ht));const[u]=l;o.topPartUuid=u.getPartUuid();const P=u.content;o.anyStaff=P.getStaff(0);const w=o.anyStaff.getMeasure(0).getDataIdx();o.measureIdxInStaff=e-w;const rt=o.anyStaff.getMeasure(o.measureIdxInStaff);o.width=rt.getWidth(),o.posX=rt.getXPos();const Tt=rt.getTickableContent();o.spaceBeforeContent=Tt.getXPos();const St=Tt.horizontalFormatter,zt=St.getDpq();return o.lastItemQuarterPos=St.getLastItemTimePos()/zt,o.lastItemPos=o.anyStaff.getTimePosXInMeasure(o.measureIdxInStaff,o.lastItemQuarterPos,1),o.quarterDuration=St.getNbDivisions()/zt,this.measureDataMap.set(e,o),o}return this.measureDataMap.get(e)}_scrollToLine(e){const o=this.linesMap.get(this.topPartUuid);if(o.posX===null)return;const i=o.getElem().node();if(!i.isConnected)return;const l=i.getBoundingClientRect(),u=this.horizontalScrollable.getBoundingClientRect(),P=l.x-u.x;let O=u;this.horizontalScrollable!==this.verticalScrollable&&(O=this.verticalScrollable.getBoundingClientRect());const w=l.y-O.y,rt={x:P,y:w};this.drawnMeasureIdx!==e&&(!this.autoScroll&&rt.x>=0&&rt.x<u.width&&rt.y>=0&&rt.y<O.height?this.nbMeasuresWithoutAutoScroll++:this.nbMeasuresWithoutAutoScroll=0),this._doScroll(rt)}_doScroll(e){if(xt("_doScroll({x: %f, y: %f})",e.x,e.y),this.autoScroll)if((0,d.q6)().layout==="track"){if(this.lowCpu&&this.drawnMeasureIdx===this.scrollingToMeasureIdx)return;const i=this.drawer.getSpaceSize()*this.drawer.getScaling()*4*1,l=this.horizontalScrollable.scrollTop;if(e.x>i||e.x<i){let u=e.x-i;const P=u<0;let O=P?"instant":"smooth";!this.lowCpu&&!P&&(O="instant",u/=8);const w=this.horizontalScrollable.scrollLeft+u;this.horizontalScrollable.scrollTo({top:l,left:w,behavior:O}),this.scrollingToMeasureIdx=this.drawnMeasureIdx}}else{let i=this.drawer.getSpaceSize()*this.drawer.getScaling()*4*4;if(this.mobileMode&&(i=i/=2),e.y>i+10||e.y<i-10){if(this.drawnMeasureIdx===this.scrollingToMeasureIdx)return;const l=Math.round(e.y-i),P=l<0?"instant":"smooth",O=this.verticalScrollable.scrollTop+l,w=this.verticalScrollable.scrollLeft;this.verticalScrollable.scrollTo({top:O,left:w,behavior:P}),this.scrollingToMeasureIdx=this.drawnMeasureIdx}}this.nbMeasuresWithoutAutoScroll>re&&(this.autoScroll=!0,this.nbMeasuresWithoutAutoScroll=0)}clear(){xt("clear()"),this.verticalScrollable&&(this.verticalScrollable.removeEventListener("mousewheel",this.scrollHandler),this.verticalScrollable.removeEventListener("DOMMouseScroll",this.scrollHandler),this.verticalScrollable.removeEventListener("touchmove",this.scrollHandler)),this.horizontalScrollable&&this.horizontalScrollable!==this.verticalScrollable&&(this.horizontalScrollable.removeEventListener("mousewheel",this.scrollHandler),this.horizontalScrollable.removeEventListener("DOMMouseScroll",this.scrollHandler),this.horizontalScrollable.removeEventListener("touchmove",this.scrollHandler)),this._clearLines()}_clearLines(){xt("_clearLines()"),this.linesMap.forEach(e=>e.destroy()),this.linesMap.clear(),this.drawnMeasureIdx=null,this.scrollingToMeasureIdx=null,this.topPartUuid=null}}var Gt=s(69587),Le=Object.defineProperty,ne=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,Yt=(n,e,o)=>e in n?Le(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,Ue=(n,e)=>{for(var o in e||(e={}))be.call(e,o)&&Yt(n,o,e[o]);if(ne)for(var o of ne(e))Oe.call(e,o)&&Yt(n,o,e[o]);return n},Nt=(n,e,o)=>new Promise((i,l)=>{var u=w=>{try{O(o.next(w))}catch(rt){l(rt)}},P=w=>{try{O(o.throw(w))}catch(rt){l(rt)}},O=w=>w.done?i(w.value):Promise.resolve(w.value).then(u,P);O((o=o.apply(n,e)).next())}),X;const m=B()("flat:score");let ot=60;(X=window.flatappname)!=null&&X.includes(".vue-scoreembed")&&(ot=40);const K=250,ht=1,ut=Number.POSITIVE_INFINITY;function Rt(n,e){n.trackLeftMargin="8px",n.trackRightMargin=7,n.trackTopMargin="8px",e?n.trackBottomMargin="40px":n.trackBottomMargin=0}const vt={AUTO:"auto",MANUAL_EXTENDED:"manual-extended"},Et=365,Wt={name:"ScoreDrawer",emits:["fontsLoaded"],props:{providedScoreData:{type:Object,default:null},interaction:{type:Object,required:!0},collaborators:{type:Object,required:!0},inlineComments:{type:Object,default:null},drawQueue:{type:Object,default(){return m("no queue provided, creating new draw queue"),new(tt())(ht,ut)}},clickablePartName:{type:Boolean,default:!0},scrollableElement:{type:Object,default:null},hasBottomMargin:{type:Boolean,default:!0},displayStatus:{type:Object,default:null}},data(){return{isPrinted:!1,countRedrawDone:0,changingLayout:!1,hasMorePages:!1,hasOnScrollQueued:!1,hasFullRedrawQueued:!1,svgs:[],svgsIds:[],svgsById:{},svgsIOs:{},partsNamesSvg:null,measuresNumbersSvg:null,displayedTrackViewport:void 0,trackViewport:void 0,temporaryTextMetricSvg:null,partsPanelMode:vt.AUTO,currentZoom:null}},setup(){const n=(0,U.o)(),e=(0,Qt.U)(),o=(0,d.q6)(),i=(0,Mt.W)(),l=(0,v.H)();return J.t0&&(window.flatEditorDisplayReady=!1),{scoreAudio:(0,t.EW)(()=>n),playing:(0,t.EW)(()=>n.playing),pausing:(0,t.EW)(()=>n.pausing),quarterFromMeasureStart:(0,t.EW)(()=>n.quarterFromMeasureStart),currentMeasure:(0,t.EW)(()=>n.currentMeasure),scoreWrite:(0,t.EW)(()=>e.scoreWrite),layout:(0,t.EW)(()=>o.layout),askedLayout:(0,t.EW)(()=>o.askedLayout),zoom:(0,t.EW)(()=>o.zoom),pinchPositionPercentage:(0,t.EW)(()=>o.pinchPositionPercentage),pageWidthNoScaling:(0,t.EW)(()=>o.pageWidthNoScaling),zoomAutoWidthSubtract:(0,t.EW)(()=>o.zoomAutoWidthSubtract),displayedParts:(0,t.EW)(()=>o.displayedParts),drawOptions:(0,t.EW)(()=>o.drawOptions),lowCpuSlider:(0,t.EW)(()=>o.lowCpuSlider),allPartsDisplayed:(0,t.EW)(()=>o.allPartsDisplayed),setPageWidthNoScaling:o.setPageWidthNoScaling,applyZoomAuto:o.applyZoomAuto,setRenderedState:o.setRenderedState,setSpaceSize:o.setSpaceSize,setLayout:o.setLayout,setNbMeasures:o.setNbMeasures,setNbSystems:o.setNbSystems,setIsLastMeasureDrawn:o.setIsLastMeasureDrawn,svSetScroll:o.setScroll,svDrawDone:o.drawDone,isConcertPitch:(0,t.EW)(()=>i.isConcertPitch),isEditionBlocked:(0,t.EW)(()=>i.isEditionBlocked),tbInstrumentsEnabled:(0,t.EW)(()=>l.tbInstrumentsEnabled)}},computed:{canEdit(){return this.scoreWrite&&!this.isEditionBlocked},cssClasses(){return{[this.layout]:!0,[this.$style.scoreDrawer]:!0,[this.$style.track]:this.layout==="track",[this.$style.page]:this.layout==="page"}},scoreData(){return this.providedScoreData||this.interaction.scoreData},$verticalScrollEl(){return this.layout==="track"?this.$refs.pages:this.scrollableElement||this.$el},$horizontalScrollEl(){return this.layout==="track"?this.$refs.pages:this.scrollableElement?this.scrollableElement:this.$refs.horizontalScrollable},isTrackPositionOffDisplayedRange(){if(!this.displayedTrackViewport)return!0;let n=(0,$.A)();return n<K&&(n=K),this.displayedTrackViewport.startPosition-this.trackViewport.startPosition>n||this.trackViewport.stopPosition-this.displayedTrackViewport.stopPosition>n}},watch:{canEdit(n){this.mouse&&this.mouse.setRight(n)},askedLayout(){this.changingLayout=!0,this.fullRedraw()},isConcertPitch(){this.fullRedraw()},displayedParts:{handler(){this.interaction.audio&&this.interaction.audio.stopIfPlaying(),this.fullRedraw()},deep:!0},zoom(){this.drawQueue.add(()=>{if(!this.changingLayout&&this.currentZoom!==this.zoom){if(this.pageLayout){this.displayStatus&&this.displayStatus.emit("drawStart");const n=this.getZoomParams();if(this.pageLayout.setScaling(this.zoom||1),this.interaction.initSvgTools(this.svgs),this.interaction.cursor.loadCursor(!0),this.interaction.cursor.refresh(),this.inlineComments&&this.inlineComments.refresh(),this.layout==="responsive"&&this.updateResponsiveWidth(),this.layout==="track"){const e=this.pageLayout.measuresNumbersPanel.getScaledHeight();this.$refs.hideBlock.style.flexBasis=`${e}px`;const o=this.pageLayout.partsNamesPanel.getScaledWidth();this.$refs.hideBlock.style.width=`${o}px`}this.currentZoom=this.zoom,this.zoomShiftScroll(n),this.onScroll(),this.setSpaceSize(this.pageLayout.getSpaceSize()*this.currentZoom),setTimeout(()=>{this.drawQueue.add(()=>{this.displayStatus&&this.displayStatus.emit("drawDone")})},0)}this.updateDrawerMetas()}})},zoomAutoWidthSubtract(){this.layout==="responsive"&&this.updateResponsiveWidth()},playing(n){n?this.slider.loadSlider(this.pageLayout,this.$verticalScrollEl,this.$horizontalScrollEl):this.slider.clear()},quarterFromMeasureStart(){return Nt(this,null,function*(){if((this.playing||this.pausing)&&this.currentMeasure!==null)try{(yield this.slider.updateLineThrottled(this.scoreAudio))||(m("fail to updateLine(), stop"),this.interaction.audio.stop())}catch(n){throw m("fail to updateLine(), stop"),this.interaction.audio.stop(),n}})},lowCpuSlider(n){this.slider.clear(),this.slider=new ae(this.interaction,this,n),this.playing&&this.slider.loadSlider(this.pageLayout,this.$verticalScrollEl,this.$horizontalScrollEl)}},methods:{setupPageObserver(){this.svgsIO=new IntersectionObserver(n=>{n.forEach(e=>{const o=e.target.getAttribute("id");this.svgsIOs[o]=e}),this.hasMorePages&&!this.drawNextPagesQueued&&!this.needCompleteRedraw()&&this.svgs.length>0&&this.svgs.length<this.numbersPagesToDraw()&&(this.drawNextPagesQueued=!0,this.drawQueue.add(this.drawNextPages.bind(this)))},{threshold:[0,.25,.5,.75,1]}),this.svgsIO.POLL_INTERVAL=100},logAndThrowDisplayError(n,{actionType:e,opts:o={}}){throw this.scoreData.logError(n,{logger:"scoreDrawer",level:"fatal",extra:Ue({"scoreDrawer:actionType":e},o)}),n},renderScore(){return Nt(this,null,function*(){this.drawNextPagesQueued=!0,g.sQ.addBreadcrumb({category:"drawer",message:"full redraw"}),this.isPrinted&&this.removeScore(),this.isPrinted=!0,this.scoreData.ensurePageSize();const n=this.scoreData.config.getCopy();if(typeof n.displayOutOfPitch=="undefined"&&(n.displayOutOfPitch=!0),n.isAsynchronous=!0,this.scoreWrite&&(n.showSystemBreakSymbols=!0,n.displayFirstKey=!0),!this.allPartsDisplayed)try{const u=[];Object.keys(this.displayedParts).forEach(P=>{this.displayedParts[P]&&(u[this.scoreData.adagioData.getPartIdxFromUuid(P)]=!0)}),n.partsDisplayed=u}catch(u){this.scoreData.logError(u)}Object.assign(n,this.drawOptions),n.hideTempo||(n.hideTempo=void 0),this.setLayout(this.askedLayout);const e=(0,t.dY)();let o;this.scoreData.adagioData.getMusicFont()===z.A.PETALUMA?(o=(yield s.e(60455).then(s.bind(s,7893))).default,Object.keys(n).forEach(u=>{n[u]&&typeof n[u]=="object"&&n[u]["font-family"]&&(n[u]["font-family"]="Petaluma Script")})):this.scoreData.adagioData.getMusicFont()===z.A.LEIPZIG?o=(yield s.e(1336).then(s.bind(s,147738))).default:this.scoreData.adagioData.getMusicFont()===z.A.SEBASTIAN?o=(yield s.e(25966).then(s.bind(s,599244))).default:this.scoreData.adagioData.getMusicFont()===z.A.LELAND?o=(yield s.e(13406).then(s.bind(s,719988))).default:this.scoreData.adagioData.getMusicFont()===z.A.GOOTVILLE?o=(yield s.e(29193).then(s.bind(s,368131))).default:this.scoreData.adagioData.getMusicFont()===z.A.FINALE_MAESTRO?o=(yield s.e(4860).then(s.bind(s,996470))).default:this.scoreData.adagioData.getMusicFont()===z.A.FINALE_BROADWAY?o=(yield s.e(75720).then(s.bind(s,183618))).default:this.scoreData.adagioData.getMusicFont()===z.A.FINALE_ASH?o=(yield s.e(71895).then(s.bind(s,105429))).default:this.scoreData.adagioData.getMusicFont()===z.A.FINALE_ENGRAVER?o=(yield s.e(43095).then(s.bind(s,819445))).default:this.scoreData.adagioData.getMusicFont()===z.A.FINALE_JAZZ?o=(yield s.e(24942).then(s.bind(s,418252))).default:this.scoreData.adagioData.getMusicFont()===z.A.FINALE_LEGACY?o=(yield s.e(97604).then(s.bind(s,86766))).default:o=(yield Promise.resolve().then(s.bind(s,624740))).default,this.scoreData.fonts&&(yield this.scoreData.fonts.waitForFonts()),this.$emit("fontsLoaded"),yield e,this.temporaryTextMetricSvg=new x.A,this.$refs.pages.appendChild(this.temporaryTextMetricSvg.node()),this.textmetrics=new q.A(this.temporaryTextMetricSvg.node());let i,l;if(this.layout==="responsive"){this.setPageWidthNoScaling(0),n.responsiveBottomMargin=30,i=new L.A(this.scoreData.adagioData,Gt.S,this.textmetrics,o,n);let u=this.getResponsiveWidth();const P=i.getScaling();u/=P,i.setWidth(u),l=new W.A(this.scoreData.adagioData,i)}else if(this.layout==="page"){i=new M.A(this.scoreData.adagioData,Gt.S,this.textmetrics,o,n),l=new W.A(this.scoreData.adagioData,i);const u=i.getPageSize(0).width;u!==this.pageWidthNoScaling&&(this.setPageWidthNoScaling(u),this.applyZoomAuto(),i.setScaling(this.zoom))}else{this.setPageWidthNoScaling(0),this.updateTrackPosition();const u=(0,Z.default)(this.trackViewport);u.startPosition=Math.max(0,u.startPosition),n.displayRange=u,Rt(n,this.hasBottomMargin),this.displayedTrackViewport=this.trackViewport,i=new R.A(this.scoreData.adagioData,Gt.S,this.textmetrics,o,n),l=new A.A(this.scoreData.adagioData,i),this.onScroll()}return this.currentZoom=this.zoom,this.setSpaceSize(i.getSpaceSize()*this.currentZoom),this.pageLayout=(0,j.IG)(i),this.updater=(0,j.IG)(l),this.pageLayout.setScaling(this.zoom||1),this.interaction.setPageLayout(this.pageLayout),this.drawNextPages({firstRender:!0})})},drawNextPagesIfNeeded(n){var e,o,i;return this.hasMorePages=this.pageLayout.hasRemaining(),!this.hasFullRedrawQueued&&this.hasMorePages&&!this.needCompleteRedraw()&&this.svgs.length<this.numbersPagesToDraw()?this.drawNextPages(n):(this.refreshUX(),this.inlineComments&&this.inlineComments.refresh(),this.interaction.rangeSelect.refreshDisplay&&this.interaction.rangeSelect.refreshDisplay(),(i=(o=(e=this.interaction)==null?void 0:e.cursor)==null?void 0:o.selectedElem)!=null&&i.highLight&&this.interaction.cursor.selectedElem.highLight(),this.svDrawDone(),this.scoreData.scoreActions&&this.scoreData.scoreActions.emit("drawDone"),null)},drawNextPages(n){var e,o,i;n=n||{};const l=n.firstRender||!1;return a.M&&performance.mark("draw.drawNextPages.s"),!l&&this.interaction.rangeSelect.refreshDisplay&&this.interaction.rangeSelect.refreshDisplay(),!l&&((i=(o=(e=this.interaction)==null?void 0:e.cursor)==null?void 0:o.selectedElem)!=null&&i.highLight)&&this.interaction.cursor.selectedElem.highLight(),new Promise(u=>{let P=0;const O=()=>Nt(this,null,function*(){var w,rt,Tt;if(!this.scoreData.isReady)return this.drawNextPagesQueued=!1,this.removeScore(),u();if(this.pageLayout.hasRemaining()){let St;P>0||!this.temporaryTextMetricSvg?(St=new x.A,this.$refs.pages.appendChild(St.node())):(St=this.temporaryTextMetricSvg,this.temporaryTextMetricSvg=null),this.setRenderedState(!0);try{if(this.layout==="track"){const de=new x.A(this.$refs.partsPanel);de.dropChildren();const Ne=new x.A(this.$refs.measuresPanel);Ne.dropChildren(),yield this.pageLayout.fillNextPage(St,{partsNamesSvg:de,measuresNumbersSvg:Ne});const We=this.pageLayout.measuresNumbersPanel.getScaledHeight();this.$refs.hideBlock.style.flexBasis=`${We}px`;const ke=this.pageLayout.partsNamesPanel.getScaledWidth();this.$refs.hideBlock.style.width=`${ke}px`,this.updateDrawerMetas()}else yield this.pageLayout.fillNextPage(St),this.updateDrawerMetas()}catch(de){this.logAndThrowDisplayError(de,{actionType:"pageLayout.fillNextPage"})}const zt=St.node();let Ht=zt.getAttribute("id");Ht||(Ht=`adagio-svg-${st.default.generate()}`,zt.setAttribute("id",Ht)),this.svgs.push(St),this.svgsIds.push(Ht),this.svgsById[Ht]=St,this.svgsIO.observe(zt),l&&P===0&&this.initEvent(),P++}return this.changingLayout=!1,this.refreshUX(),this.hasMorePages=this.pageLayout.hasRemaining(),!this.hasFullRedrawQueued&&this.hasMorePages&&!this.needCompleteRedraw()&&this.svgs.length<this.numbersPagesToDraw()?(window.requestAnimationFrame(O),null):(this.inlineComments&&this.inlineComments.refresh(),this.interaction.rangeSelect.refreshDisplay&&this.interaction.rangeSelect.refreshDisplay(),(Tt=(rt=(w=this.interaction)==null?void 0:w.cursor)==null?void 0:rt.selectedElem)!=null&&Tt.highLight&&this.interaction.cursor.selectedElem.highLight(),this.svDrawDone(),this.scoreData.scoreActions&&this.scoreData.scoreActions.emit("drawDone"),l&&(this.countRedrawDone++,this.interaction.cursor.scheduleScrollTo()),a.M&&(performance.mark("draw.drawNextPages.e"),performance.measure("draw.drawNextPages","draw.drawNextPages.s","draw.drawNextPages.e")),this.drawNextPagesQueued=!1,u())});O()})},forceDisplayMeasure(n){return this.isMeasureDisplayed(n)?Promise.resolve():this.drawQueue.add(this.queuedForceDisplayMeasure.bind(this,n))},queuedForceDisplayMeasure(n){return Nt(this,null,function*(){var e,o,i,l;if(!this.isMeasureDisplayed(n))if((e=this.displayStatus)==null||e.emit("drawStart"),this.updater instanceof A.A)try{yield this.updater.forceDisplayMeasure({measureIdx:n}),this.updateDrawerMetas(),(o=this.displayStatus)==null||o.emit("drawDone")}catch(u){(i=this.displayStatus)==null||i.emit("drawDone"),this.logAndThrowDisplayError(u,{actionType:"updater.forceDisplayMeasure",opts:{measureIdx:n}})}else{if(n>=this.pageLayout.getNbMeasures())return;for(;this.pageLayout.uuidGetMeasureColumnFirstPageSvgParent({measureIdx:n})===null;)yield this.drawNextPages();(l=this.displayStatus)==null||l.emit("drawDone"),this.updateDrawerMetas()}})},isMeasureDisplayed(n){if(!F.default.isInteger(n)||n<0)throw new G.default(`Invalid measureIdx <${n}>.`);const e=this.pageLayout.getNbMeasures();return n>=e?!1:this.updater instanceof A.A?this.pageLayout.isAnySystemMeasureRendered(n):this.pageLayout.uuidGetMeasureColumnFirstPageSvgParent({measureIdx:n})!==null},updateTrackPosition(){const n=this.$horizontalScrollEl.scrollLeft||0;let e=(0,$.A)();e<K&&(e=K);const o=e*2,i=n-o,l=n+e+o;if(this.trackViewport={startPosition:Math.round(i/this.zoom),stopPosition:Math.round(l/this.zoom)},Number.isNaN(this.trackViewport.startPosition)||Number.isNaN(this.trackViewport.stopPosition)){const u=new Error("Invalid track optimization values");u.trackViewport=this.trackViewport,u.zoom=this.zoom,u.startPosition=i,u.stopPosition=l,this.scoreData.logError(u),this.trackViewport=null,this.displayedTrackViewport=null}m("trackViewport: from %d to %d",this.trackViewport.startPosition,this.trackViewport.stopPosition)},updateResponsiveWidth(){if(this.layout!=="responsive"||!(this.updater instanceof W.A))return;const n=this.getResponsiveWidth(),e=this.zoom||1;this.drawQueue.add(()=>Nt(this,null,function*(){a.M&&performance.mark("draw.widthUpdate.s");try{yield this.updater.setExternalWidth(n)}catch(o){this.logAndThrowDisplayError(o,{actionType:"updater.setExternalWidth",opts:{externalWidth:n}})}try{yield this.updater.setScaling(e)}catch(o){this.logAndThrowDisplayError(o,{actionType:"updater.setScaling",opts:{scaling:e}})}a.M&&(performance.mark("draw.widthUpdate.e"),performance.measure("draw.widthUpdate","draw.widthUpdate.s","draw.widthUpdate.e")),m("responsive: %s",n),this.cleanRemovedPages(),yield this.drawNextPages(),this.updateDrawerMetas()}))},getResponsiveWidth(){let n=(0,$.A)()-ot;return this.zoomAutoWidthSubtract>0&&(n-=this.zoomAutoWidthSubtract),n=Math.max(n,K),n},numbersPagesToDraw(){if(this.pageLayout instanceof R.A)return Number.POSITIVE_INFINITY;if(this.svgsIds.length===0)return 2;const n=[2],{h:e}=r(),o=this.svgs[this.svgs.length-1].node(),i=Number.parseFloat(o.getAttribute("height")),l=Math.ceil(e/i);n.push(l*2);const u=this.svgsIds.map(rt=>{var Tt;return(Tt=this.svgsIOs[rt])==null?void 0:Tt.isIntersecting}),O=u.indexOf(!0)+Math.max(u.filter(rt=>!!rt).length-1,0);n.push(l+O+1);const w=Math.max(...n);return m("numbersPagesToDraw %d: candidates max %o",w,n),w},onResize(){this.layout==="responsive"?this.updateResponsiveWidth():(this.applyZoomAuto(),this.onScroll())},isUsableTrack(){return this.layout==="track"&&this.$refs.partsPanel&&this.$refs.measuresPanel},onScroll(){if(this.svSetScroll({left:this.$horizontalScrollEl.scrollLeft,top:this.$verticalScrollEl.scrollTop}),this.layout!=="track"){this.lastDrawn=null,this.trackViewport=null,this.displayedTrackViewport=null;return}this.toggleShortNameOnScroll(this.$horizontalScrollEl.scrollLeft),window.requestAnimationFrame(()=>{this.isUsableTrack()&&(this.$refs.partsPanel.style.top=`${-this.$verticalScrollEl.scrollTop}px`,this.$refs.measuresPanel.style.right=`${this.$horizontalScrollEl.scrollLeft}px`,this.updateTrackPosition(),this.pageLayout instanceof R.A&&!this.hasOnScrollQueued&&(this.hasOnScrollQueued=!0,this.drawQueue.add(()=>Nt(this,null,function*(){if(this.hasOnScrollQueued=!1,!this.isUsableTrack()||!this.isTrackPositionOffDisplayedRange)return;const n=(0,Z.default)(this.trackViewport),e=(0,Z.default)(this.trackViewport);n.startPosition=Math.max(0,n.startPosition);try{yield this.updater.updateDisplayRange(n)}catch(i){this.logAndThrowDisplayError(i,{actionType:"updater.updateDisplayRange",opts:{displayedRange:n}})}yield this.drawNextPages(),this.displayedTrackViewport=e;const o=this.pageLayout.getMeasuresRange();(!this.lastDrawn||this.lastDrawn.startMeasureIdx!==o.startMeasureIdx||this.lastDrawn.stopMeasureIdx!==o.stopMeasureIdx)&&(this.lastDrawn=o),this.updateDrawerMetas()}))))})},initEvent(){if(this.interaction.initSvgTools(this.svgs),this.interaction.initCursor({svgs:this.svgs,verticalScrollableElement:this.$verticalScrollEl,horizontalScrollableElement:this.$horizontalScrollEl,collaborators:this.collaborators,keepPosition:this.countRedrawDone!==0}),m("render"),this.interaction.cursor.adagioCursor.setTarget(this.pageLayout),this.inlineComments){const n=this.inlineComments.marker;n.setDrawer(this.pageLayout),n.setScoreData(this.scoreData.adagioData)}this.rangeDrawer&&this.rangeDrawer.setAdagioDrawer(this.pageLayout),this.interaction.cursor.setCanScroll(),this.interaction.cursor.setPromiseQueue(this.drawQueue),this.interaction.cursor.loadCursor(),m("events loaded"),this.interaction.domCache.cleanCacheHead()},refreshUX(){this.interaction.svgTools.setPageStructures(this.pageLayout.getPagesStructures()),this.interaction.cursor.refresh()},updateDisplayWithDataChange(){if(!this.pageLayout){m("layout not yet loaded, no need to stack draw update");return}this.drawQueue.add(()=>Nt(this,null,function*(){const{scoreActions:n}=this.scoreData;n.drawQueue.needCompleteRedraw()?(this.drawNextPagesQueued=!0,yield this.editFullRedraw()):n.drawQueue.stack.length>0?(this.drawNextPagesQueued=!0,yield this.partialDraw()):m("no changes to apply to display"),this.updateDrawerMetas()}))},partialDraw(){return Nt(this,null,function*(){const{scoreActions:n}=this.scoreData;m("%s actions to draw",n.drawQueue.stack.length),this.displayStatus&&this.displayStatus.emit("drawStart"),a.M&&performance.mark("draw.partial.s"),a.M&&performance.mark("draw.displayedUpdate.s");try{yield this.updater.update(n.drawQueue)}catch(e){this.logAndThrowDisplayError(e,{actionType:"updater.update"})}a.M&&(performance.mark("draw.displayedUpdate.e"),performance.measure("draw.displayedUpdate","draw.displayedUpdate.s","draw.displayedUpdate.e")),n.resetDrawQueue(),this.cleanRemovedPages(),yield this.drawNextPagesIfNeeded(),a.M&&(performance.mark("draw.partial.e"),performance.measure("draw.partial","draw.partial.s","draw.partial.e")),this.displayStatus&&this.displayStatus.emit("drawDone")})},editFullRedraw(){return Nt(this,null,function*(){if(this.hasFullRedrawQueued){m("full redraw already queued");return}this.scoreData.scoreActions.resetDrawQueue(),this.scoreData.scoreActions.drawQueue?this.scoreData.scoreActions.drawQueue.stateCompleteRedrawDone():m("no drawQueue setup"),this.displayStatus&&this.displayStatus.emit("drawStart"),a.M&&performance.mark("draw.full.s"),yield this.renderScore(),m("full redraw"),a.M&&(performance.mark("draw.full.e"),performance.measure("draw.full","draw.full.s","draw.full.e")),this.displayStatus&&this.displayStatus.emit("drawDone")})},fullRedraw(){if(this.hasFullRedrawQueued||this.needCompleteRedraw()){m("full redraw already queued");return}a.M&&performance.mark("draw.full.s"),m("full redraw queued"),this.hasFullRedrawQueued=!0,this.drawQueue.add(()=>Nt(this,null,function*(){this.hasFullRedrawQueued=!1,this.displayStatus&&this.displayStatus.emit("drawStart"),yield this.renderScore(),this.displayStatus&&this.displayStatus.emit("drawDone"),J.t0&&(window.flatEditorDisplayReady=!0),this.updateDrawerMetas()})).then(()=>{this.reloadEvents(),this.scoreData.scoreActions.resetDrawQueue(),m("full redraw"),this.scoreData.scoreActions.drawQueue?this.scoreData.scoreActions.drawQueue.stateCompleteRedrawDone():m("no drawQueue setup"),a.M&&(performance.mark("draw.full.e"),performance.measure("draw.full","draw.full.s","draw.full.e"))})},cleanRemovedPages(){const n=this.updater.getRemovedPagesIndexes();for(let e=n.length-1;e>=0;e--){const o=n[e];if(this.svgs.length===1){this.temporaryTextMetricSvg=this.svgs[o],this.textmetrics.init(this.temporaryTextMetricSvg.node()),this.svgsIds.splice(o,1),this.svgs.splice(o,1);continue}this.svgs[o].elem.parentElement.removeChild(this.svgs[o].elem),this.svgs.splice(o,1),this.svgsIds.splice(o,1),o===0&&this.textmetrics.init(this.svgs[o].node())}},removeScore(){this.isPrinted=!1,this.svgs.forEach(n=>{this.$refs.pages.removeChild(n.elem)}),this.partsNamesSvg=null,this.measuresNumbersSvg=null,this.svgs=[],this.svgsById={},this.svgsIOs={},this.svgsIds=[]},needCompleteRedraw(){var n;return(n=this.scoreData.scoreActions.drawQueue)==null?void 0:n.needCompleteRedraw()},reloadEvents(){this.horizontalEventsTarget===this.$horizontalScrollEl&&this.verticalEventsTarget===this.$verticalScrollEl||(this.unbindEvents(),this.bindEvents())},bindEvents(){this.verticalEventsTarget=this.$verticalScrollEl,this.horizontalEventsTarget=this.$horizontalScrollEl,this.verticalEventsTarget.addEventListener("scroll",this.onScroll,et.A),this.horizontalEventsTarget.addEventListener("scroll",this.onScroll,et.A),this.verticalEventsTarget.addEventListener("mousemove",this.mouse.mousemoveBound),this.verticalEventsTarget.addEventListener("mousedown",this.mouse.mousedownBound),this.verticalEventsTarget.addEventListener("mouseup",this.mouse.mouseupBound),this.verticalEventsTarget.addEventListener("mouseout",this.mouse.mouseoutBound),this.verticalEventsTarget.addEventListener("dblclick",this.mouse.dblclickBound),this.verticalEventsTarget.addEventListener("touchstart",this.mouse.touchHandlerBound),this.verticalEventsTarget.addEventListener("touchmove",this.mouse.touchHandlerBound),this.verticalEventsTarget.addEventListener("touchend",this.mouse.touchHandlerBound),this.partsNamePanelTarget=null,this.$refs.partsPanel&&(this.partsNamePanelTarget=this.$refs.partsPanel,this.partsNamePanelTarget.addEventListener("mousedown",this.mouse.mousedownBound),this.partsNamePanelTarget.addEventListener("mouseup",this.mouse.mouseupBound),this.partsNamePanelTarget.addEventListener("touchstart",this.mouse.touchHandlerBound),this.partsNamePanelTarget.addEventListener("touchend",this.mouse.touchHandlerBound))},unbindEvents(){!this.verticalEventsTarget||!this.horizontalEventsTarget||(this.verticalEventsTarget.removeEventListener("scroll",this.onScroll,et.A),this.horizontalEventsTarget.removeEventListener("scroll",this.onScroll,et.A),this.verticalEventsTarget.removeEventListener("mousemove",this.mouse.mousemoveBound),this.verticalEventsTarget.removeEventListener("mousedown",this.mouse.mousedownBound),this.verticalEventsTarget.removeEventListener("mouseup",this.mouse.mouseupBound),this.verticalEventsTarget.removeEventListener("mouseout",this.mouse.mouseoutBound),this.verticalEventsTarget.removeEventListener("dblclick",this.mouse.dblclickBound),this.verticalEventsTarget.removeEventListener("touchstart",this.mouse.touchHandlerBound),this.verticalEventsTarget.removeEventListener("touchmove",this.mouse.touchHandlerBound),this.verticalEventsTarget.removeEventListener("touchend",this.mouse.touchHandlerBound),this.partsNamePanelTarget&&(this.partsNamePanelTarget.removeEventListener("mousedown",this.mouse.mousedownBound),this.partsNamePanelTarget.removeEventListener("mouseup",this.mouse.mouseupBound),this.partsNamePanelTarget.removeEventListener("touchstart",this.mouse.touchHandlerBound),this.partsNamePanelTarget.removeEventListener("touchend",this.mouse.touchHandlerBound)),this.partsNamePanelTarget=null,this.verticalEventsTarget=null,this.horizontalEventsTarget=null)},cyclePartsPanelMode(n){if(!(this.canEdit&&this.tbInstrumentsEnabled&&(n!=null&&n.target.classList.contains("part-name"))&&this.clickablePartName)){if(this.partsPanelMode===vt.AUTO)this.partsPanelMode=vt.MANUAL_EXTENDED,this.toggleShortName();else if(this.partsPanelMode===vt.MANUAL_EXTENDED){this.toggleShortName();const e=this.pageLayout.isMinimalName(),o=this.$horizontalScrollEl.scrollLeft>Et;e===o&&(this.partsPanelMode=vt.AUTO)}}},toggleShortNameOnScroll(n){this.partsPanelMode!==vt.MANUAL_EXTENDED&&(n>Et?this.toggleShortName(!0):n===0&&this.toggleShortName(!1))},toggleShortName(n){this.drawQueue.add(()=>{if(this.pageLayout instanceof R.A){this.pageLayout.toggleMinimalName(n);const e=this.pageLayout.partsNamesPanel.getScaledWidth();this.$refs.hideBlock.style.width=`${e}px`}})},updateDrawerMetas(){const n=this.pageLayout.getNbMeasures();this.setNbMeasures(n);let e=1;this.layout!=="track"&&(e=this.pageLayout.getNbShards()),this.setNbSystems(e),m("updateDrawerMetas, nbMeasures=%d, nbSystems=%d",n,e);const o=this.isMeasureDisplayed(n-1);this.setIsLastMeasureDrawn(o)},getZoomParams(){const n=this.$verticalScrollEl.clientHeight,e=this.$verticalScrollEl.clientWidth,o=(this.$verticalScrollEl.scrollTop+n*.5)/this.currentZoom,i=(this.$verticalScrollEl.scrollLeft+e*.5)/this.currentZoom;return{topScrollCenterGoalAbsolute:o,leftScrollCenterGoalAbsolute:i,oldZoom:this.currentZoom}},zoomShiftScroll({topScrollCenterGoalAbsolute:n,leftScrollCenterGoalAbsolute:e,oldZoom:o}){const i=this.currentZoom-o,l=this.$verticalScrollEl.clientHeight,u=this.$verticalScrollEl.clientWidth,P=this.pinchPositionPercentage?(this.pinchPositionPercentage.y-.5)*i:0,O=this.pinchPositionPercentage?(this.pinchPositionPercentage.x-.5)*i:0,w=n*this.currentZoom-l*(.5-P),rt=e*this.currentZoom-u*(.5-O);this.$verticalScrollEl.scrollTop=w,this.$verticalScrollEl.scrollLeft=rt}},created(){_.default.setDocument(window.document),this.slider=new ae(this.interaction,this,this.lowCpuSlider)},mounted(){this.setupPageObserver(),this.scoreData.scoreActions.drawQueue&&(this.scoreData.scoreActions.resetDrawQueue(),this.scoreData.scoreActions.drawQueue.stateCompleteRedrawDone()),this.fullRedraw(),this.scoreData.onStructuralChange(),this.rangeDrawer=new Ee(this.interaction),this.rangeDrawer.setAdagioDrawer(this.pageLayout),this.interaction.setRangeDrawer(this.rangeDrawer),this.interaction.setScoreDrawer(this),this.mouse=new he({scoreActions:this.scoreData.scoreActions,cursor:this.interaction.cursor,svgTools:this.interaction.svgTools,rangeSelect:this.interaction.rangeSelect}),this.mouse.setRight(this.canEdit),window.addEventListener("resize",this.onResize,et.A),this.bindEvents(),this.$el.addEventListener("touchcancel",this.mouse.touchHandlerBound),this.scoreData.scoreActions&&(this.onRedraw=()=>{this.fullRedraw()},this.onDisplayUpdate=()=>{this.updateDisplayWithDataChange(),this.interaction.audio.sendDataUpdate()},this.scoreData.scoreActions.on("redraw",this.onRedraw),this.scoreData.scoreActions.on("draw",this.onDisplayUpdate))},beforeUnmount(){this.scoreData.scoreActions&&(this.scoreData.scoreActions.off("redraw",this.onRedraw),this.scoreData.scoreActions.off("draw",this.onDisplayUpdate)),this.svgsIO&&this.svgsIO.disconnect(),window.removeEventListener("resize",this.onResize,et.A),this.unbindEvents(),this.$el.removeEventListener("blur",this.mouse.blurBound),this.removeScore(),this.interaction.setRangeDrawer(null)}};var xe=s(221543),Ie=s.n(xe),we=s(938793);const le={};le.$style=Ie();const Re=(0,we.A)(Wt,[["render",C],["__cssModules",le]])},560976:(b,S,s)=>{"use strict";s.d(S,{A:()=>$});var t=s(361744),c=s(538065),C=s(555381),g=s(744056),p=s(591340),B=s(931720),N=s(763939),tt=s(544582),j=s(941271),lt=s(6645);const x={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function q(r,a){return(0,t.uX)(),(0,t.CE)("svg",x,a[0]||(a[0]=[(0,t.Lk)("path",{d:"M16.02 12.02C16.2851 12.02 16.5 12.2349 16.5 12.5C16.5 12.7651 16.2851 12.98 16.02 12.98H8.98C8.7149 12.98 8.5 12.7651 8.5 12.5C8.5 12.2349 8.7149 12.02 8.98 12.02H16.02Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.5 5C8.35786 5 5 8.35786 5 12.5C5 16.6421 8.35786 20 12.5 20C16.6421 20 20 16.6421 20 12.5C20 8.35786 16.6421 5 12.5 5ZM4 12.5C4 7.80558 7.80558 4 12.5 4C17.1944 4 21 7.80558 21 12.5C21 17.1944 17.1944 21 12.5 21C7.80558 21 4 17.1944 4 12.5Z"},null,-1)]))}var G=s(938793);const Z={},st=(0,G.A)(Z,[["render",q]]),z={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function _(r,a){return(0,t.uX)(),(0,t.CE)("svg",z,a[0]||(a[0]=[(0,t.Lk)("path",{d:"M12.5 8.5C12.7651 8.5 12.98 8.7149 12.98 8.98V12.02H16.02C16.2851 12.02 16.5 12.2349 16.5 12.5C16.5 12.7651 16.2851 12.98 16.02 12.98H12.98V16.02C12.98 16.2851 12.7651 16.5 12.5 16.5C12.2349 16.5 12.02 16.2851 12.02 16.02V12.98H8.98C8.7149 12.98 8.5 12.7651 8.5 12.5C8.5 12.2349 8.7149 12.02 8.98 12.02H12.02V8.98C12.02 8.7149 12.2349 8.5 12.5 8.5Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.5 5C8.35786 5 5 8.35786 5 12.5C5 16.6421 8.35786 20 12.5 20C16.6421 20 20 16.6421 20 12.5C20 8.35786 16.6421 5 12.5 5ZM4 12.5C4 7.80558 7.80558 4 12.5 4C17.1944 4 21 7.80558 21 12.5C21 17.1944 17.1944 21 12.5 21C7.80558 21 4 17.1944 4 12.5Z"},null,-1)]))}const M={},R=(0,G.A)(M,[["render",_]]),W=(0,t.pM)({__name:"PlaybackSpeed",props:{audio:{}},emits:["onShowUpgradeDialog"],setup(r,{emit:a}){const f=r,d=(0,B.B)(),v=(0,j.B)(),{canChangePlaybackSpeed:T,playbackSpeed:E}=(0,lt.bP)((0,tt.o)()),k=(0,p.U)(),Y=(0,N.F)(),ct=(0,t.EW)(()=>Y.accountFeatures),it=(0,t.EW)(()=>k.isEmbed),Bt=(0,t.EW)(()=>it.value||ct.value.reverbPlayback),Ot=a;function It(y){if(!Bt.value){d.showUpgradeDialog({feature:"advancedPlayback"}),Ot("onShowUpgradeDialog");return}T&&(typeof y=="string"&&(y=Number.parseFloat(y)),y<.2?y=.2:y>2&&(y=2),f.audio.setGlobalPlaybackSpeed(y),v.addExperience("editor.playspeed"))}function I(){It(Math.round((E.value+.1)*100)/100)}function h(){It(Math.round((E.value-.1)*100)/100)}return(y,D)=>((0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)([y.$style.playbackSpeed,"no-select"]),"data-cy":"pspeed"},[(0,t.Lk)("button",{onClick:D[0]||(D[0]=(0,C.D$)(H=>h(),["prevent","stop"])),"aria-label":"Decrease playback speed","data-cy":"pSpeed-"},[(0,t.bF)(st)]),(0,t.Lk)("div",{class:(0,c.C4)(y.$style.playbackSpeedValue),"data-cy":"pSpeedVal"},(0,c.v_)((0,g.R1)(E))+"x ",3),(0,t.Lk)("button",{onClick:D[1]||(D[1]=(0,C.D$)(H=>I(),["prevent","stop"])),"aria-label":"Increase playback speed","data-cy":"pSpeed+"},[(0,t.bF)(R)])],2))}});var A=s(416568),J=s.n(A);const U={};U.$style=J();const $=(0,G.A)(W,[["__cssModules",U]])},565443:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function C(tt,j){return(0,t.uX)(),(0,t.CE)("svg",c,j[0]||(j[0]=[(0,t.Lk)("path",{d:"M9.00006 7.72656V15.9084L16.0001 11.8175L9.00006 7.72656ZM9.63643 8.70078L14.7273 11.8175L9.63643 14.9347V8.70078Z"},null,-1),(0,t.Lk)("path",{d:"M7.85547 4.57855L8.34301 5.45166C7.78924 5.76088 7.28316 6.13358 6.83179 6.56194L6.14342 5.83659C6.65518 5.35091 7.2287 4.92854 7.85547 4.57855ZM4.25797 8.48974L5.16904 8.90198C4.91037 9.47365 4.7239 10.076 4.61426 10.6939L3.62964 10.5192C3.75382 9.81941 3.96499 9.13724 4.25797 8.48974ZM3.68436 13.7707L4.66235 13.5621C4.79234 14.1714 4.99901 14.765 5.28071 15.3319L4.38519 15.7769C4.0661 15.1348 3.83178 14.4618 3.68436 13.7707ZM6.22911 18.2434L6.90798 17.5091C7.36908 17.9354 7.88158 18.3009 8.43323 18.5984L7.95861 19.4786C7.33327 19.1414 6.75212 18.7269 6.22911 18.2434Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M20.5001 12C20.5001 7.30558 16.6945 3.5 12.0001 3.5V4.5C16.1422 4.5 19.5001 7.85786 19.5001 12C19.5001 16.1421 16.1422 19.5 12.0001 19.5V20.5C16.6945 20.5 20.5001 16.6944 20.5001 12Z"},null,-1)]))}var g=s(938793);const p={},N=(0,g.A)(p,[["render",C]])},579808:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={class:"score-placeholder"};function C(tt,j,lt,x,q,G){return(0,t.uX)(),(0,t.CE)("div",c,[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(6,Z=>(0,t.Lk)("div",{class:"s",key:Z},[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(5,F=>(0,t.Lk)("div",{key:F})),64))])),64))])}const g={name:"ScoreLoading"};var p=s(938793);const N=(0,p.A)(g,[["render",C]])},657803:(b,S,s)=>{"use strict";b.exports=s.p+"img/a76f5c2c4d67056e104d.svg"},669753:(b,S,s)=>{"use strict";b.exports=s.p+"img/68ffea003cc26d79c656.svg"},680049:(b,S,s)=>{var t=s(702504);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("2e18c231",t,!0,{})},699247:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.master_cd5Zk{display:flex;align-items:center;gap:8px;font:var(--text-sm-semibold)}
`,""]),p.locals={master:"master_cd5Zk"};const B=p},702504:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.PlaybackVolume_M1uK7{display:flex;flex-direction:column;gap:16px;padding:16px;color:var(--text-general-primary)}.tracks_NfC0V{max-height:calc(100vh - 275px);overflow:auto;display:flex;flex-direction:column;gap:8px;background:linear-gradient(#fff 30%,#fff0) center top,linear-gradient(#fff0,#fff 70%) center bottom,linear-gradient(180deg,#fff0,#2f34461a) center top,linear-gradient(180deg,#fff0,#2f34461a) center bottom;background-repeat:no-repeat;background-size:100% 40px,100% 40px,100% 14px,100% 14px;background-attachment:local,local,scroll,scroll}.footer_XbwPl{display:flex;flex-direction:column;align-items:center}.persistButtons_bVX7S{display:flex;gap:8px}.volumePersistHelp_UMN4D{display:flex;align-items:center;gap:4px;margin-top:8px;color:var(--text-general-secondary)}
`,""]),p.locals={PlaybackVolume:"PlaybackVolume_M1uK7",tracks:"tracks_NfC0V",footer:"footer_XbwPl",persistButtons:"persistButtons_bVX7S",volumePersistHelp:"volumePersistHelp_UMN4D"};const B=p},717045:(b,S,s)=>{"use strict";s.d(S,{n:()=>g});var t=s(6645),c=s(744056),C=s(361744);const g=(0,t.nY)("scoreCollaborators",()=>{const p=(0,c.Kh)({});function B({uid:tt,collaborator:j}){Object.assign(p,{[tt]:j})}const N=(0,C.EW)(()=>{const tt={},j=p;return Object.keys(j).forEach(lt=>{j[lt].session&&(tt[lt]=j[lt])}),tt});return{collaborators:p,setCollaborator:B,onlineCollaborators:N}})},773067:(b,S,s)=>{"use strict";s.d(S,{V:()=>B});var t=s(973705),c=s(6645),C=s(744056),g=s(361744);const p=N=>{var tt;return N=Object.assign({},N),delete N.scoreData,(tt=N.options)!=null&&tt.pdfJobs&&(N.options=Object.assign({},N.options),delete N.options.pdfJobs),JSON.parse(JSON.stringify(N))},B=(0,c.nY)("exports",()=>{const N=(0,C.KR)([]),tt=(0,g.EW)(()=>N.value&&N.value.length>0),j=(0,g.EW)(()=>N.value.filter(F=>["created","doing"].includes(F.state)).length),lt=(0,g.EW)(()=>N.value.findIndex(F=>F.state==="done"||F.state==="error")>=0);function x(F){F.task=F.task||{};const st=N.value.findIndex(z=>F.id===z.id);st>=0?N.value[st]=p(F):N.value.push(p(F))}function q(F){const st=N.value.findIndex(z=>F.id===z.id);st>=0&&N.value.splice(st)}function G({job:F,error:st}){Object.assign(F,{state:"error",error:(0,t.b)(st)}),x(F)}function Z(){N.value=N.value.filter(F=>F.state!=="error"&&F.state!=="done")}return{jobs:N,hasExportsToDisplay:tt,countOngoing:j,canClearExports:lt,upsert:x,done:q,error:G,clear:Z}})},773153:(b,S,s)=>{"use strict";s.d(S,{R:()=>c});var t=s(6645);const c=(0,t.nY)("vibrations",()=>{function C(g){var p;(p=window.navigator)!=null&&p.vibrate&&window.navigator.vibrate(g)}return{vibrate:C}})},820067:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function C(tt,j){return(0,t.uX)(),(0,t.CE)("svg",c,j[0]||(j[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.5 7C5.67157 7 5 7.67157 5 8.5V15.5C5 16.3284 5.67157 17 6.5 17H17.5C18.3284 17 19 16.3284 19 15.5V8.5C19 7.67157 18.3284 7 17.5 7H6.5ZM4 8.5C4 7.11929 5.11929 6 6.5 6H17.5C18.8807 6 20 7.11929 20 8.5V15.5C20 16.8807 18.8807 18 17.5 18H6.5C5.11929 18 4 16.8807 4 15.5V8.5Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9 8.19098L16.618 12L9 15.809V8.19098ZM10 9.80902V14.191L14.382 12L10 9.80902Z"},null,-1)]))}var g=s(938793);const p={},N=(0,g.A)(p,[["render",C]])},823661:(b,S,s)=>{var t=s(234010);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("44667d33",t,!0,{})},824977:(b,S,s)=>{var t=s(75848);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("1d16ae64",t,!0,{})},830128:(b,S,s)=>{"use strict";s.d(S,{A:()=>Nt});var t=s(361744),c=s(538065),C=s(555381),g=s(657803),p=s(486822),B=s(669753);const N=s.p+"img/ddbd129b4af4c11ca2a6.svg",tt={class:"sc-aud-ctrls no-select",role:"region","aria-label":"Audio controls"},j={key:0,class:"plays-remaining"},lt={class:"counter"},x={key:1,class:"ddn-warn-container"},q={class:"ddn-content"},G={key:0,class:"ddn-warn"},Z={class:"warn"},F={class:"cta"},st={key:1,class:"ddn-warn"},z={class:"desc"},_={key:0,class:"cta"},M={key:1,class:"cta"},L={key:1,class:"icon-play-loader"},R={key:3},W={class:"play-dropdown sc-aud-dropdown ddn-content","aria-label":"Audio options",role:"region"},A={key:0,class:"tracks-list aud-ul"},J=["onClick","arial-label"],U={class:"icon"},et={key:1,src:g,alt:"SoundCloud"},$={key:2,src:p,alt:"YouTube"},r={key:3,src:B,alt:"Vimeo"},a={key:4,src:N,alt:"Flat"},f={class:"text"},d={class:"icon"},v={key:0,class:"power-box"},T={key:1,class:"options-recordings"},E=["aria-label"],k={key:7,class:"sc-metronome"},Y=["aria-label"],ct={class:"sc-aud-dropdown ddn-content"},it=["aria-label"],Bt={class:"icon-player ddn-trigger","aria-label":"Volume"},Ot={key:9,class:"sc-audio-record"};function It(X,m,ot,K,ht,ut){const Rt=(0,t.g2)("f-button"),vt=(0,t.g2)("stop-icon"),Et=(0,t.g2)("play-icon"),Wt=(0,t.g2)("flatIcon"),xe=(0,t.g2)("PowerBadgeIcon"),Ie=(0,t.g2)("PlaybackSpeedIcon"),we=(0,t.g2)("PlaybackSpeed"),le=(0,t.g2)("RecordingsIcon"),Be=(0,t.g2)("pianoKeyboard"),Re=(0,t.g2)("MetronomeCountingIcon"),n=(0,t.g2)("MetronomeIcon"),e=(0,t.g2)("MetronomeMutedIcon"),o=(0,t.g2)("MetronomeSettings"),i=(0,t.g2)("VolumeIcon"),l=(0,t.g2)("PlaybackVolume"),u=(0,t.g2)("ScoreAudioRecording"),P=(0,t.gN)("tooltip"),O=(0,t.gN)("dropdown");return(0,t.uX)(),(0,t.CE)("div",tt,[K.rendered&&K.hasPlaysLimit?(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",j,[m[12]||(m[12]=(0,t.Lk)("svg",{inline:"",alt:"Playback limit",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},[(0,t.Lk)("path",{d:"M11.64 13.623c-.199 0-.385-.042-.522-.104-.49-.254-.834-.606-1.178-1.639-.351-1.074-1.012-1.577-1.646-2.065-.544-.42-1.109-.854-1.597-1.743-.365-.66-.565-1.384-.565-2.024a3.41 3.41 0 013.443-3.443c1.763 0 3.188 1.274 3.409 2.968a.565.565 0 00.564.475h.235a.578.578 0 00.571-.648c-.31-2.39-2.293-4.173-4.779-4.173-2.706 0-4.82 2.114-4.82 4.82 0 .868.261 1.826.736 2.686.627 1.137 1.364 1.708 1.963 2.17.558.427.957.736 1.178 1.411.413 1.254.943 1.956 1.88 2.445a2.76 2.76 0 003.788-1.777.582.582 0 00-.559-.737h-.24c-.262 0-.469.186-.559.434a1.376 1.376 0 01-1.301.944zM4.735 1.207a.696.696 0 00-1.033.048A7.587 7.587 0 002 6.048c0 1.818.64 3.484 1.7 4.786a.694.694 0 001.027.055.677.677 0 00.048-.91 6.221 6.221 0 01-1.398-3.931c0-1.495.53-2.865 1.405-3.926a.678.678 0 00-.048-.915zm3.12 4.84a1.722 1.722 0 103.444 0 1.722 1.722 0 00-3.445 0z",fill:"#4DA3F8","fill-rule":"evenodd"})],-1)),m[13]||(m[13]=(0,t.Lk)("svg",{inline:"",class:"x",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},[(0,t.Lk)("path",{d:"M5.077 3.674l.095.083 2.827 2.827 2.83-2.827a1 1 0 011.497 1.32l-.083.095-2.829 2.827 2.829 2.83a1 1 0 01-1.32 1.497l-.095-.083L8 9.414l-2.827 2.829a1 1 0 01-1.498-1.32l.083-.095L6.584 8 3.757 5.172a1 1 0 011.32-1.498z",fill:"#363C50","fill-rule":"evenodd",class:"fill"})],-1)),(0,t.Lk)("span",lt,(0,c.v_)(K.remainingPlays),1)])),[[P,{text:X.$t("flat:score.playback.playback-limit-desc")}]]):(0,t.Q3)("",!0),ut.displayWarn?(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",x,[m[20]||(m[20]=(0,t.Lk)("button",{class:"icon-player warn main ddn-trigger","aria-label":"Retry loading audio playback"},[(0,t.Lk)("svg",{inline:"",xmlns:"http://www.w3.org/2000/svg",width:"22",height:"19",viewBox:"0 0 22 19"},[(0,t.Lk)("path",{d:"M0 19h22L11 0 0 19zm12-3h-2v-2h2v2zm0-4h-2V8h2v4z",class:"fill"})])],-1)),(0,t.Lk)("div",q,[m[19]||(m[19]=(0,t.Lk)("div",{"x-arrow":""},null,-1)),K.pendingRetry?((0,t.uX)(),(0,t.CE)("div",G,[m[16]||(m[16]=(0,t.Lk)("div",{class:"desc"}," Sorry, the following instruments sounds failed to load. It is probably due to an issue with your network connectivity. ",-1)),(0,t.Lk)("ul",Z,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(K.missingSoundfontsIds,w=>((0,t.uX)(),(0,t.CE)("li",{key:w},[m[14]||(m[14]=(0,t.Lk)("svg",{inline:"",xmlns:"http://www.w3.org/2000/svg",width:"22",height:"19",viewBox:"0 0 22 19"},[(0,t.Lk)("path",{d:"M0 19h22L11 0 0 19zm12-3h-2v-2h2v2zm0-4h-2V8h2v4z",class:"fill"})],-1)),(0,t.eW)(" "+(0,c.v_)(w),1)]))),128))]),(0,t.Lk)("div",F,[(0,t.bF)(Rt,{onClick:m[0]||(m[0]=w=>ot.audio.retrySoundfontsLoading())},{default:(0,t.k6)(()=>m[15]||(m[15]=[(0,t.eW)("Retry loading playback",-1)])),_:1,__:[15]})])])):K.errorCode?((0,t.uX)(),(0,t.CE)("div",st,[(0,t.Lk)("div",z,(0,c.v_)(X.$t(`flat:dacapo.errors.${K.errorCode}`)),1),K.errorCode==="compat"?((0,t.uX)(),(0,t.CE)("div",_,[(0,t.bF)(Rt,{href:"/browser-upgrade"},{default:(0,t.k6)(()=>m[17]||(m[17]=[(0,t.eW)("Upgrade my web browser",-1)])),_:1,__:[17]})])):K.errorCode==="connection-overflow"?((0,t.uX)(),(0,t.CE)("div",M,[(0,t.bF)(Rt,{onClick:m[1]||(m[1]=w=>ut.pageReload())},{default:(0,t.k6)(()=>m[18]||(m[18]=[(0,t.eW)("Reload the page",-1)])),_:1,__:[18]})])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)])])),[[O]]):ut.displayPlayButton?(0,t.bo)(((0,t.uX)(),(0,t.CE)("button",{key:2,onClick:m[2]||(m[2]=w=>ot.audio.playToggle()),class:(0,c.C4)(["icon-player main",{[X.$style["control-item"]]:!0,[X.$style.disabled]:K.disablePlayback}]),"data-cy":"play-button","aria-label":"Play or Stop"},[K.rendered&&!K.loading?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[K.playing?((0,t.uX)(),(0,t.Wv)(vt,{key:0,class:(0,c.C4)(X.$style.stop)},null,8,["class"])):((0,t.uX)(),(0,t.Wv)(Et,{key:1,class:(0,c.C4)(X.$style.play)},null,8,["class"]))],64)):((0,t.uX)(),(0,t.CE)("span",L))],2)),[[P,{text:X.$t("editor:toolbar.playback.title",{playShortcut:ut.playShortcut,playBegShortcut:ut.playBegShortcut})}]]):(0,t.Q3)("",!0),ut.displayAudioDropdown?(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",R,[m[22]||(m[22]=(0,t.Lk)("button",{class:"play-dropdown-trigger ddn-trigger","aria-label":"Audio options"},[(0,t.Lk)("svg",{inline:"",width:"14",height:"9",viewBox:"0 0 14 9",xmlns:"http://www.w3.org/2000/svg"},[(0,t.Lk)("path",{d:"M1.05 1.914l5.827 5.173 5.827-5.174","stroke-linecap":"round",stroke:"#FFF","stroke-width":"2","stroke-linejoin":"round",fill:"none"})])],-1)),(0,t.Lk)("div",W,[m[21]||(m[21]=(0,t.Lk)("div",{"x-arrow":""},null,-1)),K.hasTracks?((0,t.uX)(),(0,t.CE)("ul",A,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(K.tracks,w=>((0,t.uX)(),(0,t.CE)("li",{key:w.id,class:(0,c.C4)({active:w.id===K.currentTrack})},[(0,t.Lk)("button",{onClick:rt=>ot.audio.useTrack(w.id),"arial-label":`Use track: ${w.title}`},[(0,t.Lk)("span",U,[w.id==="playback-mp3"?((0,t.uX)(),(0,t.Wv)(Wt,{key:0,class:"flat-logo"})):w.type==="soundcloud"?((0,t.uX)(),(0,t.CE)("img",et)):w.type==="youtube"?((0,t.uX)(),(0,t.CE)("img",$)):w.type==="vimeo"?((0,t.uX)(),(0,t.CE)("img",r)):w.type==="audio"?((0,t.uX)(),(0,t.CE)("img",a)):(0,t.Q3)("",!0)]),(0,t.Lk)("span",f,(0,c.v_)(w.title||X.$t("flat:recordings.untitled-recording")),1)],8,J)],2))),128)),ut.displayFlatPlayback?((0,t.uX)(),(0,t.CE)("li",{key:0,class:(0,c.C4)({active:!K.currentTrack})},[(0,t.Lk)("button",{onClick:m[3]||(m[3]=w=>ot.audio.useTrack()),"aria-label":"Use playback audio"},[(0,t.Lk)("span",d,[(0,t.bF)(Wt,{class:"flat-logo"})]),(0,t.Lk)("span",null,(0,c.v_)(X.$t("flat:score.playback.title-short")),1)])],2)):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),!K.restrictToAudioTracks&&(K.canChangePlaybackSpeed||K.scoreWrite&&!ut.isEmbed)?((0,t.uX)(),(0,t.CE)("ul",{key:1,class:(0,c.C4)(["aud-ul options",{"has-recording":K.hasTracks}])},[K.canChangePlaybackSpeed?((0,t.uX)(),(0,t.CE)("li",{key:0,class:"options-recordings",onTouchstart:m[4]||(m[4]=(0,C.D$)(()=>{},["stop"])),onTouchend:m[5]||(m[5]=(0,C.D$)(()=>{},["stop"])),onClick:m[6]||(m[6]=(0,C.D$)(()=>{},["stop"]))},[ut.enabledFeatureAdvancedPlayback?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",v,[(0,t.bF)(xe,{class:"power-icon"})])),(0,t.Lk)("div",null,[(0,t.bF)(Ie),(0,t.Lk)("span",null,(0,c.v_)(X.$t("flat:play-speed.title"))+":",1),(0,t.bF)(we,{audio:ot.audio,onOnShowUpgradeDialog:ut.handleOnShowUpgradeDialog},null,8,["audio","onOnShowUpgradeDialog"])])],32)):(0,t.Q3)("",!0),K.scoreWrite&&!ut.isEmbed&&!K.displayMobileEditor&&!K.isMusicSnippet&&K.isCloudScore?((0,t.uX)(),(0,t.CE)("li",T,[(0,t.Lk)("button",{onClick:m[7]||(m[7]=w=>ut.editRecordingTrack()),"aria-label":X.$t("flat:recordings.manage")},[(0,t.bF)(le),(0,t.Lk)("span",null,(0,c.v_)(X.$t("flat:recordings.manage")),1)],8,E)])):(0,t.Q3)("",!0)],2)):(0,t.Q3)("",!0)])])),[[O,{placement:ot.ddnPlacement}]]):(0,t.Q3)("",!0),!ut.displayWarn&&K.playing&&ut.displayPlayButton?(0,t.bo)(((0,t.uX)(),(0,t.CE)("button",{key:4,onClick:m[8]||(m[8]=w=>ot.audio.goBeginning()),class:"icon-player sc-rewind","aria-label":"Play at the beginning"},m[23]||(m[23]=[(0,t.Lk)("svg",{inline:"",width:"9",height:"12",viewBox:"0 0 9 12",xmlns:"http://www.w3.org/2000/svg"},[(0,t.Lk)("path",{d:"M1 6.83l7.545 5.12a.3.3 0 0 0 .3.017.286.286 0 0 0 .155-.253V.286a.288.288 0 0 0-.155-.254.3.3 0 0 0-.3.018L1 5.17V0H0v12h1V6.83z",fill:"#E7E8EC","fill-rule":"evenodd",class:"fill stoke"})],-1)]))),[[P,{text:X.$t("editor:toolbar.rewind.title",{playShortcut:ut.playShortcut,playBegShortcut:ut.playBegShortcut})}]]):(0,t.Q3)("",!0),!ut.displayWarn&&K.playing&&ut.displayPlayButton?(0,t.bo)(((0,t.uX)(),(0,t.CE)("button",{key:5,onClick:m[9]||(m[9]=w=>ot.audio.pauseToggle()),class:(0,c.C4)(["icon-player sc-pause",{paused:K.pausing}]),"aria-label":"Pause"},m[24]||(m[24]=[(0,t.Lk)("svg",{inline:"",width:"10",height:"12",viewBox:"0 0 10 12",xmlns:"http://www.w3.org/2000/svg"},[(0,t.Lk)("path",{d:"M0 1.002A1 1 0 0 1 1 0h1c.553 0 1 .456 1 1.002v9.996A1 1 0 0 1 2 12H1c-.553 0-1-.456-1-1.002V1.002zm7 0A1 1 0 0 1 8 0h1c.553 0 1 .456 1 1.002v9.996A1 1 0 0 1 9 12H8c-.553 0-1-.456-1-1.002V1.002z",fill:"#E7E8EC","fill-rule":"evenodd",class:"fill"})],-1)]),2)),[[P,{text:X.$t("editor:toolbar.pause.title")}]]):(0,t.Q3)("",!0),ot.displayInstrumentVisualisation&&(K.hasTabStaff||K.staffStyle==="pitched")?((0,t.uX)(),(0,t.CE)("button",{key:6,class:(0,c.C4)(["icon-player",{[X.$style["sc-instrument-visualisation"]]:!0,[X.$style.active]:K.showInstrumentVisualisation}]),"aria-label":"Instrument Visualisation",onClick:m[10]||(m[10]=w=>K.toggleInstrumentVisualisation(!K.showInstrumentVisualisation))},[(0,t.bF)(Be)],2)):(0,t.Q3)("",!0),!K.pendingRetry&&!K.errorCode?(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",k,[(0,t.bo)(((0,t.uX)(),(0,t.CE)("button",{class:(0,c.C4)(["icon-player ddn-trigger",X.$style.btnMetronome]),"aria-label":X.$t("editor:toolbar.metronome.title")},[K.metronomeMode===ht.MetronomeModes.COUNT_IN?((0,t.uX)(),(0,t.Wv)(Re,{key:0,title:X.$t("flat:editor.metronome.count")},null,8,["title"])):K.metronomeMode===ht.MetronomeModes.CONTINUOUS?((0,t.uX)(),(0,t.Wv)(n,{key:1,title:X.$t("flat:editor.metronome.on")},null,8,["title"])):K.metronomeMode===ht.MetronomeModes.DISABLED?((0,t.uX)(),(0,t.Wv)(e,{key:2,title:X.$t("flat:editor.metronome.off")},null,8,["title"])):(0,t.Q3)("",!0)],10,Y)),[[P,{text:X.$t("editor:toolbar.metronome.title")}]]),(0,t.Lk)("div",ct,[m[25]||(m[25]=(0,t.Lk)("div",{"x-arrow":""},null,-1)),(0,t.bF)(o,{audio:ot.audio,class:(0,c.C4)(X.$style.ddnMetronome)},null,8,["audio","class"])])])),[[O,{placement:ot.ddnPlacement}]]):(0,t.Q3)("",!0),!K.currentTrack&&!K.recording&&!K.recorded?(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",{key:8,class:"sc-volume","aria-label":X.$t("editor:toolbar.volume.title"),role:"region"},[(0,t.bo)(((0,t.uX)(),(0,t.CE)("button",Bt,[(0,t.bF)(i)])),[[P,{text:X.$t("editor:toolbar.volume.title")}]]),(0,t.Lk)("div",{class:"sc-aud-dropdown sc-volume-dropdown ddn-content",onClick:m[11]||(m[11]=(0,C.D$)(()=>{},["stop"]))},[m[26]||(m[26]=(0,t.Lk)("div",{"x-arrow":""},null,-1)),ht.ddnAudioOpened?((0,t.uX)(),(0,t.Wv)(l,{key:0,audio:ot.audio,"score-data":ot.scoreData},null,8,["audio","score-data"])):(0,t.Q3)("",!0)])],8,it)),[[O,{placement:ot.ddnPlacement,onOpen:ut.onOpen,onClose:ut.onClose}]]):(0,t.Q3)("",!0),K.scoreWrite&&K.online&&ut.hasAudioRecordingBeta?((0,t.uX)(),(0,t.CE)("div",Ot,[(0,t.bF)(u,{audio:ot.audio},null,8,["audio"])])):(0,t.Q3)("",!0)])}var I=s(989353),h=s(135519),y=s(121648),D=s(591340),H=s(990244),V=s(909696),Q=s(356792),at=s(788116),_t=s(778288),Pt=s(992218),Ct=s(797727),Mt=s(931720),Kt=s(472243),wt=s(763939),gt=s(544582),dt=s(689850),Dt=s(147758),At=s(26292),Lt=s(6645),pt=s(131003),mt=s(940168),yt=s(522698),bt=s(565443),Vt=s(820067),Xt=s(258230),Ft=s(727825);const $t={key:0,inline:"",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"black",width:"18px",height:"18px"},nt={key:1,class:"audio-record-stop-button"},ft={key:2,class:"audio-record-loader"},Ut={key:0,class:"audio-record-playback-play-button"},kt={key:1,class:"audio-record-playback-pause-button",inline:"",width:"10",height:"12",viewBox:"0 0 10 12",xmlns:"http://www.w3.org/2000/svg"},jt={key:2,class:"audio-record-status"},ce={class:"audio-record-timer"},ue={key:3,class:"audio-record-post"},he={class:"audio-record-playback-slider",ref:"progress-bar","aria-valuetext":"seek audio bar for recorded track","aria-valuemax":"100","aria-valuemin":"0",role:"slider"},fe={class:"audio-record-timer"},Qt={class:"audio-record-post-validation"},ge={key:0,inline:"",width:"12",height:"9",xmlns:"http://www.w3.org/2000/svg"},pe={key:1,class:"audio-record-upload-loader"};function Jt(X,m,ot,K,ht,ut){return(0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)(["audio-record-area",{active:K.recording||X.recorded}])},[X.recorded?((0,t.uX)(),(0,t.CE)("button",{key:1,onClick:m[1]||(m[1]=Rt=>X.toggleRecordingPlayback()),class:"icon-player"},[X.isPlaying?((0,t.uX)(),(0,t.CE)("svg",kt,m[5]||(m[5]=[(0,t.Lk)("path",{d:"M0 1.002A1 1 0 0 1 1 0h1c.553 0 1 .456 1 1.002v9.996A1 1 0 0 1 2 12H1c-.553 0-1-.456-1-1.002V1.002zm7 0A1 1 0 0 1 8 0h1c.553 0 1 .456 1 1.002v9.996A1 1 0 0 1 9 12H8c-.553 0-1-.456-1-1.002V1.002z",fill:"#E7E8EC","fill-rule":"evenodd",class:"fill"},null,-1)]))):((0,t.uX)(),(0,t.CE)("span",Ut))])):((0,t.uX)(),(0,t.CE)("button",{key:0,onClick:m[0]||(m[0]=Rt=>ut.toggleAudioRecording()),class:(0,c.C4)(["icon-player",{active:K.recording}]),"aria-label":"Record audio"},[!K.recording&&!X.pendingRecording?((0,t.uX)(),(0,t.CE)("svg",$t,m[4]||(m[4]=[(0,t.Lk)("path",{d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,t.Lk)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"},null,-1)]))):K.recording&&!X.pendingRecording?((0,t.uX)(),(0,t.CE)("span",nt)):((0,t.uX)(),(0,t.CE)("span",ft))],2)),K.recording?((0,t.uX)(),(0,t.CE)("div",jt,[(0,t.Lk)("span",ce,(0,c.v_)(K.recordTimeFormat),1)])):(0,t.Q3)("",!0),X.recorded?((0,t.uX)(),(0,t.CE)("div",ue,[(0,t.Lk)("div",he,[(0,t.Lk)("div",{class:"audio-record-playback-progress",style:(0,c.Tr)({width:`${X.percentProgress}%`})},m[6]||(m[6]=[(0,t.Lk)("span",{class:"audio-record-playback-slider-handle"},null,-1)]),4)],512),(0,t.Lk)("span",fe,(0,c.v_)(X.currentPlaybackTimeStr),1),(0,t.Lk)("div",Qt,[(0,t.Lk)("button",{onClick:m[2]||(m[2]=Rt=>ut.discardRecording()),class:"audio-record-discard-button icon-player"},m[7]||(m[7]=[(0,t.Lk)("svg",{inline:"",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg"},[(0,t.Lk)("path",{d:"M5.077 3.674l.095.083 2.827 2.827 2.83-2.827a1 1 0 011.497 1.32l-.083.095-2.829 2.827 2.829 2.83a1 1 0 01-1.32 1.497l-.095-.083L8 9.414l-2.827 2.829a1 1 0 01-1.498-1.32l.083-.095L6.584 8 3.757 5.172a1 1 0 011.32-1.498z",fill:"#363C50","fill-rule":"evenodd",class:"fill"})],-1)])),(0,t.Lk)("button",{onClick:m[3]||(m[3]=Rt=>ut.saveRecording()),class:"audio-record-save-button icon-player"},[ht.uploading?((0,t.uX)(),(0,t.CE)("span",pe)):((0,t.uX)(),(0,t.CE)("svg",ge,m[8]||(m[8]=[(0,t.Lk)("path",{d:"M9.463.292l-5.88 5.88-1.88-1.88a.996.996 0 10-1.41 1.41l2.59 2.59c.39.39 1.02.39 1.41 0l6.59-6.59a.996.996 0 000-1.41c-.39-.39-1.03-.39-1.42 0z",fill:"#363C50","fill-rule":"evenodd"},null,-1)])))])])])):(0,t.Q3)("",!0)],2)}var me=s(653154),Zt=s(674548),qt=s(941271),te=s(459356),ve=s(410296),ee=(X,m,ot)=>new Promise((K,ht)=>{var ut=Et=>{try{vt(ot.next(Et))}catch(Wt){ht(Wt)}},Rt=Et=>{try{vt(ot.throw(Et))}catch(Wt){ht(Wt)}},vt=Et=>Et.done?K(Et.value):Promise.resolve(Et.value).then(ut,Rt);vt((ot=ot.apply(X,m)).next())});const ye={name:"ScoreAudioRecording",props:{audio:{type:Object,required:!0}},mixins:[ve.A],setup(){const{setTrack:X,startEdit:m}=(0,dt.w)(),ot=(0,gt.o)(),K=(0,te.O)(),ht=(0,qt.B)();return{setTrack:X,startEdit:m,recording:(0,t.EW)(()=>ot.recording),recordTimeFormat:(0,t.EW)(()=>ot.recordTimeFormat),displayMessage:K.displayMessage,displayError:K.displayError,addExperience:ht.addExperience}},data(){return{uploading:!1}},methods:{toggleAudioRecording(){this.recording?this.stopAudioRecording():this.startAudioRecording()},startAudioRecording(){return ee(this,null,function*(){this.init(),this.pendingRecordingStart=!0,yield this.audio.startAudioRecording(),this.pendingRecordingStart=!1})},saveRecording(){return ee(this,null,function*(){this.stopRecordingPlayback(),this.uploading=!0;const X=new Date;try{this.mp3Data=this.audio.getRecordedArrayBuffer(),this.mp3DataStr=this.audio.convertArrayBufferToBase64(this.mp3Data);const m=yield Kt.A.create(this.score.id,{title:`Recording - ${X.getHours()}:${X.getMinutes()}:${X.getSeconds()}`,dataEncoding:"base64",data:this.mp3DataStr});this.setTrack(JSON.parse(JSON.stringify(m))),this.audio.setTrackObject(m),this.addExperience("score.track.add"),this.audio.resetAudioRecording(),this.uploading=!1,this.displayMessage({type:"default",dismissAfter:6e3,text:Zt.MR.t("flat:audio-recording.success"),link:{text:Zt.MR.t("flat:open").toLocaleUpperCase(),fnc:()=>{this.startEdit(m.id)}}}),this.addExperience("score.audio-recording.uploaded")}catch(m){this.displayError({error:m}),this.loading=!1,(0,me.vV)(m)}})},discardRecording(){this.recordedData=null,this.mp3DataBlob=null,this.mp3Url=null,this.stopRecordingPlayback(),this.audio.resetAudioRecording()}}};var se=s(938793);const Ee=(0,se.A)(ye,[["render",Jt]]);var Pe=s(154982),oe=s(935902),Se=s(560976),Me=Object.defineProperty,De=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable,re=(X,m,ot)=>m in X?Me(X,m,{enumerable:!0,configurable:!0,writable:!0,value:ot}):X[m]=ot,Te=(X,m)=>{for(var ot in m||(m={}))Ae.call(m,ot)&&re(X,ot,m[ot]);if(ie)for(var ot of ie(m))xt.call(m,ot)&&re(X,ot,m[ot]);return X},ae=(X,m)=>De(X,Ce(m)),Gt=(X,m,ot)=>new Promise((K,ht)=>{var ut=Et=>{try{vt(ot.next(Et))}catch(Wt){ht(Wt)}},Rt=Et=>{try{vt(ot.throw(Et))}catch(Wt){ht(Wt)}},vt=Et=>Et.done?K(Et.value):Promise.resolve(Et.value).then(ut,Rt);vt((ot=ot.apply(X,m)).next())});const Le={name:"ScoreAudioControls",components:{ScoreAudioRecording:Ee,PlaybackVolume:Pe.A,MetronomeSettings:oe.A,PlaybackSpeed:Se.A,flatIcon:Q.A,pianoKeyboard:at.A,PowerBadgeIcon:Ct.default,StopIcon:_t.A,PlayIcon:Pt.A,VolumeIcon:Xt.A,MetronomeCountingIcon:mt.A,MetronomeIcon:pt.A,MetronomeMutedIcon:yt.A,PlaybackSpeedIcon:bt.A,RecordingsIcon:Vt.A},props:{audio:{type:Object,required:!0},scoreData:{type:Object,required:!0},hideFlatPlayback:{type:Boolean,default:!1},ddnPlacement:{type:String,default:"bottom"},displayTracks:{type:Boolean,default:!0},displayInstrumentVisualisation:{type:Boolean,default:!1}},setup(){const X=(0,wt.F)(),m=(0,dt.w)(),ot=(0,H.s)(),K=(0,h.d)(),ht=(0,gt.o)(),ut=(0,D.U)(),Rt=(0,y.W)(),vt=(0,V.q6)(),Et=(0,Ft.N)();return{account:(0,t.EW)(()=>X.account),accountFeatures:(0,t.EW)(()=>X.accountFeatures),isMusicSnippet:(0,t.EW)(()=>vt.isMusicSnippet),tracks:(0,t.EW)(()=>m.tracks),hasTracks:(0,t.EW)(()=>m.hasTracks),defaultTrack:(0,t.EW)(()=>m.defaultTrack),createNewTrack:m.createNewTrack,online:(0,t.EW)(()=>ot.online),mainShortcutByAction:(0,t.EW)(()=>K.mainShortcutByAction),errorCode:(0,t.EW)(()=>ht.errorCode),disablePlayback:(0,t.EW)(()=>ht.disablePlayback),playing:(0,t.EW)(()=>ht.playing),pausing:(0,t.EW)(()=>ht.pausing),recording:(0,t.EW)(()=>ht.recording),recorded:(0,t.EW)(()=>ht.recorded),loading:(0,t.EW)(()=>ht.loading),pendingRetry:(0,t.EW)(()=>ht.pendingRetry),metronomeMode:(0,t.EW)(()=>ht.metronomeMode),currentTrack:(0,t.EW)(()=>ht.currentTrack),missingSoundfontsIds:(0,t.EW)(()=>ht.humanizedMissingSoundfontsIds),canChangePlaybackSpeed:(0,t.EW)(()=>ht.canChangePlaybackSpeed),hasPlaysLimit:(0,t.EW)(()=>ht.hasPlaysLimit),remainingPlays:(0,t.EW)(()=>ht.remainingPlays),restrictToAudioTracks:(0,t.EW)(()=>ht.restrictToAudioTracks),isPerformerMode:(0,t.EW)(()=>ht.isPerformerMode),env:(0,t.EW)(()=>ut.env),scoreWrite:(0,t.EW)(()=>ut.scoreWrite),hasTabStaff:(0,t.EW)(()=>Rt.hasTabStaff),staffStyle:(0,t.EW)(()=>Rt.staffStyle),rendered:(0,t.EW)(()=>vt.rendered),parts:(0,t.EW)(()=>vt.parts),isCloudScore:(0,t.EW)(()=>vt.isCloudScore),displayMobileEditor:(0,t.EW)(()=>vt.displayMobileEditor),loadDocumentSettings:vt.loadDocumentSettings,showInstrumentVisualisation:(0,t.EW)(()=>vt.showInstrumentVisualisation),toggleInstrumentVisualisation:vt.toggleInstrumentVisualisation,score:(0,t.EW)(()=>Et.score)}},data(){return{MetronomeModes:I.p4,ddnAudioOpened:!1}},computed:{playShortcut(){const X=this.mainShortcutByAction.togglePlayStopResume;return X?(0,At.lD)(X.shortcuts):""},playBegShortcut(){const X=this.mainShortcutByAction.playFromBegining;return X?(0,At.lD)(X.shortcuts):""},enabledFeatureAdvancedPlayback(){return this.accountFeatures.reverbPlayback||this.isEmbed},isEmbed(){return this.env==="embed"},hasAudioRecordingBeta(){var X,m;return(m=(X=this.account)==null?void 0:X.experience)==null?void 0:m.includes("editor.recording")},displayWarn(){return this.pendingRetry||this.errorCode},displayAudioDropdown(){return this.env==="performance"||this.isPerformerMode?!1:this.displayFlatPlayback||this.tracks.length>1},displayPlayButton(){return!(this.recording||this.recorded||this.env==="performance"&&this.hasTracks)},displayFlatPlayback(){return!this.hasTracks||!this.currentTrack?!0:!this.hideFlatPlayback&&!this.restrictToAudioTracks}},methods:ae(Te({},(0,Lt.i0)(Mt.B,["showUpgradeDialog"])),{pageReload(){window.location.reload(!0)},editRecordingTrack(){this.hasTracks?this.loadDocumentSettings("tracks"):this.createNewTrack()},toggleAudioRecording(){this.recording?this.stopAudioRecording():this.startAudioRecording()},startAudioRecording(){this.audio.startAudioRecording()},stopAudioRecording(){return Gt(this,null,function*(){const X=yield this.audio.stopAudioRecording(),m=this.audio.convertArrayBufferToBase64(X),ot=new Date,K=Kt.A.create(this.score.id,{title:`Recording - ${ot.toDateString()}`,dataEncoding:"base64",data:m});this.audio.setTrackObject(K)})},onOpen(){this.ddnAudioOpened=!0},onClose(){this.ddnAudioOpened=!1},handleOnShowUpgradeDialog(){this.audio.stopIfPlaying(),(0,Dt.Y)()}})};var ne=s(898262),be=s.n(ne),Oe=s(935330);const Yt={};Yt.$style=be();const Nt=(0,se.A)(Le,[["render",It],["__cssModules",Yt]])},898262:(b,S,s)=>{var t=s(330957);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("46be14be",t,!0,{})},906225:(b,S,s)=>{var t=s(430590);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("7487d4e8",t,!0,{})},935330:(b,S,s)=>{var t=s(320698);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("52c62d98",t,!0,{})},935902:(b,S,s)=>{"use strict";s.d(S,{A:()=>R});var t=s(361744),c=s(538065),C=s(555381),g=s(744056),p=s(989353),B=s(971609),N=s(544582),tt=s(6645),j=s(131003),lt=s(940168),x=s(522698);const q=["data-active"],G=["data-active"],Z=["data-active"],F=(0,t.pM)({__name:"MetronomeSettings",props:{audio:{}},setup(W){const A=(0,N.o)(),{metronomeMode:J}=(0,tt.bP)(A),U=(0,t.EW)(()=>J.value===p.p4.CONTINUOUS),et=(0,t.EW)(()=>J.value===p.p4.COUNT_IN),$=(0,t.EW)(()=>J.value===p.p4.DISABLED),r=W;function a(f){r.audio.setMetronomeMode(f)}return r.audio&&r.audio.getMetronomeMode(),(f,d)=>((0,t.uX)(),(0,t.CE)("div",{class:(0,c.C4)(f.$style.metronome)},[(0,t.Lk)("button",{onClick:d[0]||(d[0]=(0,C.D$)(v=>a((0,g.R1)(p.p4).COUNT_IN),["stop","prevent"])),"data-active":et.value,class:(0,c.C4)({[f.$style.btn]:!0,[f.$style.active]:et.value})},[(0,t.bF)(lt.A),(0,t.Lk)("span",{class:(0,c.C4)(f.$style.text)},(0,c.v_)(f.$t("flat:editor.metronome.count")),3),et.value?((0,t.uX)(),(0,t.Wv)((0,g.R1)(B.A),{key:0})):(0,t.Q3)("",!0)],10,q),(0,t.Lk)("button",{onClick:d[1]||(d[1]=(0,C.D$)(v=>a((0,g.R1)(p.p4).CONTINUOUS),["stop","prevent"])),"data-active":U.value,class:(0,c.C4)({[f.$style.btn]:!0,[f.$style.active]:U.value})},[(0,t.bF)(j.A),(0,t.Lk)("span",{class:(0,c.C4)(f.$style.text)},(0,c.v_)(f.$t("flat:editor.metronome.on")),3),U.value?((0,t.uX)(),(0,t.Wv)((0,g.R1)(B.A),{key:0})):(0,t.Q3)("",!0)],10,G),(0,t.Lk)("button",{onClick:d[2]||(d[2]=(0,C.D$)(v=>a((0,g.R1)(p.p4).DISABLED),["stop","prevent"])),"data-active":$.value,class:(0,c.C4)({[f.$style.btn]:!0,[f.$style.active]:$.value})},[(0,t.bF)(x.A),(0,t.Lk)("span",{class:(0,c.C4)(f.$style.text)},(0,c.v_)(f.$t("flat:editor.metronome.off")),3),$.value?((0,t.uX)(),(0,t.Wv)((0,g.R1)(B.A),{key:0})):(0,t.Q3)("",!0)],10,Z)],2))}});var st=s(309260),z=s.n(st),_=s(938793);const M={};M.$style=z();const R=(0,_.A)(F,[["__cssModules",M]])},939606:(b,S,s)=>{"use strict";s.d(S,{A:()=>st});var t=s(763939),c=s(941271),C=s(303953),g=s(645369),p=s.n(g),B=s(616877),N=s.n(B),tt=s(697333),j=s(773067),lt=s(591340),x=(z,_,M)=>new Promise((L,R)=>{var W=U=>{try{J(M.next(U))}catch(et){R(et)}},A=U=>{try{J(M.throw(U))}catch(et){R(et)}},J=U=>U.done?L(U.value):Promise.resolve(U.value).then(W,A);J((M=M.apply(z,_)).next())});const q=1,G=Number.POSITIVE_INFINITY,Z=p()("flat:export"),F=()=>Math.random()*1e17;class st{constructor({$t:_}={}){this.$t=_,this.handlers={pdf:{fnc:"pdfHandler",queue:"client",extension:"pdf"},png:{fnc:"pngHandler",queue:"client",extension:"png"},svg:{fnc:"svgHandler",queue:"client",extension:"svg"},json:{fnc:"jsonHandler",queue:"client",extension:"json"},mxl:{fnc:"mxlHandler",queue:"client",extension:"mxl"},xml:{fnc:"xmlHandler",queue:"client",extension:"musicxml"},midi:{fnc:"midiHandler",queue:"client",extension:"mid"}},this.clientQueue=new(N())(q,G),this.apiQueue=new(N())(q,G),this.useNewDisplay=(0,tt.A)()}queueExport({format:_,scoreData:M,options:L={},resolve:R,reject:W}){R||(R=()=>{}),W||(W=f=>{throw M.logError(f),f});const A=this.handlers[_];if(!A)return W(new Error(`Format ${_} not supported`));if(!A.fnc)return W(new Error(`No handler for ${_}`));L.filename||(L.filename=this.getFilename(A,M,L)),(0,lt.U)().scoreWrite||(Z("in RO, it wont save before exporting"),L.noSave=!0);const U=(0,t.F)().account;U!=null&&U.locale&&(L.locale=U.locale);let et;L.exportId?et=L.exportId:et=F();const $={id:et,state:"created",format:_,formatConfig:A,scoreData:M,options:L},r=(0,j.V)();r.upsert($),(0,c.B)().addExperience(`editor.export.${_}`);let a;return A.queue==="api"?a=this.apiQueue:a=this.clientQueue,Z("queue %s",_),a.add(()=>(Z("exec queued %s",_),$.state="doing",r.upsert($),this[A.fnc]($).then(f=>(r.done($),this.processResult(f,L))))).then(R).catch(f=>{M.logError(f,{logger:"export",extra:{scoreId:M.scoreId,revisionId:M.revisionId,format:_,formatConfig:A,options:L}}),r.error({job:$,error:f}),W(f)})}getTitle(_){const M=_.adagioData;return M.hasTitle()?M.getTitle():"Untitled score"}getFilename(_,M,L){const R=_.extension,W=M.adagioData;let A=this.getTitle(M),J=L.parts;return Array.isArray(J)&&J.length>0&&(J=J.slice(0,3).map(et=>{const $=W.uuidGetPartHeader(et);let r=$["part-name"];return(!r||r.length===0)&&(r=$.$id||$.uuid),r}),L.partsNames=J,A+=` - ${J.join(" - ")}`),[A,R].join(".")}processResult(_,M){const L=M.result||"return";if(L==="return")return Promise.resolve(_);if(L==="download")return this.resultDownload(_,M.filename);if(L==="print")return this.resultPrint(_,M.filename);if(L==="noop")return Promise.resolve();throw new Error(`Unknow result mode ${L}`)}resultDownload(_,M){_.constructor.name!=="Blob"&&(_=new Blob([_]));const L=s(370837).saveAs;return L(_,M),Promise.resolve()}resultPrint(_,M){var L;return typeof InstallTrigger!="undefined"||window.navigator.msSaveOrOpenBlob?this.resultDownload(_,M):((L=C.A.ua)==null?void 0:L.browserName)==="Safari"?this.resultDownload(_,M):new Promise((R,W)=>{const A=document.createElement("iframe");A.setAttribute("width",0),A.setAttribute("height",0),A.style.position="fixed",A.style.top="-10px",A.style.left="-10px",document.body.appendChild(A);const J=()=>{A.removeEventListener("load",J),A.contentWindow.focus();try{A.contentWindow.print()}catch($){p()("err iframe print(): %O",$),this.resultDownload(_,M).then(R).catch(W);return}const et=()=>{A.parentElement.removeChild(A),window.removeEventListener("focus",et)};window.addEventListener("focus",et),R()};A.addEventListener("load",J);const U=window.URL.createObjectURL(_,{type:"application/pdf"});A.setAttribute("src",U)})}export(_={}){return new Promise((M,L)=>{_.resolve=M,_.reject=L,this.queueExport(_)})}pdfHandler(_){return x(this,null,function*(){const{scoreData:M,options:L}=_;_.task={progress:{percentage:0,text:""}};const R=(0,j.V)();R.upsert(_);const W=this.getPdfJobsConfig({scoreData:M,options:L});let A;A=(this.useNewDisplay?yield Promise.all([s.e(22337),s.e(75421),s.e(61104),s.e(95629),s.e(36339),s.e(92503)]).then(s.bind(s,160588)):yield Promise.all([s.e(22337),s.e(75421),s.e(61104),s.e(95629),s.e(36339),s.e(92503)]).then(s.bind(s,110853))).default;const J=new A(this.$t),U=$=>{_.task.progress=$,R.upsert(_)};return yield J.generate(W,U)})}getPdfJobsConfig({scoreData:_,options:M}){const L=Object.assign({},M);return delete L.pdfJobs,M.pdfJobs?(M.pdfJobs.forEach(R=>{R.scoreData=_||R.scoreData,R.options=R.options||L}),M.pdfJobs):[{scoreData:_,options:L,parts:M.parts}]}pngHandler(_){return x(this,arguments,function*({scoreData:M,options:L}){let R;return R=(yield Promise.all([s.e(22337),s.e(75421),s.e(61104),s.e(95629),s.e(36339),s.e(92503)]).then(s.bind(s,27731))).default,yield new R().generate(M,L)})}svgHandler(_){return x(this,arguments,function*({scoreData:M,options:L}){let R;return R=(yield Promise.all([s.e(22337),s.e(75421),s.e(61104),s.e(95629),s.e(36339),s.e(92503)]).then(s.bind(s,212138))).default,yield new R().generate(M,L)})}jsonHandler({scoreData:_}){return Promise.resolve(JSON.stringify(_.adagioData.exportData()))}mxlHandler(_){return _.options=_.options||{},_.options.compressed=!0,this.mxlCommonHandler(_)}xmlHandler(_){return this.mxlCommonHandler(_)}mxlCommonHandler(_){return x(this,null,function*(){_.options=_.options||{},_.task={progress:{text:""}};const{scoreData:M,options:L}=_,W=(yield Promise.all([s.e(41828),s.e(44795)]).then(s.bind(s,718123))).default,A=new W,J=et=>{_.task.progress=et,(0,j.V)().upsert(_)};return yield A.generate(M,L,J)})}midiHandler(_){return x(this,arguments,function*({scoreData:M,options:L={}}){const W=(yield Promise.all([s.e(48707),s.e(22337),s.e(95365),s.e(64161),s.e(76400),s.e(37798),s.e(72486),s.e(87895),s.e(14617),s.e(39921),s.e(47404),s.e(57952),s.e(43139),s.e(59371),s.e(94808),s.e(24290),s.e(88273),s.e(85719),s.e(27012),s.e(82794),s.e(80449),s.e(36494),s.e(26569),s.e(26797),s.e(34926),s.e(78703),s.e(61104),s.e(43955),s.e(45321),s.e(60656),s.e(92134),s.e(13369)]).then(s.bind(s,387091))).default;return yield new W().generate(M,L)})}}},940168:(b,S,s)=>{"use strict";s.d(S,{A:()=>N});var t=s(361744);const c={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor"};function C(tt,j){return(0,t.uX)(),(0,t.CE)("svg",c,j[0]||(j[0]=[(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.3968 4C14.6678 4 14.9448 4.212 15.0168 4.482L16.0958 8.529L17.9998 6.185C18.1738 5.97 18.4888 5.938 18.7038 6.112C18.9178 6.286 18.9508 6.601 18.7758 6.815L16.4138 9.723L17.1099 12.4867H16.2182L15.6348 10.682L14.2239 12.4867H12.8836C12.8756 12.495 12.868 12.5028 12.8607 12.5103L15.3168 9.488L14.1198 5H9.65681L7.25681 14L10.783 14.0004C10.4013 14.2697 9.93947 14.5979 9.37881 15H6.98981L6.18981 18H10.6711V19H8.88781V19.5C8.88781 19.776 8.67381 20 8.38381 20H7.39281C7.11381 20 6.88781 19.768 6.88781 19.5V19H5.38681C5.11081 19 4.94481 18.788 5.01681 18.518L8.75981 4.482C8.83081 4.216 9.11581 4 9.37881 4H14.3968ZM12.3833 10C12.6623 10 12.8883 10.232 12.8883 10.5C12.8883 10.776 12.6743 11 12.3833 11H11.3923C11.1143 11 10.8883 10.768 10.8883 10.5C10.8883 10.224 11.1023 10 11.3923 10H12.3833ZM12.3837 8C12.6617 8 12.8877 8.232 12.8877 8.5C12.8877 8.776 12.6737 9 12.3837 9H11.3927C11.1137 9 10.8877 8.768 10.8877 8.5C10.8877 8.224 11.1017 8 11.3927 8H12.3837ZM12.3837 6C12.6617 6 12.8877 6.232 12.8877 6.5C12.8877 6.776 12.6737 7 12.3837 7H11.3927C11.1137 7 10.8877 6.768 10.8877 6.5C10.8877 6.224 11.1017 6 11.3927 6H12.3837Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19 20H15.0156V19.1301L16.4464 17.6291C16.8701 17.1787 17.1469 16.8665 17.2768 16.6925C17.4068 16.5185 17.5003 16.3574 17.5575 16.209C17.6147 16.0607 17.6433 15.9069 17.6433 15.7478C17.6433 15.5105 17.5803 15.3338 17.4542 15.2178C17.3281 15.1018 17.1599 15.0438 16.9493 15.0438C16.7284 15.0438 16.514 15.0964 16.3061 15.2016C16.0981 15.3068 15.8811 15.4565 15.655 15.6507L15 14.8456C15.2807 14.5974 15.5133 14.4221 15.6979 14.3196C15.8824 14.2171 16.0838 14.1382 16.3022 14.0829C16.5205 14.0276 16.7648 14 17.0351 14C17.3912 14 17.7057 14.0674 17.9786 14.2023C18.2515 14.3372 18.4633 14.526 18.614 14.7687C18.7648 15.0115 18.8402 15.2893 18.8402 15.6022C18.8402 15.8746 18.794 16.1301 18.7018 16.3688C18.6095 16.6076 18.4665 16.8523 18.2729 17.1032C18.0793 17.354 17.7382 17.7114 17.2495 18.1753L16.5166 18.8914V18.9481H19V20Z"},null,-1),(0,t.Lk)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14 20H12.7214V16.528L12.7338 15.9576L12.7545 15.3338C12.5421 15.5445 12.3945 15.6826 12.3117 15.7483L11.6166 16.3023L11 15.539L12.949 14H14V20Z"},null,-1)]))}var g=s(938793);const p={},N=(0,g.A)(p,[["render",C]])},954516:(b,S,s)=>{"use strict";s.d(S,{A:()=>It});var t=s(334931),c=s(701387),C=s(446921),g=s(383279),p=s(104907);class B{constructor(h){this.i=h,this.svgTools=h.svgTools,this.cacheHeads=[],this.cacheMeasure={measure:null},this.cacheStaff={staff:null,measure:null,voice:null,topPos:{},staffDirection:null,measureDirection:null,voiceIdx:null}}checkCacheHead(h){if(!this.cacheHeads[h.partIdx]){const y=this.i.data.getPartContent(h.partIdx),D=C.A.getMeasure(y,h.measureIdx),V=c.default.getWrappedStaffDetails(D).getEntry(h.staffIdx),Q=p.default.getNbStaffLines(V),at=this.i.data.getPartHeader(h.partIdx),_t=g.default.getUnpitchedMapping(at);this.cacheHeads[h.partIdx]={},this.cacheHeads[h.partIdx].nbStaffLines=Q,this.cacheHeads[h.partIdx].pitchMapping=_t}}keyboardUpdateTopPos(){const h=this.i.cursor.getPosition();this.cacheMeasure.topPos={partIdx:h.partIdx,staffIdx:h.staffIdx,measureIdx:h.measureIdx}}cleanCacheHead(){this.cacheHeads=[]}checkMeasureCache(h){const y=this.svgTools.findParent(h.target,"measure");this.cacheMeasure.measure=y}checkStaffCache(h,y){let D=!1;const H=this.svgTools.findParent(h.target,"measure"),V=this.svgTools.findParent(H,"staff");return(this.cacheStaff.staff!==V||y||!this.svgTools.isStillInDom(V))&&(this.cacheStaff.staff=V,this.hashStaffDirections(),D=!0),(H!==this.cacheStaff.measure||y||!this.svgTools.isStillInDom(H))&&(this.cacheStaff.measure=H,[this.cacheStaff.voice]=this.svgTools.getElementsByClassName(H,"voice"),this.cacheStaff.topPos=this.svgTools.getTopPosition(H),this.hashMeasureDirections(),this.cacheStaff.voiceIdx=this.i.data.getPartStaffVoiceAtIdx(this.cacheStaff.topPos.partIdx,this.cacheStaff.topPos.staffIdx,0),D=!0),D}hashStaffDirections(){const h=this.svgTools.getElementsByClassName(this.cacheStaff.staff,"wedgeLines");this.cacheStaff.staffDirection=[].slice.call(h);const y=this.svgTools.getElementsByClassName(this.cacheStaff.staff,"octaveShift");this.cacheStaff.staffDirection=this.cacheStaff.staffDirection.concat([].slice.call(y));const D=this.svgTools.getElementsByClassName(this.cacheStaff.staff,"pluckedRange");this.cacheStaff.staffDirection=this.cacheStaff.staffDirection.concat([].slice.call(D))}hashMeasureDirections(){this.cacheStaff.measureDirection=this.cacheStaff.staffDirection.filter(V=>this.svgTools.isInsideElem(this.cacheStaff.measure,V));let h=this.svgTools.getElementsByClassName(this.cacheStaff.measure,"dynamic");h=[].slice.call(h);let y=this.svgTools.getElementsByClassName(this.cacheStaff.measure,"pizzicato");y=[].slice.call(y);let D=this.svgTools.getElementsByClassName(this.cacheStaff.measure,"mute");D=[].slice.call(D);let H=this.svgTools.getElementsByClassName(this.cacheStaff.measure,"pedal");H=[].slice.call(H),this.cacheStaff.measureDirection=this.cacheStaff.measureDirection.concat(h),this.cacheStaff.measureDirection=this.cacheStaff.measureDirection.concat(y),this.cacheStaff.measureDirection=this.cacheStaff.measureDirection.concat(H),this.cacheStaff.measureDirection=this.cacheStaff.measureDirection.concat(D)}}var N=s(832560),tt=s(737903),j=s(123491),lt=s(818873),x=s(254007),q=s(886170),G=s(121648),Z=s(909696),F=s(646036),st=s(125911),z=s(891921),_=s(726042),M=s(595110);function L(I){return this.hasMeasureUuid(I)}function R({partUuid:I,staffUuid:h}){if(!this.hasPartUuid(I))return!1;const y=this.getPartIdxFromUuid(I);return!!this.hasPartStaffUuid(y,h)}function W(I,h,y){I.measureUuid=y[0],h.measureUuid=y[y.length-1]}function A(I,h,y,D,H){const V=H[0],Q=H[H.length-1];y.left,D.up,I.partUuid=V.partUuid,I.staffUuid=V.staffUuid,h.partUuid=Q.partUuid,h.staffUuid=Q.staffUuid}function J(I,h,y){if(I.partUuid!==h.partUuid||I.staffUuid!==h.staffUuid)return!1;const D=y.getPartIdxFromUuid(h.partUuid);return y.hasPartVoiceUuid(D,h.voiceUuid)}function U(I,h,y,D){J(I,y.left,D)&&(I.voiceUuid=y.left.voiceUuid),I.voiceUuid=(0,M.A)(D,I).voiceUuid,J(h,y.right,D)&&(h.voiceUuid=y.right.voiceUuid),h.voiceUuid=(0,M.A)(D,h).voiceUuid}function et(I,h,y,D){if(I.measureUuid===y.startMeasureUuid?(I.timePos=y.startTimePos,I.dpq=y.startDpq):(I.timePos=0,I.dpq=1),h.measureUuid===y.stopMeasureUuid)h.timePos=y.stopTimePos,h.dpq=y.stopDpq;else{const H=D.uuidGetMeasure(h.partUuid,h.measureUuid);h.dpq=c.default.getDpq(H),h.timePos=c.default.getNbDivisions(H)}}function $(I,h){const y=h.uuidGetMeasure(I.partUuid,I.measureUuid),D=c.default.getDpq(y),H=_.default.lcm(D,I.dpq),V=c.default.getNbDivisions(y)*H/D;I.timePos*H/I.dpq>=V&&(I.timePos=V-1,I.dpq=H)}function r(I,h){const y=h.uuidGetMeasure(I.partUuid,I.measureUuid),D=c.default.getDpq(y),H=_.default.lcm(D,I.dpq),V=c.default.getNbDivisions(y)*H/D;I.timePos*H/I.dpq>V&&(I.timePos=V,I.dpq=H)}function a(I,h){const y=h.uuidGetMeasure(I.partUuid,I.measureUuid),D=c.default.getDpq(y),H=_.default.lcm(D,I.dpq),V=H/D,Q=I.timePos*H/I.dpq,at=h.uuidGetPartVoiceIdx(I.partUuid,I.voiceUuid),Pt=new N.A(y).getVoice(at),Ct=(0,z.A)(Pt,V,Q);I.noteIdx=Ct,delete I.timePos,delete I.dpq}function f(I,h){const y=h.uuidGetMeasure(I.partUuid,I.measureUuid),D=c.default.getDpq(y),H=_.default.lcm(D,I.dpq),V=I.timePos*H/I.dpq,Q=c.default.getNbDivisions(y)*H/D,at=h.uuidGetPartVoiceIdx(I.partUuid,I.voiceUuid),Pt=new N.A(y).getVoice(at);let Ct;if(V===Q)Ct=Pt.getNbNotes()-1;else{const Mt=H/D;Ct=(0,z.A)(Pt,Mt,V),(0,st.A)(Pt,Mt,V)&&Ct--}I.noteIdx=Ct,delete I.timePos,delete I.dpq}function d({upDown:I,leftRight:h,measureUuids:y,timePosBounds:D,partsStavesRange:H,scoreData:V}){if(y=y.filter(L,V),y.length===0||(H=H.filter(R,V),H.length===0))return null;const Q={},at={};return W(Q,at,y),A(Q,at,h,I,H),U(Q,at,h,V),et(Q,at,D,V),$(Q,V),r(at,V),a(Q,V),f(at,V),[Q,at]}var v=Object.defineProperty,T=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,Y=(I,h,y)=>h in I?v(I,h,{enumerable:!0,configurable:!0,writable:!0,value:y}):I[h]=y,ct=(I,h)=>{for(var y in h||(h={}))E.call(h,y)&&Y(I,y,h[y]);if(T)for(var y of T(h))k.call(h,y)&&Y(I,y,h[y]);return I};class it{constructor({scoreData:h,rangeDrawer:y}){this.scoreData=h||null,this.drawer=y||null,this.rangeAutoScroll=new F.A,this.refAction=null,this.refEvent=null,this.anchors=[null,null],this.pulledAnchor=null,this.prevPosition=null,this.leftRightPositions=null,this.upDownPositions=null,this.timePosBounds=null,this.partsStavesRange=null,this.measureUuids=null,this.reset()}get data(){return this.scoreData.adagioData}setRangeDrawer(h){this.drawer=h}hasRange(){return this.anchors[0]!==null}getAnchor(){return Object.assign({},this.anchors[0])}selectRange(h,y){var D,H,V,Q,at,_t,Pt;const Mt=Object.assign({updateDisplay:!0,pulledAnchor:null},y);this.anchors=this.getNewAnchors(h,Mt==null?void 0:Mt.pulledAnchor),this.pulledAnchor=Mt.pulledAnchor,this.refAction=Mt==null?void 0:Mt.refAction,this.refEvent=Mt==null?void 0:Mt.refEvent,this.savePrevPosition(),this.leftRightPositions=null,this.upDownPositions=null,this.timePosBounds=null,this.partsStavesRange=null,this.measureUuids=null,this.getRanges(),this.hasDrawer()&&(Mt!=null&&Mt.updateDisplay)&&(this.refreshDisplay(),this.rangeAutoScroll.init({refAction:this.refAction,refEvent:this.refEvent,verticalViewport:(V=(H=(D=this.drawer)==null?void 0:D.interaction)==null?void 0:H.cursor)==null?void 0:V.verticalScrollableElement,horizontalViewport:(_t=(at=(Q=this.drawer)==null?void 0:Q.interaction)==null?void 0:at.cursor)==null?void 0:_t.horizontalScrollableElement,rawRangeRects:(Pt=this.drawer)==null?void 0:Pt.rects})),window.__karma__||(0,G.W)().setRangeSelection(Object.assign({},this.getLeftRightPositions(),this.getUpDownPositions()))}savePrevPosition(){this.prevPosition=ct(ct({},this.leftRightPositions),this.upDownPositions)}getNewAnchors(h,y){let D=Object.assign({},h);const H=Object.assign({},h);if(!this.anchors.length||this.anchors[0]===null)return[D,H];const V=this.getLeftRightPositions();if(y&&y==="left")return D=V.right,[D,H];if(y&&y==="right")return D=V.left,[D,H];(0,lt.A)(this.data,V.left,h)>0?D=V.right:(0,lt.A)(this.data,h,V.right)>0?D=V.left:D=this.anchors[0];const Q=this.getUpDownPositions();return(0,x.A)(this.data,Q.up,h)>0?(D.partUuid=Q.down.partUuid,D.staffUuid=Q.down.staffUuid,D.voiceUuid=Q.down.voiceUuid):(0,x.A)(this.data,h,Q.down)>0&&(D.partUuid=Q.up.partUuid,D.staffUuid=Q.up.staffUuid,D.voiceUuid=Q.up.voiceUuid),[D,H]}getRanges(){this._getTimePosBounds(),this._getPartsStavesRange(),this._getMeasureUuids(),this.getLeftRightPositions(),this.getUpDownPositions()}refreshDisplay(){if(this.hasRange()){const h=this.getDisplayPosition();if(h.hasHiddenParts){this.reset();return}const y=this.getLeftRightPositions();this.drawer.setAnchorsPositions([y.left,y.right]),this.drawer.setPulledAnchor(this.pulledAnchor),this.drawer.setPosition(h)}}getDisplayPosition(){let h=this.getPartsStavesRange();const y=h.length;h=h.filter(this.isPartUuidDisplayed,this);const D=h.length,H=h.map(this.partStaffUuidToPartStaffIdx,this),V=this.getTimePosBounds(),Q=this.data.getMeasureIdxFromUuid(V.startMeasureUuid),at=this.data.getMeasureIdxFromUuid(V.stopMeasureUuid);return{hasHiddenParts:y!==D,startMeasureIdx:Q,startTimePos:V.startTimePos,startDpq:V.startDpq,stopMeasureIdx:at,stopTimePos:V.stopTimePos,stopDpq:V.stopDpq,partsStaves:H}}isPartUuidDisplayed(h){const D=this.drawer.adagioDrawer.scoreDataCache,H=this.data.getPartIdxFromUuid(h.partUuid);return D.isPartDisplayed(H)}partStaffUuidToPartStaffIdx(h){const D=this.drawer.adagioDrawer.scoreDataCache,H=this.data.getPartIdxFromUuid(h.partUuid),V=D.dataToDisplayedPartIdx(H),Q=this.data.getPartStaffIdxFromUuid(H,h.staffUuid);return{partIdx:V,staffIdx:Q}}reset(){this.softReset(),this.resetStore()}softReset(){this.anchors=[null,null],this.pulledAnchor=null,this.refAction=null,this.refEvent=null,this.leftRightPositions=null,this.upDownPositions=null,this.timePosBounds=null,this.partsStavesRange=null,this.measureUuids=null,this.hasDrawer()&&this.drawer.cleanRect()}resetStore(){(0,G.W)().setRangeSelection(null),(0,Z.q6)().closeInlineCommentPopover()}hasDrawer(){return!!this.drawer}getAnchorPartStaff(){return{partUuid:this.anchors[0].partUuid,staffUuid:this.anchors[0].staffUuid}}getLastPosPartStaff(){return{partUuid:this.anchors[1].partUuid,staffUuid:this.anchors[1].staffUuid}}getMeasuresUuids(){let h=this._getMeasureUuids();return h=h.slice(),h}_getMeasureUuids(){if(this.measureUuids===null){const h=this.getLeftRightPositions(),y=h.left.measureUuid,D=h.right.measureUuid;this.measureUuids=[y],D!==y&&this.measureUuids.push(D)}return this.measureUuids}getNoteBounds(){const h=this.getLeftRightPositions();return{startPartUuid:h.left.partUuid,startMeasureUuid:h.left.measureUuid,startVoiceUuid:h.left.voiceUuid,startNoteIdx:h.left.noteIdx,stopPartUuid:h.right.partUuid,stopMeasureUuid:h.right.measureUuid,stopVoiceUuid:h.right.voiceUuid,stopNoteIdx:h.right.noteIdx}}getTimePosBounds(){const h=this._getTimePosBounds();return Object.assign({},h)}_getTimePosBounds(){if(this.timePosBounds===null){const h=this.getLeftRightPositions(),y=this.extractTimeFraction(h.left),H=this.extractTimeFraction(h.right,!0);this.timePosBounds={startMeasureUuid:h.left.measureUuid,startTimePos:y.timePos,startDpq:y.dpq,stopMeasureUuid:h.right.measureUuid,stopTimePos:H.timePos,stopDpq:H.dpq}}return this.timePosBounds}extractTimeFraction(h,y){const D=this.data.uuidGetMeasure(h.partUuid,h.measureUuid),H=c.default.getDpq(D),V=new N.A(D),Q=this.data.uuidGetPartVoiceIdx(h.partUuid,h.voiceUuid),at=V.getVoice(Q);let _t=at.getRangeSpace(0,h.noteIdx);if(y){const Pt=at.getNote(h.noteIdx),Ct=j.default.getDuration(Pt);_t+=Ct}return{timePos:_t,dpq:H}}getLeftRightPositions(){return this.leftRightPositions===null&&((0,lt.A)(this.data,this.anchors[0],this.anchors[1])<0?this.leftRightPositions={left:this.anchors[0],right:this.anchors[1]}:this.leftRightPositions={left:this.anchors[1],right:this.anchors[0]}),this.leftRightPositions}getPartsStavesRange(){const h=this._getPartsStavesRange();return(0,tt.default)(h)}_getPartsStavesRange(){if(this.partsStavesRange===null){const h=(0,Z.q6)().displayedParts;this.partsStavesRange=[];const y=this.getUpDownPositions();let D=Object.assign({},y.up);const H=y.down;for(;(0,x.A)(this.data,D,H)<0;)h[D.partUuid]===!0&&this.partsStavesRange.push({partUuid:D.partUuid,staffUuid:D.staffUuid}),D=(0,q.A)(this.data,D);h[D.partUuid]===!0&&this.partsStavesRange.push({partUuid:D.partUuid,staffUuid:D.staffUuid})}return this.partsStavesRange}getUpDownPositions(){return this.upDownPositions===null&&((0,x.A)(this.data,this.anchors[0],this.anchors[1])<0?this.upDownPositions={up:this.anchors[0],down:this.anchors[1]}:this.upDownPositions={up:this.anchors[1],down:this.anchors[0]}),this.upDownPositions}getLastPos(){return Object.assign({},this.anchors[1])}updateRangeSelectFromData(h){if(this.hasRange()){const y=this.data,D=this.getUpDownPositions(),H=this.getLeftRightPositions(),V=this._getTimePosBounds(),Q=this._getMeasureUuids(),at=this._getPartsStavesRange();this.softReset();const _t=d({upDown:D,leftRight:H,measureUuids:Q,timePosBounds:V,partsStavesRange:at,scoreData:y});_t!==null?_t.forEach(Pt=>{this.selectRange(Pt,{updateDisplay:h})}):this.resetStore()}}}var Bt=s(803002);class Ot{constructor({account:h,score:y,scoreData:D,logError:H,loadRwActions:V=!0,checkPremiumFeatures:Q=!1,promiseQueue:at,i18next:_t=null}){var Pt;this.account=h,this.score=y,this.scoreData=D,this.logError=H||(Ct=>{throw Ct}),this.rangeSelect=new it({scoreData:D}),this.config=D.config,this.svgTools=new Bt.A,this.domCache=new B(this),this.cursor=new t.A({interaction:this,id:(Pt=this.account)==null?void 0:Pt.id,config:this.config}),this.i18next=_t,this.scoreData.initActions({cursor:this.cursor,rangeSelect:this.rangeSelect,loadRwActions:V,checkPremiumFeatures:Q,promiseQueue:at,i18next:_t}),this.setActionsDependencies()}get data(){return this.scoreData.adagioData}setAudio(h){this.audio=h,this.setActionsDependencies()}setMIDI(h){this.midi=h,this.setActionsDependencies()}setPageLayout(h){this.pageLayout=h,this.svgTools.pageLayout=h,this.cursor.setPageLayout(h)}setScoreDrawer(h){this.cursor.setScoreDrawer(h)}setActionsDependencies(){this.scoreData.scoreActions&&this.scoreData.scoreActions.setDependencies({interaction:this,account:this.account,logError:this.logError,config:this.config,svgTools:this.svgTools,cursor:this.cursor,audio:this.audio,midi:this.midi})}setRangeDrawer(h){this.rangeSelect.setRangeDrawer(h)}initSvgTools(h){this.svgTools.init(h,this.pageLayout.getPagesStructures(),this.pageLayout,this.data)}initCursor({svgs:h,verticalScrollableElement:y,horizontalScrollableElement:D,collaborators:H,keepPosition:V=!1}){this.cursor.init({id:this.account.id,svg:h,verticalScrollableElement:y,horizontalScrollableElement:D,interaction:this,collaborators:H,keepPosition:V,config:this.config})}}const It=Ot},975986:(b,S,s)=>{var t=s(467606);t.__esModule&&(t=t.default),typeof t=="string"&&(t=[[b.id,t,""]]),t.locals&&(b.exports=t.locals);var c=s(929234).A,C=c("0e1f8f92",t,!0,{})},986027:(b,S,s)=>{"use strict";s.r(S),s.d(S,{default:()=>B});var t=s(814779),c=s.n(t),C=s(927860),g=s.n(C),p=g()(c());p.push([b.id,`.playbackSpeed_o3ksV{width:100px;margin-left:12px;display:flex;align-items:center;gap:8px}.playbackSpeed_o3ksV button{flex:0 0 24px;appearance:none;background:none;display:flex;border:0;padding:0;cursor:pointer}.playbackSpeedValue_ToCP8{flex:0 0 35px;text-align:center}
`,""]),p.locals={playbackSpeed:"playbackSpeed_o3ksV",playbackSpeedValue:"playbackSpeedValue_ToCP8"};const B=p}}]);})();


//# debugId=e954bb57-fb04-5d99-906e-fdee8af5a48d
