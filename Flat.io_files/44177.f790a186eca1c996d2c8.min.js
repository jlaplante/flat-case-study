"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b3862260-5a72-5fa1-89dd-b383d10437fb")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[44177],{15247:(Y,G,l)=>{l.d(G,{I:()=>f});var r=l(763939),L=l(645369),u=l.n(L),v=l(900448),m=l(234535),M=l(706305),j=Object.defineProperty,W=Object.defineProperties,w=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,t=(h,a,o)=>a in h?j(h,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):h[a]=o,d=(h,a)=>{for(var o in a||(a={}))D.call(a,o)&&t(h,o,a[o]);if(U)for(var o of U(a))I.call(a,o)&&t(h,o,a[o]);return h},g=(h,a)=>W(h,w(a)),E=(h,a,o)=>t(h,typeof a!="symbol"?a+"":a,o),c=(h,a,o)=>new Promise((_,b)=>{var T=H=>{try{x(o.next(H))}catch(X){b(X)}},z=H=>{try{x(o.throw(H))}catch(X){b(X)}},x=H=>H.done?_(H.value):Promise.resolve(H.value).then(T,z);x((o=o.apply(h,a)).next())});const s=u()("flat:offline");class e{constructor({accountId:a}){E(this,"isReady"),E(this,"db"),E(this,"accountId"),this.accountId=a,this.isReady=!1}getDb(){return c(this,arguments,function*(a={}){return this.db||(s("open db %s",this.dbName),this.db=new v.Ay(this.dbName),this.db.version(1).stores({collectionsObjects:"++_id, _ts, &id, type, *collections, creationDate",scoresObjects:"++_id, _ts, &id, *collections, modificationDate, title",scoresRevisionsObjects:"++_id, _ts, &id, score, date",scoresRevisionsData:"++_id, _ts, &id, score, date"})),this.isReady&&this.db.isOpen()?this.db:new Promise((o,_)=>{(0,m.A)().then(()=>this.db.open()).then(()=>{var b;return this.isReady=!0,s("db %s is opened",(b=this.db)==null?void 0:b.name),o(this.db)}).catch(b=>(s("open error %o",b),!a.retrying&&b.toString().includes("Internal error")?this.getDb(g(d({},a),{retrying:!0})).then(o).catch(_):(typeof b=="string"&&(b=new Error(b),b.name="SQLError"),b.type="rt",b.localGroup="open_indexeddb",_(b))))})})}close(){var a;this.isReady&&((a=this.db)!=null&&a.isOpen())&&(this.db.close(),this.isReady=!1)}deleteStorage(){if(this.db){const a=this.db.delete();return this.db=void 0,this.isReady=!1,a}return indexedDB.deleteDatabase(this.dbName),Promise.resolve()}addOrUpdateCollection(a){const o=d({},a);return o.type==="trash"&&!o.collections&&(o.collections=[a.id]),this.addOrUpdateObject("collectionsObjects",o)}deleteCollectionById(a){return c(this,null,function*(){yield this.deleteObjectById("collectionsObjects",a)})}getCollectionById(a){return c(this,null,function*(){s("getCollectionById(%s)",a);const _=yield(yield this.getDb()).collectionsObjects.where("id").equals(a).or("type").equals(a).first();if(!_)throw new Error("Object not found");return _._source="offline",_})}listCollections(){return c(this,arguments,function*({parent:a="root",sort:o="creationDate",direction:_="desc"}={}){s("listCollections(%s)",a);let T=(yield this.getDb()).collectionsObjects.toCollection();_==="desc"&&(T=T.reverse());const z=yield T.sortBy(o);return z.forEach(x=>{x._source="offline"}),z})}listCollectionsScores(a){return c(this,arguments,function*({collection:o,sort:_,direction:b}){s("listCollectionsScores(%s), sort = %s, dir = %s",o,_,b);let z=(yield this.getDb()).scoresObjects.where("collections").equals(o);b==="desc"&&(z=z.reverse());const x=yield z.sortBy(_);return x.forEach(H=>{H._source="offline"}),x})}addOrUpdateScore(a){return this.addOrUpdateObject("scoresObjects",a)}getScoreById(a){return this.getObjectById("scoresObjects",a)}deleteScoreById(a){return c(this,null,function*(){yield this.deleteObjectById("scoresObjects",a),yield(yield this.getDb()).scoresRevisionsData.where("score").equals(a).delete()})}addScoreRevision(a,o,_,b){return c(this,null,function*(){s("addScoreRevision(score = %s, revisionId = %s, date = %s)",a,o,_);const T={score:a,id:o,date:Math.round(_.getTime()/1e3),data:JSON.stringify(b)};yield this.addOrUpdateObject("scoresRevisionsData",T),yield this.getScoresAvailableOffline()})}getScoreRevisionData(a,o){return c(this,null,function*(){s("getScoreRevisionData(score = %s, revisionId = %s)",a,o);let _=null;if(o!=="last")_=yield this.getObjectById("scoresRevisionsData",o);else{const T=yield(yield this.getDb()).scoresRevisionsData.where("score").equals(a).reverse().sortBy("date");_=T.length>0?T[0]:null}if(!_)throw new Error("Score not cached offline");return{status:200,statusText:"OK",data:JSON.parse(_.data),config:{},headers:{"x-flat-score-revision":_.id,"x-flat-score-revision-date":_.date.toString()},_source:"offline"}})}getScoresAvailableOffline(){return c(this,null,function*(){const o=yield(yield this.getDb()).scoresRevisionsData.orderBy("score").uniqueKeys();return s("offline scores: %o",o),(0,M.j)().offlineScores(o),o})}getAllScoresAvailableOffline(){return c(this,null,function*(){const o=yield(yield this.getDb()).scoresObjects.orderBy("id").uniqueKeys();return s("all offline scores: %o",o),o})}static cloneAndTs(a){return a=v.Ay.deepClone(a),a._ts=Math.round(Date.now()/1e3),a}addOrUpdateObject(a,o){return c(this,null,function*(){s("addOrUpdateObject(%s, %o)",a,o),o=e.cloneAndTs(o);try{const T=yield(yield this.getDb())[a].add(o);return o._id=T,o}catch(_){if(_ instanceof v.Ay.ConstraintError)return this.updateObject(a,o);if(_ instanceof v.Ay.InvalidStateError)return o}return o})}updateObject(a,o){return c(this,null,function*(){o._ts||(o=e.cloneAndTs(o));try{const b=(yield this.getDb())[a];if(a==="scoresObjects"&&"collections"in o){const T=yield b.where("id").equals(o.id).first();if(T&&"collections"in T&&Array.isArray(o.collections)){const z=T.collections||[],x=o.collections||[],H=[...new Set([...z,...x])];return yield b.where("id").equals(o.id).modify(g(d({},o),{collections:H})),o.collections=H,o}}return yield b.where("id").equals(o.id).modify(o),o}catch(_){if(_ instanceof v.Ay.InvalidStateError)return o}return o})}getObjectById(a,o){return c(this,null,function*(){s("getObjectById(%s, %o)",a,o);const T=yield(yield this.getDb())[a].where("id").equals(o).first();if(!T)throw new Error("Object not cached offline");return T._source="offline",T})}deleteObjectById(a,o){return c(this,null,function*(){s("deleteObjectById(%s, %o)",a,o),yield(yield this.getDb())[a].where("id").equals(o).delete()})}get dbName(){return`offline_objects_${this.accountId}`}}const n={};function i(h){return n[h]||(n[h]=new e({accountId:h})),n[h]}function f(){var h;const o=(h=(0,r.F)().account)==null?void 0:h.id;return i(o||"guest")}},185407:(Y,G,l)=>{l.d(G,{A:()=>u});var r=l(550594);const u={get(){return r.A.get(`${r.A.apiv2baseurl}/organizations`)},getCreationEligibility(){return r.A.get(`${r.A.apiv2baseurl}/organizations/creationEligibility`)},create(v){return v=r.A.clearNullProperties(v),r.A.post(`${r.A.apiv2baseurl}/organizations`,v)},addOrganizationUser(v){return v=r.A.clearNullProperties(v),r.A.post(`${r.A.apiv2baseurl}/organizations/users`,v)},getOrganizationUsers(v){return r.A.getWithPagination(`${r.A.apiv2baseurl}/organizations/users`,{params:v})},getOrganizationUsersIds(v){return r.A.get(`${r.A.apiv2baseurl}/organizations/users`,{params:v})},deleteOrganizationUsers(v,m){return r.A.delete(`${r.A.apiv2baseurl}/organizations/users/${v}`,{params:m})},updateOrganizationUsers(v,m){return r.A.put(`${r.A.apiv2baseurl}/organizations/users/${v}`,m)},getByDomain(v){return r.A.get(`${r.A.apiv2baseurl}/organizations/${v}`)},join(v,m={}){return m=r.A.clearNullProperties(m),r.A.post(`${r.A.apiv2baseurl}/organizations/${v}/join`,m)},resetOrganizationSignupCode(){return r.A.post(`${r.A.apiv2baseurl}/organizations/signupCode/reset`,{})},updateOrganization(v){return r.A.put(`${r.A.apiv2baseurl}/organizations`,v)},getBillingGuestAccout(){return r.A.get(`${r.A.apiv2baseurl}/organizations/billingGuest`)},listOrganizationInvitation(){return r.A.get(`${r.A.apiv2baseurl}/organizations/invitations?limit=1000`)},createOrganizationInvitation(v){return r.A.post(`${r.A.apiv2baseurl}/organizations/invitations`,v)},deleteOrganizationInvitation(v){return r.A.delete(`${r.A.apiv2baseurl}/organizations/invitations/${v}`)},getLicenseExpDate(){return r.A.get(`${r.A.apiv2baseurl}/organizations/users/facets/licenseExpirationDate`)},getOrganizationClasses(){return r.A.get(`${r.A.apiv2baseurl}/organizations/users/facets/classes`)},getUserCount(v){return r.A.get(`${r.A.apiv2baseurl}/organizations/users/count`,{params:v})},getOrganizationWithCode(v){return r.A.get(`${r.A.apiv2baseurl}/organizations/signupCode/${v}`)},checkFreeTrial(){return r.A.get(`${r.A.apiv2baseurl}/organizations/freeTrials`)},activateFreeTrial(){return r.A.post(`${r.A.apiv2baseurl}/organizations/freeTrials`)},getAdminInfo(){return r.A.get(`${r.A.apiv2baseurl}/organizations/contactAdmin`)},deleteOwnOrganization(){return r.A.delete(`${r.A.apiv2baseurl}/organizations`)},getSummaryByTeacher(){return r.A.get(`${r.A.apiv2baseurl}/organizations/users/summaryByTeacher`)}}},244270:(Y,G,l)=>{l.d(G,{Ay:()=>c,Dt:()=>U,GE:()=>D,k7:()=>m,sr:()=>j,uA:()=>M,w1:()=>W,w_:()=>t,zZ:()=>u});var r=l(550594);function L(s){return r.A.get(`${r.A.apiv2baseurl}/users/${s}`)}function u({id:s,next:e,limit:n=25,paginate:i=!1}){return r.A.getWithPagination(`${r.A.apiv2baseurl}/users/${s}/scores`,{params:{limit:n,paginate:i,next:e}})}function v(s){return r.A.get(`${r.A.apiv2baseurl}/users/${s}/scores`)}function m({id:s,next:e,limit:n=25}){return r.A.getWithPagination(`${r.A.apiv2baseurl}/users/${s}/followers`,{params:{next:e,limit:n}})}function M(s,e){return r.A.get(`${r.A.apiv2baseurl}/users/${s}/following`,{params:{limit:e!=null&&e.limit?e.limit:void 0}})}function j(s){return r.A.get(`${r.A.apiv2baseurl}/users/${s}/following?ids=true`)}function W({id:s,next:e,limit:n=25}){return r.A.getWithPagination(`${r.A.apiv2baseurl}/users/${s}/likes`,{params:{next:e,limit:n}})}function w(s){return r.A.get(`${r.A.apiv2baseurl}/users/me/statistics/overview`,{params:s})}function U(s){return r.A.getWithPagination(`${r.A.apiv2baseurl}/users/me/statistics/scores/top`,{params:s})}function D(s){return r.A.get(`${r.A.apiv2baseurl}/users/me/statistics/fans/top`,{params:s})}function I({metric:s,period:e}){return r.A.get(`${r.A.apiv2baseurl}/users/me/statistics/scores/charts/${s}`,{params:{period:e}})}function t({userId:s}){return r.A.get(`${r.A.apiv2baseurl}/users/${s}/pinnedScores`)}function d({scoreId:s}){return r.A.put(`${r.A.apiv2baseurl}/users/me/pinnedScores/${s}`)}function g({scoreId:s}){return r.A.delete(`${r.A.apiv2baseurl}/users/me/pinnedScores/${s}`)}const c={get:L,getPublicScoresWithPagination:u,getPublicScores:v,getFollowers:m,getFollowing:M,getLikedScores:W,getStatisticsOverview:w,getTopScores:U,topFans:D,scoresChartData:I,pinnedScores:t,addPinnedScores:d,deletePinnedScores:g,fetchFollowingListIds:j}},264546:(Y,G,l)=>{l.d(G,{Ay:()=>E});var r=l(550594);function L(c){return r.A.post(`${r.A.apiv2baseurl}/classes`,c)}function u(c){return r.A.get(`${r.A.apiv2baseurl}/classes`,{params:c})}function v(c){return r.A.get(`${r.A.apiv2baseurl}/classes/${c}`)}function m(c,s){return r.A.put(`${r.A.apiv2baseurl}/classes/${c}`,s)}function M(c){return r.A.delete(`${r.A.apiv2baseurl}/classes/${c}`)}function j(c,s){return r.A.post(`${r.A.apiv2baseurl}/classes/${c}/sync`,s)}function W(c){return r.A.post(`${r.A.apiv2baseurl}/classes/${c}/archive`)}function w(c){return r.A.delete(`${r.A.apiv2baseurl}/classes/${c}/archive`)}function U(c){return r.A.post(`${r.A.apiv2baseurl}/classes/enroll/${c}`)}function D({classId:c,userId:s}){return r.A.put(`${r.A.apiv2baseurl}/classes/${c}/users/${s}`,{})}function I({classId:c,userId:s}){return r.A.delete(`${r.A.apiv2baseurl}/classes/${c}/users/${s}`)}function t({classroom:c,params:s}){return r.A.getWithPagination(`${r.A.apiv2baseurl}/classes/${c}/submissions`,{params:s})}function d({classroom:c,params:s}){return r.A.post(`${r.A.apiv2baseurl}/classes/${c}/testStudent`,null,{params:s})}const E={create:L,list:u,get:v,update:m,delete:M,sync:j,archive:W,unarchive:w,join:U,addUserToClass:D,deleteUserFromClass:I,getClassSubmissions:t,createTestStudentAccount:d}},334980:(Y,G,l)=>{l.d(G,{A:()=>I});var r=l(616877),L=l.n(r),u=l(550594),v=l(521915),m=l(433514),M=(t,d,g)=>new Promise((E,c)=>{var s=i=>{try{n(g.next(i))}catch(f){c(f)}},e=i=>{try{n(g.throw(i))}catch(f){c(f)}},n=i=>i.done?E(i.value):Promise.resolve(i.value).then(s,e);n((g=g.apply(t,d)).next())});const j=1,W=Number.POSITIVE_INFINITY,w={};function U(t){return M(this,null,function*(){const d=w[t];return d||(w[t]=new(L())(j,W),w[t])})}const I={list(t){return u.A.get(`${u.A.apiv2baseurl}/classes/${t}/assignments`)},sync(t){return u.A.post(`${u.A.apiv2baseurl}/classes/${t}/assignments/sync`,{})},get(t,d){return u.A.get(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}`)},create(t,{isGoogleClassroom:d,isMicrosoftTeams:g}={}){t=u.A.clearNullProperties(t,{nullableProps:["dueDate","scheduledDate","topicId","categories","toolset","nbPlaybackAuthorized","maxPoints","coverFile","cover"]});const E=`${u.A.apiv2baseurl}/classes/${t.classroom}/assignments`;return d?v.A.wrapApiCallWithAuthz(()=>u.A.post(E,t),{classroom:!0}):g?m.A.wrapApiCallWithAuthz(()=>u.A.post(E,t),{edu:!0}):u.A.post(E,t)},update(t,{isGoogleClassroom:d,isMicrosoftTeams:g}={}){t=u.A.clearNullProperties(t,{nullableProps:["dueDate","scheduledDate","topicId","categories","toolset","nbPlaybackAuthorized","maxPoints","coverFile","cover"]});const E=`${u.A.apiv2baseurl}/classes/${t.classroom}/assignments/${t.id}`;return d?v.A.wrapApiCallWithAuthz(()=>u.A.put(E,t),{classroom:!0}):g?m.A.wrapApiCallWithAuthz(()=>u.A.put(E,t),{edu:!0}):u.A.put(E,t)},delete(t,d){return M(this,null,function*(){yield u.A.delete(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}`)})},copy(t,d,g,{isGoogleClassroom:E,isMicrosoftTeams:c}={}){const s=`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/copy`;return E?v.A.wrapApiCallWithAuthz(()=>u.A.post(s,g),{classroom:!0}):c?m.A.wrapApiCallWithAuthz(()=>u.A.post(s,g),{edu:!0}):u.A.post(s,g)},getSubmission(t,d,g){return u.A.get(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/submissions/${g}`)},listSubmissions(t,d,g){return u.A.get(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/submissions`,{params:g})},syncSubmissions(t,d){return u.A.post(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/submissions/sync`,{})},updateSubmission(t){return M(this,arguments,function*(d,{isGoogleClassroom:g,isMicrosoftTeams:E,account:c}={}){const{classroom:s,assignment:e}=d;return(yield U(d.id)).add(()=>{const i=()=>u.A.put(`${u.A.apiv2baseurl}/classes/${s}/assignments/${e}/submissions/${d.id}`,d);return g?v.A.wrapApiCallWithAuthz(i,{classroom:!0,account:c}):E?m.A.wrapApiCallWithAuthz(i,{edu:!0,account:c}):i()})})},upsertSubmission(t,{isGoogleClassroom:d,isMicrosoftTeams:g,account:E}={}){const{classroom:c,assignment:s}=t,e=()=>u.A.put(`${u.A.apiv2baseurl}/classes/${c}/assignments/${s}/submissions`,t);return d?v.A.wrapApiCallWithAuthz(e,{classroom:!0,account:E}):g?m.A.wrapApiCallWithAuthz(e,{edu:!0,account:E}):e()},pullSubmissionLtiGrade(t){const{classroom:d,assignment:g}=t;return u.A.post(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/lti/outcomes/pull`,{})},archiveAssignment(t,d){return u.A.post(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/archive`)},unArchiveAssignment(t,d){return u.A.delete(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/archive`)},addSubmissionComment(t){const{classroom:d,assignment:g}=t;return u.A.post(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/comments`,t)},editSubmissionComment(t){const{classroom:d,assignment:g,commentId:E}=t;return u.A.put(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/comments/${E}`,t)},getSubmissionComments(t){const{classroom:d,assignment:g}=t;return u.A.get(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/comments`)},deleteSubmissionComment(t){const{classroom:d,assignment:g,comment:E}=t;return u.A.delete(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/comments/${E.id}`)},markCommentsAsRead(t){const{classroom:d,assignment:g}=t;return u.A.post(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/comments/markAsRead`)},getSubmissionHistory(t){const{classroom:d,assignment:g}=t;return u.A.get(`${u.A.apiv2baseurl}/classes/${d}/assignments/${g}/submissions/${t.id}/history`)},getToolsetSharingInfo({classroom:t,assignment:d}){return u.A.get(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/toolset`)},deleteSubmission(t,d,g){return u.A.delete(`${u.A.apiv2baseurl}/classes/${t}/assignments/${d}/submissions/${g}`)},updateAssignmentToolset(t){return u.A.put(`${u.A.apiv2baseurl}/classes/${t.classroom}/assignments/${t.assignment}/toolset`,t)},getAssignmentToolset(t){return u.A.get(`${u.A.apiv2baseurl}/classes/${t.classroom}/assignments/${t.assignment}/toolset`)},helpers:{addScoreToSubmission(t,d){const g=d.id||d;t.attachments.findIndex(c=>c.score===g)<0&&t.attachments.push({type:"flat",score:g,title:typeof d=="object"?d.title:void 0})},removeScoreFromSubmission(t,d){const g=t.attachments.findIndex(E=>E.score===d);g>-1&&t.attachments.splice(g,1)}}}},348680:(Y,G,l)=>{l.d(G,{A:()=>u});var r=l(550594);const u={listUsers(v,m){return r.A.get(`${r.A.apiv2baseurl}/groups/${v}/users`,{params:m})}}},390907:(Y,G,l)=>{l.d(G,{A:()=>m});var r=l(459032),L=l(933991);const u="flat_user";let v;v=new r.A(u);const m=v},433514:(Y,G,l)=>{l.d(G,{A:()=>D});var r=l(324074),L=l.n(r),u=l(786743),v=l(550594);function m(I,t={}){const d=Object.assign({idp:"azure"},t);return new Promise((g,E)=>{I().then(g).catch(c=>{L().isAxiosError(c)&&c.response&&[401,403].includes(c.response.status)?(0,u.A)(d).then(()=>I()).then(g).catch(E):E(c)})})}function M(I){return v.A.get(`${v.A.apiv2baseurl}/microsoft/graph/me`,{params:I})}function j(I,{account:t}={}){return U.wrapApiCallWithAuthz(()=>v.A.get(`${v.A.apiv2baseurl}/microsoft/graph/courses`,{params:I}),{edu:!0,account:t})}function W(I,{account:t,displayAuthPopup:d=!0}={}){const g=`${v.A.apiv2baseurl}/microsoft/graph/courses/${I}/categories`;return d?U.wrapApiCallWithAuthz(()=>v.A.get(g),{edu:!0,account:t}):v.A.get(g)}function w(I,t={},{account:d}={}){return U.wrapApiCallWithAuthz(()=>v.A.post(`${v.A.apiv2baseurl}/classes/${I}/sync`,t),{edu:!0,account:d})}const U={wrapApiCallWithAuthz:m,getMe:M,getCourses:j,getCourseCategories:W,syncMicrosoftGraph:w},D=U},459356:(Y,G,l)=>{l.d(G,{O:()=>w});var r=l(973705),L=l(6645),u=l(744056),v=l(361744),m=l(674548);const M=3e3,j=1;let W=0;const w=(0,L.nY)("toastMessage",()=>{const U=(0,u.KR)([]),D=(0,v.EW)(()=>U.value.slice(0,j));function I(E){U.value.push(E)}function t(E){const c=U.value.findIndex(s=>s.id===E);c!==-1&&(U.value[c].isLeaving=!0,setTimeout(()=>{U.value=U.value.filter(s=>s.id!==E)},500))}function d({text:E,allowHtml:c,message:s,type:e="default",dismissAfter:n=M,link:i,undo:f,isLoading:h=!1,canBeDismissed:a=!1,isLeaving:o=!1}){const _=++W;s&&(E=s),typeof E=="object"&&E.constructor===Object&&E.i18n&&(E=m.MR.t(E.i18n,E.i18nParams)),I({id:_,text:E,allowHtml:c,type:e,dismissAfter:n,isLoading:h,link:i,undo:f,source:"pinia",canBeDismissed:a,isLeaving:o}),setTimeout(()=>t(_),n)}function g({error:E}){const c=(0,r.b)(E,{i18n:m.MR});d({text:c,type:"error"})}return{messages:U,displayedMessages:D,displayMessage:d,displayError:g,removeMessage:t}})},521915:(Y,G,l)=>{l.d(G,{A:()=>c});var r=l(324074),L=l.n(r),u=l(645369),v=l.n(u),m=l(786743),M=l(550594),j=(s,e,n)=>new Promise((i,f)=>{var h=_=>{try{o(n.next(_))}catch(b){f(b)}},a=_=>{try{o(n.throw(_))}catch(b){f(b)}},o=_=>_.done?i(_.value):Promise.resolve(_.value).then(h,a);o((n=n.apply(s,e)).next())});const W=v()("flat:google");let w=!0;function U(s,e={}){const n=Object.assign({idp:"google"},e);return new Promise((i,f)=>{const h=()=>{(0,m.A)(n).then(()=>(w=!0,s())).then(i).catch(f)};return w?s().then(i).catch(a=>{L().isAxiosError(a)&&a.response&&[401,403].includes(a.response.status)?(n.reAuthorize=!0,h()):f(a)}):(W("already know we are not authz on GC"),n.reAuthorize=!0,h())})}function D({account:s}={}){return E.wrapApiCallWithAuthz(()=>M.A.get(`${M.A.apiv2baseurl}/google/drive/picker/config`),{drive:!0,account:s})}function I(s){return j(this,null,function*(){try{const e=yield M.A.get(`${M.A.apiv2baseurl}/google/classroom/me`,{params:s});return w=!0,e}catch(e){throw w=!1,e}})}function t(s,{account:e}={}){return E.wrapApiCallWithAuthz(()=>M.A.get(`${M.A.apiv2baseurl}/google/classroom/courses`,{params:s}),{classroom:!0,account:e})}function d(s,{account:e,displayAuthPopup:n=!0}={}){return n?E.wrapApiCallWithAuthz(()=>M.A.get(`${M.A.apiv2baseurl}/google/classroom/courses/${s}/topics`),{classroom:!0,classroomTopics:!0,account:e}):M.A.get(`${M.A.apiv2baseurl}/google/classroom/courses/${s}/topics`)}function g(s,e={},{account:n}={}){return E.wrapApiCallWithAuthz(()=>M.A.post(`${M.A.apiv2baseurl}/classes/${s}/sync`,e),{classroom:!0,account:n})}const E={wrapApiCallWithAuthz:U,getDrivePickerConfig:D,getClassroomMe:I,getClassroomCourses:t,getClassroomCourseTopics:d,syncGoogleClassroom:g},c=E},525745:(Y,G,l)=>{l.d(G,{m:()=>u});var r=l(855096);function L(v){v.use(r.Ay,{namedConfigurations:{svg:{USE_PROFILES:{svg:!0,svgFilters:!0},ADD_TAGS:["use"]},iframe:{ALLOWED_TAGS:["iframe"]}}})}function u(v){L(v)}},621297:(Y,G,l)=>{l.d(G,{m:()=>E});var r=l(916504),L=l(6645),u=l(744056),v=l(361744),m=l(334980),M=l(264546),j=l(973876),W=l(953654),w=l(459356),U=l(823828),D=l(763939),I=l(777549),t=(c,s,e)=>new Promise((n,i)=>{var f=o=>{try{a(e.next(o))}catch(_){i(_)}},h=o=>{try{a(e.throw(o))}catch(_){i(_)}},a=o=>o.done?n(o.value):Promise.resolve(o.value).then(f,h);a((e=e.apply(c,s)).next())});const d=c=>JSON.parse(JSON.stringify(c)),g=["returned","turnedIn","created","notStarted","overdue"],E=(0,L.nY)("submissions",()=>{const c=(0,u.KR)({}),s=(0,u.KR)(r.A.get("submissions.sortProperty")||"state"),e=(0,u.KR)(r.A.get("submissions.sortDirection")||"asc"),n=(0,u.KR)({}),i=(0,u.KR)([]),f=(0,u.KR)(null),h=(0,u.KR)(-25),a=(0,u.KR)(0);function o(A){const C=e.value==="desc"?-1:1;let P;const N=(F,B)=>{const Q=(0,U.k)().users,q=Q[F.creator],ee=Q[B.creator];let fe,le;return typeof q=="object"&&Object.keys(q).length>0?fe=q[P]:fe=F.creator,typeof ee=="object"&&Object.keys(ee).length>0?le=ee[P]:le=B.creator,typeof fe!="string"||typeof le!="string"?0:fe.localeCompare(le)<0?-1*C:le.localeCompare(fe)<0?C:0};return s.value==="username"||s.value==="lastname"||s.value==="firstname"?(P=s.value,A=A.sort(N)):s.value==="state"&&(A=A.sort((F,B)=>{const Z=g.indexOf(F.state),Q=g.indexOf(B.state);return Z!==Q?C*(Z-Q):F.submissionDate&&B.submissionDate?C*(new Date(F.submissionDate)-new Date(B.submissionDate)):N(F,B)})),A}const _=(0,v.EW)(()=>{const A={};return Object.keys(c.value).forEach(C=>{const P=c.value[C],N=P.assignment;A[N]||(A[N]=[]),A[N].push(P)}),Object.keys(A).forEach(C=>{A[C]=o(A[C])}),A}),b=(0,v.EW)(()=>{const A=_.value,C={};return Object.keys(A).forEach(P=>{const N={created:0,turnedIn:0,returned:0};A[P].forEach(B=>{N[B.state]++,B.state==="graded"&&N.returned++}),C[P]=N}),C}),T=(0,v.EW)(()=>{const A={},C=_.value;return Object.keys(C).forEach(P=>{C[P]&&C[P].length>0&&(A[P]=C[P][0])}),A}),z=(0,v.EW)(()=>{const A={},C=(0,I.Z)();return Object.keys(C.assignments).forEach(P=>{var N;const F=[].concat(_.value[P]||[]),B=C.assignments[P];if(B&&(0,D.F)().isTeacher){const Q=(0,j.V)().classesById[B.classroom];Q&&((0,W.n)().groupMembers[(N=Q.studentsGroup)==null?void 0:N.id]||[]).forEach(fe=>{const le=fe.id;F.find(ve=>ve.creator===le)||F.push({creator:le,state:"notStarted",classroom:B.classroom,assignment:B.id,attachments:[],playback:[],comments:{total:0,unread:0}})})}A[P]=o(F)}),A}),x=(0,v.EW)(()=>i.value.slice(h.value,h.value+25).map(A=>c.value[A]));function H(A){const{classroom:C,assignment:P}=A;A.reviewUrl=`/class/${C}/assignment/${P}/review/${A.id}`,A.reviewRoute={name:"reviewBrowser",params:{classroom:C,assignment:P,submission:A.id}},c.value[A.id]=A}function X(A){const C=c.value[A.id];C&&Object.keys(C).forEach(P=>{typeof A[P]=="undefined"&&(A[P]=C[P])}),H(A)}function J(A){A.forEach(C=>H(C))}function ne(A){delete c.value[A]}function re(A){s.value===A?e.value=e.value==="asc"?"desc":"asc":(s.value=A,e.value="asc"),r.A.set("submissions.sortProperty",s.value),r.A.set("submissions.sortDirection",e.value)}function ie(A){i.value=A}function ue(A){f.value=A||null}function se(A){h.value=A}function ce(A){a.value=A}function de({classId:A,count:C}){n.value[A]=C}function ae(A){return t(this,arguments,function*({classroom:C,assignment:P,submission:N}){const F=yield m.A.getSubmission(C,P,N);return H(F),F})}function y(A){return t(this,arguments,function*({classroom:C,assignment:P,params:N}){const F=yield m.A.listSubmissions(C,P,N);return J(F),F})}function $(A){return t(this,null,function*(){try{const C=yield m.A.updateSubmission(A);return H(C),C}catch(C){throw(0,w.O)().displayError({error:C}),C}})}function p(A){return t(this,arguments,function*({submission:C,isGoogleClassroom:P,isMicrosoftTeams:N,displayErrors:F=!0}){try{const B={};let Z=["attachments","submit","id","classroom","assignment","exercisesIds"];const Q=(0,D.F)();return Q.isTeacher&&(Z=["return","id","classroom","assignment","draftGrade","grade"]),Z.forEach(q=>{typeof C[q]!="undefined"&&(B[q]=C[q])}),C=yield m.A.upsertSubmission(B,{isGoogleClassroom:P,isMicrosoftTeams:N,account:Q.account}),H(C),C}catch(B){throw F&&!B.message.includes("popup_closed")&&!B.message.includes("access_denied")&&(0,w.O)().displayError({error:B}),B}})}function S(A){return t(this,arguments,function*({score:C,classroom:P,assignment:N,submit:F,attachments:B,isGoogleClassroom:Z,isMicrosoftTeams:Q}){if(!B){const ee=d(yield y({classroom:P,assignment:N}));B=ee.length>0?ee[0].attachments:[]}let q=!1;for(let ee=0;ee<B.length;ee++)B[ee].score===C&&(q=!0);return q||B.push({score:C}),m.A.upsertSubmission({classroom:P,assignment:N,attachments:B,submit:F},{isGoogleClassroom:Z,isMicrosoftTeams:Q})})}function O(A){re(A)}function K(A){return t(this,null,function*(){const C=yield M.Ay.getClassSubmissions({classroom:A,params:{submissionState:"turnedIn",onlyCount:!0}});de({classId:A,count:C.counts.assignments})})}function R(A){return t(this,arguments,function*({classroom:C,params:P,isNext:N}){var F;if(P.assignmentId){const B=yield m.A.listSubmissions(C,P.assignmentId,P);se(0),ie(B.map(Z=>Z.id)),J(B)}else if(N)if(h.value+25<i.value.length)se(h.value+25);else{P=Object.assign({},P,f.value);const B=yield M.Ay.getClassSubmissions({classroom:C,params:P}),Z=B.data.map(Q=>Q.id);J(B.data),ie(i.value.concat(Z)),ce(B.counts.assignments),ue(((F=B.links.next)==null?void 0:F.qs)||null),se(h.value+25),P.submissionState==="turnedIn"&&de({classId:P.class,count:B.counts.assignments})}else se(h.value-25)})}function V(){ce(0),ie([]),ue(null),se(-25)}function te(A){return t(this,null,function*(){return yield m.A.getSubmissionHistory(A)})}function oe(A){return t(this,null,function*(){return!A.lti||!A.lti.sourcedid||(A=yield m.A.pullSubmissionLtiGrade(A),H(A)),A})}function k(A){return t(this,arguments,function*({classroom:C,assignment:P,submission:N}){const F=yield m.A.deleteSubmission(C,P,N);return H(F),N})}return{submissions:c,sort:s,direction:e,totalSubCountForClassHeader:n,classSubmissionsIds:i,submissionNext:f,startIndex:h,totalSubmissionCount:a,submissionsByAssignment:_,submissionsByAssignmentStats:b,studentSubmissionsByAssignment:T,classSubmissions:x,CACHE:H,CACHE_PARTIAL:X,CACHE_SUBMISSIONS:J,REMOVE_CACHE:ne,TOGGLE_SORT:re,GET_CLASS_SUBMISSIONS_IDS:ie,SUBMISSION_NEXT:ue,NEW_INDEX:se,GET_TOTAL_SUBMISSION_COUNT:ce,GET_TOTAL_SUB_COUNT_FOR_HEADER:de,get:ae,loadSubmissions:y,updateSubmission:$,upsertSubmission:p,addScoreToSubmission:S,submissionsByAssignmentWithAlStudents:z,toggleSubmissionsSort:O,getPendingClassSubmissionsCount:K,getClassSubmissions:R,clearSubmissionCursor:V,getSubmissionHistory:te,pullSubmissionLtiGrade:oe,deleteSubmission:k}})},706305:(Y,G,l)=>{l.d(G,{j:()=>e});var r=l(6645),L=l(744056),u=l(775),v=l(244270),m=l(130179),M=l(653154),j=l(823828),W=Object.defineProperty,w=Object.defineProperties,U=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,d=(n,i,f)=>i in n?W(n,i,{enumerable:!0,configurable:!0,writable:!0,value:f}):n[i]=f,g=(n,i)=>{for(var f in i||(i={}))I.call(i,f)&&d(n,f,i[f]);if(D)for(var f of D(i))t.call(i,f)&&d(n,f,i[f]);return n},E=(n,i)=>w(n,U(i)),c=(n,i,f)=>new Promise((h,a)=>{var o=T=>{try{b(f.next(T))}catch(z){a(z)}},_=T=>{try{b(f.throw(T))}catch(z){a(z)}},b=T=>T.done?h(T.value):Promise.resolve(T.value).then(o,_);b((f=f.apply(n,i)).next())});const s=n=>JSON.parse(JSON.stringify(n)),e=(0,r.nY)("scores",()=>{const n=(0,L.KR)({}),i=(0,L.KR)([]),f=(0,L.KR)(null);function h(p){return c(this,null,function*(){return n.value[p]?n.value[p]:(0,u.pB)(p)})}function a(p){var S,O;let K=`/score/${p.id}`;p.privacy==="private"&&(K+="/edit"),p.sharingKey&&(K+=`?sharingKey=${p.sharingKey}`);const R=Object.assign(p,{relativeHtmlUrl:K}),V=R._source;delete R._source;const te=n.value[R.id]&&(n.value[R.id].sharingKey!==R.sharingKey||n.value[R.id].privacy!==R.privacy);n.value[R.id]=R,R.isPowerScore=(O=(S=R.user)==null?void 0:S.badges)==null?void 0:O.includes("power"),R.collaborators=R.collaborators||[];const oe=(0,j.k)();for(let A=0;A<R.collaborators.length;A++){const C=R.collaborators[A].user;if(C){const P=oe.users[C.id];C.username==="edu"&&P?R.collaborators[A].user=s(P):oe.cache(C)}}const k=(0,m.I1)();if(V!=="offline"&&k&&k.addOrUpdateScore(R),te&&window.location.pathname.startsWith(`/score/${R.id}`)&&typeof URLSearchParams!="undefined"){const A=new URLSearchParams(window.location.search);R.sharingKey?A.set("sharingKey",R.sharingKey):A.delete("sharingKey");let C=window.location.pathname;const P=A.toString();P.length>0&&(C+=`?${P}`),window.history.replaceState({},`${R.title} - Flat`,C)}return R}function o(p){return c(this,null,function*(){if(n.value[p])return n.value[p];const S=yield(0,u.pB)(p);return a(S)})}function _(p){var S;const O=(S=n.value[p])==null?void 0:S.likes;(O==null?void 0:O.total)!==void 0&&O.total++}function b(p){var S;const O=(S=n.value[p])==null?void 0:S.likes;(O==null?void 0:O.total)!==void 0&&O.total--}function T(p){return c(this,arguments,function*({scoreId:S,payload:O}){const K=yield(0,u.T9)(S,O);return a(K),K})}function z(p,S){var O,K;const R=n.value[p];if(!R){(0,M.vV)("Score not found in cache");return}const V=(O=R.collaborators)==null?void 0:O.find(te=>te.id===S.id);V?Object.assign(V,S):(K=R.collaborators)==null||K.push(S)}function x(p){return c(this,arguments,function*({scores:S,user:O,userEmail:K,group:R,aclRead:V=!0,aclWrite:te=!1,aclAdmin:oe=!1}){const k={user:O,userEmail:K,group:R},A=S.map(N=>typeof N=="string"?N:N.id),C=A.map(N=>(0,u.OZ)(N,E(g({},k),{aclRead:V,aclWrite:te,aclAdmin:oe}))),P=yield Promise.all(C);A.forEach((N,F)=>{const B=P[F];z(N,B)})})}function H({score:p,target:S}){const O=n.value[p];O.collaborators=O.collaborators.filter(K=>K.id!==S)}function X(p){return c(this,arguments,function*({scores:S,target:O}){const K=S.map(V=>typeof V=="string"?V:V.id),R=K.map(V=>(0,u.rn)(V,O));yield Promise.all(R),K.forEach(V=>{H({score:V,target:O})})})}function J(p){a(p)}function ne(p){i.value=p}function re({scoreId:p,collaborator:S}){n.value[p].rights.userRights=S}function ie(p){f.value=p}function ue(p){return c(this,arguments,function*({id:S,limit:O,next:K}){const R=yield(0,v.zZ)({id:S,limit:O,next:K,paginate:!0});return ae(R.data),R})}function se(p){return c(this,arguments,function*({id:S,limit:O,next:K}){const R=yield(0,v.w1)({id:S,limit:O,next:K});return ae(R.data),R})}function ce(p){return c(this,arguments,function*({userId:S}){const O=yield(0,v.w_)({userId:S});return ae(O),O})}function de(p){return c(this,arguments,function*({period:S,limit:O,next:K}){const R=yield(0,v.Dt)({period:S,limit:O,next:K});return ae(R.data),R})}function ae(p){p.forEach(S=>{a(S)})}function y(p,S){const O=n.value[p];O!=null&&O.collections&&!O.collections.includes(S)&&O.collections.push(S)}function $(p,S){const O=n.value[p];O!=null&&O.collections&&(O.collections=O.collections.filter(K=>K!==S))}return{scores:n,offline:i,currentPlayingScoreId:f,cache:a,get:h,updateScore:T,getAndCache:o,incrLikes:_,decrLikes:b,addRights:x,removeRights:X,offlineScores:ne,pushHandle:J,SET_AUTH_USER_COLLAB_RIGHTS:re,setCurrentPlayingScoreId:ie,getUserPublicScores:ue,getUserPinnedScores:ce,getUserLikedScores:se,getUserTopScores:de,addCollectionToScore:y,removeCollectionFromScore:$}})},777549:(Y,G,l)=>{l.d(G,{Z:()=>c});var r=l(324074),L=l(645369),u=l.n(L),v=l(6645),m=l(334980),M=l(550594);const W={previewLink(s){return M.A.post(`${M.A.apiv2baseurl}/previews/urls`,s)}};var w=l(540888),U=l(674548),D=l(973876),I=l(459356),t=l(706305),d=l(621297),g=(s,e,n)=>new Promise((i,f)=>{var h=_=>{try{o(n.next(_))}catch(b){f(b)}},a=_=>{try{o(n.throw(_))}catch(b){f(b)}},o=_=>_.done?i(_.value):Promise.resolve(_.value).then(h,a);o((n=n.apply(s,e)).next())});const E=u()("flat:assignments"),c=(0,v.nY)("assignments",{state:()=>({assignments:{}}),getters:{allAssignmentsByCreationDate(s){return Object.values(s.assignments).sort((e,n)=>n.creationDate.getTime()-e.creationDate.getTime())},assignmentsByClass(s){const e={};return Object.keys(s.assignments).forEach(n=>{const i=s.assignments[n],f=i.classroom;e[f]||(e[f]=[]),e[f].push(i)}),Object.keys(e).forEach(n=>{e[n]=e[n].sort((i,f)=>{var h,a;return((h=f.creationDate)==null?void 0:h.getTime())-((a=i.creationDate)==null?void 0:a.getTime())})}),e},assignmentsByClassAndDisplayState(){const s={};return Object.keys(this.assignmentsByClass).forEach(e=>{s[e]={draft:[],upcoming:[],active:[],archived:[]},this.assignmentsByClass[e].forEach(n=>{n.scheduledDate?s[e].upcoming.push(n):n.state==="draft"?s[e].draft.push(n):n.state==="archived"?s[e].archived.push(n):s[e].active.push(n)})}),s},allAssignmentsCount(s){return Object.keys(s.assignments).length}},actions:{CACHE(s){Array.isArray(s.submissions)&&s.submissions.length>0&&(0,d.m)().CACHE_SUBMISSIONS(s.submissions);const e=Object.assign({},s,{submissions:void 0});e.routeDetails={name:"classAssignment",params:{assignment:e.id,classroom:e.classroom}},e.urlDetails=`/class/${e.classroom}/assignment/${e.id}`,e.type==="worksheet"?(e.routeEdit=Object.assign({},e.routeDetails,{name:"classEditAssignment"}),e.routeStudentWork=Object.assign({},e.routeDetails,{name:"classWorksheetStudentWork"})):e.routeEdit=Object.assign({},e.routeDetails,{name:"classEditAssignment"}),e.creationDate&&(e.creationDate=new Date(e.creationDate)),e.dueDate&&(e.dueDate=new Date(e.dueDate),e.dueDateFormatted=(0,w.r6)(e.dueDate)),e.scheduledDate&&(e.scheduledDate=new Date(e.scheduledDate),e.scheduledDateFormatted=(0,w.r6)(e.scheduledDate)),this.assignments[e.id]=e},REMOVE_CACHE(s){delete this.assignments[s]},CACHE_ASSIGNMENTS(s){s.forEach(e=>this.CACHE.call(this,e))},loadAllClassesAssignments(){return g(this,null,function*(){const s=(0,D.V)(),e=Object.keys(s.classesById);return Promise.all(e.map(n=>this.loadClassAssignments({classroom:n})))})},loadClassAssignments(s){return g(this,arguments,function*({classroom:e}){const n=yield m.A.list(e);this.CACHE_ASSIGNMENTS(n),n.forEach(i=>{i.submissions&&i.submissions.length>0&&(0,d.m)().CACHE_SUBMISSIONS(i.submissions)})})},loadAssignment(s){return g(this,arguments,function*({classroom:e,assignment:n,syncSubmissions:i=!1}){if(!this.assignments[n]){const h=yield m.A.get(e,n);this.CACHE(h),this.loadScoreAttachments(h).catch(a=>{E("err while resolving additional attachments",a)})}const f=this.assignments[n];return i&&(yield this.scheduleSyncAssignmentSubmissions({classroom:e,assignment:f})),f})},scheduleSyncAssignmentSubmissions({classroom:s,assignment:e}){var n,i;((n=e.googleClassroom)!=null&&n.id||(i=e.microsoftGraph)!=null&&i.id)&&setTimeout(()=>m.A.syncSubmissions(s,e.id),300)},loadScoreAttachments(s){const{getAndCache:e}=(0,t.j)();return Promise.all(s.attachments.filter(n=>n.type==="flat").map(n=>e(n.score)))},createAssignment(s){return g(this,arguments,function*({assignment:e,isGoogleClassroom:n,isMicrosoftTeams:i}){const f=yield m.A.create(e,{isGoogleClassroom:n,isMicrosoftTeams:i});return this.CACHE(f),f})},updateAssignment(s){return g(this,arguments,function*({assignment:e,isGoogleClassroom:n,isMicrosoftTeams:i}){const f=yield m.A.update(e,{isGoogleClassroom:n,isMicrosoftTeams:i});return this.CACHE(f),f})},deleteAssignment(s){return g(this,arguments,function*({classroom:e,assignment:n}){var i;try{yield m.A.delete(e,n),this.REMOVE_CACHE(n)}catch(f){if(f instanceof r.AxiosError&&((i=f.response)==null?void 0:i.status)===404){this.REMOVE_CACHE(n);return}throw f}})},copyAssignment(s){return g(this,arguments,function*({assignment:e,destinationClassroom:n,destinationAssignment:i,scheduledDate:f,isGoogleClassroom:h,isMicrosoftTeams:a}){const o=yield m.A.copy(e.classroom,e.id,{classroom:n||void 0,assignment:i||void 0,scheduledDate:f||void 0},{isGoogleClassroom:h,isMicrosoftTeams:a});return this.CACHE(o),o})},addAttachment(s){return g(this,arguments,function*({attachments:e,attachment:n}){const i=e.findIndex(f=>f.type===n.type&&(f.type==="flat"&&f.score===n.score||f.type==="link"&&f.url===n.url));if(i>=0){if(e[i].sharingMode!==n.sharingMode&&n.sharingMode==="read"){(0,I.O)().displayError({error:U.MR.t("edu:assignments-creation.error-same-score")});return}const f=e[i].preview;f&&(n.preview=f),e[i]=n}else e.push(n),n.type==="flat"?yield this.attachmentsFetchScoresDetails({attachments:e}):n.type==="link"&&!n.preview&&(yield this.attachmentsUpdateLinks({attachments:e}))})},attachmentsFetchScoresDetails({attachments:s}){const{getAndCache:e}=(0,t.j)();return Promise.all(s.filter(n=>n.type==="flat").map(n=>e(n.score)))},attachmentsUpdateLinks({attachments:s}){return Promise.all(s.filter(e=>e.type==="link"&&!e.preview&&!e.title).map(e=>g(null,null,function*(){if(e.url){const n=yield W.previewLink({url:e.url});n.type="link",n.url=e.url,e.preview=n,Object.keys(n).forEach(i=>{e[i]=e.preview[i]})}})))},archiveAssignment(s){return g(this,arguments,function*({classroom:e,assignment:n}){const i=yield m.A.archiveAssignment(e,n);return this.CACHE(i),i})},unArchiveAssignment(s){return g(this,arguments,function*({classroom:e,assignment:n}){const i=yield m.A.unArchiveAssignment(e,n);return this.CACHE(i),i})},getToolsetSharingInfo(s){return g(this,arguments,function*({classroom:e,assignment:n}){return yield m.A.getToolsetSharingInfo({classroom:e,assignment:n})})}}})},786743:(Y,G,l)=>{l.d(G,{A:()=>M});var r=l(645369),L=l.n(r),u=l(328010),v=l(802031);const m=L()("flat:authPopup");function M({idp:j,account:W,edu:w=!1,classroom:U=!1,drive:D=!1,classroomTopics:I=!1,microsoftTeams:t=null,hd:d=null,skipGetMe:g=!1,reAuthorize:E=!1,product:c=null}){return new Promise((s,e)=>{var n,i;let f=!1,h=`/auth/${j}?flatService=popup`;if(t&&(h+="Teams"),j==="google"&&W){const _=((n=W.googleDetails)==null?void 0:n.email)||W.email;h+=`&email=${_}`}else j==="azure"&&((i=W==null?void 0:W.azureDetails)!=null&&i.preferredUsername)&&(h+=`&upn=${W.azureDetails.preferredUsername}`);j==="google"&&(E&&(h+="&prompt=consent"),U&&(h+="&classroom=true"),D&&(h+="&drive=true"),I&&(h+="&classroomTopics=true")),c&&(h+=`&product=${c}`),w&&(h+="&edu=true"),d&&(h+=`&hd=${d}`),W!=null&&W.id&&(h+=`&linkAccount=true&csrf=${u.A.getsCsrfToken()}`);const a=500,o=575;if(t)(0,v.A)({microsoftTeams:t,url:h,width:a,height:o}).then(s).catch(e);else{const _=X=>{const J=X.data;if(!f&&J&&J.type==="flat-signin-return"){window.removeEventListener("message",_);const ne=()=>{if(f=!0,J.error){const re=new Error(J.error);re.clientError=!0,e(re)}else s()};g?ne():u.A.get().then(()=>ne()).catch(()=>ne())}};window.addEventListener("message",_);const b=window.outerHeight/2+window.screenY-o/2,T=window.outerWidth/2+window.screenX-a/2,z=`menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width=${a},height=${o},top=${b},left=${T}`;m("Url before opening popup: %s",h);const x=window.open(h,"Flat - Sign in",z);if(!x){const X=new Error("Unable to open authentication popup");X.clientError=!0,e(X);return}x.focus();const H=setInterval(()=>{if(x.closed&&(clearInterval(H),window.removeEventListener("message",_),!f)){const X=new Error("popup_closed");X.clientError=!0,X.sentryLogging=!1,e(X)}},500)}})}},802031:(Y,G,l)=>{l.d(G,{A:()=>L});var r=(u,v,m)=>new Promise((M,j)=>{var W=D=>{try{U(m.next(D))}catch(I){j(I)}},w=D=>{try{U(m.throw(D))}catch(I){j(I)}},U=D=>D.done?M(D.value):Promise.resolve(D.value).then(W,w);U((m=m.apply(u,v)).next())});function L(u){return r(this,arguments,function*({microsoftTeams:v=null,url:m,width:M=600,height:j=535}){try{if(!v)throw new Error("microsoftTeams SDK instance is required");return yield v.authentication.authenticate({url:m,width:M,height:j})}catch(W){if(W.message==="CancelledByUser"){const w=new Error("popup_closed");throw w.clientError=!0,w}throw W}})}},953654:(Y,G,l)=>{l.d(G,{n:()=>w});var r=l(916504),L=l(6645),u=l(744056),v=l(361744),m=l(348680),M=l(823828),j=(U,D,I)=>new Promise((t,d)=>{var g=s=>{try{c(I.next(s))}catch(e){d(e)}},E=s=>{try{c(I.throw(s))}catch(e){d(e)}},c=s=>s.done?t(s.value):Promise.resolve(s.value).then(g,E);c((I=I.apply(U,D)).next())});const W=new Date("2000-01-01"),w=(0,L.nY)("groups",()=>{const U=(0,u.KR)({}),D=(0,u.KR)({}),I=(0,u.KR)(r.A.get("groupsUsers.sortProperty")||"username"),t=(0,u.KR)(r.A.get("groupsUsers.sortDirection")||"asc"),d=(0,v.EW)(()=>{const i={},f=I.value,h=t.value==="desc"?-1:1,a=(0,M.k)();return Object.keys(D.value).forEach(o=>{i[o]=D.value[o].map(_=>a.users[_]).filter(_=>Object.keys(_).length>=1).sort((_,b)=>{let T=_[f],z=b[f];return f==="lastActivityDate"&&(T||(T=W),z||(z=W)),T<z?-1*h:T>z?1*h:0})}),i});function g(i){U.value[i.id]=i}function E({group:i,users:f}){D.value[i]=[];const h=(0,M.k)();f.forEach(a=>{D.value[i].push(a.id),h.cache(a)})}function c(i){const{user:f,group:h}=i;if(D.value[h]||(D.value[h]=[]),D.value[h].includes(f)){const a=(0,M.k)();D.value[h].push(f),a.get(f)}}function s(i){I.value===i?t.value=t.value==="asc"?"desc":"asc":(I.value=i,t.value="asc"),r.A.set("groupsUsers.sortProperty",I.value),r.A.set("groupsUsers.sortDirection",t.value)}function e(i){return j(this,arguments,function*({group:f}){const h=yield m.A.listUsers(f);E({group:f,users:h})})}function n(i){s(i)}return{cache:U,cacheUsers:D,sort:I,direction:t,groupMembers:d,listGroupUsers:e,toggleGroupSort:n,CACHE:g,CACHE_USERS:E,CACHE_GROUP_MEMBER:c,TOGGLE_SORT:s}})},973876:(Y,G,l)=>{l.d(G,{V:()=>I});var r=l(6645),L=l(744056),u=l(361744),v=l(334980),m=l(264546),M=l(521915),j=l(433514),W=l(185407),w=l(763939),U=l(953654),D=(t,d,g)=>new Promise((E,c)=>{var s=i=>{try{n(g.next(i))}catch(f){c(f)}},e=i=>{try{n(g.throw(i))}catch(f){c(f)}},n=i=>i.done?E(i.value):Promise.resolve(i.value).then(s,e);n((g=g.apply(t,d)).next())});const I=(0,r.nY)("classes",()=>{const t=(0,L.KR)([]),d=(0,L.KR)([]),g=(0,L.KR)(!1),E=(0,L.KR)(!1),c=(0,L.KR)(!1),s=(0,L.KR)([]),e=(0,u.EW)(()=>{const y={};return t.value.forEach($=>{y[$.id]=$}),y}),n=(0,u.EW)(()=>[...t.value].sort((y,$)=>y.creationDate<$.creationDate?1:y.creationDate>$.creationDate?-1:0)),i=(0,u.EW)(()=>[...t.value].sort((y,$)=>{const p=(y.name||"").toLowerCase(),S=($.name||"").toLowerCase();return p>S?1:p<S?-1:0})),f=(0,u.EW)(()=>i.value.filter(y=>y.state==="active")),h=(0,u.EW)(()=>i.value.filter(y=>y.state==="archived")),a=(0,u.EW)(()=>{const y={};return s.value.forEach($=>{y[$.teachersGroup.id]=$,y[$.studentsGroup.id]=$}),y});function o(y){var $;const p=Object.assign({},y,{link:`/class/${y.id}`,cssTheme:`theme-${y.theme}`,creationDate:new Date(y.creationDate||new Date),googleClassroom:y.googleClassroom||{},microsoftGraph:y.microsoftGraph||{},mfc:y.mfc||{},lti:y.lti||{},clever:y.clever||{}},y,{});if(d.value.includes(y.id))return p;($=p.canvas)!=null&&$.id&&(p.canvas.domain||(p.canvas.domain="canvas.instructure.com"),p.canvas.alternateLink=`https://${p.canvas.domain}/courses/${p.canvas.id}`);const S=t.value.findIndex(K=>K.id===p.id);if(S!==-1){const K=t.value[S];(!p.studentsGroup||!p.studentsGroup.id)&&(p.studentsGroup=K.studentsGroup),(!p.teachersGroup||!p.teachersGroup.id)&&(p.teachersGroup=K.teachersGroup),p.enrollmentCode||(p.enrollmentCode=K.enrollmentCode),t.value[S]=p}else t.value.unshift(p);const O=(0,U.n)();return O.CACHE(p.teachersGroup),O.CACHE(p.studentsGroup),p}function _(y){const $=t.value.findIndex(p=>p.id===y);$>=0&&(t.value.splice($,1),d.value.push(y))}function b(y){t.value=[],y.forEach($=>o($)),E.value=!0}function T(y){s.value=y}function z(y){g.value=y}function x(y){c.value=y}function H(){return D(this,arguments,function*(y={}){const{cached:$,archived:p=!0,updateLoading:S=!0}=y;if($&&E.value)return t.value;try{t.value.length===0&&S&&z(!0);const O=[m.Ay.list()];p&&O.push(m.Ay.list({state:"archived"}));const K=(yield Promise.all(O)).flat();b(K),z(!1)}catch(O){throw z(!1),O}return t.value})}function X(y){return D(this,null,function*(){try{e.value[y]&&z(!0);const $=yield m.Ay.get(y),p=o($);return z(!1),p}catch($){throw z(!1),$}})}function J(y){return D(this,null,function*(){const $=yield m.Ay.join(y);return o($)})}function ne(y){return D(this,null,function*(){const $=yield m.Ay.create(y);return o($)})}function re(y){return D(this,null,function*(){const $=yield m.Ay.update(y.id,y);return o($)})}function ie(y){return D(this,null,function*(){const $=yield m.Ay.archive(y);return o($)})}function ue(y){return D(this,null,function*(){const $=yield m.Ay.unarchive(y);return o($)})}function se(y){return D(this,null,function*(){try{z(!0),yield m.Ay.delete(y),_(y),z(!1)}catch($){throw z(!1),$}})}function ce(y){return D(this,null,function*(){const{id:$,googleCourseId:p,microsoftGraphCourseId:S}=y;try{x(!0);let O;return p?O=yield M.A.syncGoogleClassroom($,{googleCourseId:p}):S&&(O=yield j.A.syncMicrosoftGraph($,{microsoftGraphCourseId:S})),O&&o(O),x(!1),O}catch(O){throw x(!1),O}})}function de(y){return D(this,null,function*(){var $,p,S;const O=e.value[y];if(c.value||!O||!(($=O.googleClassroom)!=null&&$.id)&&!((p=O.microsoftGraph)!=null&&p.id)&&!((S=O.lti)!=null&&S.hasNrpsService))return;x(!0);const K=[v.A.sync(y)];(0,w.F)().account.classRole==="teacher"&&K.push(D(null,null,function*(){var V,te,oe;let k;if((V=O.googleClassroom)!=null&&V.id)k={googleCourseId:O.googleClassroom.id};else if((te=O.microsoftGraph)!=null&&te.id)k={microsoftGraphCourseId:O.microsoftGraph.id};else if((oe=O.lti)!=null&&oe.hasNrpsService)k={};else return;const A=yield m.Ay.sync(y,k);o(A)}));try{yield Promise.all(K),x(!1)}catch(V){x(!1)}})}function ae(){return D(this,null,function*(){const y=yield W.A.getOrganizationClasses();return T(y),y})}return{classes:t,deletedClassesIds:d,loadingClasses:g,cached:E,synchronizing:c,organizationClasses:s,classesById:e,sortedClassesByDateDesc:n,sortedClassesByName:i,activeClasses:f,archivedClasses:h,classesByGroupId:a,loadClasses:H,loadClass:X,joinClass:J,createClass:ne,updateClass:re,archiveClass:ie,unarchiveClass:ue,deleteClass:se,startSync:ce,syncClass:de,getOrganizationClasses:ae,deleteUserFromClass:m.Ay.deleteUserFromClass,addUserToClass:m.Ay.addUserToClass,createTestAccount:m.Ay.createTestStudentAccount,CACHE:o,CACHE_DELETE:_,SET_CLASSES:b,GET_CLASSES_INFO:T,LOADING:z,SYNCHRONIZING:x}})}}]);})();


//# debugId=b3862260-5a72-5fa1-89dd-b383d10437fb
