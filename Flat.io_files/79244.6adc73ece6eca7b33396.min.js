
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="778fb4ab-402f-5412-8e3a-4535e263da89")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[79244],{2255:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Ee});var A=r(726042),w=r(476943);function f(tt,Et,Vt){this.init(tt,Et,Vt)}const P=f.prototype;P.init=function(tt,Et,Vt){this.voicesData=tt,this.dpq=Et,this.nbDivisions=Vt,this.alignmentSpace=null,this.totalDivisions=null},P.getDpq=function(){return this.dpq},P.getAlignmentSpace=function(){return this.alignmentSpace===null&&this.calcAlignmentSpace(),this.alignmentSpace},P.calcAlignmentSpace=function(){const Et=this.getFirstNotes().map(h);this.alignmentSpace=Et.reduce(A.default.max2)},P.getFirstNotes=function(){let Et=this.getVoicesData().map(a);return Et=Et.filter(w.default.isTruthy),Et};const a=function(tt){if(tt.length===0)return null;const Et=tt[0];return Et.timePos!==0?null:Et},h=function(tt){return tt.spaceBefore};P.getNbDivisions=function(){return this.nbDivisions},P.getAnyVoice=function(){return this.voicesData[0]},P.getVoicesData=function(){return this.voicesData};const d=f;var l=r(967220);const m=function(tt,Et,Vt,ct){const fe=new x(tt,Et,Vt,ct);return fe.analyzeMeasures(),fe.getOverlap()},x=function(tt,Et,Vt,ct){this.init(tt,Et,Vt,ct)},S=x.prototype;S.init=function(tt,Et,Vt,ct){this.measuresData=tt,this.globalDpq=Et,this.notesFormatter=Vt,this.drawingContext=ct,this.spaceAfterNotes=null,this.attributesWidth=0},S.analyzeMeasures=function(){const tt=this.measuresData.length;for(let Et=0;Et<tt&&!this.canStop();Et++)this.analyzeMeasure(Et);this.spaceAfterNotes===null&&this.computeGlobalSpaceAfterNotes()},S.canStop=function(){return this.spaceAfterNotes===0},S.analyzeMeasure=function(tt){this.hasAttributes(tt)&&(this.gatherSpaceAvailable(tt),this.gatherAttributesWidth(tt))},S.hasAttributes=function(tt){return this.getAttributesWidth(tt)>0},S.gatherAttributesWidth=function(tt){const Et=this.getAttributesWidth(tt);this.attributesWidth=Math.max(this.attributesWidth,Et)},S.getAttributesWidth=function(tt){return this.measuresData[tt].rightAttributes},S.computeGlobalSpaceAfterNotes=function(){const tt=this.measuresData.length;for(let Et=0;Et<tt&&!this.canStop();Et++)this.gatherSpaceAvailable(Et)},S.gatherSpaceAvailable=function(tt){const Et=this.getMeasureSpaceAfterNotes(tt);this.spaceAfterNotes===null?this.spaceAfterNotes=Et:this.spaceAfterNotes=Math.min(this.spaceAfterNotes,Et)},S.getMeasureSpaceAfterNotes=function(tt){return this.measuresData[tt].tickablesContents.filter(T).map(this.getTickablesContentSpaceAfterNotes,this).reduce(A.default.min2)};const T=function(tt){return l.A.isInsideStaff(tt.type)};S.getTickablesContentSpaceAfterNotes=function(tt){const Et=tt.entities.length,Vt=tt.entities[Et-1],ct=this.drawingContext.getMarginSize();let fe;if(Et===1&&Vt.isRest)fe=this.notesFormatter.getMiddlePos(),fe-=Vt.spaceAfter/2;else{const Ht=Vt.timePos*this.globalDpq/tt.dpq;fe=this.notesFormatter.getInternalPosX(Ht)}const gt=fe+Vt.spaceAfter+ct;return this.notesFormatter.getNominalWidth()-gt},S.getOverlap=function(){return Math.min(this.spaceAfterNotes,this.attributesWidth)};const Y=m;var G=r(364842),q=r(843678);const R=function(tt){return tt.map(p).reduce(C,null)},p=function(tt){const Et={},Vt=b(tt);for(const ct in tt.leftAttributesByMeasurePos){const gt=tt.leftAttributesByMeasurePos[ct]+Vt;Et[ct]=gt}return Et},b=function(tt){return tt.tickablesContents.filter(v).map(B).reduce(A.default.max2)+tt.spaceBeforeNotes},v=function(tt){return l.A.isInsideStaff(tt.type)},B=function(tt){return tt.entities[0].spaceBefore},C=function(tt,Et){if(tt===null)return Et;const Vt={};for(const ct in tt)if(typeof Et[ct]!="undefined"){const fe=tt[ct],gt=Et[ct];Vt[ct]=Math.max(fe,gt)}if(q.default.isEmpty(Vt)){const ct="space before notes are incompatible when merging horizontal alignment data.";throw new G.default("IncompatibleMeasures",ct)}return Vt},_=R,st=function(tt,Et){this.init(tt,Et)};st.isSame=function(tt,Et){const Vt=tt.formatting,ct=Et.formatting;for(const fe in Vt){const gt=Vt[fe],At=ct[fe];if(gt!==At)return!1}return tt.measurePos!==Et.measurePos?!1:tt.notesFormatter.isSame(Et.notesFormatter)};const F=st.prototype;F.init=function(tt,Et){this.formatting=tt,this.notesFormatter=Et,this.measurePos=null},F.setWidth=function(tt,Et){const Vt=this.getNominalWidth(Et);if(tt>Vt){const ct=tt-Vt,gt=this.getNotesNominalWidth()+ct;this.setNotesWidth(gt)}},F.setNotesWidth=function(tt){this.getNotesFormatter().setWidth(tt)},F.setMeasurePosition=function(tt){this.checkMeasurePos(tt),this.measurePos=tt},F.getNominalWidth=function(tt){const Et=this.getRightBarlineNominalX(tt),Vt=this.formatting.barlineEndDistance;return Et+Vt},F.getRightBarlineNominalX=function(tt){const Et=this.getRightAttributesNominalX(tt),Vt=this.formatting.attributesBarlineDistance;return Et+Vt},F.getRightAttributesNominalX=function(tt){const Et=this.getNotesX(tt),Vt=this.getNotesNominalWidth(),ct=this.formatting.notesAttributesOverlap;return Et+Vt-ct},F.getNotesNominalWidth=function(){return this.getNotesFormatter().getNominalWidth()},F.getWidth=function(tt){const Et=this.getRightBarlineX(tt),Vt=this.formatting.barlineEndDistance;return Et+Vt},F.getRightBarlineX=function(tt){const Et=this.getRightAttributesX(tt),Vt=this.formatting.attributesBarlineDistance;return Et+Vt},F.getRightAttributesX=function(tt){const Et=this.getNotesX(tt),ct=this.getNotesFormatter().getWidth(),fe=this.formatting.notesAttributesOverlap;return Et+ct-fe},F.getNotesFormatter=function(){return this.notesFormatter},F.getNotesX=function(tt){const Et=this.getAttributesX(),Vt=this.getAttributesNotesDistance(tt);return Et+Vt},F.getAttributesX=function(){return this.formatting.barlineAttributesDistance},F.getAttributesNotesDistance=function(tt){return tt=this.getMeasurePos(tt),this.checkMeasurePos(tt),this.formatting.attributesNotesDistanceByMeasurePos[tt]},F.getMeasurePos=function(tt){if(typeof tt!="undefined")return tt;if(this.hasMeasurePos())return this.measurePos;{const Et="There is no measure pos defined.";throw new G.default("MissingMeasurePos",Et)}},F.hasMeasurePos=function(){return this.measurePos!==null},F.checkMeasurePos=function(tt){if(typeof this.formatting.attributesNotesDistanceByMeasurePos[tt]=="undefined"){const Vt=`There is no attributes specified for the measure position [${tt}].`;throw new G.default("InvalidMeasurePos",Vt)}};const L=st;var I=r(385783);function W(tt){const Vt=this.valueOf()/tt.dpq;return tt.nbDivisions*Vt}const V=function(tt,Et,Vt,ct){this.init(tt,Et,Vt,ct)},it=V.prototype;it.init=function(tt,Et,Vt,ct){this.NotesFormatter=Vt,this.drawingContext=tt,this.measuresData=Et,this.isMinimal=ct,this.notesFormatter=null,this.barlineAttributesDistance=null,this.attributesNotesDistanceByMeasurePos=null,this.notesAttributesOverlap=null,this.attributesBarlineDistance=null,this.barlineEndDistance=null},it.format=function(){this.alignBarlineAttributesDistance(),this.alignAttributesNotesDistanceByMeasurePos(),this.gatherDpq(),this.gatherGlobalTickablesContents(),this.formatNotes(),this.gatherNotesAttributesOverlap(),this.alignAttributesBarlineDistance(),this.alignBarlineEndDistance()},it.alignBarlineAttributesDistance=function(){const tt=this.measuresData.map(Pt);this.barlineAttributesDistance=tt.reduce(A.default.max2)};const Pt=function(tt){return tt.leftBarline};it.alignAttributesNotesDistanceByMeasurePos=function(){this.attributesNotesDistanceByMeasurePos=_(this.measuresData)},it.gatherDpq=function(){const tt=this.measuresData.map(Yt);this.dpq=tt.reduce(A.default.lcm)};const Yt=function(tt){return tt.tickablesContents.map(Bt).reduce(A.default.lcm)},Bt=function(tt){return tt.dpq};it.gatherGlobalTickablesContents=function(){const tt=this.getAllTickablesContents();this.tickablesContents=tt.map(I.A,this.dpq);const Et=tt.map(W,this.dpq);this.nbDivisions=Et.reduce(A.default.max2)},it.getAllTickablesContents=function(){const tt=this.measuresData.map(le);return Array.prototype.concat.apply([],tt)};const le=function(tt){return tt.tickablesContents};it.formatNotes=function(){const tt=new d(this.tickablesContents,this.dpq,this.nbDivisions),Et=this.NotesFormatter;this.notesFormatter=new Et(tt,this.drawingContext,this.isMinimal)},it.gatherNotesAttributesOverlap=function(){this.notesAttributesOverlap=Y(this.measuresData,this.dpq,this.notesFormatter,this.drawingContext)},it.alignAttributesBarlineDistance=function(){const tt=this.measuresData.map(ie);this.attributesBarlineDistance=tt.reduce(A.default.max2)};const ie=function(tt){return tt.rightAttributes};it.alignBarlineEndDistance=function(){const tt=this.measuresData.map(K);this.barlineEndDistance=tt.reduce(A.default.max2)};const K=function(tt){return tt.rightBarline};it.getFormatting=function(){const tt={barlineAttributesDistance:this.barlineAttributesDistance,attributesNotesDistanceByMeasurePos:this.attributesNotesDistanceByMeasurePos,notesAttributesOverlap:this.notesAttributesOverlap,attributesBarlineDistance:this.attributesBarlineDistance,barlineEndDistance:this.barlineEndDistance},Et=this.notesFormatter;return new L(tt,Et)},it.getSettedWidth=function(){return this.measuresData.map(pe).reduce(A.default.max2)};const pe=function(tt){return tt.settedWidth},Ee=V},34262:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(w,f){return{x:w,y:f}}},48264:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});var A=r(996636),w=r(659140),f=r(100673),P=r(51342);const a=function(m){this.init(m)};a.NAME="chord.major";const h=a.prototype;h.name=a.NAME,h.init=function(m){this.textStr=d(m),this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText(m)};function d(m){if(m===A.A.UPPER_CASE)return P.A.MAJOR_TEXT_UPPER_CASE;if(m===A.A.LOWER_CASE_LONG)return P.A.MAJOR_TEXT;A.A.raiseError(w.A.MAJOR,m)}h.createText=function(){const m={text:this.textStr};this.textStr===P.A.MAJOR_TEXT_UPPER_CASE&&(m["font-variant"]="small-caps"),this.text=new f.A(m)},h.setParent=function(m){this.parent=m,this.text.setParent(m)},h.setPosX=function(m){this.posX=m},h.setPosY=function(m){this.posY=m},h.setDrawingContext=function(m){this.drawingContext=m,this.text.setDrawingContext(m);const x=this.getFontSize();this.text.setFontSize(x);const S=m.getHarmonyFontFamily(),T=m.getHarmonyFontStyle(),Y=m.getHarmonyFontWeight();this.text.options["font-family"]=S,this.text.options["font-style"]=T,this.text.options["font-weight"]=Y},h.draw=function(){this.rendered||this.render(),this.move()},h.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},h.move=function(){if(this.rendered&&this.posX!==null&&this.posY!==null){const m=this.getYShift(),x=this.posY-m;this.text.setPosition(this.posX,x),this.text.move()}},h.getWidth=function(){return this.text.getWidth()},h.getHeight=function(){const m=this.getSpaceAbove(),x=this.getSpaceBelow();return m+x},h.getSpaceAbove=function(){const m=this.getYShift(),x=this.getFontSize();return m+x},h.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*P.A.SUPSCRIPT_BASELINE},h.getFontSize=function(){return this.drawingContext.getHarmonyFontSize()*P.A.SMALL_FONT_SIZE},h.getSpaceBelow=function(){return this.drawingContext.getHarmonyFontSize()/2};const l=a},51342:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});const w={GLOBAL_RATIO:.7,SMALL_FONT_SIZE:.7,SUBSCRIPT_BASELINE:.14,SUPSCRIPT_BASELINE:.35,MINOR_TEXT:"m",DIMINISHED_TEXT:"dim",MAJOR_TEXT:"maj",MAJOR_TEXT_UPPER_CASE:"M",SUS4_TEXT:"(sus4)",SUS2_TEXT:"(sus2)",MAJOR_CAPS:!1}},61122:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>a});var A=r(231088),w=r(701387),f=r(123491),P=r(351277);function a(h,d){const[l]=w.default.getTranspose(h);w.default.getNotes(h).forEach(x=>{if(!f.default.hasPitch(x))return;let S=f.default.getPitch(x);try{S=P.default.transpose(S,l);const T=P.default.toMIDIPitch(S),Y=T<d.min||T>d.max;f.default.setIsOutOfTessiture(x,Y)}catch(T){if(T instanceof A.default)f.default.setIsOutOfTessiture(x,!0);else throw T}})}},62340:function(Rt){(function(J,r){Rt.exports=r()})(this,function(){"use strict";var J={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},r=new RegExp(/^#([a-f0-9]{3,4}|[a-f0-9]{4}(?:[a-f0-9]{2}){1,2})\b$/,"i"),A="-?\\d*(?:\\.\\d+)",w="("+A+"?)",f="("+A+"?%)",P=(`^
  hsla?\\(
    \\s*(-?\\d*(?:\\.\\d+)?(?:deg|rad|turn)?)\\s*,
    \\s*`+f+`\\s*,
    \\s*`+f+`\\s*
    (?:,\\s*(-?\\d*(?:\\.\\d+)?%?)\\s*)?
  \\)
  $
`).replace(/\n|\s/g,""),a=new RegExp(P),h=(`^
  hsla?\\(
    \\s*(-?\\d*(?:\\.\\d+)?(?:deg|rad|turn)?)\\s*
    \\s+`+f+`
    \\s+`+f+`
    \\s*(?:\\s*\\/\\s*(-?\\d*(?:\\.\\d+)?%?)\\s*)?
  \\)
  $
`).replace(/\n|\s/g,""),d=new RegExp(h),l=(`^
  rgba?\\(
    \\s*`+w+`\\s*,
    \\s*`+w+`\\s*,
    \\s*`+w+`\\s*
    (?:,\\s*(-?\\d*(?:\\.\\d+)?%?)\\s*)?
  \\)
  $
`).replace(/\n|\s/g,""),m=new RegExp(l),x=(`^
  rgba?\\(
    \\s*`+f+`\\s*,
    \\s*`+f+`\\s*,
    \\s*`+f+`\\s*
    (?:,\\s*(-?\\d*(?:\\.\\d+)?%?)\\s*)?
  \\)
  $
`).replace(/\n|\s/g,""),S=new RegExp(x),T=(`^
  rgba?\\(
    \\s*`+w+`
    \\s+`+w+`
    \\s+`+w+`
    \\s*(?:\\s*\\/\\s*(-?\\d*(?:\\.\\d+)?%?)\\s*)?
  \\)
$
`).replace(/\n|\s/g,""),Y=new RegExp(T),G=(`^
  rgba?\\(
    \\s*`+f+`
    \\s+`+f+`
    \\s+`+f+`
    \\s*(?:\\s*\\/\\s*(-?\\d*(?:\\.\\d+)?%?)\\s*)?
  \\)
$
`).replace(/\n|\s/g,""),q=new RegExp(G),R=new RegExp(/^transparent$/,"i"),p=new RegExp("[^#a-f\\d]","gi"),b=new RegExp("^#?[a-f\\d]{3}[a-f\\d]?$|^#?[a-f\\d]{6}([a-f\\d]{2})?$","i"),v=function(L,I,W){return Math.min(Math.max(I,L),W)},B=function(L){var I=L;return typeof I!="number"&&(I=I.endsWith("%")?255*parseFloat(I)/100:parseFloat(I)),v(Math.round(I),0,255)},C=function(L){return v(parseFloat(L),0,100)};function _(L){var I=L;return typeof I!="number"&&(I=I.endsWith("%")?parseFloat(I)/100:parseFloat(I)),v(I,0,1)}function st(L){var I=function(W,V){if(V===void 0&&(V={}),typeof W!="string"||p.test(W)||!b.test(W))throw new TypeError("Expected a valid hex string");var it=1;(W=W.replace(/^#/,"")).length===8&&(it=Number.parseInt(W.slice(6,8),16)/255,W=W.slice(0,6)),W.length===4&&(it=Number.parseInt(W.slice(3,4).repeat(2),16)/255,W=W.slice(0,3)),W.length===3&&(W=W[0]+W[0]+W[1]+W[1]+W[2]+W[2]);var Pt=Number.parseInt(W,16),Yt=Pt>>16,Bt=Pt>>8&255,le=255&Pt,ie=typeof V.alpha=="number"?V.alpha:it;return V.format==="array"?[Yt,Bt,le,ie]:V.format==="css"?"rgb("+Yt+" "+Bt+" "+le+(ie===1?"":" / "+Number((100*ie).toFixed(2))+"%")+")":{red:Yt,green:Bt,blue:le,alpha:ie}}(L,{format:"array"});return F([null,I[0],I[1],I[2],I[3]])}function F(L){var I=L[1],W=L[2],V=L[3],it=L[4];return it===void 0&&(it=1),{type:"rgb",values:[I,W,V].map(B),alpha:_(it===null?1:it)}}/**
	 * parse-css-color
	 * @version v0.2.1
	 * @link http://github.com/noeldelgado/parse-css-color/
	 * @license MIT
	 */return function(L){if(typeof L!="string")return null;var I=r.exec(L);if(I)return st(I[0]);var W=d.exec(L)||a.exec(L);if(W)return function(Pt){var Yt=Pt[1],Bt=Pt[2],le=Pt[3],ie=Pt[4];ie===void 0&&(ie=1);var K=Yt;return{type:"hsl",values:[K=K.endsWith("turn")?360*parseFloat(K)/1:K.endsWith("rad")?Math.round(180*parseFloat(K)/Math.PI):parseFloat(K),C(Bt),C(le)],alpha:_(ie===null?1:ie)}}(W);var V=Y.exec(L)||q.exec(L)||m.exec(L)||S.exec(L);if(V)return F(V);if(R.exec(L))return F([null,0,0,0,0]);var it=J[L.toLowerCase()];return it?F([null,it[0],it[1],it[2],1]):null}})},63254:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});const w={WEDGE_START:2,DYNAMIC:1,WEDGE_STOP:0}},64316:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>v});var A=r(269352),w=r(863426);const f=function(){this.init()};f.cssClass="pluckedRangeLine";const P=f.prototype;P.cssClass=f.cssClass,P.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.x1=0,this.x2=0,this.y1=0,this.y2=0},P.setDrawingContext=function(B){this.drawingContext=B},P.setParent=function(B){this.parent=B},P.setX1=function(B){this.x1=B,this.isRendered()&&this.line.setX1(B)},P.setX2=function(B){this.x2=B,this.isRendered()&&this.line.setX2(B)},P.setY1=function(B){this.y1=B,this.isRendered()&&this.line.setY1(B)},P.setY2=function(B){this.y2=B,this.isRendered()&&this.line.setY2(B)},P.draw=function(){this.isRendered()||this.render(),this.line.draw()},P.render=function(){if(this.isRendered())return;const B=this.drawingContext.getOctaveLineThickness(),C=this.drawingContext.getOctaveShiftDashArrayWidth(),_={stroke_width:B,stroke_dasharray:[C,C/3]};this.line=new w.A(this.parent,_),this.line.render(this.x1,this.y1,this.x2,this.y2)},P.isRendered=function(){return this.line!==null};const a=f;var h=r(364842),d=r(97324),l=r(843678),m=r(100673);const x=l.default.fromPairs([{key:d.A.PALM_MUTE,value:"P.M."},{key:d.A.LET_RING,value:"let ring"}]),S=function(B){this.init(B)};S.cssClass="PluckedRangeText";const T=S.prototype;T.cssClass=S.cssClass,T.init=function(B){this.drawingContext=null,this.isRendered=!1,this.parent=null,this.textStr=Y(B);const C={text:this.textStr};this.text=new m.A(C),this.text.setXPos(0),this.text.setYPos(0)};function Y(B){const C=x[B];if(typeof C=="undefined"){const _=`There is no plucked range texts for the type [${B}]`;throw new h.default("Unexpected",_)}else return C}T.setParent=function(B){this.parent=B,this.text.setParent(this.parent)},T.setCssClass=function(B){this.cssClass=B},T.setDrawingContext=function(B){this.drawingContext=B,this.text.setDrawingContext(B);const C=this.getFontSize();this.text.setFontSize(C);const _=B.getHarmonyFontFamily();this.text.options["font-family"]=_},T.getFontSize=function(){return this.drawingContext.getPluckedRangeHeight()*2/3},T.updateHorizontalDisplay=function(){this.draw()},T.draw=function(){this.isRendered||this.render(),this.text.draw()},T.render=function(){this.text.render(),this.text.setCssClass(this.name),this.isRendered=!0},T.getWidth=function(){return this.text.getWidth()},T.getHeight=function(){const B=this.getSpaceAbove(),C=this.getSpaceBelow();return B+C},T.getSpaceAbove=function(){return this.drawingContext.getPluckedRangeHeight()},T.getSpaceBelow=function(){return this.drawingContext.getPluckedRangeHeight()*1/3};const G=S;var q=r(568357);const R="adagio-pluckedRange-uuid",p=function(){this.init()};p.cssClass="pluckedRange";const b=p.prototype;b.cssClass=p.cssClass,b.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.text=null,this.upperLine=null,this.closingLine=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},b.setParent=function(B){this.parent=B},b.setCssClass=function(B){this.cssClass=B},b.setStaffData=function(B){this.staffData=B},b.setDrawingContext=function(B){this.drawingContext=B},b.setLeftAnchor=function(B){this.hasLeftAnchor()&&this.leftAnchor!==B&&this.removeLeftAnchor(),this.leftAnchor=B,this.leftAnchor.setPluckedRange(this)},b.hasLeftAnchor=function(){return this.leftAnchor!==null},b.removeLeftAnchor=function(){this.hide(),this.leftAnchor.pluckedRange=null,this.leftAnchor=null},b.setRightAnchor=function(B){this.hasRightAnchor()&&this.rightAnchor!==B&&this.removeRightAnchor(),this.rightAnchor=B,this.rightAnchor.setPluckedRange(this)},b.hasRightAnchor=function(){return this.rightAnchor!==null},b.removeRightAnchor=function(){this.hide(),this.rightAnchor.pluckedRange=null,this.rightAnchor=null},b.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},b.hide=function(){this.drawn&&this.unbindFromParent()},b.isAbove=function(){return this.getLeftAnchor().isAbove()},b.isBelow=function(){return this.getLeftAnchor().isBelow()},b.getY=function(){return this.getLeftAnchor().getY()},b.getLeftAnchor=function(){return this.leftAnchor},b.getRightAnchor=function(){return this.rightAnchor},b.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},b.updateHorizontalDisplay=function(){this.isRendered()||this.render();let B=this.getWidth();this.text.updateHorizontalDisplay(B);const C=this.text.getWidth()+this.drawingContext.getPluckedRangeTextMargin();this.upperLine.setX1(C),this.closingLine!==null&&(B=B-this.drawingContext.getMarginSize(),this.closingLine.setX1(B),this.closingLine.setX2(B)),this.upperLine.setX2(B),this.posX=this.getX(),this.draw()},b.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.posY=this.getY(),this.draw()},b.draw=function(){this.isRendered()||this.render();let B=this.getWidth();this.text.updateHorizontalDisplay(B);const C=this.text.getWidth()+this.drawingContext.getPluckedRangeTextMargin();this.upperLine.setX1(C),this.closingLine!==null&&(B=B-this.drawingContext.getMarginSize(),this.closingLine.setX1(B),this.closingLine.setX2(B)),this.upperLine.setX2(B),this.posX=this.getX(),this.posY=this.getY(),this.upperLine.draw(),this.text.draw(),this.closingLine!==null&&this.closingLine.draw(),this.move(),this.bindToParent()},b.getCssClasses=function(){const B=[this.cssClass];return this.leftAnchor.isStart()&&B.push(q.A.START),this.rightAnchor.isStop()&&B.push(q.A.STOP),B.join(" ")},b.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},b.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},b.render=function(){this.group=new A.A("g");const B=this.getCssClasses();this.group.attr("class",B);const C=this.getLeftAnchor(),_=C.getPluckedRangeUuid();this.group.setDataEntry(R,_);const st=C.getType();this.text=new G(st),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext),this.upperLine=new a,this.upperLine.setParent(this.group),this.upperLine.setDrawingContext(this.drawingContext);const F=this.getUpperLineY();if(this.upperLine.setY1(F),this.upperLine.setY2(F),this.getRightAnchor().isStop()){const W={stroke_width:this.drawingContext.getOctaveLineThickness()};this.closingLine=new w.A(this.group,W),this.closingLine.render(0,this.getPlacementOffset(),0,this.getClosingLineY())}},b.getUpperLineY=function(){let B=-this.text.getFontSize()/2;return this.isBelow()&&(B+=this.getPlacementOffset()),B},b.getClosingLineY=function(){return-this.text.getFontSize()+this.getPlacementOffset()},b.getPlacementOffset=function(){if(this.isBelow())return this.text.getFontSize()/4;if(this.isAbove())return 0;throw new h.default("Unexpected")},b.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate (${this.posX}, ${this.posY})`)},b.isRendered=function(){return this.group!==null},b.getWidth=function(){const B=this.getX();return this.getRightAnchor().getX()-B},b.getHeight=function(){return this.text.getHeight()},b.getX=function(){return this.getLeftAnchor().getX()},b.getY=function(){return this.getLeftAnchor().getY()},b.getGroup=function(){return this.group};const v=p},72456:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(410199);const w=function(a,h){this.init(a,h)},f=w.prototype;f.init=function(a,h){this.measure=null,this.hyphen=null,this.measureIdx=null,this.note=a,this.position=h,this.drawingContext=null},f.setMeasure=function(a){this.measure=a},f.setDrawingContext=function(a){this.drawingContext=a},f.getDrawingContext=function(){return this.drawingContext},f.getWidth=function(){return 0},f.getX=function(a){if(this.note===null){if(this.position===A.A.LEFT)return this.getContinueLeftX();if(this.position===A.A.RIGHT)return this.getContinueRightX();A.A.raiseError(this.position)}else{if(this.position===A.A.LEFT)return this.getNoteLeftX(a);if(this.position===A.A.RIGHT)return this.getNoteRightX(a);A.A.raiseError(this.position)}},f.getContinueLeftX=function(){const a=this.measure.tickableContent;return this.measure.getXPos()+a.getXPos()-a.getPreviousSpace()},f.getContinueRightX=function(){const a=this.measure,h=a.tickableContent;return a.getXPos()+h.getXPos()+h.getWidth()},f.getNoteLeftX=function(a){const h=this.measure,d=h.tickableContent,l=this.note;let m=h.getXPos()+d.getXPos()+l.getXPos();if(l.hasLyricLevel(a)){const x=l.getMiddleHeadWidth(),S=l.getLyricLevelWidth(a);m+=x/2+S/2}return m},f.getNoteRightX=function(a){const h=this.measure,d=h.tickableContent,l=this.note;let m=h.getXPos()+d.getXPos()+l.getXPos();if(l.hasLyricLevel(a)){const x=l.getMiddleHeadWidth(),S=l.getLyricLevelWidth(a);m-=S/2-x/2}return m},f.hasLyricLevel=function(a){return this.note===null?!1:this.note.hasLyricLevel(a)},f.getLyricLevelPosY=function(a){return this.note.getLyricLevelPosY(a)},f.getLevels=function(){if(this.isLeft())return this.note===null?[]:this.note.getLyricBeginLevels();if(this.isRight())return this.note===null?[]:this.note.getLyricEndLevels();A.A.raiseError(this.position)},f.hasHyphen=function(){return this.hyphen!==null},f.isLeft=function(){return this.position===A.A.LEFT},f.isRight=function(){return this.position===A.A.RIGHT},f.setHyphen=function(a){this.hyphen=a},f.getHyphen=function(){return this.hyphen},f.removeHyphen=function(){this.isLeft()?this.hyphen.removeLeftAnchor():this.isRight()?this.hyphen.removeRightAnchor():A.A.raiseError(this.position)},f.setNeedDrawUpdate=function(){this.hasHyphen()&&this.getHyphen().setNeedDrawUpdate()},f.setMeasureIdx=function(a){this.measureIdx=a},f.getMeasureIdx=function(){return this.measureIdx};const P=w},75861:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});var A=r(364842);class w extends A.default{constructor(x){const S=`Invalid stem value: [${x}].`;super("BadStemValue",S),Object.defineProperty(this,"stem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stem=x}}const f="down",P="up",a="double",h="none";function d(m){throw new w(m)}const l={DOWN:f,UP:P,DOUBLE:a,NONE:h,raiseError:d}},77913:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});var A=r(737903);function w(a,h){h=(0,A.default)(h);const l=a.getScoreDataCache().displayedToDataPartIdx(h.partIdx);for(;h.startMeasureIdx<=h.stopMeasureIdx;h.startMeasureIdx++){const m={partIdx:l,measureIdx:h.startMeasureIdx};if(a.uuidIsMeasureRendered(m))break;f(h)}if(h.startMeasureIdx>h.stopMeasureIdx)return null;for(;h.stopMeasureIdx>=h.startMeasureIdx;h.stopMeasureIdx--){const m={partIdx:l,measureIdx:h.stopMeasureIdx};if(a.uuidIsMeasureRendered(m))break;P(h)}return h.stopMeasureIdx<h.startMeasureIdx?null:h}function f(a){typeof a.startNoteIdx!="undefined"&&(a.startNoteIdx=null),typeof a.startTimePos!="undefined"&&(a.startTimePos=null,a.startDpq=1)}function P(a){typeof a.stopNoteIdx!="undefined"&&(a.stopNoteIdx=null),typeof a.stopTimePos!="undefined"&&(a.stopTimePos=null,a.stopDpq=1)}},78750:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>B});var A=r(701387),w=r(721247),f=r(518558),P=r(364596),a=r(377180),h=r(54949),d=r(104907),l=r(123491),m=r(706650),x=r(737903),S=r(476943),T=r(668674);const Y={};Y.canShape=function(C){if(A.default.getNbStaves(C)>1)return G(C);const st=A.default.getClef(C)[0];if(w.default.isTab(st))return!1;const F=A.default.getStaffDetails(C)[0];return!!d.default.hasStaffTuning(F)},Y.shapeMeasure=function(C,_){const st=A.default.getNbStaves(C),F=0,L=A.default.getWrappedClef(C),I=A.default.getWrappedStaffDetailsOrDefault(C);return st>1?q(C,I):d.default.hasTab(I.getEntry(F))?_.hideNonTab?R(C,L,I):p(C,st,F,L,I):q(C,I),C};function G(C){const _=A.default.getWrappedStaffDetailsOrDefault(C),st=_.getNbStaves();for(let F=0;F<st;F++){const L=_.getEntry(F);if(d.default.hasStaffTuning(L))return!0}return!1}function q(C,_){const st=_.getNbStaves();for(let F=0;F<st;F++)_.setEntry(d.default.createDefault(),F);A.default.setStaffDetails(C,_.dumpAttribute())}const R=function(C,_,st){const L=st.getEntry(0),I=d.default.toTabClef(L);_.setEntry(I,0),A.default.setClef(C,_.dumpAttribute())},p=function(C,_,st,F,L){let I=A.default.getNotes(C),W=h.A.groupStaves(I)[st];const V=L.getEntry(st),it=A.default.getWrappedTranspose(C);let Pt=it.getEntry(st);Pt=a.default.copy(Pt),it.insertEntry(Pt,st+1);const Yt=it.dumpAttribute();A.default.setTranspose(C,Yt),F.insertEntry(d.default.toTabClef(V),st+1),L.insertEntry(d.default.createDefault(),st);const Bt=A.default.getWrappedTime(C);let le=Bt.getEntry(st);le=f.default.copy(le),Bt.insertEntry(le,st+1);const ie=Bt.dumpAttribute();A.default.setTime(C,ie);const K=A.default.getWrappedKey(C);let pe=K.getEntry(st);pe=P.default.copy(pe),K.insertEntry(pe,st+1);const Ee=K.dumpAttribute();if(A.default.setKey(C,Ee),W=S.default.isArray(W)?W.map(b,st+1):[],A.default.hasSlash(C,st)&&W.forEach(v),I=I.concat(W),A.default.setClef(C,F.dumpAttribute()),A.default.setStaffDetails(C,L.dumpAttribute()),A.default.setNotes(C,I),A.default.setNbStaves(C,_+1),A.default.hasSlash(C,0)){let tt=A.default.getSlash(C,0);tt=T.A.copy(tt),A.default.setSlash(C,1,tt)}},b=function(C){const _=this.valueOf();return C=(0,x.default)(C),l.default.setStaffIdx(C,_),C};function v(C){const _=l.default.getNotations(C);m.A.setArticulations(_,{}),m.A.setOrnaments(_,{}),m.A.setTechnical(_,{}),l.default.setNotations(C,_)}const B=Y},79769:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>T});var A=r(364842),w=r(269352),f=r(723631),P=r(63254),a=r(868743),h=r(476943);const d=function(Y,G,q){this.init(Y,G,q)};d.cssClass="pedal";const l=d.prototype;l.cssClass=d.cssClass;const m=h.default.pairsToMap([{key:a.A.START,value:"keyboardPedalPed"},{key:a.A.STOP,value:"keyboardPedalUp"}]),x={keyboardPedalPed:.75,keyboardPedalUp:1},S=function(Y){if(typeof m[Y]=="undefined"){const G=`PedalLegacy type not supported: [${Y}].`;throw new A.default("BadPedalType",G)}return m[Y]};l.init=function(Y,G,q){this.type=Y,this.placement=G,this.timePos=q,this.glyph=null,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.width=null,this.parent=null,this.group=null},l.setParent=function(Y){this.parent=Y},l.getGlyph=function(){if(this.glyph===null){const Y=S(this.type);this.glyph=this.drawingContext.getGlyph(Y)}return this.glyph},l.getCoeff=function(){const Y=S(this.type);return x[Y]},l.getWidth=function(){const Y=this.getGlyph(),G=this.getCoeff();return Y.getWidth()*G},l.getHeight=function(){const Y=this.getGlyph(),G=this.getCoeff();return Y.getHeight()*G},l.render=function(Y){this.drawingContext=Y,this.group=new w.A("g"),this.group.attr("class",this.cssClass);const G=this.getGlyph(),q=this.group.append("path"),R=this.getCoeff();q.attr("d",G.render()),q.attr("transform",`scale(${R})`)},l.setPosX=function(Y){this.xPos=Y},l.setHorizontalOffset=function(Y){this.horizontalOffset=Y},l.setPosY=function(Y){this.yPos=Y},l.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},l.needRender=function(){return this.group===null},l.bindToParent=function(){this.parent.append(this.group)},l.move=function(){let Y=this.xPos+this.horizontalOffset;Y+=this.getOffset(),this.xPos!==null&&this.yPos!==null&&this.group.attr("transform",`translate(${Y}, ${this.yPos})`)},l.getOffset=function(){if(this.type===a.A.START)return 0;if(this.type===a.A.STOP)return-this.drawingContext.getSpaceSize();throw new A.default("Unexpected")},l.unbindFromParent=function(){this.group.removeFromParent()},l.getHorizontalPosition=function(){return P.A.DYNAMIC},l.getDrawingContext=function(){return this.drawingContext},l.getTimePos=function(){return this.timePos},l.getTimePosition=function(){return this.timePos},l.getGroup=function(){return this.group},l.getDirectionType=function(){return"pedal"},l.setCssClass=function(Y){this.cssClass=Y},l.isAbove=function(){return this.getPlacement()===f.A.ABOVE},l.isBelow=function(){return this.getPlacement()===f.A.BELOW},l.getPlacement=function(){return this.placement};const T=d},83738:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(920939),w=r(244616),f=r(75861);const P=function(d){this.init(d)};P.cssClass="legerLine";const a=P.prototype;a.cssClass=P.cssClass,a.init=function(d){this.displayData=d,this.renderedNote=null},a.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasLegerLines()&&!this.isSmallRest()&&!this.isTransparentRest()},a.hasLegerLines=function(){return this.hasUpLegerLines()||this.hasDownLegerLines()},a.isSmallRest=function(){return this.displayData.isRest()?this.displayData.getBaseQuarterDuration()<=1:!1},a.isTransparentRest=function(){if(!this.displayData.isRest())return!1;const d=this.displayData.getRestColor();return d===null?!1:w.default.isTransparent(d)},a.draw=function(d,l){this.renderedNote=d,this.svg=d.getGroup(),this.ctx=l,this.hasUpLegerLines()&&this.drawUpLegerLines(),this.hasDownLegerLines()&&this.drawDownLegerLines()},a.hasUpLegerLines=function(){const d=this.getUpLimit();return this.displayData.getHighestLine()>=d},a.hasDownLegerLines=function(){const d=this.getDownLimit();return this.displayData.getLowestLine()<=d},a.drawUpLegerLines=function(){let d=this.displayData.getHighestLine();const l=this.getUpLimit();for(;d>=l;){if(this.drawLegerLine(Math.floor(d)),this.displayData.isRest())return;d--}},a.getUpLimit=function(){return this.displayData.getDisplayedNbStaffLines()===1?4:6},a.drawDownLegerLines=function(){let d=this.displayData.getLowestLine();const l=this.getDownLimit();for(;d<=l;){if(this.drawLegerLine(Math.ceil(d)),this.displayData.isRest())return;d++}},a.getDownLimit=function(){return this.displayData.getDisplayedNbStaffLines()===1?2:0},a.drawLegerLine=function(d){const l=this.displayData.getStemValue(),m=this.ctx.getLegerLineExtension(),x=this.renderedNote.getMiddleHeadWidth();let S=-m,T=x+m;if(l===f.A.DOWN&&this.hasAdjacentSecondLower(d)){const R=this.renderedNote.getLeftHeadWidth();S-=R,!this.hasAdjacentSecondHigher(d)&&!this.displayData.hasLine(d)&&(T-=R)}if(l===f.A.UP&&this.hasAdjacentSecondHigher(d)){const R=this.renderedNote.getRightHeadWidth();T+=R,!this.hasAdjacentSecondLower(d)&&!this.displayData.hasLine(d)&&(S+=R)}const Y=this.lineToY(d),G=this.svg.append("line"),q=this.getLegerLineThickness();G.attr("x1",S).attr("x2",T).attr("y1",Y).attr("y2",Y).attr("stroke-width",q).attr("class",this.cssClass),this.renderedNote.addLegerLine(d)},a.getLegerLineThickness=function(){return this.ctx.getLegerLineThickness()},a.hasAdjacentSecondLower=function(d){return this.displayData.isSecondLower(d+.5)||this.displayData.isSecondLower(d)||this.displayData.isSecondLower(d-.5)},a.hasAdjacentSecondHigher=function(d){return this.displayData.isSecondHigher(d+.5)||this.displayData.isSecondHigher(d)||this.displayData.isSecondHigher(d-.5)},a.lineToY=function(d){const l=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),m=this.displayData.getNbStaffLines();return A.A.lineToY(d,l,m)};const h=P},98710:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Pf});var A=r(377072),w=r(250769),f=r(701387),P=r(737903),a=r(35802),h=r(746641);const d={};d.extractRightAttributes=function(t,s){const n={},c=a.default.getNbStaves(t);if(a.default.setNbStaves(n,c),s!==null){const y=a.default.getWrappedClef(t),N=a.default.getWrappedClef(s),j=m(y,N);a.default.setClef(n,j)}return n},d.extractFromFirstMeasureOfScore=function(t,s){s=s||{};const n={},c=a.default.getNbStaves(t);if(a.default.setNbStaves(n,c),!s.hideClef){const lt=a.default.getWrappedClef(t).dumpAttribute();a.default.setClef(n,lt)}const N=a.default.getWrappedKey(t).dumpAttribute();if(a.default.setKey(n,N),!s.hideTimeSignature){const lt=a.default.getWrappedTime(t).dumpAttribute();a.default.setTime(n,lt)}return n},d.extractFromMiddleMeasure=function(t,s,n){const c=l(t,s,n);return a.default.removeClef(c),c},d.extractFromFirstMeasureOfLine=function(t,s,n){const c=x(t),y=l(t,s,n);return S(c,y)};const l=function(t,s,n={}){const c={},y=a.default.getNbStaves(t);a.default.setNbStaves(c,y);const N=a.default.getWrappedKey(t),j=a.default.getWrappedKey(s),lt=m(j,N);a.default.setKey(c,lt);const Ft=a.default.getWrappedClef(t),Kt=a.default.getWrappedClef(s),Se=m(Kt,Ft);if(a.default.setClef(c,Se),!n.hideTimeSignature){const ke=a.default.getWrappedTime(t),Cs=a.default.getWrappedTime(s),gn=m(Cs,ke);a.default.setTime(c,gn)}return c},m=function(t,s){let n=s.getDiffWith(t);return n=new h.A(n,t.getNbStaves(),t.utils).dumpAttribute(),n},x=function(t){const s={},n=a.default.getNbStaves(t);a.default.setNbStaves(s,n);const y=a.default.getWrappedClef(t).dumpAttribute();a.default.setClef(s,y);const j=a.default.getWrappedKey(t).dumpAttribute();return a.default.setKey(s,j),s},S=function(t,s){const n={},c=a.default.getNbStaves(t);a.default.setNbStaves(n,c);const y=a.default.getWrappedKey(t),N=a.default.getWrappedKey(s),j=T(N,y);a.default.setKey(n,j);const lt=a.default.getWrappedClef(t),Ft=a.default.getWrappedClef(s),Kt=T(lt,Ft);a.default.setClef(n,Kt);const Se=a.default.getWrappedTime(t),ke=a.default.getWrappedTime(s),Cs=T(Se,ke);return a.default.setTime(n,Cs),n},T=function(t,s){h.A.checkCanCompare(t,s);const n=t.getNbStaves(),c=new h.A([],n,t.utils);for(let y=0;y<n;y++)if(t.hasEntry(y)){const N=t.getEntry(y);c.setEntry((0,P.default)(N),y)}else if(s.hasEntry(y)){const N=s.getEntry(y);c.setEntry((0,P.default)(N),y)}return c.dumpAttribute()},Y=d;var G=r(54949),q=r(555172),R=r(589085),p=r(721247),b=r(518558),v=r(843678),B=r(110976),C=r(561248),_=r(177150),st=r(415078),F=r(364842),L=r(269352);const I={common:"timeSigCommon",cut:"timeSigCutCommon"},W=function(t){this.init(t)},V=W.prototype;V.init=function(t){it(t),this.glyphName=Pt(t),this.glyph=null,this.path=null,this.drawingContext=null,this.xPos=null,this.yPos=null,this.parent=null};const it=function(t){if(typeof I[t]=="undefined"){const s=`The time symbol [${t}] is invalid.`;throw new F.default("BadTimeSymbol",s)}},Pt=function(t){return I[t]};V.setParent=function(t){this.parent=t},V.setDrawingContext=function(t){this.drawingContext=t},V.getWidth=function(){return this.getGlyph().getWidth()},V.getHeight=function(){return this.getGlyph().getHeight()},V.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphName)),this.glyph},V.render=function(){this.path=new L.A("path"),this.path.attr("d",this.glyph.render())},V.setPosition=function(t,s){this.xPos=t,this.yPos=s},V.setXPos=function(t){this.xPos=t},V.setYPos=function(t){this.yPos=t},V.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},V.needRender=function(){return this.path===null},V.bindToParent=function(){this.parent.append(this.path)},V.move=function(){const t=this.getHeight(),s=this.yPos+t/2;this.path.attr("transform",`translate(${this.xPos}, ${s})`)};const Yt=W;var Bt=r(726042);const le=["timeSig0","timeSig1","timeSig2","timeSig3","timeSig4","timeSig5","timeSig6","timeSig7","timeSig8","timeSig9"],ie=function(t){this.init(t)},K=ie.prototype;K.init=function(t){pe(t),this.list=Ee(t),this.drawingContext=null,this.width=null,this.xPos=null,this.yPos=null,this.parent=null,this.group=null};const pe=function(t){if(!Bt.default.isInteger(t)||t<=0){const s=`The time number [${t}] is invalid. It has to be a strictly positive integer`;throw new F.default("BadTimeNumber",s)}},Ee=function(t){const s=[];for(;t>0;){const n=t%10;t=Bt.default.intPart(t/10);const y={glyphName:tt(n),glyph:null,path:null,pos:null};s.unshift(y)}return s},tt=function(t){return le[t]};K.setParent=function(t){this.parent=t},K.setDrawingContext=function(t){this.drawingContext=t},K.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},K.getHeight=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.list[0].glyph.getHeight()},K.areGlyphesLoaded=function(){return this.width!==null},K.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},K.loadGlyph=function(t,s){if(t>0){const n=this.drawingContext.getTimeDigitMargin();t+=n}return s.pos=t,s.glyph=this.drawingContext.getGlyph(s.glyphName),t+s.glyph.getWidth()},K.render=function(){this.areGlyphesLoaded()||this.loadGlyphes(),this.group=new L.A("g"),this.list.forEach(this.renderEntry,this)},K.renderEntry=function(t){const s=this.group.append("path");s.attr("d",t.glyph.render());const n=t.pos,c=t.glyph.getHeight()/2;s.attr("transform",`translate(${n}, ${c})`),t.path=s},K.setPosition=function(t,s){this.xPos=t,this.yPos=s},K.setXPos=function(t){this.xPos=t},K.setYPos=function(t){this.yPos=t},K.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},K.needRender=function(){return this.group===null},K.bindToParent=function(){this.parent.append(this.group)},K.move=function(){this.group.attr("transform",`translate(${this.xPos}, ${this.yPos})`)};const Et=ie,Vt=function(){this.init()};Vt.cssClass="timeSignature";const ct=Vt.prototype;ct.cssClass=Vt.cssClass,ct.init=function(){this.layout=null,this.drawingContext=null,this.staffData=null,this.height=null,this.xPos=null,this.formatted=!1,this.parent=null,this.group=null},ct.setParent=function(t){this.parent=t},ct.setLayout=function(t){this.layout=t},ct.setStaffData=function(t){this.staffData=t},ct.getWidth=function(){return this.layout.getWidth()},ct.setDrawingContext=function(t){this.drawingContext=t,this.layout.setDrawingContext(t)},ct.render=function(){this.isFormatted()||this.format(),this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.layout.setParent(this.group),this.layout.render()},ct.isFormatted=function(){return this.formatted},ct.format=function(){this.checkHasStaffData();const s=(this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize())*(this.getNbStaffLines()-1)/2;this.layout.setPosition(0,s),this.formatted=!0},ct.getStaffData=function(){return this.staffData},ct.getNbStaffLines=function(){return R.A.getNbStaffLines(this.staffData)},ct.isTabStaff=function(){return R.A.isTabStaff(this.staffData)},ct.checkHasStaffData=function(){if(this.staffData===null){const t="The time signature needs to know the number of staff lines to be formatted.";throw new F.default("MissingNbStaves",t)}},ct.setPosition=function(t){this.xPos=t},ct.draw=function(){this.needRender()&&this.render(),this.layout.draw(),this.move(),this.bindToParent()},ct.needRender=function(){return this.group===null},ct.bindToParent=function(){this.parent.append(this.group)},ct.move=function(){this.group.attr("transform",`translate(${this.xPos}, 0)`)},ct.getUpOverflow=function(){return 0},ct.getDownOverflow=function(){return 0};const fe=Vt,gt=function(){this.init()},At=gt.prototype;At.init=function(){this.entry=null,this.height=null,this.xPos=null,this.yPos=null,this.parent=null,this.group=null},At.setEntry=function(t){this.entry=t},At.setParent=function(t){this.parent=t},At.setDrawingContext=function(t){this.entry.setDrawingContext(t)},At.getWidth=function(){return this.entry.getWidth()},At.getHeight=function(){return this.isVerticallyAligned()||this.alignVertically(),this.height},At.isVerticallyAligned=function(){return this.height!==null},At.alignVertically=function(){const t=this.entry.getHeight();this.entry.setPosition(0,-t/2),this.height=t},At.render=function(){this.isVerticallyAligned()||this.alignVertically(),this.group=new L.A("g"),this.entry.setParent(this.group),this.entry.render()},At.setPosition=function(t,s){this.xPos=t,this.yPos=s},At.draw=function(){this.needRender()&&this.render(),this.entry.draw(),this.move(),this.bindToParent()},At.needRender=function(){return this.group===null},At.bindToParent=function(){this.parent.append(this.group)},At.move=function(){this.group.attr("transform",`translate(${this.xPos}, ${this.yPos})`)};const Ht=gt,Wt=function(){this.init()},k=Wt.prototype;k.init=function(){this.numerator=null,this.denominator=null,this.drawingContext=null,this.width=null,this.height=null,this.xPos=null,this.yPos=null,this.parent=null,this.group=null},k.setNumerator=function(t){this.numerator=t},k.setDenominator=function(t){this.denominator=t},k.setParent=function(t){this.parent=t},k.setDrawingContext=function(t){this.drawingContext=t,this.numerator.setDrawingContext(t),this.denominator.setDrawingContext(t)},k.getWidth=function(){return this.isHorizontallyAligned()||this.alignHorizontally(),this.width},k.getHeight=function(){return this.isVerticallyAligned()||this.alignVertically(),this.height},k.isHorizontallyAligned=function(){return this.width!==null},k.alignHorizontally=function(){const t=this.denominator.getWidth(),s=this.numerator.getWidth(),n=Math.abs(t-s)/2;s>t?(this.denominator.setXPos(n),this.numerator.setXPos(0)):(this.denominator.setXPos(0),this.numerator.setXPos(n)),this.width=Math.max(t,s)},k.isVerticallyAligned=function(){return this.height!==null},k.alignVertically=function(){const t=this.numerator.getHeight(),s=this.denominator.getHeight(),n=this.drawingContext.getSpaceSize()*2,c=Math.max(n-t,0)/2,y=Math.max(n-s,0)/2;this.numerator.setYPos(-(t+c)),this.denominator.setYPos(y),this.width=t+c+s+y},k.render=function(){this.isHorizontallyAligned()||this.alignHorizontally(),this.isVerticallyAligned()||this.alignVertically(),this.group=new L.A("g"),this.numerator.setParent(this.group),this.denominator.setParent(this.group),this.numerator.render(),this.denominator.render()},k.setPosition=function(t,s){this.xPos=t,this.yPos=s},k.draw=function(){this.needRender()&&this.render(),this.numerator.draw(),this.denominator.draw(),this.move(),this.bindToParent()},k.needRender=function(){return this.group===null},k.bindToParent=function(){this.parent.append(this.group)},k.move=function(){this.group.attr("transform",`translate(${this.xPos}, ${this.yPos})`)};const St=Wt,yt=["cut","common","single-number"],Ct=["cut","common"],Mt={none:St},Tt=function(){this.init()},nt=Tt.prototype;nt.init=function(){this.timeSignature=null,this.layout=null,this.timeJson=null},nt.build=function(t){return this.init(),b.default.check(t),this.timeJson=t,this.timeSignature=new fe,this.createLayout(),this.createContent(),this.timeSignature},nt.checkSymbol=function(){const t=this.getSymbol();b.default.checkSymbol(t)},nt.createLayout=function(){this.isSingleLayout()?this.layout=new Ht:this.createDuplexLayout(),this.timeSignature.setLayout(this.layout)},nt.createDuplexLayout=function(){this.checkSeparator();const t=this.getLayout();this.layout=new t},nt.checkSeparator=function(){const t=this.getSeparator();if(typeof Mt[t]=="undefined"){const s=`The separator [${t}] is not supported. `;throw new st.A(s)}},nt.getLayout=function(){const t=this.getSeparator();return Mt[t]},nt.getSeparator=function(){return b.default.getSeparator(this.timeJson)},nt.createContent=function(){this.isSingleLayout()?this.createSingleLayoutContent():this.createDuplexLayoutContent()},nt.isSingleLayout=function(){const t=this.getSymbol();return yt.includes(t)},nt.createSingleLayoutContent=function(){let t;if(this.isSymbol()){const s=this.getSymbol();t=new Yt(s)}else{const s=this.getBeatType();t=new Et(s)}this.layout.setEntry(t)},nt.isSymbol=function(){const t=this.getSymbol();return Ct.includes(t)},nt.isSingleNumber=function(){return this.getSymbol()==="single-number"},nt.createDuplexLayoutContent=function(){const t=this.createNumerator(),s=this.createDenominator();this.layout.setNumerator(t),this.layout.setDenominator(s)},nt.createNumerator=function(){if(this.isDotted()){const t="time signature with dotted notes are not supported yet.";throw new st.A(t)}else{const t=this.getBeats();return new Et(t)}},nt.isDotted=function(){return this.getSymbol()==="dotted-note"},nt.getBeats=function(){return b.default.getBeats(this.timeJson)},nt.createDenominator=function(){if(this.isNormal()){const t=this.getBeatType();return new Et(t)}else{const s=`The time signature symbol [${this.getSymbol()}] is not supported yet. `;throw new st.A(s)}},nt.isNormal=function(){return this.getSymbol()==="normal"},nt.getBeatType=function(){return b.default.getBeatType(this.timeJson)},nt.getSymbol=function(){return b.default.getSymbol(this.timeJson)};const vt=Tt,Nt="adagio-key-opacity",te=.2,ee=function(){this.init()};ee.cssClass="keySignature";const Ot=ee.prototype;Ot.cssClass=ee.cssClass,Ot.init=function(){this.list=null,this.drawingContext=null,this.width=null,this.xPos=null,this.staffData=null,this.upOverflow=0,this.downOverflow=0,this.isGhost=!1,this.parent=null,this.group=null},Ot.setParent=function(t){this.parent=t},Ot.setStaffData=function(t){this.staffData=t},Ot.setList=function(t){this.list=ot(t)},Ot.setIsGhost=function(){this.isGhost=!0};const ot=function(t){return t.map(rt)},rt=function(t){return{pos:null,path:null,glyph:null,line:t.line,glyphName:t.glyphName}};Ot.setDrawingContext=function(t){this.drawingContext=t},Ot.getStaffData=function(){return this.staffData},Ot.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},Ot.areGlyphesLoaded=function(){return this.width!==null},Ot.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},Ot.loadGlyph=function(t,s){if(this.isGhost)return s.glyph=this.drawingContext.getGlyph(s.glyphName),s.pos=t-s.glyph.getWidth()/2,t;if(t>0){const n=this.drawingContext.getKeyAccidentalMargin();t+=n}return s.pos=t,s.glyph=this.drawingContext.getGlyph(s.glyphName),t+s.glyph.getWidth()},Ot.render=function(){this.areGlyphesLoaded()||this.loadGlyphes(),this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.list.forEach(this.renderEntry,this),this.isGhost&&(this.group.style("opacity",te),this.group.setDataEntry(Nt,te))},Ot.renderEntry=function(t){const s=this.group.append("path");s.attr("d",t.glyph.render());const n=t.pos,c=this.lineToY(t.line);s.attr("transform",`translate(${n}, ${c})`),t.path=s;const y=at(t.glyph,c);this.upOverflow=Math.max(this.upOverflow,y);const N=this.computeDownOverflow(t.glyph,c);this.downOverflow=Math.max(this.downOverflow,N)};const at=function(t,s){return-t.getBBoxNE().y-s};Ot.computeDownOverflow=function(t,s){const n=t.getBBoxSW().y,c=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize(),y=(this.getNbStaffLines()-1)*c,N=n+s-y;return Math.max(0,N)},Ot.checkHasStaffData=function(){if(this.staffData===null){const t="The key signature needs to know the number of staff lines to be formatted.";throw new F.default("MissingNbStaves",t)}},Ot.getNbStaffLines=function(){return R.A.getNbStaffLines(this.staffData)},Ot.isTabStaff=function(){return R.A.isTabStaff(this.staffData)},Ot.lineToY=function(t){this.checkHasStaffData();const s=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return(this.getNbStaffLines()-t)*s},Ot.setPosition=function(t){this.xPos=t},Ot.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},Ot.needRender=function(){return this.group===null},Ot.bindToParent=function(){this.parent.append(this.group)},Ot.move=function(){this.group.attr("transform",`translate(${this.xPos}, 0)`)},Ot.getUpOverflow=function(){return this.needRender()&&this.render(),this.upOverflow},Ot.getDownOverflow=function(){return this.needRender()&&this.render(),this.downOverflow};const _t=ee;var qt=r(364596),ue=r(403006);const ne={NATURAL:"accidentalNatural",SHARP:"accidentalSharp",FLAT:"accidentalFlat"},be=function(){this.init()},oe=be.prototype;oe.init=function(){this.keyJson=null,this.clefJson=null,this.list=[],this.fifthsLines=null},oe.build=function(t,s){return this.init(),qt.default.check(t),p.default.check(s),this.keyJson=t,this.clefJson=s,this.createList(),this.list},oe.createList=function(){this.list=[],this.hasFullCancel()&&this.createFullCancel(),this.createFifths(),this.hasPartialCancel()&&this.createPartialCancel()},oe.hasFullCancel=function(){return qt.default.isBackToZero(this.keyJson)?!0:qt.default.hasCancel(this.keyJson)&&qt.default.isSignChange(this.keyJson)},oe.createFullCancel=function(){const t=this.getPreviousFifths();let s=ue.A.getLines(this.clefJson,t);const n=Math.abs(t);s=s.slice(0,n);const c=ne.NATURAL;this.addLines(s,c)},oe.createFifths=function(){const t=this.getFifths();this.fifthsLines=ue.A.getLines(this.clefJson,t);const s=Math.abs(t),n=this.fifthsLines.slice(0,s),c=us(t);this.addLines(n,c)},oe.hasPartialCancel=function(){if(qt.default.hasCancel(this.keyJson)&&!qt.default.isSignChange(this.keyJson)){const t=this.getFifths(),s=this.getPreviousFifths();return Math.abs(t)<Math.abs(s)}else return!1},oe.createPartialCancel=function(){const t=this.getFifths(),s=this.getPreviousFifths(),n=Math.abs(t),c=Math.abs(s),y=this.fifthsLines.slice(n,c),N=ne.NATURAL;this.addLines(y,N)};const us=function(t){return t>0?ne.SHARP:t<0?ne.FLAT:ne.NATURAL};oe.getFifths=function(){return qt.default.getFifths(this.keyJson)},oe.getPreviousFifths=function(){return qt.default.getPreviousFifths(this.keyJson)},oe.addLines=function(t,s){t.forEach(function(n){const c={line:n,glyphName:s};this.list.push(c)},this)};const Q=be,Xt=function(){this.init()},bt=Xt.prototype;bt.init=function(){this.listBuilder=new Q},bt.build=function(t,s,n){const c=this.listBuilder.build(t,s,n),y=new _t;return c.length===0&&n&&!p.default.isPercussion(s)?(this.listBuilder.addLines([3],ne.NATURAL),y.setList(c),y.setIsGhost()):y.setList(c),y};const ve=Xt;var Qt=r(712947),ae=r(104907),fs=r(496819),ds=r(536949),Xe=r(788220),U=r(584416),Gt=r(447819),It=r(538783),xt=r(141624),zt=r(794799),Ne=r(967220),pi=r(631294);const Os=function(t,s){return t=t.concat(s),t.sort(on),Fi(t).map(rn)},on=function(t,s){const n=t.getTimePos()-s.getTimePos();return n!==0?n:t.getHorizontalPosition()-s.getHorizontalPosition()},Fi=function(t){const s=[];return t.forEach(Wi,s),s},Wi=function(t){const s=this;$i(t,s)&&s.push([]);const n=s.length;s[n-1].push(t)},$i=function(t,s){const n=s.length;if(n===0)return!0;const y=s[n-1][0].getTimePos();return t.getTimePos()!==y},rn=function(t){let s=0,n=0,c=t.findIndex(ss);if(c>=0){const j=t[c];n=j.getSpaceBefore(),j.setHorizontalOffset(0),s=j.getWidth()-n;for(let lt=c-1;lt>=0;lt--){const Ft=t[lt],Kt=Ft.getDrawingContext();n+=Kt.getMarginSize(),n+=Ft.getWidth(),Ft.setHorizontalOffset(-n)}c++}else c=0;for(;c<t.length;c++){const j=t[c],lt=j.getDrawingContext();s+=lt.getMarginSize();const Ft=j.getSpaceBefore();j.setHorizontalOffset(s+Ft),s+=j.getWidth()}return{timePos:t[0].getTimePos(),spaceBefore:n,spaceAfter:s}};function ss(t){return t instanceof pi.A}const vi=Os,Ki=function(t){is(t),ai(t)},is=function(t){const n=t.map(bn).reduce(Bt.default.lcm);t.forEach(Mn,n)},bn=function(t){return t.dpq},Mn=function(t){const n=this.valueOf()/t.dpq;t.dpq*=n,t.nbDivisions*=n,t.entities.forEach(pn,n)},pn=function(t){const s=this.valueOf();t.timePos*=s,t.duration*=s},ai=function(t){const s={};t.forEach(Ys,s),v.default.forEach(s,Ti)},Ys=function(t){let s=0;const n=this;t.entities.forEach(function(c){typeof n[s]=="undefined"&&(n[s]=[]),n[s].push(c),s+=c.duration})},Ti=function(t,s){const c=s.map(ji).reduce(Bt.default.max2);s.forEach(Me,c);const N=s.map(an).reduce(Bt.default.max2);s.forEach(Rn,N)},ji=function(t){return t.spaceBefore},Me=function(t){const s=this.valueOf();t.spaceBefore=s},an=function(t){return t.spaceAfter},Rn=function(t){const s=this.valueOf();t.spaceAfter=s},Qi=Ki;function We(t,s,n){for(;s<t.length;s++)if(t[s].timePos>=n)return s;return s}function Re(t,s){let n=0;s.forEach(c=>{const y=c.getTimePos();if(n=We(t,n,y),n>=t.length)return;const N=t[n];if(N.timePos===y){const lt=c.getDrawingContext().getMarginSize(),Ft=c.getWidth();c.setContentAfter(lt+N.spaceBefore+Ft),N.spaceBefore+=lt+Ft}})}function Ji(t,s){let n=0,c=0;for(;n<s.length;){const N=s[n].getTimePos();if(c=We(t,c,N),c>=t.length)return;t[c].timePos===N?s.splice(n,1):n++}}function mn(t,s){let n=0;s.forEach(c=>{const y=c.getTimePos();n=We(t,n,y);const N=Li(c);t.splice(n,0,N)})}function Li(t){const s=t.getWidth(),n=t.getTimePos();return{spaceBefore:0,spaceAfter:s,timePos:n,isRest:!1}}const Gi=1,re=function(t,s){const n={rightIdx:0,rightLines:s};return t.some(D,n)},D=function(t){const s=this,n=pt(s,t);if(n!==null&&n-t<Gi)return!0;const c=Dt(s,t);return c!==null&&t-c<Gi},pt=function(t,s){return Oe(t,s),t.rightIdx===0?null:t.rightLines[t.rightIdx-1]},Dt=function(t,s){return Oe(t,s),t.rightIdx===t.rightLines.length?null:t.rightLines[t.rightIdx]},Oe=function(t,s){const n=t.rightLines.length;for(;t.rightIdx<n;){if(t.rightLines[t.rightIdx]<s)return;t.rightIdx++}},Ge=re,si=1,Ei=2,gs=function(t){const s=t[0],n=s.getNbNotes();let c=0,y=0;const N=t[1],j=N.getNbNotes();let lt=0,Ft=0;for(;c<n&&lt<j;){const Kt=s.getNote(c),Se=N.getNote(lt);y===Ft?(Ui(Kt,Se),c++,lt++,y+=Kt.getDuration(),Ft+=Se.getDuration()):y<=Ft?(c++,y+=Kt.getDuration()):Ft<=y&&(lt++,Ft+=Se.getDuration())}},Ui=function(t,s){if(!bi(t,s))return;const n=t.getMarginSize();let c,y;if(Mi(t,s)){const N=t.getWidth();t.setHorizontalShift(-N+-n/2);const j=s.calcLeadingSpace();s.setHorizontalShift(j+n/2)}else An(t,s)?(c=t.getMiddleHeadWidth(),t.setHorizontalShift(-c/2),y=s.getMiddleHeadWidth(),s.setHorizontalShift(y/2)):zn(t,s)?(c=t.getMiddleHeadWidth(),t.setHorizontalShift(n/2+c/2),y=s.getMiddleHeadWidth(),s.setHorizontalShift(-n/2-y/2)):(t.setHorizontalShift(n/2),s.setHorizontalShift(-n/2))},bi=function(t,s){if(t.isRest()||s.isRest())return!1;const n=t.getDisplayData().getLowestLine(),c=s.getDisplayData().getHighestLine();if(n-c>=si)return!1;if(n===c){const y=t.getDisplayData().getNbDots(),N=s.getDisplayData().getNbDots();if(y!==N)return!0;const j=On(t,n),lt=On(s,c);if(!qn(j,lt))return!0;const Ft=Un(t,n),Kt=Un(s,c);if(Ft!==Kt)return!0;const Se=t.getDisplayData().getBaseQuarterDuration(),ke=s.getDisplayData().getBaseQuarterDuration();return Se===ke?(Xs(t,s),!1):!(Se<Ei&&ke<Ei)}return!0};function Xs(t,s){os(t,s)&&(t.hasTieStart()?s.dots.forEach(n=>n.removeFromParent()):t.dots.forEach(n=>n.removeFromParent()))}function os(t,s){if(!s.hasDots()||!t.hasDots())return!1;const n=t.getDisplayData().getNbDots(),c=s.getDisplayData().getNbDots();return n===c}function On(t,s){return t.getDisplayData().getHeads().find(y=>y.line===s)}function qn(t,s){return!(t.notehead!==s.notehead||t.hasParentheses!==s.hasParentheses||t.isHarmonicArtificialTouching!==s.isHarmonicArtificialTouching||t.isHarmonicNaturalTouching!==s.isHarmonicNaturalTouching||t.color!==s.color)}function Un(t,s){const c=t.getDisplayData().getHeads().find(y=>y.line===s);return c?c.alter:0}const An=function(t,s){const n=t.getDisplayData().getLowestLine(),c=s.getDisplayData().getHighestLine();return n-c===.5},Mi=function(t,s){return s.hasDots()||t.hasAccidentals()},zn=function(t,s){const n=t.getDisplayData().getLines(),c=s.getDisplayData().getLines();return Ge(n,c)},Je=gs;var kn=r(200675);class Vs{constructor(s){this.glyphId=s,this.posX=0,this.posY=0,this.drawingContext=null,this.parent=null,this.cssClass=null,this.glyph=null,this.pathNode=null}setDrawingContext(s){this.drawingContext=s}setParent(s){this.parent=s}setCssClass(s){this.cssClass=s}setPosition(s,n){this.posX=s,this.posY=n}getGlyph(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph}draw(){this.render(),this.move(),this.bindToParent()}render(){if(this.pathNode===null){this.pathNode=new L.A("path");const n=this.getGlyph().render();this.pathNode.attr("d",n),this.cssClass!==null&&this.pathNode.attr("class",this.cssClass)}}move(){this.pathNode&&this.pathNode.attr("transform",`translate(${this.posX}, ${this.posY})`)}bindToParent(){this.parent.append(this.pathNode)}getSpaceAbove(){const s=this.getGlyph();return Math.max(0,-s.getBBoxNE().y)}getWidth(){return this.getGlyph().getBBoxNE().x}getSpaceBelow(){const s=this.getGlyph();return Math.max(0,s.getBBoxSW().y)}getGroup(){return this.pathNode}}const ps="figbassSharp",Sn=function(){this.init()};Sn.cssClass="tickableContent";const $=Sn.prototype;$.cssClass=Sn.cssClass,$.init=function(){this.voices={},this.voicesList=[],this.directions=[],this.pedals=[],this.pizzicatos=[],this.mutes=[],this.words=[],this.chords=[],this.leftSlurs={},this.rightSlurs={},this.classicChords=[],this.figuredBasses=[],this.middleClefs=[],this.leftWedgeAnchor=null,this.rightWedgeAnchor=null,this.middleWedgesAnchors=[],this.leftOctaveShiftAnchor=null,this.rightOctaveShiftAnchor=null,this.middleOctaveShiftsAnchors=[],this.leftPluckedRangeAnchor=null,this.rightPluckedRangeAnchor=null,this.middlePluckedRangesAnchors=[],this.leftPedalAnchor=null,this.rightPedalAnchor=null,this.middlePedalsAnchors=[],this.drawingContext=null,this.staffData=null,this.xPos=null,this.dynamicsHorizontalData=null,this.horizontalData=null,this.verticalData=null,this.staticVerticalData=null,this.dynamicVerticalData=null,this.horizontalFormatter=null,this.verticalFormatting=null,this.chordsHeight=null,this.pedalsHeight=null,this.classicChordSpaceAbove=null,this.classicChordSpaceBelow=null,this.figuredBassSpaceAbove=null,this.figuredBassSpaceBelow=null,this.hasDynamicsAboveValue=null,this.hasDynamicsBelowValue=null,this.hasPizzicatosAboveValue=null,this.hasPizzicatosBelowValue=null,this.hasMutesAboveValue=null,this.hasMutesBelowValue=null,this.belowMuteHeight=null,this.aboveMuteHeight=null,this.hasWordsAboveValue=null,this.hasWordsBelowValue=null,this.hasOctaveShiftsAboveValue=null,this.hasOctaveShiftsBelowValue=null,this.hasPluckedRangesAboveValue=null,this.hasPluckedRangesBelowValue=null,this.hasPedalsAboveValue=null,this.hasPedalsBelowValue=null,this.nbDivisions=null,this.dpq=null,this.measureNumberShift=1,this.voicesIndexes=null,this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.parent=null},$.setParent=function(t){this.parent=t},$.setStaffData=function(t){this.staffData=t,this.forEachVoice(this.transferStaffData,this),this.middleClefs.forEach(this.transferStaffData,this)},$.setVoicesIndexes=function(t){this.voicesIndexes=t},$.transferStaffData=function(t){t.setStaffData(this.staffData)},$.transferParent=function(t){t.setParent(this.group)},$.addChord=function(t){t.setParent(this.group),this.chords.push(t)},$.addClassicChord=function(t){t.setParent(this.group),this.classicChords.push(t)},$.addFiguredBass=function(t){t.setParent(this.group),this.figuredBasses.push(t)},$.addMiddleClef=function(t){t.setParent(this.group),this.middleClefs.push(t)},$.setDpq=function(t){this.dpq=t},$.setNbDivisions=function(t){this.nbDivisions=t},$.setMeasureNumberShift=function(t){this.measureNumberShift=t},$.addDirection=function(t){t.setParent(this.group),this.directions.push(t)},$.addPedal=function(t){t.setParent(this.group),this.pedals.push(t)},$.addPizzicato=function(t){t.setParent(this.group),this.pizzicatos.push(t)},$.addMute=function(t){t.setParent(this.group),this.mutes.push(t)},$.addWord=function(t){t.setParent(this.group),this.words.push(t)},$.addVoice=function(t){const s=t.getVoiceIdx();this.voices[s]=t,this.voicesList.push(t),t.setParent(this.group)},$.setRightWedgeAnchor=function(t){this.rightWedgeAnchor=t,t.setMeasure(this)},$.setLeftWedgeAnchor=function(t){this.leftWedgeAnchor=t,t.setMeasure(this)},$.addMiddleWedgeAnchor=function(t){this.middleWedgesAnchors.push(t),t.setMeasure(this)},$.setRightOctaveShiftAnchor=function(t){this.rightOctaveShiftAnchor=t,t.setMeasure(this)},$.setLeftOctaveShiftAnchor=function(t){this.leftOctaveShiftAnchor=t,t.setMeasure(this)},$.addMiddleOctaveShiftAnchor=function(t){this.middleOctaveShiftsAnchors.push(t),t.setMeasure(this)},$.setRightPluckedRangeAnchor=function(t){this.rightPluckedRangeAnchor=t,t.setMeasure(this)},$.setLeftPluckedRangeAnchor=function(t){this.leftPluckedRangeAnchor=t,t.setMeasure(this)},$.addMiddlePluckedRangeAnchor=function(t){this.middlePluckedRangesAnchors.push(t),t.setMeasure(this)},$.setRightPedalAnchor=function(t){this.rightPedalAnchor=t,t.setMeasure(this)},$.setLeftPedalAnchor=function(t){this.leftPedalAnchor=t,t.setMeasure(this)},$.addMiddlePedalAnchor=function(t){this.middlePedalsAnchors.push(t),t.setMeasure(this)},$.render=function(t){this.drawingContext=t,this.forEachVoice(this.renderEntity,this),this.shiftNotes(),this.directions.forEach(this.renderEntity,this),this.pedals.forEach(this.renderEntity,this),this.pizzicatos.forEach(this.renderEntity,this),this.mutes.forEach(this.transferDrawingContext,this),this.words.forEach(this.renderEntity,this),this.middleWedgesAnchors.forEach(this.transferDrawingContext,this),this.middleOctaveShiftsAnchors.forEach(this.transferDrawingContext,this),this.middlePluckedRangesAnchors.forEach(this.transferDrawingContext,this),this.middlePedalsAnchors.forEach(this.transferDrawingContext,this),this.chords.forEach(this.transferDrawingContext,this),this.classicChords.forEach(this.transferDrawingContext,this),this.figuredBasses.forEach(this.transferDrawingContext,this),this.middleClefs.forEach(this.transferDrawingContext,this)},$.renderEntity=function(t){t.render(this.drawingContext)},$.shiftNotes=function(){if(this.getNbVoices()>1){const s=this.getVoicesArray();Je(s)}},$.getVoicesArray=function(){const t=this.getNbVoices(),s=[];for(let n=0;n<t;n++){const c=this.voicesIndexes[n],y=this.voices[c];s.push(y)}return s},$.transferDrawingContext=function(t){t.setDrawingContext(this.drawingContext)},$.getHorizontalData=function(){return this.horizontalData===null&&this.computeHorizontalData(),this.horizontalData},$.computeHorizontalData=function(){if(this.horizontalData=this.getVoicesHorizontalData(),this.hasChords()){const t=this.getChordsHorizontalData();this.horizontalData.push(t)}if(this.hasClassicChords()){const t=this.getClassicChordsHorizontalData();this.horizontalData.push(t)}if(this.hasFiguredBasses()){const t=this.getFiguredBassesHorizontalData();this.horizontalData.push(t)}if(this.hasDynamics()){const t=this.getDynamicsHorizontalData();this.horizontalData.push(t)}},$.getVoicesHorizontalData=function(){let t=[];for(const n in this.voices){const y=this.voices[n].getHorizontalData();t.push.apply(t,y)}const s=t.filter(ms);if(t=t.filter(Ri),Qi(t),this.hasMiddleClefs()){const n=this.middleClefs.slice();t.forEach(Nn,n),t.forEach(Ve,n),t.forEach(M,n)}return t.concat(s)};function ms(t){return t.type===Ne.A.LYRIC}function Ri(t){return t.type!==Ne.A.LYRIC}function Nn(t){Re(t.entities,this)}function Ve(t){Ji(t.entities,this)}function M(t){mn(t.entities,this)}$.hasDynamics=function(){return this.directions.length>0||this.middleWedgesAnchors.length>0},$.hasPedals=function(){return this.pedals.length>0},$.getDynamicsHorizontalData=function(){if(this.dynamicsHorizontalData===null){const t=this.getDpq(),s=this.getNbDivisions(),n=vi(this.directions,this.middleWedgesAnchors);this.dynamicsHorizontalData={entities:n,dpq:t,nbDivisions:s,type:Ne.A.DYNAMIC}}return this.dynamicsHorizontalData},$.hasChords=function(){return this.chords.length>0},$.hasClassicChords=function(){return this.classicChords.length>0},$.hasFiguredBasses=function(){return this.figuredBasses.length>0},$.hasMiddleClefs=function(){return this.middleClefs.length>0},$.getChordsHorizontalData=function(){const t=this.getDpq(),s=this.getNbDivisions();return{entities:this.chords.map(this.extractChordHorizontalData,this),dpq:t,nbDivisions:s,type:Ne.A.HARMONY}},$.extractChordHorizontalData=function(t){const s=t.getTimePos(),n=t.getWidth();return{timePos:s,spaceBefore:0,spaceAfter:n}},$.getClassicChordsHorizontalData=function(){const t=this.getDpq(),s=this.getNbDivisions();return{entities:this.classicChords.map(this.extractChordHorizontalData,this),dpq:t,nbDivisions:s,type:Ne.A.HARMONY}},$.getFiguredBassesHorizontalData=function(){const t=this.getDpq(),s=this.getNbDivisions();return{entities:this.figuredBasses.map(this.extractChordHorizontalData,this),dpq:t,nbDivisions:s,type:Ne.A.FIGURED_BASS}},$.setHorizontalFormatter=function(t){this.horizontalFormatter=t,this.verticalData=null,this.dynamicVerticalData=null,this.forEachVoice(this.transferHorizontalFormatter,this)},$.transferHorizontalFormatter=function(t){t.setHorizontalFormatter(this.horizontalFormatter)},$.dispatchHorizontalFormattingForVerticalComputation=function(t){this.horizontalFormatter=t,this.verticalData=null,this.dynamicVerticalData=null,this.voicesList.forEach(s=>s.dispatchHorizontalFormattingForVerticalComputation(t))},$.formatHorizontal=function(){this.formatVoicesHorizontal(),this.formatChordsHorizontal(),this.formatDirectionsHorizontal()},$.formatVoicesHorizontal=function(){this.forEachVoice(et)};const et=function(t){t.formatHorizontal()};$.formatChordsHorizontal=function(){this.chords.forEach(this.formatChordHorizontal,this),this.classicChords.forEach(this.formatChordHorizontal,this),this.figuredBasses.forEach(this.formatChordHorizontal,this),this.middleClefs.forEach(this.formatMiddleClefHorizontal,this)},$.formatChordHorizontal=function(t){const s=t.getTimePos(),n=this.timePosToX(s);t.setPosX(n)},$.formatMiddleClefHorizontal=function(t){const s=t.getTimePos(),n=this.timePosToX(s),c=t.getContentAfter();t.setPosition(n-c)},$.timePosToX=function(t){const s=this.getDpq();return this.horizontalFormatter.getPosX(t,s)},$.timePosToXSafe=function(t){const s=this.getDpq();return this.horizontalFormatter.getPosXSafe(t,s)},$.formatDirectionsHorizontal=function(){this.directions.forEach(this.formatDirectionHorizontal,this),this.pedals.forEach(this.formatDirectionHorizontal,this),this.pizzicatos.forEach(this.formatDirectionHorizontal,this),this.mutes.forEach(this.formatDirectionHorizontal,this),this.words.forEach(this.formatDirectionHorizontal,this)},$.formatDirectionHorizontal=function(t){const s=t.getTimePos(),n=this.timePosToX(s);t.setPosX(n)},$.getWidth=function(){return this.horizontalFormatter.getWidth()},$.setVerticalFormatting=function(t){this.verticalFormatting=t,this.forEachVoice(this.transferVerticalFormatting,this)},$.transferVerticalFormatting=function(t){t.setVerticalFormatting(this.verticalFormatting)},$.formatVertical=function(){this.formatVoicesVertical(),this.formatChordsVertical(),this.formatDirectionsVertical(),this.formatPedalsVertical(),this.formatPizzicatosVertical(),this.formatMutesVertical(),this.formatWordsVertical()},$.formatPedalsVertical=function(){this.pedals.forEach(this.formatPedalVertical,this)},$.formatVoicesVertical=function(){this.forEachVoice(Z)};const Z=function(t){t.formatVertical()};$.formatChordsVertical=function(){this.chords.forEach(this.formatChordVertical,this),this.classicChords.forEach(this.formatClassicChordVertical,this),this.figuredBasses.forEach(this.formatFiguredBassVertical,this)},$.formatChordVertical=function(t){const s=t.getHeight(),n=this.verticalFormatting.getChordsY()-s;t.setPosY(n)},$.formatClassicChordVertical=function(t){const s=this.verticalFormatting.getClassicChordY()-t.getSpaceAbove();t.setPosY(s)},$.formatFiguredBassVertical=function(t){const s=this.verticalFormatting.getFiguredBassY();t.setPosY(s)},$.formatDirectionsVertical=function(){this.directions.forEach(this.formatDirectionVertical,this)},$.formatDirectionVertical=function(t){if(t.isAbove())this.formatAboveDirectionVertical(t);else if(t.isBelow())this.formatBelowDirectionVertical(t);else throw new F.default("Unexpected")},$.formatAboveDirectionVertical=function(t){const s=this.drawingContext.getDynamicsHeight(),c=this.verticalFormatting.getUpDynamicsY()-s/2;t.setPosY(c)},$.formatBelowDirectionVertical=function(t){const s=this.drawingContext.getDynamicsHeight(),c=this.verticalFormatting.getDownDynamicsY()+s/2;t.setPosY(c)},$.formatPedalVertical=function(t){const s=this.verticalFormatting.getDownPedalsHeight(),c=this.verticalFormatting.getDownPedalsY()+s;t.setPosY(c)},$.formatPizzicatosVertical=function(){this.pizzicatos.forEach(this.formatPizzicatoVertical,this)},$.formatPizzicatoVertical=function(t){if(t.isAbove())this.formatAbovePizzicatoVertical(t);else if(t.isBelow())this.formatBelowPizzicatoVertical(t);else throw new F.default("Unexpected")},$.formatAbovePizzicatoVertical=function(t){const s=t.getSpaceBelow(),c=this.verticalFormatting.getUpPizzicatoY()-s;t.setPosY(c)},$.formatBelowPizzicatoVertical=function(t){const s=t.getSpaceAbove(),c=this.verticalFormatting.getDownPizzicatoY()+s;t.setPosY(c)},$.formatMutesVertical=function(){this.mutes.forEach(this.formatMuteVertical,this)},$.formatMuteVertical=function(t){if(t.isAbove())this.formatAboveMuteVertical(t);else if(t.isBelow())this.formatBelowMuteVertical(t);else throw new F.default("Unexpected")},$.formatAboveMuteVertical=function(t){const s=t.getSpaceBelow(),c=this.verticalFormatting.getUpMuteY()-s;t.setPosY(c)},$.formatBelowMuteVertical=function(t){const s=t.getMargin(),n=this.verticalFormatting.getDownMuteY(),c=this.belowMuteHeight,y=n+c-s;t.setPosY(y)},$.formatWordsVertical=function(){this.words.forEach(this.formatWordVertical,this)},$.formatWordVertical=function(t){if(t.isAbove())this.formatAboveWordVertical(t);else if(t.isBelow())this.formatBelowWordVertical(t);else throw new F.default("Unexpected")},$.formatAboveWordVertical=function(t){const s=t.getSpaceBelow(),c=this.verticalFormatting.getUpWordY()-s;t.setPosY(c)},$.formatBelowWordVertical=function(t){const s=t.getSpaceAbove(),c=this.verticalFormatting.getDownWordY()+s;t.setPosY(c)},$.draw=function(){this.move(),this.forEachVoice(mt),this.directions.forEach(mt),this.pizzicatos.forEach(mt),this.mutes.forEach(mt),this.pedals.forEach(mt),this.words.forEach(mt),this.chords.forEach(mt),this.classicChords.forEach(mt),this.figuredBasses.forEach(mt),this.middleClefs.forEach(mt),this.bindToParent()};const mt=function(t){t.draw(t)};$.bindToParent=function(){this.parent.append(this.group)},$.drawLyrics=function(){this.forEachVoice($t)};const $t=function(t){t.drawLyrics()};$.setPosition=function(t){this.xPos=t,this.forEachVoice(this.transferPosition,this)},$.transferPosition=function(t){t.setPosition(this.xPos)},$.move=function(){this.group.attr("transform",`translate(${this.xPos} 0)`)},$.drawCursor=function(t,s){this.getVoice(t.voiceIdx).drawCursor(t,s)},$.drawGraceCursor=function(t,s){this.getVoice(t.voiceIdx).drawGraceCursor(t,s)},$.drawDynamicCursor=function(t,s){const y=this.getVoice(t.voiceIdx).getNote(t.noteIdx).getXPos();s.setPosition(y),this.formatDirectionVertical(s.dynamic),s.setParent(this.group),s.draw()},$.drawPizzicatoCursor=function(t,s){const y=this.getVoice(t.voiceIdx).getNote(t.noteIdx).getXPos();s.setPosition(y),this.formatDirectionVertical(s.pizzicato),s.setParent(this.group),s.draw()},$.drawMuteCursor=function(t,s){const y=this.getVoice(t.voiceIdx).getNote(t.noteIdx).getXPos();s.setPosition(y),this.formatDirectionVertical(s.mute),s.setParent(this.group),s.draw()},$.setNoteColor=function(t,s){this.getVoice(t.voiceIdx).setNoteColor(t,s)},$.getNoteX=function(t,s){const n=this.getVoice(t),c=this.getXPos(),y=n.getNoteX(s);return c+y},$.getXPos=function(){return this.xPos},$.getNbNotes=function(t){return this.getVoice(t).getNbNotes()},$.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()},$.getVerticalData=function(){return this.verticalData===null&&this.computeVerticalData(),this.verticalData},$.computeVerticalData=function(){const t=this.getStaticVerticalData(),s=this.getDynamicVerticalData();this.verticalData=[t,s].reduce(de),this.verticalData.chordsHeight=this.getChordsHeight(),this.verticalData.classicChordSpaceAbove=this.getClassicChordsSpaceAbove(),this.verticalData.classicChordSpaceBelow=this.getClassicChordsSpaceBelow(),this.verticalData.aboveMuteHeight=this.getAboveMuteHeight(),this.verticalData.belowMuteHeight=this.getBelowMuteHeight(),this.verticalData.figuredBassSpaceAbove=this.getFiguredBassesSpaceAbove(),this.verticalData.figuredBassSpaceBelow=this.getFiguredBassesSpaceBelow(),this.verticalData.downPedalsHeight=this.getPedalsHeight()},$.getStaticVerticalData=function(){return this.staticVerticalData===null&&this.computeStaticVerticalData(),this.staticVerticalData},$.computeStaticVerticalData=function(){const t=[];for(const s in this.voices){const c=this.voices[s].getStaticVerticalData();t.push(c)}this.staticVerticalData=t.reduce(de)},$.getDynamicVerticalData=function(){return this.dynamicVerticalData===null&&this.computeDynamicVerticalData(),this.dynamicVerticalData},$.computeDynamicVerticalData=function(){const t=[];for(const n in this.voices){const y=this.voices[n].getDynamicVerticalData();t.push(y)}const s=Ye();this.dynamicVerticalData=t.reduce(de,s)};const Ye=function(){return{notesUpOverflow:0,notesDownOverflow:0,hasLyric:!1,lyricHeight:0}},de=function(t,s){const n=Math.max(t.notesUpOverflow,s.notesUpOverflow),c=Math.max(t.notesDownOverflow,s.notesDownOverflow),y=t.hasLyric||s.hasLyric,N=Math.max(t.lyricHeight,s.lyricHeight);return{notesUpOverflow:n,notesDownOverflow:c,hasLyric:y,lyricHeight:N}};$.updateHorizontalDisplay=function(){this.forEachVoice(xs),this.directions.forEach(jt),this.pizzicatos.forEach(jt),this.mutes.forEach(jt),this.pedals.forEach(jt),this.words.forEach(jt),this.chords.forEach(jt),this.classicChords.forEach(jt),this.figuredBasses.forEach(jt),this.middleClefs.forEach(jt)};const xs=function(t){t.updateHorizontalDisplay()};$.updateVerticalDisplay=function(){this.forEachVoice(Fs),this.directions.forEach(jt),this.pizzicatos.forEach(jt),this.mutes.forEach(jt),this.pedals.forEach(jt),this.words.forEach(jt),this.chords.forEach(jt),this.classicChords.forEach(jt),this.figuredBasses.forEach(jt)};const Fs=function(t){t.updateVerticalDisplay()},jt=function(t){t.move()};$.hasPizzicatosAbove=function(){return this.hasPizzicatosAboveValue===null&&this.calcHasPizzicatosAbove(),this.hasPizzicatosAboveValue},$.calcHasPizzicatosAbove=function(){this.hasPizzicatosAboveValue=this.pizzicatos.some(As)},$.hasPizzicatosBelow=function(){return this.hasPizzicatosBelowValue===null&&this.calcHasPizzicatosBelow(),this.hasPizzicatosBelowValue},$.calcHasPizzicatosBelow=function(){this.hasPizzicatosBelowValue=this.pizzicatos.some(ye)},$.hasMutesAbove=function(){return this.hasMutesAboveValue===null&&this.calcHasMutesAbove(),this.hasMutesAboveValue},$.calcHasMutesAbove=function(){this.hasMutesAboveValue=this.mutes.some(As)},$.hasMutesBelow=function(){return this.hasMutesBelowValue===null&&this.calcHasMutesBelow(),this.hasMutesBelowValue},$.calcHasMutesBelow=function(){this.hasMutesBelowValue=this.mutes.some(ye)},$.hasWordsAbove=function(){return this.hasWordsAboveValue===null&&this.calcHasWordsAbove(),this.hasWordsAboveValue},$.calcHasWordsAbove=function(){this.hasWordsAboveValue=this.words.some(As)},$.hasWordsBelow=function(){return this.hasWordsBelowValue===null&&this.calcHasWordsBelow(),this.hasWordsBelowValue},$.calcHasWordsBelow=function(){this.hasWordsBelowValue=this.words.some(ye)},$.hasDynamicsAbove=function(){return this.hasDynamicsAboveValue===null&&this.calcHasDynamicsAbove(),this.hasDynamicsAboveValue},$.calcHasDynamicsAbove=function(){this.hasDynamicsAboveValue=this.directions.some(As)},$.hasOctaveShiftsAbove=function(){return this.hasOctaveShiftsAboveValue===null&&this.calcHasOctaveShiftsAbove(),this.hasOctaveShiftsAboveValue},$.calcHasOctaveShiftsAbove=function(){this.hasOctaveShiftsAboveValue=this.hasLeftOctaveShiftAnchor()&&As(this.getLeftOctaveShiftAnchor())||this.hasRightOctaveShiftAnchor()&&As(this.getRightOctaveShiftAnchor())||this.middleOctaveShiftsAnchors.some(As)},$.hasOctaveShiftsBelow=function(){return this.hasOctaveShiftsBelowValue===null&&this.calcHasOctaveShiftsBelow(),this.hasOctaveShiftsBelowValue},$.calcHasOctaveShiftsBelow=function(){this.hasOctaveShiftsBelowValue=this.hasLeftOctaveShiftAnchor()&&ye(this.getLeftOctaveShiftAnchor())||this.hasRightOctaveShiftAnchor()&&ye(this.getRightOctaveShiftAnchor())||this.middleOctaveShiftsAnchors.some(ye)},$.hasPluckedRangesAbove=function(){return this.hasPluckedRangesAboveValue===null&&this.calcHasPluckedRangesAbove(),this.hasPluckedRangesAboveValue},$.calcHasPluckedRangesAbove=function(){this.hasPluckedRangesAboveValue=this.hasLeftPluckedRangeAnchor()&&As(this.getLeftPluckedRangeAnchor())||this.hasRightPluckedRangeAnchor()&&As(this.getRightPluckedRangeAnchor())||this.middlePluckedRangesAnchors.some(As)},$.hasPluckedRangesBelow=function(){return this.hasPluckedRangesBelowValue===null&&this.calcHasPluckedRangesBelow(),this.hasPluckedRangesBelowValue},$.calcHasPluckedRangesBelow=function(){this.hasPluckedRangesBelowValue=this.hasLeftPluckedRangeAnchor()&&ye(this.getLeftPluckedRangeAnchor())||this.hasRightPluckedRangeAnchor()&&ye(this.getRightPluckedRangeAnchor())||this.middlePluckedRangesAnchors.some(ye)},$.hasPedalsAbove=function(){return this.hasPedalsAboveValue===null&&this.calcHasPedalsAbove(),this.hasPedalsAboveValue},$.calcHasPedalsAbove=function(){this.hasPedalsAboveValue=this.hasLeftPedalAnchor()&&As(this.getLeftPedalAnchor())||this.hasRightPedalAnchor()&&As(this.getRightPedalAnchor())||this.middlePedalsAnchors.some(As)},$.hasPedalsBelow=function(){return this.hasPedalsBelowValue===null&&this.calcHasPedalsBelow(),this.hasPedalsBelowValue},$.calcHasPedalsBelow=function(){this.hasPedalsBelowValue=this.hasLeftPedalAnchor()&&ye(this.getLeftPedalAnchor())||this.hasRightPedalAnchor()&&ye(this.getRightPedalAnchor())||this.middlePedalsAnchors.some(ye)};const As=function(t){return t.isAbove()};$.hasWedgeAbove=function(){return this.getAllWedgesAnchors().some(hi)};const hi=function(t){return t.isAbove()};$.hasDynamicsBelow=function(){return this.hasDynamicsBelowValue===null&&this.calcHasDynamicsBelow(),this.hasDynamicsBelowValue},$.calcHasDynamicsBelow=function(){this.hasDynamicsBelowValue=this.directions.some(ye)};const ye=function(t){return t.isBelow()};$.hasWedgeBelow=function(){return this.getAllWedgesAnchors().some(ci)};const ci=function(t){return t.isBelow()};$.getPedalsHeight=function(){if(this.pedalsHeight===null){const t=this.pedals.map(uo);this.pedalsHeight=t.reduce(Bt.default.max2,0)}return this.pedalsHeight};const uo=function(t){return t.getHeight()};$.getChordsHeight=function(){if(this.chordsHeight===null){const t=this.chords.map(Ze);this.chordsHeight=t.reduce(Bt.default.max2,0)}return this.chordsHeight};const Ze=function(t){return t.getHeight()};$.getClassicChordsSpaceAbove=function(){if(this.classicChordSpaceAbove===null){const t=this.classicChords.map(s=>s.getSpaceAbove());this.classicChordSpaceAbove=t.reduce(Bt.default.max2,0)}return this.classicChordSpaceAbove},$.getClassicChordsSpaceBelow=function(){if(this.classicChordSpaceBelow===null){const t=this.classicChords.map(s=>s.getSpaceBelow());this.classicChordSpaceBelow=t.reduce(Bt.default.max2,0)}return this.classicChordSpaceBelow},$.getAboveMuteHeight=function(){if(this.aboveMuteHeight===null){const t=this.mutes.filter(As),s=t.map(n=>n.getHeight());this.aboveMuteHeight=Math.max(0,...s),this.aboveMuteHeight>0&&(this.aboveMuteHeight+=2*t[0].getMargin())}return this.aboveMuteHeight},$.getBelowMuteHeight=function(){if(this.belowMuteHeight===null){const t=this.mutes.filter(ye),s=t.map(n=>n.getHeight());this.belowMuteHeight=Math.max(0,...s),this.belowMuteHeight>0&&(this.belowMuteHeight+=2*t[0].getMargin())}return this.belowMuteHeight},$.getFiguredBassesSpaceAbove=function(){if(this.figuredBassSpaceAbove===null){const t=this.figuredBasses.map(s=>s.getSpaceAbove());this.figuredBassSpaceAbove=t.reduce(Bt.default.max2,0),this.figuredBassSpaceAbove>0&&(this.figuredBassSpaceAbove+=this.drawingContext.getSpaceSize())}return this.figuredBassSpaceAbove},$.getFiguredBassesSpaceBelow=function(){if(this.figuredBassSpaceBelow===null){const t=this.figuredBasses.map(s=>s.getSpaceBelow());this.figuredBassSpaceBelow=t.reduce(Bt.default.max2,0)}return this.figuredBassSpaceBelow},$.getNote=function(t,s){return this.getVoice(t).getNote(s)},$.getNoteGraces=function(t,s){return this.getVoice(t).getNoteGraces(s)},$.getVoiceStemStrategy=function(t){return this.getVoice(t).getStemStrategy()},$.getVoice=function(t){if(this.hasVoice(t))return this.voices[t];{const s=`Bad voice idx [${t}] in drawer.`;throw new F.default("BadVoiceIdx",s)}},$.hasVoice=function(t){if(!Bt.default.isInteger(t))throw new F.default("BadVoiceIdx",`Bad voice idx: [${t}].`);return typeof this.voices[t]!="undefined"},$.forEachVoice=function(t,s){const n=this.getNbVoices();for(let c=0;c<n;c++){const y=this.voicesIndexes[c],N=this.voices[y];t.call(s,N,y)}},$.hasRightTieAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasRightTieAnchor():!1},$.getRightTieAnchor=function(t){return this.getVoice(t).getRightTieAnchor()},$.hasLeftTieAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasLeftTieAnchor():!1},$.getLeftTieAnchor=function(t){return this.getVoice(t).getLeftTieAnchor()},$.hasRightHyphenAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasRightHyphenAnchor():!1},$.getRightHyphenAnchor=function(t){return this.getVoice(t).getRightHyphenAnchor()},$.hasLeftHyphenAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasLeftHyphenAnchor():!1},$.getLeftHyphenAnchor=function(t){return this.getVoice(t).getLeftHyphenAnchor()},$.hasRightHammerOnPullOffAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasRightHammerOnPullOffAnchor():!1},$.getRightHammerOnPullOffAnchor=function(t){return this.getVoice(t).getRightHammerOnPullOffAnchor()},$.hasLeftHammerOnPullOffAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasLeftHammerOnPullOffAnchor():!1},$.getLeftHammerOnPullOffAnchor=function(t){return this.getVoice(t).getLeftHammerOnPullOffAnchor()},$.hasRightGlissandoAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasRightGlissandoAnchor():!1},$.getRightGlissandoAnchor=function(t){return this.getVoice(t).getRightGlissandoAnchor()},$.hasLeftGlissandoAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasLeftGlissandoAnchor():!1},$.getLeftGlissandoAnchor=function(t){return this.getVoice(t).getLeftGlissandoAnchor()},$.hasRightSlideAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasRightSlideAnchor():!1},$.getRightSlideAnchor=function(t){return this.getVoice(t).getRightSlideAnchor()},$.hasLeftSlideAnchor=function(t){return this.hasVoice(t)?this.getVoice(t).hasLeftSlideAnchor():!1},$.getLeftSlideAnchor=function(t){return this.getVoice(t).getLeftSlideAnchor()},$.hasRightSlurAnchor=function(t){return typeof this.rightSlurs[t]!="undefined"},$.setRightSlurAnchor=function(t,s){this.rightSlurs[s]=t},$.getRightSlurAnchor=function(t){return this.rightSlurs[t]},$.hasLeftSlurAnchor=function(t){return typeof this.leftSlurs[t]!="undefined"},$.setLeftSlurAnchor=function(t,s){this.leftSlurs[s]=t},$.getLeftSlurAnchor=function(t){return this.leftSlurs[t]},$.getMiddleSlursAnchors=function(t){return this.hasVoice(t)?this.getVoice(t).getMiddleSlursAnchors():[]},$.getAllSlursAnchors=function(t){const s=[];if(this.hasLeftSlurAnchor(t)){const n=this.getLeftSlurAnchor(t);s.push(n)}if(this.hasVoice(t)){const c=this.getVoice(t).getMiddleSlursAnchors();Array.prototype.push.apply(s,c)}if(this.hasRightSlurAnchor(t)){const n=this.getRightSlurAnchor(t);s.push(n)}return s},$.hasRightBendAnchor=function(t,s){return this.hasVoice(t)?this.getVoice(t).hasRightBendAnchor(s):!1},$.getRightBendAnchor=function(t,s){return this.getVoice(t).getRightBendAnchor(s)},$.hasLeftBendAnchor=function(t,s){return this.hasVoice(t)?this.getVoice(t).hasLeftBendAnchor(s):!1},$.getLeftBendAnchor=function(t,s){return this.getVoice(t).getLeftBendAnchor(s)},$.getMiddleBendsAnchors=function(t,s){return this.hasVoice(t)?this.getVoice(t).getMiddleBendsAnchors(s):[]},$.getAllBendsAnchors=function(t){return this.hasVoice(t)?this.getVoice(t).getAllBendsAnchors():[]},$.getMelismaAnchorsAtLevel=function(t,s){return this.hasVoice(t)?this.getVoice(t).getMelismaAnchorsAtLevel(s):[]},$.getAllMelismasAnchors=function(t){return this.hasVoice(t)?this.getVoice(t).getAllMelismasAnchors():[]},$.getAllWedgesAnchors=function(){const t=this.middleWedgesAnchors.slice();return this.hasLeftWedgeAnchor()&&t.push(this.getLeftWedgeAnchor()),this.hasRightWedgeAnchor()&&t.push(this.getRightWedgeAnchor()),t},$.hasRightWedgeAnchor=function(){return this.rightWedgeAnchor!==null},$.getRightWedgeAnchor=function(){return this.rightWedgeAnchor},$.hasLeftWedgeAnchor=function(){return this.leftWedgeAnchor!==null},$.getLeftWedgeAnchor=function(){return this.leftWedgeAnchor},$.getMiddleWedgesAnchors=function(){return this.middleWedgesAnchors},$.getAllOctaveShiftsAnchors=function(){const t=this.middleOctaveShiftsAnchors.slice();return this.hasLeftOctaveShiftAnchor()&&t.push(this.getLeftOctaveShiftAnchor()),this.hasRightOctaveShiftAnchor()&&t.push(this.getRightOctaveShiftAnchor()),t},$.hasRightOctaveShiftAnchor=function(){return this.rightOctaveShiftAnchor!==null},$.getRightOctaveShiftAnchor=function(){return this.rightOctaveShiftAnchor},$.hasLeftOctaveShiftAnchor=function(){return this.leftOctaveShiftAnchor!==null},$.getLeftOctaveShiftAnchor=function(){return this.leftOctaveShiftAnchor},$.getMiddleOctaveShiftsAnchors=function(){return this.middleOctaveShiftsAnchors},$.getAllPluckedRangesAnchors=function(){const t=this.middlePluckedRangesAnchors.slice();return this.hasLeftPluckedRangeAnchor()&&t.push(this.getLeftPluckedRangeAnchor()),this.hasRightPluckedRangeAnchor()&&t.push(this.getRightPluckedRangeAnchor()),t},$.hasRightPluckedRangeAnchor=function(){return this.rightPluckedRangeAnchor!==null},$.getRightPluckedRangeAnchor=function(){return this.rightPluckedRangeAnchor},$.hasLeftPluckedRangeAnchor=function(){return this.leftPluckedRangeAnchor!==null},$.getLeftPluckedRangeAnchor=function(){return this.leftPluckedRangeAnchor},$.getMiddlePluckedRangesAnchors=function(){return this.middlePluckedRangesAnchors},$.getAllPedalsAnchors=function(){const t=this.middlePedalsAnchors.slice();return this.hasLeftPedalAnchor()&&t.push(this.getLeftPedalAnchor()),this.hasRightPedalAnchor()&&t.push(this.getRightPedalAnchor()),t},$.hasRightPedalAnchor=function(){return this.rightPedalAnchor!==null},$.getRightPedalAnchor=function(){return this.rightPedalAnchor},$.hasLeftPedalAnchor=function(){return this.leftPedalAnchor!==null},$.getLeftPedalAnchor=function(){return this.leftPedalAnchor},$.getMiddlePedalsAnchors=function(){return this.middlePedalsAnchors},$.getDpq=function(){return this.dpq},$.getNbDivisions=function(){return this.nbDivisions},$.getStaffData=function(){return this.staffData},$.getOrderedVoices=function(){const t=[],s=this.getNbVoices();for(let n=0;n<s;n++){const c=this.voicesIndexes[n],y=this.getVoice(c);t.push(y)}return t},$.getVoiceInternalTies=function(t){return this.getVoice(t).getInternalTies()},$.getAnyVoiceIdx=function(t){return this.hasVoice(t)?t:this.voicesIndexes[0]},$.getNbVoices=function(){return this.voicesIndexes.length},$.getSpaceBellowChords=function(){return this.chords.map(fo).reduce(Bt.default.max2,0)};function fo(t){return t.getSpaceBelow()}$.getSpaceAboveFiguredBass=function(){let t=this.getFiguredBassesSpaceAbove();if(t===0){const s=new Vs(ps);s.setDrawingContext(this.drawingContext),t=s.getSpaceAbove(),t+=this.drawingContext.getSpaceSize()}return t},$.getSpaceAboveClassicChords=function(){let s=this.classicChords.map(zi).reduce(Bt.default.max2,0);if(s===0){const n={drawingContext:this.drawingContext};s=kn.A.prototype.getSpaceAbove.call(n)}return s};function zi(t){return t.getSpaceAbove()}$.getVoiceMelismaLevels=function(t){return this.getVoice(t).getMelismaLevels()},$.getMeasureNumberShift=function(){return this.measureNumberShift};const Wo=Sn;var Ce=r(197341),vs=r(744771),Zi=r(723631),bs=r(100673);const ns="adagio-word-uuid",Bn=function(t,s,n,c){this.init(t,s,n,c)};Bn.cssClass="word";const Ts=Bn.prototype;Ts.cssClass=Bn.cssClass,Ts.init=function(t,s,n,c){this.textString=s,this.placement=t,this.timePos=n,this.wordUuid=c||null,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.parent=null,this.text=null},Ts.setParent=function(t){this.parent=t,this.text!==null&&this.text.setParent(t)},Ts.getWidth=function(){return this.text.getWidth()},Ts.getSpaceAbove=function(){return this.drawingContext.getWordFontSize()},Ts.getSpaceBelow=function(){return this.drawingContext.getWordFontSize()/2},Ts.render=function(t){this.drawingContext=t;const s={};s["font-size"]=t.getWordFontSize(),s["font-family"]=t.getWordFontFamily(),s["font-style"]=t.getWordFontStyle(),s["font-weight"]=t.getWordFontWeight(),s.text=this.textString,this.text=new bs.A(s),this.parent!==null&&this.text.setParent(this.parent),this.text.setDrawingContext(t),this.text.render(),this.text.setCssClass(Bn.cssClass),this.wordUuid!==null&&this.text.setDataEntry(ns,this.wordUuid)},Ts.setPosX=function(t){this.xPos=t,this.text.setXPos(this.xPos+this.horizontalOffset)},Ts.setHorizontalOffset=function(t){this.horizontalOffset=t,this.text.setXPos(this.xPos+this.horizontalOffset)},Ts.setPosY=function(t){this.yPos=t,this.text.setYPos(this.yPos)},Ts.draw=function(){this.needRender()&&this.render(),this.text.draw()},Ts.needRender=function(){return this.text===null},Ts.move=function(){this.text.move()},Ts.getDrawingContext=function(){return this.drawingContext},Ts.getTimePos=function(){return this.timePos},Ts.isAbove=function(){return this.getPlacement()===Zi.A.ABOVE},Ts.isBelow=function(){return this.getPlacement()===Zi.A.BELOW},Ts.getPlacement=function(){return this.placement};const Go=Bn;var Uo=r(79769),hn=r(658628);const $s={C:"cClef",F:"fClef",G:"gClef",percussion:"unpitchedPercussionClef1",TAB:"6stringTabClef"},Ws="6stringTabClef",zo="4stringTabClef",Xn="15ma",$e="8va",ko="15mb",Vn="8vb",li=function(t){this.init(t)},Gs="clef-pitched",go="clef-unpitched",Ns="clef-tab",Ke="adagio-clef-uuid";li.cssClass="clef";const Ue=li.prototype;Ue.cssClass=li.cssClass,Ue.init=function(t){p.default.check(t),this.cssTypeClass=$n(t),mi(t),this.clef=t,this.glyphName=Us(t),this.line=p.default.getDisplayLine(t),this.glyph=null,this.path=null,this.timePos=null,this.clefUuid=null,this.contentAfter=0,this.drawingContext=null,this.staffData=null,this.xPos=null,this.parent=null,this.group=null};function $n(t){return p.default.isPercussion(t)?go:p.default.isTab(t)?Ns:Gs}const mi=function(t){const s=p.default.getSign(t);if(typeof $s[s]=="undefined"){const n=`The clef sign [${s}] is not supported yet.`;throw new st.A("BadTimeSymbol",n)}},Us=function(t){if(p.default.isTab(t))return p.default.getLine(t)===4?zo:Ws;const s=p.default.getSign(t),n=$s[s],c=Xo(t);return n+c},Xo=function(t){if(p.default.isPercussion(t))return"";const s=p.default.getOctaveChange(t);if(s===0)return"";const n=p.default.getSign(t);return s===1&&(n==="G"||n==="F")?$e:s===2&&(n==="G"||n==="F")?Xn:s===-1&&(n==="G"||n==="F"||n==="C")?Vn:s===-2&&(n==="G"||n==="F")?ko:""};Ue.setUuid=function(t){this.clefUuid=t},Ue.setParent=function(t){this.parent=t},Ue.setStaffData=function(t){this.staffData=t},Ue.setTimePos=function(t){this.timePos=t},Ue.getTimePos=function(){return this.timePos},Ue.setContentAfter=function(t){this.contentAfter=t},Ue.getContentAfter=function(){return this.contentAfter},Ue.setDrawingContext=function(t){this.drawingContext=t},Ue.getStaffData=function(){return this.staffData},Ue.getWidth=function(){return this.getGlyph().getWidth()},Ue.getHeight=function(){return this.getGlyph().getHeight()},Ue.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphName)),this.glyph},Ue.render=function(){this.group=new L.A("g"),this.group.attr("class",`${this.cssClass} ${this.cssTypeClass}`),this.path=this.group.append("path"),this.path.attr("d",this.glyph.render()),this.clefUuid!==null&&this.group.setDataEntry(Ke,this.clefUuid)},Ue.setPosition=function(t){this.xPos=t},Ue.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},Ue.needRender=function(){return this.group===null},Ue.bindToParent=function(){this.parent.append(this.group)},Ue.move=function(){if(!this.needRender()&&this.posX!==null){const t=this.getPathY();this.group.attr("transform",`translate(${this.xPos}, ${t})`)}},Ue.getPathY=function(){this.checkHasStaffData();const t=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return p.default.isTab(this.clef)?(this.getNbStaffLines()-1)*t/2:(this.getNbStaffLines()-this.line)*t},Ue.checkHasStaffData=function(){if(this.staffData===null){const t="The clef needs to know the number of staff lines to be moved to the right y pos.";throw new F.default("MissingNbStaves",t)}},Ue.getNbStaffLines=function(){return this.checkHasStaffData(),R.A.getNbStaffLines(this.staffData)},Ue.isTabStaff=function(){return this.checkHasStaffData(),R.A.isTabStaff(this.staffData)},Ue.getUpOverflow=function(){return-this.glyph.getBBoxNE().y-this.getPathY()},Ue.getDownOverflow=function(){const t=this.glyph.getBBoxSW().y,s=this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize(),n=(this.getNbStaffLines()-1)*s,c=t+this.getPathY()-n;return Math.max(0,c)},Ue.getDrawingContext=function(){return this.drawingContext};const yn=li;var ge=r(75861),Ai=r(261566);function Hn(t,{template:s,getDuration:n,getTimePos:c},y=[]){const N={template:s,getDuration:n,getTimePos:c,lyrics:{}};t.forEach(Kn,N),y.forEach(Be,N);const j=v.default.getValues(N.lyrics);return j.forEach(Vo),j}function Kn(t,s){if(!t.hasLyric())return;const{lyrics:n,template:c,getTimePos:y,getDuration:N}=this;t.getLyricLevels().forEach(lt=>{typeof n[lt]=="undefined"&&(n[lt]={dpq:c.dpq,entities:[],nbDivisions:c.nbDivisions,type:Ne.A.LYRIC,level:lt});const{spaceBefore:Ft,spaceAfter:Kt}=t.getLyricLevelHorizontalData(lt),Se={timePos:y(t,s),duration:N(t),spaceBefore:Ft,spaceAfter:Kt,isRest:!1};n[lt].entities.push(Se)})}function Be(t){const{lyrics:s,template:n,getTimePos:c,getDuration:y}=this;if(!t.hasRenderedNote())return;const N=t.getLevel();typeof s[N]=="undefined"&&(s[N]={dpq:n.dpq,entities:[],nbDivisions:n.nbDivisions,type:Ne.A.LYRIC,level:N});const j=t.getRenderedNote(),{spaceBefore:lt,spaceAfter:Ft}=t.getLyricLevelHorizontalData(N),Kt={timePos:c(j),duration:y(j),spaceBefore:lt,spaceAfter:Ft,isRest:!1};s[N].entities.push(Kt)}function Vo(t){const s=t.entities;s.sort(to);for(let n=0;n+1<s.length;){const c=s[n],y=s[n+1];c.timePos===y.timePos?(y.spaceBefore=Math.max(y.spaceBefore,c.spaceBefore),y.spaceAfter=Math.max(y.spaceAfter,c.spaceAfter),s.splice(n,1)):n++}}function to(t,s){return t.timePos-s.timePos}var _n=r(385783);function xe(t,s,n){const y=s.length+1,N=s.concat([t]),lt={dpq:1,entities:N.map($o),nbDivisions:y,type:Ne.A.NOTE},Ft=[lt],Kt=po(N,lt);Ft.push.apply(Ft,Kt);const Se=!0,ke=Ft.map(_n.A,Ft[0].dpq),Cs=(0,Ai.A)(ke,y,n,Se),gn=Cs[N.length-1];s.forEach((Ln,Zn)=>{const En=Cs[Zn]-gn;Ln.setPosition(En)}),zs(Kt,Cs,t,gn)}function $o(t,s){const c=t.calcLeadingSpace(),y=s,N=t.getMiddleHeadWidth()+t.calcTrailingSpace();return{timePos:y,duration:1,spaceBefore:c,spaceAfter:N,isRest:!1}}function po(t,s){return Hn(t,{template:s,getDuration(){return 1},getTimePos(n,c){return c}})}function zs(t,s,n,c){t.forEach(y=>{const N=y.entities[0],j=s[N.timePos],lt=c-j+N.spaceBefore,Ft=y.entities.length-1,Kt=y.entities[Ft];let ke=s[Kt.timePos]-c+Kt.spaceAfter;ke=Math.max(ke,0);const Cs={spaceBefore:lt,spaceAfter:ke};n.setLyricLevelHorizontalData(y.level,Cs)})}const Ko="adagio-voice-uuid",cn=function(t,s){this.init(t,s)};cn.cssClass="voice voice-";const dt=cn.prototype;dt.cssClass=cn.cssClass,dt.init=function(t,s){this.voiceIdx=t,this.voiceUuid=s,this.notes=[],this.beams=[],this.graceBeams=[],this.graceSlurs=[],this.tuplets=[],this.graces={},this.internalTies=[],this.leftTieAnchor=null,this.rightTieAnchor=null,this.internalHyphens=[],this.leftHyphenAnchor=null,this.rightHyphenAnchor=null,this.internalHammerOnPullOffs=[],this.leftHammerOnPullOffAnchor=null,this.rightHammerOnPullOffAnchor=null,this.leftGlissandoAnchor=null,this.rightGlissandoAnchor=null,this.leftSlideAnchor=null,this.rightSlideAnchor=null,this.glissandos=[],this.slides=[],this.leftBendAnchorByString={},this.rightBendAnchorByString={},this.middleBendsAnchorsByString={},this.melismaAnchorsByLevel={},this.middleSlursAnchors=[],this.drawingContext=null,this.staffData=null,this.horizontalData=null,this.horizontalFormatter=null,this.xPos=null,this.staticVerticalData=null,this.dynamicVerticalData=null,this.verticalFormatting=null,this.nbDivisions=null,this.dpq=null,this.stemStrategy=null,this.group=new L.A("g"),this.group.attr("class",this.cssClass+t),this.group.setDataEntry(Ko,s),this.parent=null},dt.setStemStrategy=function(t){this.stemStrategy=t},dt.setParent=function(t){this.parent=t},dt.setStaffData=function(t){this.staffData=t,this.tuplets.forEach(this.transferStaffData,this),this.notes[0].setStaffData&&this.notes[0].setStaffData(t)},dt.transferStaffData=function(t){t.setStaffData(this.staffData)},dt.setPosition=function(t){this.xPos=t},dt.addNote=function(t){t.setParent(this.group),this.notes.push(t)},dt.addNoteGraces=function(t,s){this.graces[t]=s},dt.setDpq=function(t){this.dpq=t},dt.setNbDivisions=function(t){this.nbDivisions=t},dt.addTie=function(t){t.setParent(this.group),this.internalTies.push(t)},dt.addHyphen=function(t){t.setParent(this.group),this.internalHyphens.push(t)},dt.addTuplet=function(t){t.setParent(this.group),this.tuplets.push(t)},dt.addBeam=function(t){t.setParent(this.group),this.beams.push(t)},dt.addGraceBeam=function(t,s){const c=this.getNote(s).getGroup();t.setParent(c),this.graceBeams.push(t)},dt.addGraceSlur=function(t){t.setParent(this.group),this.graceSlurs.push(t)},dt.addHammerOnPullOff=function(t){t.setParent(this.group),this.internalHammerOnPullOffs.push(t)},dt.setRightTieAnchor=function(t){this.rightTieAnchor=t},dt.setLeftTieAnchor=function(t){this.leftTieAnchor=t},dt.setRightHyphenAnchor=function(t){this.rightHyphenAnchor=t},dt.setLeftHyphenAnchor=function(t){this.leftHyphenAnchor=t},dt.addMiddleSlurAnchor=function(t){this.middleSlursAnchors.push(t)},dt.setRightGlissandoAnchor=function(t){this.rightGlissandoAnchor=t},dt.setLeftGlissandoAnchor=function(t){this.leftGlissandoAnchor=t},dt.setRightSlideAnchor=function(t){this.rightSlideAnchor=t},dt.setLeftSlideAnchor=function(t){this.leftSlideAnchor=t},dt.setRightHammerOnPullOffAnchor=function(t){this.rightHammerOnPullOffAnchor=t},dt.setLeftHammerOnPullOffAnchor=function(t){this.leftHammerOnPullOffAnchor=t},dt.addGlissando=function(t){t.setParent(this.group),this.glissandos.push(t)},dt.addSlide=function(t){t.setParent(this.group),this.slides.push(t)},dt.addMiddleBendAnchor=function(t,s){const n=this.middleBendsAnchorsByString[t]||[];n.push(s),this.middleBendsAnchorsByString[t]=n},dt.addExternalLeftBendAnchor=function(t,s){this.leftBendAnchorByString[t]=s},dt.addExternalRightBendAnchor=function(t,s){this.rightBendAnchorByString[t]=s},dt.addMelismaAnchor=function(t,s){const n=this.melismaAnchorsByLevel[t]||[];n.push(s),this.melismaAnchorsByLevel[t]=n},dt.render=function(t){this.drawingContext=t,this.notes.forEach(this.renderNote,this),this.forEachGrace(this.renderEntity,this),this.internalTies.forEach(this.transferDrawingContext,this),this.internalHyphens.forEach(this.transferDrawingContext,this),this.beams.forEach(this.transferDrawingContext,this),this.graceBeams.forEach(this.transferDrawingContext,this),this.graceSlurs.forEach(this.transferDrawingContext,this),this.tuplets.forEach(this.transferDrawingContext,this),this.glissandos.forEach(this.transferDrawingContext,this),this.slides.forEach(this.transferDrawingContext,this),this.internalHammerOnPullOffs.forEach(this.transferDrawingContext,this),this.getAllMelismasAnchors().forEach(this.transferDrawingContext,this)},dt.renderNote=function(t,s){if(t.render(this.drawingContext),this.hasNoteGraces(s)){const n=this.getNoteGraces(s),c=t.getGroup();n.forEach(jo,c)}};const jo=function(t){const s=this;t.setParent(s)};dt.renderEntity=function(t){t.render(this.drawingContext)},dt.transferDrawingContext=function(t){t.setDrawingContext(this.drawingContext)},dt.getHorizontalData=function(){return this.horizontalData===null&&this.computeHorizontalData(),this.horizontalData},dt.computeHorizontalData=function(){const t=this.getDpq(),s=this.getNbDivisions(),n=this.notes.map(this.extractNoteHorizontalData,this);this.horizontalData=[];const c={dpq:t,entities:n,nbDivisions:s,type:Ne.A.NOTE};this.horizontalData.push(c);const y=this.getAllMelismasAnchors(),N=Qo(this.notes,y,c);this.horizontalData.push.apply(this.horizontalData,N)};function Qo(t,s,n){return Hn(t,{template:n,getDuration(c){return c.getDuration()},getTimePos(c){return c.getTimePos()}},s)}dt.extractNoteHorizontalData=function(t,s){const n=t.getDuration();let c;const y=t.getTimePos();if(this.hasNoteGraces(s)){const lt=this.getNoteGraces(s),Ft=this.drawingContext;xe(t,lt,Ft);const[Kt]=lt;c=-Kt.getXPos()+Kt.calcLeadingSpace()}else c=t.calcLeadingSpace();const N=t.getMiddleHeadWidth()+t.calcTrailingSpace();return{timePos:y,duration:n,spaceBefore:c,spaceAfter:N,isRest:t.isRest()}},dt.computeNoteGracesHorizontalSpace=function(t){const s=this.getNoteGraces(t),n=this.notes[t];xe(n,s)},dt.dispatchHorizontalFormattingForVerticalComputation=function(t){this.horizontalFormatter=t,this.dynamicVerticalData=null,this.nominalFormatNotesHorizontal(),this.tuplets.forEach(Ss),this.internalTies.forEach(jn),this.internalHammerOnPullOffs.forEach(jn)},dt.nominalFormatNotesHorizontal=function(){if(this.hasSingleRest())this.formatSingleRestNominal();else{const t=this.notes.length;this.notes[0].setHorizontalFormatter&&this.notes[0].setHorizontalFormatter(this.horizontalFormatter);for(let s=0;s<t;s++){const n=this.notes[s],c=n.getTimePos(),y=this.timePosToNominalX(c);n.setPosition(y)}}},dt.formatSingleRestNominal=function(){const t=this.notes[0],s=this.horizontalFormatter.getNominalMiddlePos(),n=t.getMiddleHeadWidth()+t.calcTrailingSpace(),c=s-n/2;t.setPosition(c),t.setHorizontalFormatter&&t.setHorizontalFormatter(this.horizontalFormatter)},dt.timePosToNominalX=function(t){const s=this.getDpq();return this.horizontalFormatter.getNominalPosX(t,s)},dt.setHorizontalFormatter=function(t){this.horizontalFormatter=t,this.dynamicVerticalData=null,this.notes[0].setHorizontalFormatter&&this.notes[0].setHorizontalFormatter(t)},dt.formatHorizontal=function(){this.formatNotesHorizontal(),this.beams.forEach(Ss),this.graceBeams.forEach(Ss),this.graceSlurs.forEach(eo),this.tuplets.forEach(Ss),this.internalTies.forEach(jn),this.internalHyphens.forEach(eo),this.glissandos.forEach(Jo),this.slides.forEach(In),this.internalHammerOnPullOffs.forEach(jn)};const eo=function(t){t.updateHorizontalDisplay()},Ss=function(t){t.updateConnections()},jn=function(t){t.updateArcs()},Jo=function(t){t.updateGlissandos()},In=function(t){t.updateSlides()};dt.formatNotesHorizontal=function(){if(this.hasSingleRest())this.formatSingleRest();else{const t=this.notes.length;for(let s=0;s<t;s++){const n=this.notes[s],c=n.getTimePos(),y=this.timePosToX(c);n.setPosition(y)}}},dt.timePosToX=function(t){const s=this.getDpq();return this.horizontalFormatter.getPosX(t,s)},dt.hasSingleRest=function(){return this.notes.length===1&&this.notes[0].isRest()},dt.formatSingleRest=function(){const t=this.notes[0],s=this.horizontalFormatter.getMiddlePos(),n=t.getMiddleHeadWidth()+t.calcTrailingSpace();let c=s-n/2;c-=this.xPos/4,c=Math.max(c,0),t.setPosition(c)},dt.getWidth=function(){return this.horizontalFormatter.getWidth()},dt.setVerticalFormatting=function(t){this.verticalFormatting=t,this.notes[0].setVerticalFormatting&&this.notes[0].setVerticalFormatting()},dt.formatVertical=function(){this.formatNotesVertical(),this.internalHyphens.forEach(Qe),this.notes[0].formatVertical&&this.notes[0].formatVertical()},dt.formatNotesVertical=function(){this.notes.forEach(this.formatNoteVertical,this)},dt.formatNoteVertical=function(t){if(t.hasLyric()){let s;if(this.drawingContext.hasFixedLyricPosition()){const n=this.drawingContext.getFixedLyricLine();s=t.lineToY(n)}else s=this.verticalFormatting.getLyricsY();t.setLyricUpY(s)}};const Qe=function(t){t.updateVerticalDisplay()};dt.draw=function(){this.notes.forEach(Si),this.forEachGrace(Si),this.internalTies.forEach(Si),this.internalHyphens.forEach(Si),this.beams.forEach(Si),this.graceBeams.forEach(Si),this.graceSlurs.forEach(Si),this.tuplets.forEach(Si),this.glissandos.forEach(Si),this.slides.forEach(Si),this.internalHammerOnPullOffs.forEach(Si),this.bindToParent()},dt.drawLyrics=function(){this.notes.forEach(function(t){t.drawLyric()}),this.bindToParent()},dt.bindToParent=function(){this.parent.append(this.group)};const Si=function(t){t.draw(t)};dt.drawCursor=function(t,s){const c=this.getNote(t.noteIdx).getXPos();s.setPosition(c),s.move(),s.setParent(this.group)},dt.drawGraceCursor=function(t,s){const c=this.getNoteGraces(t.noteIdx)[t.graceIdx];let N=this.getNote(t.noteIdx).getXPos();N+=c.getXPos(),s.setPosition(N),s.move(),s.setParent(this.group)},dt.drawDynamicCursor=function(t,s){const c=this.getNote(t.noteIdx).getXPos();s.setPosition(c),s.setParent(this.group),s.draw()},dt.drawPizzicatoCursor=function(t,s){const c=this.getNote(t.noteIdx).getXPos();s.setPosition(c),s.setParent(this.group),s.draw()},dt.drawMuteCursor=function(t,s){const c=this.getNote(t.noteIdx).getXPos();s.setPosition(c),s.setParent(this.group),s.draw()},dt.setNoteColor=function(t,s){this.getNote(t.noteIdx).setHeadColor(t,s)},dt.getStemStrategy=function(){return this.stemStrategy},dt.getNoteX=function(t){return this.getNote(t).getXPos(t)},dt.getNbNotes=function(){return this.notes.length},dt.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()},dt.getStaticVerticalData=function(){return this.staticVerticalData===null&&this.computeStaticVerticalData(),this.staticVerticalData},dt.computeStaticVerticalData=function(){const t=this.getVerticalMelismaData(),s=this.notes.map(this.extractNoteVerticalData,this),n=this.tuplets.map(this.extractTupletVerticalData,this),y=this.getAllGraces().map(this.extractGraceNoteVerticalData,this),N=[].concat(s,n,y,t);this.staticVerticalData=N.reduce(yi)},dt.getVerticalMelismaData=function(){const t=this.getAllMelismasAnchors();if(t.length===0)return[];const s=t.map(y=>y.getHeight());return[{notesUpOverflow:0,notesDownOverflow:0,hasLyric:!0,lyricHeight:Math.max.apply(null,s)}]},dt.extractNoteVerticalData=function(t){const s=t.getYInfos();let n=-s.highestY;n=Math.max(n,0);const c=this.getStaffHeight();let y=s.lowestY-c;y=Math.max(y,0);const N=t.hasLyric();let j=0;return N&&!this.drawingContext.hasFixedLyricPosition()&&(j=t.getLyricHeight()),{notesUpOverflow:n,notesDownOverflow:y,hasLyric:N,lyricHeight:j}},dt.extractGraceNoteVerticalData=function(t){const s=t.getYInfos();let n=-s.highestY;n=Math.max(n,0);const c=this.getStaffHeight();let y=s.lowestY-c;return y=Math.max(y,0),{notesUpOverflow:n,notesDownOverflow:y,hasLyric:!1,lyricHeight:0}},dt.extractTupletVerticalData=function(t){const s=t.getTopY(),n=t.getBottomY(),c=this.getStaffHeight();return{notesUpOverflow:Math.max(-s,0),notesDownOverflow:Math.max(n-c,0),hasLyric:!1,lyricHeight:0}},dt.getDynamicVerticalData=function(){this.dynamicVerticalData===null&&this.computDynamicVerticalData();const t=this.getExternalTiesVerticalData();let s=yi(t,this.dynamicVerticalData);const n=this.getExternalHammerOnPullOffsVerticalData();return s=yi(n,s),s},dt.computDynamicVerticalData=function(){let t=this.internalTies.map(this.extractTieVerticalData,this);t=t.concat(this.internalHammerOnPullOffs.map(this.extractTieVerticalData,this));const s=so();this.dynamicVerticalData=t.reduce(yi,s)},dt.getExternalTiesVerticalData=function(){const s=this.getExternalTies().map(this.extractTieVerticalData,this),n=so();return s.reduce(yi,n)},dt.getExternalHammerOnPullOffsVerticalData=function(){const s=this.getExternalHammerOnPullOffs().map(this.extractTieVerticalData,this),n=so();return s.reduce(yi,n)},dt.extractTieVerticalData=function(t){const s=t.getTopY(),n=Math.max(0,-s),c=t.getBottomY(),y=this.getStaffHeight(),N=Math.max(0,c-y);return{notesUpOverflow:n,notesDownOverflow:N,hasLyric:!1,lyricHeight:0}};const so=function(){return{notesUpOverflow:0,notesDownOverflow:0,hasLyric:!1,lyricHeight:0}},yi=function(t,s){const n=Math.max(t.notesUpOverflow,s.notesUpOverflow),c=Math.max(t.notesDownOverflow,s.notesDownOverflow),y=t.hasLyric||s.hasLyric,N=Math.max(t.lyricHeight,s.lyricHeight);return{notesUpOverflow:n,notesDownOverflow:c,hasLyric:y,lyricHeight:N}};dt.updateHorizontalDisplay=function(){this.notes.forEach(Ao),this.notes.forEach(wt),this.internalTies.forEach(wt),this.internalHyphens.forEach(wt),this.tuplets.forEach(wt),this.internalHammerOnPullOffs.forEach(wt)};const wt=function(t){t.updateHorizontalDisplay()};dt.updateVerticalDisplay=function(){this.notes.forEach(mo),this.internalHyphens.forEach(mo)};const mo=function(t){t.updateVerticalDisplay()},Ao=function(t){t.move()};dt.getStaffHeight=function(){const t=this.drawingContext.getSpaceSize();return(this.getNbStaffLines()-1)*t},dt.getNbStaffLines=function(){const t=this.getStaffData();return R.A.getNbStaffLines(t)},dt.getStaffData=function(){return this.staffData===null&&(this.staffData=R.A.createDefault()),this.staffData},dt.getNote=function(t){const s=this.getNbNotes();if(!Bt.default.isInteger(t)||t<0||t>=s)throw new F.default("NoteIdx",`Bad noteIdx [${t}] in drawer.`);return this.notes[t]},dt.getNoteGraces=function(t){return this.hasNoteGraces(t)?this.graces[t]:[]},dt.hasNoteGraces=function(t){return typeof this.graces[t]!="undefined"&&this.graces[t].length>0},dt.getDpq=function(){return this.dpq},dt.getNbDivisions=function(){return this.nbDivisions},dt.forEachGrace=function(t,s){v.default.forEach(this.graces,function(n,c){c.forEach(t,s)})},dt.getAllGraces=function(){const t=v.default.getValues(this.graces);return Array.prototype.concat.apply([],t)},dt.getExternalTies=function(){const t=[];if(this.hasLeftTieAnchor()){const s=this.getLeftTieAnchor();s.hasTie()&&t.push(s.getTie())}if(this.hasRightTieAnchor()){const s=this.getRightTieAnchor();s.hasTie()&&t.push(s.getTie())}return t},dt.hasRightTieAnchor=function(){return this.rightTieAnchor!==null},dt.getRightTieAnchor=function(){return this.rightTieAnchor},dt.hasLeftTieAnchor=function(){return this.leftTieAnchor!==null},dt.getLeftTieAnchor=function(){return this.leftTieAnchor},dt.getMiddleSlursAnchors=function(){return this.middleSlursAnchors},dt.hasRightBendAnchor=function(t){return typeof this.rightBendAnchorByString[t]!="undefined"},dt.getRightBendAnchor=function(t){return this.rightBendAnchorByString[t]},dt.hasLeftBendAnchor=function(t){return typeof this.leftBendAnchorByString[t]!="undefined"},dt.getLeftBendAnchor=function(t){return this.leftBendAnchorByString[t]},dt.getMiddleBendsAnchors=function(t){return typeof this.middleBendsAnchorsByString[t]!="undefined"?this.middleBendsAnchorsByString[t]:[]},dt.getAllBendsAnchors=function(){const t=v.default.getValues(this.middleBendsAnchorsByString),s=v.default.getValues(this.leftBendAnchorByString);t.push(s);const n=v.default.getValues(this.rightBendAnchorByString);return t.push(n),Array.prototype.concat.apply([],t)},dt.getMelismaAnchorsAtLevel=function(t){return typeof this.melismaAnchorsByLevel[t]!="undefined"?this.melismaAnchorsByLevel[t]:[]},dt.getAllMelismasAnchors=function(){const t=v.default.getValues(this.melismaAnchorsByLevel);return Array.prototype.concat.apply([],t)},dt.hasRightGlissandoAnchor=function(){return this.rightGlissandoAnchor!==null},dt.getRightGlissandoAnchor=function(){return this.rightGlissandoAnchor},dt.hasLeftGlissandoAnchor=function(){return this.leftGlissandoAnchor!==null},dt.getLeftGlissandoAnchor=function(){return this.leftGlissandoAnchor},dt.hasRightSlideAnchor=function(){return this.rightSlideAnchor!==null},dt.getRightSlideAnchor=function(){return this.rightSlideAnchor},dt.hasLeftSlideAnchor=function(){return this.leftSlideAnchor!==null},dt.getLeftSlideAnchor=function(){return this.leftSlideAnchor},dt.hasRightHyphenAnchor=function(){return this.rightHyphenAnchor!==null},dt.getRightHyphenAnchor=function(){return this.rightHyphenAnchor},dt.hasLeftHyphenAnchor=function(){return this.leftHyphenAnchor!==null},dt.getLeftHyphenAnchor=function(){return this.leftHyphenAnchor},dt.getExternalHammerOnPullOffs=function(){const t=[];if(this.hasLeftHammerOnPullOffAnchor()){const s=this.getLeftHammerOnPullOffAnchor();s.hasHammerOnPullOff()&&t.push(s.getHammerOnPullOff())}if(this.hasRightHammerOnPullOffAnchor()){const s=this.getRightHammerOnPullOffAnchor();s.hasHammerOnPullOff()&&t.push(s.getHammerOnPullOff())}return t},dt.hasRightHammerOnPullOffAnchor=function(){return this.rightHammerOnPullOffAnchor!==null},dt.getRightHammerOnPullOffAnchor=function(){return this.rightHammerOnPullOffAnchor},dt.hasLeftHammerOnPullOffAnchor=function(){return this.leftHammerOnPullOffAnchor!==null},dt.getLeftHammerOnPullOffAnchor=function(){return this.leftHammerOnPullOffAnchor},dt.getVoiceIdx=function(){return this.voiceIdx},dt.getInternalTies=function(){return this.internalTies},dt.getMelismaLevels=function(){return v.default.getKeys(this.melismaAnchorsByLevel)};const o=cn;var u=r(282610),E=r(920939);const H="repeat1Bar",ht=function(t){this.init(t)};ht.cssClass="measureRepeat";const ut=ht.prototype;ut.cssClass=ht.cssClass,ut.init=function({staffData:t}){this.staffData=t,this.parentSvg=null,this.noteSvg=new L.A("g"),this.setCssClass(`note ${this.cssClass}`),this.xPos=0,this.localVerticalAlignment=null,this.horizontalShift=0},ut.getStaffData=function(){return this.staffData},ut.getNbStaffLines=function(){const t=this.getStaffData();return R.A.getNbStaffLines(t)},ut.isTabStaff=function(){const t=this.getStaffData();return R.A.isTabStaff(t)},ut.setParent=function(t){this.parentSvg=t},ut.setCssClass=function(t){this.noteSvg.attr("class",t)},ut.getDisplayData=function(){return this.displayData},ut.getGroup=function(){return this.noteSvg},ut.lineToY=function(t){const s=this.drawingContext.getSpaceSize(),n=this.getNbStaffLines();if(this.isTabStaff()){const c=this.drawingContext.getTabSpaceSize();return E.A.lineToTabY(t,s,c,n)}else return E.A.lineToY(t,s,n)},ut.getMiddleHeadWidth=function(){return this.glyph.getWidth()},ut.getPreviousSpace=function(){return this.calcLeadingSpace()},ut.calcLeadingSpace=function(){return this.getLeadingShift()},ut.getLeadingShift=function(){return Math.min(0,this.horizontalShift)*-1},ut.getWidth=function(){return this.getMiddleHeadWidth()+this.calcTrailingSpace()},ut.calcTrailingSpace=function(){return this.getTrailingShift()},ut.getTrailingShift=function(){return Math.max(0,this.horizontalShift)},ut.render=function(t){this.setDrawingContext(t),this.initLocalVerticalAlignment();const s=this.noteSvg.append("g");s.attr("class","head"),this.path=s.append("path"),this.glyph=t.getGlyph(H);const n=this.glyph.render();this.path.attr("d",n)},ut.initLocalVerticalAlignment=function(){const t=this.getMiddleLine();this.localVerticalAlignment={highestY:this.lineToY(t),lowestY:this.lineToY(t),highestTupletY:this.lineToY(t),lowestTupletY:this.lineToY(t)}},ut.getMiddleLine=function(){return(this.getNbStaffLines()-1)/2+1},ut.setDrawingContext=function(t){this.drawingContext=t},ut.getTimePos=function(){return 0},ut.draw=function(){this.move(),this.bindToParent()},ut.hasLyric=function(){return!1},ut.drawLyric=function(){},ut.bindToParent=function(){this.parentSvg&&this.parentSvg.append(this.noteSvg)},ut.unbindFromParent=function(){this.noteSvg.removeFromParent()},ut.getMarginSize=function(){return this.drawingContext.getMarginSize()},ut.setPosition=function(t){this.xPos=t},ut.move=function(){const t=this.getXPos();this.noteSvg.attr("transform",`translate(${t} 0)`);const s=this.getYPos();this.path.attr("transform",`translate(0 ${s})`)},ut.getXPos=function(){return this.xPos+this.horizontalShift},ut.getYPos=function(){const t=this.getMiddleLine();let s=this.lineToY(t);return s+=this.drawingContext.getStaffLineThickness()/2,s},ut.getDuration=function(){return 1},ut.isRest=function(){return!0},ut.getLocalHighestY=function(){return this.localVerticalAlignment.highestY},ut.getLocalLowestY=function(){return this.localVerticalAlignment.lowestY},ut.getHighestTupletY=function(){return Math.min(this.localVerticalAlignment.highestY,this.localVerticalAlignment.highestTupletY)},ut.getLowestTupletY=function(){return Math.max(this.localVerticalAlignment.lowestY,this.localVerticalAlignment.lowestTupletY)},ut.getHighestYWithMarge=function(){const t=this.getHighestY(),s=this.drawingContext.getSpaceSize();return t-.5*s},ut.getHighestY=function(){return this.getVerticalAlignment().highestY},ut.getLowestYWithMarge=function(){const t=this.getLowestY(),s=this.drawingContext.getSpaceSize();return t+.5*s},ut.getLowestY=function(){return this.getVerticalAlignment().lowestY},ut.getVerticalAlignment=function(){return this.localVerticalAlignment},ut.setHighestY=function(t){const s=this.localVerticalAlignment.highestY,n=Math.min(s,t);this.localVerticalAlignment.highestY=n},ut.setLowestY=function(t){const s=this.localVerticalAlignment.lowestY,n=Math.max(s,t);this.localVerticalAlignment.lowestY=n},ut.setHighestYLine=function(t){const s=this.lineToY(t);this.setHighestY(s)},ut.setLowestYLine=function(t){const s=this.lineToY(t);this.setLowestY(s)},ut.setHighestLowestY=function(t){this.setHighestY(t),this.setLowestY(t)},ut.setHighestLowestYLine=function(t){this.setHighestYLine(t),this.setLowestYLine(t)},ut.getYInfos=function(){return(0,P.default)(this.localVerticalAlignment)},ut.updateVerticalDisplay=function(){},ut.updateHorizontalDisplay=function(){},ut.setHorizontalShift=function(t){this.horizontalShift=t},ut.getHorizontalShift=function(){return this.horizontalShift};const Jt=ht,se=function(t,s){const n={above:[],below:[]};return we(n,t,s),ki(n,t),n};function we(t,s,n){const c=s.getXPos()+Pn(s);n.forEach(function(y){const N=y.getXPos(),j=c+N,lt=qe(y),Ft={x:j,y:lt,type:"note"};t.above.push(Ft);const Kt=qi(y),Se={x:j,y:Kt,type:"note"};t.below.push(Se)})}function ki(t,s){const n=s.getXPos()+Pn(s),c=qe(s),y={x:n,y:c,type:"note"};t.above.push(y);const N=qi(s),j={x:n,y:N,type:"note"};t.below.push(j)}const qe=function(t){const s=t.getDisplayData().getHighestLine();return t.lineToY(s+1)},qi=function(t){const s=t.getDisplayData().getLowestLine();return t.lineToY(s-1)},Pn=function(t){return t.getMiddleHeadWidth()/2},Yn=se;var Ks=r(680285);class Qn{constructor(s,n){Object.defineProperty(this,"cssClass",{enumerable:!0,configurable:!0,writable:!0,value:"slur"}),this.drawingContext=null,this.curve=new Ks.A,this.note=s,this.graces=n,this.stemStrategy=It.A.DOWN}setCurveData(){const n=this.stemStrategy,c=Yn(this.note,this.graces);this.curve.setData(c.above,c.below,void 0,n)}setDrawingContext(s){this.drawingContext=s,this.curve.setDrawingContext(this.drawingContext)}isRendered(){return this.curve.isRendered()}render(){this.curve.render()}setParent(s){this.curve.setParent(s)}draw(){this.setCurveData(),this.curve.draw()}updateHorizontalDisplay(){this.isRendered()||this.render(),this.setCurveData(),this.curve.draw()}}var kt=r(123491);const ui=function(){this.init()},io=ui.prototype;io.init=function(){this.voice=null,this.measureJson=null,this.voiceNotes=null},io.build=function(t,s,n,c){this.voice=t,this.voiceNotes=n,this.measureJson=c,this.voiceIdx=s,this.addMiddleAnchors()},io.addMiddleAnchors=function(){const t=this.voiceNotes.length;for(let s=0;s<t;s++){const n=this.voiceNotes[s].chordJson[0];if(rr(n)){const c=fi(n);this.addMiddleAnchor(c,s)}}};const rr=function(t){return kt.default.hasSlur(t)},fi=function(t){return kt.default.getSlur(t)};io.addMiddleAnchor=function(t,s){const n=Qt.default.getType(t);let c;if(n===zt.A.START){const y=Qt.default.getUuid(t),N=Qt.default.getPlacement(t);c=new hn.A(n,s,this.voiceIdx,y,N)}else c=new hn.A(n,s,this.voiceIdx);this.voice.addMiddleSlurAnchor(c)};const Yr=ui;var He=r(476943),Fe=r(316826),wn=r(648920);const no={UP:1,DOWN:2,HORIZ:3},_e=function(t){this.init(t)},Ae=_e.prototype;Ae.init=function(t){this.stemValue=null,this.notes=[],this.avgLines=null,this.beamInnerDuration=null,this.opts=t},Ae.addNote=function(t){this.notes.push(t),t.setBeamData(this)},Ae.setStemValue=function(t){if(t!==ge.A.UP&&t!==ge.A.DOWN)throw new F.default("unexpected");this.stemValue=t},Ae.getStemValue=function(){return this.stemValue===null&&this.calcStemValue(),this.stemValue},Ae.assertNotTabStaff=function(){if(this.isTabStaff()){const t="Stem direction must be defined for beams on tab staff.";throw new F.default("Unexpected",t)}},Ae.assertNotKodalyStaff=function(){if(this.isKodalyStaff()){const t="Stem direction must be defined for beams on kodaly staff.";throw new F.default("Unexpected",t)}},Ae.getStemCoeff=function(){return this.getStemValue()===ge.A.UP?1:-1},Ae.calcStemValue=function(){this.isStemDefined()?this.isStemConsistent():(this.assertNotTabStaff(),this.assertNotKodalyStaff(),this.inferStemFromLines())},Ae.isStemDefined=function(){return typeof this.stemDefined=="undefined"&&this.parseStemDefinition(),this.stemDefined},Ae.isStemConsistent=function(){return typeof this.stemConsistent=="undefined"&&this.parseStemDefinition(),this.stemConsistent},Ae.parseStemDefinition=function(){this.stemDefined=!1,this.stemConsistent=!0;let t=0;for(;t<this.notes.length&&this.stemConsistent;){const s=this.notes[t];s.isStemSpecified()&&(this.stemDefined?s.getSpecifiedStem()!==this.stemValue&&(this.stemConsistent=!1):(this.stemDefined=!0,this.stemValue=s.getSpecifiedStem())),t++}},Ae.inferStemFromLines=function(){const t=this.getGlobalLineAvg();this.getDisplayedNbStaffLines()===1&&t===3?this.stemValue=ge.A.UP:t>=3?this.stemValue=ge.A.DOWN:this.stemValue=ge.A.UP},Ae.getGlobalLineAvg=function(){return this.getAvgLines().reduce(function(c,y){return c+y})/this.notes.length},Ae.getAvgLines=function(){return this.avgLines===null&&this.calcAvgLines(),this.avgLines},Ae.calcAvgLines=function(){this.avgLines=this.notes.map(function(t){return t.getLineAvg()})},Ae.computeStemQueueLines=function(){this.isHorizontal()?this.computeStemQueuesLinesHorizontal():this.computeStemQueuesLinesNonHorizontal()},Ae.isHorizontal=function(){return this.isTabStaff()||this.isKodalyStaff()||this.areFirstAndLastLinesSame()||this.isMajoritySameLine()?!0:!!this.isChaotic()},Ae.isTabStaff=function(){return this.opts.isTabStaff},Ae.isKodalyStaff=function(){return this.opts.isKodalyStaff},Ae.areFirstAndLastLinesSame=function(){const t=this.getAvgLines(),s=t[0],n=t.length-1,c=t[n];return s===c},Ae.isMajoritySameLine=function(){const t=this.getAvgLines();if(t.length<4)return!1;const s=t.reduce(function(c,y){return typeof c[y]=="undefined"&&(c[y]=0),c[y]++,c},{});return ar(s)>=t.length/2};const ar=function(t){let s=0;for(const n in t){const c=t[n];s=Math.max(s,c)}return s};Ae.isChaotic=function(){return!1},Ae.getDirection=function(){const t=this.getGlobalLineAvg(),s=t[0],n=t.length-1,c=t[n];return s>c?no.DOWN:no.UP},Ae.computeStemQueuesLinesHorizontal=function(){const t=this.getFarestStemQueueLine();this.applyMaxQueueLine(t)},Ae.getFarestStemQueueLine=function(){const t=this.getOrphanStemQueueLines(),s=this.getStemValue();return t.reduce(function(c,y){return s===ge.A.UP?Math.max(c,y):Math.min(c,y)})},Ae.getOrphanStemQueueLines=function(){return this.notes.map(function(s){return s.getSingleNoteStemQueueLine()})},Ae.applyMaxQueueLine=function(t){this.notes.forEach(function(s){s.stemQueueLine=t})},Ae.computeStemQueuesLinesNonHorizontal=function(){this.initNotesStemQueueLine(),this.isBeamTooOblic()&&this.flattenBeam();const t=this.getRequiredStemOffset();this.applyOffset(t),this.alignQueuesToBeam()},Ae.initNotesStemQueueLine=function(){this.notes.forEach(ii)};const ii=function(t){const s=t.getSingleNoteStemQueueLine();t.stemQueueLine=s};Ae.isBeamTooOblic=function(){const t=this.notes[0].getStemQueueLine(),s=this.notes.length-1,n=this.notes[s].getStemQueueLine();return Math.abs(t-n)>.5},Ae.flattenBeam=function(){const t=this.getBeamExternalEndNote();let n=this.getBeamInternalEndNote().getStemQueueLine();n+=.5*this.getStemCoeff(),t.stemQueueLine=n},Ae.getBeamExternalEndNote=function(){const t=this.notes[0],s=t.getStemQueueLine(),n=this.notes.length-1,c=this.notes[n],y=c.getStemQueueLine();return hr(s,y,this.getStemValue())?t:c},Ae.getBeamInternalEndNote=function(){const t=this.notes[0],s=t.getStemQueueLine(),n=this.notes.length-1,c=this.notes[n],y=c.getStemQueueLine();return hr(s,y,this.getStemValue())?c:t};const hr=function(t,s,n){return n===ge.A.UP&&t>s?!0:n===ge.A.DOWN&&t<s};Ae.getRequiredStemOffset=function(){let t=0;const s=this.getStemValue();return this.notes.reduce(function(c,y){const N=this.calcQueueForTick(t),j=this.calcRequiredQueueLineInBeam(y);s===ge.A.UP?c=Fr(j,N,c):c=as(j,N,c);const lt=yo(y);return t+=lt,c}.bind(this),0)},Ae.calcRequiredQueueLineInBeam=function(t){const s=t.getTailHeadLine(),n=t.getNbFlagsOrBeams();let c;return n===1?c=2.5:c=1+n,t.hasTremolo()&&(c+=t.getNbOrnaments()),s+c*this.getStemCoeff()};const Fr=function(t,s,n){return s+n<t&&(n=t-s,n=So(n)),n},So=function(t){return t*=2,t=Math.ceil(t),t/=2,t},as=function(t,s,n){return s+n>t&&(n=t-s,n=Wr(n)),n},Wr=function(t){return t*=2,t=Math.floor(t),t/=2,t};Ae.calcQueueForTick=function(t){const s=this.getBeamInnerDuration(),c=this.notes[0].getStemQueueLine(),y=this.notes.length-1,j=this.notes[y].getStemQueueLine();return c+t*(j-c)/s},Ae.getBeamInnerDuration=function(){return this.beamInnerDuration===null&&this.calcBeamInnerDuration(),this.beamInnerDuration},Ae.calcBeamInnerDuration=function(){const t=this.getDurations(),s=t.slice(0,t.length-1);this.beamInnerDuration=s.reduce(function(n,c){return n+c})},Ae.getDurations=function(){return this.notes.map(yo)};const yo=function(t){return t.isGrace()?1:t.getDuration()};Ae.applyOffset=function(t){const s=this.notes[0];s.stemQueueLine+=t;const n=this.notes.length-1,c=this.notes[n];c.stemQueueLine+=t},Ae.getDirectionCoeff=function(){return this.getStemValue()===ge.A.UP?1:-1},Ae.alignQueuesToBeam=function(){if(this.notes.length>2){const t=this.notes[0];let s=yo(t);this.notes.slice(1,this.notes.length-1).forEach(function(c){const y=this.calcQueueForTick(s);c.stemQueueLine=y;const N=yo(c);s+=N},this)}},Ae.getTicks=function(){const t=this.getDurations();let s=0;return t.map(function(c){const y=s;return s+=c,y})},Ae.getDisplayedNbStaffLines=function(){const t=this.getStaffData();return R.A.getDisplayedNbStaffLines(t)},Ae.getStaffData=function(){return this.opts.staffData};const Gr=_e,Ur=.75,Po="noteheadBlack",wo=function(t){this.init(t)},ts=wo.prototype;ts.init=function(t){this.notes=[],this.displayData=new Gr(t),this.opts=t||{},this.parent=null,this.svgGroup=new L.A("g"),this.drawnBeams=[],this.drawingContext=null,this.headWidth=null,this.blackHeadWidth=null,this.currentBeams={}},ts.setParent=function(t){this.parent=t},ts.addNote=function(t){this.notes.push(t),t.beam=this,this.displayData.addNote(t.getDisplayData())},ts.setDrawingContext=function(t){this.drawingContext=t},ts.forceStemValue=function(t){this.displayData.setStemValue(t)},ts.draw=function(){this.parent&&this.bindToParent()},ts.bindToParent=function(){this.parent.append(this.svgGroup)},ts.updateConnections=function(){this.hasConnections()&&this.removeConnections(),this.renderConnections()},ts.hasConnections=function(){return this.drawnBeams.length>0},ts.removeConnections=function(){for(;this.drawnBeams.length>0;)this.drawnBeams.shift().removeFromParent()},ts.renderConnections=function(){this.slopeCoeff=null,this.notes.forEach(function(t){const s=t.getDisplayData();if(this.queueLine=s.getStemQueueLine(),this.xPos=t.getXPos(),this.isTabStaff()){const n=t.getFretsWidth(),c=this.drawingContext.getStemThickness();this.xPos+=n/2-c/2}else if(this.isKodalyStaff()){const n=t.getMiddleHeadWidth(),c=this.drawingContext.getStemThickness();this.xPos+=n/2-c/2}else if(this.displayData.getStemValue()===ge.A.UP){const n=t.getLeftStemX();this.xPos+=n}this.drawSegment(s,t)},this)},ts.drawSegment=function(t,s){t.getBeams().forEach(function(c){const y=wn.A.getType(c),N=wn.A.getNumber(c);y===Fe.A.CONTINUE||(y===Fe.A.BEGIN?this.startBeam(c,s):y===Fe.A.END?this.stopBeam(c,s):y===Fe.A.FORWARD?this.drawForwardHook(N,s):y===Fe.A.BACKWARD?this.drawBackwardHook(N,s):Fe.A.raiseError(y))},this)},ts.startBeam=function(t,s){const n=wn.A.getNumber(t),c=this.drawingContext.getBeamSpacingRatio(),y=this.drawingContext.getBeamThicknessRatio(),N=this.getStemCoeff(),j=this.getSizeCoeff(),lt=this.queueLine-n*(c+y)*N*j,Ft=lt-N*y*j,Kt={x1:this.xPos,x2:this.xPos,y1:this.lineToY(lt),y2:this.lineToY(Ft)};if(wn.A.isTremolo(t)){const Se=this.getNoteHeadWidth(s);Kt.x1+=Se/2,Kt.x2+=Se/2}this.currentBeams[n]=Kt},ts.stopBeam=function(t,s){const n=wn.A.getNumber(t),c=this.drawingContext.getBeamSpacingRatio(),y=this.drawingContext.getBeamThicknessRatio(),N=this.getStemCoeff(),j=this.getSizeCoeff(),lt=this.queueLine-n*(c+y)*N*j,Ft=lt-N*y*j,Kt=this.currentBeams[n];delete this.currentBeams[n];const Se=this.svgGroup.append("polygon");let ke=this.xPos;if(wn.A.isTremolo(t)){const gn=this.getNoteHeadWidth(s);ke-=gn/2}const Cs=`${Kt.x1},${Kt.y1} ${Kt.x2},${Kt.y2} ${ke},${this.lineToY(Ft)} ${ke},${this.lineToY(lt)} `;Se.attr("points",Cs),this.drawnBeams.push(Se)},ts.drawForwardHook=function(t,s){const n=this.drawingContext.getBeamSpacingRatio(),c=this.drawingContext.getBeamThicknessRatio(),y=this.getStemCoeff(),N=this.getSizeCoeff(),j=this.queueLine-t*(n+c)*y*N,lt=j-y*c*N,Ft=this.xPos;let Kt;this.displayData.getStemValue()===ge.A.UP?Kt=this.getBlackHeadWidth():Kt=this.getNoteHeadWidth(s);const Se=this.xPos+Kt,ke=this.lineToY(j),Cs=this.lineToY(lt),Ln=this.getSlopeCoeff()*Kt,Zn=ke+Ln,lo=Cs+Ln,En=this.svgGroup.append("polygon"),Fo=`${Ft},${ke} ${Ft},${Cs} ${Se},${lo} ${Se},${Zn} `;En.attr("points",Fo),this.drawnBeams.push(En)},ts.drawBackwardHook=function(t,s){const n=this.drawingContext.getBeamSpacingRatio(),c=this.drawingContext.getBeamThicknessRatio(),y=this.getStemCoeff(),N=this.getSizeCoeff(),j=this.queueLine-t*(n+c)*y*N,lt=j-y*c*N;let Ft;this.displayData.getStemValue()===ge.A.DOWN?Ft=this.getBlackHeadWidth():Ft=this.getNoteHeadWidth(s);const Kt=this.xPos,Se=this.xPos-Ft,ke=this.lineToY(j),Cs=this.lineToY(lt),Ln=this.getSlopeCoeff()*-Ft,Zn=ke+Ln,lo=Cs+Ln,En=this.svgGroup.append("polygon"),Fo=`${Kt},${ke} ${Kt},${Cs} ${Se},${lo} ${Se},${Zn} `;En.attr("points",Fo),this.drawnBeams.push(En)},ts.getBlackHeadWidth=function(){if(this.blackHeadWidth===null){let t;if(this.isGrace()){const s=this.drawingContext.getGraceSizeCoeff();t=this.drawingContext.getScaledGlyph(Po,s)}else t=this.drawingContext.getGlyph(Po);this.blackHeadWidth=t.getWidth()}return this.blackHeadWidth},ts.getNoteHeadWidth=function(t){return this.isTabStaff()?t.getFretsWidth():this.isKodalyStaff()?this.drawingContext.getSpaceSize():t.getMiddleHeadWidth()},ts.getSizeCoeff=function(){return this.isGrace()?Ur:1},ts.getSlopeCoeff=function(){if(this.slopeCoeff===null)if(this.isTabStaff()||this.isKodalyStaff())this.slopeCoeff=0;else{const t=this.notes[0],s=this.notes.length-1,n=this.notes[s];this.slopeCoeff=this.calcSlope(t,n)}return this.slopeCoeff},ts.calcSlope=function(t,s){const n=t.getXPos(),y=t.getDisplayData().getStemQueueLine(),N=this.lineToY(y),j=s.getXPos(),Ft=s.getDisplayData().getStemQueueLine(),Kt=this.lineToY(Ft),Se=j-n;return(Kt-N)/Se},ts.lineToY=function(t){const c=this.notes[0].getDisplayData().getNbStaffLines(),y=this.drawingContext.getSpaceSize();if(this.isTabStaff()){const N=this.drawingContext.getTabSpaceSize();return E.A.lineToTabY(t,y,N,c)}else return E.A.lineToY(t,y,c)},ts.isTabStaff=function(){return this.opts.isTabStaff},ts.isKodalyStaff=function(){return this.opts.isKodalyStaff},ts.getStemCoeff=function(){return this.displayData.getStemCoeff()},ts.isGrace=function(){return this.opts.isGrace||!1};const Zo=wo,ze=function(t){this.init(t)};ze.prototype.init=function(t){this.voiceId="1",this.beamNumber=0,this.beamType="",this.renderedNote=null,this.container=t,this.beamNotes={}},ze.prototype.canProcess=function(t){return t=He.default.makeArray(t),t.some(kt.default.hasBeam)||t.some(kt.default.hasTremoloSide)},ze.prototype.addNote=function(t,s){t=zr(t),this.voiceId=kt.default.getVoiceId(t),this.renderedNote=s;const n=kr(t);this.processBeams(n)};const zr=function(t){return t=He.default.makeArray(t),t.find(n=>kt.default.hasBeam(n)||kt.default.hasTremoloSide(n))};function kr(t){if(kt.default.hasBeam(t))return He.default.makeArray(t.beam);const s=0;if(kt.default.hasTremoloStart(t))return[wn.A.createBegin(s)];if(kt.default.hasTremoloStop(t))return[wn.A.createEnd(s)];throw new F.default("Unexpected")}ze.prototype.processBeams=function(t){t.forEach(this.processBeam,this)},ze.prototype.processBeam=function(t){this.extractBeamData(t),this.beamNumber==="1"&&(this.beamType===Fe.A.BEGIN?this.beginBeam():this.beamType===Fe.A.CONTINUE?this.continueBeam():this.endBeam())},ze.prototype.beginBeam=function(){this.beamNotes[this.voiceId]=[],this.beamNotes[this.voiceId].push(this.renderedNote)},ze.prototype.continueBeam=function(){typeof this.beamNotes[this.voiceId]!="undefined"&&this.beamNotes[this.voiceId].push(this.renderedNote)},ze.prototype.endBeam=function(){const t=this.beamNotes[this.voiceId];t.push(this.renderedNote);const s={isTabStaff:this.renderedNote.isTabStaff(),isKodalyStaff:this.renderedNote.isKodalyStaff(),staffData:this.renderedNote.getStaffData()},n=new Zo(s);t.forEach(function(c){n.addNote(c)}),this.container.addBeam(n),this.beamNotes[this.voiceId]=null},ze.prototype.extractBeamData=function(t){this.beamNumber=ze.getBeamNumber(t),this.beamNumber==="1"?this.beamType=ze.getBeamType(t):this.beamType=null},ze.getBeamNumber=function(t){return t.$number.toString()};const Do=He.default.arrayToSet([Fe.A.BEGIN,Fe.A.CONTINUE,Fe.A.END]);ze.getBeamType=function(t){if(Do[t.content])return t.content;throw new Error(`the beam type ${t.content} in not recognized`)};const ys=ze;var cr=r(188075),Xr=r(866205),Fn=r(130452);const Co=function(){this.init()};Co.cssClass="tie";const Ps=Co.prototype;Ps.cssClass=Co.cssClass,Ps.init=function(){this.arcs=null,this.displayData=new Xr.A,this.drawingContext=null,this.parent=null,this.svgGroup=new L.A("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!1},Ps.setParent=function(t){this.parent=t},Ps.setLeftNote=function(t){this.leftNote=t,this.displayData.setLeftNote(t.getDisplayData())},Ps.setRightNote=function(t){this.rightNote=t,this.displayData.setRightNote(t.getDisplayData())},Ps.setDrawingContext=function(t){this.drawingContext=t},Ps.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},Ps.initArcs=function(){this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},Ps.initArc=function(t){const s=this.leftNote.getMiddleHeadWidth(),n=Fn.A.getLeft(t,s),c=this.rightNote.getMiddleHeadWidth(),y=Fn.A.getRight(t,c),N=0,j=new cr.A(this.getGroup(),n,y,t.placement,N),lt=R.A.getNbStaffLines(t.staffData),Ft=R.A.isTabStaff(t.staffData);let Kt=this.lineToY(t.line,Ft,lt);Kt+=Fn.A.getVertical(t,this.drawingContext),j.setPosY(Kt),j.setDrawingContext(this.drawingContext),this.arcs.push(j)},Ps.lineToY=function(t,s,n){const c=s?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return E.A.lineToY(t,c,n)},Ps.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},Ps.updateArc=function(t){const s=this.drawingContext.getTieHorizontalMargin(),n=this.leftNote.getXPos()+s,y=this.rightNote.getXPos()-s-n,j=Lt()(y);t.setSize(y,j),t.setPosX(n)},Ps.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},Ps.draw=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach(Vr),this.bindToParent()};const Vr=function(t){t.draw()};Ps.bindToParent=function(){this.parent.append(this.getGroup())},Ps.getGroup=function(){return this.svgGroup};let Dn=null;const Lt=function(){if(Dn===null){const s=.6666666666666666,y=Bt.default.solveLinearA(3,s,30,2),N=Bt.default.solveLinearB(3,s,y);Dn=function(j){return y*j+N}}return Dn};Ps.updateHorizontalDisplay=function(){this.needDrawUpdate&&this.updateArcs(),this.getArcs().forEach($r)};const $r=function(t){t.updateHorizontalDisplay()};Ps.getTopY=function(){const t=this.getTopArc(),s=t.getTopY();return t.posY+s},Ps.getTopArc=function(){return this.getArcs()[0]},Ps.getBottomY=function(){const t=this.getBottomArc(),s=t.getBottomY();return t.posY+s},Ps.getBottomArc=function(){const t=this.getArcs(),s=t.length-1;return t[s]};const qo=Co,di={START:"start",STOP:"stop"};var xo=r(191581);const lr=function(t,s){this.init(t,s)},js=lr.prototype;js.init=function(t,s){this.measure=null,this.note=t,this.type=s,this.leftNote=null,this.rightNote=null,this.tie=null,this.type!==di.START&&this.type!==di.STOP&&ur(s)},js.getNote=function(){return this.note},js.setMeasure=function(t){this.measure=t},js.hasTie=function(){return this.tie!==null},js.hasLeftTie=function(){if(this.type===di.START){const t="A begin anchor cannot have a tie incoming from the left";throw new F.default("BadTieQuery",t)}else return this.hasTie()?this.getTie().getType()===xo.A.LEFT:!1},js.hasCrossMeasureTie=function(){return this.hasTie()?this.getTie().getType()===xo.A.CROSS_MEASURE:!1},js.setTie=function(t){this.tie=t},js.getTie=function(){return this.tie},js.removeTie=function(){this.type===di.START?this.tie.removeLeftAnchor():this.type===di.STOP?this.tie.removeRightAnchor():ur(this.type)};const ur=function(t){const s=`The anchor type [${t}] is invalid.`;throw new F.default("Unreachable",s)};js.setNeedDrawUpdate=function(){this.hasTie()&&this.getTie().setNeedDrawUpdate()},js.setRightNote=function(t){this.rightNote=t},js.setLeftNote=function(t){this.leftNote=t},js.hasRightNote=function(){return this.rightNote!==null},js.hasLeftNote=function(){return this.leftNote!==null},js.getRightNote=function(){return this.rightNote},js.getLeftNote=function(){return this.leftNote};const fr=lr,dr=function(t){this.init(t)},tn=dr.prototype;tn.init=function(t){this.container=t,this.leftNote=null},tn.canProcess=function(t){return t=He.default.makeArray(t),tr(t)};const tr=function(t){return t.some(kt.default.hasTie)};tn.addInternalNote=function(t,s){if(t=He.default.makeArray(t),vo(t)){this.leftNote=null;return}gr(t)&&this.addStop(s),Ls(t)&&this.addStart(s)},tn.addStart=function(t){this.leftNote=t},tn.addStop=function(t){if(this.hasLeftNote()){const s=new qo;s.setLeftNote(this.leftNote),s.setRightNote(t),this.container.addTie(s),this.leftNote=null}},tn.hasLeftNote=function(){return this.leftNote!==null},tn.addFirstNote=function(t,s,n){t=He.default.makeArray(t),!(vo(t)||n&&(n.isSlash()||n.isRhythmic()))&&gr(t)&&this.addStopAnchor(s,n)},tn.addLastNote=function(t,s,n){t=He.default.makeArray(t),!(vo(t)||n&&(n.isSlash()||n.isRhythmic()))&&Ls(t)&&this.addStartAnchor(s,n)};function vo(t){const[s]=t;return s.isSlash||s.isRhythmic}const Ls=function(t){return t.some(kt.default.hasTieStart)},gr=function(t){return t.some(kt.default.hasTieStop)};tn.addStopAnchor=function(t,s){const n=new fr(t,di.STOP);n.setLeftNote(s),this.container.setLeftTieAnchor(n)},tn.addStartAnchor=function(t,s){const n=new fr(t,di.START);n.setRightNote(s),this.container.setRightTieAnchor(n)};const Kr=dr;var e=r(50060),i=r(711527);const g=function(t){this.init(t)};g.cssClass="internalHyphen";const O=g.prototype;O.cssClass=g.cssClass,O.init=function(t){this.hyphens=null,this.positionsMap=t,this.drawingContext=null,this.parent=null,this.svgGroup=new L.A("g"),this.svgGroup.attr("class",this.cssClass)},O.setParent=function(t){this.parent=t},O.setLeftNote=function(t){this.leftNote=t},O.setRightNote=function(t){this.rightNote=t},O.setDrawingContext=function(t){this.drawingContext=t},O.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.updateHyphensHorizontal(),this.drawHyphens(),this.bindToParent()},O.updateHyphensHorizontal=function(){this.forEachHyphen(this.updateHyphenHorizontal,this)},O.updateHyphenHorizontal=function(t,s){let n=this.leftNote.getXPos();if(this.leftNote.hasLyricLevel(t)){const N=this.leftNote.getMiddleHeadWidth(),j=this.leftNote.getLyricLevelWidth(t);n+=N/2+j/2}let c=this.rightNote.getXPos();if(this.rightNote.hasLyricLevel(t)){const N=this.rightNote.getMiddleHeadWidth(),j=this.rightNote.getLyricLevelWidth(t);c-=j/2-N/2}const y=c-n;s.setWidth(y),s.setPosX(n)},O.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.updateHyphensVertical(),this.drawHyphens(),this.bindToParent()},O.isRendered=function(){return this.svgGroup!==null},O.render=function(){this.svgGroup=new L.A("g"),this.svgGroup.attr("class",this.cssClass)},O.updateHyphensVertical=function(){this.forEachHyphen(this.updateHyphenVertical,this)},O.updateHyphenVertical=function(t,s){const n=this.getLevelPosY(t);s.setPosY(n)},O.getLevelPosY=function(t){if(this.leftNote.hasLyricLevel(t))return this.leftNote.getLyricLevelPosY(t);if(this.rightNote.hasLyricLevel(t))return this.rightNote.getLyricLevelPosY(t);{const s=`There should be at least one lyric side at the level [${t}].`;throw new F.default("Unexpected",s)}},O.drawHyphens=function(){this.forEachHyphen(X)},O.forEachHyphen=function(t,s){const n=this.getHyphens();v.default.forEach(n,t,s)},O.getHyphens=function(){return this.hyphens===null&&this.initHyphens(),this.hyphens},O.initHyphens=function(){this.hyphens=v.default.map(this.positionsMap,this.initHyphen,this)},O.initHyphen=function(t,s){const n=new i.A(s);return n.setDrawingContext(this.drawingContext),n.setParent(this.svgGroup),n};const X=function(t,s){s.draw()};O.draw=function(){this.bindToParent()},O.bindToParent=function(){this.parent.append(this.getGroup())},O.getGroup=function(){return this.svgGroup};const ft=g;var Ut=r(491197),Zt=r(72456),De=r(410199);const Ie=function(t){this.init(t)},me=Ie.prototype;me.init=function(t){this.container=t,this.leftNote=null},me.canProcess=function(t,s){return!!(this.canProcessRight(t)||this.canProcessLeft(s))},me.canProcessRight=function(t){return ni(t).some(e.default.hasRightConnection)},me.canProcessLeft=function(t){return ni(t).some(e.default.hasLeftConnection)},me.addConnection=function(t,s,n,c){const y=Qs(t,n),N=v.default.map(y,Ut.A),j=new ft(N);j.setLeftNote(s),j.setRightNote(c),this.container.addHyphen(j)};const Qs=function(t,s){const n={};let c=ni(t);c=c.filter(e.default.hasRightConnection),c.forEach(To,n);let y=ni(s);return y=y.filter(e.default.hasLeftConnection),y.forEach(er,n),n},ni=function(t){return t=oo(t),kt.default.getLyrics(t)},oo=function(t){return t=He.default.makeArray(t),t=t[0],t},To=function(t){const s=this,n=e.default.getLevel(t),c=Lo(s,n);c.left=!0},er=function(t){const s=this,n=e.default.getLevel(t),c=Lo(s,n);c.right=!0},Lo=function(t,s){return typeof t[s]=="undefined"&&(t[s]={left:!1,right:!1}),t[s]};me.addLeftAnchor=function(t){const s=new Zt.A(t,De.A.RIGHT);this.container.setLeftHyphenAnchor(s)},me.addRightAnchor=function(t){const s=new Zt.A(t,De.A.LEFT);this.container.setRightHyphenAnchor(s)};const jr=Ie;var ro=r(331537),Qr=r(752670);const Aa=function(t){this.init(t)},Jr=Aa.prototype;Jr.init=function(t){this.container=t,this.previousMelismas={}},Jr.startVoice=function(){this.previousMelismas={}},Jr.process=function(t,s,n,c){let y=sc(t);if(y=y.filter(e.default.hasMelisma),y.length===0)return;const N={};y.forEach(j=>{const lt=e.default.getLevel(j);if(e.default.isContinuedMelisma(j)){const Ft=new Qr.A({renderedNote:s,pos:ro.A.RIGHT,level:lt,isFirstNote:n,isContinued:!0});this.container.addMelismaAnchor(lt,Ft),N[lt]=!0}else if(e.default.hasLeftMelisma(j)){const Ft=new Qr.A({renderedNote:s,pos:ro.A.RIGHT,level:lt,isFirstNote:n});this.container.addMelismaAnchor(lt,Ft),N[lt]=!0}else if(e.default.hasRightMelisma(j)){N[lt]=!0;const Ft=new Qr.A({renderedNote:s,pos:ro.A.LEFT,level:lt,isLastNote:c});this.container.addMelismaAnchor(lt,Ft),N[lt]=!0}}),this.previousMelismas=N};const sc=function(t){return t=ic(t),kt.default.getLyrics(t)},ic=function(t){return t=He.default.makeArray(t),t=t[0],t},nc=Aa;var Eo=r(870437),sr=r(209175);const ao={UP:"up",HORIZONTAL:"horizontal",DOWN:"down"},Sa=function(){this.direction=null,this.init()},Cn=Sa.prototype;Cn.init=function(){this.notes=[],this.avgLines=null,this.slant=null},Cn.addNote=function(t){this.notes.push(t)},Cn.getSlant=function(){return this.slant===null&&this.computeSlant(),this.slant},Cn.computeSlant=function(){if(this.isHorizontal())this.slant=ao.HORIZONTAL;else{const t=this.getAvgLines(),s=t[0],n=t.length-1,c=t[n];s>c?this.slant=ao.DOWN:this.slant=ao.UP}},Cn.isHorizontal=function(){return this.areFirstAndLastLinesSame()||this.isMajoritySameLine()?!0:!!this.isChaotic()},Cn.areFirstAndLastLinesSame=function(){const t=this.getAvgLines(),s=t[0],n=t.length-1,c=t[n];return s===c},Cn.isMajoritySameLine=function(){const t=this.getAvgLines();if(t.length<4)return!1;const s=t.reduce(function(c,y){return typeof c[y]=="undefined"&&(c[y]=0),c[y]++,c},{});return oc(s)>=t.length/2};const oc=function(t){let s=0;for(const n in t){const c=t[n];s=Math.max(s,c)}return s};Cn.getAvgLines=function(){return this.avgLines===null&&this.calcAvgLines(),this.avgLines},Cn.calcAvgLines=function(){this.avgLines=this.notes.map(function(t){return t.getLineAvg()})},Cn.isChaotic=function(){return!1};const rc=Sa;var Xi=r(863426);const pr=function(t,s){this.init(t,s)};pr.cssClass="tupletBracket";const Te=pr.prototype;Te.cssClass=pr.cssClass,Te.init=function(t,s){this.parent=null,this.group=null,this.leftVertical=null,this.leftSlant=null,this.rightSlant=null,this.rightVertical=null,this.drawingContext=null,this.slant=t,this.placement=s,this.width=null,this.gap=null,this.posX=null,this.posY=null},Te.setParent=function(t){this.parent=t},Te.createGroup=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass)},Te.setDrawingContext=function(t){this.drawingContext=t},Te.draw=function(){this.bindToParent(),this.move()},Te.bindToParent=function(){this.parent.append(this.group)},Te.move=function(){const t=this.posX,s=this.posY;this.group.attr("transform",`translate(${t} ${s})`)},Te.render=function(){this.isRendered()||(this.createGroup(),this.renderLeftVertical(),this.renderLeftSlant(),this.renderRightSlant(),this.renderRightVertical())},Te.isRendered=function(){return this.group!==null},Te.renderLeftVertical=function(){const t=this.getLeftExternalY(),s=this.getLeftInternalY(),c={stroke_width:this.drawingContext.getTupletBracketThickness()},y=new Xi.A(this.group,c),N=0;y.render(N,t,N,s),y.draw(),this.leftVertical=y},Te.renderLeftSlant=function(){const t=this.getLeftExternalY(),s=this.getLeftSlantY(),n=0,c=this.getLeftSlantX(),N={stroke_width:this.drawingContext.getTupletBracketThickness()},j=new Xi.A(this.group,N);j.render(n,t,c,s),j.draw(),this.leftSlant=j},Te.renderRightSlant=function(){const t=this.getRightSlantY(),s=this.getRightExternalY(),n=this.getRightSlantX(),c=this.width,N={stroke_width:this.drawingContext.getTupletBracketThickness()},j=new Xi.A(this.group,N);j.render(n,t,c,s),j.draw(),this.rightSlant=j},Te.renderRightVertical=function(){const t=this.getRightExternalY(),s=this.getRightInternalY(),c={stroke_width:this.drawingContext.getTupletBracketThickness()},y=new Xi.A(this.group,c),N=this.width;y.render(N,t,N,s),y.draw(),this.rightVertical=y},Te.setWidth=function(t){this.width=t},Te.setGap=function(t){this.gap=t},Te.updateDisplay=function(){this.updateWidth()},Te.updateWidth=function(){const t=this.getLeftSlantX(),s=this.getLeftSlantY();this.leftSlant.setX2(t),this.leftSlant.setY2(s);const n=this.getRightSlantX(),c=this.getRightSlantY();this.rightSlant.setX1(n),this.rightSlant.setY1(c),this.rightSlant.setX2(this.width),this.rightVertical.setX1(this.width),this.rightVertical.setX2(this.width)},Te.getLeftInternalY=function(){if(this.isLeftShifted()){const t=this.getPlacementCoeff();return this.drawingContext.getSpaceSize()/2*t}else return 0},Te.isLeftShifted=function(){return this.slant===ao.DOWN&&this.plaement===xt.A.ABOVE||this.slant===ao.UP&&this.placement===xt.A.BELOW},Te.getLeftExternalY=function(){const t=this.drawingContext.getTupletBracketHeight(),s=this.getPlacementCoeff();return this.getLeftInternalY()+t*s},Te.getRightInternalY=function(){if(this.isRightShifted()){const t=this.getPlacementCoeff();return this.drawingContext.getSpaceSize()/2*t}else return 0},Te.isRightShifted=function(){return this.slant===ao.UP&&this.plaement===xt.A.ABOVE||this.slant===ao.DOWN&&this.placement===xt.A.BELOW},Te.getRightExternalY=function(){const t=this.drawingContext.getTupletBracketHeight(),s=this.getPlacementCoeff();return this.getRightInternalY()+t*s},Te.getExternalYFromXRatio=function(t){const s=this.getLeftExternalY();return(this.getRightExternalY()-s)*t+s},Te.getInternalYFromXRatio=function(t){const s=this.drawingContext.getTupletBracketHeight(),n=this.getPlacementCoeff();return this.getExternalYFromXRatio(t)-s*n},Te.getPlacementCoeff=function(){if(this.placement===xt.A.ABOVE)return-1;if(this.placement===xt.A.BELOW)return 1;xt.A.raiseError(this.placement)},Te.getXRatio=function(t){return t/this.width},Te.getLeftSlantX=function(){return this.width/2-this.gap/2},Te.getLeftSlantY=function(){const t=this.getLeftSlantX(),s=this.getXRatio(t);return this.getExternalYFromXRatio(s)},Te.getRightSlantY=function(){const t=this.getRightSlantX(),s=this.getXRatio(t);return this.getExternalYFromXRatio(s)},Te.getRightSlantX=function(){return this.width/2+this.gap/2},Te.getMiddleY=function(){return this.getExternalYFromXRatio(.5)},Te.getMiddleX=function(){return this.width/2},Te.setPosX=function(t){this.posX=t},Te.setPosY=function(t){this.posY=t},Te.getPosX=function(){return this.posX},Te.getPosY=function(){return this.posY};const ac=pr,mr=function(t,s,n){this.init(t,s,n)};mr.cssClass="tuplet";const he=mr.prototype;he.cssClass=mr.cssClass,he.init=function(t,s,n){this.displayData=new rc,this.parent=null,this.group=null,this.drawingContext=null,this.staffData=null,this.isMinimalWidth=null,this.notes=[],this.graces=[],this.number=s,this.bracket=null,this.digitText=null,this.placement=n},he.setParent=function(t){this.parent=t},he.addNote=function(t,s){this.notes.push(t),t.beam=this,this.displayData.addNote(t.getDisplayData()),s.forEach(this.addGrace,this)},he.addGrace=function(t){const s=this.notes.length,n=this.notes[s-1];this.graces.push({note:n,grace:t})},he.setDrawingContext=function(t){this.drawingContext=t},he.setStaffData=function(t){this.staffData=t},he.bindToParent=function(){this.parent.append(this.group)},he.updateConnections=function(){this.isRendered()?this.updateFormating():this.render()},he.isRendered=function(){return this.group!==null},he.render=function(){this.createGroup(),this.createDigit(),this.createBracket(),this.renderDigit(),this.renderBracket(),this.format(),this.dispatchYToNotes()},he.createGroup=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass)},he.createDigit=function(){const t={"font-family":"Georgia, serif","font-style":"normal","font-size":1,text:this.number.toString()};this.digitText=new bs.A(t),this.digitText.setParent(this.group)},he.createBracket=function(){const t=this.getSlant();this.bracket=new ac(t,this.placement),this.bracket.setParent(this.group)},he.renderDigit=function(){this.digitText.setDrawingContext(this.drawingContext),this.adaptFontSize(),this.digitText.render()},he.adaptFontSize=function(){const t=this.digitText.getXHeight(),n=this.drawingContext.getSpaceSize()/t;this.digitText.setFontSize(n)},he.renderBracket=function(){const t=this.getWidth(),s=this.getGap();this.bracket.setWidth(t),this.bracket.setGap(s),this.bracket.setDrawingContext(this.drawingContext),this.bracket.render()},he.getGap=function(){return this.digitText.getWidth()+this.drawingContext.getSpaceSize()},he.getSlant=function(){return this.displayData.getSlant()},he.format=function(){this.formatBracket(),this.formatDigit()},he.formatBracket=function(){this.fillBracketPosX(),this.fillBracketPosY()},he.fillBracketPosX=function(){const t=this.getBracketStartX();this.bracket.setPosX(t)},he.fillBracketPosY=function(){const t=this.getInitialPosY();this.bracket.setPosY(t),this.notes.forEach(this.updateBracketYWithNote,this),this.graces.forEach(this.updateBracketYWithGrace,this)},he.updateBracketYWithNote=function(t,s){const n=Math.abs(this.getBracketInternalYAt(s)),c=Math.abs(this.getNoteExternalY(s));this.updateBrackYWithDiff(c,n)},he.updateBracketYWithGrace=function(t,s){const n=Math.abs(this.getBracketInternalYAtGrace(s)),c=Math.abs(this.getGraceExternalY(s));this.updateBrackYWithDiff(c,n)},he.updateBrackYWithDiff=function(t,s){if(t>s){const n=t-s;let c=this.bracket.getPosY();c+=n*this.getPlacementCoeff(),this.bracket.setPosY(c)}},he.getInitialPosY=function(){const t=this.drawingContext.getSpaceSize();if(this.placement===xt.A.ABOVE)return-t;if(this.placement===xt.A.BELOW)return this.getNbStaffLines()*t;xt.A.raiseError(this.placement)},he.getNbStaffLines=function(){return R.A.getNbStaffLines(this.staffData)},he.getPlacementCoeff=function(){if(this.placement===xt.A.ABOVE)return-1;if(this.placement===xt.A.BELOW)return 1;xt.A.raiseError(this.placement)},he.formatDigit=function(){let t=this.bracket.getPosX()+this.bracket.getMiddleX();t-=this.digitText.getWidth()/2;let s=this.bracket.getPosY()+this.bracket.getMiddleY();this.placement===xt.A.BELOW?s+=this.digitText.getFontSize()/4:this.placement===xt.A.ABOVE?s+=0:xt.A.raiseError(this.placement),this.digitText.setPosition(t,s)},he.draw=function(){this.bracket.draw(),this.digitText.draw(),this.bindToParent()},he.updateFormating=function(){const t=this.getWidth();this.bracket.setWidth(t),this.bracket.updateDisplay(),this.format(),this.dispatchYToNotes()},he.getNoteExternalY=function(t){const s=this.drawingContext.getSpaceSize();if(this.placement===xt.A.ABOVE)return this.notes[t].getHighestY()-s;if(this.placement===xt.A.BELOW)return this.notes[t].getLowestY()+s;xt.A.raiseError(this.placement)},he.getGraceExternalY=function(t){const s=this.drawingContext.getSpaceSize();if(this.placement===xt.A.ABOVE)return this.graces[t].grace.getHighestY()-s;if(this.placement===xt.A.BELOW)return this.graces[t].grace.getLowestY()+s;xt.A.raiseError(this.placement)},he.getBracketInternalYAt=function(t){const s=this.getXRatioAt(t),n=this.bracket.getPosY();return this.bracket.getInternalYFromXRatio(s)+n},he.getBracketInternalYAtGrace=function(t){const s=this.getXRatioAtGrace(t),n=this.bracket.getPosY();return this.bracket.getInternalYFromXRatio(s)+n},he.getBracketExternalYAt=function(t){const s=this.getXRatioAt(t),n=this.bracket.getPosY();return this.bracket.getExternalYFromXRatio(s)+n},he.getWidth=function(){const t=this.getNotesWidth(),s=this.getMinimalWidth(),n=Math.max(t,s);return this.isMinimalWidth=n===s,n},he.getNotesWidth=function(){const t=this.getFirstNoteStartX();return this.getLastNoteStopX()-t},he.getMinimalWidth=function(){const t=this.digitText.getWidth(),s=this.drawingContext.getMarginSize(),n=this.drawingContext.getSpaceSize();return t+s*2+n*2},he.getBracketStartX=function(){const t=this.getBracketOffset();return this.getFirstNoteStartX()-t},he.getBracketStopX=function(){const t=this.getBracketOffset();return this.getLastNoteStopX()+t},he.getXRatioAt=function(t){const s=this.getBracketStartX(),c=this.notes[t].getXPos()-s,y=this.getWidth();return c/y},he.getXRatioAtGrace=function(t){const s=this.getBracketStartX(),n=this.graces[t],c=n.note.getXPos(),y=n.grace.getXPos(),j=c+y-s,lt=this.getWidth();return j/lt},he.getBracketOffset=function(){if(this.isMinimalWidth){const t=this.getMinimalWidth(),s=this.getNotesWidth();return(t-s)/2}else return 0},he.getFirstNoteStartX=function(){const t=this.getFirstNote();let s=t.getXPos();return t.hasLeftShiftedHead()&&(s-=t.getLeftHeadWidth()),s},he.getFirstNote=function(){return this.notes[0]},he.getLastNoteStopX=function(){const t=this.getLastNote();let s=t.getXPos()+t.getMiddleHeadWidth();return t.hasRightShiftedHead()&&(s+=t.getRightHeadWidth()),s},he.getLastNote=function(){const t=this.notes.length-1;return this.notes[t]},he.updateHorizontalDisplay=function(){this.bracket.move(),this.digitText.move()},he.getTopY=function(){if(this.placement===xt.A.ABOVE)return this.digitText.y-this.digitText.getXHeight()*2;if(this.placement===xt.A.BELOW)return this.bracket.getPosY();xt.A.raiseError(this.placement)},he.getBottomY=function(){if(this.placement===xt.A.ABOVE)return this.bracket.getPosY();if(this.placement===xt.A.BELOW)return this.digitText.y;xt.A.raiseError(this.placement)},he.dispatchYToNotes=function(){this.notes.forEach(this.dispatchYToNote,this)},he.dispatchYToNote=function(t,s){const n=this.getYPosAtNote(s);this.placement===xt.A.ABOVE?t.setHighestTupletY(n):this.placement===xt.A.BELOW?t.setLowestTupletY(n):xt.A.raiseError(this.placement)},he.getYPosAtNote=function(t){if(this.isMiddleNote(t)){if(this.placement===xt.A.ABOVE)return this.getTopY();if(this.placement===xt.A.BELOW)return this.getBottomY();xt.A.raiseError(this.placement)}else return this.getBracketExternalYAt(t)},he.isMiddleNote=function(t){const s=this.notes.length;if(s%2===1)return t===s/2-.5;{const n=s/2;return t===n||t===n-1}};const hc=mr,ya=function(t,s){this.init(t,s)},xn=ya.prototype;xn.init=function(t,s){this.placement=cc(s),this.container=t,this.tuplets=[],this.timeModif=sr.default.createDefault(),this.timeModifStack=[],this.level=0};const cc=function(t){if(t===It.A.AUTO||It.A.isUp(t))return xt.A.ABOVE;if(It.A.isDown(t))return xt.A.BELOW;It.A.raiseError(t)};xn.canProcess=function(t){return t=Pa(t),kt.default.hasTupletBounds(t)?!0:!!(this.hasOngoingTuplet()&&kt.default.hasTimeModif(t))};const Pa=function(t){return He.default.isArray(t)?t[0]:t};xn.hasOngoingTuplet=function(){return this.tuplets.length>0},xn.addNote=function(t,s,n){if(t=Pa(t),kt.default.hasTupletStart(t)&&this.startTuplet(t),this.isSameTimeModif(t))this.addNoteToTuplets(s,n);else{const c="There is a note outside of the current tuplet timeModif.";throw new F.default("Unexpected",c)}kt.default.hasTupletStop(t)&&this.stopTuplet(t)},xn.isSameTimeModif=function(t){const s=kt.default.getTimeModif(t),n=this.timeModif;return sr.default.isSame(s,n)},xn.startTuplet=function(t){const s=kt.default.getTupletStarts(t);s.sort(wa),s.forEach(this.createTuplet,this)};const wa=function(t,s){const n=Eo.A.getLevel(t),c=Eo.A.getLevel(s);return n-c},lc=function(t,s){return wa(s,t)};xn.createTuplet=function(t){const s=Eo.A.getLevel(t);if(s!==this.level+1){const N="Expecting an other tuplet level on tuplet start.";throw new F.default("Unexpected",N)}const n=Eo.A.getNbActual(t),c=new hc(s,n,this.placement);this.tuplets.push(c);const y=Eo.A.getTimeModif(t);this.timeModifStack.push(sr.default.copy(y)),this.timeModif=sr.default.combine(this.timeModif,y),this.container.addTuplet(c),this.level++},xn.addNoteToTuplets=function(t,s){this.tuplets.forEach(function(n){n.addNote(t,s)})},xn.stopTuplet=function(t){const s=kt.default.getTupletStops(t);s.sort(lc),s.forEach(this.closeTuplet,this)},xn.closeTuplet=function(t){const s=Eo.A.getLevel(t);if(this.level!==s){const c="Unexpected tuplet level for closing tuplet.";throw new F.default("Unexpected",c)}else{this.tuplets.pop(),this.level--;const c=this.timeModifStack.pop();this.timeModif=sr.default.subtract(this.timeModif,c)}};const uc=ya;var bo=r(129283),fc=r(847857),dc=r(403521);const Da=function(){this.init()},Js=Da.prototype;Js.cssClass="internalGlissando",Js.init=function(){this.leftNote=null,this.rightNote=null,this.group=null,this.parent=null,this.drawingContext=null,this.glissandos=null,this.displayData=new dc.A},Js.setParent=function(t){this.parent=t},Js.setDrawingContext=function(t){this.drawingContext=t},Js.setLeftNote=function(t){this.leftNote=t,this.displayData.setLeftNote(t.getDisplayData())},Js.setRightNote=function(t){this.rightNote=t,this.displayData.setRightNote(t.getDisplayData())},Js.needRender=function(){return this.group===null},Js.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass)},Js.draw=function(){this.needRender()&&this.render(),this.drawGlissandos(),this.bindToParent()},Js.updateGlissandos=function(){this.glissandos!==null&&this.displayData.getGlissandoStarts().forEach(function(s,n){const c=this.getRightGlissandoData(s);if(typeof c!="undefined"){const y=this.glissandos[n],N=s.line,j=c.line;y.setPosX1(this.getLeftPosX()),y.setPosY1(this.lineToY(N)),y.setPosX2(this.getRightPosX()),y.setPosY2(this.lineToY(j)),y.update()}},this)},Js.bindToParent=function(){this.parent!==null&&this.parent.append(this.group)},Js.drawGlissandos=function(){const t=this.getGlissandos();v.default.forEach(t,this.drawGlissando)},Js.getGlissandos=function(){return this.glissandos===null&&(this.glissandos={},this.displayData.getGlissandoStarts().forEach(function(s,n){const c=this.getRightGlissandoData(s);if(typeof c!="undefined"){const y=new fc.A,N=s.line,j=c.line;y.setDrawingContext(this.drawingContext),y.setParent(this.group),y.setPosX1(this.getLeftPosX()),y.setPosY1(this.lineToY(N)),y.setPosX2(this.getRightPosX()),y.setPosY2(this.lineToY(j)),this.glissandos[n]=y}},this)),this.glissandos},Js.getRightGlissandoData=function(t){const s=this.displayData.getGlissandoStops(),n=t.number;return s.find(function(c){const y=c.number;return n===y})},Js.drawGlissando=function(t,s){s.draw()},Js.getLeftPosX=function(){return this.leftNote.getXPos()+this.leftNote.getMiddleHeadWidth()+this.drawingContext.getGlissandoHorizontalMargin()},Js.getRightPosX=function(){return this.rightNote.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},Js.lineToY=function(t){const s=this.drawingContext.getSpaceSize(),n=this.displayData.getNbStaffLines();return E.A.lineToY(t,s,n)};const gc=Da,Ca=function(t,s){this.init(t,s)},Oi=Ca.prototype;Oi.init=function(t,s){this.measure=null,this.note=t,this.glissandoType=s,this.leftNote=null,this.rightNote=null,this.glissando=null},Oi.getGlissandoType=function(){return this.glissandoType},Oi.getNote=function(){return this.note},Oi.setMeasure=function(t){this.measure=t},Oi.getMeasure=function(){return this.measure},Oi.setRightNote=function(t){this.rightNote=t},Oi.setLeftNote=function(t){this.leftNote=t},Oi.hasRightNote=function(){return this.rightNote!==null},Oi.hasLeftNote=function(){return this.leftNote!==null},Oi.getRightNote=function(){return this.rightNote},Oi.getLeftNote=function(){return this.leftNote},Oi.hasGlissando=function(){return this.glissando!==null},Oi.setGlissando=function(t){this.glissando=t},Oi.getGlissando=function(){return this.glissando};const xa=Ca,va=function(t){this.init(t)},en=va.prototype;en.init=function(t){this.container=t,this.leftNote=null},en.canProcess=function(t){return t=He.default.makeArray(t),this.hasGlissando(t)},en.hasGlissando=function(t){return t.some(kt.default.hasGlissandos)},en.addInternalNote=function(t,s){t=He.default.makeArray(t),this.hasGlissandoType(t,bo.default.STOP)&&this.addStop(s),this.hasGlissandoType(t,bo.default.START)&&this.addStart(s)},en.addFirstNote=function(t,s,n){t=He.default.makeArray(t),this.hasGlissandoType(t,bo.default.STOP)&&this.addStopAnchor(s,n)},en.addLastNote=function(t,s,n){t=He.default.makeArray(t),this.hasGlissandoType(t,bo.default.START)&&this.addStartAnchor(s,n)},en.hasGlissandoType=function(t,s){return t.some(function(n){return kt.default.hasGlissandoType(n,s)})},en.hasLeftNote=function(){return this.leftNote!==null},en.addStart=function(t){this.leftNote=t},en.addStop=function(t){if(this.hasLeftNote()){const s=new gc;s.setLeftNote(this.leftNote),s.setRightNote(t),this.container.addGlissando(s),this.leftNote=null}},en.addStopAnchor=function(t,s){const n=new xa(t,bo.default.STOP);n.setLeftNote(s),this.container.setLeftGlissandoAnchor(n)},en.addStartAnchor=function(t,s){const n=new xa(t,bo.default.STOP);n.setRightNote(s),this.container.setRightGlissandoAnchor(n)};const pc=va;var Ta=r(12597),mc=r(794165),Ac=r(746845);const La=function(){this.init()},Ms=La.prototype;Ms.cssClass="internalSlide",Ms.init=function(){this.leftNote=null,this.rightNote=null,this.group=null,this.parent=null,this.drawingContext=null,this.slides=null,this.displayData=new Ac.A},Ms.setParent=function(t){this.parent=t},Ms.setDrawingContext=function(t){this.drawingContext=t},Ms.setLeftNote=function(t){this.leftNote=t,this.displayData.setLeftNote(t.getDisplayData())},Ms.setRightNote=function(t){this.rightNote=t,this.displayData.setRightNote(t.getDisplayData())},Ms.needRender=function(){return this.group===null},Ms.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass)},Ms.draw=function(){this.needRender()&&this.render(),this.drawSlides(),this.bindToParent()},Ms.updateSlides=function(){this.slides!==null&&this.getSlidePairs().forEach(function(s){const n=this.slides[s.$number];this.fillSlidePosition(n,s),n.update()},this)},Ms.bindToParent=function(){this.parent!==null&&this.parent.append(this.group)},Ms.drawSlides=function(){const t=this.getSlides();v.default.forEach(t,this.drawSlide)},Ms.getSlides=function(){return this.slides===null&&(this.slides={},this.getSlidePairs().forEach(function(s){const n=new mc.A;n.setDrawingContext(this.drawingContext),n.setParent(this.group),this.fillSlidePosition(n,s),this.slides[s.$number]=n},this)),this.slides},Ms.getSlidePairs=function(){return this.isTabStaff()?this.displayData.getTabSlidePairs():this.displayData.getSlidePairs()},Ms.isTabStaff=function(){return this.displayData.isTabStaff()},Ms.fillSlidePosition=function(t,s){if(t.setPosX1(this.getLeftPosX()),t.setPosX2(this.getRightPosX()),this.isTabStaff()){const n=this.drawingContext.getTabSlideYOffset(),c=this.stringToY(s.leftString);let y=c,N=c;s.leftFret>s.rightFret?(y-=n,N+=n):(y+=n,N-=n),t.setPosY1(y),t.setPosY2(N)}else t.setPosY1(this.lineToY(s.leftLine)),t.setPosY2(this.lineToY(s.rightLine))},Ms.drawSlide=function(t,s){s.draw()},Ms.getLeftPosX=function(){let t;return this.isTabStaff()?t=this.leftNote.getFretsWidth():t=this.leftNote.getMiddleHeadWidth(),this.leftNote.getXPos()+t+this.drawingContext.getGlissandoHorizontalMargin()},Ms.getRightPosX=function(){return this.rightNote.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},Ms.lineToY=function(t){const s=this.drawingContext.getSpaceSize(),n=this.displayData.getNbStaffLines();return E.A.lineToY(t,s,n)},Ms.stringToY=function(t){const s=this.drawingContext.getTabSpaceSize(),n=this.displayData.getNbStaffLines();return E.A.stringToY(t,s,n)};const Sc=La,Ea=function(t,s){this.init(t,s)},Ni=Ea.prototype;Ni.init=function(t,s){this.measure=null,this.note=t,this.slideType=s,this.leftNote=null,this.rightNote=null,this.slide=null},Ni.getSlideType=function(){return this.slideType},Ni.getNote=function(){return this.note},Ni.setMeasure=function(t){this.measure=t},Ni.getMeasure=function(){return this.measure},Ni.setRightNote=function(t){this.rightNote=t},Ni.setLeftNote=function(t){this.leftNote=t},Ni.hasRightNote=function(){return this.rightNote!==null},Ni.hasLeftNote=function(){return this.leftNote!==null},Ni.getRightNote=function(){return this.rightNote},Ni.getLeftNote=function(){return this.leftNote},Ni.hasSlide=function(){return this.slide!==null},Ni.setSlide=function(t){this.slide=t},Ni.getSlide=function(){return this.slide};const ba=Ea,Ma=function(t){this.init(t)},Vi=Ma.prototype;Vi.init=function(t){this.container=t,this.leftNote=null},Vi.canProcess=function(t){return t=He.default.makeArray(t),this.hasSlide(t)},Vi.hasSlide=function(t){return t.some(yc)};function yc(t){return kt.default.hasSlideStart(t)||kt.default.hasSlideStop(t)}Vi.addInternalNote=function(t,s){t=He.default.makeArray(t),this.hasSlideStop(t)&&this.addStop(s),this.hasSlideStart(t)&&this.addStart(s)},Vi.addFirstNote=function(t,s,n){t=He.default.makeArray(t),this.hasSlideStop(t)&&this.addStopAnchor(s,n)},Vi.addLastNote=function(t,s,n){t=He.default.makeArray(t),this.hasSlideStart(t)&&this.addStartAnchor(s,n)},Vi.hasSlideStop=function(t){return t.some(function(s){return kt.default.hasSlideStop(s)})},Vi.hasSlideStart=function(t){return t.some(function(s){return kt.default.hasSlideStart(s)})},Vi.hasLeftNote=function(){return this.leftNote!==null},Vi.addStart=function(t){this.leftNote=t},Vi.addStop=function(t){if(this.hasLeftNote()){const s=new Sc;s.setLeftNote(this.leftNote),s.setRightNote(t),this.container.addSlide(s),this.leftNote=null}},Vi.addStopAnchor=function(t,s){const n=new ba(t,Ta.A.STOP);n.setLeftNote(s),this.container.setLeftSlideAnchor(n)},Vi.addStartAnchor=function(t,s){const n=new ba(t,Ta.A.STOP);n.setRightNote(s),this.container.setRightSlideAnchor(n)};const Pc=Ma;var wc=r(724926),Dc=r(667193),Bi=r(359932);const Ar=function(t){this.init(t)};Ar.cssClass="hammerOnPullOff";const rs=Ar.prototype;rs.cssClass=Ar.cssClass,rs.init=function(t){this.technicalType=t,this.text=null,this.arcs=null,this.displayData=new Dc.A,this.drawingContext=null,this.parent=null,this.svgGroup=new L.A("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!1},rs.setParent=function(t){this.parent=t},rs.setLeftNote=function(t){this.leftNote=t,this.displayData.setLeftNote(t.getDisplayData())},rs.setRightNote=function(t){this.rightNote=t,this.displayData.setRightNote(t.getDisplayData())},rs.setDrawingContext=function(t){this.drawingContext=t},rs.getArcs=function(){return this.hasArcs()||this.initArcs(),this.arcs},rs.hasArcs=function(){return this.arcs!==null},rs.initArcs=function(){this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()&&this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)},rs.getText=function(){return this.hasText()||this.initText(),this.text},rs.hasText=function(){return this.text!==null},rs.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){const t=this.displayData.getHammerOnPullOff(),s=this.getTextValue(),n=new bs.A({text:s,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});n.setDrawingContext(this.drawingContext),n.setParent(this.getGroup());const c=R.A.isTabStaff(t.staffData);let y=this.stringToY(t.string,c);y+=Fn.A.getVertical(t,this.drawingContext);const N=Bt.default.min2(y-n.getXHeight()-this.drawingContext.getTieVerticalMargin(),-n.getXHeight());n.setYPos(N),n.render(),this.text=n}},rs.renderArc=function(t){const s=this.leftNote.getFretsWidth()/2,n=Fn.A.getLeft(t,s),c=this.rightNote.getFretsWidth()/2,y=Fn.A.getRight(t,c),N=Fn.A.getVertical(t,this.drawingContext),j=R.A.isTabStaff(t.staffData),lt=this.stringToY(t.string,j)+N,Kt=this.stringToY(t.rightString,j)+N-lt,Se=new cr.A(this.getGroup(),n,y,t.placement,Kt);Se.setPosY(lt),Se.setDrawingContext(this.drawingContext),this.arcs.push(Se)},rs.stringToY=function(t,s){const n=s?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return E.A.stringToY(t,n)},rs.getTextValue=function(){if(this.technicalType===Bi.default.HAMMER_ON)return"H";if(this.technicalType===Bi.default.PULL_OFF)return"P";throw new F.default("Unexpected")},rs.updateArc=function(){this.updateArcs()},rs.updateArcs=function(){this.getArcs().forEach(function(s){const n=this.drawingContext.getTieHorizontalMargin(),c=this.leftNote.getXPos()+n,N=this.rightNote.getXPos()-n-c,lt=Cc()(N);s.setSize(N,lt),s.setPosX(c)},this),this.needDrawUpdate=!1},rs.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},rs.draw=function(){this.hasArcs()&&(this.needDrawUpdate&&this.updateArc(),this.getArcs().forEach(function(t){t.draw()}),this.bindToParent())},rs.bindToParent=function(){this.parent.append(this.getGroup())},rs.getGroup=function(){return this.svgGroup};let Zr=null;const Cc=function(){if(Zr===null){const s=.6666666666666666,y=Bt.default.solveLinearA(3,s,30,2),N=Bt.default.solveLinearB(3,s,y);Zr=function(j){return y*j+N}}return Zr};rs.updateHorizontalDisplay=function(){this.hasArcs()&&(this.needDrawUpdate&&this.updateArc(),this.getArcs().forEach(function(t){t.updateHorizontalDisplay()}))},rs.getTopY=function(){const t=this.getTopArc(),s=t.getTopY();return t.posY+s},rs.getTopArc=function(){return this.getArcs()[0]},rs.getBottomY=function(){const t=this.getBottomArc(),s=t.getBottomY();return t.posY+s},rs.getBottomArc=function(){const t=this.getArcs();return t[t.length-1]};const xc=Ar,Ra=function(t,s,n){this.init(t,s,n)},vn=Ra.prototype;vn.init=function(t,s,n){this.note=t,this.measure=null,this.hammerOnPullOff=null,this.technicalType=s,this.type=n,this.type!==di.START&&this.type!==di.STOP&&Oa(n),this.technicalType!==Bi.default.HAMMER_ON&&this.technicalType!==Bi.default.PULL_OFF&&vc(s)},vn.setMeasure=function(t){this.measure=t},vn.hasHammerOnPullOff=function(){return this.hammerOnPullOff!==null},vn.hasLeftHammerOnPullOff=function(){if(this.type===di.START){const t="A begin anchor cannot have a hammerOnPullOff incoming from the left";throw new F.default("BadHammerOnPullOffQuery",t)}else return this.hasHammerOnPullOff()?this.getHammerOnPullOff().getType()===xo.A.LEFT:!1},vn.hasCrossMeasureHammerOnPullOff=function(){return this.hasHammerOnPullOff()?this.getHammerOnPullOff().getType()===xo.A.CROSS_MEASURE:!1},vn.setHammerOnPullOff=function(t){this.hammerOnPullOff=t},vn.getHammerOnPullOff=function(){return this.hammerOnPullOff},vn.getTechnicalType=function(){return this.technicalType},vn.removeHammerOnPullOff=function(){this.type===di.START?this.hammerOnPullOff.removeLeftAnchor():this.type===di.STOP?this.hammerOnPullOff.removeRightAnchor():Oa(this.type)};const vc=function(t){const s=`The technical type [${t}] is invalid.`;throw new F.default("Unreachable",s)},Oa=function(t){const s=`The anchor type [${t}] is invalid.`;throw new F.default("Unreachable",s)};vn.setNeedDrawUpdate=function(){this.hasHammerOnPullOff()&&this.getHammerOnPullOff().setNeedDrawUpdate()};const Na=Ra;var Ba=r(369790);const Ha=function(t){this.init(t)},Jn=Ha.prototype;Jn.init=function(t){this.container=t,this.leftNote=null},Jn.canProcess=function(t){t=He.default.makeArray(t);const s=Tc(t);if(this.shouldProcess()&&!s)throw new F.default("HammerOnPullOffProcessor","a hammer-on/pull-off must stop at the next note");return s},Jn.shouldProcess=function(){return this.leftNote!==null};const Tc=function(t){return t.some(function(s){return kt.default.hasTechnical(s,Bi.default.HAMMER_ON)||kt.default.hasTechnical(s,Bi.default.PULL_OFF)})};Jn.addNote=function(t,s,n,c){let y;t=He.default.makeArray(t),Ec(t)&&(y=Ia(t),n?this.addLeftAnchor(y,s):this.stopTie(y,s)),Lc(t)&&(y=Ia(t),c?this.addRightAnchor(y,s):this.startTie(s))};const Lc=function(t){const s=_a(Ba.A.START);return t.some(function(n){return kt.default.hasTechnical(n,Bi.default.HAMMER_ON,s)||kt.default.hasTechnical(n,Bi.default.PULL_OFF,s)})},Ec=function(t){const s=_a(Ba.A.STOP);return t.some(function(n){return kt.default.hasTechnical(n,Bi.default.HAMMER_ON,s)||kt.default.hasTechnical(n,Bi.default.PULL_OFF,s)})},_a=function(t){return{hammerOnPullOff:wc.A.create(t)}},Ia=function(t){if(t.some(function(s){return kt.default.hasTechnical(s,Bi.default.HAMMER_ON)}))return Bi.default.HAMMER_ON;if(t.some(function(s){return kt.default.hasTechnical(s,Bi.default.PULL_OFF)}))return Bi.default.PULL_OFF;throw new F.default("Unexpected")};Jn.addLeftAnchor=function(t,s){const n=new Na(s,t,di.STOP);this.container.setLeftHammerOnPullOffAnchor(n)},Jn.addRightAnchor=function(t,s){const n=new Na(s,t,di.START);this.container.setRightHammerOnPullOffAnchor(n)},Jn.startTie=function(t){if(this.leftNote!==null)throw new F.default("HammerOnPullOffProcessor","a tie is already started");this.leftNote=t},Jn.stopTie=function(t,s){if(this.leftNote===null)throw new F.default("HammerOnPullOffProcessor","cannot stop a non started tie");const n=new xc(t);n.setLeftNote(this.leftNote),n.setRightNote(s),this.container.addHammerOnPullOff(n),this.leftNote=null};const bc=Ha,Mc=He.default.arrayToSet([Fe.A.BEGIN,Fe.A.CONTINUE,Fe.A.END]),Ya=function(t,s){this.init(t,s)},sn=Ya.prototype;sn.init=function(t,s){this.voiceId="1",this.renderedNote=null,this.noteIdx=-1,this.stemStrategy=s,this.container=t,this.beamNotes={}},sn.setNoteIdx=function(t){this.noteIdx=t},sn.canProcess=function(t){return t=He.default.makeArray(t),t.some(kt.default.hasBeam)},sn.addNote=function(t,s){const n=Rc(t);this.voiceId=kt.default.getVoiceId(n),this.renderedNote=s;const c=He.default.makeArray(n.beam);this.processBeams(c)};const Rc=function(t){return t=He.default.makeArray(t),t.find(kt.default.hasBeam)};sn.processBeams=function(t){t.forEach(this.processBeam,this)},sn.processBeam=function(t){this.extractBeamData(t),this.beamNumber==="1"&&(this.beamType===Fe.A.BEGIN?this.beginBeam():this.beamType===Fe.A.CONTINUE?this.continueBeam():this.endBeam())},sn.beginBeam=function(){this.beamNotes[this.voiceId]=[],this.beamNotes[this.voiceId].push(this.renderedNote)},sn.continueBeam=function(){typeof this.beamNotes[this.voiceId]!="undefined"&&this.beamNotes[this.voiceId].push(this.renderedNote)},sn.endBeam=function(){const t=this.beamNotes[this.voiceId],s=new Zo({isGrace:!0});It.A.isDown(this.stemStrategy)?s.forceStemValue(ge.A.DOWN):s.forceStemValue(ge.A.UP),t.push(this.renderedNote),t.forEach(function(n){s.addNote(n)}),this.container.addGraceBeam(s,this.noteIdx),this.beamNotes[this.voiceId]=null},sn.extractBeamData=function(t){this.beamNumber=this.getBeamNumber(t),this.beamNumber==="1"?this.beamType=this.getBeamType(t):this.beamType=null},sn.getBeamNumber=function(t){return t.$number.toString()},sn.getBeamType=function(t){if(Mc[t.content])return t.content;throw new Error(`the beam type ${t.content} in not recognized`)};const Oc=Ya;var qr=r(781942),Hi=r(967104),Nc=r(458057);function Fa(t){if(t===1)return"1/2";if(t===2)return"full";Nc.A.raiseError(t)}const Wa=function(t){this.init(t)},ws=Wa.prototype;ws.init=function({renderedNote:t,preBend:s,leftAlter:n,tiedLeft:c,string:y}){this.renderedNote=t,this.preBend=s,this.leftAlter=n,this.tiedLeft=c,this.string=y,this.measure=null,this.bend=null},ws.setMeasure=function(t){this.measure=t},ws.hasPreBend=function(){return this.preBend},ws.getLeftY=function(){if(this.leftAlter===0){const t=this.stringToY(),s=this.measure.drawingContext.getTabSpaceSize();return t-s*1/4}else return this.alterToY(this.leftAlter)},ws.getPreBendBottomY=function(){const t=this.stringToY(),s=this.measure.drawingContext.getTabSpaceSize();return t-s*3/4},ws.getPreBendTopY=function(){return this.alterToY(this.leftAlter)},ws.stringToY=function(){const t=this.measure.drawingContext.getTabSpaceSize(),s=this.getNbStaffLines();return E.A.stringToY(this.string,t,s)},ws.alterToY=function(){return-this.measure.drawingContext.getTabSpaceSize()*this.leftAlter*2/3},ws.getNbStaffLines=function(){return this.measure.getNbStaffLines()},ws.getPreBendX=function(){return this.getNormalX()},ws.getBendLeftX=function(){return this.renderedNote===null?this.getTickableContentX():this.isTiedLeft()?this.getTiedX():this.hasPreBend()?this.getShiftedX():this.getNormalX()},ws.getTickableContentX=function(){const t=this.measure.tickableContent,s=this.measure.getXPos(),n=t.getXPos(),c=t.getPreviousSpace();return s+n-c},ws.getTiedX=function(){return this.getStaffNoteX()},ws.getNormalX=function(){const t=this.getStaffNoteX(),s=this.renderedNote.getFretsWidth();return t+s/2},ws.getShiftedX=function(){const t=this.getStaffNoteX(),s=this.renderedNote.getFretsWidth(),n=this.measure.drawingContext.getMarginSize();return t+s+n},ws.getStaffNoteX=function(){const t=this.measure.tickableContent,s=this.measure.getXPos(),n=t.getXPos(),c=this.renderedNote.getXPos();return s+n+c},ws.isTiedLeft=function(){return this.tiedLeft},ws.getLeftText=function(){return Fa(this.leftAlter)},ws.setNeedDrawUpdate=function(){this.hasBend()&&this.getBend().setNeedDrawUpdate()},ws.hasBend=function(){return this.bend!==null},ws.getBend=function(){return this.bend},ws.isLeft=function(){return!0},ws.isRight=function(){return!1};const Ga=Wa,Ua=function(t){this.init(t)},Bs=Ua.prototype;Bs.init=function({renderedNote:t,rightAlter:s,tiedRight:n,string:c,bendType:y}){this.renderedNote=t,this.rightAlter=s,this.tiedRight=n,this.string=c,this.bendType=y,this.measure=null,this.bend=null},Bs.setMeasure=function(t){this.measure=t},Bs.getRightY=function(){if(this.rightAlter===0){const t=this.stringToY(),s=this.measure.drawingContext.getTabSpaceSize();return t-s*1/4}else return this.alterToY(this.rightAlter)},Bs.stringToY=function(){const t=this.measure.drawingContext.getTabSpaceSize(),s=this.getNbStaffLines();return E.A.stringToY(this.string,t,s)},Bs.alterToY=function(){return-this.measure.drawingContext.getTabSpaceSize()*this.rightAlter*2/3},Bs.getNbStaffLines=function(){return this.measure.getNbStaffLines()},Bs.getBendRightX=function(){return this.renderedNote===null?this.measureEndX():this.isTiedRight()?this.getNormalX():this.getShiftedX()},Bs.measureEndX=function(){const s=this.measure.tickableContent,n=this.measure.getXPos(),c=s.getXPos(),y=s.getWidth();let N=n+c+y;const j=this.measure.drawingContext.getMarginSize();return this.isTiedRight()?N-=j/2:N-=j,N},Bs.getNormalX=function(){const t=this.getStaffNoteX(),s=this.measure.drawingContext.getMarginSize();return t-s/2},Bs.getShiftedX=function(){const t=this.getStaffNoteX(),s=this.measure.drawingContext.getMarginSize();return t-s},Bs.getStaffNoteX=function(){const t=this.measure.tickableContent,s=this.measure.getXPos(),n=t.getXPos(),c=this.renderedNote.getXPos();return s+n+c},Bs.isTiedRight=function(){return this.tiedRight},Bs.getRightText=function(){return this.rightAlter===0?null:Fa(this.rightAlter)},Bs.getRightBendType=function(){return this.bendType},Bs.setNeedDrawUpdate=function(){this.hasBend()&&this.getBend().setNeedDrawUpdate()},Bs.hasBend=function(){return this.bend!==null},Bs.getBend=function(){return this.bend},Bs.isLeft=function(){return!1},Bs.isRight=function(){return!0},Bs.isTextShifted=function(){return this.renderedNote===null};const ta=Ua;var Mo=r(694426),Bc=r(525766);const za=function(t){this.init(t)},ln=za.prototype;ln.init=function({container:t,voiceIdx:s,voiceNotes:n,renderedNotes:c,previousMeasure:y}){this.container=t,this.voiceIdx=s,this.voiceNotes=n,this.renderedNotes=c,this.previousMeasure=y},ln.fillChordsBends=function(){this.voiceNotes.forEach(this.fillChordBends,this)},ln.fillChordBends=function(t,s){this.noteIdx=s,t.chordJson.forEach(this.fillNoteBend,this)},ln.fillNoteBend=function(t){this.isFirstNote()&&this.tryFillExternalLeftAnchor(t),this.tryFillLeftAnchor(t),this.isLastNote()?this.tryFillExternalRightAnchor(t):this.tryFillRightAnchor(t)},ln.isLastNote=function(){return this.noteIdx===this.voiceNotes.length-1},ln.isFirstNote=function(){return this.noteIdx===0},ln.tryFillExternalLeftAnchor=function(t){if(!kt.default.hasTieStop(t))return;const s=this.getPreviousNoteJson(t);if(s===null||!kt.default.hasPreBend(s)&&!kt.default.hasBend(s))return;let n;if(kt.default.hasBend(s))n=Sr(s);else{const Kt=kt.default.getPreBend(s);n=Hi.A.getAlter(Kt)}const{string:c}=kt.default.getFretData(s),y=new Ga({renderedNote:null,preBend:!1,leftAlter:n,tiedLeft:!1,string:c});this.container.addExternalLeftBendAnchor(c,y);const N=this.renderedNotes[0];let j,lt;if(kt.default.hasBend(s)){const Kt=kt.default.getBend(s);j=Hi.A.getAlter(Kt),lt=Hi.A.getType(Kt)}else{const Kt=kt.default.getPreBend(s);j=Hi.A.getAlter(Kt),lt=Mo.A.PRE_BEND}const Ft=new ta({renderedNote:N,rightAlter:j,tiedRight:!0,string:c,bendType:lt});this.container.addMiddleBendAnchor(c,Ft)},ln.tryFillLeftAnchor=function(t){if(!kt.default.hasBend(t)&&!kt.default.hasPreBend(t))return;const s=this.renderedNotes[this.noteIdx],{string:n}=kt.default.getFretData(t),c=kt.default.hasTieStop(t),y=kt.default.hasPreBend(t);let N;if(y){const lt=kt.default.getPreBend(t);N=Hi.A.getAlter(lt)}else{const lt=this.getPreviousNoteJson(t);N=Hc(lt,t)}const j=new Ga({renderedNote:s,preBend:y,leftAlter:N,tiedLeft:c,string:n});this.container.addMiddleBendAnchor(n,j)},ln.getPreviousNoteJson=function(t){let s;if(this.isFirstNote()){if(!this.previousMeasure||!this.previousMeasure.hasVoice(this.voiceIdx))return null;s=this.previousMeasure.getLastNoteJson(this.voiceIdx)}else s=this.voiceNotes[this.noteIdx-1].chordJson;if(!kt.default.hasFretData(t))return null;const n={fretData:kt.default.getFretData(t),pitch:kt.default.getPitch(t)},c=s.find(Bc.A,n);return c||null},ln.tryFillRightAnchor=function(t){if(!kt.default.hasBend(t)&&!kt.default.hasPreBend(t))return;const s=this.renderedNotes[this.noteIdx+1],{string:n}=kt.default.getFretData(t),c=kt.default.hasTieStart(t);let y,N;if(kt.default.hasBend(t)){const lt=kt.default.getBend(t);y=Hi.A.getAlter(lt),N=Hi.A.getType(lt)}else{const lt=kt.default.getPreBend(t);y=Hi.A.getAlter(lt),N=Mo.A.PRE_BEND}const j=new ta({renderedNote:s,rightAlter:y,tiedRight:c,string:n,bendType:N});this.container.addMiddleBendAnchor(n,j)},ln.tryFillExternalRightAnchor=function(t){if(!kt.default.hasBend(t)&&!kt.default.hasPreBend(t))return;const{string:s}=kt.default.getFretData(t),n=kt.default.hasTieStart(t);let c,y;if(kt.default.hasBend(t)){const j=kt.default.getBend(t);c=Hi.A.getAlter(j),y=Hi.A.getType(j)}else{const j=kt.default.getPreBend(t);c=Hi.A.getAlter(j),y=Mo.A.PRE_BEND}const N=new ta({renderedNote:null,rightAlter:c,tiedRight:n,string:s,bendType:y});n?this.container.addExternalRightBendAnchor(s,N):this.container.addMiddleBendAnchor(s,N)};function Hc(t,s){if(!kt.default.hasTieStop(s)||t===null)return Sr(s);if(kt.default.hasBend(t)){const n=kt.default.getBend(t);return Hi.A.getAlter(n)}if(kt.default.hasPreBend(t)){const n=kt.default.getPreBend(t);return Hi.A.getAlter(n)}return Sr(s)}function Sr(t){const s=kt.default.getBend(t),n=Hi.A.getType(s);if(n===Mo.A.BEND)return 0;if(n===Mo.A.RELEASE)return 2;Mo.A.raiseError(n)}const _c=za,yr=function(){this.init()};yr.cssClass="MMRSymbol";const hs=yr.prototype;hs.cssClass=yr.cssClass,hs.init=function(){this.parent=null,this.group=null,this.leftVertical=null,this.middleLine=null,this.rightVertical=null,this.drawingContext=null,this.width=null,this.posX=null,this.posY=null},hs.setParent=function(t){this.parent=t},hs.createGroup=function(){this.group=new L.A("g"),this.group.attr("class",`head ${this.cssClass}`)},hs.setDrawingContext=function(t){this.drawingContext=t},hs.draw=function(){this.bindToParent(),this.move()},hs.bindToParent=function(){this.parent.append(this.group)},hs.move=function(){const t=this.posX,s=this.posY;this.group.attr("transform",`translate(${t} ${s})`)},hs.render=function(){this.isRendered()||(this.createGroup(),this.renderLeftVertical(),this.renderMiddleLine(),this.renderRightVertical())},hs.isRendered=function(){return this.group!==null},hs.renderLeftVertical=function(){const t=this.getUpY(),s=this.getDownY(),c={stroke_width:this.drawingContext.getMMRExternalThickness(),stroke:"black"},y=new Xi.A(this.group,c),j=this.drawingContext.getSpaceSize();y.render(j,t,j,s),y.draw(),this.leftVertical=y},hs.renderMiddleLine=function(){const t=this.drawingContext.getSpaceSize(),s=0,n=t,c=this.width-t,N={stroke_width:this.drawingContext.getMMRInternalThickness(),stroke:"black"},j=new Xi.A(this.group,N);j.render(n,s,c,s),j.draw(),this.middleLine=j},hs.renderRightVertical=function(){const t=this.getUpY(),s=this.getDownY(),c={stroke_width:this.drawingContext.getMMRExternalThickness(),stroke:"black"},y=new Xi.A(this.group,c),N=this.drawingContext.getSpaceSize(),j=this.width-N;y.render(j,t,j,s),y.draw(),this.rightVertical=y},hs.setWidth=function(t){this.width=t},hs.updateDisplay=function(){this.updateWidth()},hs.updateWidth=function(){const t=this.drawingContext.getSpaceSize(),s=this.width-t;this.middleLine.setX2(s),this.rightVertical.setX1(s),this.rightVertical.setX2(s)},hs.getDownY=function(){return this.drawingContext.getSpaceSize()},hs.getUpY=function(){return-this.drawingContext.getSpaceSize()},hs.setPosX=function(t){this.posX=t},hs.setPosY=function(t){this.posY=t},hs.getPosX=function(){return this.posX},hs.getPosY=function(){return this.posY},hs.getWidth=function(){return this.width},hs.getHeight=function(){return this.drawingContext.getSpaceSize()*2};const Ic=yr,Yc=6,Pr=function(t){this.init(t)};Pr.cssClass="multiMeasureRest";const ce=Pr.prototype;ce.cssClass=Pr.cssClass,ce.init=function(t){this.parent=null,this.group=null,this.drawingContext=null,this.staffData=null,this.isMinimalWidth=null,this.horizontalData=null,this.horizontalFormatter=null,this.verticalFormatting=null,this.verticalAlignment=null,this.nbMeasures=t,this.symbol=null,this.digitText=null},ce.setParent=function(t){this.parent=t},ce.setStaffData=function(t){this.staffData=t},ce.setDpq=function(t){this.dpq=t},ce.setNbDivisions=function(t){this.nbDivisions=t},ce.bindToParent=function(){this.parent.append(this.group)},ce.isRendered=function(){return this.group!==null},ce.render=function(t){this.drawingContext=t,this.createGroup(),this.createDigit(),this.createSymbol(),this.renderDigit(),this.renderSymbol()},ce.createGroup=function(){this.group=new L.A("g"),this.group.attr("class",`note ${this.cssClass}`),this.group.style("fill","black")},ce.createDigit=function(){const t={"font-family":"Georgia, serif","font-style":"normal","font-size":1,text:this.nbMeasures.toString()};this.digitText=new bs.A(t),this.digitText.setParent(this.group)},ce.createSymbol=function(){this.symbol=new Ic,this.symbol.setParent(this.group)},ce.renderDigit=function(){this.digitText.setDrawingContext(this.drawingContext);const t=this.getFontSize();this.digitText.setFontSize(t),this.digitText.render()},ce.renderSymbol=function(){const t=this.getMinimalWidth();this.symbol.setWidth(t),this.symbol.setDrawingContext(this.drawingContext),this.symbol.render()},ce.getHorizontalData=function(){return this.horizontalData===null&&this.computeHorizontalData(),this.horizontalData},ce.computeHorizontalData=function(){const t=this.getDpq(),s=this.getNbDivisions(),c=[{timePos:0,spaceBefore:0,spaceAfter:this.getMinimalWidth(),isRest:!1}];this.horizontalData={dpq:t,entities:c,nbDivisions:s,type:Ne.A.MMR}},ce.setHorizontalFormatter=function(t){this.horizontalFormatter=t},ce.formatHorizontal=function(){this.formatSymbol(),this.formatDigitHorizontal()},ce.formatSymbol=function(){const t=this.getWidth();this.symbol.setWidth(t),this.symbol.updateDisplay(),this.fillSymbolPosX(),this.fillSymbolPosY()},ce.fillSymbolPosX=function(){const t=this.horizontalFormatter.getMiddlePos(),s=this.symbol.getWidth(),n=t-s/2;this.symbol.setPosX(n)},ce.fillSymbolPosY=function(){const t=this.drawingContext.getSpaceSize(),s=(this.getNbStaffLines()-1)*t/2;this.symbol.setPosY(s)},ce.getNbMeasures=function(){return this.nbMeasures},ce.getNbStaffLines=function(){return R.A.getNbStaffLines(this.staffData)},ce.formatDigitHorizontal=function(){const t=this.horizontalFormatter.getMiddlePos(),s=this.digitText.getWidth(),n=t-s/2;this.digitText.setXPos(n)},ce.getTopY=function(){const t=this.getNbStaffLines();return this.lineToY(t)-this.getUpOverflow()},ce.getFontSize=function(){return this.drawingContext.getSpaceSize()*2},ce.setVerticalFormatting=function(t){this.verticalFormatting=t},ce.formatVertical=function(){const t=this.getDigitMargin();this.digitText.setYPos(-t)},ce.getDigitMargin=function(){return this.drawingContext.getSpaceSize()/2},ce.getUpOverflow=function(){return this.getDigitMargin()+this.getFontSize()},ce.draw=function(){this.symbol.draw(),this.digitText.draw(),this.bindToParent()},ce.getMinimalWidth=function(){return this.drawingContext.getSpaceSize()*Yc},ce.updateHorizontalDisplay=function(){this.symbol.move(),this.digitText.move()},ce.updateVerticalDisplay=function(){this.symbol.move(),this.digitText.move()},ce.getDpq=function(){return this.dpq},ce.getNbDivisions=function(){return this.nbDivisions},ce.getMiddleHeadWidth=function(){return this.getMinimalWidth()},ce.getWidth=function(){return this.horizontalFormatter.getWidth()},ce.getPreviousSpace=function(){return this.horizontalFormatter.getAlignmentSpace()},ce.calcLeadingSpace=function(){return 0},ce.calcTrailingSpace=function(){return 0},ce.getDuration=function(){return 1},ce.isRest=function(){return!1},ce.getTimePos=function(){return 0},ce.hasLyric=function(){return!1},ce.setPosition=function(){this.horizontalFormatter!==null&&this.formatHorizontal()},ce.move=function(){this.horizontalFormatter!==null&&this.formatHorizontal()},ce.drawLyric=function(){},ce.getYInfos=function(){const t=this.getVerticalAlignment();return(0,P.default)(t)},ce.getVerticalAlignment=function(){if(this.verticalAlignment===null){const t=this.getMiddleLine(),s=this.getTopY(),n=this.lineToY(t);this.verticalAlignment={highestY:s,lowestY:n,highestTupletY:s,lowestTupletY:n}}return this.verticalAlignment},ce.getHighestTupletY=function(){return this.getVerticalAlignment().highestTupletY},ce.getLowestTupletY=function(){return this.getVerticalAlignment().lowestTupletY},ce.lineToY=function(t){const s=this.drawingContext.getSpaceSize(),n=this.getNbStaffLines();if(this.isTabStaff()){const c=this.drawingContext.getTabSpaceSize();return E.A.lineToTabY(t,s,c,n)}else return E.A.lineToY(t,s,n)},ce.isTabStaff=function(){return R.A.isTabStaff(this.staffData)},ce.getMiddleLine=function(){return(this.getNbStaffLines()-1)/2+1},ce.getXPos=function(){return this.horizontalFormatter.getPosX(0,1)};const Fc=Pr,ka=function(){this.init()},Le=ka.prototype;Le.init=function(){this.slurAnchorsBuilder=new Yr},Le.buildMeasureRepeat=function(t,s,n,c,y,N){this.reset(t,s,n,c,y,N);const j=t.getStaffDetails(s.staffIdx),lt=R.A.createFromStaffDetails(j),Ft=new Jt({staffData:lt});return this.voice.addNote(Ft),this.voice},Le.buildMMR=function(t,s,n,c,y,N,j){this.reset(t,s,n,c,y,N);const lt=new Fc(j),Ft=this.attrs.getDpq();lt.setDpq(Ft);const Kt=this.attrs.getNbDivisions();return lt.setNbDivisions(Kt),this.voice.addNote(lt),this.voice},Le.build=function({voiceNotes:t,measureJson:s,attrs:n,location:c,previousMeasure:y,nextMeasure:N,stemStrategy:j,isPickup:lt,nbVoices:Ft}){return this.reset(n,c,y,N,j,lt),this.fillNotes(t,Ft),this.fillNotesGraces(t),this.isTabStaff()?(this.fillNotesBeams(t),this.fillNotesGraces(t),this.fillNotesSlides(t),this.fillNotesHammerOnPullOffs(t),this.fillNotesBends(t)):this.isKodalyStaff()?(this.fillNotesBeams(t),this.fillSlurs(t,s),this.fillNotesTies(t),this.fillNotesHyphens(t),this.fillNotesMelisma(t),this.fillNotesTuplets(t)):this.isRecorderTabStaff()||(this.fillNotesBeams(t),this.fillNotesGraces(t),this.fillNotesSlides(t),this.fillSlurs(t,s),this.fillNotesGracesBeams(t),this.fillNotesGraceSlur(t),this.fillNotesTies(t),this.fillNotesHyphens(t),this.fillNotesMelisma(t),this.fillNotesTuplets(t),this.fillNotesGlissandos(t)),this.voice},Le.reset=function(t,s,n,c,y,N){this.attrs=t,this.location=s,this.voice=new o(s.voiceIdx,s.voiceUuid),this.renderedNotes=null;const j=t.getDpq();this.voice.setDpq(j);const lt=t.getNbDivisions();this.voice.setNbDivisions(lt),this.voice.setStemStrategy(y),this.beamProcessor=new ys(this.voice),this.tieProcessor=new Kr(this.voice),this.hyphenProcessor=new jr(this.voice),this.melismaProcessor=new nc(this.voice),this.tupletProcessor=new uc(this.voice,y),this.glissandoProcessor=new pc(this.voice),this.slideProcessor=new Pc(this.voice),this.hammerOnPullOffProcessor=new bc(this.voice),this.graceBeamProcessor=new Oc(this.voice,y),this.previousMeasure=n,this.nextMeasure=c,this.stemStrategy=y,this.isPickup=N},Le.fillNotes=function(t,s){this.isAlone=t.length===1,this.nbVoices=s,this.renderedNotes=t.map(this.createTickableNote,this),this.renderedNotes.forEach(this.voice.addNote,this.voice)},Le.createTickableNote=function(t,s){this.noteIdx=s,this.timePos=t.timePos;const n=this.createNote(t.chordJson,t.timePos);return n.setTimePos(t.timePos),n},Le.fillNotesGraces=function(t){t.forEach(this.fillNoteGraces,this)},Le.fillNoteGraces=function(t,s){this.noteIdx=s,this.timePos=t.timePos;const n=t.graces.map(this.createNote,this);this.voice.addNoteGraces(s,n)},Le.getNoteCtx=function(t){const s={stemStrategy:this.stemStrategy,isAlone:this.isAlone,isPickup:this.isPickup,noteIdx:this.noteIdx,timePos:this.timePos};return kt.default.isRest(t[0])&&this.stemStrategy!==It.A.AUTO&&this.nbVoices===1&&(s.stemStrategy=It.A.AUTO),s},Le.createNote=function(t){const n=this.getNoteCtx(t),c=(0,qr.A)(t,this.attrs,n);return It.A.isUp(this.stemStrategy)?c.setSpeficiedStem(ge.A.UP):It.A.isDown(this.stemStrategy)||this.stemStrategy===It.A.AUTO&&this.isTabStaff()?c.setSpeficiedStem(ge.A.DOWN):this.stemStrategy===It.A.AUTO&&this.isKodalyStaff()&&c.setSpeficiedStem(ge.A.UP),c.setStemStrategy(this.stemStrategy),new u.A(c,null)},Le.isRecorderTabStaff=function(){const t=this.attrs.getStaffDetails(this.location.staffIdx);return ae.default.hasRecorderTabs(t)},Le.isTabStaff=function(){const t=this.attrs.getStaffDetails(this.location.staffIdx);return ae.default.hasStaffTuning(t)},Le.isKodalyStaff=function(){const t=this.attrs.getStaffDetails(this.location.staffIdx);return ae.default.hasKodaly(t)},Le.fillSlurs=function(t,s){const n=this.voice.getVoiceIdx();this.slurAnchorsBuilder.build(this.voice,n,t,s)},Le.fillNotesBeams=function(t){t.forEach(this.fillNoteBeam,this)},Le.fillNoteBeam=function(t,s){const n=t.chordJson;if(this.beamProcessor.canProcess(n)){const c=this.renderedNotes[s];this.beamProcessor.addNote(n,c)}},Le.fillNotesGracesBeams=function(t){t.forEach(this.fillNoteGracesBeam,this)},Le.fillNoteGracesBeam=function(t,s){const n=this.voice.getNoteGraces(s);this.graceBeamProcessor.setNoteIdx(s),t.graces.forEach(function(c,y){if(this.graceBeamProcessor.canProcess(c)){const N=n[y];this.graceBeamProcessor.addNote(c,N)}},this)},Le.fillNotesGraceSlur=function(t){t.forEach((s,n)=>{const c=this.voice.getNoteGraces(n),[y]=s.chordJson;if(kt.default.hasGraceSlur(y)&&c.length>0){const N=this.renderedNotes[n],j=new Qn(N,c);this.voice.addGraceSlur(j)}})},Le.fillNotesTies=function(t){t.forEach(this.fillNoteTie,this)},Le.fillNoteTie=function(t,s,n){const c=this.location.voiceIdx,y=s===0,N=s===n.length-1,j=t.chordJson,lt=this.getNoteCtx(j);if(this.tieProcessor.canProcess(j)){const Ft=this.renderedNotes[s];if(y&&this.previousMeasure!==null){const Kt=this.previousMeasure.hasVoice(c)?this.previousMeasure.getLastNoteDisplayData(c,lt):null;this.tieProcessor.addFirstNote(j,Ft,Kt)}if(this.tieProcessor.addInternalNote(j,Ft),N&&this.nextMeasure!==null){const Kt=this.nextMeasure.hasVoice(c)?this.nextMeasure.getFirstNoteDisplayData(c,lt):null;this.tieProcessor.addLastNote(j,Ft,Kt)}}},Le.fillNotesMelisma=function(t){this.melismaProcessor.startVoice();const s=t.length;for(let n=0;n<s;n++){const c=n===0,y=n===s-1,N=t[n].chordJson,j=this.renderedNotes[n];this.melismaProcessor.process(N,j,c,y)}},Le.fillNotesHyphens=function(t){const s=t.length;for(let N=0;N+1<s;N++){const j=t[N].chordJson,lt=t[N+1].chordJson;this.fillNoteHyphen(j,N,lt)}const n=t[0].chordJson;this.fillLeftHyphenAnchor(n);const c=s-1,y=t[c].chordJson;this.fillRightHyphenAnchor(y,c)},Le.fillNoteHyphen=function(t,s,n){if(this.hyphenProcessor.canProcess(t,n)){const c=this.renderedNotes[s],y=this.renderedNotes[s+1];this.hyphenProcessor.addConnection(t,c,n,y)}},Le.fillLeftHyphenAnchor=function(t){if(this.hyphenProcessor.canProcessLeft(t)){const s=this.renderedNotes[0];this.hyphenProcessor.addLeftAnchor(s)}},Le.fillRightHyphenAnchor=function(t,s){if(this.hyphenProcessor.canProcessRight(t)){const n=this.renderedNotes[s];this.hyphenProcessor.addRightAnchor(n)}},Le.fillNotesTuplets=function(t){t.forEach(this.fillNoteTuplet,this)},Le.fillNoteTuplet=function(t,s){const n=t.chordJson;if(this.tupletProcessor.canProcess(n)){const c=this.renderedNotes[s],y=this.voice.getNoteGraces(s);this.tupletProcessor.addNote(n,c,y)}},Le.fillNotesGlissandos=function(t){t.forEach(this.fillNoteGlissando,this)},Le.fillNoteGlissando=function(t,s,n){const c=this.location.voiceIdx,y=s===0,N=s===n.length-1,j=t.chordJson,lt=this.getNoteCtx(j);if(this.glissandoProcessor.canProcess(j)){const Ft=this.renderedNotes[s];if(y){const Kt=this.previousMeasure!==null&&this.previousMeasure.hasVoice(c)?this.previousMeasure.getLastNoteDisplayData(c,lt):null;this.glissandoProcessor.addFirstNote(j,Ft,Kt)}if(this.glissandoProcessor.addInternalNote(j,Ft),N){const Kt=this.nextMeasure!==null&&this.nextMeasure.hasVoice(c)?this.nextMeasure.getFirstNoteDisplayData(c,lt):null;this.glissandoProcessor.addLastNote(j,Ft,Kt)}}},Le.fillNotesSlides=function(t){t.forEach(this.fillNoteSlide,this)},Le.fillNoteSlide=function(t,s,n){const c=this.location.voiceIdx,y=s===0,N=s===n.length-1,j=t.chordJson,lt=this.getNoteCtx(j);if(this.slideProcessor.canProcess(j)){const Ft=this.renderedNotes[s];if(y){const Kt=this.previousMeasure!==null&&this.previousMeasure.hasVoice(c)?this.previousMeasure.getLastNoteDisplayData(c,lt):null;this.slideProcessor.addFirstNote(j,Ft,Kt)}if(this.slideProcessor.addInternalNote(j,Ft),N){const Kt=this.nextMeasure!==null&&this.nextMeasure.hasVoice(c)?this.nextMeasure.getFirstNoteDisplayData(c,lt):null;this.slideProcessor.addLastNote(j,Ft,Kt)}}},Le.fillNotesHammerOnPullOffs=function(t){t.forEach(this.fillNoteHammerOnPullOff,this)},Le.fillNoteHammerOnPullOff=function(t,s,n){const c=s===0,y=s===n.length-1,N=t.chordJson;if(this.hammerOnPullOffProcessor.canProcess(N)){const j=this.renderedNotes[s];this.hammerOnPullOffProcessor.addNote(N,j,c,y)}},Le.fillNotesBends=function(t){new _c({container:this.voice,voiceIdx:this.location.voiceIdx,voiceNotes:t,renderedNotes:this.renderedNotes,previousMeasure:this.previousMeasure}).fillChordsBends()};const Wc=ka;var _i=r(558280),ea=r(443838),Gc=r(612040);const Xa=function(){this.init()},Ro=Xa.prototype;Ro.init=function(){this.tickableContent=null,this.measureJson=null,this.staffIdx=null},Ro.build=function(t,s,n,c,y){this.isTabStaff=y,this.measureJson=n,this.staffIdx=c,this.tickableContent=t,this.addMiddleAnchors(s),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},Ro.addMiddleAnchors=function(t){t.forEach(this.addMiddleAnchor,this)},Ro.addMiddleAnchor=function(t){const s=_i.A.getTimePos(t);let n=_i.A.getPlacement(t);this.isTabStaff&&(n=xt.A.ABOVE);const c=_i.A.getLocation(t),y=_i.A.getType(t);let N=null;c===Gc.A.LEFT&&(N=_i.A.getWedgeUuid(t));const j=new ea.A(y,n,c,s,N);this.tickableContent.addMiddleWedgeAnchor(j)},Ro.addLeftContinueAnchors=function(){if(f.default.hasLeftWedge(this.measureJson,this.staffIdx)){const t=f.default.getLeftWedge(this.measureJson,this.staffIdx);if(_i.A.getStaffIdx(t)===this.staffIdx){const n=_i.A.getPlacement(t),c=_i.A.getLocation(t),y=_i.A.getType(t),N=null,j=_i.A.getWedgeUuid(t),lt=new ea.A(y,n,c,N,j);this.tickableContent.setLeftWedgeAnchor(lt)}}},Ro.addRightContinueAnchors=function(){if(f.default.hasRightWedge(this.measureJson,this.staffIdx)){const t=f.default.getRightWedge(this.measureJson,this.staffIdx);if(_i.A.getStaffIdx(t)===this.staffIdx){const n=_i.A.getPlacement(t),c=_i.A.getLocation(t),y=_i.A.getType(t),N=null,j=new ea.A(y,n,c,N);this.tickableContent.setRightWedgeAnchor(j)}}};const Uc=Xa;var ho=r(952818),Pi=r(345912),sa=r(562062),zc=r(372585);const Va=function(){this.init()},Oo=Va.prototype;Oo.init=function(){this.tickableContent=null,this.measureJson=null,this.staffIdx=null},Oo.build=function(t,s,n,c){this.measureJson=n,this.staffIdx=c,this.tickableContent=t,this.addMiddleAnchors(s),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},Oo.addMiddleAnchors=function(t){t.sort(ho.A.compareTimePosInc),t.forEach(this.addMiddleAnchor,this)},Oo.addMiddleAnchor=function(t){const s=Pi.A.getTimePos(t),n=Pi.A.getPlacement(t),c=Pi.A.getType(t),y=Pi.A.getSize(t);let N=null;zc.A.isStart(c)&&(N=Pi.A.getOctaveShiftUuid(t));const j=null,lt=new sa.A(c,y,n,s,j,N);this.tickableContent.addMiddleOctaveShiftAnchor(lt)},Oo.addLeftContinueAnchors=function(){if(f.default.hasLeftOctaveShift(this.measureJson,this.staffIdx)){const t=f.default.getLeftOctaveShift(this.measureJson,this.staffIdx);if(Pi.A.getStaffIdx(t)===this.staffIdx){const n=Pi.A.getPlacement(t),c=Pi.A.getType(t),y=Pi.A.getSize(t),N=Pi.A.getLocation(t),j=Pi.A.getOctaveShiftUuid(t),lt=new sa.A(c,y,n,0,N,j);this.tickableContent.setLeftOctaveShiftAnchor(lt)}}},Oo.addRightContinueAnchors=function(){if(f.default.hasRightOctaveShift(this.measureJson,this.staffIdx)){const t=f.default.getRightOctaveShift(this.measureJson,this.staffIdx);if(ho.A.getStaffIdx(t)===this.staffIdx){const n=Pi.A.getPlacement(t),c=Pi.A.getType(t),y=Pi.A.getSize(t),N=Pi.A.getLocation(t),j=new sa.A(c,y,n,0,N);this.tickableContent.setRightOctaveShiftAnchor(j)}}};const kc=Va;var nn=r(368495),ia=r(197266),Xc=r(97324);const $a=function(){this.init()},No=$a.prototype;No.init=function(){this.tickableContent=null,this.measureJson=null,this.staffIdx=null},No.build=function(t,s,n,c,y){this.isTabStaff=y,this.measureJson=n,this.staffIdx=c,this.tickableContent=t,this.addMiddleAnchors(s),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},No.addMiddleAnchors=function(t){t.sort(ho.A.compareTimePosInc),t.forEach(this.addMiddleAnchor,this)},No.addMiddleAnchor=function(t){const s=nn.A.getTimePos(t);let n=nn.A.getPlacement(t);this.isTabStaff&&(n=xt.A.ABOVE);const c=nn.A.getType(t);let y=null;Xc.A.isStart(c)&&(y=nn.A.getPluckedRangeUuid(t));const N=null,j=new ia.A(c,n,s,N,y);this.tickableContent.addMiddlePluckedRangeAnchor(j)},No.addLeftContinueAnchors=function(){if(f.default.hasLeftPluckedRange(this.measureJson,this.staffIdx)){const t=f.default.getLeftPluckedRange(this.measureJson,this.staffIdx);if(nn.A.getStaffIdx(t)===this.staffIdx){const n=nn.A.getPlacement(t),c=nn.A.getType(t),y=nn.A.getLocation(t),N=nn.A.getPluckedRangeUuid(t),j=new ia.A(c,n,0,y,N);this.tickableContent.setLeftPluckedRangeAnchor(j)}}},No.addRightContinueAnchors=function(){if(f.default.hasRightPluckedRange(this.measureJson,this.staffIdx)){const t=f.default.getRightPluckedRange(this.measureJson,this.staffIdx);if(ho.A.getStaffIdx(t)===this.staffIdx){const n=nn.A.getPlacement(t),c=nn.A.getType(t),y=nn.A.getLocation(t),N=new ia.A(c,n,0,y);this.tickableContent.setRightPluckedRangeAnchor(N)}}};const Vc=$a;var na=r(613746),$c=r(868743);const Ka=function(){this.init()},Bo=Ka.prototype;Bo.init=function(){this.tickableContent=null,this.measureJson=null,this.staffIdx=null},Bo.build=function(t,s,n,c){this.measureJson=n,this.staffIdx=c,this.tickableContent=t,this.addMiddleAnchors(s),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},Bo.addMiddleAnchors=function(t){t.sort(ho.A.compareTimePosInc),t.forEach(this.addMiddleAnchor,this)},Bo.addMiddleAnchor=function(t){const s=U.A.getTimePos(t),n=U.A.getType(t);let c=null;$c.A.isStart(n)&&(c=U.A.getPedalUuid(t));const y=null,N=new na.A(n,xt.A.BELOW,s,y,c);this.tickableContent.addMiddlePedalAnchor(N)},Bo.addLeftContinueAnchors=function(){if(f.default.hasLeftPedal(this.measureJson,this.staffIdx)){const t=f.default.getLeftPedal(this.measureJson,this.staffIdx);if(U.A.getStaffIdx(t)===this.staffIdx){const n=U.A.getType(t),c=U.A.getLocation(t),y=U.A.getPedalUuid(t),N=new na.A(n,xt.A.BELOW,0,c,y);this.tickableContent.setLeftPedalAnchor(N)}}},Bo.addRightContinueAnchors=function(){if(f.default.hasRightPedal(this.measureJson,this.staffIdx)){const t=f.default.getRightPedal(this.measureJson,this.staffIdx);if(ho.A.getStaffIdx(t)===this.staffIdx){const n=U.A.getType(t),c=U.A.getLocation(t),y=new na.A(n,xt.A.BELOW,0,c);this.tickableContent.setRightPedalAnchor(y)}}};const Kc=Ka;var jc=r(153787);const wr=2.5,Qc=function(t){const s=t[0],n=s.getNbNotes();let c=0,y=0;const N=t[1],j=N.getNbNotes();let lt=0,Ft=0;for(;c<n&&lt<j;){const Kt=s.getNote(c),Se=N.getNote(lt);y===Ft?(Jc(Kt,Se),c++,lt++,y+=Kt.getDuration(),Ft+=Se.getDuration()):y<=Ft?(c++,y+=Kt.getDuration()):Ft<=y&&(lt++,Ft+=Se.getDuration())}},Jc=function(t,s){t.isRest()&&!s.isRest()?Zc(t,s):!t.isRest()&&s.isRest()?qc(t,s):t.isRest()&&s.isRest()&&tl(t,s)},Zc=function(t,s){const n=t.getDisplayData(),c=s.getDisplayData();let y=n.getLowestLine();const N=c.getHighestLine(),j=y-N;if(j<wr){let lt=wr-j;n.isRest()&&n.getBaseQuarterDuration()>1&&(lt=Math.ceil(lt)),y+=lt,n.setLine(y)}},qc=function(t,s){const n=t.getDisplayData(),c=s.getDisplayData(),y=n.getLowestLine();let N=c.getHighestLine();const j=y-N;if(j<wr){let lt=wr-j;c.isRest()&&c.getBaseQuarterDuration()>1&&(lt=Math.ceil(lt)),N-=lt,c.setLine(N)}};function tl(t,s){const n=t.getDisplayData(),c=s.getDisplayData(),y=n.getBaseQuarterDuration(),N=c.getBaseQuarterDuration();if(y!==N)return;const j=n.getNbDots(),lt=c.getNbDots();if(j!==lt)return;const Ft=n.getRestColor(),Kt=c.getRestColor();if(Ft!==Kt)return;let Se=n.getLowestLine();Se-=2,n.setLine(Se);let ke=c.getHighestLine();ke+=2,c.setLine(ke)}const el=Qc;var sl=r(732868),oa=r(589501),co=r(434243),Ii=r(808988);function il(t){const s=this;t.setParent(s)}function nl(t){const s=this;t.setDrawingContext(s)}function ol(t){t.draw()}function rl(t){return t.getWidth()}function al(t){return t.getSpaceAbove()}function hl(t){return t.getSpaceBelow()}class cl{constructor(s){this.children=s,this.posX=0,this.posY=0,this.drawingContext=null,this.parent=null,this.cssClass=null,this.groupNode=null,this.width=null,this.spaceAbove=null,this.spaceBelow=null}setDrawingContext(s){this.drawingContext=s,this.children.forEach(nl,s)}setParent(s){this.parent=s}setCssClass(s){this.cssClass=s}setPosition(s,n){this.posX=s,this.posY=n}draw(){this.render(),this.format(),this.move(),this.drawContent(),this.bindToParent()}render(){this.groupNode===null&&(this.groupNode=new L.A("g"),this.children.forEach(il,this.groupNode),this.cssClass!==null&&this.groupNode.attr("class",this.cssClass))}format(){let s=0;const n=0,c=this.getMarginSize();this.children.forEach(y=>{y.setPosition(s,n),s+=y.getWidth(),s+=c})}getMarginSize(){return this.drawingContext.getMarginSize()/4}move(){this.groupNode&&this.groupNode.attr("transform",`translate(${this.posX}, ${this.posY})`)}drawContent(){this.children.forEach(ol)}bindToParent(){this.parent.append(this.groupNode)}getWidth(){if(this.width===null){const s=this.children.map(rl),c=this.getMarginSize()*this.children.length-1,y=s.reduce(Bt.default.add);this.width=y+c}return this.width}getSpaceBelow(){if(this.spaceBelow===null){const s=this.children.map(hl);s.push(0),this.spaceBelow=Math.max.apply(null,s)}return this.spaceBelow}getSpaceAbove(){if(this.spaceAbove===null){const s=this.children.map(al);s.push(0),this.spaceAbove=Math.max.apply(null,s)}return this.spaceAbove}getGroup(){return this.groupNode}}class ll{constructor(s,n){this.glyphId=s,this.slashedEntity=n,this.posX=0,this.posY=0,this.drawingContext=null,this.parent=null,this.cssClass=null,this.glyph=null,this.pathNode=null,this.groupNode=null,this.width=null,this.spaceAbove=null,this.spaceBelow=null}setDrawingContext(s){this.drawingContext=s,this.slashedEntity.setDrawingContext(s)}setParent(s){this.parent=s}setCssClass(s){this.cssClass=s}setPosition(s,n){this.posX=s,this.posY=n}getGlyph(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph}draw(){this.render(),this.move(),this.format(),this.drawContent(),this.bindToParent()}render(){if(this.pathNode===null){this.pathNode=new L.A("path");const n=this.getGlyph().render();this.pathNode.attr("d",n),this.groupNode=new L.A("g"),this.slashedEntity.setParent(this.groupNode),this.cssClass!==null&&this.groupNode.attr("class",this.cssClass)}}move(){this.groupNode&&this.groupNode.attr("transform",`translate(${this.posX}, ${this.posY})`)}bindToParent(){this.parent.append(this.groupNode)}format(){const s=this.getWidth(),n=0,c=this.getGlyph(),y=(s-c.getWidth())/2;this.pathNode.attr("transform",`translate(${y}, ${n})`);const N=(s-this.slashedEntity.getWidth())/2;this.slashedEntity.setPosition(N,n)}drawContent(){this.slashedEntity.draw(),this.groupNode.append(this.pathNode)}getWidth(){if(this.width===null){const s=this.slashedEntity.getWidth(),n=this.getGlyph(),c=Math.max(0,n.getBBoxNE().x);this.width=Math.max(s,c)}return this.width}getSpaceBelow(){if(this.spaceBelow===null){const s=this.slashedEntity.getSpaceBelow(),n=this.getGlyph(),c=Math.max(0,n.getBBoxSW().y);this.spaceBelow=Math.max(s,c)}return this.spaceBelow}getSpaceAbove(){if(this.spaceAbove===null){const s=this.slashedEntity.getSpaceAbove(),n=this.getGlyph(),c=Math.max(0,-n.getBBoxNE().y);this.spaceAbove=Math.max(s,c)}return this.spaceAbove}getGroup(){return this.groupNode}}const ul=v.default.fromPairs([{key:co.A.FLAT,value:"figbassFlat"},{key:co.A.FLATFLAT,value:"figbassDoubleFlat"},{key:co.A.NATURAL,value:"figbassNatural"},{key:co.A.SHARP,value:"figbassSharp"},{key:co.A.SHARPSHARP,value:"figbassDoubleSharp"},{key:co.A.PLUS,value:"figbassPlus"}]),ra=v.default.fromPairs([{key:"0",value:"figbass0"},{key:"1",value:"figbass1"},{key:"2",value:"figbass2"},{key:`2${Ii.A.VERTICAL}`,value:"figbass2Raised"},{key:"3",value:"figbass3"},{key:"4",value:"figbass4"},{key:`4${Ii.A.VERTICAL}`,value:"figbass4Raised"},{key:"5",value:"figbass5"},{key:`5${Ii.A.VERTICAL}`,value:"figbass5Raised1"},{key:`5${Ii.A.BACK_SLASH}`,value:"figbass5Raised2"},{key:`5${Ii.A.SLASH}`,value:"figbass5Raised3"},{key:"6",value:"figbass6"},{key:`6${Ii.A.BACK_SLASH}`,value:"figbass6Raised"},{key:"7",value:"figbass7"},{key:`7${Ii.A.VERTICAL}`,value:"figbass7Raised1"},{key:`7${Ii.A.BACK_SLASH}`,value:"figbass7Raised2"},{key:"8",value:"figbass8"},{key:"9",value:"figbass9"},{key:`9${Ii.A.BACK_SLASH}`,value:"figbass9Raised"}]),fl=v.default.fromPairs([{key:Ii.A.BACK_SLASH,value:"figbassCombiningLowering"},{key:Ii.A.SLASH,value:"figbassCombiningRaising"}]),dl="figure";class gl{build({number:s,alter:n}){if(this.entities=[],co.A.isValid(n)&&this.buildPrefix(n),this.entities.length===0&&typeof s!="number"&&(s=3),typeof s=="number"){const y=pl(s,n);typeof ra[y]=="string"?this.buildLigature(y):this.buildComposed(s,n)}const c=ja(this.entities);return c.setCssClass(dl),c}buildPrefix(s){const n=ul[s],c=new Vs(n);this.entities.push(c)}buildLigature(s){const n=ra[s],c=new Vs(n);this.entities.push(c)}buildComposed(s,n){const y=Bt.default.toDigitArray(s).map(ml);let N=ja(y);if(n===Ii.A.BACK_SLASH||n===Ii.A.SLASH){const j=fl[n];N=new ll(j,N)}this.entities.push(N)}}function pl(t,s){let n=t.toString();return Ii.A.isValid(s)&&(n+=s),n}function ja(t){if(t.length===0)throw new F.default("Empty glyph array unexpected");return t.length===1?t[0]:new cl(t)}function ml(t){const s=ra[t];return new Vs(s)}const Al="adagio-figuredBass-uuid";class Sl{constructor(s,n){Object.defineProperty(this,"elem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timePos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.elem=s,this.timePos=n,this.uuid=null}getTimePos(){return this.timePos}setPosition(s,n){this.elem.setPosition(s,n)}setPosX(s){this.elem.setPosition(s,this.elem.posY)}setPosY(s){this.elem.setPosition(this.elem.posX,s)}draw(){this.elem.draw(),this.elem.getGroup().setDataEntry(Al,this.uuid)}setParent(s){this.elem.setParent(s)}setDrawingContext(s){this.elem.setDrawingContext(s)}getWidth(){return this.elem.getWidth()}getSpaceAbove(){return this.elem.getSpaceAbove()}getSpaceBelow(){return this.elem.getSpaceBelow()}setCssClass(s){this.elem.setCssClass(s)}setUuid(s){this.uuid=s}move(){this.elem.move()}}const Qa=2,yl="adagio-figuredBass-figure-level";function Pl(t){const s=this;t.setParent(s)}function wl(t){const s=this;t.setDrawingContext(s)}function Dl(t){t.draw()}function Cl(t,s){t.getGroup().setDataEntry(yl,s)}function xl(t){return t.getWidth()}class vl{constructor(s){this.children=s,this.posX=0,this.posY=0,this.drawingContext=null,this.parent=null,this.cssClass=null,this.groupNode=null,this.width=null,this.spaceBelow=null}setDrawingContext(s){this.drawingContext=s,this.children.forEach(wl,s)}setParent(s){this.parent=s}setCssClass(s){this.cssClass=s}setPosition(s,n){this.posX=s,this.posY=n}draw(){this.render(),this.format(),this.move(),this.drawContent(),this.bindToParent()}render(){this.groupNode===null&&(this.groupNode=new L.A("g"),this.children.forEach(Pl,this.groupNode),this.cssClass!==null&&this.groupNode.attr("class",this.cssClass))}format(){let n=0;const c=this.getSpaceBetweenEntities();this.children.forEach(y=>{y.setPosition(0,n),n+=c})}getSpaceBetweenEntities(){return this.drawingContext.getSpaceSize()*Qa}move(){this.groupNode&&this.groupNode.attr("transform",`translate(${this.posX}, ${this.posY})`)}drawContent(){this.children.forEach(Dl),this.children.forEach(Cl)}bindToParent(){this.parent.append(this.groupNode)}getWidth(){if(this.width===null){const s=this.children.map(xl);this.width=Math.max.apply(null,s)}return this.width}getSpaceBelow(){if(this.spaceBelow===null){const n=this.children[this.children.length-1].getSpaceBelow(),c=this.getSpaceBetweenEntities();this.spaceBelow=n+(this.children.length-1)*c}return this.spaceBelow}getSpaceAbove(){return this.children[0].getSpaceAbove()}getGroup(){return this.groupNode}}const Tl="figuredBass";class Ll{constructor(){this.figureBuilder=new gl}build(s){const n=oa.A.getTimePos(s),c=oa.A.getUuid(s),N=oa.A.getFiguresData(s).map(this.figureBuilder.build,this.figureBuilder),j=new vl(N),lt=new Sl(j,n);return lt.setCssClass(Tl),lt.setUuid(c),lt}}const Ja=function(){this.init()},es=Ja.prototype;es.init=function(){this.voiceBuilder=new Wc,this.wedgeAnchorsBuilder=new Uc,this.octaveShiftAnchorsBuilder=new kc,this.pluckedRangeAnchorsBuilder=new Vc,this.pedalAnchorsBuilder=new Kc,this.harmonyBuilder=new jc.A,this.classicHarmonyBuilder=new sl.A,this.figuredBassBuilder=new Ll},es.build=function(t){this.reset(t);const{measureJson:s,staffIdx:n,voicesData:c,voicesNotes:y,attrs:N}=t;this.nbMmr!==null&&!this.isRecorderStaff()?this.buildMmrVoice(c,y):f.default.hasMeasureRepeat(s,n)?this.buildMeasureRepeatVoice(c,y):this.buildVoices(c,y),this.isTabStaff()&&n===0&&(this.buildWedges(!0),this.buildPluckedRanges(!0),this.buildWords(),this.buildDynamics()),!this.isTabStaff()&&!this.isKodalyStaff()&&(this.buildWedges(),this.buildOctaveShifts(),this.buildPluckedRanges(),this.displayOpts.usePedalLine&&this.buildPedals(),this.buildDynamics(),this.buildPizzicatos(),this.buildMutes(),this.buildWords(),this.displayOpts.usePedalLine||this.buildPedal()),n===0&&this.buildChords(),this.buildMiddleClefs();const j=N.getNbStaves();return n===j-1&&(this.buildClassicChords(),this.buildFiguredBasses()),this.tickableContent},es.reset=function({voicesNotes:t,measureJson:s,attrs:n,staffIdx:c,displayOpts:y,previousMeasure:N,nextMeasure:j,voicesData:lt,voiceUuidMapping:Ft,isPickup:Kt,nbMmr:Se}){this.measureJson=s,this.attrs=n,this.staffIdx=c,this.displayOpts=y,this.previousMeasure=N,this.nextMeasure=j,this.voicesData=lt,this.nbVoices=v.default.getSize(t),this.voicesNotes=t,this.voiceUuidMapping=Ft,this.isPickup=Kt,this.nbMmr=Se,this.tickableContent=new Wo;const ke=n.getDpq();this.tickableContent.setDpq(ke);const Cs=n.getNbDivisions();this.tickableContent.setNbDivisions(Cs),this.harmonyBuilder.setDisplayOpts(y)},es.buildMeasureRepeatVoice=function(t,s){const n=t.voices.filter(aa,s);let[c]=n;this.tickableContent.setVoicesIndexes([c]),c=Bt.default.intPart(c);const y=this.getStemStrategy(c),N={staffIdx:this.staffIdx,voiceIdx:Bt.default.intPart(c),voiceUuid:this.voiceUuidMapping[c]},j=this.voiceBuilder.buildMeasureRepeat(this.attrs,N,this.previousMeasure,this.nextMeasure,y,this.isPickup);this.tickableContent.addVoice(j)},es.buildMmrVoice=function(t,s){const n=t.voices.filter(aa,s);let[c]=n;this.tickableContent.setVoicesIndexes([c]),c=Bt.default.intPart(c);const y=this.getStemStrategy(c),N={staffIdx:this.staffIdx,voiceIdx:Bt.default.intPart(c),voiceUuid:this.voiceUuidMapping[c]},j=this.voiceBuilder.buildMMR(this.attrs,N,this.previousMeasure,this.nextMeasure,y,this.isPickup,this.nbMmr);this.tickableContent.setMeasureNumberShift(this.nbMmr),this.tickableContent.addVoice(j)},es.buildVoices=function(t,s){t.voices.forEach(this.addVoiceCrossSlurs,this);const n=t.voices.filter(aa,s);this.tickableContent.setVoicesIndexes(n),n.forEach(this.buildVoice,this),n.length>1&&this.shiftRests()},es.addVoiceCrossSlurs=function(t){if(f.default.hasLeftSlur(this.measureJson,t)){const s=f.default.getLeftSlur(this.measureJson,t),n=Qt.default.getPlacement(s),c=new hn.A(zt.A.START,null,t,s.slurUuid,n);this.tickableContent.setLeftSlurAnchor(c,t)}if(f.default.hasRightSlur(this.measureJson,t)){const s=new hn.A(zt.A.STOP,null,t);this.tickableContent.setRightSlurAnchor(s,t)}};const aa=function(t){return typeof this[t]!="undefined"};es.buildVoice=function(t,s,n){const c=this.voicesNotes[t],y=n.length;t=Bt.default.intPart(t);const N=this.getStemStrategy(t),j={staffIdx:this.staffIdx,voiceIdx:Bt.default.intPart(t),voiceUuid:this.voiceUuidMapping[t]},lt=this.voiceBuilder.build({voiceNotes:c,measureJson:this.measureJson,attrs:this.attrs,location:j,previousMeasure:this.previousMeasure,nextMeasure:this.nextMeasure,stemStrategy:N,isPickup:this.isPickup,nbVoices:y});this.tickableContent.addVoice(lt)},es.getStemStrategy=function(t){return this.nbVoices===1?this.isPercu()?t===this.voicesData.voices[0]?It.A.UP_UNPITCHED:It.A.DOWN_UNPITCHED:It.A.AUTO:t===this.voicesData.voices[0]?(this.isPercu(),It.A.UP):(this.isPercu(),It.A.DOWN)},es.shiftRests=function(){const t=this.tickableContent.getOrderedVoices();el(t)},es.isTabStaff=function(){const t=this.attrs.getStaffDetails(this.staffIdx);return ae.default.hasStaffTuning(t)},es.isRecorderStaff=function(){const t=this.attrs.getStaffDetails(this.staffIdx);return ae.default.hasRecorderTabs(t)},es.isPercu=function(){const t=this.attrs.getClef(this.staffIdx);return p.default.isPercussion(t)},es.isKodalyStaff=function(){const t=this.attrs.getStaffDetails(this.staffIdx);return ae.default.hasKodaly(t)},es.buildWedges=function(t){const s=f.default.getWedges(this.measureJson,this.staffIdx);this.wedgeAnchorsBuilder.build(this.tickableContent,s,this.measureJson,this.staffIdx,t)},es.buildOctaveShifts=function(){const t=f.default.getOctaveShifts(this.measureJson,this.staffIdx);this.octaveShiftAnchorsBuilder.build(this.tickableContent,t,this.measureJson,this.staffIdx)},es.buildPluckedRanges=function(t){const s=f.default.getPluckedRanges(this.measureJson,this.staffIdx);this.pluckedRangeAnchorsBuilder.build(this.tickableContent,s,this.measureJson,this.staffIdx,t)},es.buildPedals=function(){const t=f.default.getPedals(this.measureJson,this.staffIdx);this.pedalAnchorsBuilder.build(this.tickableContent,t,this.measureJson,this.staffIdx)},es.buildDynamics=function(){const t=f.default.getDynamics(this.measureJson,this.staffIdx),s=this.isTabStaff();t.map(El,s).forEach(this.tickableContent.addDirection,this.tickableContent)};const El=function(t){const s=this;let n=fs.A.getPlacement(t);s&&(n=xt.A.ABOVE);const c=fs.A.getStyle(t),y=fs.A.getTimePos(t),N=fs.A.getDynamicUuid(t),j=0,lt=0;return new pi.A(n,c,y,N,j,lt)};es.buildPizzicatos=function(){f.default.getPizzicatos(this.measureJson,this.staffIdx).map(bl).forEach(this.tickableContent.addPizzicato,this.tickableContent)};const bl=function(t){const s=ds.A.getPlacement(t),n=ds.A.getType(t),c=ds.A.getTimePos(t),y=ds.A.getPizzicatoUuid(t);return new Ce.A(s,n,c,y)};es.buildMutes=function(){f.default.getMutes(this.measureJson,this.staffIdx).map(Ml).forEach(this.tickableContent.addMute,this.tickableContent)};const Ml=function(t){const s=Gt.A.getPlacement(t),n=Gt.A.getType(t),c=Gt.A.getTimePos(t),y=Gt.A.getUuid(t);return new vs.A({placement:s,type:n,timePos:c,uuid:y})};es.buildWords=function(){f.default.getWords(this.measureJson,this.staffIdx).map(Rl).forEach(this.tickableContent.addWord,this.tickableContent)};const Rl=function(t){const s=Xe.A.getPlacement(t),n=Xe.A.getText(t),c=Xe.A.getTimePos(t),y=Xe.A.getWordUuid(t);return new Go(s,n,c,y)};es.buildChords=function(){this.getHarmonies().map(this.harmonyBuilder.build,this.harmonyBuilder).forEach(this.tickableContent.addChord,this.tickableContent)},es.buildMiddleClefs=function(){f.default.getMiddleClefs(this.measureJson,this.staffIdx).map(Ol).forEach(this.tickableContent.addMiddleClef,this.tickableContent)};function Ol(t){const s=new yn(t),n=p.default.getTimePos(t),c=p.default.getClefUuid(t);return s.setTimePos(n),s.setUuid(c),s}es.getHarmonies=function(){return this.displayOpts.isConcertPitch?f.default.getConcertHarmonies(this.measureJson):f.default.getJazzHarmonies(this.measureJson)},es.buildClassicChords=function(){f.default.getClassicHarmonies(this.measureJson).map(this.classicHarmonyBuilder.build,this.classicHarmonyBuilder).forEach(this.tickableContent.addClassicChord,this.tickableContent)},es.buildFiguredBasses=function(){f.default.getFiguredBasses(this.measureJson).map(this.figuredBassBuilder.build,this.figuredBassBuilder).forEach(this.tickableContent.addFiguredBass,this.tickableContent)},es.buildPedal=function(){f.default.getPedals(this.measureJson,this.staffIdx).map(Nl).forEach(this.tickableContent.addPedal,this.tickableContent)};const Nl=function(t){const s=U.A.getTimePos(t),n=U.A.getPlacement(t),c=U.A.getType(t);return new Uo.A(c,n,s)},Bl=Ja;var ir=r(259563),Hl=r(637475);const wi={GLOBAL_RATIO:.8},Dr=function(t){this.init(t)};Dr.NAME="metronome.note";const Rs=Dr.prototype;Rs.name=Dr.NAME,Rs.init=function(t){this.durationType=t,this.group=null,this.parent=null,this.drawingContext=null,this.dots=null,this.noteBodyPath=null,this.noteBodyGlyph=null,this.posX=null,this.posY=null},Rs.setDots=function(t){this.dots=t},Rs.setParent=function(t){this.parent=t},Rs.setDrawingContext=function(t){this.drawingContext=t,this.dots!==null&&this.dots.setDrawingContext(t)},Rs.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},Rs.isRendered=function(){return this.group!==null},Rs.render=function(){this.group=new L.A("g"),this.group.attr("class",this.name);const t=this.getNoteGlyph();this.noteBodyPath=new L.A("path"),this.noteBodyPath.attr("class","metronome.noteBody"),this.noteBodyPath.attr("d",t.render()),this.group.append(this.noteBodyPath),this.dots!==null&&this.dots.setParent(this.group)},Rs.format=function(){const t=this.getNoteBodyY();if(this.noteBodyPath.attr("transform",`translate(0, ${t})`),this.dots!==null){const s=this.getHeadWidth(),n=this.getMargin(),c=s+n,y=this.drawingContext.getSpaceSize()*wi.GLOBAL_RATIO,N=t+y/4;this.dots.setPosition(c,N)}},Rs.drawContent=function(){this.dots!==null&&this.dots.draw()},Rs.setPosX=function(t){this.posX=t},Rs.setPosY=function(t){this.posY=t},Rs.move=function(){this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},Rs.bindToParent=function(){this.parent.append(this.group)},Rs.getSpaceAbove=function(){const t=this.getNoteGlyph(),s=-this.getNoteBodyY();return-t.getBBoxNE().y+s},Rs.getWidth=function(){let t=this.getNoteGlyph().getWidth();if(this.dots!==null){const s=this.getMargin(),n=this.getHeadWidth(),c=this.dots.getWidth(),y=n+s+c;t=Math.max(t,y)}return t},Rs.getNoteGlyph=function(){if(this.noteBodyGlyph===null){const t="metNote",s=Hl.A.fromDurationType(this.durationType),n=this.hasNoStem()?"":"Up",c=t+s+n;this.noteBodyGlyph=this.drawingContext.getScaledGlyph(c,wi.GLOBAL_RATIO)}return this.noteBodyGlyph},Rs.getMargin=function(){return this.drawingContext.getSpaceSize()/2*wi.GLOBAL_RATIO},Rs.getHeadWidth=function(){let t;return this.durationType===ir.default.FULL?t="metNoteWhole":this.durationType===ir.default.HALF?t="metNoteHalfUp":this.durationType>=ir.default.QUARTER?t="metNoteQuarterUp":ir.default.raiseError(this.durationType),this.drawingContext.getScaledGlyph(t,wi.GLOBAL_RATIO).getWidth()},Rs.getNoteBodyY=function(){const t=this.drawingContext.getSpaceSize()*wi.GLOBAL_RATIO;return this.hasNoStem()?-t/2:-t/4},Rs.hasNoStem=function(){return this.durationType===ir.default.FULL};const _l=Dr,Cr=function(){this.init()};Cr.NAME="metronome";const cs=Cr.prototype;cs.name=Cr.NAME,cs.init=function(){this.group=null,this.parent=null,this.drawingContext=null,this.note=null,this.text=null,this.spaceAbove=null,this.posX=null,this.posY=null},cs.setParent=function(t){this.parent=t},cs.setNote=function(t){this.note=t},cs.setTextStr=function(t){const s={text:t};this.text=new bs.A(s)},cs.setPosX=function(t){this.posX=t},cs.setPosY=function(t){this.posY=t},cs.setDrawingContext=function(t){if(this.drawingContext=t,this.text!==null){this.text.setDrawingContext(t);const s=this.drawingContext.getTempoFontSize();this.text.setFontSize(s*wi.GLOBAL_RATIO);const n=this.drawingContext.getTempoFontFamily();this.text.options["font-family"]=n;const c=this.drawingContext.getTempoFontWeight();this.text.options["font-weight"]=c;const y=this.drawingContext.getTempoFontStyle();this.text.options["font-style"]=y}this.note!==null&&this.note.setDrawingContext(t)},cs.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},cs.isRendered=function(){return this.group!==null},cs.render=function(){this.group=new L.A("g"),this.group.attr("class",this.name),this.text!==null&&this.text.setParent(this.group),this.note!==null&&this.note.setParent(this.group)},cs.format=function(){this.formatX(),this.formatY()},cs.formatX=function(){let t=0;this.note!==null&&(this.note.setPosX(0),t+=this.note.getWidth()),this.text!==null&&(t>0&&(t+=this.getMargin()),this.text.setXPos(t))},cs.getMargin=function(){return this.drawingContext.getSpaceSize()/2*wi.GLOBAL_RATIO},cs.formatY=function(){const t=this.getSpaceAbove();this.note!==null&&this.note.setPosY(t),this.text!==null&&this.text.setYPos(t)},cs.drawContent=function(){this.note.draw(),this.text.render(),this.text.setCssClass("metronome.text"),this.text.draw()},cs.move=function(){this.isRendered()&&this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},cs.bindToParent=function(){this.parent.append(this.group)},cs.removeFromParent=function(){this.group.removeFromParent()},cs.getWidth=function(){let t=0;return this.note!==null&&(t+=this.note.getWidth()),this.text!==null&&(t>0&&(t+=this.getMargin()),t+=this.text.getWidth()),t},cs.getHeight=function(){const t=this.getSpaceAbove(),s=this.getSpaceBelow();return t+s},cs.getSpaceAbove=function(){if(this.spaceAbove===null){let t=0;if(this.text!==null){const s=this.text.fontSize;t=Math.max(t,s)}if(this.note!==null){const s=this.note.getSpaceAbove();t=Math.max(t,s)}this.spaceAbove=t}return this.spaceAbove},cs.getSpaceBelow=function(){return this.drawingContext.getTempoFontSize()/2*wi.GLOBAL_RATIO},cs.getPreviousSpace=function(){return this.drawingContext.getSpaceSize()};const Il=Cr,Yl="metAugmentationDot",xr=function(t){this.init(t)};xr.NAME="metronome.dots";const Di=xr.prototype;Di.name=xr.NAME,Di.init=function(t){this.parent=null,this.group=null,this.dots=[],this.glyph=null,this.width=null,this.drawingContext=null,this.posX=null,this.posY=null,this.nbDots=t},Di.setParent=function(t){this.parent=t},Di.setDrawingContext=function(t){this.drawingContext=t},Di.setPosition=function(t,s){this.posX=t,this.posY=s},Di.draw=function(){this.isRendered()||(this.render(),this.format()),this.move(),this.bindToParent()},Di.isRendered=function(){return this.group!==null},Di.render=function(){this.group=new L.A("g"),this.group.attr("class",this.name);for(let t=0;t<this.nbDots;t++)this.renderDot()},Di.renderDot=function(){const t=this.getGlyph(),s=t.render(),n=t.getWidth(),y=this.dots.length===0?0:this.getMargin(),N=new L.A("path");N.attr("class","metronome.dots"),N.attr("d",s),this.group.append(N);const j={path:N,width:n,spaceBefore:y};this.dots.push(j)},Di.format=function(){this.dots.reduce(Fl,0)};const Fl=function(t,s){return t+=s.spaceBefore,s.path.attr("transform",`translate(${t}, 0)`),t+=s.width,t};Di.move=function(){this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},Di.bindToParent=function(){this.parent.append(this.group)},Di.getWidth=function(){if(this.width===null){const s=this.getGlyph().getWidth(),n=this.getMargin();this.width=s*this.nbDots+n*(this.nbDots-1)}return this.width},Di.getMargin=function(){return this.drawingContext.getSpaceSize()*wi.GLOBAL_RATIO/2},Di.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getScaledGlyph(Yl,wi.GLOBAL_RATIO)),this.glyph};const Wl=xr,Za=function(){},ha=Za.prototype;ha.buildFromJson=function(){return this.build()},ha.build=function(t,s,n){const c=new Il;c.setTextStr(n);const y=this.createNote(t,s);return c.setNote(y),c},ha.createNote=function(t,s){const n=new _l(t);if(s>0){const c=new Wl(s);n.setDots(c)}return n};const Gl=Za;var qa=r(398719),th=r(498554),eh=r(822605);const sh=function(t,s){this.init(t,s)},Wn=sh.prototype;Wn.init=function(t,s){this.measureJson=t,this.displayOpts=s,this.voicesNotes=null,this.attrs=null},Wn.getFirstNoteDisplayData=function(t,s){const n=this.getFirstNoteJson(t),c=this.getAttrs();return(0,qr.A)(n,c,s)},Wn.getFirstNoteJson=function(t){return this.getVoiceNotes(t)[0].chordJson},Wn.getLastNoteDisplayData=function(t,s){const n=this.getLastNoteJson(t),c=this.getAttrs();return(0,qr.A)(n,c,s)},Wn.getLastNoteJson=function(t){const s=this.getVoiceNotes(t),n=s.length;return s[n-1].chordJson},Wn.getVoiceNotes=function(t){return this.getVoicesNotes()[t]},Wn.hasVoice=function(t){return typeof this.getVoicesNotes()[t]!="undefined"},Wn.getVoicesNotes=function(){if(this.voicesNotes===null){const t=f.default.getNotes(this.measureJson),s=(0,th.A)(t);this.voicesNotes=v.default.map(s,eh.A)}return this.voicesNotes},Wn.getAttrs=function(){return this.attrs===null&&(this.attrs=new qa.A(this.measureJson,this.displayOpts)),this.attrs};const ih=sh;var Gn=r(346797),ca=r(619370),Ul=r(909748);const nh=function(){},nr=nh.prototype;nr.build=function(t,s,n,c,y){this.measure=t,this.dpq=s,this.tempoChanges=n,this.leftTempoChange=c,this.rightTempoChange=y,this.addMiddleAnchors(),this.addLeftContinueAnchors(),this.addRightContinueAnchors()},nr.addMiddleAnchors=function(){const t=this.tempoChanges!==null?this.tempoChanges.slice():[];t.sort(ho.A.compareTimePosInc),t.forEach(this.addMiddleAnchor,this)},nr.addMiddleAnchor=function(t){let s=Gn.A.getTimePos(t);const n=Gn.A.getDpq(t);s*=this.dpq,s/=n;const c=Gn.A.getType(t);let y=null;Ul.A.isStart(c)&&(y=Gn.A.getTempoChangeUuid(t));const N=null,j=new ca.A(c,Zi.A.ABOVE,s,N,y);this.measure.addMiddleTempoChangeAnchor(j)},nr.addLeftContinueAnchors=function(){if(this.leftTempoChange!==null){const t=Gn.A.getType(this.leftTempoChange),s=Gn.A.getLocation(this.leftTempoChange),n=Gn.A.getTempoChangeUuid(this.leftTempoChange),c=new ca.A(t,Zi.A.ABOVE,0,s,n);this.measure.setLeftTempoChangeAnchor(c)}},nr.addRightContinueAnchors=function(){if(this.rightTempoChange!==null){const t=Gn.A.getType(this.rightTempoChange),s=Gn.A.getLocation(this.rightTempoChange),n=new ca.A(t,Zi.A.ABOVE,0,s);this.measure.setRightTempoChangeAnchor(n)}};const zl=nh,oh=function(){this.init()},Hs=oh.prototype;Hs.cssClass="jumpCall",Hs.init=function(){this.group=null,this.parentGroup=null,this.drawingContext=null,this.contentDrawn=!1,this.measureWidth=null,this.width=null,this.height=null,this.posY=null,this.list=[]},Hs.needRender=function(){return this.group===null},Hs.setParent=function(t){this.parentGroup=t},Hs.push=function(t){this.list.push(t)},Hs.bindToParent=function(){this.parentGroup.append(this.group)},Hs.removeFromParent=function(){this.group.removeFromParent()},Hs.setDrawingContext=function(t){this.drawingContext=t,this.list.forEach(this.transferDrawingContext,this)},Hs.transferDrawingContext=function(t){t.setDrawingContext(this.drawingContext)},Hs.setMeasureWidth=function(t){this.measureWidth=t},Hs.setPosY=function(t){this.posY=t},Hs.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.list.forEach(this.transferParent,this),this.list.forEach(kl)},Hs.transferParent=function(t){t.setParent(this.group)};const kl=function(t){t.render()};Hs.draw=function(){this.needRender()&&this.render(),this.drawContent(),this.move(),this.bindToParent()},Hs.drawContent=function(){this.contentDrawn=!0,this.format(),this.list.forEach(Vl)},Hs.format=function(){this.list.reduce(Xl,0)};const Xl=function(t,s){return t>0&&(t+=s.getSpaceBefore()),s.setPosX(t),t+=s.getWidth(),t},Vl=function(t){t.draw()};Hs.move=function(){if(!this.needRender()){const t=this.getWidth(),s=this.measureWidth-t,n=this.posY;this.group.attr("transform",`translate(${s} ${n})`)}},Hs.getHeight=function(){return this.height===null&&(this.height=this.list.reduce($l,0)),this.height};const $l=function(t,s){const n=s.getHeight();return Math.max(t,n)};Hs.getWidth=function(){return this.width===null&&(this.width=this.list.reduce(Kl,0)),this.width};const Kl=function(t,s){return t>0&&(t+=s.getSpaceBefore()),t+=s.getWidth(),t};Hs.getMarginSize=function(){return this.drawingContext.getSpaceSize()/2};const jl=oh,rh=function(t){this.init(t)},gi=rh.prototype;gi.cssClass="jumpCallText",gi.init=function(t){this.group=null,this.parentGroup=null,this.drawingContext=null,this.measureWidth=null,this.posX=null,this.text=null,this.textContent=t},gi.needRender=function(){return this.group===null},gi.setParent=function(t){this.parentGroup=t},gi.setPosX=function(t){this.posX=t},gi.bindToParent=function(){this.parentGroup.append(this.group)},gi.setDrawingContext=function(t){this.drawingContext=t,this.text!==null&&this.text.setDrawingContext(t)},gi.setMeasureWidth=function(t){this.measureWidth=t},gi.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.text!==null&&this.text.setParent(this.group)},gi.draw=function(){this.needRender()&&this.render(),this.drawContent(),this.move(),this.bindToParent()},gi.drawContent=function(){const t=this.getText();t.render(),t.draw()},gi.getText=function(){if(this.text===null){const t=new bs.A({text:this.textContent,"font-size":this.drawingContext.getJumpsFontSize()});t.setParent(this.group),t.setDrawingContext(this.drawingContext),this.text=t}return this.text},gi.move=function(){this.needRender()||this.group.attr("transform",`translate(${this.posX} 0)`)},gi.getWidth=function(){return this.getText().getWidth()},gi.getHeight=function(){return this.getText().getFontSize()},gi.getSpaceBefore=function(){return this.drawingContext.getMarginSize()};const ah=rh;var un=r(607801);const hh=He.default.pairsToMap([{key:un.A.DALSEGNO,value:"dalSegno"},{key:un.A.DACAPO,value:"daCapo"}]),ch=function(t){this.init(t)},oi=ch.prototype;oi.cssClass="jumpCallGlyph",oi.init=function(t){this.group=null,this.parentGroup=null,this.drawingContext=null,this.posX=null,this.glyph=null,this.jumpType=t},oi.needRender=function(){return this.group===null},oi.setParent=function(t){this.parentGroup=t},oi.bindToParent=function(){this.parentGroup.append(this.group)},oi.setDrawingContext=function(t){this.drawingContext=t},oi.setPosX=function(t){this.posX=t},oi.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass)},oi.draw=function(){this.needRender()&&this.render(),this.drawContent(),this.move(),this.bindToParent()},oi.drawContent=function(){const t=this.getGlyph();this.group.append("path").attr("d",t.render())},oi.getGlyphId=function(){return hh[this.jumpType]},oi.getGlyph=function(){if(this.glyph===null){const t=this.getGlyphId();this.glyph=this.drawingContext.getGlyph(t)}return this.glyph},oi.move=function(){!this.needRender()&&this.hasGlyph()&&this.group.attr("transform",`translate(${this.posX} 0)`)},oi.getWidth=function(){return this.getGlyph().getWidth()},oi.getHeight=function(){return this.getGlyph().getHeight()},oi.hasGlyph=function(){return typeof hh[this.jumpType]!="undefined"},oi.getSpaceBefore=function(){return 0};const Ql=ch,lh=He.default.pairsToMap([{key:un.A.FINE,value:"Fine"},{key:un.A.TOCODA,value:"To Coda"}]),uh=He.default.pairsToMap([{key:un.A.FINE,value:" al Fine"},{key:un.A.TOCODA,value:" al Coda"}]),Jl=He.default.pairsToMap([{key:un.A.DALSEGNO,value:"Fine"},{key:un.A.DACAPO,value:"To Coda"}]),fh=function(){this.init()},dh=fh.prototype;dh.init=function(){},dh.build=function(t,s){const n=new jl;let c;if(Zl(t)){if(c=new Ql(t),n.push(c),ql(s)){const y=su(s);c=new ah(y),n.push(c)}}else if(tu(t)){const y=eu(t);c=new ah(y),n.push(c)}else un.A.raiseBadJumpCall(n);return n};const Zl=function(t){return typeof Jl[t]!="undefined"},ql=function(t){return typeof uh[t]!="undefined"},tu=function(t){return typeof lh[t]!="undefined"},eu=function(t){return lh[t]},su=function(t){return uh[t]},iu=fh;var la=r(719476),fn=r(312395);const gh=function(t){this.init(t)},ls=gh.prototype;ls.init=function(t){this.measure=null,this.ending=null,this.measureIdx=null,this.location=t,this.text=null,this.rightClosed=null,this.drawingContext=null},ls.setMeasure=function(t){this.measure=t},ls.setText=function(t){this.text=t},ls.hasText=function(){return this.text!==null},ls.getText=function(){return this.text},ls.isLeftClosed=function(){return this.text!==null},ls.setRightClosed=function(t){this.rightClosed=t},ls.isRightClosed=function(){return this.rightClosed},ls.setMeasureIdx=function(t){this.measureIdx=t},ls.isLeft=function(){return fn.A.isLeft(this.location)},ls.isRight=function(){return fn.A.isRight(this.location)},ls.setDrawingContext=function(t){this.drawingContext=t},ls.getDrawingContext=function(){return this.drawingContext},ls.getType=function(){return this.type},ls.getX=function(){if(fn.A.isLeft(this.location))return this.getLeftX();if(fn.A.isRight(this.location))return this.getRightX();throw new F.default("Unexpected")},ls.getLeftX=function(){return this.measure.getXPos()},ls.getRightX=function(){const t=this.measure,s=t.tickableContent,n=t.getXPos()+s.getXPos(),c=t.getNextJumpTagOverflow();return n+s.getWidth()-c},ls.getY=function(){return this.measure.getEndingY()},ls.hasEnding=function(){return this.ending!==null},ls.setEnding=function(t){this.ending=t},ls.removeEnding=function(){fn.A.isLeft(this.location)?this.ending.removeLeftAnchor():fn.A.isRight(this.location)?this.ending.removeRightAnchor():fn.A.raiseError(this.location),this.ending=null},ls.getEnding=function(){return this.ending},ls.setNeedDrawUpdate=function(){this.hasEnding()&&this.getEnding().setNeedDrawUpdate()},ls.getEndingUuid=function(){return this.endingUuid};const vr=gh;class nu{constructor({ending:s,leftEnding:n,rightEnding:c,hasRightSpecificBarline:y,isLastMeasure:N,measure:j}){this.ending=s,this.leftEnding=n,this.rightEnding=c,this.hasRightSpecificBarline=y,this.isLastMeasure=N,this.measure=j}build(){this.buildLeftAnchor(),this.buildRightAnchor()}buildLeftAnchor(){this.leftEnding===null||!la.A.isSame(this.leftEnding,this.ending)?this.buildLeftInitialAnchor():this.buildLeftContinueAnchor()}buildLeftInitialAnchor(){const s=new vr(fn.A.LEFT),n=la.A.numbersToText(this.ending);s.setText(n),this.measure.addMiddleEndingAnchor(s)}buildLeftContinueAnchor(){const s=new vr(fn.A.LEFT);s.setText(null),this.measure.setLeftEndingAnchor(s)}buildRightAnchor(){this.rightEnding===null||!la.A.isSame(this.ending,this.rightEnding)?this.buildRightClosingAnchor():this.buildRightContinueAnchor()}buildRightClosingAnchor(){const s=new vr(fn.A.RIGHT),n=this.isRightClosed();s.setRightClosed(n),this.measure.addMiddleEndingAnchor(s)}isRightClosed(){return!!(this.isLastMeasure||this.rightEnding!==null||this.hasRightSpecificBarline)}buildRightContinueAnchor(){const s=new vr(fn.A.RIGHT);s.setRightClosed(!1),this.measure.setRightEndingAnchor(s)}}var ou=r(2255);const ph=function(t){this.init(t)},Ci=ph.prototype;Ci.init=function(t){this.group=new L.A("g"),this.setParentGroup(t),this.text=null,this.fontSize=null,this.posX=null,this.posY=null,this.displayIdx=null,this.drawnDisplayIdx=null},Ci.setPosX=function(t){this.posX=t},Ci.setPosY=function(t){this.posY=t},Ci.setParentGroup=function(t){this.parentGroup=t,this.bindToParent()},Ci.setDrawingContext=function(t){this.drawingContext=t},Ci.bindToParent=function(){this.parentGroup.append(this.group)},Ci.getFontSize=function(){return this.fontSize===null&&(this.fontSize=this.drawingContext.getMeasureNumberFontSize()),this.fontSize},Ci.setDisplayIdx=function(t){this.displayIdx=t},Ci.display=function(){if(this.text===null){const t=(this.displayIdx+1).toString(),s=this.getFontSize(),n=this.drawingContext.getMeasureNumberFontFamily(),c=this.drawingContext.getMeasureNumberFontStyle(),y=this.drawingContext.getMeasureNumberFontWeight(),N={text:t,"font-size":s,"font-family":n,"font-style":c,"font-weight":y};this.text=new bs.A(N),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext),this.text.render()}else if(this.displayIdx!==this.drawnDisplayIdx){const t=(this.displayIdx+1).toString();this.text.options.text=t,this.text.render()}this.updateTextPosition(),this.text.move(),this.text.bindToParent(),this.drawnDisplayIdx=this.displayIdx},Ci.getPreviousSpace=function(){return this.drawingContext.getSpaceSize()/4},Ci.getMarginSize=function(){return this.getFontSize()/2},Ci.updateTextPosition=function(){this.posX!==null&&this.posY!==null&&this.text.setPosition(this.posX,this.posY)},Ci.hide=function(){this.text!==null&&this.text.hide()},Ci.getHeight=function(){return this.drawingContext.getMeasureNumberFontSize()},Ci.getWidth=function(){return this.text.getWidth()};const mh=ph;var ru=r(903828),Es=r(701933);const au="adagio-part-uuid",hu="adagio-measure-uuid",cu="adagio-event-rect",lu=0,Tr=function(){this.init()};Tr.cssClass="measure";const z=Tr.prototype;z.cssClass=Tr.cssClass,z.init=function(){this.group=new L.A("g"),this.parent=null,this.currentParent=null,this.insertionPoint=null,this.contentDrawn=!1,this.isEmptyBool=null,this.systemLocation=null,this.drawnSystemLocation=null,this.needCommonContentDisplayUpdate=!1,this.dataIdx=null,this.isLastOfSystem=null,this.leftBarline=null,this.drawnAttributes=null,this.attributesByMeasurePos={},this.tickableContent=null,this.rightAttributes=null,this.rightBarline=null,this.measureNumber=null,this.measureNumberingPolicy=null,this.metronome=null,this.rehearsal=null,this.ending=null,this.jumpTag=null,this.nextJumpTag=null,this.jumpCall=null,this.repeatTimes=null,this.systemBreak=null,this.nextSystemBreak=null,this.pageBreak=null,this.nextPageBreak=null,this.staffData=null,this.eventsRect=null,this.leftTempoChangeAnchor=null,this.rightTempoChangeAnchor=null,this.middleTempoChangesAnchors=[],this.hasTempoChangesAboveValue=null,this.hasTempoChangesBelowValue=null,this.leftEndingAnchor=null,this.rightEndingAnchor=null,this.middleEndingsAnchors=[],this.drawingContext=null,this.settedWidth=0,this.horizontalFormatting=null,this.verticalFormatting=null,this.geometry=null,this.internalGeometry=null,this.hasSystemBreakBeforeValue=!1,this.hasSystemBreakAfterValue=!1,this.hasPageBreakBeforeValue=!1,this.hasPageBreakAfterValue=!1,this.gapAbove=null,this.gapBelow=null,this.xPos=null,this.yPos=null,this.inDisplayedRange=!0,this.group.attr("class",this.cssClass)},z.setParent=function(t){this.parent=t},z.setPartUuid=function(t){this.group.setDataEntry(au,t)},z.setMeasureUuid=function(t){this.group.setDataEntry(hu,t)},z.setIsEmpty=function(t){this.isEmptyBool=t},z.setDisplayIdx=function(t){const s=this.getMeasureNumber();s!==null&&s.setDisplayIdx(t)},z.setDataIdx=function(t){this.dataIdx=t},z.getDataIdx=function(){return this.dataIdx},z.setMeasureNumberingPolicy=function(t){this.measureNumberingPolicy=t},z.setMeasureLocation=function(t){this.measureLocation=t},z.setSystemLocation=function(t){t!==this.drawnSystemLocation&&(this.systemLocation=t)},z.setIsLastOfSystem=function(t){this.isLastOfSystem=t},z.setStaffData=function(t){this.staffData=t;for(const s in this.attributesByMeasurePos)this.getAttributes(s).setStaffData(this.staffData);this.tickableContent.setStaffData(this.staffData),this.hasLeftBarline()&&this.leftBarline.setStaffData(this.staffData),this.hasRightBarline()&&this.rightBarline.setStaffData(this.staffData),this.rightAttributes.setStaffData(this.staffData)},z.setLeftBarline=function(t){t.setParent(this.getGroup()),this.leftBarline=t},z.setRightBarline=function(t){t.setParent(this.getGroup()),this.rightBarline=t},z.setTickableContent=function(t){t.setParent(this.getGroup()),this.tickableContent=t},z.addAttributes=function(t,s){s.setParent(this.getGroup()),this.attributesByMeasurePos[t]=s},z.setRightAttributes=function(t){t.setParent(this.getGroup()),this.rightAttributes=t},z.setMetronome=function(t){this.metronome=t,t.setParent(this.getGroup())},z.hasMetronome=function(){return this.systemLocation===Es.A.OTHER?!1:this.metronome!==null},z.setRehearsal=function(t){this.rehearsal=t,t.setParent(this.getGroup())},z.hasRehearsal=function(){return this.systemLocation===Es.A.OTHER?!1:this.rehearsal!==null},z.hasEnding=function(){return this.systemLocation===Es.A.OTHER?!1:this.leftEndingAnchor!==null||this.rightEndingAnchor!==null||this.middleEndingsAnchors.length>0},z.setSystemBreak=function(t){this.systemBreak=t,t.setParent(this.getGroup())},z.setNextSystemBreak=function(t){this.nextSystemBreak=t,t.setParent(this.getGroup())},z.hasSystemBreak=function(){return this.systemLocation===Es.A.OTHER?!1:this.systemBreak!==null},z.hasNextSystemBreak=function(){return this.systemLocation===Es.A.OTHER?!1:this.nextSystemBreak!==null},z.setPageBreak=function(t){this.pageBreak=t,t.setParent(this.getGroup())},z.setNextPageBreak=function(t){this.nextPageBreak=t,t.setParent(this.getGroup())},z.hasPageBreak=function(){return this.systemLocation===Es.A.OTHER?!1:this.pageBreak!==null},z.hasNextPageBreak=function(){return this.systemLocation===Es.A.OTHER?!1:this.nextPageBreak!==null},z.setJumpTag=function(t){this.jumpTag=t,t.setParent(this.getGroup())},z.setNextJumpTag=function(t){this.nextJumpTag=t},z.setRepeatTimes=function(t){this.repeatTimes=t,t.setParent(this.getGroup())},z.hasJumpTag=function(){return this.systemLocation===Es.A.OTHER?!1:this.jumpTag!==null},z.hasRepeatTimes=function(){return this.systemLocation===Es.A.OTHER?!1:this.repeatTimes!==null},z.setJumpCall=function(t){this.jumpCall=t,t.setParent(this.getGroup())},z.hasJumpCall=function(){return this.systemLocation===Es.A.OTHER?!1:this.jumpCall!==null},z.setRightTempoChangeAnchor=function(t){this.rightTempoChangeAnchor=t,t.setMeasure(this)},z.setLeftTempoChangeAnchor=function(t){this.leftTempoChangeAnchor=t,t.setMeasure(this)},z.addMiddleTempoChangeAnchor=function(t){this.middleTempoChangesAnchors.push(t),t.setMeasure(this)},z.setRightEndingAnchor=function(t){this.rightEndingAnchor=t,t.setMeasure(this)},z.setLeftEndingAnchor=function(t){this.leftEndingAnchor=t,t.setMeasure(this)},z.addMiddleEndingAnchor=function(t){this.middleEndingsAnchors.push(t),t.setMeasure(this)},z.hasSystemBreakAfter=function(){return this.hasSystemBreakAfterValue},z.hasSystemBreakBefore=function(){return this.hasSystemBreakBeforeValue},z.setHasSystemBreakBefore=function(t){this.hasSystemBreakBeforeValue=t},z.setHasSystemBreakAfter=function(t){this.hasSystemBreakAfterValue=t},z.hasPageBreakAfter=function(){return this.hasPageBreakAfterValue},z.hasPageBreakBefore=function(){return this.hasPageBreakBeforeValue},z.setHasPageBreakBefore=function(t){this.hasPageBreakBeforeValue=t},z.setHasPageBreakAfter=function(t){this.hasPageBreakAfterValue=t},z.hasLeftBarline=function(){return this.leftBarline!==null},z.hasRightBarline=function(){return this.rightBarline!==null},z.getNextJumpTagOverflow=function(){return this.isLastOfSystem||this.nextJumpTag===null?0:this.nextJumpTag.getWidth()/2+this.drawingContext.getMarginSize()},z.getWidth=function(){return this.horizontalFormatting.getWidth()},z.getSettedWidth=function(){return this.settedWidth},z.getHeight=function(){return this.verticalFormatting.getHeight()},z.getUpDynamicsY=function(){const t=this.drawingContext.getDynamicsHeight();return this.verticalFormatting.getUpDynamicsY()-t/2},z.getDownDynamicsY=function(){const t=this.drawingContext.getDynamicsHeight();return this.verticalFormatting.getDownDynamicsY()+t/2},z.getEndingY=function(){return this.verticalFormatting.getEndingY()},z.getUpTempoChangesY=function(){return this.verticalFormatting.getUpTempoChangesY()},z.getDownTempoChangesY=function(){return this.verticalFormatting.getDownTempoChangesY()},z.getUpOctaveShiftsY=function(){return this.verticalFormatting.getUpOctaveShiftsY()},z.getDownOctaveShiftsY=function(){const t=this.drawingContext.getOctaveShiftHeight();return this.verticalFormatting.getDownOctaveShiftsY()+t},z.getUpPluckedRangesY=function(){return this.verticalFormatting.getUpPluckedRangesY()},z.getDownPluckedRangesY=function(){const t=.6666666666666666*this.drawingContext.getPluckedRangeHeight();return this.verticalFormatting.getDownPluckedRangesY()+t},z.getUpPedalsY=function(){return this.verticalFormatting.getUpPedalsY()},z.getDownPedalsY=function(){const t=this.drawingContext.getPedalHeight();return this.verticalFormatting.getDownPedalsY()+t},z.hasTempoChangesAbove=function(){return this.systemLocation===Es.A.OTHER?!1:(this.hasTempoChangesAboveValue===null&&this.calHasTempoChangesAbove(),this.hasTempoChangesAboveValue)},z.calHasTempoChangesAbove=function(){this.hasTempoChangesAboveValue=this.hasLeftTempoChangeAnchor()&&ua(this.getLeftTempoChangeAnchor())||this.hasRightTempoChangeAnchor()&&ua(this.getRightTempoChangeAnchor())||this.middleTempoChangesAnchors.some(ua)},z.hasTempoChangesBelow=function(){return this.systemLocation===Es.A.OTHER?!1:(this.hasTempoChangesBelowValue===null&&this.calcHasTempoChangesBelow(),this.hasTempoChangesBelowValue)},z.calcHasTempoChangesBelow=function(){this.hasTempoChangesBelowValue=this.hasLeftTempoChangeAnchor()&&fa(this.getLeftTempoChangeAnchor())||this.hasRightTempoChangeAnchor()&&fa(this.getRightTempoChangeAnchor())||this.middleTempoChangesAnchors.some(fa)};const ua=function(t){return t.isAbove()},fa=function(t){return t.isBelow()};z.getSpaceAboveStaff=function(){return this.verticalFormatting.getSpaceAboveStaff()},z.getNotesSpaceAboveStaff=function(){return this.verticalFormatting.getNotesUpOverflow()},z.getNotesSpaceBelowStaff=function(){return this.verticalFormatting.getNotesDownOverflow()},z.getSpaceBelowStaff=function(){return this.verticalFormatting.getDownLimitY()-this.getStaffHeight()},z.getGroup=function(){return this.group},z.getEventRect=function(){return this.eventsRect},z.render=function(t){if(this.drawingContext===null){this.drawingContext=t,this.middleTempoChangesAnchors.forEach(this.transferDrawingContext,this),this.middleEndingsAnchors.forEach(this.transferDrawingContext,this),this.settedWidth=t.getMeasureWidth(),this.hasLeftBarline()&&this.leftBarline.render(t);for(const s in this.attributesByMeasurePos)this.getAttributes(s).setDrawingContext(t);this.tickableContent.render(t),this.rightAttributes.setDrawingContext(t),this.hasRightBarline()&&this.rightBarline.render(t),this.metronome!==null&&this.metronome.setDrawingContext(t),this.rehearsal!==null&&this.rehearsal.setDrawingContext(t),this.jumpTag!==null&&this.jumpTag.setDrawingContext(t),this.nextJumpTag!==null&&this.nextJumpTag.setDrawingContext(t),this.repeatTimes!==null&&this.repeatTimes.setDrawingContext(t),this.jumpCall!==null&&this.jumpCall.setDrawingContext(t),this.systemBreak!==null&&this.systemBreak.setDrawingContext(t),this.nextSystemBreak!==null&&this.nextSystemBreak.setDrawingContext(t),this.pageBreak!==null&&this.pageBreak.setDrawingContext(t),this.nextPageBreak!==null&&this.nextPageBreak.setDrawingContext(t),this.formatStaticElements()}},z.transferDrawingContext=function(t){t.setDrawingContext(this.drawingContext)},z.formatStaticElements=function(){this.hasLeftBarline()&&this.leftBarline.setPosition(0)},z.autoAlignHorizontal=function(t){this.checkMeasurePos(t);const s=this.getHorizontalData(),n=this.drawingContext.getNotesFormatter(),c=new ou.A(this.drawingContext,[s],n);c.format();const y=c.getFormatting();y.setMeasurePosition(t),this.dispatchHorizontalFormatting(y)},z.dispatchHorizontalFormatting=function(t){this.setHorizontalFormatting(t),this.formatHorizontal()},z.setHorizontalFormatting=function(t){if(this.horizontalFormatting=t,!t.getNotesFormatter)return;const s=this.horizontalFormatting.getNotesFormatter();this.tickableContent.setHorizontalFormatter(s),this.updateAttributes()},z.dispatchHorizontalFormattingForVerticalComputation=function(t){this.horizontalFormatting=t;const s=this.horizontalFormatting.getNotesX();this.tickableContent.setPosition(s);const n=this.horizontalFormatting.getNotesFormatter();this.tickableContent.dispatchHorizontalFormattingForVerticalComputation(n)},z.updateAttributes=function(){if(this.drawnAttributes===null)return;const t=this.getAttributes();t!==this.drawnAttributes&&(this.drawnAttributes.unbind(),t.draw(),this.drawnAttributes=t)},z.getHorizontalFormatting=function(){return this.horizontalFormatting},z.autoAlignVertical=function(){const t=[this],s=[],n=[],c=[],[y]=(0,ru.A)(t,s,n,c);this.dispatchVerticalFormatting(y)},z.dispatchVerticalFormatting=function(t){this.setVerticalFormatting(t),this.formatVertical()},z.setVerticalFormatting=function(t){this.verticalFormatting=t,this.tickableContent.setVerticalFormatting(t)},z.getDivisions=function(){return this.tickableContent.getDivisions()},z.drawContentRec=function(){this.isInDisplayedRange()&&(this.contentDrawn?(this.updateContentDisplay(),this.updateCommonContentDisplay(),this.updateMeasureNumberDisplay()):this.drawContent())},z.updateContentDisplay=function(){this.getAttributes().move(),this.tickableContent.move(),this.tickableContent.updateHorizontalDisplay(),this.tickableContent.updateVerticalDisplay(),this.rightAttributes.move(),this.hasRightBarline()&&this.rightBarline.move(),this.hasMetronome()&&this.metronome.move(),this.hasRehearsal()&&this.rehearsal.move(),this.hasJumpTag()&&this.jumpTag.move(),this.hasJumpCall()&&this.jumpCall.move(),this.hasRepeatTimes()&&this.repeatTimes.move(),this.hasSystemBreak()&&this.systemBreak.move(),this.hasNextSystemBreak()&&this.nextSystemBreak.move(),this.hasPageBreak()&&this.pageBreak.move(),this.hasNextPageBreak()&&this.nextPageBreak.move()},z.updateCommonContentDisplay=function(){this.drawnSystemLocation!==this.systemLocation&&(this.systemLocation!==Es.A.OTHER&&this.drawnSystemLocation===Es.A.OTHER?this.showCommonContent():this.systemLocation===Es.A.OTHER&&this.drawnSystemLocation!==Es.A.OTHER&&this.hideCommonContent(),this.drawnSystemLocation=this.systemLocation)},z.showCommonContent=function(){this.metronome!==null&&(this.metronome.contentDrawn?this.metronome.bindToParent():this.metronome.draw()),this.rehearsal!==null&&(this.rehearsal.contentDrawn?this.rehearsal.bindToParent():this.rehearsal.draw()),this.jumpTag!==null&&(this.jumpTag.contentDrawn?this.jumpTag.bindToParent():this.jumpTag.draw()),this.jumpCall!==null&&(this.jumpCall.contentDrawn?this.jumpCall.bindToParent():this.jumpCall.draw()),this.repeatTimes!==null&&(this.repeatTimes.rendered?this.repeatTimes.bindToParent():this.repeatTimes.draw()),this.systemBreak!==null&&(this.systemBreak.isRendered()?this.systemBreak.bindToParent():this.systemBreak.draw(),this.systemBreak.move()),this.nextSystemBreak!==null&&(this.nextSystemBreak.isRendered()?this.nextSystemBreak.bindToParent():this.nextSystemBreak.draw(),this.nextSystemBreak.move()),this.pageBreak!==null&&(this.pageBreak.isRendered()?this.pageBreak.bindToParent():this.pageBreak.draw(),this.pageBreak.move()),this.nextPageBreak!==null&&(this.nextPageBreak.isRendered()?this.nextPageBreak.bindToParent():this.nextPageBreak.draw(),this.nextPageBreak.move())},z.hideCommonContent=function(){this.metronome!==null&&this.metronome.removeFromParent(),this.rehearsal!==null&&this.rehearsal.removeFromParent(),this.jumpTag!==null&&this.jumpTag.removeFromParent(),this.jumpCall!==null&&this.jumpCall.removeFromParent(),this.repeatTimes!==null&&this.repeatTimes.removeFromParent(),this.systemBreak!==null&&this.systemBreak.removeFromParent(),this.nextSystemBreak!==null&&this.nextSystemBreak.removeFromParent(),this.pageBreak!==null&&this.pageBreak.removeFromParent(),this.nextPageBreak!==null&&this.nextPageBreak.removeFromParent()},z.updateMeasureNumberDisplay=function(){this.shouldDisplayMeasureNumber()?this.measureNumber.display():this.shouldHideMeasureNumber()&&this.measureNumber.hide()},z.drawContent=function(){this.contentDrawn||(this.contentDrawn=!0,this.hasLeftBarline()&&this.leftBarline.draw(),this.getAttributes().draw(),this.drawnAttributes=this.getAttributes(),this.tickableContent.draw(),this.rightAttributes.draw(),this.hasRightBarline()&&this.rightBarline.draw(),this.hasMetronome()&&this.metronome.draw(),this.hasRehearsal()&&this.rehearsal.draw(),this.hasJumpTag()&&this.jumpTag.draw(),this.hasRepeatTimes()&&this.repeatTimes.draw(),this.hasJumpCall()&&this.jumpCall.draw(),this.hasSystemBreak()&&this.systemBreak.draw(),this.hasNextSystemBreak()&&this.nextSystemBreak.draw(),this.hasPageBreak()&&this.pageBreak.draw(),this.hasNextPageBreak()&&this.nextPageBreak.draw(),this.shouldDisplayMeasureNumber()&&this.measureNumber.display(),this.drawnSystemLocation=this.systemLocation)},z.unbind=function(){this.currentParent!==null&&(this.getGroup().removeFromParent(),this.currentParent=null)},z.updateBinding=function(){this.needUpdateBinding()&&(this.parent===null?this.getGroup().removeFromParent():this.insertionPoint===null?this.parent.append(this.group):this.parent.insertBefore(this.group,this.insertionPoint),this.currentParent=this.parent)},z.needUpdateBinding=function(){return this.parent!==this.currentParent},z.getAttributes=function(t){return t=this.getMeasurePos(t),this.attributesByMeasurePos[t]},z.getMeasurePos=function(t){if(typeof t!="undefined")return this.checkMeasurePos(t),t;if(this.hasHorizontalFormatting())return this.getHorizontalFormatting().getMeasurePos();{const s="The formatting data must be setted in order to have the default measure position";throw new F.default("MissingGlobalFormatting",s)}},z.checkMeasurePos=function(t){if(!this.hasAttributes(t)){const s=`There is no attributes for the measure position [${t}].`;throw new F.default("BadMeasurePos",s)}},z.hasAttributes=function(t){return typeof this.attributesByMeasurePos[t]!="undefined"},z.hasHorizontalFormatting=function(){return this.horizontalFormatting!==null},z.formatHorizontal=function(){if(this.horizontalFormatting===null){const lt="Cannot format without formatting data.";throw new F.default("MissingFormatting",lt)}const t=this.horizontalFormatting.getAttributesX(),s=this.getAttributes(),n=s.getPreviousSpace(),c=this.getWidth(),y=this.getNextJumpTagOverflow();s.setPosition(t+n);const N=this.horizontalFormatting.getNotesX();if(this.tickableContent.setPosition(N),this.tickableContent.formatHorizontal(),this.hasRightBarline()){const lt=this.horizontalFormatting.getRightBarlineX();this.rightBarline.setPosition(lt)}const j=this.horizontalFormatting.getRightAttributesX();if(this.rightAttributes.setPosition(j),this.hasMetronome()){const lt=this.metronome.getPreviousSpace();this.metronome.setPosX(lt)}if(this.hasRehearsal()){const lt=this.rehearsal.getPreviousSpace();this.rehearsal.setPosX(lt)}if(this.hasJumpTag()&&this.jumpTag.setPosX(0),this.hasJumpCall()&&this.jumpCall.setMeasureWidth(c-y),this.hasRepeatTimes()&&this.repeatTimes.setPosX(c-y),this.hasSystemBreak()&&this.systemBreak.setPosX(0),this.hasNextSystemBreak()&&this.nextSystemBreak.setPosX(c),this.hasPageBreak()&&this.pageBreak.setPosX(0),this.hasNextPageBreak()&&this.nextPageBreak.setPosX(c),this.shouldDisplayMeasureNumber()){const lt=this.measureNumber.getPreviousSpace();this.measureNumber.setPosX(lt)}},z.formatVertical=function(){if(this.tickableContent.formatVertical(),this.hasMetronome()){const t=this.verticalFormatting.getMetronomeY(),s=this.metronome.getHeight();this.metronome.setPosY(t-s)}if(this.hasRehearsal()){const t=this.verticalFormatting.getRehearsalY(),s=this.rehearsal.getHeight();this.rehearsal.setPosY(t-s)}if(this.hasJumpTag()){const t=this.verticalFormatting.getJumpTagY();this.jumpTag.setPosY(t)}if(this.hasJumpCall()){const t=this.verticalFormatting.getJumpCallY();this.jumpCall.setPosY(t)}if(this.hasRepeatTimes()){const t=this.verticalFormatting.getRepeatTimesY();this.repeatTimes.setPosY(t)}if(this.hasSystemBreak()){const t=this.verticalFormatting.getUpLimitY();this.systemBreak.setPosY(t)}if(this.hasNextSystemBreak()){const t=this.verticalFormatting.getUpLimitY();this.nextSystemBreak.setPosY(t)}if(this.hasPageBreak()){const t=this.verticalFormatting.getUpLimitY();this.pageBreak.setPosY(t)}if(this.hasNextPageBreak()){const t=this.verticalFormatting.getUpLimitY();this.nextPageBreak.setPosY(t)}if(this.shouldDisplayMeasureNumber()){const t=this.verticalFormatting.getMeasureNumberY();this.measureNumber.setPosY(t)}},z.setPosX=function(t){this.xPos=t},z.setPosY=function(t){this.yPos=t},z.move=function(){this.xPos!==null&&this.yPos!==null&&this.group.attr("transform",`translate(${this.xPos} ${this.yPos})`)},z.getXPos=function(){return this.xPos},z.getNote=function(t,s){return this.getTickableContent().getNote(t,s)},z.getNoteGraces=function(t,s){return this.getTickableContent().getNoteGraces(t,s)},z.getNoteX=function(t,s){return this.getXPos()+this.tickableContent.getNoteX(t,s)},z.extendBarlines=function(t){this.hasLeftBarline()&&this.leftBarline.extend(t),this.hasRightBarline()&&this.rightBarline.extend(t)},z.setInsertionPoint=function(t){this.insertionPoint=t},z.drawCursor=function(t,s){this.tickableContent.drawCursor(t,s)},z.drawGraceCursor=function(t,s){this.tickableContent.drawGraceCursor(t,s)},z.drawDynamicCursor=function(t,s){this.tickableContent.drawDynamicCursor(t,s)},z.drawPizzicatoCursor=function(t,s){this.tickableContent.drawPizzicatoCursor(t,s)},z.drawMuteCursor=function(t,s){this.tickableContent.drawMuteCursor(t,s)},z.setNoteColor=function(t,s){this.tickableContent.setNoteColor(t,s)},z.setMeasureNumber=function(t){this.measureNumber=t},z.shouldDisplayMeasureNumber=function(){return this.hasRealMeasureNumber()?this.measureNumberingPolicy.shouldDisplay(this.measureLocation,this.systemLocation,this.dataIdx):!1},z.shouldHideMeasureNumber=function(){return this.hasRealMeasureNumber()?!this.measureNumberingPolicy.shouldDisplay(this.measureLocation,this.systemLocation,this.dataIdx):!1},z.hasRealMeasureNumber=function(){const t=this.getMeasureNumber();return t===null?!1:t instanceof mh},z.getMeasureNumber=function(){return!this.hasNumber()&&!this.hasRehearsal()&&(this.measureNumber=new mh(this.getGroup()),this.measureNumber.setDrawingContext(this.drawingContext)),this.measureNumber},z.setGapAbove=function(t){this.gapAbove=t},z.setGapBelow=function(t){this.gapBelow=t},z.resetGeometry=function(){this.geometry=null},z.getInternalGeometry=function(){const t=this.calcGeometry();if(this.internalGeometry===null)t.isNew=!0;else{const s=this.internalGeometry;t.isNew=!Ah(t,s)}return this.internalGeometry=t,t},z.getGeometry=function(){const t=this.calcGeometry();if(this.geometry===null)t.isNew=!0;else{const s=this.geometry;t.isNew=!Ah(t,s)}return this.geometry=t,t},z.calcGeometry=function(){const t=this.getSpaceAboveStaff()+this.gapAbove/2,s=this.getSpaceBelowStaff()+this.gapBelow/2;return{staffHeight:this.getStaffHeight(),spaceAbove:t,spaceBelow:s,width:this.getWidth(),svg:this.getGroup()}};const Ah=function(t,s){return t.staffHeight===s.staffHeight&&t.spaceAbove===s.spaceAbove&&t.spaceBelow===s.spaceBelow&&t.width===s.width&&t.svg===s.svg};z.getTickableContent=function(){return this.tickableContent},z.getHorizontalData=function(){const t=this.getLeftBarlineWidth(),s=this.getLeftAttributesWidthByMeasurePos(),n=this.getTickableHorizontalData(),c=this.getRightAttributesWidth(),y=this.getRightBarlineWidth(),N=this.settedWidth,j=this.drawingContext.getSpaceBeforeNotes();return{leftBarline:t,leftAttributesByMeasurePos:s,spaceBeforeNotes:j,tickablesContents:n,rightAttributes:c,rightBarline:y,settedWidth:N}},z.getLeftBarlineWidth=function(){return this.hasLeftBarline()?this.leftBarline.getWidth():0},z.getLeftAttributesWidthByMeasurePos=function(){const t={};for(const s in this.attributesByMeasurePos){const n=this.getAttributes(s),c=n.getWidth()+n.getPreviousSpace();t[s]=c}return t},z.getTickableHorizontalData=function(){return this.tickableContent.getHorizontalData()},z.getRightAttributesWidth=function(){return this.rightAttributes.getWidth()+this.rightAttributes.getNextSpace()},z.getRightBarlineWidth=function(){return this.hasRightBarline()?this.rightBarline.getWidth():0},z.getVerticalData=function(){const t=this.getNotesVerticalData(),s=this.getStaffHeight();let n=0,c=0,y=0,N=0,j=0,lt=0,Ft=0,Kt=0,Se=0,ke=0,Cs=0,gn=0,Ln=0,Zn=0,lo=0,En=0,Fo=0,Rh=0,Oh=0,Nh=0,Bh=0,Hh=0,_h=0,Ih=0,Yh=0,Fh=0,Wh=0,Gh=0,Uh=0,zh=0,kh=0,Xh=0,Vh=0,$h=0,pa=t.downPedalsHeight,Kh=0,jh=0,Qh=0,Jh=0,Zh=0;const wf=this.getUpAttributesOverflow(),Df=this.getRightUpAttributesOverflow(),Cf=this.getRightDownAttributesOverflow(),xf=this.getDownAttributesOverflow();let qh=0,tc=0;const vf=this.horizontalFormatting.getAttributesX(),ec=this.getAttributes(),Tf=vf+ec.getPreviousSpace()+ec.getWidth();return this.hasUpDynamics()&&(c=this.drawingContext.getMarginSize(),n=this.drawingContext.getDynamicsHeight()),this.hasDownDynamics()&&(N=this.drawingContext.getMarginSize(),y=this.drawingContext.getDynamicsHeight()),this.tickableContent.hasPizzicatosAbove()&&(j=this.drawingContext.getPizzicatoHeight()),this.tickableContent.hasPizzicatosBelow()&&(lt=this.drawingContext.getPizzicatoHeight()),this.tickableContent.hasMutesAbove()&&(Ft=t.aboveMuteHeight),this.tickableContent.hasMutesBelow()&&(Kt=t.belowMuteHeight),this.tickableContent.hasOctaveShiftsAbove()&&(Fh=this.drawingContext.getOctaveShiftHeight(),Wh=this.drawingContext.getMarginSize()),this.tickableContent.hasOctaveShiftsBelow()&&(Gh=this.drawingContext.getOctaveShiftHeight(),Uh=this.drawingContext.getMarginSize()),this.tickableContent.hasPluckedRangesAbove()&&(zh=this.drawingContext.getPluckedRangeHeight(),kh=this.drawingContext.getPluckedRangeHeight()*1/3),this.tickableContent.hasPluckedRangesBelow()&&(Xh=this.drawingContext.getPluckedRangeHeight()),this.tickableContent.hasPedalsAbove()&&(Vh=this.drawingContext.getPedalHeight(),$h=this.drawingContext.getMarginSize()),this.tickableContent.hasPedalsBelow()&&(pa=Math.max(pa,this.drawingContext.getPedalHeight()),Kh=this.drawingContext.getMarginSize()),this.hasTempoChangesAbove()&&(jh=this.drawingContext.getTempoChangeHeight(),Qh=this.drawingContext.getTempoChangeMargin()),this.hasTempoChangesBelow()&&(Jh=this.drawingContext.getTempoChangeHeight(),Zh=this.drawingContext.getMarginSize()),this.tickableContent.hasWordsAbove()&&(Se=this.drawingContext.getWordHeight()),this.tickableContent.hasWordsBelow()&&(ke=this.drawingContext.getWordHeight()),t.hasLyric&&(gn=this.drawingContext.getSpaceSize(),Cs=t.lyricHeight),this.hasMetronome()&&(Ln=this.metronome.getHeight(),Zn=this.metronome.getPreviousSpace()+this.metronome.getWidth()),this.hasRehearsal()&&(lo=this.rehearsal.getHeight(),En=this.drawingContext.getSpaceSize(),Fo=this.rehearsal.getPreviousSpace()+this.rehearsal.getWidth()),this.hasEnding()&&(Rh=this.drawingContext.getEndingHeight()),this.hasJumpTag()&&(Oh=this.jumpTag.getHeight(),Bh=this.jumpTag.getWidth(),Nh=this.jumpTag.getMarginSize()),this.hasJumpCall()&&(Hh=this.jumpCall.getHeight(),_h=this.jumpCall.getMarginSize()),this.hasRepeatTimes()&&(Ih=this.repeatTimes.getSpaceAbove(),Yh=this.repeatTimes.getSpaceBelow()),this.shouldDisplayMeasureNumber()&&(qh=this.measureNumber.getHeight(),tc=this.measureNumber.getMarginSize()),{notesUpOverflow:t.notesUpOverflow,upAttributesOverflow:wf,rightUpAttributesOverflow:Df,downAttributesOverflow:xf,rightDownAttributesOverflow:Cf,notesLeftX:Tf,measureNumberHeight:qh,measureNumberMargin:tc,upDynamicsHeight:n,upDynamicsMargin:c,upPizzicatoHeight:j,upMuteHeight:Ft,downMuteHeight:Kt,upOctaveShiftsHeight:Fh,upOctaveShiftsMargin:Wh,upPluckedRangesHeight:zh,upPluckedRangeSpaceBelow:kh,upPedalsHeight:Vh,upPedalsMargin:$h,upWordHeight:Se,chordsHeight:t.chordsHeight,classicChordSpaceAbove:t.classicChordSpaceAbove,classicChordSpaceBelow:t.classicChordSpaceBelow,figuredBassSpaceAbove:t.figuredBassSpaceAbove,figuredBassSpaceBelow:t.figuredBassSpaceBelow,endingHeight:Rh,upTempoChangesHeight:jh,upTempoChangesMargin:Qh,jumpTagHeight:Oh,jumpTagMargin:Nh,jumpTagRightX:Bh,jumpCallHeight:Hh,jumpCallMargin:_h,repeatTimesHeight:Ih,repeatTimesMargin:Yh,rehearsalHeight:lo,rehearsalMargin:En,rehearsalRightX:Fo,metronomeHeight:Ln,metronomeRightX:Zn,staffHeight:s,notesDownOverflow:t.notesDownOverflow,downDynamicsMargin:N,downDynamicsHeight:y,downPizzicatoHeight:lt,downOctaveShiftsHeight:Gh,downOctaveShiftsMargin:Uh,downPluckedRangesHeight:Xh,downPedalsHeight:pa,downPedalsMargin:Kh,downTempoChangesHeight:Jh,downTempoChangesMargin:Zh,downWordHeight:ke,lyricsMargin:gn,lyricsHeight:Cs}},z.getUpAttributesOverflow=function(){return this.getAttributes().getUpOverflow()},z.getRightUpAttributesOverflow=function(){return this.rightAttributes.getUpOverflow()},z.getRightDownAttributesOverflow=function(){return this.rightAttributes.getDownOverflow()},z.getDownAttributesOverflow=function(){return this.getAttributes().getDownOverflow()},z.getNumberOverflow=function(){const t=Math.round(this.drawingContext.getMeasureNumberFontSize());return this.drawingContext.getSpaceSize()/4+t},z.getNotesVerticalData=function(){return this.tickableContent.getVerticalData()},z.getStaffData=function(){return this.hasStaffData()||this.setStaffData(R.A.createDefault()),this.staffData},z.getNbStaffLines=function(){const t=this.getStaffData();return R.A.getNbStaffLines(t)},z.isTabStaff=function(){const t=this.getStaffData();return R.A.isTabStaff(t)},z.getStaffHeight=function(){return(this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize())*(this.getNbStaffLines()-1)},z.hasUpDynamics=function(){return this.tickableContent.hasDynamicsAbove()||this.tickableContent.hasWedgeAbove()},z.hasDownDynamics=function(){return this.tickableContent.hasDynamicsBelow()||this.tickableContent.hasWedgeBelow()},z.updateHorizontalDisplay=function(){if(!this.isInDisplayedRange())return;this.getAttributes().move(),this.tickableContent.move(),this.tickableContent.updateHorizontalDisplay(),this.rightAttributes.move(),this.hasRightBarline()&&this.rightBarline.move(),this.hasMetronome()&&this.metronome.move(),this.hasRehearsal()&&this.rehearsal.move(),this.shouldDisplayMeasureNumber()&&this.measureNumber.move(),this.hasJumpTag()&&this.jumpTag.move(),this.hasJumpCall()&&this.jumpCall.move(),this.hasRepeatTimes()&&this.repeatTimes.move(),this.hasSystemBreak()&&this.systemBreak.move(),this.hasNextSystemBreak()&&this.nextSystemBreak.move(),this.hasPageBreak()&&this.pageBreak.move(),this.hasNextPageBreak()&&this.nextPageBreak.move()},z.updateVerticalDisplay=function(){this.tickableContent.updateVerticalDisplay(),this.hasMetronome()&&this.metronome.move(),this.hasRehearsal()&&this.rehearsal.move(),this.shouldDisplayMeasureNumber()&&this.measureNumber.move()},z.hasEventsRect=function(){return this.drawingContext.hasEventsRects()},z.updateEventsRect=function(){if(this.verticalFormatting===null||this.horizontalFormatting===null)return;const t=this.getInternalGeometry();if(!t.isNew)return;this.eventsRect===null&&(this.eventsRect=this.group.append("rect"),this.eventsRect.attr("class",cu),this.eventsRect.attr("opacity",lu));const s=t.staffHeight+t.spaceAbove+t.spaceBelow;this.eventsRect.attr("width",t.width),this.eventsRect.attr("height",s),this.eventsRect.attr("transform",`translate(0 ${-t.spaceAbove})`)},z.drawVerticalDebug=function(){const t=this.verticalFormatting.getUpLimitY();this.drawVerticalDebugLine(t,"red");const s=this.verticalFormatting.getDownLimitY();this.drawVerticalDebugLine(s,"red");const n=this.verticalFormatting.getLyricsY();this.drawVerticalDebugLine(n,"blue");const c=this.verticalFormatting.getUpDynamicsY();this.drawVerticalDebugLine(c,"green");const y=this.verticalFormatting.getDownDynamicsY();this.drawVerticalDebugLine(y,"green")},z.drawVerticalDebugLine=function(t,s){const n={stroke_width:1,stroke:s},c=new Xi.A(this.group,n),y=0,N=this.getWidth();c.render(y,t,N,t),c.draw()},z.hasLyrics=function(){return this.verticalFormatting.hasLyrics()},z.getLyricsUpY=function(){return this.verticalFormatting.getLyricsY()},z.getChordsY=function(){const t=this.verticalFormatting.getChordsY(),s=this.tickableContent.getSpaceBellowChords();return t-s},z.getFiguredBassY=function(t=0){const s=Qa*this.drawingContext.getSpaceSize();let n=this.verticalFormatting.getFiguredBassY()+s*t;return this.verticalFormatting.verticalData.figuredBassSpaceAbove===0&&(n+=this.tickableContent.getSpaceAboveFiguredBass()),n},z.getClassicHarmonyY=function(){let t=this.verticalFormatting.getClassicChordY();return this.verticalFormatting.classicChordSpaceAbove===0&&(t+=this.tickableContent.getSpaceAboveClassicChords()),t},z.getWordsY=function(t){if(t===Zi.A.ABOVE)return this.verticalFormatting.getUpWordY()-this.drawingContext.getWordFontSize()/2;if(t===Zi.A.BELOW)return this.verticalFormatting.getDownWordY()+this.drawingContext.getWordFontSize();throw new F.default("Unexpected",`The placement [${t}] is invalid.`)},z.hasStaffData=function(){return this.staffData!==null},z.hasNumber=function(){return this.measureNumber!==null},z.hasRightTieAnchor=function(t){return this.tickableContent.hasRightTieAnchor(t)},z.getRightTieAnchor=function(t){const s=this.tickableContent.getRightTieAnchor(t);return s.setMeasure(this),s},z.hasLeftTieAnchor=function(t){return this.tickableContent.hasLeftTieAnchor(t)},z.getLeftTieAnchor=function(t){const s=this.tickableContent.getLeftTieAnchor(t);return s.setMeasure(this),s},z.hasRightHyphenAnchor=function(t){return this.tickableContent.hasRightHyphenAnchor(t)},z.getRightHyphenAnchor=function(t){const s=this.tickableContent.getRightHyphenAnchor(t);return s.setMeasure(this),s},z.hasLeftHyphenAnchor=function(t){return this.tickableContent.hasLeftHyphenAnchor(t)},z.getLeftHyphenAnchor=function(t){const s=this.tickableContent.getLeftHyphenAnchor(t);return s.setMeasure(this),s},z.hasRightHammerOnPullOffAnchor=function(t){return this.tickableContent.hasRightHammerOnPullOffAnchor(t)},z.getRightHammerOnPullOffAnchor=function(t){const s=this.tickableContent.getRightHammerOnPullOffAnchor(t);return s.setMeasure(this),s},z.hasLeftHammerOnPullOffAnchor=function(t){return this.tickableContent.hasLeftHammerOnPullOffAnchor(t)},z.getLeftHammerOnPullOffAnchor=function(t){const s=this.tickableContent.getLeftHammerOnPullOffAnchor(t);return s.setMeasure(this),s},z.hasRightGlissandoAnchor=function(t){return this.tickableContent.hasRightGlissandoAnchor(t)},z.getRightGlissandoAnchor=function(t){const s=this.tickableContent.getRightGlissandoAnchor(t);return s.setMeasure(this),s},z.hasLeftGlissandoAnchor=function(t){return this.tickableContent.hasLeftGlissandoAnchor(t)},z.getLeftGlissandoAnchor=function(t){const s=this.tickableContent.getLeftGlissandoAnchor(t);return s.setMeasure(this),s},z.hasRightSlideAnchor=function(t){return this.tickableContent.hasRightSlideAnchor(t)},z.getRightSlideAnchor=function(t){const s=this.tickableContent.getRightSlideAnchor(t);return s.setMeasure(this),s},z.hasLeftSlideAnchor=function(t){return this.tickableContent.hasLeftSlideAnchor(t)},z.getLeftSlideAnchor=function(t){const s=this.tickableContent.getLeftSlideAnchor(t);return s.setMeasure(this),s},z.hasRightSlurAnchor=function(t){return this.tickableContent.hasRightSlurAnchor(t)},z.getRightSlurAnchor=function(t){const s=this.tickableContent.getRightSlurAnchor(t);return s.setMeasure(this),s},z.hasLeftSlurAnchor=function(t){return this.tickableContent.hasLeftSlurAnchor(t)},z.getLeftSlurAnchor=function(t){const s=this.tickableContent.getLeftSlurAnchor(t);return s.setMeasure(this),s},z.getMiddleSlursAnchors=function(t){const s=this.tickableContent.getMiddleSlursAnchors(t);return s.forEach(this.dispatchMeasure,this),s},z.getAllSlursAnchors=function(t){const s=this.tickableContent.getAllSlursAnchors(t);return s.forEach(this.dispatchMeasure,this),s},z.hasRightBendAnchor=function(t,s){return this.tickableContent.hasRightBendAnchor(t,s)},z.getRightBendAnchor=function(t,s){const n=this.tickableContent.getRightBendAnchor(t,s);return n.setMeasure(this),n},z.hasLeftBendAnchor=function(t,s){return this.tickableContent.hasLeftBendAnchor(t,s)},z.getLeftBendAnchor=function(t,s){const n=this.tickableContent.getLeftBendAnchor(t,s);return n.setMeasure(this),n},z.getMiddleBendsAnchors=function(t,s){const n=this.tickableContent.getMiddleBendsAnchors(t,s);return n.forEach(this.dispatchMeasure,this),n},z.getAllBendsAnchors=function(t){const s=this.tickableContent.getAllBendsAnchors(t);return s.forEach(this.dispatchMeasure,this),s},z.getMelismaAnchorsAtLevel=function(t,s){const n=this.tickableContent.getMelismaAnchorsAtLevel(t,s);return n.forEach(this.dispatchMeasure,this),n},z.getAllMelismasAnchors=function(t){const s=this.tickableContent.getAllMelismasAnchors(t);return s.forEach(this.dispatchMeasure,this),s},z.hasRightWedgeAnchor=function(){return this.tickableContent.hasRightWedgeAnchor()},z.getRightWedgeAnchor=function(){const t=this.tickableContent.getRightWedgeAnchor();return t.setMeasure(this),t},z.hasLeftWedgeAnchor=function(){return this.tickableContent.hasLeftWedgeAnchor()},z.getLeftWedgeAnchor=function(){const t=this.tickableContent.getLeftWedgeAnchor();return t.setMeasure(this),t},z.getMiddleWedgesAnchors=function(){const t=this.tickableContent.getMiddleWedgesAnchors();return t.forEach(this.dispatchMeasure,this),t},z.getAllWedgesAnchors=function(){const t=this.tickableContent.getAllWedgesAnchors();return t.forEach(this.dispatchMeasure,this),t},z.hasRightOctaveShiftAnchor=function(){return this.tickableContent.hasRightOctaveShiftAnchor()},z.getRightOctaveShiftAnchor=function(){const t=this.tickableContent.getRightOctaveShiftAnchor();return t.setMeasure(this),t},z.hasLeftOctaveShiftAnchor=function(){return this.tickableContent.hasLeftOctaveShiftAnchor()},z.getLeftOctaveShiftAnchor=function(){const t=this.tickableContent.getLeftOctaveShiftAnchor();return t.setMeasure(this),t},z.getMiddleOctaveShiftsAnchors=function(){const t=this.tickableContent.getMiddleOctaveShiftsAnchors();return t.forEach(this.dispatchMeasure,this),t},z.getAllOctaveShiftsAnchors=function(){const t=this.tickableContent.getAllOctaveShiftsAnchors();return t.forEach(this.dispatchMeasure,this),t},z.hasRightPluckedRangeAnchor=function(){return this.tickableContent.hasRightPluckedRangeAnchor()},z.getRightPluckedRangeAnchor=function(){const t=this.tickableContent.getRightPluckedRangeAnchor();return t.setMeasure(this),t},z.hasLeftPluckedRangeAnchor=function(){return this.tickableContent.hasLeftPluckedRangeAnchor()},z.getLeftPluckedRangeAnchor=function(){const t=this.tickableContent.getLeftPluckedRangeAnchor();return t.setMeasure(this),t},z.getMiddlePluckedRangesAnchors=function(){const t=this.tickableContent.getMiddlePluckedRangesAnchors();return t.forEach(this.dispatchMeasure,this),t},z.getAllPluckedRangesAnchors=function(){const t=this.tickableContent.getAllPluckedRangesAnchors();return t.forEach(this.dispatchMeasure,this),t},z.hasRightPedalAnchor=function(){return this.tickableContent.hasRightPedalAnchor()},z.getRightPedalAnchor=function(){const t=this.tickableContent.getRightPedalAnchor();return t.setMeasure(this),t},z.hasLeftPedalAnchor=function(){return this.tickableContent.hasLeftPedalAnchor()},z.getLeftPedalAnchor=function(){const t=this.tickableContent.getLeftPedalAnchor();return t.setMeasure(this),t},z.getMiddlePedalsAnchors=function(){const t=this.tickableContent.getMiddlePedalsAnchors();return t.forEach(this.dispatchMeasure,this),t},z.getAllPedalsAnchors=function(){const t=this.tickableContent.getAllPedalsAnchors();return t.forEach(this.dispatchMeasure,this),t},z.getAllTempoChangesAnchors=function(){const t=this.middleTempoChangesAnchors.slice();return this.hasLeftTempoChangeAnchor()&&t.push(this.getLeftTempoChangeAnchor()),this.hasRightTempoChangeAnchor()&&t.push(this.getRightTempoChangeAnchor()),t.forEach(this.dispatchMeasure,this),t},z.hasRightTempoChangeAnchor=function(){return this.systemLocation===Es.A.OTHER?!1:this.rightTempoChangeAnchor!==null},z.getRightTempoChangeAnchor=function(){const t=this.rightTempoChangeAnchor;return t.setMeasure(this),t},z.hasLeftTempoChangeAnchor=function(){return this.systemLocation===Es.A.OTHER?!1:this.leftTempoChangeAnchor!==null},z.getLeftTempoChangeAnchor=function(){const t=this.leftTempoChangeAnchor;return t.setMeasure(this),t},z.getMiddleTempoChangesAnchors=function(){if(this.systemLocation===Es.A.OTHER)return[];const t=this.middleTempoChangesAnchors;return t.forEach(this.dispatchMeasure,this),t},z.getAllEndingsAnchors=function(){const t=this.middleEndingsAnchors.slice();return this.hasLeftEndingAnchor()&&t.push(this.getLeftEndingAnchor()),this.hasRightEndingAnchor()&&t.push(this.getRightEndingAnchor()),t.forEach(this.dispatchMeasure,this),t},z.hasRightEndingAnchor=function(){return this.systemLocation===Es.A.OTHER?!1:this.rightEndingAnchor!==null},z.getRightEndingAnchor=function(){const t=this.rightEndingAnchor;return t.setMeasure(this),t},z.hasLeftEndingAnchor=function(){return this.systemLocation===Es.A.OTHER?!1:this.leftEndingAnchor!==null},z.getLeftEndingAnchor=function(){const t=this.leftEndingAnchor;return t.setMeasure(this),t},z.getMiddleEndingsAnchors=function(){if(this.systemLocation===Es.A.OTHER)return[];const t=this.middleEndingsAnchors;return t.forEach(this.dispatchMeasure,this),t},z.dispatchMeasure=function(t){t.setMeasure(this)},z.getNbNotes=function(t){return this.tickableContent.getNbNotes(t)},z.hasVoice=function(t){return this.tickableContent.hasVoice(t)},z.getFullAttributesGroup=function(){const t=this.getAttributes(A.A.FIRST_OF_SCORE);return t.drawn||(t.draw(),t.unbind()),t.getGroup()},z.setIsMeasureInDisplayedRange=function(t){this.inDisplayedRange=t},z.isInDisplayedRange=function(){return this.inDisplayedRange},z.getVoiceMelismaLevels=function(t){return this.tickableContent.getVoiceMelismaLevels(t)},z.isEmpty=function(){return this.isEmptyBool},z.getMeasureNumberShift=function(){return this.tickableContent.getMeasureNumberShift()};const uu=Tr;var Ho=r(269032);const Sh=function(t,s){this.init(t,s)},Zs=Sh.prototype;Zs.init=function(t,s){this.line=null,this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.margin=null,this.group=new L.A("g"),this.parent=null,t==="none"&&(t="regular"),fu(t),du(s),this.style=t,this.pos=s};const fu=function(t){let s;if(!q.A.validSingleStyles.includes(t))throw s=`The bar style [${t}] is invalid.`,new F.default("BadBarStyle",s);if(!q.A.supportedSingleStyles.includes(t))throw s=`The bar style [${t}] is not yet supported.`,new st.A(s)},du=function(t){if(t!==q.A.POS_FIRST&&t!==q.A.POS_SECOND){const s=`The bar position [${t}] is invalid.`;throw new F.default("BadBarlinePosition",s)}};Zs.setStaffData=function(t){this.staffData=t},Zs.setParent=function(t){this.parent=t},Zs.render=function(t){this.drawingContext=t,this.margin=t.getBarlineSeparation();const s=this.getWidth(),n=s/2,c=n,y=n,N=0,j=this.getHeight();this.line=new Xi.A(this.group,{stroke_width:s}),this.line.render(c,N,y,j)},Zs.getHeight=function(){return this.checkHasStaffData(),(this.getNbStaffLines()-1)*this.getSpaceSize()},Zs.checkHasStaffData=function(){if(this.staffData===null){const t="The barline needs to know the number of staff lines to be rendered with the good height.";throw new F.default("MissingNbStaves",t)}},Zs.getNbStaffLines=function(){return R.A.getNbStaffLines(this.staffData)},Zs.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},Zs.isTabStaff=function(){return R.A.isTabStaff(this.staffData)},Zs.getWidth=function(){return this.width===null&&(this.width=this.getThickness()),this.width},Zs.getThickness=function(){return this.style==="regular"||this.style==="light"?this.drawingContext.getThinBarlineThickness():this.drawingContext.getThickBarlineThickness()},Zs.getPreviousSpace=function(){return this.pos===q.A.POS_SECOND?this.margin:0},Zs.getNextSpace=function(){return 0},Zs.draw=function(){this.move(),this.line.draw(),this.bindToParent()},Zs.bindToParent=function(){this.parent.append(this.group)},Zs.setPosition=function(t){this.xPos=t},Zs.move=function(){this.group.attr("transform",`translate(${this.xPos} 0)`)},Zs.extend=function(t){const s=this.getHeight();this.line.setY2(s+t)};const yh=Sh,Ph={};Ph.noOp=function(){};const gu=Ph,pu="repeatDot",wh=function(t){this.init(t)},ri=wh.prototype;ri.init=function(t){this.upperDot=null,this.lowerDot=null,this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.margin=null,this.group=new L.A("g"),this.parent=null,mu(t),this.repeatDirection=t};const mu=function(t){if(t!==Ho.A.DIRECTION_BACKWARD&&t!==Ho.A.DIRECTION_FORWARD){const s=`The repeat direction [${t}] is invalid.`;throw new F.default("BadRepeatDirection",s)}};ri.setParent=function(t){this.parent=t},ri.setStaffData=function(t){this.staffData=t},ri.render=function(t){this.drawingContext=t,this.glyph=this.drawingContext.getGlyph(pu),this.width=this.glyph.getWidth(),this.margin=t.getRepeatBarlineDotSeparation();const s=this.getSpaceSize(),n=this.getCoeff(),c=-n*s,y=n*s,N=this.glyph.render();this.upperDot=this.group.append("path"),this.upperDot.attr("d",N),this.upperDot.attr("transform",`translate(0, ${c})`),this.lowerDot=this.group.append("path"),this.lowerDot.attr("d",N),this.lowerDot.attr("transform",`translate(0, ${y})`)},ri.getCoeff=function(){return R.A.getNbStaffLines(this.staffData)%2===0?1:.5},ri.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},ri.isTabStaff=function(){return R.A.isTabStaff(this.staffData)},ri.getWidth=function(){return this.width},ri.getPreviousSpace=function(){return this.repeatDirection===Ho.A.DIRECTION_BACKWARD?0:this.margin},ri.getNextSpace=function(){return this.repeatDirection===Ho.A.DIRECTION_BACKWARD?this.margin:0},ri.draw=function(){this.move(),this.bindToParent()},ri.bindToParent=function(){this.parent.append(this.group)},ri.setPosition=function(t){this.xPos=t},ri.move=function(){this.checkHasStaffData();const t=this.getSpaceSize(),s=(this.getNbStaffLines()-1)*t/2;this.group.attr("transform",`translate(${this.xPos} ${s})`)},ri.getNbStaffLines=function(){return R.A.getNbStaffLines(this.staffData)},ri.checkHasStaffData=function(){if(this.staffData===null){const t="The repeat dots needs to know the number of staff lines to be drawn at the good Y.";throw new F.default("MissingNbStaves",t)}},ri.extend=gu.noOp;const Dh=wh,Au="-",Lr=function(t){this.init(t)};Lr.cssClass="barline";const _s=Lr.prototype;_s.cssClass=Lr.cssClass,_s.init=function(t){this.list=[],this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.parent=null,this.initContent(t)},_s.initContent=function(t){q.A.hasRepeatBackward(t)&&this.addRepeatBackward();const n=q.A.getStyle(t).split(Au);this.addFirstBar(n[0]),n.length===2&&this.addSecondBar(n[1]),q.A.hasRepeatForward(t)&&this.addRepeatForward()},_s.addRepeatForward=function(){const t=Ho.A.DIRECTION_FORWARD,s=new Dh(t);this.addEntity(s)},_s.addFirstBar=function(t){const s=q.A.POS_FIRST,n=new yh(t,s);this.addEntity(n)},_s.addSecondBar=function(t){const s=q.A.POS_SECOND,n=new yh(t,s);this.addEntity(n)},_s.addRepeatBackward=function(){const t=Ho.A.DIRECTION_BACKWARD,s=new Dh(t);this.addEntity(s)},_s.addEntity=function(t){t.setParent(this.group),this.list.push(t)},_s.setParent=function(t){this.parent=t},_s.setStaffData=function(t){this.staffData=t,this.list.forEach(this.transferStaffData,this)},_s.transferStaffData=function(t){t.setStaffData(this.staffData)},_s.render=function(t){this.drawingContext=t,this.list.forEach(this.renderEntity,this),this.computePositions()},_s.renderEntity=function(t){t.render(this.drawingContext)},_s.computePositions=function(){this.width=this.list.reduce(Su,0)};const Su=function(t,s){return t+=s.getPreviousSpace(),s.setPosition(t),t+s.getWidth()+s.getNextSpace()};_s.getWidth=function(){return this.width},_s.draw=function(){this.move(),this.list.forEach(yu),this.bindToParent()},_s.bindToParent=function(){this.parent.append(this.group)};const yu=function(t){t.draw()};_s.setPosition=function(t){this.xPos=t},_s.move=function(){this.group.attr("transform",`translate(${this.xPos} 0)`)},_s.extend=function(t){this.list.forEach(function(s){s.extend(t)})};const Ch=Lr,Pu="adagio-attributes-side",wu=0,Du=1,Cu=2,_o=function(){this.init()};_o.LEFT="left",_o.RIGHT="right",_o.cssClass="attributes";const je=_o.prototype;je.cssClass=_o.cssClass,je.init=function(){this.list=[],this.drawingContext=null,this.staffData=null,this.width=null,this.xPos=null,this.drawn=!1,this.side=null,this.group=null,this.parent=null},je.setParent=function(t){this.parent=t},je.setSide=function(t){this.side=t},je.setStaffData=function(t){this.staffData=t,this.list.forEach(this.transferStaffData,this)},je.transferStaffData=function(t){t.attr.setStaffData(this.staffData)},je.setClef=function(t){this.addAttr(t,wu)},je.setKey=function(t){this.addAttr(t,Du)},je.setTime=function(t){this.addAttr(t,Cu)},je.addAttr=function(t,s){const n={attr:t,type:s};this.list.push(n)},je.setDrawingContext=function(t){this.drawingContext=t,this.list.forEach(this.transferDrawingContext,this)},je.transferDrawingContext=function(t){t.attr.setDrawingContext(this.drawingContext)},je.getWidth=function(){return this.isAligned()||this.align(),this.width},je.getPreviousSpace=function(){return this.list.length>0?this.drawingContext.getMarginSize():0},je.getNextSpace=function(){return this.list.length>0?this.drawingContext.getMarginSize():0},je.isAligned=function(){return this.width!==null},je.align=function(){this.width=this.list.reduce(this.alignEntry.bind(this),0,this)},je.alignEntry=function(t,s){if(t>0){const c=this.getMarginSize();t+=c}s.attr.setPosition(t);const n=s.attr.getWidth();return t+n},je.getMarginSize=function(){return this.drawingContext.getAttributesOffset()},je.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.group.setDataEntry(Pu,this.side),this.list.forEach(this.renderEntry,this)},je.renderEntry=function(t){this.isAligned()||this.align(),t.attr.setParent(this.group),t.attr.render()},je.draw=function(){this.needRender()&&(this.render(),this.list.forEach(xu)),this.move(),this.bindToParent()},je.needRender=function(){return this.group===null},je.getGroup=function(){return this.group};const xu=function(t){t.attr.draw()};je.bindToParent=function(){this.drawn||(this.parent.append(this.group),this.drawn=!0)},je.unbind=function(){this.drawn&&(this.group.removeFromParent(),this.drawn=!1)},je.setPosition=function(t){this.xPos=t},je.move=function(){!this.needRender()&&this.xPos!==null&&this.group.attr("transform",`translate(${this.xPos} 0)`)},je.getUpOverflow=function(){return this.list.map(vu).reduce(Bt.default.max2,0)};const vu=function(t){return t.attr.getUpOverflow()};je.getDownOverflow=function(){return this.list.map(Tu).reduce(Bt.default.max2,0)};const Tu=function(t){return t.attr.getDownOverflow()},Er=_o;var Lu=r(595382),da=r(351277),Eu=r(627300);const bu=qt.default.createDefault(),Mu=new Map([[0,",,"],[1,","],[2,""],[3,""],[4,"'"],[5,"''"],[6,"'''"],[7,"''''"],[8,"'''''"],[9,"''''''"]]);function Ru(t,s){return s<=2?t.toUpperCase():t.toLowerCase()}const Ou=new Map([[-1,"\u266D"],[0,""],[1,"\u266F"]]);function Nu(t){let s=Eu.default.toPitch(t);s=Lu.A.normalizeFromKey(s,bu);const n=da.default.getStep(s),c=da.default.getAlter(s),y=da.default.getOctave(s),N=Ru(n,y),j=Mu.get(y),lt=Ou.get(c);return`${N}${j}${lt}`}function Bu(t){const s=ae.default.getStaffTunings(t),n=ae.default.getNbStaffLines(t);return s.map((y,N)=>{const j=n-N-1;return{textStr:Nu(y),textNode:null,backgroundNode:null,rootNode:null,line:j,shiftRight:!1,width:null,height:null,xPos:0,yPos:0}})}class br{constructor(s){Object.defineProperty(this,"cssClass",{enumerable:!0,configurable:!0,writable:!0,value:br.CSS_CLASS}),this.drawingContext=null,this.staffData=null,this.xPos=null,this.parent=null,this.group=null,this.strings=Bu(s),this.width=null,this.upOverflow=null,this.downOverflow=null}setParent(s){this.parent=s}setStaffData(s){this.staffData=s}setDrawingContext(s){this.drawingContext=s}setPosition(s){this.xPos=s}getWidth(){return this.width===null&&(this._renderIfNeeded(),this.width=Math.max(...this.strings.map(s=>s.width))),this.width}getUpOverflow(){if(this.upOverflow===null){this._renderIfNeeded();const s=this.strings.slice();this.capo&&s.push(this.capo),this.upOverflow=Math.max(...s.map(n=>-(n.yPos+n.height/2)))}return this.upOverflow}getDownOverflow(){if(this.downOverflow===null){this._renderIfNeeded();const s=this.drawingContext.getTabSpaceSize(),n=(this._getNbStaffLines()-1)*s;this.downOverflow=Math.max(...this.strings.map(c=>c.yPos+c.height/2-n))}return this.downOverflow}_getNbStaffLines(){return R.A.getNbStaffLines(this.staffData)}draw(){this._renderIfNeeded(),this.move(),this.bindToParent()}bindToParent(){this.parent.append(this.group)}move(){!this._needRender()&&this.xPos!==null&&this.group.attr("transform",`translate(${this.xPos} 0)`)}_renderIfNeeded(){this._needRender()&&this.render()}_needRender(){return this.group===null}render(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.strings.forEach(this._renderString,this),this.strings.forEach(this._moveString,this)}_renderString(s){s.rootNode=this.group.append("g"),s.textNode=new bs.A({text:s.textStr}),s.textNode.setDrawingContext(this.drawingContext);const n=this.drawingContext.getTabSpaceSize();s.textNode.setFontSize(n);const c=this._getFontFamily();s.textNode.options["font-family"]=c,s.textNode.options["font-weight"]="bold",s.height=this.drawingContext.getTabSpaceSize()*2/3,s.textNode.setYPos(s.height/2),s.width=s.textNode.getWidth();let y=0;s.shiftRight&&(y=-s.width/2),s.textNode.setXPos(y),s.textNode.setParent(s.rootNode),s.textNode.render(),s.backgroundNode=s.rootNode.append("rect"),s.backgroundNode.style("fill","rgb(255,255,255)"),s.backgroundNode.style("stroke","rgb(255,255,255)"),s.backgroundNode.attr("width",`${s.width}px`),s.backgroundNode.attr("height",`${s.height}px`),s.backgroundNode.attr("transform",`translate(${y} ${-s.height/2})`),s.textNode.draw()}_getFontFamily(){return this.drawingContext.hasFretNumberFont()?this.drawingContext.getFretFontFamily():this.drawingContext.getHarmonyFontFamily()}_moveString(s){const n=this.drawingContext.getTabSpaceSize(),c=s.line*n;s.yPos=c,s.rootNode.attr("transform",`translate(${s.xPos} ${s.yPos})`)}}Object.defineProperty(br,"CSS_CLASS",{enumerable:!0,configurable:!0,writable:!0,value:"TuningStrings"});const Hu=br;class Mr{constructor(s){Object.defineProperty(this,"cssClass",{enumerable:!0,configurable:!0,writable:!0,value:Mr.CSS_CLASS}),this.drawingContext=null,this.staffData=null,this.xPos=null,this.parent=null,this.capo=ae.default.getCapo(s),this.group=null,this.text=null,this.line=null,this.width=null,this.upOverflow=null,this.downOverflow=0}setParent(s){this.parent=s}setStaffData(s){this.staffData=s}setDrawingContext(s){this.drawingContext=s}setPosition(s){this.xPos=s}getWidth(){return this.width===null&&(this._renderIfNeeded(),this.width=this.text.getWidth()),this.width}getUpOverflow(){return this.upOverflow===null&&(this._renderIfNeeded(),this.upOverflow=this.text.getFontSize()),this.upOverflow}getDownOverflow(){return this.downOverflow}_getNbStaffLines(){return R.A.getNbStaffLines(this.staffData)}draw(){this._renderIfNeeded(),this.move(),this.bindToParent()}bindToParent(){this.parent.append(this.group)}move(){!this._needRender()&&this.xPos!==null&&this.group.attr("transform",`translate(${this.xPos} 0)`)}_renderIfNeeded(){this._needRender()&&this.render()}_needRender(){return this.group===null}render(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this._renderText(),this._renderLine()}_renderText(){this.text=new bs.A({text:this.capo}),this.text.setDrawingContext(this.drawingContext);const s=this.drawingContext.getTabSpaceSize();this.text.setFontSize(s);const n=this._getFontFamily();this.text.options["font-family"]=n,this.text.options["font-weight"]="bold",this.text.setYPos(-s/3),this.width=this.text.getWidth(),this.text.setParent(this.group),this.text.render(),this.text.draw()}_renderLine(){const s=this.drawingContext.getThickBarlineThickness(),n=this.text.getWidth()/2,c=0,y=this.drawingContext.getTabSpaceSize(),N=R.A.getNbStaffLines(this.staffData),j=y*(N-1);this.line=this.group.append("line"),this.line.attr("x1",n).attr("y1",c).attr("x2",n).attr("y2",j).attr("stroke-width",s)}_getFontFamily(){return this.drawingContext.hasFretNumberFont()?this.drawingContext.getFretFontFamily():this.drawingContext.getHarmonyFontFamily()}}Object.defineProperty(Mr,"CSS_CLASS",{enumerable:!0,configurable:!0,writable:!0,value:"TuningCapo"});const _u=Mr;class Rr{constructor(s){Object.defineProperty(this,"cssClass",{enumerable:!0,configurable:!0,writable:!0,value:Rr.CSS_CLASS}),this.drawingContext=null,this.staffData=null,this.xPos=null,this.parent=null,this.group=null,this.strings=new Hu(s),this.capo=null,ae.default.hasCapo(s)&&(this.capo=new _u(s)),this.width=null,this.upOverflow=null,this.downOverflow=null}setParent(s){this.parent=s}setStaffData(s){this.staffData=s,this.strings.setStaffData(s),this.capo&&this.capo.setStaffData(s)}setDrawingContext(s){this.drawingContext=s,this.strings.setDrawingContext(s),this.capo&&this.capo.setDrawingContext(s)}setPosition(s){this.xPos=s}getWidth(){return this.width===null&&(this._renderIfNeeded(),this.capo?this.width=this.capo.getWidth()+this.capo.xPos:this.width=this.strings.getWidth()),this.width}getUpOverflow(){return this.upOverflow===null&&(this._renderIfNeeded(),this.upOverflow=this.strings.getUpOverflow(),this.capo&&(this.upOverflow=Math.max(this.upOverflow,this.capo.getUpOverflow()))),this.upOverflow}getDownOverflow(){return this.downOverflow===null&&(this._renderIfNeeded(),this.downOverflow=this.strings.getDownOverflow()),this.downOverflow}_getNbStaffLines(){return R.A.getNbStaffLines(this.staffData)}draw(){this._renderIfNeeded(),this.move(),this.strings.draw(),this.capo&&this.capo.draw(),this.bindToParent()}bindToParent(){this.parent.append(this.group)}move(){!this._needRender()&&this.xPos!==null&&this.group.attr("transform",`translate(${this.xPos} 0)`)}_renderIfNeeded(){this._needRender()&&this.render()}_needRender(){return this.group===null}render(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.strings.setParent(this.group),this.strings.render(),this.capo&&(this.capo.setParent(this.group),this.capo.render()),this._format()}_format(){if(this.capo){const s=this.strings.getWidth(),n=this.drawingContext.getMarginSize();this.capo.setPosition(s+n)}}}Object.defineProperty(Rr,"CSS_CLASS",{enumerable:!0,configurable:!0,writable:!0,value:"tuning"});const Iu=Rr,Yu=He.default.pairsToMap([{key:un.A.SEGNO,value:"segno"},{key:un.A.CODA,value:"coda"}]),xh=function(t){this.init(t)},qs=xh.prototype;qs.cssClass="jumpTag",qs.init=function(t){this.group=null,this.parentGroup=null,this.drawingContext=null,this.contentDrawn=!1,this.posX=null,this.posY=null,this.glyph=null,this.jumpType=t},qs.needRender=function(){return this.group===null},qs.setParent=function(t){this.parentGroup=t},qs.bindToParent=function(){this.parentGroup.append(this.group)},qs.removeFromParent=function(){this.group.removeFromParent()},qs.setDrawingContext=function(t){this.drawingContext=t},qs.setPosX=function(t){this.posX=t},qs.setPosY=function(t){this.posY=t},qs.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass)},qs.draw=function(){this.needRender()&&this.render();const t=this.getGlyph();this.drawContent(t),this.move(),this.bindToParent()},qs.drawContent=function(t){this.contentDrawn=!0,this.group.append("path").attr("d",t.render())},qs.getGlyphId=function(){return Yu[this.jumpType]},qs.getGlyph=function(){if(this.glyph===null){const t=this.getGlyphId();this.glyph=this.drawingContext.getGlyph(t)}return this.glyph},qs.move=function(){if(!this.needRender()){const t=this.getGlyph(),s=this.posX-t.getWidth()/2,n=this.posY;this.group.attr("transform",`translate(${s} ${n})`)}},qs.getHeight=function(){return this.getGlyph().getHeight()},qs.getWidth=function(){return this.getGlyph().getWidth()},qs.getMarginSize=function(){return this.drawingContext.getSpaceSize()/2};const vh=xh,Or=function(t,s){this.init(t,s)};Or.cssClass="rehearsalBox";const Tn=Or.prototype;Tn.cssClass=Or.cssClass,Tn.init=function(t,s){this.drawingContext=null,this.parent=null,this.group=null,this.bottomLine=null,this.topLine=null,this.leftLine=null,this.rightLine=null,this.lines=[],this.width=t,this.height=s},Tn.setDrawingContext=function(t){this.drawingContext=t},Tn.setParent=function(t){this.parent=t},Tn.draw=function(){this.isRendered()||this.render(),this.forEachLine(Fu),this.bindToParent()},Tn.render=function(){if(this.isRendered())return;this.group=new L.A("g"),this.group.attr("class",this.cssClass);const s={stroke_width:this.drawingContext.getTextEnclosureThickness()};this.bottomLine=new Xi.A(this.group,s),this.bottomLine.render(0,0,this.width,0),this.lines.push(this.bottomLine),this.topLine=new Xi.A(this.group,s),this.topLine.render(0,this.height,this.width,this.height),this.lines.push(this.topLine),this.leftLine=new Xi.A(this.group,s),this.leftLine.render(0,0,0,this.height),this.lines.push(this.leftLine),this.rightLine=new Xi.A(this.group,s),this.rightLine.render(this.width,0,this.width,this.height),this.lines.push(this.rightLine)},Tn.isRendered=function(){return this.group!==null},Tn.forEachLine=function(t,s){this.lines.forEach(t,s)};const Fu=function(t){t.draw()};Tn.bindToParent=function(){this.parent.append(this.group)},Tn.hide=function(){this.group.removeFromParent()};const Wu=Or,Nr=function(t){this.init(t)};Nr.cssClass="rehearsalText";const dn=Nr.prototype;dn.cssClass=Nr.cssClass,dn.init=function(t){this.letter=t,this.drawingContext=null,this.parent=null,this.text=null},dn.setParent=function(t){this.parent=t},dn.setCssClass=function(t){this.cssClass=t},dn.setDrawingContext=function(t){this.drawingContext=t},dn.render=function(){const t=this.drawingContext.getRehearsalFontFamily(),s=this.drawingContext.getRehearsalFontStyle(),n=this.drawingContext.getRehearsalFontWeight(),c=new bs.A({"font-family":t,"font-style":s,"font-weight":n,text:this.letter});c.setParent(this.parent),c.setDrawingContext(this.drawingContext),this.fontSize=this.drawingContext.getRehearsalFontSize(),this.padding=this.drawingContext.getRehearsalPadding(),c.setFontSize(this.fontSize),this.text=c,this.text.render(),this.text.setXPos(this.padding),this.text.setYPos(this.fontSize-this.padding*1.1)},dn.draw=function(){this.isRendered()||this.render(),this.text.draw()},dn.getWidth=function(){return this.isRendered()||this.render(),this.text.getWidth()+this.padding*2},dn.getHeight=function(){return this.isRendered()||this.render(),this.fontSize},dn.isRendered=function(){return this.text!==null},dn.hide=function(){this.text.hide()};const Gu=Nr,Br=function(t){this.init(t)};Br.cssClass="rehearsal";const Is=Br.prototype;Is.cssClass=Br.cssClass,Is.init=function(t){this.letter=t,this.text=null,this.box=null,this.contentDrawn=!1,this.drawingContext=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},Is.setParent=function(t){this.parent=t},Is.setDrawingContext=function(t){this.drawingContext=t},Is.draw=function(){this.isRendered()||this.render(),this.drawContent(),this.move(),this.bindToParent(),this.drawn=!0},Is.render=function(){this.group=new L.A("g"),this.group.attr("class",this.cssClass),this.createContent()},Is.drawContent=function(){this.contentDrawn=!0,this.text.draw(),this.box.draw()},Is.move=function(){this.isRendered()&&this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},Is.setPosX=function(t){this.posX=t},Is.setPosY=function(t){this.posY=t},Is.isRendered=function(){return this.group!==null},Is.bindToParent=function(){this.parent.append(this.group)},Is.removeFromParent=function(){this.group.removeFromParent()},Is.getWidth=function(){return this.isRendered()||this.render(),this.text.getWidth()},Is.getHeight=function(){return this.isRendered()||this.render(),this.text.getHeight()},Is.getGroup=function(){return this.group},Is.setDisplayIdx=function(t){this.letter=(t+1).toString(),this.isRendered()&&(this.hideContent(),this.createContent()),this.drawn&&this.drawContent()},Is.hideContent=function(){this.drawn&&(this.text.hide(),this.box.hide()),this.text=null,this.box=null},Is.createContent=function(){this.text=new Gu(this.letter),this.text.setDrawingContext(this.drawingContext),this.text.setParent(this.group);const t=this.text.getWidth(),s=this.text.getHeight();this.box=new Wu(t,s),this.box.setDrawingContext(this.drawingContext),this.box.setParent(this.group)},Is.getPreviousSpace=function(){return this.drawingContext.getSpaceSize()*2};const Uu=Br,zu="systemBreakYes",ku=2,Io=function(t,s){this.init(t,s)};Io.cssClass="systemBreak",Io.nextCssClass="nextSystemBreak";const xi=Io.prototype;xi.cssClass=Io.cssClass,xi.nextCssClass=Io.nextCssClass,xi.init=function(t,s){this.value=t,this.parent=null,this.path=null,this.isNext=s,this.drawingContext=null,this.posY=null,this.posX=null,this.glyph=null},xi.setPosY=function(t){this.posY=t},xi.setPosX=function(t){this.posX=t},xi.setDrawingContext=function(t){this.drawingContext=t},xi.setParent=function(t){this.parent=t},xi.draw=function(){this.renderIfNeeded(),this.move(),this.bindToParent()},xi.renderIfNeeded=function(){this.isRendered()||this.render()},xi.isRendered=function(){return this.path!==null},xi.render=function(){const s=this.getGlyph().render(),n=new L.A("path");n.attr("stroke","black");const c=this.drawingContext.getSystemBreakGlyphThickness();n.attr("stroke-width",c),this.isNext?n.attr("class",this.nextCssClass):n.attr("class",this.cssClass),n.attr("d",s),this.path=n},xi.move=function(){if(this.isRendered()){const t=this.posX,s=this.posY;this.path.attr("transform",`translate(${t}, ${s})`)}},xi.bindToParent=function(){this.parent.append(this.path)},xi.removeFromParent=function(){this.path.removeFromParent()},xi.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getScaledIconGlyph(zu,ku)),this.glyph};const Th=Io,Xu=["pageBreakYesArrowHead","pageBreakYesArrowLine","pageBreakYesPage","pageBreakYesDashedLine"],Vu=2,Yo=function(t,s){this.init(t,s)};Yo.cssClass="pageBreak",Yo.nextCssClass="nextPageBreak";const Yi=Yo.prototype;Yi.cssClass=Yo.cssClass,Yi.nextCssClass=Yo.nextCssClass,Yi.init=function(t,s){this.value=t,this.parent=null,this.group=null,this.isNext=s,this.drawingContext=null,this.posY=null,this.posX=null},Yi.setPosY=function(t){this.posY=t},Yi.setPosX=function(t){this.posX=t},Yi.setDrawingContext=function(t){this.drawingContext=t},Yi.setParent=function(t){this.parent=t},Yi.draw=function(){this.renderIfNeeded(),this.move(),this.bindToParent()},Yi.renderIfNeeded=function(){this.isRendered()||this.render()},Yi.isRendered=function(){return this.group!==null},Yi.render=function(){const t=new L.A("g");this.isNext?t.attr("class",this.nextCssClass):t.attr("class",this.cssClass),Xu.forEach(function(s){const c=this.drawingContext.getScaledIconGlyph(s,Vu).render(),y=t.append("path");y.attr("d",c),y.attr("fill-rule","evenodd")},this),this.group=t},Yi.move=function(){if(this.isRendered()){const t=this.posX,s=this.posY;this.group.attr("transform",`translate(${t}, ${s})`)}},Yi.bindToParent=function(){this.parent.append(this.group)},Yi.removeFromParent=function(){this.group.removeFromParent()};const Lh=Yo,Eh=function(){this.init()},ti=Eh.prototype;ti.init=function(){this.parent=null,this.contentDrawn=!1,this.drawingContext=null,this.swing=null,this.tempo=null,this.text=null,this.spaceAbove=null,this.posX=null,this.posY=null,this.width=null},ti.setParent=function(t){this.parent=t,this.swing!==null&&this.swing.setParent(t),this.tempo!==null&&this.tempo.setParent(t),this.text!==null&&this.text.setParent(t)},ti.setSwing=function(t){this.swing=t},ti.setTempo=function(t){this.tempo=t},ti.setTextStr=function(t){const s={text:t};this.text=new bs.A(s)},ti.setPosX=function(t){this.posX=t,this.tempo!==null&&(this.tempo.setPosX(t),t+=this.tempo.getWidth()),this.text!==null&&(t+=this.getMargin(),this.text.setXPos(t),t+=this.text.getWidth(),t+=this.getMargin()),this.swing!==null&&(this.swing.setPosX(t),t+=this.swing.getWidth())},ti.setPosY=function(t){this.posY=t;const s=this.getSpaceAbove();if(this.swing!==null&&this.swing.setPosY(t+s),this.tempo!==null){const n=this.tempo.getSpaceAbove();this.tempo.setPosY(t+(s-n))}this.text!==null&&this.text.setYPos(t+s)},ti.setDrawingContext=function(t){if(this.drawingContext=t,this.text!==null){this.text.setDrawingContext(t);const s=this.drawingContext.getTempoFontSize();this.text.setFontSize(s*wi.GLOBAL_RATIO);const n=this.drawingContext.getTempoFontFamily();this.text.options["font-family"]=n;const c=this.drawingContext.getTempoFontWeight();this.text.options["font-weight"]=c;const y=this.drawingContext.getTempoFontStyle();this.text.options["font-style"]=y}this.swing!==null&&this.swing.setDrawingContext(t),this.tempo!==null&&this.tempo.setDrawingContext(t)},ti.draw=function(){this.drawContent()},ti.getMargin=function(){return this.drawingContext.getSpaceSize()/2*wi.GLOBAL_RATIO},ti.drawContent=function(){this.contentDrawn=!0,this.swing!==null&&this.swing.draw(),this.tempo!==null&&this.tempo.draw(),this.text!==null&&(this.text.render(),this.text.draw())},ti.bindToParent=function(){this.swing!==null&&this.swing.bindToParent(),this.tempo!==null&&this.tempo.bindToParent(),this.text!==null&&this.text.bindToParent()},ti.removeFromParent=function(){this.swing!==null&&this.swing.removeFromParent(),this.tempo!==null&&this.tempo.removeFromParent(),this.text!==null&&this.text.hide()},ti.move=function(){this.text!==null&&this.text.isRendered()&&this.text.move(),this.swing!==null&&this.swing.move(),this.tempo!==null&&this.tempo.move()},ti.getWidth=function(){if(this.width===null){let t=0;this.tempo!==null&&(t+=this.tempo.getWidth()),this.text!==null&&(t+=this.getMargin(),t+=this.text.getWidth(),t+=this.getMargin()),this.swing!==null&&(t+=this.swing.getWidth()),this.width=t}return this.width},ti.getHeight=function(){let t=0;if(this.tempo!==null){const s=this.tempo.getHeight();t=Math.max(t,s)}if(this.swing!==null){const s=this.swing.getHeight();t=Math.max(t,s)}return t},ti.getSpaceAbove=function(){if(this.spaceAbove===null){if(this.spaceAbove=0,this.tempo!==null){const t=this.tempo.getSpaceAbove();this.spaceAbove=Math.max(this.spaceAbove,t)}if(this.swing!==null){const t=this.swing.getSpaceAbove();this.spaceAbove=Math.max(this.spaceAbove,t)}}return this.spaceAbove},ti.getPreviousSpace=function(){return this.drawingContext.getSpaceSize()};const $u=Eh,Ku="textBlackNoteShortStem",ju="note8thUp",Qu="textTupletBracketStartLongStem",Ju="textTupletBracketEndLongStem",Zu="textTuplet3LongStem",qu=1/3,Hr=function(){this.init()};Hr.NAME="swing.tuplet";const Ds=Hr.prototype;Ds.name=Hr.NAME,Ds.init=function(){this.group=null,this.parent=null,this.drawingContext=null,this.glyphes=null,this.upperGlyphes=null,this.lowerGlyphes=null,this.posX=null,this.posY=null,this.width=null,this.spaceAbove=null,this.height=null},Ds.setDrawingContext=function(t){this.drawingContext=t},Ds.setParent=function(t){this.parent=t},Ds.draw=function(){this.isRendered()||(this.render(),this.format()),this.move(),this.bindToParent()},Ds.isRendered=function(){return this.group!==null},Ds.getGlyphes=function(){if(this.glyphes===null){const t=this.getUpperGlyphes(),s=this.getLowerGlyphes();this.glyphes=t.concat(s)}return this.glyphes},Ds.getUpperGlyphes=function(){if(this.upperGlyphes===null){this.upperGlyphes=[];const t=or(Qu);this.upperGlyphes.push(t);const s=or(Zu);this.upperGlyphes.push(s);const n=or(Ju);this.upperGlyphes.push(n),this.upperGlyphes.forEach(this.fillGlyph,this),this.positionUpperGlyphes()}return this.upperGlyphes},Ds.positionUpperGlyphes=function(){const t={xPos:0,drawingContext:this.drawingContext};this.upperGlyphes.forEach(tf,t)};function tf(t){const s=this;t.x=s.xPos,s.xPos+=t.glyph.getWidth(),s.xPos+=s.drawingContext.getSpaceSize()*qu}Ds.getLowerGlyphes=function(){if(this.lowerGlyphes===null){this.lowerGlyphes=[];const t=or(Ku);this.lowerGlyphes.push(t);const s=or(ju);this.lowerGlyphes.push(s),this.lowerGlyphes.forEach(this.fillGlyph,this),this.positionLowerGlyphes()}return this.lowerGlyphes},Ds.positionLowerGlyphes=function(){const[t,s]=this.lowerGlyphes,[,,n]=this.upperGlyphes;t.x=0,s.x=n.x,this.width=s.x+s.glyph.getWidth()};function or(t){return{elem:null,glyphId:t,glyph:null,x:0}}Ds.fillGlyph=function(t){t.glyph=this.drawingContext.getScaledGlyph(t.glyphId,wi.GLOBAL_RATIO)},Ds.render=function(){this.group=new L.A("g"),this.group.attr("class",this.name),this.getGlyphes().forEach(this.renderGlyph,this)},Ds.renderGlyph=function(t){t.elem=new L.A("path"),t.elem.attr("d",t.glyph.render()),this.group.append(t.elem)},Ds.format=function(){this.getGlyphes().forEach(ef)};function ef(t){t.elem.attr("transform",`translate(${t.x}, 0)`)}Ds.setPosX=function(t){this.posX=t},Ds.setPosY=function(t){this.posY=t},Ds.move=function(){this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},Ds.bindToParent=function(){this.parent.append(this.group)};function sf(t){return-t.glyph.getBBoxNE().y}Ds.getSpaceAbove=function(){if(this.spaceAbove===null){const s=this.getGlyphes().map(sf);this.spaceAbove=Math.max.apply(null,s)}return this.spaceAbove},Ds.getHeight=function(){if(this.height===null){const t=this.getSpaceAbove(),s=this.getSpaceBelow(),n=this.drawingContext.getSpaceSize();this.height=t+s+n}return this.height};function nf(t){return t.glyph.getBBoxSW().y}Ds.getSpaceBelow=function(){const s=this.getGlyphes().map(nf);return Math.max.apply(null,s)},Ds.getWidth=function(){return this.getGlyphes(),this.width};const of=Hr,rf="textBlackNoteShortStem",af="textCont8thBeamShortStem",hf="textBlackNoteFrac8thShortStem",_r=function(){this.init()};_r.NAME="swing.eighths";const ks=_r.prototype;ks.name=_r.NAME,ks.init=function(){this.group=null,this.parent=null,this.drawingContext=null,this.glyphes=null,this.posX=null,this.posY=null,this.width=null,this.spaceAbove=null,this.height=null},ks.setDrawingContext=function(t){this.drawingContext=t},ks.setParent=function(t){this.parent=t},ks.draw=function(){this.isRendered()||(this.render(),this.format()),this.move(),this.bindToParent()},ks.isRendered=function(){return this.group!==null},ks.getGlyphes=function(){if(this.glyphes===null){this.glyphes=[];const t={elem:null,glyphId:rf,glyph:null};this.glyphes.push(t);const s={elem:null,glyphId:af,glyph:null};this.glyphes.push(s);const n={elem:null,glyphId:hf,glyph:null};this.glyphes.push(n),this.glyphes.forEach(this.fillGlyph,this)}return this.glyphes},ks.fillGlyph=function(t){t.glyph=this.drawingContext.getScaledGlyph(t.glyphId,wi.GLOBAL_RATIO)},ks.render=function(){this.group=new L.A("g"),this.group.attr("class",this.name),this.getGlyphes().forEach(this.renderGlyph,this)},ks.renderGlyph=function(t){t.elem=new L.A("path"),t.elem.attr("d",t.glyph.render()),this.group.append(t.elem)},ks.format=function(){this.getGlyphes().reduce(cf,0)};function cf(t,s){return s.elem.attr("transform",`translate(${t}, 0)`),t+=s.glyph.getWidth(),t}ks.setPosX=function(t){this.posX=t},ks.setPosY=function(t){this.posY=t},ks.move=function(){this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},ks.bindToParent=function(){this.parent.append(this.group)};function lf(t){return-t.glyph.getBBoxNE().y}ks.getSpaceAbove=function(){if(this.spaceAbove===null){const s=this.getGlyphes().map(lf);this.spaceAbove=Math.max.apply(null,s)}return this.spaceAbove},ks.getHeight=function(){if(this.height===null){const t=this.getSpaceAbove(),s=this.getSpaceBelow(),n=this.drawingContext.getSpaceSize();this.height=t+s+n}return this.height};function uf(t){return t.glyph.getBBoxSW().y}ks.getSpaceBelow=function(){const s=this.getGlyphes().map(uf);return Math.max.apply(null,s)},ks.getWidth=function(){if(this.width===null){const s=this.getGlyphes().map(ff);this.width=s.reduce(Bt.default.add)}return this.width};function ff(t){return t.glyph.getWidth()}const bh=_r,df="=",gf=1/2,Ir=function(t){this.init(t)};Ir.NAME="swing";const ei=Ir.prototype;ei.name=Ir.NAME,ei.init=function(t){this.isSwinging=t,this.group=null,this.parent=null,this.drawingContext=null,this.leftPart=new bh,t?this.rightPart=new of:this.rightPart=new bh,this.equalText=new bs.A({text:df}),this.posX=null,this.posY=null,this.width=null,this.spaceAbove=null,this.height=null},ei.setDrawingContext=function(t){this.drawingContext=t,this.leftPart.setDrawingContext(t),this.rightPart.setDrawingContext(t),this.equalText.setDrawingContext(t);const s=this.drawingContext.getTempoFontSize();this.equalText.setFontSize(s*wi.GLOBAL_RATIO);const n=this.drawingContext.getTempoFontFamily();this.equalText.options["font-family"]=n;const c=this.drawingContext.getTempoFontWeight();this.equalText.options["font-weight"]=c;const y=this.drawingContext.getTempoFontStyle();this.equalText.options["font-style"]=y},ei.setParent=function(t){this.parent=t},ei.draw=function(){this.isRendered()||(this.render(),this.format(),this.drawContent()),this.move(),this.bindToParent()},ei.isRendered=function(){return this.group!==null},ei.render=function(){this.group=new L.A("g"),this.group.attr("class",this.name),this.leftPart.setParent(this.group),this.rightPart.setParent(this.group),this.equalText.setParent(this.group)},ei.format=function(){const t=this.drawingContext.getSpaceSize()*gf;let s=0;this.leftPart.setPosX(s),this.leftPart.setPosY(0),s+=this.leftPart.getWidth(),s+=t,this.equalText.setXPos(s),s+=this.equalText.getWidth(),s+=t,this.rightPart.setPosX(s),this.rightPart.setPosY(0),s+=this.rightPart.getWidth(),this.width=s},ei.drawContent=function(){this.leftPart.draw(),this.equalText.render(),this.equalText.setCssClass("metronome.text"),this.equalText.draw(),this.rightPart.draw()},ei.setPosX=function(t){this.posX=t},ei.setPosY=function(t){this.posY=t},ei.move=function(){this.isRendered()&&this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},ei.bindToParent=function(){this.parent.append(this.group)},ei.removeFromParent=function(){this.group.removeFromParent()},ei.getSpaceAbove=function(){if(this.spaceAbove===null){const t=this.leftPart.getSpaceAbove(),s=this.rightPart.getSpaceAbove();this.spaceAbove=Math.max(t,s)}return this.spaceAbove},ei.getHeight=function(){if(this.height===null){const t=this.getSpaceAbove(),s=this.getSpaceBelow(),n=this.drawingContext.getSpaceSize();this.height=t+s+n}return this.height},ei.getSpaceBelow=function(){const t=this.leftPart.getSpaceBelow(),s=this.rightPart.getSpaceBelow();return Math.max(t,s)},ei.getWidth=function(){return this.width===null&&this.format(),this.width};const pf=Ir,mf="repeatTimes";class Af{constructor(s){this.times=s,this.posX=0,this.posY=0,this.drawingContext=null,this.parent=null,this.contentDrawn=!1,this.text=null,this.width=null,this.height=null}setDrawingContext(s){this.drawingContext=s,this.text&&this.text.setDrawingContext(s)}setParent(s){this.parent=s,this.text&&this.text.setParent(s)}setPosX(s){this.posX=s}setPosY(s){this.posY=s}getTextElem(){if(this.text===null){const s={text:`${this.times-1}x`};this.text=new bs.A(s),this.parent&&this.text.setParent(this.parent),this.drawingContext&&this.text.setDrawingContext(this.drawingContext)}return this.text}draw(){this.renderIfNeeded(),this.move()}renderIfNeeded(){this.rendered||this.render()}render(){const s=this.getTextElem(),n=this.drawingContext.getRepeatTimesFontSize();s.setFontSize(n);const c=this.drawingContext.getRepeatTimesFontFamily(),y=this.drawingContext.getRepeatTimesFontStyle(),N=this.drawingContext.getRepeatTimesFontWeight();s.options["font-family"]=c,s.options["font-style"]=y,s.options["font-weight"]=N,s.render(),s.setCssClass(mf),s.draw(),this.rendered=!0}removeFromParent(){this.text.hide()}bindToParent(){this.text.bindToParent()}move(){if(this.rendered&&this.posX!==null&&this.posY!==null){const s=this.getWidth();this.text.setPosition(this.posX-s,this.posY),this.text.move()}}getWidth(){return this.renderIfNeeded(),this.text.getWidth()}getHeight(){this.renderIfNeeded();const s=this.getSpaceAbove(),n=this.getSpaceBelow();return s+n}getSpaceAbove(){return this.renderIfNeeded(),this.drawingContext.getHarmonyFontSize()}getSpaceBelow(){return this.drawingContext.getHarmonyFontSize()/2}}var Sf=r(462317);const Mh=function(t){this.init(t)},Pe=Mh.prototype;Pe.init=function(t){this.displayOpts=t||{},this.timeSignatureBuilder=new vt,this.keySignatureBuilder=new ve,this.tempoBuilder=new Gl,this.tickableContentBuilder=new Bl,this.tempoChangeAnchorsBuilder=new zl,this.jumpCallBuilder=new iu},Pe.renderMeasure=function(t){return this.shapeMeasureData(t),this.extractMeasureData(t),this.createMeasureStaves(),this.measureStaves},Pe.shapeMeasureData=function(t){const s=t.current;_.A.shapeMeasure(s)},Pe.extractMeasureData=function(t){this.measureData=t.current,this.isEmpty=t.isEmpty,this.previousMeasure=t.previous,this.nextMeasure=t.next,this.displayedTime=t.displayedTime,this.previousDisplayedTime=t.previousDisplayedTime,this.staffMapping=t.staffMapping,this.partUuid=t.partUuid,this.measureUuid=t.measureUuid,this.voiceIdxToUuidMapping=t.voiceIdxToUuidMapping,this.nbMmr=t.nbMmr;const s=this.getNotes();this.notesByStaff=G.A.groupStaves(s),this.extractLeftAttrsByMeasurePos(),this.extractRightAttributes(),this.extractIsPickup(),this.attrs=f.default.getAttributes(t.current),this.barlinesData=f.default.getBarlines(t.current),this.nbStaves=a.default.getNbStaves(this.attrs),this.staffDetails=f.default.getWrappedStaffDetails(t.current),this.shouldLoadCommonContentElements(t)&&t.ownTempo!==null&&!this.displayOpts.hideTempo?this.ownTempo=t.ownTempo:this.ownTempo=null,this.shouldLoadCommonContentElements(t)&&t.ownSwing!==null?this.ownSwing=t.ownSwing:this.ownSwing=null,this.shouldLoadCommonContentElements(t)&&t.rehearsal!==null?this.rehearsal=t.rehearsal:this.rehearsal=null,this.shouldLoadCommonContentElements(t)&&t.ending!==null?(this.ending=t.ending,this.leftEnding=t.leftEnding,this.rightEnding=t.rightEnding):this.ending=null,this.shouldLoadCommonContentElements(t)&&t.jumpTag!==null?this.jumpTag=t.jumpTag:this.jumpTag=null,this.shouldLoadCommonContentElements(t)&&t.nextJumpTag!==null?this.nextJumpTag=t.nextJumpTag:this.nextJumpTag=null,this.shouldLoadCommonContentElements(t)&&t.repeatTimes!==null?this.repeatTimes=t.repeatTimes:this.repeatTimes=null,this.shouldLoadCommonContentElements(t)&&t.jumpCall!==null?(this.jumpCall=t.jumpCall,this.formerJumpCall=t.formerJumpCall):(this.jumpCall=null,this.formerJumpCall=null),this.shouldLoadCommonContentElements(t)&&t.tempoChanges!==null?this.tempoChanges=t.tempoChanges:this.tempoChanges=null,this.shouldLoadCommonContentElements(t)&&t.leftTempoChange!==null?this.leftTempoChange=t.leftTempoChange:this.leftTempoChange=null,this.shouldLoadCommonContentElements(t)&&t.rightTempoChange!==null?this.rightTempoChange=t.rightTempoChange:this.rightTempoChange=null,this.shouldLoadCommonContentElements(t)&&t.systemBreak!==null?this.systemBreak=t.systemBreak:this.systemBreak=null,this.shouldLoadCommonContentElements(t)&&t.pageBreak!==null?this.pageBreak=t.pageBreak:this.pageBreak=null,this.shouldLoadCommonContentElements(t)&&t.nextPageBreak!==null?this.nextPageBreak=t.nextPageBreak:this.nextPageBreak=null,this.shouldLoadCommonContentElements(t)&&t.nextSystemBreak!==null?this.nextSystemBreak=t.nextSystemBreak:this.nextSystemBreak=null,this.attrsData=null,this.previousMeasure!==null?this.previousMeasureData=new ih(this.previousMeasure,this.displayOpts):this.previousMeasureData=null,this.nextMeasure!==null?this.nextMeasureData=new ih(this.nextMeasure,this.displayOpts):this.nextMeasureData=null},Pe.shouldLoadCommonContentElements=function(t){return this.displayOpts.displayLayout===Sf.A.TRACK?t.isFirstPart:!0},Pe.getNotes=function(){return this.displayOpts.isConcertPitch?f.default.getConcertNotes(this.measureData):f.default.getNotes(this.measureData)},Pe.extractLeftAttrsByMeasurePos=function(){this.leftAttrsByMeasurePos={};let t=f.default.getAttributes(this.measureData);t=(0,P.default)(t);const s=this.getKeys(this.measureData);a.default.setKey(t,s),a.default.setTime(t,this.displayedTime);let n;if(n=Y.extractFromFirstMeasureOfScore(t,this.displayOpts),this.leftAttrsByMeasurePos[A.A.FIRST_OF_SCORE]=ga(n),!this.isFirstMeasure()){let c=f.default.getAttributes(this.previousMeasure);c=(0,P.default)(c);const y=this.getKeys(this.previousMeasure);a.default.setKey(c,y),a.default.setTime(c,this.previousDisplayedTime),n=Y.extractFromMiddleMeasure(t,c,this.displayOpts),this.leftAttrsByMeasurePos[A.A.OTHER]=ga(n),n=Y.extractFromFirstMeasureOfLine(t,c,this.displayOpts),this.leftAttrsByMeasurePos[A.A.FIRST_OF_LINE]=ga(n)}},Pe.getKeys=function(t){if(this.displayOpts.isConcertPitch)return f.default.getConcertKeys(t);{const s=f.default.getAttributes(t);return a.default.getKey(s)}},Pe.extractRightAttributes=function(){let t=null;this.nextMeasure!==null&&(t=f.default.getAttributes(this.nextMeasure));let s=f.default.getAttributes(this.measureData);s=(0,P.default)(s),yf(this.measureData,s),this.rightAttributes=Y.extractRightAttributes(s,t)};function yf(t,s){const n=f.default.getWrappedClef(t),c=a.default.getNbStaves(s);for(let N=0;N<c;N++)if(f.default.hasMiddleClefs(t,N)){const j=f.default.getMiddleClefs(t,N),lt=j.length,Ft=j[lt-1];n.setEntry(Ft,N)}const y=n.dumpAttribute();a.default.setClef(s,y)}Pe.extractIsPickup=function(){const t=f.default.getAnyTime(this.measureData);this.isPickup=!b.default.isSame(t,this.displayedTime)},Pe.isFirstMeasure=function(){return this.previousMeasure===null};const ga=function(t){return{clef:a.default.getWrappedClef(t),key:a.default.getWrappedKey(t),time:a.default.getWrappedTime(t)}};Pe.createMeasureStaves=function(){for(this.measureStaves=[],this.staffIdx=0;this.staffIdx<this.nbStaves;this.staffIdx++)this.createMeasureStaff(),this.measureStaves.push(this.measureStaff)},Pe.createMeasureStaff=function(){this.measureStaff=new uu(null),this.measureStaff.setMeasureUuid(this.measureUuid),this.measureStaff.setPartUuid(this.partUuid),this.measureStaff.setIsEmpty(this.isEmpty),this.createTickableContent(),this.createLeftAttrs(),this.createRightAttrs(),this.createBarlines(),this.createStaffData(),this.staffIdx===0&&(this.ownTempo!==null||this.ownSwing!==null)&&this.createMetronome(),this.staffIdx===0&&this.rehearsal!==null&&this.createRehearsal(),this.staffIdx===0&&this.ending!==null&&this.createEnding(),this.staffIdx===0&&this.jumpTag!==null&&this.createJumpTag(),this.staffIdx===0&&this.nextJumpTag!==null&&this.createNextJumpTagWidth(),this.staffIdx===0&&this.repeatTimes!==null&&this.createRepeatTimes(),this.staffIdx===0&&this.jumpCall!==null&&this.createJumpCall(),this.staffIdx===0&&this.systemBreak!==null&&this.createSystemBreak(),this.staffIdx===0&&this.pageBreak!==null&&this.createPageBreak(),this.staffIdx===0&&this.displayOpts.showSystemBreakSymbols&&(this.createPageBreaksSymbols(),this.createSystemBreaksSymbols()),this.staffIdx===0&&this.createTempoChanges()},Pe.createTickableContent=function(){const t=this.getVoicesData(),s=this.getStaffNotes();let n=(0,th.A)(s);n=v.default.map(n,eh.A);const c=this.getAttrsData(),y=this.tickableContentBuilder.build({voicesNotes:n,measureJson:this.measureData,attrs:c,staffIdx:this.staffIdx,displayOpts:this.displayOpts,previousMeasure:this.previousMeasureData,nextMeasure:this.nextMeasureData,voicesData:t,voiceUuidMapping:this.voiceIdxToUuidMapping,isPickup:this.isPickup,nbMmr:this.nbMmr});this.measureStaff.setTickableContent(y)},Pe.getStaffNotes=function(){return this.notesByStaff[this.staffIdx]},Pe.getVoicesData=function(){return this.isTabStaff()||this.isKodalyStaff()||this.isRecorderTabStaff()?this.staffMapping[0]:this.staffMapping[this.staffIdx]},Pe.createLeftAttrs=function(){for(const t in this.leftAttrsByMeasurePos)this.currentAttrsToDisplay=this.leftAttrsByMeasurePos[t],this.attributesSet=new Er,this.attributesSet.setSide(Er.LEFT),this.measureStaff.addAttributes(t,this.attributesSet),this.createClefIfNeeded(),this.createKeySignatureIfNeeded(),this.createTimeSignatureIfNeeded()},Pe.isTabStaff=function(){const t=this.getClef();return p.default.isTab(t)},Pe.isKodalyStaff=function(){const t=this.getStaffDetails();return ae.default.hasKodaly(t)},Pe.isRecorderTabStaff=function(){const t=this.getStaffDetails();return ae.default.hasRecorderTabs(t)},Pe.createClefIfNeeded=function(){const t=this.currentAttrsToDisplay.clef;if(this.isTabStaff()&&t.hasEntry(this.staffIdx)){const s=this.getStaffDetails(),n=new Iu(s);this.attributesSet.setClef(n)}else if(t.hasEntry(this.staffIdx)&&!this.isKodalyStaff()&&!this.isRecorderTabStaff()){const s=t.getEntry(this.staffIdx),n=new yn(s);this.attributesSet.setClef(n)}},Pe.createKeySignatureIfNeeded=function(){const t=this.currentAttrsToDisplay.key;if(t.hasEntry(this.staffIdx)&&!this.isTabStaff()&&!this.isKodalyStaff()&&!this.isRecorderTabStaff()){const s=t.getEntry(this.staffIdx),n=this.getClef(),c=this.createKeySignature(s,n);this.attributesSet.setKey(c)}},Pe.createKeySignature=function(t,s){const n=this.isFirstMeasure()&&this.displayOpts.displayFirstKey;return this.keySignatureBuilder.build(t,s,n)},Pe.getClef=function(){return this.getAttrsData().getClef(this.staffIdx)},Pe.getStaffDetails=function(){return this.getAttrsData().getStaffDetails(this.staffIdx)},Pe.createTimeSignatureIfNeeded=function(){const t=this.currentAttrsToDisplay.time;if(t.hasEntry(this.staffIdx)&&!this.isTabStaff()&&!this.isRecorderTabStaff()){const s=t.getEntry(this.staffIdx),n=this.createTimeSignature(s);this.attributesSet.setTime(n)}},Pe.createTimeSignature=function(t){return this.timeSignatureBuilder.build(t)},Pe.createRightAttrs=function(){const t=new Er;t.setSide(Er.RIGHT),this.measureStaff.setRightAttributes(t);const s=a.default.getWrappedClef(this.rightAttributes);if(s.hasEntry(this.staffIdx)){const n=s.getEntry(this.staffIdx),c=new yn(n);t.setClef(c)}},Pe.createBarlines=function(){if(this.isRecorderTabStaff())return;if(f.default.hasLeftBarline(this.measureData)){const n=f.default.getLeftBarline(this.measureData),c=new Ch(n);this.measureStaff.setLeftBarline(c)}let t;f.default.hasRightBarline(this.measureData)?t=f.default.getRightBarline(this.measureData):t=q.A.createDefaultBarline(),q.A.isFinalBarline(t)&&this.displayOpts.hideFinalBarline&&(t=q.A.createDefaultBarline());const s=new Ch(t);this.measureStaff.setRightBarline(s)},Pe.createMetronome=function(){const t=new $u;if(this.ownTempo!==null){const n=`= ${B.default.getBpm(this.ownTempo)}`,c=B.default.getDurationType(this.ownTempo),y=B.default.getNbDots(this.ownTempo),N=this.tempoBuilder.build(c,y,n);t.setTempo(N)}if(this.ownSwing!==null){const s=new pf(this.ownSwing);t.setSwing(s)}this.ownSwing!==null&&this.ownTempo!==null&&t.setTextStr(","),this.measureStaff.setMetronome(t)},Pe.createRehearsal=function(){const t=C.A.getText(this.rehearsal),s=new Uu(t);this.measureStaff.setRehearsal(s),C.A.isMeasureNumber(this.rehearsal)&&this.measureStaff.setMeasureNumber(s)},Pe.createEnding=function(){const t=f.default.hasRightSpecificBarline(this.measureData);new nu({ending:this.ending,leftEnding:this.leftEnding,rightEnding:this.rightEnding,hasRightSpecificBarline:t,isLastMeasure:this.nextMeasure===null,measure:this.measureStaff}).build()},Pe.createJumpTag=function(){const t=new vh(this.jumpTag);this.measureStaff.setJumpTag(t)},Pe.createNextJumpTagWidth=function(){const t=new vh(this.nextJumpTag);this.measureStaff.setNextJumpTag(t)},Pe.createRepeatTimes=function(){const t=new Af(this.repeatTimes);this.measureStaff.setRepeatTimes(t)},Pe.createJumpCall=function(){const t=this.jumpCallBuilder.build(this.jumpCall,this.formerJumpCall);this.measureStaff.setJumpCall(t)},Pe.createPageBreak=function(){this.pageBreak===w.A.YES&&(this.measureStaff.setHasPageBreakBefore(!0),this.measureStaff.setHasSystemBreakBefore(!0))},Pe.createPageBreaksSymbols=function(){let t;if(this.pageBreak===w.A.YES){t=!1;const s=new Lh(this.pageBreak,t);this.measureStaff.setPageBreak(s)}if(this.nextPageBreak===w.A.YES){t=!0;const s=new Lh(this.nextPageBreak,t);this.measureStaff.setNextPageBreak(s)}},Pe.createSystemBreak=function(){this.systemBreak===w.A.YES&&this.measureStaff.setHasSystemBreakBefore(!0)},Pe.createSystemBreaksSymbols=function(){let t;if(this.systemBreak===w.A.YES){t=!1;const s=new Th(this.systemBreak,t);this.measureStaff.setSystemBreak(s)}if(this.nextSystemBreak===w.A.YES){t=!0;const s=new Th(this.nextSystemBreak,t);this.measureStaff.setNextSystemBreak(s)}},Pe.createTempoChanges=function(){const t=f.default.getDpq(this.measureData);this.tempoChangeAnchorsBuilder.build(this.measureStaff,t,this.tempoChanges,this.leftTempoChange,this.rightTempoChange)},Pe.createStaffData=function(){const t=this.staffDetails.getEntry(this.staffIdx),s=R.A.createFromStaffDetails(t);this.measureStaff.setStaffData(s)},Pe.getAttrsData=function(){return this.attrsData===null&&(this.attrsData=new qa.A(this.measureData,this.displayOpts)),this.attrsData};const Pf=Mh},100673:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(354093),w=r(269352);const f=function(d){this.init(d)},P=f.prototype;P.defaultOptions={"font-family":"Georgia, serif","font-style":"normal","stroke-width":"0",text:"New text."},P.init=function(d){this.options=A.A.mergeOptions(this.defaultOptions,d),this.fontSize=d["font-size"]||null,this.style={},delete d["font-size"],this.text=null,this.parent=null,this.drawingContext=null,this.drawn=!1,this.x=0,this.y=0},P.setParent=function(d){this.parent=d},P.setDrawingContext=function(d){this.drawingContext=d},P.setFontSize=function(d){this.fontSize=d},P.getFontSize=function(){return this.fontSize},P.setCssClass=function(d){this.text.attr("class",d)},P.setDataEntry=function(d,l){this.text.setDataEntry(d,l)},P.render=function(){this.hide(),this.text=new w.A("text");for(const d in this.options)d!=="text"&&this.text.attr(d,this.options[d]);for(const d in this.style){const l=this.style[d];this.text.style(d,l)}if(this.text.attr("font-size",this.fontSize),this.text.text(this.options.text),this.drawingContext.isTextMetricFromFont()){const d=this.getWidth();this.text.attr("textLength",d),this.text.attr("lengthAdjust","spacing")}},P.replace=function(d){if(this.options.text=d,this.text.dropAllChildren(),this.text.text(this.options.text),this.drawingContext.isTextMetricFromFont()){const l=this.getWidth();this.text.attr("textLength",l),this.text.attr("lengthAdjust","spacing")}},P.isRendered=function(){return this.text!==null},P.draw=function(){this.move(),this.bindToParent()},P.bindToParent=function(){this.drawn||(this.parent.append(this.text),this.drawn=!0)},P.getWidth=function(){const d=this.fontSize,l=this.getFontFamilies();let m=this.options.text;const x={};return typeof this.style["letter-spacing"]!="undefined"&&(x["letter-spacing"]=this.style["letter-spacing"]),typeof this.style["white-space"]!="undefined"&&(x["white-space"]=this.style["white-space"]),this.style["text-transform"]==="uppercase"&&(m=m.toUpperCase()),typeof this.options["font-style"]!="undefined"&&(x["font-style"]=this.options["font-style"]),typeof this.options["font-weight"]!="undefined"&&(x["font-weight"]=this.options["font-weight"]),this.drawingContext.getComputedTextLength(m,l,d,x)},P.getXHeight=function(){const d=this.fontSize,l=this.getFontFamilies();return this.drawingContext.getTextXHeight(l,d)},P.getFontFamilies=function(){let l=this.options["font-family"].split(",");return l=l.map(a),l};const a=function(d){return d.trim()};P.setXPos=function(d){this.x=d},P.setYPos=function(d){this.y=d},P.setPosition=function(d,l){this.x=d,this.y=l},P.move=function(){this.text.attr("transform",`translate(${this.x}, ${this.y})`)},P.hide=function(){this.drawn&&(this.text.removeFromParent(),this.drawn=!1)};const h=f},113599:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(269352),w=r(51342);const f="csymDiminished",P=function(){this.init()};P.NAME="chord.diminished";const a=P.prototype;a.name=P.NAME,a.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},a.setParent=function(d){this.parent=d},a.setPosX=function(d){this.posX=d},a.setPosY=function(d){this.posY=d},a.setDrawingContext=function(d){this.drawingContext=d},a.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},a.render=function(){const d=this.getGlyph(),l=new A.A("path"),m=d.render();l.attr("d",m),l.attr("class",this.name),this.path=l},a.isRendered=function(){return this.path!==null},a.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const d=this.getYShift(),l=this.posY-d,m=this.getSidePadding(),x=this.posX+m;this.path.attr("transform",`translate(${x}, ${l})`)}},a.bindToParent=function(){this.parent.append(this.path)},a.getWidth=function(){return this.getGlyph().getWidth()+this.getSidePadding()*2},a.getSidePadding=function(){const d=this.drawingContext.getHarmonyGlyphRatio();return this.drawingContext.getSpaceSize()*w.A.SUPSCRIPT_BASELINE*d/4},a.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},a.getSpaceAbove=function(){const d=this.getYShift();return-this.getGlyph().getBBoxNE().y+d},a.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*w.A.SUPSCRIPT_BASELINE},a.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},a.getGlyph=function(){if(this.glyph===null){const d=w.A.SMALL_FONT_SIZE*this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(f,d)}return this.glyph};const h=P},123868:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(273885),w=r(914390),f=r(398738);const P=[{textType:f.default.LYRICS,optsName:"lyric"},{textType:f.default.TITLE,optsName:"title"},{textType:f.default.SUBTITLE,optsName:"subtitle"},{textType:f.default.RIGHTS,optsName:"copyrights"},{textType:f.default.COMPOSER,optsName:"composer"},{textType:f.default.LYRICIST,optsName:"lyricist"},{textType:f.default.ARRANGER,optsName:"arranger"},{textType:f.default.HARMONY,optsName:"harmonyText"},{textType:f.default.REHEARSAL,optsName:"rehearsalText"},{textType:f.default.WORD,optsName:"word"},{textType:f.default.PART_NAME,optsName:"partName"},{textType:f.default.PAGE_NUMBER,optsName:"pageNumber"},{textType:f.default.MEASURE_NUMBER,optsName:"measureNumber"},{textType:f.default.PIZZICATO,optsName:"pizzicato"},{textType:f.default.TEMPO,optsName:"tempo"},{textType:f.default.FRET_NUMBER,optsName:"fretNumberFont"}],a=[f.default.FRET_NUMBER];function h(l,m){P.forEach(({textType:x,optsName:S})=>{const T=m[S]||{};if(!a.includes(x))typeof T["font-family"]=="undefined"&&(T["font-family"]=A.A.getTextTypeFontFamily(l,x)),typeof T["font-style"]=="undefined"&&(T["font-style"]=A.A.getTextTypeFontStyle(l,x)),typeof T["font-weight"]=="undefined"&&(T["font-weight"]=A.A.getTextTypeFontWeight(l,x)),typeof T["font-size"]=="undefined"&&(T["font-size"]=A.A.getTextTypeFontSize(l,x));else if(A.A.hasFontEntry(l,x)){const Y=A.A.getFontEntry(l,x);w.default.hasFontFamily(Y)&&(T["font-family"]=A.A.getTextTypeFontFamily(l,x))}m[S]=T}),d(l,m)}function d(l,m){const x=m[f.default.GLOBAL]||{};typeof x["font-family"]=="undefined"&&(x["font-family"]=A.A.getGlobalFontFamily(l)),typeof x["font-style"]=="undefined"&&(x["font-style"]=A.A.getGlobalFontStyle(l)),typeof x["font-weight"]=="undefined"&&(x["font-weight"]=A.A.getGlobalFontWeight(l)),m[f.default.GLOBAL]=x}},130452:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(364842),w=r(589085);const f={};f.getLeft=function(a,h){return a.isExternal&&!a.leftSide.stemColliding?h/2:a.leftSide.shiftRight?h*2:a.leftSide.shiftLeft?0:h},f.getRight=function(a,h){return a.isExternal&&!a.rightSide.stemColliding?h/2:a.leftSide.shiftRight?h:a.leftSide.shiftLeft?-h:0},f.getVertical=function(a,h){let d;if(a.isExternal?d=h.getTieVerticalMargin():d=w.A.isTabStaff(a.staffData)?h.getTabSpaceSize()/2:h.getSpaceSize()*2/10,a.placement==="above")return-d;if(a.placement==="below")return d;throw new A.default("unreachable")};const P=f},148029:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(w,f){const P=f.x-w.x,a=f.y-w.y;return{x:P,y:a}}},153787:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Xe});var A=r(364842),w=r(381216),f=r(659140),P=r(996636),a=r(614653),h=r(529355),d=r(681670),l=r(74957),m=r(200675),x=r(197799),S=r(48264),T=r(269352),Y=r(51342);const G="csymMajorSeventh",q=function(){this.init()};q.NAME="chord.Major";const R=q.prototype;R.name=q.NAME,R.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},R.setParent=function(U){this.parent=U},R.setPosX=function(U){this.posX=U},R.setPosY=function(U){this.posY=U},R.setDrawingContext=function(U){this.drawingContext=U},R.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},R.render=function(){const U=this.getGlyph(),Gt=new T.A("path"),It=U.render();Gt.attr("d",It),Gt.attr("class",this.name),this.path=Gt},R.isRendered=function(){return this.path!==null},R.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const U=this.getYShift(),Gt=this.posY-U,It=this.getLeftPadding(),xt=this.posX+It;this.path.attr("transform",`translate(${xt}, ${Gt})`)}},R.bindToParent=function(){this.parent.append(this.path)},R.getWidth=function(){return this.getGlyph().getWidth()+this.getLeftPadding()},R.getLeftPadding=function(){const U=this.drawingContext.getHarmonyGlyphRatio();return this.drawingContext.getSpaceSize()*Y.A.SUPSCRIPT_BASELINE*U/2},R.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},R.getSpaceAbove=function(){const U=this.getYShift();return-this.getGlyph().getBBoxNE().y+U},R.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*Y.A.SUPSCRIPT_BASELINE},R.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},R.getGlyph=function(){if(this.glyph===null){const U=Y.A.SMALL_FONT_SIZE*this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(G,U)}return this.glyph};const p=q;var b=r(100673);const v=function(){this.init()};v.NAME="chord.minor";const B=v.prototype;B.name=v.NAME,B.init=function(){this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},B.createText=function(){const U={text:Y.A.MINOR_TEXT};this.text=new b.A(U)},B.setParent=function(U){this.parent=U,this.text.setParent(U)},B.setPosX=function(U){this.posX=U},B.setPosY=function(U){this.posY=U},B.setDrawingContext=function(U){this.drawingContext=U,this.text.setDrawingContext(U);const Gt=U.getHarmonyFontSize()*Y.A.SMALL_FONT_SIZE;this.text.setFontSize(Gt);const It=U.getHarmonyFontFamily(),xt=U.getHarmonyFontStyle(),zt=U.getHarmonyFontWeight();this.text.options["font-family"]=It,this.text.options["font-style"]=xt,this.text.options["font-weight"]=zt},B.draw=function(){this.rendered||this.render(),this.move()},B.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},B.move=function(){this.rendered&&this.posX!==null&&this.posY!==null&&(this.text.setPosition(this.posX,this.posY),this.text.move())},B.getWidth=function(){return this.text.getWidth()},B.getHeight=function(){const U=this.getSpaceAbove(),Gt=this.getSpaceBelow();return U+Gt},B.getSpaceAbove=function(){return this.drawingContext.getHarmonyFontSize()},B.getSpaceBelow=function(){return this.drawingContext.getHarmonyFontSize()/2};const C=v,_="csymMinor",st=function(){this.init()};st.NAME="chord.Minor";const F=st.prototype;F.name=st.NAME,F.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},F.setParent=function(U){this.parent=U},F.setPosX=function(U){this.posX=U},F.setPosY=function(U){this.posY=U},F.setDrawingContext=function(U){this.drawingContext=U},F.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},F.render=function(){const U=this.getGlyph(),Gt=new T.A("path"),It=U.render();Gt.attr("d",It),Gt.attr("class",this.name),this.path=Gt},F.isRendered=function(){return this.path!==null},F.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const U=this.getYShift(),Gt=this.posY-U,It=this.getLeftPadding(),xt=this.posX+It;this.path.attr("transform",`translate(${xt}, ${Gt})`)}},F.bindToParent=function(){this.parent.append(this.path)},F.getWidth=function(){return this.getGlyph().getWidth()+this.getLeftPadding()},F.getLeftPadding=function(){const U=this.drawingContext.getHarmonyGlyphRatio();return this.drawingContext.getSpaceSize()*Y.A.SUPSCRIPT_BASELINE*U/2},F.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},F.getSpaceAbove=function(){const U=this.getYShift();return-this.getGlyph().getBBoxNE().y+U},F.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*Y.A.SUPSCRIPT_BASELINE},F.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},F.getGlyph=function(){if(this.glyph===null){const U=Y.A.SMALL_FONT_SIZE*this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(_,U)}return this.glyph};const L=st;var I=r(113599);const W=function(){this.init()};W.NAME="chord.minor";const V=W.prototype;V.name=W.NAME,V.init=function(){this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},V.createText=function(){const U={text:Y.A.DIMINISHED_TEXT};this.text=new b.A(U)},V.setParent=function(U){this.parent=U,this.text.setParent(U)},V.setPosX=function(U){this.posX=U},V.setPosY=function(U){this.posY=U},V.setDrawingContext=function(U){this.drawingContext=U,this.text.setDrawingContext(U);const Gt=U.getHarmonyFontSize()*Y.A.SMALL_FONT_SIZE;this.text.setFontSize(Gt);const It=U.getHarmonyFontFamily(),xt=U.getHarmonyFontStyle(),zt=U.getHarmonyFontWeight();this.text.options["font-family"]=It,this.text.options["font-style"]=xt,this.text.options["font-weight"]=zt},V.draw=function(){this.rendered||this.render(),this.move()},V.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},V.move=function(){this.rendered&&this.posX!==null&&this.posY!==null&&(this.text.setPosition(this.posX,this.posY),this.text.move())},V.getWidth=function(){return this.text.getWidth()},V.getHeight=function(){const U=this.getSpaceAbove(),Gt=this.getSpaceBelow();return U+Gt},V.getSpaceAbove=function(){return this.drawingContext.getHarmonyFontSize()},V.getSpaceBelow=function(){return this.drawingContext.getHarmonyFontSize()/2};const it=W;var Pt=r(706627),Yt=r(409241),Bt=r(405676),le=r(843678);const ie=le.default.fromPairs([{key:1,value:{glyphId:"accidentalSharp",offset:2}},{key:-1,value:{glyphId:"accidentalFlat",offset:2}}]),K=function(U){this.init(U)};K.NAME="chord.degreeAlter";const pe=K.prototype;pe.name=K.NAME,pe.init=function(U){this.alter=U,this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},pe.setParent=function(U){this.parent=U},pe.setPosX=function(U){this.posX=U},pe.setPosY=function(U){this.posY=U},pe.setDrawingContext=function(U){this.drawingContext=U},pe.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},pe.render=function(){const U=this.getGlyph(),Gt=new T.A("path"),It=U.render();Gt.attr("d",It),Gt.attr("class",this.name),this.path=Gt},pe.isRendered=function(){return this.path!==null},pe.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const U=this.getOffset(),Gt=this.posY-U;this.path.attr("transform",`translate(${this.posX}, ${Gt})`)}},pe.bindToParent=function(){this.parent.append(this.path)},pe.getWidth=function(){return this.getGlyph().getWidth()},pe.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},pe.getSpaceAbove=function(){const U=this.getOffset();return-this.getGlyph().getBBoxNE().y+U},pe.getSpaceBelow=function(){const U=this.getOffset();return this.getGlyph().getBBoxSW().y-U},pe.getGlyph=function(){if(this.glyph===null){const U=Ee(this.alter),Gt=this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(U,Gt)}return this.glyph},pe.getOffset=function(){const U=tt(this.alter);return this.drawingContext.getSpaceSize()*this.drawingContext.getHarmonyGlyphRatio()*U};const Ee=function(U){return Et(U).glyphId},tt=function(U){return Et(U).offset},Et=function(U){if(typeof ie[U]=="undefined"){const Gt=`The alter value [${U}] is invalid.`;throw new A.default("BadAlterValue",Gt)}else return ie[U]},Vt=K;var ct=r(464173);const fe=new Map([[ct.A.DIMINISHED_7,"7"],[ct.A.DIMINISHED_9,"9"],[ct.A.DIMINISHED_11,"11"],[ct.A.DIMINISHED_13,"13"]]);function gt(U,Gt){const It=U.getDiminished();if(U.addBeforeDegree(It),Gt!==ct.A.DIMINISHED){const xt=At(Gt),zt=new Pt.A(xt,"chordKind");U.addBeforeDegree(zt)}}function At(U){if(fe.has(U))return fe.get(U);throw new A.default(`Invalid base chord: ${U}`)}var Ht=r(836252);const Wt=new Map([[ct.A.HALF_DIMINISHED_7,"7"],[ct.A.HALF_DIMINISHED_9,"9"],[ct.A.HALF_DIMINISHED_11,"11"],[ct.A.HALF_DIMINISHED_13,"13"]]);function k(U,Gt){const It=new Ht.A;if(U.addBeforeDegree(It),Gt!==ct.A.AUGMENTED){const xt=St(Gt),zt=new Pt.A(xt,"chordKind");U.addBeforeDegree(zt)}}function St(U){if(Wt.has(U))return Wt.get(U);throw new A.default(`Invalid base chord: ${U}`)}const yt=new Map([[ct.A.MINOR_2,"2"],[ct.A.MINOR_6,"6"],[ct.A.MINOR_69,"6/9"],[ct.A.MINOR_7,"7"],[ct.A.MINOR_9,"9"],[ct.A.MINOR_11,"11"],[ct.A.MINOR_13,"13"]]);function Ct(U,Gt){const It=U.getMinor();if(U.addBeforeDegree(It),Gt!==ct.A.MINOR){const xt=Mt(Gt),zt=new Pt.A(xt,"chordKind");U.addBeforeDegree(zt)}}function Mt(U){if(yt.has(U))return yt.get(U);throw new A.default(`Invalid base chord: ${U}`)}var Tt=r(956149);const nt=new Map([[ct.A.AUGMENTED_7,"7"],[ct.A.AUGMENTED_9,"9"],[ct.A.AUGMENTED_11,"11"],[ct.A.AUGMENTED_13,"13"]]);function vt(U,Gt){const It=new Tt.A;if(U.addBeforeDegree(It),Gt!==ct.A.AUGMENTED){const xt=Nt(Gt),zt=new Pt.A(xt,"chordKind");U.addBeforeDegree(zt)}}function Nt(U){if(nt.has(U))return nt.get(U);throw new A.default(`Invalid base chord: ${U}`)}var te=r(999970);const ee=new Map([[ct.A.POWER,"5"],[ct.A.MAJOR_2,"2"],[ct.A.MAJOR_6,"6"],[ct.A.SIX_NINE,"6/9"],[ct.A.DOMINANT_7,"7"],[ct.A.DOMINANT_7_6,"7/6"],[ct.A.DOMINANT_9,"9"],[ct.A.DOMINANT_11,"11"],[ct.A.DOMINANT_13,"13"]]);function Ot(U,Gt){const It=ot(Gt),xt=new Pt.A(It,"chordKind");U.addBeforeDegree(xt)}function ot(U){if(ee.has(U))return ee.get(U);throw new A.default(`Invalid base chord: ${U}`)}const rt=new Map([[ct.A.MINOR_MAJOR_7,"7"],[ct.A.MINOR_MAJOR_9,"9"],[ct.A.MINOR_MAJOR_11,"11"],[ct.A.MINOR_MAJOR_13,"13"]]);function at(U,Gt){const It=U.getMinor();U.addBeforeDegree(It);const xt=U.getMajor();U.addBeforeDegree(xt);const zt=_t(Gt),Ne=new Pt.A(zt,"chordKind");U.addBeforeDegree(Ne)}function _t(U){if(rt.has(U))return rt.get(U);throw new A.default(`Invalid base chord: ${U}`)}const qt=new Map([[ct.A.MAJOR_7,"7"],[ct.A.MAJOR_9,"9"],[ct.A.MAJOR_11,"11"],[ct.A.MAJOR_13,"13"]]);function ue(U,Gt){const It=U.getMajor();U.addBeforeDegree(It);const xt=ne(Gt),zt=new Pt.A(xt,"chordKind");U.addBeforeDegree(zt)}function ne(U){if(qt.has(U))return qt.get(U);throw new A.default(`Invalid base chord: ${U}`)}const be=new Map([[ct.A.AUGMENTED_MAJOR_7,"7"],[ct.A.AUGMENTED_MAJOR_9,"9"],[ct.A.AUGMENTED_MAJOR_11,"11"],[ct.A.AUGMENTED_MAJOR_13,"13"]]);function oe(U,Gt){const It=new Tt.A;U.addBeforeDegree(It);const xt=U.getMajor();U.addBeforeDegree(xt);const zt=us(Gt),Ne=new Pt.A(zt,"chordKind");U.addBeforeDegree(Ne)}function us(U){if(be.has(U))return be.get(U);throw new A.default(`Invalid base chord: ${U}`)}var Q=r(533343);const Xt=function(){this.init()},bt=Xt.prototype;bt.init=function(){this.displayOpts={}},bt.build=function(U){this.reset();const Gt=a.default.getRoot(U);this.createRoot(Gt);const{chordKind:It,suspension:xt,degreeModifications:zt}=(0,te.A)(U);if(this.createChordKind(It),this.createModifications(xt,zt),a.default.isAlternate(U)&&this.createAlternate(),a.default.hasBass(U)){const Os=a.default.getBass(U);this.createBass(Os)}if(a.default.hasFrame(U)){const Os=a.default.getFrame(U);this.createFrame(Os)}const Ne=a.default.getTimePos(U),pi=a.default.getHarmonyUuid(U);return this.createChord(Ne,pi),this.chord},bt.reset=function(){this.rootDrawers=[],this.beforeDegreeDrawers=[],this.afterDegreeDrawers=[],this.frame=null,this.harmonyDrawer=null},bt.setDisplayOpts=function(U){this.displayOpts=U},bt.getMinor=function(){const U=this.displayOpts.jazzChordPartConfig[f.A.MINOR];if(U===P.A.SYMBOL)return new L;if(U===P.A.LOWER_CASE)return new C;P.A.raiseError(f.A.MINOR,U)},bt.getMajor=function(){const U=this.displayOpts.jazzChordPartConfig[f.A.MAJOR];if(U===P.A.SYMBOL)return new p;if(U===P.A.LOWER_CASE_LONG||P.A.UPPER_CASE)return new S.A(U);P.A.raiseError(f.A.MAJOR,U)},bt.getDiminished=function(){const U=this.displayOpts.jazzChordPartConfig[f.A.DIMINISHED];if(U===P.A.SYMBOL)return new I.A;if(U===P.A.LOWER_CASE_LONG)return new it;P.A.raiseError(f.A.DIMINISHED,U)},bt.createRoot=function(U){const Gt=h.A.getStep(U),It=new m.A(Gt);this.addRoot(It);const xt=h.A.getAlter(U);if(xt!==0){const zt=new x.A(xt);this.addRoot(zt)}},bt.createFrame=function(U){this.frame=new Bt.A(U)},bt.addRoot=function(U){this.rootDrawers.push(U)},bt.createBass=function(U){const Gt=d.A.getStep(U),It=new m.A(`/${Gt}`);this.addAfterDegree(It);const xt=d.A.getAlter(U);if(xt!==0){const zt=new x.A(xt);this.addAfterDegree(zt)}},bt.createAlternate=function(){const U=new Pt.A("alt.");this.addAfterDegree(U)},bt.createChordKind=function(U){ve(U)(this,U)};function ve(U){if(typeof Qt.has(U)!="undefined")return Qt.get(U);{const Gt=`There is no builder for the kind [${U}].`;throw new A.default("BadKind",Gt)}}const Qt=new Map([[ct.A.POWER,Ot],[ct.A.MAJOR,ae],[ct.A.MINOR,Ct],[ct.A.DIMINISHED,gt],[ct.A.AUGMENTED,vt],[ct.A.MAJOR_2,Ot],[ct.A.MINOR_2,Ct],[ct.A.MAJOR_6,Ot],[ct.A.MINOR_6,Ct],[ct.A.SIX_NINE,Ot],[ct.A.MINOR_69,Ct],[ct.A.DOMINANT_7,Ot],[ct.A.MAJOR_7,ue],[ct.A.MINOR_7,Ct],[ct.A.MINOR_MAJOR_7,at],[ct.A.AUGMENTED_7,vt],[ct.A.AUGMENTED_MAJOR_7,oe],[ct.A.HALF_DIMINISHED_7,k],[ct.A.DIMINISHED_7,gt],[ct.A.DOMINANT_7_6,Ot],[ct.A.DOMINANT_9,Ot],[ct.A.MAJOR_9,ue],[ct.A.MINOR_9,Ct],[ct.A.MINOR_MAJOR_9,at],[ct.A.AUGMENTED_9,vt],[ct.A.AUGMENTED_MAJOR_9,oe],[ct.A.HALF_DIMINISHED_9,k],[ct.A.DIMINISHED_9,gt],[ct.A.DOMINANT_11,Ot],[ct.A.MAJOR_11,ue],[ct.A.MINOR_11,Ct],[ct.A.MINOR_MAJOR_11,at],[ct.A.AUGMENTED_11,vt],[ct.A.AUGMENTED_MAJOR_11,oe],[ct.A.HALF_DIMINISHED_11,k],[ct.A.DIMINISHED_11,gt],[ct.A.DOMINANT_13,Ot],[ct.A.MAJOR_13,ue],[ct.A.MINOR_13,Ct],[ct.A.MINOR_MAJOR_13,at],[ct.A.AUGMENTED_13,vt],[ct.A.AUGMENTED_MAJOR_13,oe],[ct.A.HALF_DIMINISHED_13,k],[ct.A.DIMINISHED_13,gt]]);function ae(){}const fs=new Map([[Q.A.SUS_2,"sus2"],[Q.A.SUS_4,"sus4"],[Q.A.SUS_24,"sus24"]]);function ds(U){if(fs.has(U))return fs.get(U);throw new A.default(`Invalid Suspension: ${U}`)}bt.createModifications=function(U,Gt){const It=[];if(U){const xt=ds(U),zt=new Pt.A(xt,"chordDegree");It.push(zt)}if(Gt.forEach(xt=>{const zt=l.A.getAlter(xt),Ne=l.A.getType(xt),pi=l.A.getValue(xt);if(Ne===w.A.SUBTRACT){const Os=new Pt.A(`no${pi}`,"chordDegree");It.push(Os)}else if(Ne===w.A.ALTER||Ne===w.A.ADD){if(zt!==0){const Fi=new Vt(zt);Fi.name="chordDegree",It.push(Fi)}let Os=`${pi}`;zt===0&&It.length>0&&(Os=`,${Os}`);const on=new Pt.A(Os,"chordDegree");It.push(on)}}),It.length>0){const xt=new Pt.A("(","chordDegree");this.addBeforeDegree(xt),It.forEach(Ne=>this.addBeforeDegree(Ne));const zt=new Pt.A(")","chordDegree");this.addBeforeDegree(zt)}},bt.addBeforeDegree=function(U){this.beforeDegreeDrawers.push(U)},bt.addAfterDegree=function(U){this.afterDegreeDrawers.push(U)},bt.createChord=function(U,Gt){const It=new Yt.A;It.setTimePos(U),It.setHarmonyUuid(Gt),It.setFrame(this.frame),this.rootDrawers.forEach(It.addSymbol,It),this.beforeDegreeDrawers.forEach(It.addSymbol,It),this.afterDegreeDrawers.forEach(It.addSymbol,It),this.chord=It};const Xe=Xt},177150:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>C});var A=r(701387),w=r(54949),f=r(843678),P=r(476943),a=r(123491),h=r(287719),d=r(498554),l=r(822605),m=r(816679),x=r(73925),S=r(259563);const T={};T.shapeMeasure=function(_){const st=A.default.getNotes(_),F=w.A.groupStaves(st),L=A.default.getDpq(_);return f.default.forEach(F,function(I,W){Y(I,W,L)}),_};const Y=function(_,st,F){let L=(0,d.A)(st);L=f.default.map(L,l.A),f.default.forEach(L,function(I,W){W.forEach(G,F)})},G=function(_){const st=this,F=_.graces;q(F,st),R(F)},q=function(_,st){_.forEach(function(F){F=P.default.makeArray(F),F.forEach(function(L){const I=a.default.getDurationType(L);let W=S.default.toQuarterDuration(I);W=W*st,a.default.setFloatingDuration(L,W)})})},R=function(_){for(let st=0;st<_.length-1;st++){const F=P.default.isArray(_[st])?_[st][0]:_[st],L=P.default.isArray(_[st+1])?_[st+1][0]:_[st+1],I=st-1<0?null:P.default.isArray(_[st-1])?_[st-1][0]:_[st-1],W=st+2<_.length?P.default.isArray(_[st+2])?_[st+2][0]:_[st+2]:null;B(F)&&B(L)&&(p(I,F,L),p(F,L,W))}},p=function(_,st,F){const L=_===null?null:b(_),I=b(st),W=F===null?null:b(F);v(st,L,I,W)},b=function(_){const st=a.default.getDurationType(_),F=S.default.toQuarterDuration(st);let L=h.A.durationToNbBeams(F);return a.default.isSlashedGrace(_)&&(L=0),{nbBeams:L,left:[],right:[],duration:1,position:0}},v=function(_,st,F,L){(0,m.A)(st,F,L);const I=(0,x.A)(F);a.default.setBeams(_,I)},B=function(_){if(a.default.isSlashedGrace(_))return!1;switch(a.default.getDurationType(_)){case S.default.EIGHT:case S.default.SIXTEENTH:case S.default.THIRTY_SECOND:case S.default.SIXTY_FOURTH:return!0;default:return!1}},C=T},188075:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(269352);const w=function(a,h,d,l,m){this.init(a,h,d,l,m)};w.cssClass="tieArc";const f=w.prototype;f.cssClass=w.cssClass,f.init=function(a,h,d,l,m){this.parentGroup=a,this.path=new A.A("path"),this.path.attr("class",this.cssClass),this.drawingContext=null,this.width=null,this.tieHeight=null,this.placement=l,this.leftOffset=h,this.rightOffset=d,this.rightRefOffset=m,this.needRender=!0},f.setDrawingContext=function(a){this.drawingContext=a},f.setSize=function(a,h){this.width=a,this.tieHeight=h,this.needRender=!0},f.render=function(){this.computePoints(),this.renderPath(),this.needRender=!1},f.computePoints=function(){const a=this.getPlacementCoeff(),h=this.drawingContext.getTieEndpointThickness(),d=this.drawingContext.getTieMidpointThickness();this.upLeftY=-h/2,this.downLeftY=h/2,this.upRightY=-h/2+this.rightRefOffset,this.downRightY=h/2+this.rightRefOffset,this.upMidY=this.tieHeight*a-d/2+this.rightRefOffset/2,this.downMidY=this.tieHeight*a+d/2+this.rightRefOffset/2,this.upControlY=2*this.upMidY-this.upLeftY,this.downControlY=2*this.downMidY-this.downLeftY},f.renderPath=function(){const a=this.getXMiddle(),h=this.getXLeft(),d=this.getXRight(),l=`M ${h} ${this.upLeftY} Q ${a} ${this.upControlY} ${d} ${this.upRightY} V ${this.downRightY} Q ${a} ${this.downControlY} ${h} ${this.downLeftY} V ${this.upLeftY}`;this.path.attr("d",l)},f.getXLeft=function(){return this.leftOffset},f.getXRight=function(){return this.width+this.rightOffset},f.getXMiddle=function(){return(this.getXLeft()+this.getXRight())/2},f.getWidth=function(){return this.width},f.getHeight=function(){return this.needRender&&this.render(),Math.max(this.downLeftY,this.downRightY,this.downMidY)-Math.min(this.upLeftY,this.upRightY,this.upMidY)},f.getPlacementCoeff=function(){return this.placement==="above"?-1:1},f.draw=function(){this.needRender&&this.render(),this.move(),this.bindToParent()},f.bindToParent=function(){this.parentGroup.append(this.path)},f.erase=function(){this.parent!==null&&this.unbindFromParent()},f.unbindFromParent=function(){this.path.removeFromParent()},f.move=function(){this.path.attr("transform",`translate(${this.posX} ${this.posY})`)},f.setPosX=function(a){this.posX=a},f.setPosY=function(a){this.posY=a},f.updateHorizontalDisplay=function(){this.needRender&&this.render(),this.move()},f.getBottomY=function(){return this.needRender&&this.render(),Math.max(this.downLeftY,this.downMidY,this.downRightY)},f.getTopY=function(){return this.needRender&&this.render(),Math.min(this.upLeftY,this.upMidY,this.upRightY)};const P=w},189954:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(w){return Math.sqrt(w.x*w.x+w.y*w.y)}},191167:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(920939),w=r(726042);const f="augmentationDot",P=function(d){this.glyphPath=null,this.glyphWidth=null,this.renderedNote=null,this.offset=null,this.displayData=d},a=P.prototype;a.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasDot()},a.hasDot=function(){return this.displayData.getNbDots()>0},a.draw=function(d,l){this.renderedNote=d,this.svg=d.getGroup(),this.ctx=l,this.createGlyph(),this.offset=d.getMiddleHeadWidth()+d.calcTrailingSpace(),this.drawDots()},a.createGlyph=function(){const d=this.ctx.getGlyph(f);this.glyphPath=d.render(),this.glyphWidth=d.getWidth()},a.drawDots=function(){this.displayData.getLines().forEach(this.drawDot,this)},a.drawDot=function(d){let l=this.ctx.getMarginSize();w.default.isInteger(d)&&(this.displayData.isSecondLower(d)?d-=.5:d+=.5,!this.displayData.hasBeam()&&this.displayData.getNbFlags()>1&&(l+=this.ctx.getMarginSize()));const m=this.lineToY(d),x=this.displayData.getNbDots();for(let S=0;S<x;S++){const T=this.offset+l,Y=this.svg.append("path");Y.attr("d",this.glyphPath),Y.attr("transform",`translate(${T} ${m})`),this.renderedNote.addDot(Y),this.renderedNote.setDotWidth(this.glyphWidth),this.renderedNote.setDotMargin(l),l+=this.glyphWidth+this.ctx.getMarginSize()}},a.lineToY=function(d){const l=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),m=this.displayData.getNbStaffLines();return A.A.lineToY(d,l,m)};const h=P},191581:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});const w={LEFT:"left",RIGHT:"right",CROSS_MEASURE:"crossMeasure"}},197266:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(723631),f=r(97324),P=r(231189);const a=function(l,m,x,S,T){this.init(l,m,x,S,T)},h=a.prototype;h.init=function(l,m,x,S,T){this.measure=null,this.pluckedRange=null,this.measureIdx=null,this.type=l,this.location=S,this.placement=m,this.pluckedRangeUuid=T,this.timePos=typeof x!="undefined"?x:null,this.drawingContext=null},h.setLocation=function(l){this.location=l},h.setMeasure=function(l){this.measure=l},h.isAbove=function(){return this.getPlacement()===w.A.ABOVE},h.isBelow=function(){return this.getPlacement()===w.A.BELOW},h.getPlacement=function(){return this.placement},h.getTimePos=function(){return this.timePos},h.getType=function(){return this.type},h.isLeft=function(){return this.hasLocation()?P.A.isLeft(this.location):this.isStart()},h.isRight=function(){return this.hasLocation()?P.A.isRight(this.location):this.isStop()},h.isStop=function(){return f.A.isStop(this.type)},h.isStart=function(){return f.A.isStart(this.type)},h.hasLocation=function(){return this.location!==null},h.setDrawingContext=function(l){this.drawingContext=l},h.getDrawingContext=function(){return this.drawingContext},h.getX=function(){if(P.A.isLeft(this.location))return this.getLeftX();if(P.A.isRight(this.location))return this.getRightX();if(this.isStart()||this.isStop())return this.getMiddleX();throw new A.default("Unexpected")},h.getLeftX=function(){const l=this.measure.tickableContent;return this.measure.getXPos()+l.getXPos()-l.getPreviousSpace()},h.getRightX=function(){const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.getWidth()},h.getMiddleX=function(){if(this.timePos===null){const T="Cannot compute a middleX position without time position";throw new A.default("Unexpected",T)}const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.timePosToX(this.timePos)},h.getY=function(){if(this.isAbove())return this.measure.getUpPluckedRangesY();if(this.isBelow())return this.measure.getDownPluckedRangesY();throw new A.default("Unexpected")},h.hasPluckedRange=function(){return this.pluckedRange!==null},h.setPluckedRange=function(l){this.pluckedRange=l},h.removePluckedRange=function(){if(this.location!==null)P.A.isLeft(this.location)?this.pluckedRange.removeLeftAnchor():P.A.isRight(this.location)?this.pluckedRange.removeRightAnchor():P.A.raiseError(this.location);else if(this.isStart())this.pluckedRange.removeLeftAnchor();else if(this.isStop())this.pluckedRange.removeRightAnchor();else throw new A.default("Unexpected");this.pluckedRange=null},h.getPluckedRange=function(){return this.pluckedRange},h.setNeedDrawUpdate=function(){this.hasPluckedRange()&&this.getPluckedRange().setNeedDrawUpdate()},h.getPluckedRangeUuid=function(){return this.pluckedRangeUuid};const d=a},197341:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(723631),w=r(603581),f=r(100673);const P="adagio-pizzicato-uuid",a=function(l,m,x,S){this.init(l,m,x,S)};a.cssClass="pizzicato";const h=a.prototype;h.cssClass=a.cssClass,h.init=function(l,m,x,S){this.type=m,this.placement=l,this.timePos=x,this.pizzicatoUuid=S||null,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.parent=null,this.text=null},h.setParent=function(l){this.parent=l,this.text!==null&&this.text.setParent(l)},h.getWidth=function(){return this.text.getWidth()},h.getSpaceAbove=function(){return this.drawingContext.getPizzicatoFontSize()},h.getSpaceBelow=function(){return this.drawingContext.getPizzicatoFontSize()/2},h.render=function(l){this.drawingContext=l;const m={};m["font-size"]=l.getPizzicatoFontSize(),m["font-family"]=l.getPizzicatoFontFamily(),m["font-style"]=l.getPizzicatoFontStyle(),m["font-weight"]=l.getPizzicatoFontWeight();const x=w.A.getText(this.type);m.text=x,this.text=new f.A(m),this.parent!==null&&this.text.setParent(this.parent),this.text.setDrawingContext(l),this.text.render(),this.text.setCssClass(a.cssClass),this.pizzicatoUuid!==null&&this.text.setDataEntry(P,this.pizzicatoUuid)},h.setCssClass=function(l){this.text.setCssClass(l)},h.setPosX=function(l){this.xPos=l,this.text.setXPos(this.xPos+this.horizontalOffset)},h.setHorizontalOffset=function(l){this.horizontalOffset=l,this.text.setXPos(this.xPos+this.horizontalOffset)},h.setPosY=function(l){this.yPos=l,this.text.setYPos(this.yPos)},h.draw=function(){this.needRender()&&this.render(),this.text.draw()},h.needRender=function(){return this.text===null},h.move=function(){this.text.move()},h.getDrawingContext=function(){return this.drawingContext},h.getTimePos=function(){return this.timePos},h.isAbove=function(){return this.getPlacement()===A.A.ABOVE},h.isBelow=function(){return this.getPlacement()===A.A.BELOW},h.getPlacement=function(){return this.placement},h.getText=function(){return this.text},h.unbindFromParent=function(){this.text.hide()};const d=a},197510:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(309534),w=r(498041);const f={[A.A.RECORDER_SOPRANO_BAROQUE]:new Map([["C/5",[1,1,1,1,1,1,1,1]],["C1/5",[1,1,1,1,1,1,1,.5]],["D/5",[1,1,1,1,1,1,1,0]],["D1/5",[1,1,1,1,1,1,.5,0]],["E/5",[1,1,1,1,1,1,0,0]],["F/5",[1,1,1,1,1,0,1,1]],["F1/5",[1,1,1,1,0,1,1,0]],["G/5",[1,1,1,1,0,0,0,0]],["G1/5",[1,1,1,0,1,1,.5,0]],["A/5",[1,1,1,0,0,0,0,0]],["A1/5",[1,1,0,1,1,0,0,0]],["B/5",[1,1,0,0,0,0,0,0]],["C/6",[1,0,1,0,0,0,0,0]],["C1/6",[0,1,1,0,0,0,0,0]],["D/6",[0,0,1,0,0,0,0,0]],["D1/6",[0,0,1,1,1,1,1,0]],["E/6",[.5,1,1,1,1,1,0,0]],["F/6",[.5,1,1,1,1,0,1,0]],["F1/6",[.5,1,1,1,0,1,0,0]],["G/6",[.5,1,1,1,0,0,0,0]],["G1/6",[.5,1,1,0,1,0,0,0]],["A/6",[.5,1,1,0,0,0,0,0]],["A1/6",[.5,1,1,0,1,1,1,0]],["B/6",[.5,1,1,0,1,1,0,0]],["C/7",[.5,1,0,0,1,1,0,0]],["C1/7",[.5,1,0,1,1,1,0,1]],["D/7",[.5,1,0,1,1,0,1,0]]]),[A.A.RECORDER_ALTO_BAROQUE]:new Map([["F/4",[1,1,1,1,1,1,1,1]],["F1/4",[1,1,1,1,1,1,1,.5]],["G/4",[1,1,1,1,1,1,1,0]],["G1/4",[1,1,1,1,1,1,.5,0]],["A/4",[1,1,1,1,1,1,0,0]],["A1/4",[1,1,1,1,1,0,1,1]],["B/4",[1,1,1,1,0,1,1,0]],["C/5",[1,1,1,1,0,0,0,0]],["C1/5",[1,1,1,0,1,1,.5,0]],["D/5",[1,1,1,0,0,0,0,0]],["D1/5",[1,1,0,1,1,0,0,0]],["E/5",[1,1,0,0,0,0,0,0]],["F/5",[1,0,1,0,0,0,0,0]],["F1/5",[0,1,1,0,0,0,0,0]],["G/5",[0,0,1,0,0,0,0,0]],["G1/5",[0,0,1,1,1,1,1,0]],["A/5",[.5,1,1,1,1,1,0,0]],["A1/5",[.5,1,1,1,1,0,1,0]],["B/5",[.5,1,1,1,0,1,0,0]],["C/6",[.5,1,1,1,0,0,0,0]],["C1/6",[.5,1,1,0,1,0,0,0]],["D/6",[.5,1,1,0,0,0,0,0]],["D1/6",[.5,1,1,0,1,1,1,0]],["E/6",[.5,1,1,0,1,1,0,0]],["F/6",[.5,1,0,0,1,1,0,0]],["F1/6",[.5,1,0,1,1,1,0,1]],["G/6",[.5,1,0,1,1,0,1,0]]]),[A.A.RECORDER_SOPRANO_GERMAN]:new Map([["C/5",[1,1,1,1,1,1,1,1]],["C1/5",[1,1,1,1,1,1,1,.5]],["D/5",[1,1,1,1,1,1,1,0]],["D1/5",[1,1,1,1,1,1,.5,0]],["E/5",[1,1,1,1,1,1,0,0]],["F/5",[1,1,1,1,1,0,0,0]],["F1/5",[1,1,1,1,0,1,1,1]],["G/5",[1,1,1,1,0,0,0,0]],["G1/5",[1,1,1,0,1,1,.5,0]],["A/5",[1,1,1,0,0,0,0,0]],["A1/5",[1,1,0,1,1,0,0,0]],["B/5",[1,1,0,0,0,0,0,0]],["C/6",[1,0,1,0,0,0,0,0]],["C1/6",[0,1,1,0,0,0,0,0]],["D/6",[0,0,1,0,0,0,0,0]],["D1/6",[0,0,1,1,1,1,1,0]],["E/6",[.5,1,1,1,1,1,0,0]],["F/6",[.5,1,1,1,1,0,0,0]],["F1/6",[.5,1,1,1,0,1,0,1]],["G/6",[.5,1,1,1,0,0,0,0]],["G1/6",[.5,1,1,1,0,1,1,1]],["A/6",[.5,1,1,0,0,0,0,0]],["A1/6",[.5,1,1,0,1,1,1,0]],["B/6",[.5,1,1,0,1,1,0,0]],["C/7",[.5,1,0,0,1,1,0,0]],["C1/7",[.5,1,0,1,1,0,1,1]],["D/7",[.5,1,0,1,1,0,1,0]]]),[A.A.RECORDER_ALTO_GERMAN]:new Map([["F/4",[1,1,1,1,1,1,1,1]],["F1/4",[1,1,1,1,1,1,1,.5]],["G/4",[1,1,1,1,1,1,1,0]],["G1/4",[1,1,1,1,1,1,.5,0]],["A/4",[1,1,1,1,1,1,0,0]],["A1/4",[1,1,1,1,1,0,0,0]],["B/4",[1,1,1,1,0,1,1,1]],["C/5",[1,1,1,1,0,0,0,0]],["C1/5",[1,1,1,0,1,1,.5,0]],["D/5",[1,1,1,0,0,0,0,0]],["D1/5",[1,1,0,1,1,0,0,0]],["E/5",[1,1,0,0,0,0,0,0]],["F/5",[1,0,1,0,0,0,0,0]],["F1/5",[0,1,1,0,0,0,0,0]],["G/5",[0,0,1,0,0,0,0,0]],["G1/5",[0,0,1,1,1,1,1,0]],["A/5",[.5,1,1,1,1,1,0,0]],["A1/5",[.5,1,1,1,1,0,0,0]],["B/5",[.5,1,1,1,0,1,0,1]],["C/6",[.5,1,1,1,0,0,0,0]],["C1/6",[.5,1,1,1,0,1,1,1]],["D/6",[.5,1,1,0,0,0,0,0]],["D1/6",[.5,1,1,0,1,1,1,0]],["E/6",[.5,1,1,0,1,1,0,0]],["F/6",[.5,1,0,0,1,1,0,0]],["F1/6",[.5,1,0,1,1,0,1,1]],["G/6",[.5,1,0,1,1,0,1,0]]])},P=d=>{const{step:l,octave:m,alter:x}=d;return`${l}${x!=null?x:""}/${m}`},h=(d,l)=>{A.A.check(l),d=(0,w.A)(d);const m=P(d),x=f[l].get(m);return x!=null?x:null}},197799:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>x});var A=r(364842),w=r(269352),f=r(843678);const P=f.default.fromPairs([{key:1,value:{glyphId:"accidentalSharp",offset:1.5}},{key:2,value:{glyphId:"accidentalDoubleSharp",offset:1.5}},{key:-1,value:{glyphId:"accidentalFlat",offset:1}},{key:-2,value:{glyphId:"accidentalDoubleFlat",offset:1}}]),a=function(S){this.init(S)};a.NAME="chord.rootAlter";const h=a.prototype;h.name=a.NAME,h.init=function(S){this.alter=S,this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},h.setParent=function(S){this.parent=S},h.setPosX=function(S){this.posX=S},h.setPosY=function(S){this.posY=S},h.setDrawingContext=function(S){this.drawingContext=S},h.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},h.render=function(){const S=this.getGlyph(),T=new w.A("path"),Y=S.render();T.attr("d",Y),T.attr("class",this.name),this.path=T},h.isRendered=function(){return this.path!==null},h.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const S=this.getOffset(),T=this.posY-S;this.path.attr("transform",`translate(${this.posX}, ${T})`)}},h.bindToParent=function(){this.parent.append(this.path)},h.getWidth=function(){return this.getGlyph().getWidth()},h.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},h.getSpaceAbove=function(){const S=this.getOffset();return-this.getGlyph().getBBoxNE().y+S},h.getSpaceBelow=function(){const S=this.getOffset();return this.getGlyph().getBBoxSW().y-S},h.getGlyph=function(){if(this.glyph===null){const S=d(this.alter),T=this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(S,T)}return this.glyph},h.getOffset=function(){const S=l(this.alter),T=this.drawingContext.getHarmonyGlyphRatio();return this.drawingContext.getSpaceSize()*T*S};const d=function(S){return m(S).glyphId},l=function(S){return m(S).offset},m=function(S){if(typeof P[S]=="undefined"){const T=`The alter value [${S}] is invalid.`;throw new A.default("BadAlterValue",T)}else return P[S]},x=a},200608:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>a});var A=r(364842),w=r(726042);const f=function(h){this.init(h)},P=f.prototype;P.init=function(h){this.measureColumns=[],this.startDisplayIdx=h},P.getStartDisplayIdx=function(){return this.startDisplayIdx},P.push=function(h){this.measureColumns.push(h)},P.removeMeasureColumn=function(h){this.checkMeasureIdx(h);const d=this.measureColumns.splice(h,1)[0],l=d.getMeasuresSlice(),m=l.getIdxInSlice(d);l.removeMeasure(m)},P.insertMeasure=function(h,d){this.checkInsertionIdx(d),d===0?this.insertBegining(h):this.insertAfter(h,d),this.measureColumns.splice(d,0,h)},P.insertBegining=function(h){this.getFirstMeasuresSlice().insertMeasure(h,0)},P.insertAfter=function(h,d){const l=this.getMeasureColumn(d-1);if(l.hasMeasuresSlice()){const m=l.getMeasuresSlice(),S=m.getIdxInSlice(l)+1;m.insertMeasure(h,S)}},P.getFirstMeasuresSlice=function(){return this.getMeasuresSliceForMeasureIdx(0)},P.getMeasuresSliceForMeasureIdx=function(h){return this.getMeasureColumn(h).getMeasuresSlice()},P.getMeasuresSliceIdxForMeasureIdx=function(h){return this.getMeasureColumn(h).getMeasuresSliceIdx()},P.getMeasureColumn=function(h){return this.checkMeasureIdx(h),this.measureColumns[h]},P.checkInsertionIdx=function(h){const d=this.getNbMeasures();if(!w.default.isInteger(h)||h<0||h>d){const l=`Bad measure insertion index [${h}]`;throw new A.default("BadMeasureInsertionIdx",l)}},P.checkMeasureIdx=function(h){if(!this.hasMeasureIdx(h)){const d=`Bad measure index [${h}]`;throw new A.default("BadMeasureIdx",d)}},P.hasMeasureIdx=function(h){const d=this.getNbMeasures();return w.default.isInteger(h)&&h>=0&&h<d},P.getNbMeasures=function(){return this.measureColumns.length},P.isMeasureInSlice=function(h){return this.getMeasureColumn(h).hasMeasuresSlice()},P.getMeasuresSliceIdxFromMeasureIdx=function(h){return this.getMeasureColumn(h).getMeasuresSliceIdx()},P.getSlicesForMeasuresRange=function(h,d){const l=[];let m=null;for(let x=h;x<d;x++){if(!this.isMeasureInSlice(x))return m!==null&&l.push(null),l;const S=this.getMeasuresSliceIdxFromMeasureIdx(x);if(S!==m){const T=this.getMeasuresSliceForMeasureIdx(x);l.push(T),m=S}}return l},P.getUnbindedMeasures=function(){const h=this.getNbMeasures(),d=[];for(let l=h-1;l>=0;l--){const m=this.getMeasureColumn(l);if(!m.hasMeasuresSlice())d.unshift(m),this.measureColumns.pop();else return d}return d},P.hasUnbindedMeasures=function(){const d=this.getNbMeasures()-1;return!this.getMeasureColumn(d).hasMeasuresSlice()};const a=f},200675:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(100673);const w=function(a){this.init(a)};w.NAME="chord.rootStep";const f=w.prototype;f.name=w.NAME,f.init=function(a){this.step=a,this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},f.createText=function(){const a={text:this.step};this.text=new A.A(a)},f.setParent=function(a){this.parent=a,this.text.setParent(a)},f.setPosX=function(a){this.posX=a},f.setPosY=function(a){this.posY=a},f.setDrawingContext=function(a){this.drawingContext=a,this.text.setDrawingContext(a);const h=a.getHarmonyFontSize();this.text.setFontSize(h);const d=a.getHarmonyFontFamily(),l=a.getHarmonyFontStyle(),m=a.getHarmonyFontWeight();this.text.options["font-family"]=d,this.text.options["font-style"]=l,this.text.options["font-weight"]=m},f.draw=function(){this.rendered||this.render(),this.move()},f.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},f.move=function(){this.rendered&&this.posX!==null&&this.posY!==null&&(this.text.setPosition(this.posX,this.posY),this.text.move())},f.getWidth=function(){return this.text.getWidth()},f.getHeight=function(){const a=this.getSpaceAbove(),h=this.getSpaceBelow();return a+h},f.getSpaceAbove=function(){return this.drawingContext.getHarmonyFontSize()},f.getSpaceBelow=function(){return this.drawingContext.getHarmonyFontSize()/2};const P=w},225723:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(a){a=a.filter(d=>d.hasGroup());const h=new Map;a.forEach(w,h),h.forEach(f)}function w(a){const h=this,d=a.getGroupIdx();h.has(d)||h.set(d,[]),h.get(d).push(a)}function f(a){a.forEach(P)}function P(a,h,d){const l=h===0,m=h===d.length-1;a.setHasGroupStart(l),a.setHasGroupStop(m)}},245814:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(w,f){const P=f/w.x;w.x*=P,w.y*=P}},249394:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(364842),w=r(726042);const f={MIN:.1,MAX:10,DEFAULT:1};f.assert=function(a){f.isValid(a)||f.raiseError(a)},f.raiseError=function(a){const h=`The scaling [${a}] is invalid.`;throw new A.default("BadDisplayScaling",h)},f.isValid=function(a){return w.default.isNumber(a)&&f.MIN<=a&&a<=f.MAX};const P=f},276463:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>B});var A=r(364842);function w(C){const _=C.reduce(f),st=C.indexOf(_);return C.splice(st,1),_}function f(C,_){const st=C.y-_.y;if(st>0)return _;if(st<0)return C;const F=C.x-_.x;if(F>0)return _;if(F<0)return C;{const L="There are two points with the exact same coordinates.";throw new A.default("TwoSamePoints",L)}}var P=r(148029),a=r(189954);const h=1e-9;function d(C,_){return C===_?!0:l(C,_)<h}function l(C,_){const st=Math.abs(C-_),F=m(C,_);return st/F}function m(C,_){const st=_-C,F=C+st/2;return Math.abs(F)}function x(C,_){const st=_.map(S,C);return st.sort(T),_=st.map(Y),_.unshift(C),_}function S(C){const _=this,st=(0,P.A)(_,C),F=(0,a.A)(st),L=st.x/F;return{point:C,tangent:L}}function T(C,_){if(!d(C.tangent,_.tangent))return C.tangent-_.tangent;const st=C.point.x-_.point.x;if(st!==0)return-st;const F=C.point.y-_.point.y;if(F!==0)return F;const L="There are two points with the exact same coordinates.";throw new A.default("TwoSamePoints",L)}function Y(C){return C.point}var G=r(380725);function q(C){if(C.length<=2){const F="The algorithm only supports a number of points >= 3.";throw new A.default("NotEnoughPoints",F)}const _=new R(C);return _.filter(),_.getFilteredPoints()}class R{constructor(_){Object.defineProperty(this,"srcPoints",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPoints",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.srcPoints=_.slice(2),this.filteredPoints=_.slice(0,2)}filter(){this.srcPoints.forEach(this.addPoint,this)}addPoint(_){this.excludePoints(_),this.filteredPoints.push(_)}excludePoints(_){for(;this.canExclude(_);)this.filteredPoints.pop()}canExclude(_){return this.filteredPoints.length>2&&this.shouldExclude(_)}shouldExclude(_){const st=this.getBeforeLastPoint(),F=this.getLastPoint(),L=p(st,F,_);return!b(L)}getBeforeLastPoint(){const _=this.filteredPoints.length-2;return this.filteredPoints[_]}getLastPoint(){const _=this.filteredPoints.length-1;return this.filteredPoints[_]}getFilteredPoints(){return this.filteredPoints}}function p(C,_,st){const F=(0,P.A)(C,_),L=(0,P.A)(C,st);return(0,G.A)(F,L)}function b(C){return C<=0}const v=q;function B(C){const _=w(C),st=x(_,C);return v(st)}},282610:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Ao});var A=r(890439),w=r(920939),f=r(737903),P=r(843678),a=r(589085),h=r(75861),d=r(269352),l=r(934825);const m=3,x=function(o,u){this.init(o,u)},S=x.prototype;S.init=function(o,u){this.minLine=o,this.columns=[],this.columnLength=(u-o)*2+1},S.getAvailableColumn=function(o,u){typeof u=="undefined"&&(u=0);let E=u;for(;!this.isAvailableColumn(E,o);)E++;return E},S.isAvailableColumn=function(o,u){return typeof this.columns[o]=="undefined"?!0:this.isAvailableLine(o,u)},S.isAvailableLine=function(o,u){return this.isLowerLinesAvailable(o,u)?this.isThisAndHigherLinesAvailable(o,u):!1},S.isLowerLinesAvailable=function(o,u){let E=this.lineToIdx(u);E--;for(let H=E;H>=0&&E-H<m;H--)if(!this.isLineAvailable(o,H))return!1;return!0},S.isThisAndHigherLinesAvailable=function(o,u){const E=this.lineToIdx(u);for(let H=E;H<this.columnLength&&H-E<m;H++)if(!this.isLineAvailable(o,H))return!1;return!0},S.isLineAvailable=function(o,u){return this.columns[o][u]},S.lineToIdx=function(o){return(o-this.minLine)*2},S.makeSpaceTaken=function(o,u){typeof this.columns[o]=="undefined"&&this.addColumn(),this.takeLowerLinesInColumn(o,u),this.takeThisAndHigherLinesInColumn(o,u)},S.addColumn=function(){const o=[];for(let u=0;u<this.columnLength;u++)o.push(!0);this.columns.push(o)},S.takeLowerLinesInColumn=function(o,u){let E=this.lineToIdx(u);E--;for(let H=E;H>=0&&E-H<m;H--)this.makeLineTaken(o,H)},S.takeThisAndHigherLinesInColumn=function(o,u){const E=this.lineToIdx(u);for(let H=E;H<this.columnLength&&H-E<m;H++)this.makeLineTaken(o,H)},S.makeLineTaken=function(o,u){this.columns[o][u]=!1};const T=x,Y=function(o){this.init(o)},G=Y.prototype;G.init=function(o){this.accidentals=o,this.secondHighers=this.accidentals.filter(q),this.scheduledAccidentals=null,this.lowerProcessed=!1,this.higherProcessed=!1},G.getScheduledAccidentals=function(){return this.scheduledAccidentals===null&&this.calcScheduledAccidentals(),this.scheduledAccidentals},G.calcScheduledAccidentals=function(){this.scheduledAccidentals=[],this.scheduleSeconds(),this.scheduleOthers()},G.scheduleSeconds=function(){if(this.isHighestAccidentalSecondHigher()){const o=this.secondHighers[0];this.scheduleSecondHigher(o)}if(this.isLowestAccidentalSecondHigher()){const o=this.secondHighers.length-1,u=this.secondHighers[o];this.scheduleSecondHigher(u)}this.secondHighers.forEach(this.scheduleSecondHigher.bind(this))};const q=function(o){return!!o.secondHigher};G.isHighestAccidentalSecondHigher=function(){return this.secondHighers.length===0?!1:this.secondHighers[0]===this.accidentals[0]},G.isLowestAccidentalSecondHigher=function(){if(this.secondHighers.length===0)return!1;const o=this.secondHighers.length-1,u=this.accidentals.length-1,E=this.accidentals[u],H=this.secondHighers[o];if(H===E)return!0;if(this.accidentals.length<2)return!1;const ht=this.accidentals.length-2;return H!==this.accidentals[ht]?!1:this.hasSecondLowerAccidental(H)},G.scheduleSecondHigher=function(o){if(this.scheduledAccidentals.push(o),this.hasSecondLowerAccidental(o)){o.hasSecondLowerAccidental=!0;const E=this.getSecondLowerAccidental(o);this.markAccidentalProcessed(E),this.scheduledAccidentals.push(E)}this.markAccidentalProcessed(o);const u=this.secondHighers.indexOf(o);this.secondHighers.splice(u,1)},G.hasSecondLowerAccidental=function(o){const u=this.accidentals.indexOf(o);if(u===this.accidentals.length-1)return!1;const E=this.accidentals[u+1];return o.line-E.line===.5},G.getSecondLowerAccidental=function(o){const E=this.accidentals.indexOf(o)+1;return this.accidentals[E]},G.scheduleOthers=function(){if(this.hasFirst()){const o=this.accidentals[0];this.scheduleAccidental(o)}if(this.hasLast()){const o=this.accidentals.length-1,u=this.accidentals[o];this.scheduleAccidental(u)}this.accidentals.concat().forEach(this.scheduleAccidental.bind(this))},G.hasFirst=function(){return!this.higherProcessed&&this.accidentals.length>0},G.hasLast=function(){return!this.lowerProcessed&&this.accidentals.length>0},G.scheduleAccidental=function(o){this.scheduledAccidentals.push(o),this.markAccidentalProcessed(o)},G.markAccidentalProcessed=function(o){const u=this.accidentals.indexOf(o);u===0&&!this.higherProcessed&&(this.higherProcessed=!0),u===this.accidentals.length-1&&!this.lowerProcessed&&(this.lowerProcessed=!0),this.accidentals.splice(u,1)};const R=Y;var p=r(364842),b=r(614426);const v="accidentalParensLeft",B="accidentalParensRight",C=function(o,u){this.init(o,u)},_=C.prototype;_.init=function(o,u){this.list=st(o,u),this.middleEntity=F(this.list),this.color=null,this.drawingContext=null,this.displayData=null,this.width=null,this.line=null,this.posX=null,this.parent=null,this.group=null};const st=function(o,u){const E=[];let H;return u&&(H={glyphName:v,glyph:null,path:null,pos:null},E.push(H)),H={glyphName:I(o),glyph:null,path:null,pos:null},E.push(H),u&&(H={glyphName:B,glyph:null,path:null,pos:null},E.push(H)),E};_.setColor=function(o){this.color=o};function F(o){if(o.length===1)return o[0];if(o.length===3)return o[1];throw new p.default(`Unexpected accidental glyphs list size ${o.length}`)}const L=P.default.fromPairs([{key:b.default.SHARPSHARP,value:"accidentalDoubleSharp"},{key:b.default.DOUBLESHARP,value:"accidentalDoubleSharp"},{key:b.default.THREEQUARTERSHARP,value:"accidentalThreeQuarterTonesSharpArabic"},{key:b.default.SHARP,value:"accidentalSharp"},{key:b.default.QUARTERSHARP,value:"accidentalQuarterToneSharpArabic"},{key:b.default.NATURAL,value:"accidentalNatural"},{key:b.default.QUARTERFLAT,value:"accidentalQuarterToneFlatArabic"},{key:b.default.FLAT,value:"accidentalFlat"},{key:b.default.THREEQUARTERFLAT,value:"accidentalThreeQuarterTonesFlatArabic"},{key:b.default.FLATFLAT,value:"accidentalDoubleFlat"}]),I=function(o){return W(o),L[o]},W=function(o){if(typeof L[o]=="undefined"){const u=`the value ${o} for accidentals is not supported`;throw new p.default("FeatureNotSupported",u)}};_.setParent=function(o){this.parent=o},_.setDrawingContext=function(o){this.drawingContext=o},_.setDisplayData=function(o){this.displayData=o},_.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},_.areGlyphesLoaded=function(){return this.width!==null},_.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},_.loadGlyph=function(o,u){return u.pos=o,u.glyph=this.drawingContext.getGlyph(u.glyphName),o+u.glyph.getWidth()},_.render=function(){this.areGlyphesLoaded()||this.loadGlyphes(),this.group=new d.A("g"),this.group.attr("class","accidental"),this.list.forEach(this.renderEntry,this),this.color&&this.middleEntity.path.style("fill",this.color)},_.renderEntry=function(o){const u=this.group.append("path");u.attr("d",o.glyph.render());const E=o.pos;u.attr("transform",`translate(${E}, 0)`),o.path=u},_.setPosX=function(o){this.posX=o},_.setLine=function(o){this.line=o},_.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},_.needRender=function(){return this.group===null},_.bindToParent=function(){this.parent.append(this.group)},_.move=function(){const o=this.getPosY();this.group.attr("transform",`translate(${this.posX}, ${o})`)},_.getHighestY=function(){const o=this.getPosY(),u=this.list.map(H=>H.glyph.getBBoxNE().y),E=Math.min(...u);return o+E},_.getLowestY=function(){const o=this.getPosY(),u=this.list.map(H=>H.glyph.getBBoxSW().y),E=Math.max(...u);return o+E},_.getPosY=function(){const o=this.getSpaceSize(),u=this.displayData.getNbStaffLines();return w.A.lineToY(this.line,o,u)},_.getSpaceSize=function(){return this.displayData.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},_.getGroup=function(){return this.group};const V=C;var it=r(726042);const Pt=function(o){this.init(o)},Yt=Pt.prototype;Yt.init=function(o){this.displayData=o},Yt.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasAccidental()},Yt.hasAccidental=function(){return this.displayData.hasAccidentals()},Yt.draw=function(o,u){this.renderedNote=o,this.svg=this.renderedNote.getGroup(),this.ctx=u;let E=this.displayData.getAccidentals();E=(0,f.default)(E),E.reverse();const ht=new R(E).getScheduledAccidentals();Bt(ht),this.fillDrawers(ht);const ut=K(ht),Jt=this.getMarginSize()/2+ut;let se=this.getMarginSize()/2,we=0;se+=this.renderedNote.getLeftHeadWidth();for(let ki=0;ki<ht.length;ki++){const qe=ht[ki],qi=qe.drawer;qi.setParent(this.svg);const Pn=ut-qi.getWidth(),Yn=(qe.column+1)*Jt-Pn,Ks=-Yn-se;qi.setPosX(Ks),qi.draw();const Qn=qi.getGroup();this.renderedNote.addAccidental(Qn),we=Math.max(Yn,we);const kt=qe.drawer.getHighestY();this.renderedNote.setHighestY(kt);const ui=qe.drawer.getLowestY();this.renderedNote.setLowestY(ui)}this.renderedNote.setAccidentalsWidth(we)},Yt.getMarginSize=function(){if(this.displayData.isGrace()){const o=this.ctx.getGraceSizeCoeff();return this.ctx.getMarginSize()*o}else return this.ctx.getMarginSize()},Yt.getGlyph=function(o){if(this.displayData.isGrace()){const u=this.ctx.getGraceSizeCoeff();return this.ctx.getScaledGlyph(o,u)}else return this.ctx.getGlyph(o)};const Bt=function(o){const u=ie(o),E=new T(u.min,u.max);for(let H=0;H<o.length;H++){const ht=o[H];if(le(E,ht),ht.hasSecondLowerAccidental){H++;const ut=o[H],Jt=ht.column+1;le(E,ut,Jt)}}},le=function(o,u,E){const H=u.line,ht=o.getAvailableColumn(H,E);o.makeSpaceTaken(ht,H),u.column=ht};Yt.fillDrawers=function(o){o.forEach(this.fillDrawer,this)},Yt.fillDrawer=function(o){const u=new V(o.accidental,o.parentheses);o.color&&u.setColor(o.color),u.setDrawingContext(this.ctx),u.setDisplayData(this.displayData),u.setLine(o.line),o.drawer=u};const ie=function(o){let u=null;return o.forEach(function(E){const H=E.line;u===null?u={min:H,max:H}:H>u.max?u.max=H:H<u.min&&(u.min=H)}),u},K=function(o){return o.map(pe).reduce(it.default.max2)},pe=function(o){return o.drawer.getWidth()},Ee=Pt;var tt=r(83738),Et=r(191167),Vt=r(637475);const ct=function(o){this.displayData=o,this.nbFlags=o.getNbFlags(),this.stemValue=null,this.renderedNote=null,this.flagId=null},fe=ct.prototype;fe.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasFlag()},fe.hasFlag=function(){return!this.displayData.isRest()&&this.nbFlags>0&&!this.displayData.hasBeam()},fe.draw=function(o,u){this.renderedNote=o,this.svg=o.getStemBaseGroup(),this.ctx=u,this.stemValue=this.displayData.getStemValue(),this.checkStemValue(),this.retrieveFlagGlyphId(),this.glyph=this.getGlyph();const E=this.svg.append("g");E.append("path").attr("d",this.glyph.render());const ht=this.getFlagX(),ut=this.getFlagY();E.attr("transform",`translate(${ht} ${ut})`),this.displayData.hasFlagDash()&&this.nbFlags===1&&this.addFlagDash(E);const Jt=this.getFlagWidth();this.renderedNote.setFlag(E,Jt)},fe.getGlyph=function(){if(this.displayData.isGrace()){const o=this.ctx.getGraceFlagSizeCoeff();return this.ctx.getScaledGlyph(this.glyphId,o)}else return this.ctx.getGlyph(this.glyphId)},fe.getFlagWidth=function(){return this.glyph.getWidth()},fe.addFlagDash=function(o){const u=o.append("path"),E=this.ctx.getGraceFlagSizeCoeff();let H=null,ht;this.stemValue===h.A.UP?(H=this.glyph.getGraceNoteSlashSW(),ht=this.ctx.getScaledGlyph("graceNoteSlashStemUp",E)):this.stemValue===h.A.DOWN?(H=this.glyph.getGraceNoteSlashNW(),ht=this.ctx.getScaledGlyph("graceNoteSlashStemDown",E)):this.stemValueError(),u.attr("d",ht.render()),u.attr("transform",`translate(${H.x} ${H.y})`)},fe.checkStemValue=function(){this.stemValue!==h.A.UP&&this.stemValue!==h.A.DOWN&&this.stemValueError()},fe.stemValueError=function(){const o=`cannot draw flag for stem with ${this.stemValue} value`;throw new p.default("InconsistentValues",o)},fe.retrieveFlagGlyphId=function(){this.glyphId=this.getFlagGlyphId()},fe.getFlagGlyphId=function(){let o="flag";const u=Vt.A.get(2+this.nbFlags);return o+=u,this.stemValue===h.A.UP?(o+="Up",this.displayData.getNbDots()>0&&(o+="Short")):this.stemValue===h.A.DOWN&&(o+="Down"),o},fe.getFlagX=function(){return-(this.ctx.getStemThickness()/2)},fe.getFlagY=function(){const o=this.displayData.getStemQueueLine(),u=this.displayData.getStemBaseLine(),H=-(o-u)*this.ctx.getSpaceSize(),ht=this.getCounterOffset();return H+ht},fe.getCounterOffset=function(){let o=Math.max(0,this.nbFlags-2);this.displayData.isGrace()&&(o/=2);const u=o*this.ctx.getSpaceSize();if(this.stemValue===h.A.UP)return u;if(this.stemValue===h.A.DOWN)return-u;throw new p.default("unreachable")};const gt=ct;var At=r(259563);const Ht=function(o){this.init(o)};Ht.cssClass="stem";const Wt=Ht.prototype;Wt.init=function(o){this.displayData=o,this.baseQuarterDuration=o.getBaseQuarterDuration(),this.line=o.getLineAvg(),this.renderedNote=null,this.displayData.hasBeam()&&(this.beamData=o.getBeamData())},Wt.canDraw=function(){return this.displayData.isNormalStaff()&&!this.displayData.isSlash()&&this.hasStem()},Wt.hasStem=function(){const o=At.default.toQuarterDuration(At.default.HALF);return!this.displayData.isRest()&&this.baseQuarterDuration<=o},Wt.draw=function(o,u){this.svg=o.getStemBaseGroup(),this.ctx=u,this.renderedNote=o;const E=this.getStemValue();k(E);const H=this.getTailY(),ht=0,ut=this.svg.append("line"),Jt=this.getStemWidth(),se=o.getStemYOffset();ut.attr("x1",ht).attr("x2",ht).attr("y1",se).attr("y2",H).attr("stroke-width",Jt),ut.attr("class",Ht.cssClass),this.renderedNote.setStem(ut)};const k=function(o){o!==h.A.UP&&o!==h.A.DOWN&&St(o)},St=function(o){const u=`cannot draw stem with ${o} value`;throw new p.default("FeatureNotSupported",u)};Wt.getTailY=function(){const o=this.displayData.getStemQueueLine(),u=this.displayData.getStemBaseLine(),H=-(o-u)*this.ctx.getSpaceSize();return this.renderedNote.setHighestLowestYLine(o),H},Wt.getStemWidth=function(){return this.ctx.getStemThickness()},Wt.getStemValue=function(){return this.displayData.getStemValue()};const yt=Ht;var Ct=r(474976),Mt=r(538783),Tt=r(141624),nt=r(476943),vt=r(706650);const Nt={SPACE:"space",LINE:"line",STEM:"stem",CENTER:"center",EXTERNAL:"line-outside"},te=nt.default.pairsToMap([{key:Ct.default.STACCATO,value:{above:"articStaccatoAbove",below:"articStaccatoBelow",yAnchor:Nt.SPACE,xAnchor:Nt.STEM}},{key:Ct.default.STACCATO_TENUTO,value:{above:"articTenutoStaccatoAbove",below:"articTenutoStaccatoBelow",yAnchor:Nt.LINE,xAnchor:Nt.CENTER}},{key:Ct.default.TENUTO,value:{above:"articTenutoAbove",below:"articTenutoBelow",yAnchor:Nt.SPACE,xAnchor:Nt.CENTER}},{key:Ct.default.ACCENT,value:{above:"articAccentAbove",below:"articAccentBelow",yAnchor:Nt.EXTERNAL,xAnchor:Nt.CENTER}},{key:Ct.default.STRONG,value:{above:"articMarcatoAbove",below:"articMarcatoBelow",yAnchor:Nt.EXTERNAL,xAnchor:Nt.CENTER}},{key:Ct.default.STACCATISSIMO,value:{above:"articStaccatissimoAbove",below:"articStaccatissimoBelow",yAnchor:null,xAnchor:Nt.STEM}}]),ee=function(o){this.displayData=o,this.articulations=o.getArticulations(),this.stemValue=null,this.placement=null,this.renderedNote=null,this.currentArticulation=null},Ot=ee.prototype;Ot.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasArticulations()},Ot.hasArticulations=function(){return typeof this.articulations!="undefined"&&this.articulations.length>0},Ot.draw=function(o,u){vt.A.sortArticulationsList(this.articulations),this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.stemValue=this.displayData.getStemValue();const E=this.getSymbols();this.xPos=this.computeXPos(E),E.forEach(this.drawSymbol,this)},Ot.getSymbols=function(){const o=this.articulations.filter(ot),u=o.length,E=[];for(let H=0;H<u;H++){const ht=o[H],ut=rt(ht);E.push(ut)}return E};const ot=function(o){return typeof te[o]!="undefined"},rt=function(o){if(typeof te[o]!="undefined")return te[o];{const u=`Invalid articulation type: [${o}].`;throw new p.default("BadArticulationType",u)}};Ot.computeXPos=function(o){const u=this.getXAnchor(o),E=this.renderedNote.getMiddleHeadWidth();if(u===Nt.STEM){if(this.stemValue===h.A.UP)return E;if(this.stemValue===h.A.DOWN)return 0;throw new p.default("Unexpected")}else{if(u===Nt.MIDDLE)return E/2;throw new p.default("Unexpected")}},Ot.getXAnchor=function(o){const u=this.getPlacement();return u===Tt.A.ABOVE&&this.stemValue===h.A.DOWN||u===Tt.A.BELOW&&this.stemValue===h.A.UP||o.some(E=>E.xAnchor===Nt.MIDDLE)||!this.displayData.hasStem()?Nt.MIDDLE:Nt.STEM},Ot.drawSymbol=function(o){let u=this.getLine();u+=this.getLineMargin(),o===te[Ct.default.STACCATO_TENUTO]&&(u+=this.getLineMargin()*2),this.hasAnchor(o.yAnchor,u)?u=this.roundLine(o.yAnchor,u):u+=this.getLineMargin();const E=this.getGlyphId(o),H=this.ctx.getGlyph(E),ht=this.svg.append("g"),ut=ht.append("path");ut.attr("d",H.render()),ut.attr("class","articulations");const Jt=this.getArticulationX(H),se=this.getArticulationY(u,o,H);ht.attr("transform",`translate(${Jt} ${se})`),this.renderedNote.setArticulation(ht),this.updateLimit(se,H.getHeight())},Ot.getLine=function(){let o;const u=this.getPlacement();if(u===Tt.A.BELOW)o=this.renderedNote.getLowestY();else if(u===Tt.A.ABOVE)o=this.renderedNote.getHighestY();else throw new p.default("Unexpected");const E=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),H=this.displayData.getNbStaffLines();return w.A.yToLine(o,E,H)},Ot.getLineMargin=function(){return .25*this.getLineDirection()},Ot.getGlyphId=function(o){const u=this.getPlacement();if(u===Tt.A.BELOW)return o.below;if(u===Tt.A.ABOVE)return o.above;throw new p.default("Unexpected")},Ot.hasAnchor=function(o,u){if(o===null)return!1;o===Nt.LINE&&(u-=this.getLineMargin()*2);const E=this.getPlacement();if(E===Tt.A.BELOW){if(u<=.75)return!1}else if(E===Tt.A.ABOVE){if(u>=5.25)return!1}else throw new p.default("Unexpected");return!0},Ot.roundLine=function(o,u){const E=this.getPlacement(),H=this.displayData.getNbStaffLines();if(o===Nt.EXTERNAL){if(E===Tt.A.ABOVE)return Math.max(u,H+.25);if(E===Tt.A.BELOW)return Math.min(u,.75);throw new p.default("Unexpected")}else{if(o===Nt.SPACE)return u+=.5,u=this.getLineRoundingFunction()(u),u-=.5,u;if(o===Nt.LINE)return u=this.getLineRoundingFunction()(u),u;throw new p.default("Unexpected")}},Ot.getLineRoundingFunction=function(){const o=this.getPlacement();if(o===Tt.A.ABOVE)return Math.ceil;if(o===Tt.A.BELOW)return Math.floor;throw new p.default("Unexpected")},Ot.getLineDirection=function(){const o=this.getPlacement();if(o===Tt.A.BELOW)return-1;if(o===Tt.A.ABOVE)return 1;throw new p.default("Unexpected")},Ot.getArticulationX=function(o){const u=o.getWidth();return this.xPos-u/2},Ot.getArticulationY=function(o,u,E){const H=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),ht=this.displayData.getNbStaffLines();let ut=w.A.lineToY(o,H,ht);if(u.yAnchor===Nt.LINE||u.yAnchor===Nt.SPACE){const Jt=E.getHeight();ut+=Jt/2*this.getLineDirection()}return ut},Ot.updateLimit=function(o,u){const E=this.getPlacement();if(E===Tt.A.BELOW)this.renderedNote.setLowestY(o+u);else if(E===Tt.A.ABOVE)this.renderedNote.setHighestY(o-u);else throw new p.default("Unexpected")},Ot.getPlacement=function(){return this.placement===null&&(this.placement=this.computePlacement()),this.placement},Ot.computePlacement=function(){const o=this.displayData.getStemStrategy();if(o===Mt.A.AUTO){if(this.stemValue===h.A.UP)return Tt.A.BELOW;if(this.stemValue===h.A.DOWN)return Tt.A.ABOVE;throw new p.default("Unexpected")}else{if(Mt.A.isUp(o))return Tt.A.ABOVE;if(Mt.A.isDown(o))return Tt.A.BELOW;throw new p.default("Unexpected")}};const at=ee;var _t=r(724095),qt=r(555247),ue=r(359932),ne=r(601277),be=r(955154);const oe=nt.default.pairsToMap([{key:_t.A.TRILLMARK,value:"ornamentTrill"},{key:ue.default.UPBOW,value:{above:"stringsUpBow",below:"stringsUpBowTurned"}},{key:ue.default.DOWNBOW,value:{above:"stringsDownBow",below:"stringsDownBowTurned"}},{key:ue.default.SNAP_PIZZICATO,value:{above:"pluckedSnapPizzicatoAbove",below:"pluckedSnapPizzicatoBelow"}},{key:ue.default.STOPPED,value:"pluckedLeftHandPizzicato"},{key:be.default.NATURAL_SOUNDING,value:"stringsHarmonic"},{key:ue.default.THUMB_POSITION,value:{above:"stringsThumbPosition",below:"stringsThumbPositionTurned"}},{key:ne.default.FERMATA,value:{above:"fermataAbove",below:"fermataBelow"}},{key:_t.A.MORDENT,value:"ornamentMordent"},{key:_t.A.INVERTED_MORDENT,value:"ornamentShortTrill"},{key:qt.A.LONG_MORDENT,value:"ornamentPrecompTrillWithMordent"},{key:qt.A.LONG_INVERTED_MORDENT,value:"ornamentTremblement"},{key:qt.A.ABOVE_APPROACH_MORDENT,value:"ornamentPrecompInvertedMordentUpperPrefix"},{key:qt.A.BELOW_APPROACH_MORDENT,value:"ornamentPrecompSlideTrillBach"},{key:qt.A.ABOVE_APPROACH_INVERTED_MORDENT,value:"ornamentPrecompMordentUpperPrefix"},{key:qt.A.BELOW_APPROACH_INVERTED_MORDENT,value:"ornamentPrecompSlideTrillDAnglebert"},{key:qt.A.ABOVE_DEPARTURE_INVERTED_MORDENT,value:"ornamentPrecompTrillSuffixDandrieu"},{key:qt.A.BELOW_DEPARTURE_INVERTED_MORDENT,value:"ornamentPrecompTrillLowerSuffix"},{key:_t.A.TURN,value:"ornamentTurn"},{key:_t.A.INVERTED_TURN,value:"ornamentTurnSlash"}]),us=function(o){this.displayData=o,this.ornaments=o.getOrnaments(),this.technical=o.getTechnical(),this.articulations=o.getArticulations(),this.renderedNote=null,this.placement=null},Q=us.prototype;Q.canDraw=function(){return this.displayData.isNormalStaff()},Q.draw=function(o,u){this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.getGlyphIds().forEach(function(H){const ht=this.ctx.getGlyph(H),ut=this.svg.append("g"),Jt=ut.append("path");Jt.attr("d",ht.render()),Jt.attr("class","technical");const se=this.getPosX(ht),we=this.getPosY(ht);ut.attr("transform",`translate(${se} ${we})`),this.renderedNote.setTechnical(ut),this.updateLimit(we,ht)},this)},Q.getGlyphIds=function(){const o=[],u=this.getPlacement();if(typeof this.ornaments!="undefined"){const H=this.ornaments.filter(Xt).map(bt,u);Array.prototype.push.apply(o,H)}if(typeof this.technical!="undefined"){const H=this.technical.filter(Xt).map(bt,u);Array.prototype.push.apply(o,H)}if(typeof this.articulations!="undefined"){const H=this.articulations.filter(Xt).map(bt,u);Array.prototype.push.apply(o,H)}return o};const Xt=function(o){return typeof oe[o]!="undefined"},bt=function(o){const u=this.valueOf(),E=oe[o];if(typeof E=="string")return E;if(nt.default.isObject(E)){if(u===Tt.A.ABOVE)return E.above;if(u===Tt.A.BELOW)return E.below;throw new p.default("Unexpected")}else throw new p.default("Unexpected")};Q.getPosX=function(o){const u=this.renderedNote.getMiddleHeadWidth(),E=o.getWidth();return u/2-E/2},Q.getPosY=function(o){const u=this.ctx.getSpaceSize(),E=this.getPlacement();let H;if(E===Tt.A.ABOVE)return H=this.renderedNote.getLocalHighestYWithMarge(),H=Math.min(H,-u),H;if(E===Tt.A.BELOW){const ht=this.displayData.getNbStaffLines();return H=this.renderedNote.getLocalLowestYWithMarge(),H=Math.max(H,u*ht),H-=o.getBBoxNE().y,H}else throw new p.default("Unexpected")},Q.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)},Q.updateLimit=function(o,u){const E=this.getPlacement();if(E===Tt.A.ABOVE)o+=u.getBBoxNE().y,this.renderedNote.setHighestY(o);else if(E===Tt.A.BELOW)o+=u.getBBoxSW().y,this.renderedNote.setLowestY(o);else throw new p.default("Unexpected")},Q.getPlacement=function(){return this.placement===null&&(this.placement=this.calcPlacement()),this.placement},Q.calcPlacement=function(){const o=this.displayData.getStemStrategy();return Mt.A.isDown(o)?Tt.A.BELOW:Tt.A.ABOVE};const ve=us;var Qt=r(100673),ae=r(50060);const fs="adagio-lyric-level",ds=function(o,u){this.init(o,u)};ds.cssClass="lyricLine";const Xe=ds.prototype;Xe.init=function(o,u){this.lyricJson=o,this.headWidth=u,this.text=null,this.drawingContext=null,this.parent=null},Xe.render=function(o){this.drawingContext=o;const u={};if(u["font-size"]=o.getLyricsFontSize(),u["font-family"]=o.getLyricFontFamily(),u["font-weight"]=this.drawingContext.getLyricFontWeight(),u["font-style"]=this.drawingContext.getLyricFontStyle(),ae.default.hasColor(this.lyricJson)){const ht=ae.default.getColor(this.lyricJson);u.fill=ht}const E=ae.default.getText(this.lyricJson);u.text=E,this.text=new Qt.A(u),this.text.style["white-space"]="pre",this.parent!==null&&this.text.setParent(this.parent),this.text.setDrawingContext(o),this.text.render(),this.text.setCssClass(ds.cssClass);const H=this.getLevel();this.text.setDataEntry(fs,H)},Xe.setParent=function(o){this.parent=o,this.text!==null&&this.text.setParent(o)},Xe.setYPos=function(o){const u=this.drawingContext.getLyricsFontSize(),E=this.getLevel();o+=E*u,o+=this.getXHeight(),this.text.setYPos(o)},Xe.getTextPosY=function(){return this.text.y},Xe.getLevel=function(){return ae.default.getLevel(this.lyricJson)},Xe.setXPos=function(o){o+=this.headWidth/2-this.getWidth()/2,this.text.setXPos(o)},Xe.draw=function(){this.text.draw()},Xe.move=function(){this.text.move()},Xe.getWidth=function(){return this.text.getWidth()},Xe.getHeight=function(){return this.getXHeight()*2},Xe.getXHeight=function(){return this.text.getXHeight()},Xe.getFontSize=function(){return this.drawingContext.getLyricsFontSize()},Xe.getExceedingSpace=function(){const o=this.getWidth()/2-this.headWidth/2;return Math.max(o,0)};const U=ds,Gt="adagio-note-idx",It=function(o,u,E){this.init(o,u,E)};It.cssClass="lyric";const xt=It.prototype;xt.cssClass=It.cssClass,xt.init=function(o,u,E){this.headWidth=u,this.noteIdx=E,this.lyricsJsons=o,this.lyricsLines=this.lyricsJsons.map(this.createLyricLine,this),this.lyricsPerLevel=P.default.fromList(this.lyricsLines,zt),this.drawingContext=null,this.group=null,this.parent=null,this.height=null,this.width=null};const zt=function(o){return o.getLevel()};xt.createLyricLine=function(o){return new U(o,this.headWidth)},xt.render=function(o){this.drawingContext=o,this.group=new d.A("g"),this.group.attr("class",this.cssClass),this.group.setDataEntry(Gt,this.noteIdx),this.lyricsLines.forEach(this.transferDrawingContext,this)},xt.transferDrawingContext=function(o){o.setParent(this.group),o.render(this.drawingContext)},xt.setParent=function(o){this.parent=o},xt.setYPos=function(o){this.posY=o,this.lyricsLines.forEach(this.transferPosY,this)},xt.transferPosY=function(o){o.setYPos(this.posY)},xt.setXPos=function(o){this.posX=o,this.lyricsLines.forEach(this.transferPosX,this)},xt.transferPosX=function(o){o.setXPos(this.posX)},xt.draw=function(){this.lyricsLines.forEach(Ne),this.bindToParent()};const Ne=function(o){o.draw()};xt.bindToParent=function(){this.parent.append(this.group)},xt.move=function(){this.lyricsLines.forEach(pi)};const pi=function(o){o.move()};xt.getWidth=function(){if(this.width===null){const o=this.lyricsLines.map(Os);this.width=o.reduce(it.default.max2)}return this.width};const Os=function(o){return o.getWidth()};xt.getHeight=function(){if(this.height===null){const o=this.lyricsJsons.length,u=this.lyricsJsons[o-1],E=ae.default.getLevel(u),H=this.lyricsLines[o-1],ht=H.getHeight(),ut=H.getFontSize();this.height=ht+ut*E}return this.height},xt.getExceedingSpace=function(){const o=this.getWidth()/2-this.headWidth/2;return Math.max(o,0)},xt.hasLevel=function(o){return typeof this.lyricsPerLevel[o]!="undefined"},xt.getLevelWidth=function(o){return this.getLevel(o).getWidth()},xt.getLevelPosY=function(o){return this.getLevel(o).getTextPosY()},xt.getLevel=function(o){return this.lyricsPerLevel[o]},xt.getLevels=function(){return P.default.getKeys(this.lyricsPerLevel)},xt.getBeginLevels=function(){return this.lyricsJsons.filter(ae.default.hasRightConnection).map(ae.default.getLevel)},xt.getEndLevels=function(){return this.lyricsJsons.filter(ae.default.hasLeftConnection).map(ae.default.getLevel)};const on=It,Fi=function(o){this.displayData=o,this.stemValue=null,this.renderedNote=null},Wi=Fi.prototype;Wi.canDraw=function(){return this.displayData.hasLyrics()&&!this.displayData.isRecorderTabStaff()},Wi.draw=function(o,u){if(this.displayData.isTabStaff()&&!u.hideNonTab())return;const E=o.getMiddleHeadWidth(),H=this.displayData.getLyrics(),ht=this.displayData.getNoteIdx(),ut=new on(H,E,ht);ut.render(u),o.addLyric(ut)};const $i=Fi,rn=nt.default.pairsToMap([{key:Ct.default.BREATHMARK,value:"breathMarkComma"},{key:Ct.default.CAESURA,value:"caesura"}]),ss=function(o){this.displayData=o,this.articulations=o.getArticulations(),this.renderedNote=null},vi=ss.prototype;vi.canDraw=function(){return this.displayData.isNormalStaff()},vi.draw=function(o,u){this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.getGlyphIds().forEach(function(H){const ht=this.ctx.getGlyph(H),ut=this.svg.append("g"),Jt=ut.append("path");Jt.attr("d",ht.render()),Jt.attr("class","aboveright");const se=this.getPosX(),we=this.getPosY(ht);ut.attr("transform",`translate(${se} ${we})`),this.renderedNote.setTechnical(ut),this.updateLimit(we,ht),this.renderedNote.setAboveRight(ut,se+ht.getWidth())},this)},vi.getGlyphIds=function(){const o=[];if(typeof this.articulations!="undefined"){const E=this.articulations.filter(Ki).map(is);Array.prototype.push.apply(o,E)}return o};const Ki=function(o){return typeof rn[o]!="undefined"},is=function(o){return rn[o]};vi.getPosX=function(){const o=this.ctx.getMinimalSpaceAboveRightRatio(),u=this.renderedNote.getWidth()+.5*this.ctx.getSpaceSize();return Math.max(o,u)},vi.getPosY=function(o){const u=o.getHeight();return-(1.2*this.ctx.getSpaceSize()-u)},vi.updateLimit=function(o,u){const E=u.getHeight();this.renderedNote.setHighestY(o-E)};const bn=ss;var Mn=r(212642);const pn=nt.default.pairsToMap([{key:qt.A.TREMOLO1,value:"tremolo1"},{key:qt.A.TREMOLO2,value:"tremolo2"},{key:qt.A.TREMOLO3,value:"tremolo3"},{key:qt.A.TREMOLO4,value:"tremolo4"},{key:qt.A.TREMOLO5,value:"tremolo5"},{key:_t.A.BUZZ,value:"buzzRoll"}]),ai=function(o){this.displayData=o,this.ornaments=o.getOrnaments(),this.renderedNote=null},Ys=ai.prototype;Ys.canDraw=function(){return this.displayData.isNormalStaff()},Ys.draw=function(o,u){this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.getGlyphesData().forEach(function(H){const ht=this.ctx.getGlyph(H.id),ut=this.svg.append("g"),Jt=ut.append("path");Jt.attr("d",ht.render()),Jt.attr("class","aboveright");const se=this.getPosX(ht),we=this.getPosY(H.nbLines);ut.attr("transform",`translate(${se} ${we})`),this.renderedNote.setTechnical(ut),this.updateLimit(we,ht.getHeight())},this)},Ys.getGlyphesData=function(){const o=[];if(typeof this.ornaments!="undefined"){const E=this.ornaments.filter(Ti).map(ji);Array.prototype.push.apply(o,E)}return o};const Ti=function(o){return typeof pn[o]!="undefined"},ji=function(o){const u=Mn.A.ornamentToNbLines(o);return{id:pn[o],nbLines:u}};Ys.getPosX=function(o){const u=this.renderedNote.getMiddleHeadWidth(),E=o.getWidth(),H=this.ctx.getStemThickness()/2,ht=this.getStemValue();return this.hasStem()?ht===h.A.UP?u/2+E/2-H:(ht===h.A.DOWN,0):u/2},Ys.getPosY=function(o){let u=1+(o-1)/2;const E=this.displayData.getNbFlags();u+=E;const H=this.displayData.getStemQueueLine(),ht=this.getLinePLacementCoeff(),ut=H-u*ht,Jt=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),se=this.displayData.getNbStaffLines();return w.A.lineToY(ut,Jt,se)},Ys.updateLimit=function(o,u){const E=this.displayData.getStemValue();E===h.A.UP?this.renderedNote.setHighestY(o-u/2):E===h.A.DOWN?this.renderedNote.setLowestY(o+u/2):h.A.raiseError(E)},Ys.getLinePLacementCoeff=function(){const o=this.displayData.getStemValue();if(o===h.A.UP)return 1;if(o===h.A.DOWN)return-1;h.A.raiseError(o)},Ys.hasStem=function(){return this.displayData.hasStem()},Ys.getStemValue=function(){return this.displayData.getStemValue()};const Me=ai;var an=r(725885);const Rn="wiggleArpeggiatoUp",Qi=function(){this.init()};Qi.NAME="arpeggio";const We=Qi.prototype;We.name=Qi.NAME,We.init=function(){this.drawingContext=null,this.inputHeight=null,this.actualHeight=null,this.nbPaths=null,this.glyph=null,this.group=null,this.parent=null,this.paths=[]},We.setDrawingContext=function(o){this.drawingContext=o},We.setPosition=function(o,u){this.posX=o,this.posY=u},We.setParent=function(o){this.parent=o},We.setInputHeight=function(o){this.inputHeight=o},We.draw=function(){this.renderIfNeeded(),this.bindToParent()},We.renderIfNeeded=function(){this.isRendered()||this.render()},We.isRendered=function(){return this.group!==null},We.render=function(){this.group=new d.A("g"),this.group.attr("class",this.name);const o=this.getNbPaths(),u=this.getGlyph(),E=u.render(),H=u.getRepeatOffset();if(H){let ut=-(this.actualHeight-this.inputHeight)/2;const Jt=0;for(let se=0;se<o;se++){const we=this.group.append("path");we.attr("d",E),we.attr("transform",`translate(${ut}, ${Jt})`),ut+=H.x,this.paths.push(we)}}else{let ht=0;const ut=0,Jt=this.getPathHeight();for(let se=0;se<o;se++){const we=this.group.append("path");we.attr("d",E),we.attr("transform",`translate(${ht}, ${ut})`),ht+=Jt,this.paths.push(we)}}},We.move=function(){const o=this.posX,u=this.posY,E=`translate(${o}, ${u})`;this.group.attr("transform",`${E} rotate(-90)`)},We.bindToParent=function(){this.parent.append(this.group)},We.getNbPaths=function(){return this.nbPaths===null&&this.computeNbPaths(),this.nbPaths},We.getWidth=function(){return this.getGlyph().getHeight()},We.getTrailingSpace=function(){return 0},We.computeNbPaths=function(){const u=this.getGlyph().getRepeatOffset(),E=u?u.x:this.getPathHeight();this.nbPaths=Math.ceil(this.inputHeight/E),this.actualHeight=this.nbPaths*E},We.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(Rn)),this.glyph},We.getPathHeight=function(){return this.glyph.getWidth()};const Re=Qi,Ji=1,mn=function(o){this.init(o)},Li=mn.prototype;Li.init=function(o){this.displayData=o},Li.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasArpeggio()},Li.hasArpeggio=function(){return this.displayData.hasArpeggio()},Li.draw=function(o,u){this.renderedNote=o,this.svg=this.renderedNote.getGroup(),this.ctx=u;const E=this.ctx.getSpaceSize(),H=this.displayData.getLowestLine(),ut=(Math.abs(this.displayData.getHighestLine()-H)+Ji)*E,Jt=new Re;Jt.setParent(this.svg),Jt.setDrawingContext(this.ctx),Jt.setInputHeight(ut);const se=this.lineToY(H-Ji/2),we=Jt.getTrailingSpace(),qe=-(this.getInitialShift()+we);Jt.setPosition(qe,se),Jt.draw(),Jt.move(),o.addArpeggio(Jt)},Li.getInitialShift=function(){let o=0;return o+=this.renderedNote.getLeftHeadWidth(),this.renderedNote.accidentals.length>0&&(o+=this.renderedNote.accsWidth+this.ctx.getMarginSize()/2),o+=this.ctx.getMarginSize()/2,o},Li.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)};const Gi=mn,re={ABOVE:"above",BELOW:"below",LEFT:"left",RIGHT:"rigth"},D=nt.default.pairsToMap([{key:Ct.default.DOIT,value:{glyphId:"brassDoitMedium",verticalDirection:re.ABOVE,horizontalDirection:re.RIGHT}},{key:Ct.default.FALLOFF,value:{glyphId:"brassFallRoughShort",verticalDirection:re.BELOW,horizontalDirection:re.RIGHT}},{key:Ct.default.PLOP,value:{glyphId:"brassPlop",verticalDirection:re.ABOVE,horizontalDirection:re.LEFT}},{key:Ct.default.SCOOP,value:{glyphId:"brassScoop",verticalDirection:re.BELOW,horizontalDirection:re.LEFT}}]),pt=function(o){this.displayData=o,this.articulations=o.getArticulations(),this.renderedNote=null,this.svg=null,this.ctx=null},Dt=pt.prototype;Dt.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasArticulations()},Dt.hasArticulations=function(){return typeof this.articulations!="undefined"},Dt.draw=function(o,u){this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.getArticulations().forEach(function(H){const ht=this.ctx.getGlyph(H.glyphId),ut=this.svg.append("g"),Jt=ut.append("path");Jt.attr("d",ht.render()),Jt.attr("class","jazzarticulation");const se=this.getY(H.verticalDirection,ht),we=this.getX(H.horizontalDirection,ht);ut.attr("transform",`translate(${we} ${se})`),this.updateLimit(H.verticalDirection,se,ht),this.setRenderedNoteWidth(H.horizontalDirection,ht)},this)},Dt.getArticulations=function(){return typeof this.articulations!="undefined"?this.articulations.filter(Oe).map(Ge):[]},Dt.getY=function(o,u){const E=.2*this.ctx.getSpaceSize();if(o===re.ABOVE){const H=this.displayData.getHighestLine();return this.lineToY(H)-E}else if(o===re.BELOW){const H=this.displayData.getLowestLine();return this.lineToY(H)+E+u.getHeight()}else throw new p.default("Unexpected")},Dt.getX=function(o,u){const E=.2*this.ctx.getSpaceSize();if(o===re.LEFT){let H=-u.getWidth()-E;return H-=this.renderedNote.getLeftHeadWidth(),this.renderedNote.hasAccidentals()&&(H-=this.renderedNote.getAccidentalsWidth()),H}else if(o===re.RIGHT){let H=this.renderedNote.getMiddleHeadWidth()+E;return H+=this.renderedNote.getRightHeadWidth(),H}else throw new p.default("Unexpected")},Dt.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)},Dt.updateLimit=function(o,u,E){const H=E.getHeight();if(o===re.ABOVE)this.renderedNote.setHighestY(u-H);else if(o===re.BELOW)this.renderedNote.setLowestY(u+H);else throw new p.default("Unexpected")},Dt.setRenderedNoteWidth=function(o,u){const E=u.getWidth();if(o===re.LEFT)this.renderedNote.setLeftArticulationsWidth(E);else if(o===re.RIGHT)this.renderedNote.setRightArticulationsWidth(E);else throw new p.default("Unexpected")};const Oe=function(o){return typeof D[o]!="undefined"},Ge=function(o){return D[o]},si=pt,Ei=function(o){this.displayData=o,this.nbFlags=o.getNbFlags(),this.stemValue=null,this.renderedNote=null,this.flagId=null},gs=Ei.prototype;gs.canDraw=function(){return this.hasFlag()&&this.displayData.isTabStaff()&&this.displayData.hasFrets()&&!this.displayData.isGrace()},gs.hasFlag=function(){return!this.displayData.isRest()&&this.nbFlags>0&&!this.displayData.hasBeam()},gs.draw=function(o,u){this.renderedNote=o,this.svg=o.getStemBaseGroup(),this.ctx=u,this.stemValue=this.displayData.getStemValue(),this.checkStemValue(),this.retrieveFlagGlyphId(),this.glyph=this.getGlyph();const E=this.svg.append("g");E.append("path").attr("d",this.glyph.render());const ht=this.getFlagX(),ut=this.getFlagY();E.attr("transform",`translate(${ht} ${ut})`);const Jt=this.getFlagWidth();this.renderedNote.setFlag(E,Jt)},gs.getGlyph=function(){if(this.displayData.isGrace()){const o=this.ctx.getGraceFlagSizeCoeff();return this.ctx.getScaledGlyph(this.glyphId,o)}else return this.ctx.getGlyph(this.glyphId)},gs.getFlagWidth=function(){return this.glyph.getWidth()},gs.checkStemValue=function(){this.stemValue!==h.A.UP&&this.stemValue!==h.A.DOWN&&this.stemValueError()},gs.stemValueError=function(){const o=`cannot draw tab flag for stem with ${this.stemValue} value`;throw new p.default("InconsistentValues",o)},gs.retrieveFlagGlyphId=function(){this.glyphId=this.getFlagGlyphId()},gs.getFlagGlyphId=function(){let o="flag";const u=Vt.A.get(2+this.nbFlags);return o+=u,this.stemValue===h.A.UP?o+="Up":this.stemValue===h.A.DOWN&&(o+="Down"),o},gs.getFlagX=function(){const o=this.renderedNote.getFretsWidth(),u=this.getStemWidth();return o/2-u/2},gs.getFlagY=function(){const o=this.displayData.getStemQueueLine(),u=this.displayData.getStemBaseLine(),H=-(o-u)*this.ctx.getSpaceSize(),ht=this.getCounterOffset();return H+ht},gs.getCounterOffset=function(){let o=Math.max(0,this.nbFlags-2)/2;this.displayData.isGrace()&&(o/=2);const u=o*this.ctx.getTabSpaceSize();if(this.stemValue===h.A.UP)return u;if(this.stemValue===h.A.DOWN)return-u;throw new p.default("unreachable")},gs.getStemWidth=function(){return this.ctx.getStemThickness()};const Ui=Ei,bi=function(o){this.init(o)};bi.cssClass="tab-stem";const Xs=bi.prototype;Xs.init=function(o){this.displayData=o,this.baseQuarterDuration=o.getBaseQuarterDuration(),this.renderedNote=null},Xs.canDraw=function(){return this.hasStem()&&this.displayData.isTabStaff()&&this.displayData.hasFrets()&&!this.displayData.isGrace()},Xs.hasStem=function(){const o=At.default.toQuarterDuration(At.default.HALF);return!this.displayData.isRest()&&this.baseQuarterDuration<=o},Xs.draw=function(o,u){this.svg=o.getStemBaseGroup(),this.ctx=u,this.renderedNote=o;const E=this.getStemValue();os(E);const H=this.getTailY(),ht=this.getStemX(),ut=this.svg.append("line"),Jt=this.getStemWidth();ut.attr("x1",ht).attr("x2",ht).attr("y1",0).attr("y2",H).attr("stroke-width",Jt),ut.attr("class",bi.cssClass),this.renderedNote.setStem(ut)};const os=function(o){o!==h.A.UP&&o!==h.A.DOWN&&On(o)},On=function(o){const u=`cannot draw stem with ${o} value`;throw new p.default("FeatureNotSupported",u)};Xs.getTailY=function(){const o=this.displayData.getStemQueueLine(),u=this.displayData.getStemBaseLine(),H=-(o-u)*this.ctx.getSpaceSize();return this.renderedNote.setHighestLowestYLine(o),H},Xs.getStemX=function(){const o=this.renderedNote.getFretsWidth(),u=this.getStemWidth();return o/2-u/2},Xs.getStemWidth=function(){return this.ctx.getStemThickness()},Xs.getStemValue=function(){return this.displayData.getStemValue()};const qn=bi,Un="augmentationDot",An=function(o){this.glyphPath=null,this.glyphWidth=null,this.renderedNote=null,this.displayData=o},Mi=An.prototype;Mi.canDraw=function(){return this.hasDot()&&this.displayData.isTabStaff()&&this.displayData.hasFrets()&&!this.displayData.isGrace()},Mi.hasDot=function(){return this.displayData.getNbDots()>0},Mi.draw=function(o,u){this.renderedNote=o,this.svg=o.getStemBaseGroup(),this.ctx=u,this.createGlyph(),this.drawDots()},Mi.createGlyph=function(){const o=this.ctx.getGlyph(Un);this.glyphPath=o.render(),this.glyphWidth=o.getWidth(),this.glyphHeight=o.getHeight()},Mi.drawDots=function(){this.drawPitchedDots()},Mi.drawPitchedDots=function(){let o=this.renderedNote.getFretsWidth()/2;this.displayData.getBaseQuarterDuration()>1&&(o*=2);const u=0,E=this.ctx.getMarginSize();let H=E;const ht=this.displayData.getNbDots();for(let ut=0;ut<ht;ut++){const Jt=o+H,se=this.svg.append("path");se.attr("d",this.glyphPath),se.attr("transform",`translate(${Jt} ${u})`),this.renderedNote.addDot(se),this.renderedNote.setDotWidth(this.glyphWidth),this.renderedNote.setDotMargin(H),H+=this.glyphWidth+E}};const zn=An,Je="fingering",kn=function(o){this.displayData=o,this.fingerings=o.getFingerings()},Vs=kn.prototype;Vs.canDraw=function(){return this.hasFingerings()&&this.displayData.isTabStaff()},Vs.hasFingerings=function(){return typeof this.fingerings!="undefined"&&this.fingerings.length>0},Vs.draw=function(o,u){this.renderedNote=o,this.drawingContext=u;const E=this.getPlacement();E===Tt.A.ABOVE?this.drawAbove():E===Tt.A.BELOW?this.drawBelow():Tt.A.raiseError(E)},Vs.drawAbove=function(){const o=this.drawingContext.getSpaceSize(),u=this.renderedNote.getHighestY()-o/2,E=-o;this.yPos=Math.min(E,u);const H=this.displayData.getFingerings().slice();H.reverse(),H.forEach(this.drawFingeringAbove,this)},Vs.drawFingeringAbove=function(o){const u=this.drawFingering(o);this.yPos-=u.getHeight(),this.yPos-=this.drawingContext.getMarginSize(),this.renderedNote.setHighestY(this.yPos)},Vs.drawBelow=function(){const o=this.drawingContext.getSpaceSize(),u=this.displayData.getNbStaffLines(),E=o*(u-1),H=this.renderedNote.getLowestY();this.yPos=Math.max(H,E),this.displayData.getFingerings().forEach(this.drawFingeringBelow,this)},Vs.drawFingeringBelow=function(o){this.yPos+=this.drawingContext.getMarginSize();const u=this.drawFingering(o);this.yPos+=u.getHeight(),this.renderedNote.setLowestY(this.yPos)},Vs.drawFingering=function(o){const u=ps(o),E=this.drawingContext.getGlyph(u),H=E.render(),ut=this.renderedNote.getGroup().append("path");ut.attr("d",H);const Jt=E.getWidth(),we=this.renderedNote.getFretsWidth()/2-Jt/2;let ki=this.yPos;return this.getPlacement()===Tt.A.BELOW&&(ki+=E.getHeight()),ut.attr("transform",`translate(${we}, ${ki})`),E};function ps(o){return Je+o}Vs.getPlacement=function(){const o=this.displayData.getStemStrategy();if(o===Mt.A.AUTO)return Tt.A.ABOVE;if(Mt.A.isUp(o))return Tt.A.ABOVE;if(Mt.A.isDown(o))return Tt.A.BELOW;Mt.A.raiseError(o)};const Sn=kn,$="arrowheadBlackUp",ms="arrowheadBlackDown",Ri=.2,Nn=.5,Ve=.7;class M{constructor(){this.drawingContext=null,this.height=null,this.direction=null,this.arrow=null,this.line=null,this.glyph=null,this.parent=null,this.group=null,this.posX=null,this.posY=null}setDrawingContext(u){this.drawingContext=u}setPosition(u,E){this.posX=u,this.posY=E}setParent(u){this.parent=u}setHeight(u){this.height=u}setDirection(u){this.direction=u}draw(){this.renderIfNeeded(),this.bindToParent()}renderIfNeeded(){this.isRendered()||this.render()}isRendered(){return this.group!==null}render(){this.group=new d.A("g"),this.group.attr("class",this.name);const u=this.drawingContext.getStemThickness();this.line=this.group.append("line");const E=this.getLineY1(),H=this.getLineY2();this.line.attr("x1",0).attr("x2",0).attr("y1",E).attr("y2",H).attr("stroke-width",u);const ht=this.getGlyph();this.arrow=this.group.append("path"),this.arrow.attr("d",ht.render());const ut=this.getArrowY(),Jt=-this.getWidth()/2;this.arrow.attr("transform",`translate(${Jt}, ${ut})`)}getLineY1(){const u=this.drawingContext.getTabSpaceSize();let H=0-u*Nn;if(this.direction===ue.default.DOWNBOW){const ht=u*Ri;H+=ht}return H}getLineY2(){const u=this.drawingContext.getTabSpaceSize(),E=u*Nn;let H=this.height+E;if(this.direction===ue.default.UPBOW){const ht=u*Ri;H-=ht}return H}getArrowY(){const E=this.drawingContext.getTabSpaceSize()*Ri;if(this.direction===ue.default.DOWNBOW)return 0-E;if(this.direction===ue.default.UPBOW){const ht=this.getGlyph().getHeight();return this.height+ht+E}else ue.default.raiseError(this.direction)}move(){this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)}bindToParent(){this.parent.append(this.group)}getTrailingSpace(){return this.getWidth()/2}getWidth(){return this.getGlyph().getWidth()}getGlyph(){if(this.glyph===null){const u=this.getGlyphId();this.glyph=this.drawingContext.getScaledGlyph(u,Ve)}return this.glyph}getGlyphId(){if(this.direction===ue.default.DOWNBOW)return $;if(this.direction===ue.default.UPBOW)return ms;ue.default.raiseError(this.direction)}}M.NAME="strumming";class et{constructor(u){this.displayData=u,this.direction=null,this.hasDirection=!1,this.topString=null}canDraw(){return this.displayData.isTabStaff()&&this.hasStrumming()}hasStrumming(){const u=this.getDirection();return u===ue.default.UPBOW||u===ue.default.DOWNBOW}getDirection(){return this.hasDirection||(this.displayData.getTechnical().forEach(E=>{(E===ue.default.UPBOW||E===ue.default.DOWNBOW)&&(this.direction=E)}),this.hasDirection=!0),this.direction}getTopString(){if(this.topString===null){const E=this.displayData.getFrets().filter(nt.default.isNotNull).map(H=>H.string);this.topString=Math.min(...E)}return this.topString}getHeight(){const u=this.getTopString(),H=this.displayData.getFrets().filter(nt.default.isNotNull).map(se=>se.string),ut=Math.max(...H)-u;return this.ctx.getTabSpaceSize()*ut}draw(u,E){this.renderedNote=u,this.svg=this.renderedNote.getGroup(),this.ctx=E;const H=new M,ht=this.getDirection();H.setDirection(ht),H.setParent(this.svg),H.setDrawingContext(this.ctx);const ut=this.getHeight();H.setHeight(ut);const Jt=this.getTopString(),se=this.lineToY(Jt),we=H.getTrailingSpace(),qe=-(this.getInitialShift()+we);H.setPosition(qe,se),H.draw(),H.move(),u.addArpeggio(H)}getInitialShift(){let u=0;return u+=this.renderedNote.getLeftHeadWidth(),u+=this.ctx.getMarginSize()/2,u}lineToY(u){const E=this.ctx.getTabSpaceSize(),H=this.displayData.getNbStaffLines();return w.A.stringToY(u,E,H)}}const Z="fingering",mt=function(o){this.displayData=o,this.fingerings=o.getFingerings()},$t=mt.prototype;$t.canDraw=function(){return this.displayData.isNormalStaff()&&this.hasFingerings()},$t.hasFingerings=function(){return typeof this.fingerings!="undefined"&&this.fingerings.length>0},$t.draw=function(o,u){this.renderedNote=o,this.drawingContext=u;const E=this.getPlacement();E===Tt.A.ABOVE?this.drawAbove():E===Tt.A.BELOW?this.drawBelow():Tt.A.raiseError(E)},$t.drawAbove=function(){const o=this.drawingContext.getSpaceSize(),u=this.renderedNote.getHighestY()-o/2,E=-o/2;this.yPos=Math.min(E,u);const H=this.displayData.getFingerings().slice();H.reverse(),H.forEach(this.drawFingeringAbove,this)},$t.drawFingeringAbove=function(o){const u=this.drawFingering(o);this.yPos-=u,this.yPos-=this.drawingContext.getMarginSize(),this.renderedNote.setHighestY(this.yPos)},$t.drawBelow=function(){const o=this.drawingContext.getSpaceSize(),u=this.displayData.getNbStaffLines(),E=o*(u-1),H=this.renderedNote.getLowestY();this.yPos=Math.max(H,E),this.displayData.getFingerings().forEach(this.drawFingeringBelow,this)},$t.drawFingeringBelow=function(o){this.yPos+=this.drawingContext.getMarginSize();const u=this.drawFingering(o);this.yPos+=u,this.renderedNote.setLowestY(this.yPos)},$t.drawFingering=function(o){const E=this.renderedNote.getGroup().append("g");let H=0,ht=0;const ut=this.drawingContext.getMarginSize();o.toString().split("").forEach(qe=>{const qi=Ye(qe),Pn=this.drawingContext.getGlyph(qi),Yn=Pn.render(),Ks=E.append("path");Ks.attr("d",Yn),H>0&&(H+=ut);const Qn=H,kt=Pn.getWidth();H+=kt,Ks.attr("transform",`translate(${Qn}, 0)`);const ui=Pn.getHeight();ht=Math.max(ht,ui)});const se=this.renderedNote.getMiddleHeadWidth()/2-H/2;let we=this.yPos;return this.getPlacement()===Tt.A.BELOW&&(we+=ht),E.attr("transform",`translate(${se}, ${we})`),ht};function Ye(o){return Z+o}$t.getPlacement=function(){const o=this.displayData.getStemStrategy(),u=this.displayData.getStaffIdx();if(o===Mt.A.AUTO)return u===0?Tt.A.ABOVE:Tt.A.BELOW;if(Mt.A.isUp(o))return Tt.A.ABOVE;if(Mt.A.isDown(o))return Tt.A.BELOW;Mt.A.raiseError(o)};const de=mt,xs={4:"restWhole",2:"restHalf",1:"restQuarter",.5:"rest8th",.25:"rest16th",.125:"rest32nd",.0625:"rest64th"},Fs=function(o){this.init(o)};Fs.cssClass="head";const jt=Fs.prototype;jt.cssClass=Fs.cssClass,jt.init=function(o){this.baseQuarterDuration=o.getBaseQuarterDuration(),this.displayData=o,this.glyphId=null,this.renderedNote=null,this.glyph=null,this.middleWidth=null},jt.canDraw=function(){return this.displayData.isKodalyStaff()&&this.displayData.isRest()},jt.draw=function(o,u){this.renderedNote=o,this.ctx=u,this.createRestHead(),this.fillGlyph(),this.drawHead(),this.fillRenderedNoteData()},jt.createRestHead=function(){const o=As(this.baseQuarterDuration),E={line:this.displayData.getLines()[0],cssClassesStr:"",color:this.displayData.getRestColor()};this.addHead(o,E)};const As=function(o){const u=xs[o];if(typeof u=="undefined"){const E=`There is no rest glyph for the quarter duration [${o}].`;throw new p.default("NoRestGlyph",E)}return u};jt.addHead=function(o,u){const E={line:u.line,glyphId:o,text:null,cssClassesStr:u.cssClassesStr,color:u.color};this.head=E},jt.fillGlyph=function(){this.head.glyph=this.getGlyph(this.head.glyphId)},jt.getGlyph=function(o){if(this.displayData.isGrace()){const u=this.ctx.getGraceSizeCoeff();return this.ctx.getScaledGlyph(o,u)}else return this.ctx.getGlyph(o)},jt.drawHead=function(){const o=this.head.line,u=this.renderedNote.getHead(o);this.head.path=u.append("path"),this.head.path.attr("d",this.head.glyph.render());const E=this.ctx.getSpaceSize(),H=0,ht=this.lineToY(o,E);this.renderedNote.setHighestY(ht+this.head.glyph.getBBoxNE().y),this.renderedNote.setLowestY(ht+this.head.glyph.getBBoxSW().y),u.attr("transform",`translate(${H} ${ht})`);const ut=this.head.cssClassesStr;u.attr("class",`${this.cssClass} ${ut}`),this.head.color&&this.head.path.style("fill",this.head.color)},jt.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)},jt.fillRenderedNoteData=function(){this.renderedNote.setLeftHeadWidth(0),this.renderedNote.setRightHeadWidth(0);const o=this.getMiddleWidth();this.renderedNote.setMiddleHeadWidth(o)},jt.getMiddleWidth=function(){if(this.middleWidth===null){const o=0-this.head.glyph.getBBoxSW().x;return this.head.glyph.getBBoxNE().x-o}return this.middleWidth};const hi=Fs,ye=function(o){this.init(o)};ye.cssClass="legerLine";const ci=ye.prototype;ci.cssClass=ye.cssClass,ci.init=function(o){this.displayData=o,this.renderedNote=null},ci.canDraw=function(){return this.displayData.isKodalyStaff()&&this.displayData.isRest()&&!this.isSmallRest()},ci.isSmallRest=function(){return this.displayData.isRest()?this.displayData.getBaseQuarterDuration()<=1:!1},ci.draw=function(o,u){this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.hasUpLegerLines()&&this.drawUpLegerLines(),this.hasDownLegerLines()&&this.drawDownLegerLines()},ci.hasUpLegerLines=function(){return this.displayData.getHighestLine()>=6},ci.hasDownLegerLines=function(){return this.displayData.getLowestLine()<=0},ci.drawUpLegerLines=function(){const o=this.displayData.getHighestLine();this.drawLegerLine(o)},ci.drawDownLegerLines=function(){const o=this.displayData.getLowestLine();this.drawLegerLine(o)},ci.drawLegerLine=function(o){const u=this.ctx.getSpaceSize()/2,E=this.renderedNote.getMiddleHeadWidth(),H=-u,ht=E+u,ut=this.lineToY(o),Jt=this.svg.append("line"),se=this.getLegerLineThickness();Jt.attr("x1",H).attr("x2",ht).attr("y1",ut).attr("y2",ut).attr("stroke-width",se).attr("class",this.cssClass),this.renderedNote.addLegerLine(o)},ci.getLegerLineThickness=function(){return this.ctx.getLegerLineThickness()},ci.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)};const uo=ye,Ze="augmentationDot",fo=function(o){this.glyphPath=null,this.glyphWidth=null,this.renderedNote=null,this.displayData=o},zi=fo.prototype;zi.canDraw=function(){return this.displayData.isKodalyStaff()&&this.hasDot()},zi.hasDot=function(){return this.displayData.getNbDots()>0},zi.draw=function(o,u){this.renderedNote=o,this.svg=o.getGroup(),this.ctx=u,this.createGlyph(),this.drawDots()},zi.createGlyph=function(){const o=this.ctx.getGlyph(Ze);this.glyphPath=o.render(),this.glyphWidth=o.getWidth(),this.glyphHeight=o.getHeight()},zi.drawDots=function(){this.displayData.isRest()?this.drawRestDots():this.drawPitchedDots()},zi.drawRestDots=function(){const o=this.renderedNote.getMiddleHeadWidth()+this.renderedNote.calcTrailingSpace(),E=this.lineToY(6.5);let H=this.ctx.getMarginSize();const ht=this.displayData.getNbDots();for(let ut=0;ut<ht;ut++){const Jt=o+H,se=this.svg.append("path");se.attr("d",this.glyphPath),se.attr("transform",`translate(${Jt} ${E})`),this.renderedNote.addDot(se),this.renderedNote.setDotWidth(this.glyphWidth),this.renderedNote.setDotMargin(H),H+=this.glyphWidth+this.ctx.getMarginSize()}},zi.drawPitchedDots=function(){let o=this.renderedNote.getMiddleHeadWidth()/2;this.displayData.getBaseQuarterDuration()>1&&(o*=2);let E=this.lineToY(4),H=this.ctx.getMarginSize();this.displayData.getBaseQuarterDuration()<=1&&(E-=this.glyphHeight/2);const ht=this.displayData.getNbDots();for(let ut=0;ut<ht;ut++){const Jt=o+H,se=this.svg.append("path");se.attr("d",this.glyphPath),se.attr("transform",`translate(${Jt} ${E})`),this.renderedNote.addDot(se),this.renderedNote.setDotWidth(this.glyphWidth),this.renderedNote.setDotMargin(H),H+=this.glyphWidth+this.ctx.getMarginSize()}},zi.hasFlag=function(){return!this.displayData.isRest()&&this.displayData.getNbFlags()>0&&!this.displayData.hasBeam()},zi.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)};const Wo=fo;var Ce=r(351277),vs=r(595382),Zi=r(364596),bs=r(850354),ns=r(377180);const Bn={C:"d",D:"r",E:"m",F:"f",G:"s",A:"l",B:"t"},Ts={C:void 0,D:"a",E:"e",F:void 0,G:"e",A:"e",B:"e"},Go=[{from:Ce.default.create(4,"C",-1),to:Ce.default.create(3,"B",0)},{from:Ce.default.create(4,"F",-1),to:Ce.default.create(4,"E",0)},{from:Ce.default.create(4,"E",1),to:Ce.default.create(4,"F",0)},{from:Ce.default.create(3,"B",1),to:Ce.default.create(4,"C",0)}];function Uo(o){let u="";for(;o!==4;)o<4?(o++,u+=","):o>4&&(o--,u+="'");return u}const hn=function(o){this.init(o)};hn.cssClass="head";const $s=hn.prototype;$s.cssClass=hn.cssClass,$s.init=function(o){this.baseQuarterDuration=o.getBaseQuarterDuration(),this.displayData=o,this.renderedNote=null,this.middleWidth=null},$s.canDraw=function(){return this.displayData.isKodalyStaff()&&!this.displayData.isRest()&&!this.displayData.isHandSign()},$s.draw=function(o,u){this.renderedNote=o,this.ctx=u,this.createTextHead(),this.drawHead(),this.fillRenderedNoteData()},$s.createHeads=function(){this.createTextHead()},$s.createTextHead=function(){const[o]=this.displayData.getHeads(),u=this.getTextStr(o),H={line:o.line,cssClassesStr:"",color:o.color};this.addHead(u,H)},$s.getTextStr=function(o){let u=Ce.default.create(o.octave,o.step,o.alter);u=Ws(u);const E=Ce.default.getStep(u),H=Ce.default.getAlter(u),ht=Ce.default.getOctave(u),ut=Bn[E],Jt=Xn(E,H),se=Uo(ht);let we=ut+Jt+se;return o.isTieStop&&(we=`(${we})`),we};function Ws(o){const u=Ce.default.getAlter(o);if(u>1||u<-1){const H=ns.default.createDefault();o=Ce.default.transpose(o,H,!1)}const E={pitch:o};return Go.some(zo,E),E.pitch}function zo(o){const u=this;if(Ce.default.getAlter(u.pitch)===Ce.default.getAlter(o.from)&&Ce.default.getStep(u.pitch)===Ce.default.getStep(o.from)){const E=Ce.default.getOctave(o.from),ht=Ce.default.getOctave(o.to)-E,ut=Ce.default.getOctave(u.pitch)+ht,Jt=Ce.default.getStep(o.to),se=Ce.default.getAlter(o.to);return u.pitch=Ce.default.create(ut,Jt,se),!0}}function Xn(o,u){let E;if(u===1)E="i";else if(u===0)E="";else if(u===-1)E=Ts[o];else throw new p.default(`Invalid alter ${u}`);if(typeof E=="undefined")throw new p.default(`No middle kodaly letter for step ${o} and alter ${u}.`);return E}$s.addHead=function(o,u){if(!u.color&&u.step&&this.ctx.useBoomwhackersColors()){const H=$e(u.step,u.alter);u.color=(0,bs.A)(H)}const E={line:u.line,textStr:o,text:null,cssClassesStr:u.cssClassesStr,color:u.color};this.head=E};function $e(o,u){if(u===0)return o;const E=Zi.default.createDefault(),H=Ce.default.create(4,o,u);let ht=vs.A.switchEnharmonic(H,E);if(u===-2){if(Ce.default.getAlter(ht)===0)return Ce.default.getStep(ht);ht=vs.A.switchEnharmonic(ht,E)}let ut=H;if(Ce.default.getAlter(ht)>=0&&(ut=ht),u=Ce.default.getAlter(ut),o=Ce.default.getStep(ut),u===1)return`${o}#`;if(u===0)return o;throw new p.default("Unexpected")}$s.drawHead=function(){const o=this.head.line,u=this.renderedNote.getHead(o),E=new Qt.A({text:this.head.textStr});E.setParent(u),E.setDrawingContext(this.ctx);const H=this.ctx.getKodalyFontSize(),ht=this.ctx.getHarmonyFontFamily();E.options["font-family"]=ht,E.setFontSize(H),E.setXPos(0),E.setYPos(0),this.head.color&&(E.style.fill=this.head.color),this.head.text=E,E.render(),E.draw();const ut=0,Jt=this.ctx.getSpaceSize(),se=this.lineToY(o);this.renderedNote.setHighestY(se-Jt),this.renderedNote.setLowestY(se),u.attr("transform",`translate(${ut} ${se})`);const we=this.head.cssClassesStr;u.attr("class",`${this.cssClass} ${we}`)},$s.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)},$s.fillRenderedNoteData=function(){this.renderedNote.setLeftHeadWidth(0),this.renderedNote.setRightHeadWidth(0);const o=this.getMiddleWidth();this.renderedNote.setMiddleHeadWidth(o),this.renderedNote.setLeftStemX(o/2)},$s.getMiddleWidth=function(){return this.middleWidth===null&&(this.middleWidth=this.head.text.getWidth()),this.middleWidth};const ko=hn,Vn=function(o){this.init(o)};Vn.cssClass="stem";const li=Vn.prototype;li.init=function(o){this.displayData=o,this.baseQuarterDuration=o.getBaseQuarterDuration(),this.line=o.getLineAvg(),this.renderedNote=null,this.displayData.hasBeam()&&(this.beamData=o.getBeamData())},li.canDraw=function(){return this.displayData.isKodalyStaff()&&this.hasStem()},li.hasStem=function(){const o=At.default.toQuarterDuration(At.default.HALF);return!this.displayData.isRest()&&this.baseQuarterDuration<o},li.draw=function(o,u){this.svg=o.getStemBaseGroup(),this.ctx=u,this.renderedNote=o;const E=this.getTailY(),H=this.svg.append("line"),ht=this.getStemWidth();H.attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",E).attr("stroke-width",ht),H.attr("class",Vn.cssClass),this.renderedNote.setStem(H)},li.getYOrigin=function(){return this.lineToY(0)},li.getTailY=function(){const o=this.displayData.getStemBaseLine(),E=this.displayData.getStemQueueLine()-o,H=this.ctx.getSpaceSize();return-E*H},li.lineToY=function(o){const u=this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)},li.getStemWidth=function(){return this.ctx.getStemThickness()};const Gs=Vn,go=function(o){this.displayData=o,this.nbFlags=o.getNbFlags(),this.stemValue=null,this.renderedNote=null,this.flagId=null},Ns=go.prototype;Ns.canDraw=function(){return this.displayData.isKodalyStaff()&&this.hasFlag()},Ns.hasFlag=function(){return!this.displayData.isRest()&&this.nbFlags>0&&!this.displayData.hasBeam()},Ns.draw=function(o,u){this.renderedNote=o,this.svg=o.getStemBaseGroup(),this.ctx=u,this.stemValue=this.displayData.getStemValue(),this.checkStemValue(),this.retrieveFlagGlyphId(),this.glyph=this.getGlyph();const E=this.svg.append("g");E.append("path").attr("d",this.glyph.render());const ht=this.getFlagX(),ut=this.getFlagY();E.attr("transform",`translate(${ht} ${ut})`),this.displayData.hasFlagDash()&&this.nbFlags===1&&this.addFlagDash(E);const Jt=this.getFlagWidth();this.renderedNote.setFlag(E,Jt)},Ns.getGlyph=function(){if(this.displayData.isGrace()){const o=this.ctx.getGraceFlagSizeCoeff();return this.ctx.getScaledGlyph(this.glyphId,o)}else return this.ctx.getGlyph(this.glyphId)},Ns.getFlagWidth=function(){return this.glyph.getWidth()},Ns.addFlagDash=function(o){const u=o.append("path"),E=this.ctx.getGraceFlagSizeCoeff();let H=null,ht;this.stemValue===h.A.UP?(H=this.glyph.getGraceNoteSlashSW(),ht=this.ctx.getScaledGlyph("graceNoteSlashStemUp",E)):this.stemValue===h.A.DOWN?(H=this.glyph.getGraceNoteSlashNW(),ht=this.ctx.getScaledGlyph("graceNoteSlashStemDown",E)):this.stemValueError(),u.attr("d",ht.render()),u.attr("transform",`translate(${H.x} ${H.y})`)},Ns.checkStemValue=function(){this.stemValue!==h.A.UP&&this.stemValue!==h.A.DOWN&&this.stemValueError()},Ns.stemValueError=function(){const o=`cannot draw flag for stem with ${this.stemValue} value`;throw new p.default("InconsistentValues",o)},Ns.retrieveFlagGlyphId=function(){this.glyphId=this.getFlagGlyphId()},Ns.getFlagGlyphId=function(){let o="flag";const u=Vt.A.get(2+this.nbFlags);return o+=u,this.stemValue===h.A.UP?o+="Up":this.stemValue===h.A.DOWN&&(o+="Down"),this.displayData.getNbDots()>0&&(o+="Short"),o},Ns.getFlagX=function(){return-(this.ctx.getStemThickness()/2)},Ns.getFlagY=function(){const o=this.displayData.getStemQueueLine(),u=this.displayData.getStemBaseLine(),H=-(o-u)*this.ctx.getSpaceSize(),ht=this.getCounterOffset();return H+ht},Ns.getCounterOffset=function(){let o=Math.max(0,this.nbFlags-2);this.displayData.isGrace()&&(o/=2);const u=o*this.ctx.getSpaceSize();if(this.stemValue===h.A.UP)return u;if(this.stemValue===h.A.DOWN)return-u;throw new p.default("unreachable")};const Ke=go,Ue={4:"noteheadWhole",2:"noteHalfUp"},$n=function(o){this.init(o)};$n.cssClass="head";const mi=$n.prototype;mi.cssClass=$n.cssClass,mi.init=function(o){this.baseQuarterDuration=o.getBaseQuarterDuration(),this.displayData=o,this.glyphId=null,this.renderedNote=null,this.glyph=null,this.middleWidth=null},mi.canDraw=function(){const o=At.default.toQuarterDuration(At.default.HALF);return this.displayData.isKodalyStaff()&&!this.displayData.isRest()&&this.baseQuarterDuration>=o},mi.draw=function(o,u){this.renderedNote=o,this.ctx=u,this.createHead(),this.fillGlyph(),this.drawHead()},mi.createHead=function(){const o=Us(this.baseQuarterDuration),u={line:4,cssClassesStr:"",color:null};this.addHead(o,u)};const Us=function(o){const u=Ue[o];if(typeof u=="undefined"){const E=`There is no rest glyph for the quarter duration [${o}].`;throw new p.default("NoRestGlyph",E)}return u};mi.addHead=function(o,u){const E={line:u.line,glyphId:o,text:null,cssClassesStr:u.cssClassesStr,color:u.color};this.head=E},mi.fillGlyph=function(){this.head.glyph=this.getGlyph(this.head.glyphId)},mi.getGlyph=function(o){if(this.displayData.isGrace()){const u=this.ctx.getGraceSizeCoeff();return this.ctx.getScaledGlyph(o,u)}else return this.ctx.getGlyph(o)},mi.drawHead=function(){const o=this.head.line,u=this.renderedNote.getHead(o);this.head.path=u.append("path"),this.head.path.attr("d",this.head.glyph.render());const E=this.ctx.getSpaceSize(),H=this.renderedNote.getMiddleHeadWidth(),ht=this.head.glyph.getWidth(),ut=H/2-ht/2,Jt=this.lineToY(o,E);this.renderedNote.setHighestY(Jt+this.head.glyph.getBBoxNE().y),this.renderedNote.setLowestY(Jt+this.head.glyph.getBBoxSW().y),u.attr("transform",`translate(${ut} ${Jt})`);const se=this.head.cssClassesStr;u.attr("class",`${this.cssClass} ${se}`),this.head.color&&this.head.path.style("fill",this.head.color)},mi.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)};const Xo=$n,yn={C:"kodalyHandDo",D:"kodalyHandRe",E:"kodalyHandMi",F:"kodalyHandFa",G:"kodalyHandSo",A:"kodalyHandLa",B:"kodalyHandTi"},ge=function(o){this.init(o)};ge.cssClass="head";const Ai=ge.prototype;Ai.cssClass=ge.cssClass,Ai.init=function(o){this.baseQuarterDuration=o.getBaseQuarterDuration(),this.displayData=o,this.renderedNote=null,this.middleWidth=null},Ai.canDraw=function(){return this.displayData.isKodalyStaff()&&!this.displayData.isRest()&&this.displayData.isHandSign()},Ai.draw=function(o,u){this.renderedNote=o,this.ctx=u,this.createHead(),this.drawHead(),this.fillRenderedNoteData()},Ai.createHead=function(){const[o]=this.displayData.getHeads(),u=this.getGlyphId(o),H={line:o.line,cssClassesStr:"",color:o.color};this.addHead(u,H)},Ai.getGlyphId=function(o){return yn[o.step]},Ai.addHead=function(o,u){if(!u.color&&u.step&&this.ctx.useBoomwhackersColors()){const ht=Hn(u.step,u.alter);u.color=(0,bs.A)(ht)}const E=this.ctx.getGlyph(o),H={line:u.line,glyph:E,cssClassesStr:u.cssClassesStr,color:u.color};this.head=H};function Hn(o,u){if(u===0)return o;const E=Zi.default.createDefault(),H=Ce.default.create(4,o,u);let ht=vs.A.switchEnharmonic(H,E);if(u===-2){if(Ce.default.getAlter(ht)===0)return Ce.default.getStep(ht);ht=vs.A.switchEnharmonic(ht,E)}let ut=H;if(Ce.default.getAlter(ht)>=0&&(ut=ht),u=Ce.default.getAlter(ut),o=Ce.default.getStep(ut),u===1)return`${o}#`;if(u===0)return o;throw new p.default("Unexpected")}Ai.drawHead=function(){const o=this.head.line,u=this.renderedNote.getHead(o);this.head.path=u.append("path"),this.head.path.attr("d",this.head.glyph.render());const E=0,H=this.ctx.getSpaceSize();let ht=this.lineToY(o);ht+=this.head.glyph.getHeight()/2,this.renderedNote.setHighestY(ht-H),this.renderedNote.setLowestY(ht),u.attr("transform",`translate(${E} ${ht})`);const ut=this.head.cssClassesStr;u.attr("class",`${this.cssClass} ${ut}`)},Ai.lineToY=function(o){const u=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),E=this.displayData.getNbStaffLines();return w.A.lineToY(o,u,E)},Ai.fillRenderedNoteData=function(){this.renderedNote.setLeftHeadWidth(0),this.renderedNote.setRightHeadWidth(0);const o=this.getMiddleWidth();this.renderedNote.setMiddleHeadWidth(o),this.renderedNote.setLeftStemX(o/2)},Ai.getMiddleWidth=function(){return this.middleWidth===null&&(this.middleWidth=this.head.glyph.getWidth()),this.middleWidth};const Kn=ge;var Be=r(176244),Vo=r(863426);const to={0:"windOpenHole",.5:"windHalfClosedHole1",1:"windClosedHole"},_n={0:"windOpenHole",.5:"windHalfClosedHole2",1:"windClosedHole"},xe={0:"open-hole",.5:"half-closed-hole",1:"closed-hole"};class $o{constructor({closed:u,altHalfClosed:E,position:H,parent:ht,drawingContext:ut}){this.closed=u.toString(),this.position=H,this.parent=ht,this.ctx=ut,this.altHalfClosed=E,this.glyph=null,this.holeSvg=null}draw(){this.render(),this.move(),this.bindToParent()}render(){this.holeSvg=new d.A("path"),this.glyph=this.altHalfClosed?this.ctx.getGlyph(_n[this.closed]):this.ctx.getGlyph(to[this.closed]);const u=this.glyph.render();this.holeSvg.attr("d",u),this.holeSvg.attr("class",xe[this.closed])}move(){this.shouldRotate()&&(this.holeSvg.style("transform-origin","50% 50%"),this.holeSvg.style("transform-box","fill-box"),this.holeSvg.style("transform",`translate(${this.position[0]}px, ${this.position[1]}px) rotate(180deg)`)),this.holeSvg.attr("transform",`translate(${this.position[0]}, ${this.position[1]})`)}bindToParent(){this.parent.append(this.holeSvg)}shouldRotate(){return this.altHalfClosed&&this.closed==="0.5"}getSpaceAboveOrigin(){return this.glyph.getBBoxNE().y}getSpaceBelowOrigin(){return this.glyph.getBBoxSW().y}getSpaceBeforeOrigin(){return this.glyph.getBBoxSW().x}getSpaceAfterOrigin(){return this.glyph.getBBoxNE().x}getWidth(){return this.glyph.getWidth()}getHeight(){return this.glyph.getHeight()}}const po=.75,zs=.6,Ko="head recorder-tab-diagram",cn=.12,dt=3.63,jo=new Map([[0,[-.7,0]],[1,[.7,0]],[2,[.7,1.6]],[3,[.7,3.1]],[4,[.7,5.2]],[5,[.7,6.8]],[6,[.7,8.4]],[7,[0,9.7]]]),Qo=[.24,3.63,2.42,3.63],eo=new Map([[0,[-1.1,9.8]],[1,[.3,9.8]],[2,[.3,8.2]],[3,[.3,6.6]],[4,[.3,4.5]],[5,[.3,2.9]],[6,[.3,1.3]],[7,[1,0]]]),Ss=[.1,5,1.8,5];class jn{constructor(u){this.displayData=u,this.formula=u.getFingeringDiagramFormula(),this.ctx=null,this.renderedNote=null,this.parent=null,this.diagramSvg=null,this.spaceSize=null,this.holes=[],this.cssClass=Ko,this.holePositionMap=jo,this.separatorPosition=Qo,this.displayType=u.getFingeringDisplayType(),this.displayType===Be.A.JAPANESE&&(this.holePositionMap=eo,this.separatorPosition=Ss)}canDraw(){return this.displayData.isRecorderTabStaff()}draw(u,E){if(this.renderedNote=u,this.parent=u.getGroup(),this.ctx=E,this.spaceSize=this.ctx.getSpaceSize(),this.displayData.isRest()||!this.formula){this.renderAndDrawPlaceHolder();return}this.render(),this.dedicateSpace(),this.bindToParent()}renderAndDrawPlaceHolder(){const u=new d.A("g");u.attr("class",this.cssClass),this.parent.append(u)}render(){this.diagramSvg=new d.A("g"),this.diagramSvg.attr("class",this.cssClass),this.formula.forEach((u,E)=>{const H=new $o({closed:u,altHalfClosed:this.isAltHalfClosed(E),position:this.getHolePosition(E),parent:this.diagramSvg,drawingContext:this.ctx});H.draw(),this.holes.push(H)}),this.drawSeparator(),this.diagramSvg.attr("transform",`translate(0, ${-this.getTopY()*this.getScale()})
      scale(${this.getScale()})`)}isAltHalfClosed(u){return u===0&&this.displayType===Be.A.JAPANESE}dedicateSpace(){const E=dt*this.spaceSize,H=cn*this.spaceSize,ht=this.getHeight()+E,ut=this.getMiddleWidth()+H;this.renderedNote.setHighestY(0),this.renderedNote.setLowestY(ht),this.renderedNote.setMiddleHeadWidth(ut)}bindToParent(){this.parent.append(this.diagramSvg)}drawSeparator(){const u=new Vo.A(this.diagramSvg,{stroke_width:this.ctx.getRecorderTabSeparatorThickness()}),E=this.separatorPosition.map(H=>this.spaceSize*H);u.render(...E),u.draw()}getHolePosition(u){return this.holePositionMap.get(u).map(E=>this.spaceSize*E)}getHeight(){const u=this.getTopY();return(this.getBottomY()-u)*this.getScale()}getTopY(){const u=this.displayType===Be.A.JAPANESE?this.holes.length-1:0;return this.holes[u].getSpaceAboveOrigin()+this.getHolePosition(u)[1]}getBottomY(){const u=this.displayType===Be.A.JAPANESE?0:this.holes.length-1;return this.holes[u].getSpaceBelowOrigin()+this.getHolePosition(u)[1]}getMiddleWidth(){const u=this.getLeftX();return(this.getRightX()-u)*this.getScale()}getLeftX(){return this.holes[0].getSpaceBeforeOrigin()+this.getHolePosition(0)[0]}getRightX(){const u=this.displayType===Be.A.JAPANESE?this.holes.length-1:1;return this.holes[u].getSpaceAfterOrigin()+this.getHolePosition(u)[0]}getScale(){return this.displayData.isGrace()?zs:po}}const Jo=[l.A,Ee,tt.A,Et.A,gt,yt,at,ve,bn,Me,an.A,Gi,si,Ui,qn,Sn,zn,et,de,hi,uo,ko,Kn,Xo,Gs,Ke,Wo,jn,$i],In=function(o){this.init(o)},Qe=In.prototype;Qe.init=function(o){this.renderedNote=o,this.noteSvg=o.noteSvg},Qe.drawNote=function(o){const u=this.renderedNote.getDisplayData();Jo.forEach(function(E){const H=new E(u);H.canDraw()&&H.draw(this.renderedNote,o)},this),this.renderedNote.bindHeads()};const Si=In,so="noteheadBlack",yi=function(o){this.init(o)};yi.cssClass="note",yi.graceCssClass="graceNote";const wt=yi.prototype;wt.cssClass=yi.cssClass,wt.init=function(o){o.isGrace()&&(this.cssClass=yi.graceCssClass),this.parentSvg=null,this.noteSvg=new d.A("g");const u=`${this.cssClass} ${o.getGlobalCssClassesStr()}`;this.setCssClass(u),this.stemBaseGroup=null,this.xPos=0,this.displayData=o,this.beam=null,this.heads=null,this.frets={},this.accidentals=[],this.accidentalsWidth=null,this.articulations=[],this.technical=[],this.ornaments=[],this.dots=[],this.dotWidth=null,this.dotMargin=null,this.aboveRight=null,this.aboveRightWidth=null,this.stem=null,this.flag=null,this.flagWidth=null,this.legerLines={},this.middleHeadWidth=null,this.rightHeadWidth=null,this.leftHeadWidth=null,this.leftStemX=null,this.stemYOffset=null,this.fretsWidth=null,this.noteDrawer=null,this.rightArticulationsWidth=null,this.leftArticulationsWidth=null,this.lyricsHorizontalData={},this.lyric=null,this.arpeggio=null,this.localVerticalAlignment=null,this.timePos=null,this.horizontalShift=0,this.tabOffset=null},wt.getStaffData=function(){return this.displayData.getStaffData()},wt.getVoiceIdx=function(){return this.displayData.getVoiceIdx()},wt.getNbStaffLines=function(){const o=this.getStaffData();return a.A.getNbStaffLines(o)},wt.isTabStaff=function(){const o=this.getStaffData();return a.A.isTabStaff(o)},wt.isRecorderTabStaff=function(){const o=this.getStaffData();return a.A.isRecorderTabStaff(o)},wt.isKodalyStaff=function(){const o=this.getStaffData();return a.A.isKodalyStaff(o)},wt.setParent=function(o){this.parentSvg=o,this.hasLyric()&&this.lyric.setParent(o)},wt.setCssClass=function(o){this.noteSvg.attr("class",o)},wt.getDisplayData=function(){return this.displayData},wt.getGroup=function(){return this.noteSvg},wt.getStemBaseGroup=function(){if(this.stemBaseGroup===null){this.stemBaseGroup=this.noteSvg.append("g");const u=this.getDisplayData().getStemBaseLine(),E=this.lineToY(u),H=this.getLeftStemX();this.stemBaseGroup.attr("transform",`translate(${H} ${E})`)}return this.stemBaseGroup},wt.lineToY=function(o){const u=this.drawingContext.getSpaceSize(),E=this.displayData.getNbStaffLines();if(this.isTabStaff()){const H=this.drawingContext.getTabSpaceSize();return w.A.lineToTabY(o,u,H,E)}else return w.A.lineToY(o,u,E)},wt.setHeadColor=function(o,u){let E;this.isRest()?E=this.getAnyWrappedHead():E=this.getWrappedHeads()[o.line],E.headGroup.style("fill",u)},wt.getAnyWrappedHead=function(){const o=this.getWrappedHeads();for(const u in o)return o[u];throw new p.default("Unexpected")},wt.getWrappedHeads=function(){const o=this.getHeads(),u={};for(const E in o){const H=o[E];u[E]=mo(H,E)}return u};const mo=function(o,u){return{line:u,headGroup:o,getGroup:function(){return this.headGroup}}};wt.bindHeads=function(){const o=this.getHeads();P.default.forEach(o,this.bindHead,this)},wt.bindHead=function(o,u){this.noteSvg.append(u)},wt.getHead=function(o){return this.getHeads()[o]},wt.getHeads=function(){return this.heads===null&&this.initHeads(),this.heads},wt.initHeads=function(){this.heads={},this.getDisplayData().getLines().forEach(this.initHead,this)},wt.initHead=function(o){const u=new d.A("g");this.heads[o]=u},wt.getFret=function(o){return this.getFrets()[o]},wt.getFrets=function(){return this.frets},wt.setFret=function(o,u){this.frets[o]=u},wt.addDot=function(o){this.dots.push(o)},wt.setDotWidth=function(o){this.dotWidth=o},wt.setDotMargin=function(o){this.dotMargin=o},wt.hasAccidentals=function(){return this.accidentals.length!==0},wt.addAccidental=function(o){this.accidentals.push(o)},wt.setAccidentalsWidth=function(o){this.accsWidth=o},wt.getAccidentalsWidth=function(){return this.accsWidth},wt.setFlag=function(o,u){this.flag=o,this.flagWidth=u},wt.setAboveRight=function(o,u){this.aboveRight=o,this.aboveRightWidth=u},wt.setArticulation=function(o){this.articulations.push(o)},wt.setTechnical=function(o){this.technical.push(o)},wt.setOrnament=function(o){this.ornaments.push(o)},wt.setStem=function(o){this.stem=o},wt.addLegerLine=function(o){this.legerLines[o]=!0},wt.hasLegerLine=function(){return!A.Ay.isEmpty(this.legerLines)},wt.setLeftStemX=function(o){this.leftStemX=o},wt.setStemYOffset=function(o){this.stemYOffset=o},wt.setLeftHeadWidth=function(o){this.leftHeadWidth=o},wt.setRightHeadWidth=function(o){this.rightHeadWidth=o},wt.setMiddleHeadWidth=function(o){this.middleHeadWidth=o},wt.hasFretsWidth=function(){return this.fretsWidth!==null},wt.setFretsWidth=function(o){this.fretsWidth=o},wt.hasArpeggio=function(){return this.arpeggio!==null},wt.addArpeggio=function(o){this.arpeggio=o},wt.addLyric=function(o){this.lyric=o,o.setParent(this.parentSvg)},wt.hasLyric=function(){return this.lyric!==null},wt.hasRightShiftedHead=function(){return this.rightHeadWidth!==null},wt.hasLeftShiftedHead=function(){return this.leftHeadWidth!==null},wt.getRightHeadWidth=function(){return this.rightHeadWidth},wt.getLeftHeadWidth=function(){return this.leftHeadWidth},wt.getMiddleHeadWidth=function(){return this.middleHeadWidth},wt.getLeftStemX=function(){return this.leftStemX},wt.getStemYOffset=function(){return this.stemYOffset},wt.getFretsWidth=function(){return this.fretsWidth},wt.setRightArticulationsWidth=function(o){this.rightArticulationsWidth=o},wt.setLeftArticulationsWidth=function(o){this.leftArticulationsWidth=o},wt.getPreviousSpace=function(){return this.calcLeadingSpace()},wt.calcLeadingSpace=function(){let o=0,u=0;if(o+=this.getLeftHeadWidth(),this.accidentals.length>0&&(u+=this.accsWidth+this.drawingContext.getMarginSize()/2),this.hasTieStop()||this.hasHammerOnPullOffStop()?u=Math.max(u,this.drawingContext.getMinimalTieWidth()/2):this.hasArpeggio()&&(u+=this.arpeggio.getWidth()),(this.hasGlissandoStops()||this.hasSlideStops())&&(u=Math.max(u,this.drawingContext.getMinimalGlissandoWidth()/2)),this.hasLegerLine()&&(u=Math.max(u,this.drawingContext.getLegerLineExtension()-this.drawingContext.getMarginSize()/4)),this.displayData.getNoteIdx()===0&&this.hasLyric()){const H=this.lyric.getExceedingSpace()-o;u=Math.max(u,H)}this.leftArticulationsWidth!==null&&(u+=this.leftArticulationsWidth+this.drawingContext.getMarginSize()/2);const E=this.getLeadingShift();return o+u+E},wt.getLeadingShift=function(){return Math.min(0,this.horizontalShift)*-1},wt.getWidth=function(){return this.getMiddleHeadWidth()+this.calcTrailingSpace()},wt.calcTrailingSpace=function(){const o=this.getRightHeadWidth();let u=0;if(this.dots.length>0&&(u+=this.dotWidth+this.dotMargin),this.flag!==null){let H=this.flagWidth;this.displayData.getStemValue()===h.A.DOWN&&(H-=this.getMiddleHeadWidth()),u=Math.max(u,H)}(this.hasTieStart()||this.hasHammerOnPullOffStart())&&(u=Math.max(u,this.drawingContext.getMinimalTieWidth()/2)),(this.hasGlissandoStarts()||this.hasSlideStarts())&&(u=Math.max(u,this.drawingContext.getMinimalGlissandoWidth()/2)),this.aboveRight!==null&&(u=Math.max(u,this.aboveRightWidth)),this.rightArticulationsWidth!==null&&(u+=this.rightArticulationsWidth+this.drawingContext.getMarginSize()/2),this.hasLegerLine()&&(u=Math.max(u,this.drawingContext.getLegerLineExtension()-this.drawingContext.getMarginSize()/4));const E=this.getTrailingShift();return o+u+E},wt.getTrailingShift=function(){return Math.max(0,this.horizontalShift)},wt.render=function(o){this.setDrawingContext(o),this.initLocalVerticalAlignment(),this.noteDrawer=new Si(this),this.noteDrawer.drawNote(o)},wt.initLocalVerticalAlignment=function(){const u=(this.getNbStaffLines()-1)/2+1;this.localVerticalAlignment={highestY:this.lineToY(u),lowestY:this.lineToY(u),highestTupletY:this.lineToY(u),lowestTupletY:this.lineToY(u)}},wt.setDrawingContext=function(o){this.drawingContext=o},wt.setTimePos=function(o){this.timePos=o},wt.getTimePos=function(){return this.timePos},wt.draw=function(){this.move(),this.drawLyric(),this.bindToParent()},wt.drawLyric=function(){this.hasLyric()&&this.lyric.draw()},wt.bindToParent=function(){this.parentSvg&&this.parentSvg.append(this.noteSvg)},wt.unbindFromParent=function(){this.noteSvg.removeFromParent()},wt.getMarginSize=function(){return this.drawingContext.getMarginSize()},wt.setPosition=function(o){this.xPos=o,this.hasLyric()&&this.lyric.setXPos(o)},wt.move=function(){const o=this.getXPos();this.noteSvg.attr("transform",`translate(${o} 0)`)},wt.getXPos=function(){let o=this.xPos+this.horizontalShift;return this.isTabStaff()&&!this.drawingContext.hideNonTab()&&(o-=this.getTabOffset()),o},wt.getTabOffset=function(){if(this.tabOffset===null){const o=this.getDefaultHeadWidth(),u=this.getFretsWidth();this.tabOffset=(u-o)/2}return this.tabOffset},wt.getDefaultHeadWidth=function(){let u=this.drawingContext.getGlyph(so).getWidth();if(this.displayData.isGrace()){const E=this.drawingContext.getGraceSizeCoeff();u*=E}return u},wt.getDuration=function(){return this.displayData.getDuration()},wt.getVoiceIdx=function(){return this.displayData.getVoiceIdx()},wt.isRest=function(){return this.displayData.isRest()},wt.hasTieStart=function(){return this.displayData.hasTieStart()},wt.hasTieStop=function(){return this.displayData.hasTieStop()},wt.hasHammerOnPullOffStart=function(){return this.displayData.hasHammerOnPullOffStart()},wt.hasHammerOnPullOffStop=function(){return this.displayData.hasHammerOnPullOffStop()},wt.hasGlissandoStops=function(){return this.displayData.hasGlissandoStops()},wt.hasGlissandoStarts=function(){return this.displayData.hasGlissandoStarts()},wt.hasSlideStops=function(){return this.displayData.hasSlideStops()},wt.hasSlideStarts=function(){return this.displayData.hasSlideStarts()},wt.getLocalHighestY=function(){return this.localVerticalAlignment.highestY},wt.getLocalLowestY=function(){return this.localVerticalAlignment.lowestY},wt.getHighestTupletY=function(){return Math.min(this.localVerticalAlignment.highestY,this.localVerticalAlignment.highestTupletY)},wt.getLowestTupletY=function(){return Math.max(this.localVerticalAlignment.lowestY,this.localVerticalAlignment.lowestTupletY)},wt.getLocalLowestYWithMarge=function(){const o=this.drawingContext.getSpaceSize();return this.getLocalLowestY()+.5*o},wt.getLocalHighestYWithMarge=function(){const o=this.drawingContext.getSpaceSize();return this.getLocalHighestY()-.5*o},wt.getHighestYWithMarge=function(){const o=this.getHighestY(),u=this.drawingContext.getSpaceSize();return o-.5*u},wt.getHighestY=function(){return this.getVerticalAlignment().highestY},wt.getLowestYWithMarge=function(){const o=this.getLowestY(),u=this.drawingContext.getSpaceSize();return o+.5*u},wt.getLowestY=function(){return this.getVerticalAlignment().lowestY},wt.getVerticalAlignment=function(){return this.localVerticalAlignment},wt.setHighestY=function(o){const u=this.localVerticalAlignment.highestY,E=Math.min(u,o);this.localVerticalAlignment.highestY=E},wt.setHighestTupletY=function(o){this.localVerticalAlignment.highestTupletY=o},wt.setLowestTupletY=function(o){this.localVerticalAlignment.lowestTupletY=o},wt.setLowestY=function(o){const u=this.localVerticalAlignment.lowestY,E=Math.max(u,o);this.localVerticalAlignment.lowestY=E},wt.setHighestYLine=function(o){const u=this.lineToY(o);this.setHighestY(u)},wt.setLowestYLine=function(o){const u=this.lineToY(o);this.setLowestY(u)},wt.setHighestLowestY=function(o){this.setHighestY(o),this.setLowestY(o)},wt.setHighestLowestYLine=function(o){this.setHighestYLine(o),this.setLowestYLine(o)},wt.getYInfos=function(){return(0,f.default)(this.localVerticalAlignment)},wt.setLyricUpY=function(o){this.lyric.setYPos(o)},wt.getLyricLevels=function(){return this.lyric.getLevels()},wt.getLyricHeight=function(){return this.lyric.getHeight()},wt.setLyricLevelHorizontalData=function(o,u){this.lyricsHorizontalData[o]=u},wt.getLyricLevelHorizontalData=function(o){if(!this.lyricsHorizontalData[o]){const u=this.getLyricLevelWidth(o),E=this.getMiddleHeadWidth();this.lyricsHorizontalData[o]={spaceBefore:u/2-E/2,spaceAfter:u/2+E/2}}return this.lyricsHorizontalData[o]},wt.getLyricLevelWidth=function(o){return this.lyric.getLevelWidth(o)},wt.getLyricLevelPosY=function(o){return this.lyric.getLevelPosY(o)},wt.hasLyricLevel=function(o){return this.hasLyric()?this.lyric.hasLevel(o):!1},wt.getLyricBeginLevels=function(){return this.hasLyric()?this.lyric.getBeginLevels():[]},wt.getLyricEndLevels=function(){return this.hasLyric()?this.lyric.getEndLevels():[]},wt.updateVerticalDisplay=function(){this.hasLyric()&&this.lyric.move()},wt.updateHorizontalDisplay=function(){this.hasLyric()&&this.lyric.move()},wt.hasDots=function(){return this.dots.length>0},wt.setHorizontalShift=function(o){this.horizontalShift=o},wt.getHorizontalShift=function(){return this.horizontalShift};const Ao=yi},312395:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>x});var A=r(364842);const w="left",f="right",P=[w,f];function a(S){return P.includes(S)}function h(S){a(S)||m(S)}function d(S){return S===w}function l(S){return S===f}function m(S){const T=`The tempo change location [${S}] is invalid.`;throw new A.default("BadEndingLocation",T)}const x={RIGHT:f,LEFT:w,values:P,isValid:a,assert:h,isLeft:d,isRight:l,raiseError:m}},321038:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>q});var A=r(364842),w=r(269352),f=r(863426);const P=function(){this.init()};P.cssClass="pedalLine";const a=P.prototype;a.cssClass=P.cssClass,a.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.x1=0,this.x2=0,this.y1=0,this.y2=0},a.setDrawingContext=function(R){this.drawingContext=R},a.setParent=function(R){this.parent=R},a.setX1=function(R){this.x1=R,this.isRendered()&&this.line.setX1(R)},a.setX2=function(R){this.x2=R,this.isRendered()&&this.line.setX2(R)},a.setY1=function(R){this.y1=R,this.isRendered()&&this.line.setY1(R)},a.setY2=function(R){this.y2=R,this.isRendered()&&this.line.setY2(R)},a.draw=function(){this.isRendered()||this.render(),this.line.draw()},a.render=function(){if(this.isRendered())return;const p={stroke_width:this.drawingContext.getPedalLineThickness()};this.line=new f.A(this.parent,p),this.line.render(this.x1,this.y1,this.x2,this.y2)},a.isRendered=function(){return this.line!==null};const h=P,d="keyboardPedalPed",l=function(){this.init()};l.cssClass="PedalGlyph";const m=l.prototype;m.cssClass=l.cssClass,m.init=function(){this.availableSpace=null,this.drawingContext=null,this.parent=null,this.path=null,this.glyph=null,this.pathStr=null},m.setParent=function(R){this.parent=R},m.setCssClass=function(R){this.cssClass=R},m.setDrawingContext=function(R){this.drawingContext=R},m.updateHorizontalDisplay=function(R){if(this.availableSpace=R,this.isRendered()||this.render(),this.pathStr===null){const p=this.getGlyph();this.pathStr=p.render(),this.path.attr("d",this.pathStr)}this.draw()},m.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(d)),this.glyph},m.draw=function(){this.bindToParent()},m.bindToParent=function(){this.parent!==null&&this.parent.append(this.path)},m.render=function(){this.path=new w.A("path"),this.path.attr("class",this.cssClass)},m.isRendered=function(){return this.path!==null},m.getWidth=function(){return this.getGlyph().getWidth()},m.getHeight=function(){return this.getGlyph().getHeight()};const x=l;var S=r(568357);const T="adagio-pedal-uuid",Y=function(){this.init()};Y.cssClass="pedal";const G=Y.prototype;G.cssClass=Y.cssClass,G.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.sizeText=null,this.upperLine=null,this.closingLine=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},G.setParent=function(R){this.parent=R},G.setCssClass=function(R){this.cssClass=R},G.setStaffData=function(R){this.staffData=R},G.setDrawingContext=function(R){this.drawingContext=R},G.setLeftAnchor=function(R){this.hasLeftAnchor()&&this.leftAnchor!==R&&this.removeLeftAnchor(),this.leftAnchor=R,this.leftAnchor.setPedal(this)},G.hasLeftAnchor=function(){return this.leftAnchor!==null},G.removeLeftAnchor=function(){this.hide(),this.leftAnchor.pedal=null,this.leftAnchor=null},G.setRightAnchor=function(R){this.hasRightAnchor()&&this.rightAnchor!==R&&this.removeRightAnchor(),this.rightAnchor=R,this.rightAnchor.setPedal(this)},G.hasRightAnchor=function(){return this.rightAnchor!==null},G.removeRightAnchor=function(){this.hide(),this.rightAnchor.pedal=null,this.rightAnchor=null},G.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},G.hide=function(){this.drawn&&this.unbindFromParent()},G.isAbove=function(){return this.getLeftAnchor().isAbove()},G.isBelow=function(){return this.getLeftAnchor().isBelow()},G.getY=function(){return this.getLeftAnchor().getY()},G.getLeftAnchor=function(){return this.leftAnchor},G.getRightAnchor=function(){return this.rightAnchor},G.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},G.updateHorizontalDisplay=function(){this.isRendered()||this.render();let R=this.getWidth();this.sizeText.updateHorizontalDisplay(R);const p=this.sizeText.getWidth()+this.drawingContext.getPedalGlyphMargin();R=Math.max(R,p),this.upperLine.setX1(p),this.closingLine!==null&&(R=R-this.drawingContext.getMarginSize(),R=Math.max(R,p),this.closingLine.setX1(R),this.closingLine.setX2(R)),this.upperLine.setX2(R),this.posX=this.getX(),this.draw()},G.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.posY=this.getY(),this.draw()},G.draw=function(){this.isRendered()||this.render(),this.posY=this.getY();let R=this.getWidth();this.sizeText.updateHorizontalDisplay(R);const p=this.sizeText.getWidth()+this.drawingContext.getPedalGlyphMargin();R=Math.max(R,p),this.upperLine.setX1(p),this.closingLine!==null&&(R=R-this.drawingContext.getMarginSize(),R=Math.max(R,p),this.closingLine.setX1(R),this.closingLine.setX2(R)),this.upperLine.setX2(R),this.posX=this.getX(),this.upperLine.draw(),this.sizeText.draw(),this.closingLine!==null&&this.closingLine.draw(),this.move(),this.bindToParent()},G.getCssClasses=function(){const R=[this.cssClass];return this.leftAnchor.isStart()&&R.push(S.A.START),this.rightAnchor.isStop()&&R.push(S.A.STOP),R.join(" ")},G.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},G.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},G.render=function(){this.group=new w.A("g");const R=this.getCssClasses();this.group.attr("class",R);const p=this.leftAnchor.getPedalUuid();this.group.setDataEntry(T,p),this.sizeText=new x,this.sizeText.setParent(this.group),this.sizeText.setDrawingContext(this.drawingContext),this.upperLine=new h,this.upperLine.setParent(this.group),this.upperLine.setDrawingContext(this.drawingContext);const b=this.getUpperLineY();if(this.upperLine.setY1(b),this.upperLine.setY2(b),this.getRightAnchor().isStop()){const C={stroke_width:this.drawingContext.getOctaveLineThickness()};this.closingLine=new f.A(this.group,C),this.closingLine.render(0,b,0,this.getClosingLineY())}},G.getUpperLineY=function(){const R=this.getHeight();if(this.isAbove())return-(R/4*3);if(this.isBelow())return-(R/4*1);throw new A.default("Unexpected")},G.getClosingLineY=function(){const R=this.getHeight();if(this.isAbove())return 0;if(this.isBelow())return-R;throw new A.default("Unexpected")},G.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate (${this.posX}, ${this.posY})`)},G.isRendered=function(){return this.group!==null},G.getWidth=function(){const R=this.getX();return this.getRightAnchor().getX()-R},G.getHeight=function(){return this.sizeText.getHeight()},G.getX=function(){return this.getLeftAnchor().getX()},G.getY=function(){return this.getLeftAnchor().getY()},G.getGroup=function(){return this.group};const q=Y},331537:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});var A=r(364842);const w={LEFT:"left",LEFT_PENDING:"left-pending",RIGHT:"right",RIGHT_PENDING:"right-pending"};w.isRight=function(P){return P===w.RIGHT||P===w.RIGHT_PENDING},w.isLeft=function(P){return P===w.LEFT||P===w.LEFT_PENDING},w.raiseError=function(P){const a=`The melisma position [${P}] is invalid.`;throw new A.default("BadMelismaPos",a)};const f=w},339406:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>b});var A=r(354093),w=r(476943),f=r(515819),P=r(212642),a=r(589085),h=r(75861),d=r(259563),l=r(538783),m=r(364842);const x=3.5,S=2,T=2.5,Y=2,G=3,q={nbDots:0,accidentals:[],isRest:!1,hasBeam:!1,voiceIdx:0,tieStarts:[],tieStops:[],ornaments:[],frets:[],glissandoStarts:[],glissandoStops:[],slideStarts:[],slideStops:[],hammerOnPullOffStarts:[],hammerOnPullOffStops:[],staffData:a.A.createDefault(),restColor:null};function R(v){this.init(v)}const p=R.prototype;p.init=function(v){v=A.A.mergeOptions(q,v),this.opts=v,this.linesSet=w.default.arrayToSet(this.opts.lines),this.accidentals=null,this.secondHighers=null,this.lineAvg=null,this.stemQueueLine=null,this.singleNoteStemQueueLine=null,this.nbFlags=null,this.nbOrnaments=null,this.beamDisplayData=null},p.setLine=function(v){this.opts.lines=[v],this.linesSet=w.default.arrayToSet(this.opts.lines)},p.isRest=function(){return this.opts.isRest},p.isUnpitched=function(){return this.opts.isUnpitched},p.getSecondHighers=function(){return this.secondHighers===null&&this.initSecondHighers(),this.secondHighers},p.initSecondHighers=function(){this.secondHighers={},this.getStemValue()===h.A.UP?this.initSecondHighersStemUp():this.initSecondHighersStemDown()},p.initSecondHighersStemDown=function(){let v=null;this.getLines().forEach(function(C){v===null||v-C>.5?v=C:(this.secondHighers[v]=!0,v=null)}.bind(this))},p.initSecondHighersStemUp=function(){const v=this.getLines().slice(0);v.reverse();let B=null;v.forEach(function(C){B===null||C-B>.5?B=C:(this.secondHighers[C]=!0,B=null)}.bind(this))},p.hasSecond=function(){const v=this.getSecondHighers();return!w.default.isObjectEmpty(v)},p.isSecondLower=function(v){return this.hasLine(v)?!!this.getSecondHighers()[v+.5]:!1},p.hasLine=function(v){return!!this.linesSet[v]},p.isSecondHigher=function(v){return!!this.getSecondHighers()[v]},p.hasAccidentals=function(){return this.getAccidentals().length>0},p.getAccidentals=function(){return this.accidentals===null&&(this.accidentals=this.opts.accidentals,this.initAccidentals()),this.accidentals},p.initAccidentals=function(){this.accidentals.forEach(function(v){const B=v.line;v.secondHigher=this.isSecondHigher(B)},this)},p.getBaseQuarterDuration=function(){return this.opts.quarterBaseDuration},p.getDuration=function(){return this.opts.duration},p.getLines=function(){return this.opts.lines},p.getHeads=function(){return this.opts.heads},p.getStaffData=function(){return this.opts.staffData},p.getStaffIdx=function(){return this.opts.staffIdx},p.getDisplayedNbStaffLines=function(){const v=this.getStaffData();return a.A.getDisplayedNbStaffLines(v)},p.getNbStaffLines=function(){const v=this.getStaffData();return a.A.getNbStaffLines(v)},p.isNormalStaff=function(){return!this.isTabStaff()&&!this.isKodalyStaff()&&!this.isRecorderTabStaff()},p.isTabStaff=function(){const v=this.getStaffData();return a.A.isTabStaff(v)},p.isRecorderTabStaff=function(){const v=this.getStaffData();return a.A.isRecorderTabStaff(v)},p.isKodalyStaff=function(){const v=this.getStaffData();return a.A.isKodalyStaff(v)},p.isHandSign=function(){const v=this.getStaffData();return a.A.isHandSign(v)},p.getLineAvg=function(){return this.lineAvg===null&&this.calcLineAvg(),this.lineAvg},p.calcLineAvg=function(){const v=this.getLines(),B=v.reduce(function(C,_){return C+_},0);this.lineAvg=B/v.length},p.getHighestLine=function(){return this.getLines()[0]},p.getLowestLine=function(){const v=this.getLines();return v[v.length-1]},p.getFrontHeadLine=function(){const v=this.getStemValue();if(v===h.A.UP)return this.getLowestLine();if(v===h.A.DOWN)return this.getHighestLine();{let B=`base head line concept has no meanings for ${v}`;throw B+=" stem value",new m.default("InconsistentOperation",B)}},p.getTailHeadLine=function(){const v=this.getStemValue();if(v===h.A.UP)return this.getHighestLine();if(v===h.A.DOWN)return this.getLowestLine();{let B=`queue head line concept has no meanings for ${v}`;throw B+=" stem value",new m.default("InconsistentOperation",B)}},p.getStemBaseLine=function(){return this.isTabStaff()?this.getTabFretLine():this.isKodalyStaff()?4:this.getFrontHeadLine()},p.getTabFretLine=function(){const v=this.getStemValue();if(v===h.A.UP)return this.getNbStaffLines()+1;if(v===h.A.DOWN)return 0;{let B=`tab line concept has no meanings for ${v}`;throw B+=" stem value",new m.default("InconsistentOperation",B)}},p.getStemValue=function(){return this.isStemSpecified()?this.getSpecifiedStem():this.hasBeam()?this.getStemValueFromBeam():this.computeStemValueFromPitch()},p.hasBeam=function(){return this.opts.hasBeam},p.getBeams=function(){return this.opts.beams},p.setStemStrategy=function(v){this.opts.stemStrategy=v},p.getStemStrategy=function(){return this.opts.stemStrategy||l.A.AUTO},p.isStemSpecified=function(){return typeof this.opts.definedStem!="undefined"},p.getSpecifiedStem=function(){return this.opts.definedStem},p.setSpeficiedStem=function(v){this.opts.definedStem=v},p.getStemValueFromBeam=function(){return this.beamDisplayData.getStemValue()},p.computeStemValueFromPitch=function(){if(this.isKodalyStaff()||this.isGrace()||this.isUnpitched())return h.A.UP;const v=this.getLineAvg();return this.getDisplayedNbStaffLines()===1&&v===3?h.A.UP:v>=3?h.A.DOWN:h.A.UP},p.getSingleNoteStemQueueLine=function(){return this.singleNoteStemQueueLine===null&&(this.isTabStaff()?this.singleNoteStemQueueLine=this.computeTabNoteStemQueueLine():this.isKodalyStaff()?this.singleNoteStemQueueLine=this.computeKodalyNoteStemQueueLine():this.singleNoteStemQueueLine=this.computeSingleNoteStemQueueLine()),this.singleNoteStemQueueLine},p.getStemQueueLine=function(){return this.stemQueueLine===null&&this.calcStemQueueLine(),this.stemQueueLine},p.calcStemQueueLine=function(){this.beamDisplayData?this.beamDisplayData.computeStemQueueLines():this.stemQueueLine=this.getSingleNoteStemQueueLine()},p.computeSingleNoteStemQueueLine=function(){return this.isGrace()?this.computeSingleNoteStemQueueLineGrace():this.computeSingleNoteStemQueueLineNormal()},p.computeTabNoteStemQueueLine=function(){return this.isGrace()?0:this.computeTabNoteStemQueueLineNormal()},p.computeSingleNoteStemQueueLineGrace=function(){let v=S;const B=this.getNbFlagsOrBeams();if(B>Y){const F=(B-Y)/2;v+=F}const _=this.getStemDirectionCoeff()*v;return this.getTailHeadLine()+_},p.computeSingleNoteStemQueueLineNormal=function(){let v=x,B=2;const C=this.getDistanceToThirdLine();C>v&&(v=C,B+=Math.max(C-x,0));let _=0;_+=this.getNbFlagsOrBeams(),this.hasTremolo()&&(_+=this.getNbOrnaments()),_>B&&(v+=_-B);const F=this.getStemDirectionCoeff()*v;return this.getTailHeadLine()+F},p.computeTabNoteStemQueueLineNormal=function(){let B=d.default.toQuarterDuration(d.default.HALF)===this.getBaseQuarterDuration()?T/2:T;const C=this.getNbFlagsOrBeams();if(C>Y){const F=C-Y;B+=F}C>0&&!this.hasBeam()&&this.getNbDots()>0&&(B+=1);const _=this.getStemDirectionCoeff();return this.getTabFretLine()+_*B},p.computeKodalyNoteStemQueueLine=function(){let v=G;const B=this.getNbFlagsOrBeams();if(B>Y){const st=B-Y;v+=st}const C=this.getStemDirectionCoeff();return this.getStemBaseLine()+C*v},p.getDistanceToThirdLine=function(){const v=this.getStemValue(),B=this.getTailHeadLine();if(v===h.A.UP)return Math.max(Math.ceil(this.getNbStaffLines()/2),1)-B;if(v===h.A.DOWN)return B-Math.max(Math.ceil(this.getNbStaffLines()/2),1)},p.getNbFlagsOrBeams=function(){return this.opts.beams?this.opts.beams.length:this.getNbFlags()},p.getNbFlags=function(){return this.nbFlags===null&&this.calcNbFlags(),this.nbFlags},p.calcNbFlags=function(){const v=this.getBaseQuarterDuration();this.nbFlags=f.default.quarterToNbFlags(v)},p.getNbOrnaments=function(){return this.nbOrnaments===null&&this.calcNbOrnaments(),this.nbOrnaments},p.calcNbOrnaments=function(){let v=0;this.opts.ornaments.forEach(function(B){v=Math.max(v,P.A.ornamentToNbLines(B))}),this.nbOrnaments=v},p.hasTremolo=function(){return this.opts.ornaments.some(function(v){return P.A.isTremoloType(v)})},p.getArticulations=function(){return this.opts.articulations},p.hasLyrics=function(){return this.opts.lyrics.length>0},p.getLyrics=function(){return this.opts.lyrics},p.getTechnical=function(){return this.opts.technical},p.getOrnaments=function(){return this.opts.ornaments},p.getFrets=function(){return this.opts.frets},p.hasFrets=function(){return this.opts.frets.length>0},p.getStemDirectionCoeff=function(){return this.getStemValue()===h.A.UP?1:-1},p.getBeamData=function(){return this.beamDisplayData},p.setBeamData=function(v){this.beamDisplayData=v},p.getNbDots=function(){return this.opts.nbDots},p.getVoiceIdx=function(){return this.opts.voiceIdx},p.hasStem=function(){return this.getBaseQuarterDuration()<4},p.isHighestLine=function(v){return v===this.getHighestLine()},p.isLowestLine=function(v){return v===this.getLowestLine()},p.getTieStarts=function(){return this.opts.tieStarts},p.getTieStartsDirections=function(){return this.opts.tieStartsDirections},p.getTieStops=function(){return this.opts.tieStops},p.hasTieStart=function(){return this.opts.tieStarts.length>0},p.hasTieStop=function(){return this.opts.tieStops.length>0},p.getHammerOnPullOffStarts=function(){return this.opts.hammerOnPullOffStarts},p.getHammerOnPullOffStops=function(){return this.opts.hammerOnPullOffStops},p.hasHammerOnPullOffStart=function(){return this.opts.hammerOnPullOffStarts.length>0},p.hasHammerOnPullOffStop=function(){return this.opts.hammerOnPullOffStops.length>0},p.hasArpeggio=function(){return this.opts.hasArpeggio},p.isGrace=function(){return this.opts.isGrace},p.getVoiceIdx=function(){return this.opts.voiceIdx},p.hasGlissandoStarts=function(){return this.opts.glissandoStarts.length>0},p.getGlissandoStarts=function(){return this.opts.glissandoStarts},p.hasGlissandoStops=function(){return this.opts.glissandoStops.length>0},p.getGlissandoStops=function(){return this.opts.glissandoStops},p.hasSlideStarts=function(){return this.opts.slideStarts.length>0},p.getSlideStarts=function(){return this.opts.slideStarts},p.hasSlideStops=function(){return this.opts.slideStops.length>0},p.getSlideStops=function(){return this.opts.slideStops},p.getGlobalCssClassesStr=function(){return this.opts.globalCssClassesStr},p.hasFlagDash=function(){return this.opts.hasFlagDash},p.getStemStrategy=function(){return this.opts.stemStrategy},p.getFingerings=function(){return this.opts.fingerings},p.getFingeringDiagramFormula=function(){return this.opts.fingeringDiagramFormula},p.getFingeringDisplayType=function(){return this.opts.fingeringDisplayType},p.getNoteIdx=function(){return this.opts.noteIdx},p.getRestColor=function(){return this.opts.restColor},p.isSlash=function(){return this.opts.isSlash},p.isRhythmic=function(){return this.opts.isRhythmic};const b=R},367279:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(532228),f=r(726042),P=(l,m,x)=>new Promise((S,T)=>{var Y=R=>{try{q(x.next(R))}catch(p){T(p)}},G=R=>{try{q(x.throw(R))}catch(p){T(p)}},q=R=>R.done?S(R.value):Promise.resolve(R.value).then(Y,G);q((x=x.apply(l,m)).next())});const a=function(l){this.init(l)},h=a.prototype;h.init=function({scoreDataCache:l,measureRenderer:m,drawingContext:x,startMeasureIdx:S,measureNumberingPolicy:T}){this.scoreDataCache=l,this.measureRenderer=m,this.drawingContext=x,this.startMeasureIdx=S,this.measureNumberingPolicy=T,this.measuresCache=[],this.displayIdx=S,this.dataIdx=0,this.createMeasures()},h.hasRemaining=function(){return this.measuresCache.length>0},h.getMeasureNumberingPolicy=function(){return this.measureNumberingPolicy},h.getMeasureRenderer=function(){return this.measureRenderer},h.getMeasure=function(){if(this.measuresCache.length>0)return this.measuresCache.shift();throw new A.default("Unexpected","There is no more measures to fetch")},h.createMeasures=function(){const l=this.getNbMeasures();for(;this.dataIdx<l;){const m=this.createMeasure();this.measuresCache.push(m)}},h.createMeasure=function(){const l=new w.A;return l.setScoreDataCache(this.scoreDataCache),l.setDrawingContext(this.drawingContext),l.setMeasureRenderer(this.measureRenderer),l.updateDisplayIdx(this.displayIdx),l.setDataIdx(this.dataIdx),l.setMeasureNumberingPolicy(this.measureNumberingPolicy),this.dataIdx++,this.displayIdx+=l.getMeasureNumberShift(),l},h.insertMeasureToCache=function(l,m){this.checkInsertionIdx(m),this.measuresCache.splice(m,0,l)},h.checkInsertionIdx=function(l){const m=this.getNbMeasuresInCache();if(!f.default.isInteger(l)||l<0||l>m){const x=`Bad measure insertion index for cache [${l}]`;throw new A.default("BadMeasureInsertionIdx",x)}},h.removeCachedMeasure=function(l){this.checkMeasureIdx(l),this.measuresCache.splice(l,1)},h.getCachedMeasure=function(l){return this.checkMeasureIdx(l),this.measuresCache[l]},h.checkMeasureIdx=function(l){const m=this.getNbMeasuresInCache();if(!f.default.isInteger(l)||l<0||l>=m){const x=`Bad cached measure index [${l}]`;throw new A.default("BadMeasureIdx",x)}},h.getNbMeasuresInCache=function(){return this.measuresCache.length},h.getNbMeasures=function(){return this.scoreDataCache.getNbMeasures()},h.handBackMeasure=function(l){this.measuresCache.unshift(l)},h.handBackMeasures=function(l){Array.prototype.unshift.apply(this.measuresCache,l)},h.initNextMeasuresSystems=function(l){return P(this,null,function*(){const m=[];l=Math.min(l,this.getNbMeasuresInCache());for(let x=0;x<l;x++){const S=this.measuresCache[x];if(!S.areSystemsInitialized()){const T=S.initSystems();m.push(T)}}yield Promise.all(m)})};const d=a},380725:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(w,f){return w.x*f.y-w.y*f.x}},385783:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(f){const a=this.valueOf()/f.dpq;return f.entities.map(d=>w.call(a,d))}function w(f){const P=this.valueOf();return{spaceBefore:f.spaceBefore,spaceAfter:f.spaceAfter,timePos:f.timePos*P,isRest:f.isRest}}},392639:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>B});var A=r(364842),w=r(269352),f=r(863426);const P=function(){this.init()};P.cssClass="octaveShiftLine";const a=P.prototype;a.cssClass=P.cssClass,a.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.x1=0,this.x2=0,this.y1=0,this.y2=0},a.setDrawingContext=function(C){this.drawingContext=C},a.setParent=function(C){this.parent=C},a.setX1=function(C){this.x1=C,this.isRendered()&&this.line.setX1(C)},a.setX2=function(C){this.x2=C,this.isRendered()&&this.line.setX2(C)},a.setY1=function(C){this.y1=C,this.isRendered()&&this.line.setY1(C)},a.setY2=function(C){this.y2=C,this.isRendered()&&this.line.setY2(C)},a.draw=function(){this.isRendered()||this.render(),this.line.draw()},a.render=function(){if(this.isRendered())return;const C=this.drawingContext.getOctaveLineThickness(),_=this.drawingContext.getOctaveShiftDashArrayWidth(),st={stroke_width:C,stroke_dasharray:[_,_/3]};this.line=new f.A(this.parent,st),this.line.render(this.x1,this.y1,this.x2,this.y2)},a.isRendered=function(){return this.line!==null};const h=P;var d=r(723631),l=r(773948),m=r(843678);const x=function(C,_){return`${C}-${_}`},S=m.default.fromPairs([{key:x(l.A.EIGHT,d.A.ABOVE),value:"ottavaAlta"},{key:x(l.A.EIGHT,d.A.BELOW),value:"ottavaBassaBa"},{key:x(l.A.FIFTEEN,d.A.ABOVE),value:"quindicesimaAlta"},{key:x(l.A.FIFTEEN,d.A.BELOW),value:"quindicesimaBassa"},{key:x(l.A.TWENTY_TWO,d.A.ABOVE),value:"ventiduesimaAlta"},{key:x(l.A.TWENTY_TWO,d.A.BELOW),value:"ventiduesimaBassa"}]),T=function(C,_){this.init(C,_)};T.cssClass="OctaveShiftText";const Y=T.prototype;Y.cssClass=T.cssClass,Y.init=function(C,_){this.leftAnchor=null,this.rightAnchor=null,this.availableSpace=null,this.drawingContext=null,this.parent=null,this.path=null,this.glyphId=G(C,_),this.glyph=null,this.pathStr=null};const G=function(C,_){const st=x(C,_);if(typeof S[st]=="undefined"){const F=`There is no glyph for the ottava size [${C}] and the placement [${_}].`;throw new A.default("Unexpected",F)}else return S[st]};Y.setParent=function(C){this.parent=C},Y.setCssClass=function(C){this.cssClass=C},Y.setDrawingContext=function(C){this.drawingContext=C},Y.updateHorizontalDisplay=function(C){if(this.availableSpace=C,this.isRendered()||this.render(),this.pathStr===null){const _=this.getGlyph();this.pathStr=_.render(),this.path.attr("d",this.pathStr)}this.draw()},Y.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph},Y.draw=function(){this.bindToParent()},Y.bindToParent=function(){this.parent!==null&&this.parent.append(this.path)},Y.render=function(){this.path=new w.A("path"),this.path.attr("class",this.cssClass)},Y.isRendered=function(){return this.path!==null},Y.getWidth=function(){return this.getGlyph().getWidth()},Y.getHeight=function(){return this.getGlyph().getHeight()};const q=T;var R=r(568357);const p="adagio-octaveShift-uuid",b=function(){this.init()};b.cssClass="octaveShift";const v=b.prototype;v.cssClass=b.cssClass,v.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.sizeText=null,this.upperLine=null,this.closingLine=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},v.setParent=function(C){this.parent=C},v.setCssClass=function(C){this.cssClass=C},v.setStaffData=function(C){this.staffData=C},v.setDrawingContext=function(C){this.drawingContext=C},v.setLeftAnchor=function(C){this.hasLeftAnchor()&&this.leftAnchor!==C&&this.removeLeftAnchor(),this.leftAnchor=C,this.leftAnchor.setOctaveShift(this)},v.hasLeftAnchor=function(){return this.leftAnchor!==null},v.removeLeftAnchor=function(){this.hide(),this.leftAnchor.octaveShift=null,this.leftAnchor=null},v.setRightAnchor=function(C){this.hasRightAnchor()&&this.rightAnchor!==C&&this.removeRightAnchor(),this.rightAnchor=C,this.rightAnchor.setOctaveShift(this)},v.hasRightAnchor=function(){return this.rightAnchor!==null},v.removeRightAnchor=function(){this.hide(),this.rightAnchor.octaveShift=null,this.rightAnchor=null},v.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},v.hide=function(){this.drawn&&this.unbindFromParent()},v.isAbove=function(){return this.getLeftAnchor().isAbove()},v.isBelow=function(){return this.getLeftAnchor().isBelow()},v.getY=function(){return this.getLeftAnchor().getY()},v.getLeftAnchor=function(){return this.leftAnchor},v.getRightAnchor=function(){return this.rightAnchor},v.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},v.updateHorizontalDisplay=function(){this.isRendered()||this.render();let C=this.getWidth();this.sizeText.updateHorizontalDisplay(C);const _=this.sizeText.getWidth()+this.drawingContext.getOctaveShiftTextMargin();this.upperLine.setX1(_),this.closingLine!==null&&(C=C-this.drawingContext.getMarginSize(),this.closingLine.setX1(C),this.closingLine.setX2(C)),this.upperLine.setX2(C),this.posX=this.getX(),this.draw()},v.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.posY=this.getY(),this.draw()},v.draw=function(){this.isRendered()||this.render();let C=this.getWidth();this.sizeText.updateHorizontalDisplay(C);const _=this.sizeText.getWidth()+this.drawingContext.getOctaveShiftTextMargin();this.upperLine.setX1(_),this.closingLine!==null&&(C=C-this.drawingContext.getMarginSize(),this.closingLine.setX1(C),this.closingLine.setX2(C)),this.upperLine.setX2(C),this.posX=this.getX(),this.posY=this.getY(),this.upperLine.draw(),this.sizeText.draw(),this.closingLine!==null&&this.closingLine.draw(),this.move(),this.bindToParent()},v.getCssClasses=function(){const C=[this.cssClass];return this.leftAnchor.isStart()&&C.push(R.A.START),this.rightAnchor.isStop()&&C.push(R.A.STOP),C.join(" ")},v.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},v.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},v.render=function(){this.group=new w.A("g");const C=this.getCssClasses();this.group.attr("class",C);const _=this.getLeftAnchor(),st=_.getOctaveShiftUuid();this.group.setDataEntry(p,st);const F=_.getSize(),L=_.getPlacement();this.sizeText=new q(F,L),this.sizeText.setParent(this.group),this.sizeText.setDrawingContext(this.drawingContext),this.upperLine=new h,this.upperLine.setParent(this.group),this.upperLine.setDrawingContext(this.drawingContext);const I=this.getUpperLineY();if(this.upperLine.setY1(I),this.upperLine.setY2(I),this.getRightAnchor().isStop()){const it={stroke_width:this.drawingContext.getOctaveLineThickness()};this.closingLine=new f.A(this.group,it),this.closingLine.render(0,I,0,this.getClosingLineY())}},v.getUpperLineY=function(){const C=this.getHeight();if(this.isAbove())return-(C/4*3);if(this.isBelow())return-(C/4*1);throw new A.default("Unexpected")},v.getClosingLineY=function(){const C=this.getHeight();if(this.isAbove())return 0;if(this.isBelow())return-C;throw new A.default("Unexpected")},v.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate (${this.posX}, ${this.posY})`)},v.isRendered=function(){return this.group!==null},v.getWidth=function(){const C=this.getX();return this.getRightAnchor().getX()-C},v.getHeight=function(){return this.sizeText.getHeight()},v.getX=function(){return this.getLeftAnchor().getX()},v.getY=function(){return this.getLeftAnchor().getY()},v.getGroup=function(){return this.group};const B=b},398719:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(35802),w=r(515819),f=r(701387),P=r(721247),a=r(377180);const h=a.default.createDefault();class d{constructor(x,S){Object.defineProperty(this,"attrs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"measure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"displayOpts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clefs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"staffsDetails",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"times",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transposes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nbDivisions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.attrs=f.default.getAttributes(x),this.measure=x,this.displayOpts=S,this.clefs=null,this.staffsDetails=null,this.keys=null,this.times=null,this.transposes=null,this.nbDivisions=null}getDpq(){return A.default.getDpq(this.attrs)}getClefAtTimePos(x,S){const T=this.getClef(x);if(!T)throw new Error("No clef found in the measure.");if(!f.default.hasMiddleClefs(this.measure,x))return T;const Y=f.default.getMiddleClefs(this.measure,x),G={clef:T,timePos:S};return Y.some(l,G),G.clef}getLastClef(x){const S=f.default.getMiddleClefs(this.measure,x);return S.length===0?this.getClef(x):S[S.length-1]}getClef(x){return this.getClefs().getEntry(x)}getClefs(){return this.clefs===null&&(this.clefs=A.default.getWrappedClef(this.attrs)),this.clefs}getStaffDetails(x){return this.getStaffsDetails().getEntry(x)}getStaffsDetails(){return this.staffsDetails===null&&(this.staffsDetails=A.default.getWrappedStaffDetailsOrDefault(this.attrs)),this.staffsDetails}getKey(x){return this.getKeys().getEntry(x)}getKeys(){return this.keys===null&&(this.keys=A.default.getWrappedKey(this.attrs)),this.keys}getAnyTime(){return this.getTimes().getAnyEntry()}getTimes(){return this.times===null&&(this.times=A.default.getWrappedTime(this.attrs)),this.times}getTranspose(x){return this.displayOpts.isConcertPitch?h:this.getTransposes().getEntry(x)}getTransposes(){return this.transposes===null&&(this.transposes=A.default.getWrappedTranspose(this.attrs)),this.transposes}getNbDivisions(){if(this.nbDivisions===null){const x=this.getAnyTime(),S=this.getDpq(),T=w.default.timeToQuarter(x);this.nbDivisions=w.default.quarterToDivisions(T,S)}return this.nbDivisions}getNbStaves(){return A.default.getNbStaves(this.attrs)}}function l(m){const x=this;if(P.default.getTimePos(m)<=x.timePos)x.clef=m;else return!0}},403006:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>V});var A=r(351277);const w=["A","B","C","D","E","F","G"],f=["F","G","A","B","C","D","E"],P=["F","C","G","D","A","E","B"],a=["B","E","A","D","G","C","F"],h=.5,d=5.5,m=w.length/2;function x(it,Pt){return Pt===0?[]:Pt>0?S(it):Y(it)}function S(it){let Pt=R(it);F(Pt)||(Pt=Pt.concat(p(it)));const Yt=I(Pt);return T(Yt)}function T(it){return q(it,P)}function Y(it){let Pt=p(it);F(Pt)||(Pt=Pt.concat(R(it)));const Yt=I(Pt);return G(Yt)}function G(it){return q(it,a)}function q(it,Pt){const Yt=it.originLine,Bt=it.scale;return Pt.map(function(ie){const K=B(Bt,ie);return Yt+K})}function R(it){return b(it,w)}function p(it){return b(it,f)}function b(it,Pt){const Yt=[];let Bt=v(it,Pt);Yt.push(Bt);do Bt=C(Bt),Yt.push(Bt);while(Bt.excedentLines===0);return Yt}function v(it,Pt){const Yt=A.default.lineToPitch(h,it),Bt=A.default.getStep(Yt),le=B(Pt,Bt),K={originLine:h-le,scale:Pt,excedentLines:0};return st(K),K}function B(it,Pt){return it.indexOf(Pt)/2}function C(it){return it=_(it),it.originLine+=m,st(it),it}function _(it){return{scale:it.scale,originLine:it.originLine,excedentLines:it.excedentLines}}function st(it){const Pt=it.originLine+m-.5;it.originLine<h?it.excedentLines=h-it.originLine:Pt>d?it.excedentLines=Pt-h:it.excedentLines=0}function F(it){return it.some(L)}function L(it){return it.excedentLines===0}function I(it){return it.reduce(W)}function W(it,Pt){return Pt.excedentLines<it.excedentLines?Pt:it}const V={getLines:x}},403521:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});const A=function(){this.init()},w=A.prototype;w.init=function(){this.leftNote=null,this.rightNote=null},w.setLeftNote=function(P){this.leftNote=P},w.setRightNote=function(P){this.rightNote=P},w.hasLeftNote=function(){return this.leftNote!==null},w.hasRightNote=function(){return this.rightNote!==null},w.getGlissandoStarts=function(){return this.hasLeftNote()?this.leftNote.getGlissandoStarts():[]},w.getGlissandoStops=function(){return this.hasRightNote()?this.rightNote.getGlissandoStops():[]},w.getNbStaffLines=function(){return this.leftNote.getNbStaffLines()};const f=A},405676:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>B});var A=r(269352),w=r(726042),f=r(843678),P=r(902630),a=r(171882),h=r(100673);const d=.8,l=.75,m=1,x=.3,S=.33,T="fretboardX",Y="fretboardO",G="fretboardFilledCircle",q=function(C){this.init(C)};q.CSS_CLASS="tabFrame";const R=q.prototype;R.init=function(C){this.cssClass=q.CSS_CLASS,this.frameData=C,this.drawingContext=null,this.group=null,this.parent=null,this.width=null,this.height=null,this.text=null,this.maxGlyphHeight=null,this.maxGlyphWidth=null,this.posX=0,this.posY=0},R.setDrawingContext=function(C){this.drawingContext=C},R.setParent=function(C){this.parent=C},R.setPosY=function(C){this.posY=C},R.setPosX=function(C){this.posX=C},R.bindToParent=function(){this.parent.append(this.group)},R.draw=function(){this.render(),this.bindToParent(),this.move()},R.render=function(){this.group===null&&(this.group=new A.A("g"),this.group.attr("class",this.cssClass),this.drawVerticalLines(),this.drawHorizontalLines(),this.drawNotes(),this.drawBarres(),this.drawFirstFret())},R.move=function(){const C=this.getLeftPadding(),_=this.posX+C,st=this.posY;this.group.attr("transform",`translate(${_}, ${st})`)},R.drawVerticalLines=function(){const C=this.drawingContext.getSpaceSize(),_=P.default.getNbStrings(this.frameData),st=P.default.getNbFrets(this.frameData),F=C*m,L=C*l,I=this.drawingContext.getStemThickness();let W=F*st;P.default.getFirstFret(this.frameData)>1&&(W+=F*S);for(let V=0;V<_;V++){const it=this.group.append("line"),Pt=V*L,Yt=0,Bt=-W;it.attr("x1",Pt),it.attr("x2",Pt),it.attr("y1",Yt),it.attr("y2",Bt),it.attr("stroke-width",I)}},R.drawHorizontalLines=function(){const C=this.drawingContext.getSpaceSize(),_=P.default.getNbStrings(this.frameData),st=P.default.getNbFrets(this.frameData),F=C*m,L=C*l,I=this.drawingContext.getStemThickness(),W=I*2,V=L*(_-1);for(let it=0;it<=st;it++){const Pt=this.group.append("line");let Yt=-it*F,Bt=-I/2,le=V+I/2;it<st?Pt.attr("stroke-width",I):P.default.getFirstFret(this.frameData)===1?(Pt.attr("stroke-width",W),Bt-=W,le+=W,Yt-=(W-I)/2):Pt.attr("stroke-width",I),Pt.attr("x1",Bt),Pt.attr("x2",le),Pt.attr("y1",Yt),Pt.attr("y2",Yt)}},R.drawNotes=function(){const C=P.default.getNbStrings(this.frameData),_=p(C);P.default.getNotes(this.frameData).forEach(F=>{const L=a.A.getString(F);_[L]=F}),f.default.forEach(_,this.drawNote,this)};function p(C){const _={};for(let st=1;st<=C;st++)_[st]=null;return _}R.drawNote=function(C,_){const st=this.getGlyph(_),F=this.getNoteX(C),L=this.getNoteY(_,st),I=this.group.append("path");I.attr("d",st.render()),I.attr("transform",`translate(${F}, ${L})`)},R.getGlyph=function(C){let _;return C===null?_=T:a.A.getFret(C)===0?_=Y:_=G,this.drawingContext.getGlyph(_)},R.drawBarres=function(){const C={};P.default.getNotes(this.frameData).forEach(st=>{if(!a.A.hasBarre(st))return;const F=a.A.getFret(st);let L=C[F];typeof L=="undefined"&&(L={startNote:null,stopNote:null,fret:F},C[F]=L),a.A.hasBarreStart(st)?L.startNote=st:a.A.hasBarreStop(st)&&(L.stopNote=st)}),f.default.forEach(C,this.drawBarre,this)},R.drawBarre=function(C,_){if(_.startNote===null||_.stopNote===null)return;const st=this.getGlyph(_.startNote),F=this.getNoteY(_.startNote),L=a.A.getString(_.startNote),I=this.getNoteX(L),W=a.A.getString(_.stopNote),V=this.getNoteX(W),it=this.group.append("line");it.attr("x1",I),it.attr("x2",V),it.attr("y1",F),it.attr("y2",F),it.attr("stroke-width",st.getHeight())},R.drawFirstFret=function(){if(P.default.getFirstFret(this.frameData)===1)return;const _=this.getText(),st=-this.getLeftPadding(),F=P.default.getNbFrets(this.frameData),L=this.drawingContext.getSpaceSize(),I=L*m,W=-((F-.5)*I-L*d/2);_.setPosition(st,W),_.setParent(this.group),_.render(),_.draw(),_.move()},R.getText=function(){if(this.text===null){const C=P.default.getFirstFret(this.frameData),_=new h.A({text:C.toString()});_.setDrawingContext(this.drawingContext);const st=this.drawingContext.getSpaceSize();_.setFontSize(st*d);const F=this.drawingContext.getHarmonyFontFamily();_.options["font-family"]=F,this.text=_}return this.text},R.getNoteX=function(C){C=parseInt(C,10);const _=P.default.getNbStrings(this.frameData),F=this.drawingContext.getSpaceSize()*l;return(_-C)*F},R.getNoteY=function(C,_){const st=P.default.getNbFrets(this.frameData),L=this.drawingContext.getSpaceSize()*m;if(C===null||a.A.getFret(C)===0){let Pt=L*(st+x)+_.getHeight()/2;return P.default.getFirstFret(this.frameData)>1&&(Pt+=L*S),-Pt}const I=P.default.getFirstFret(this.frameData),V=a.A.getFret(C)+1-I;return-((st+.5-V)*L)},R.getWidth=function(){if(this.width===null){const C=this.getMaxGlyphWidth(),_=P.default.getNbStrings(this.frameData),F=this.drawingContext.getSpaceSize()*l,L=this.getLeftPadding(),I=C/2;this.width=L+(_-1)*F+I}return this.width},R.getLeftPadding=function(){const C=P.default.getFirstFret(this.frameData),_=this.getMaxGlyphHeight();let st=_/2;if(C>1){const F=this.getText();st+=F.getWidth()+_/2}return st};function b(C){return C.getWidth()}R.getHeight=function(){if(this.height===null){const C=this.getMaxGlyphHeight(),_=P.default.getNbFrets(this.frameData),F=this.drawingContext.getSpaceSize()*m;this.height=C+(_+x)*F,P.default.getFirstFret(this.frameData)>1&&(this.height+=F*S);const L=this.drawingContext.getStemThickness();if(this.height+=L/2,P.default.getFirstFret(this.frameData)===1){const I=L*2;this.height+=I/2}else this.height+=L/2}return this.height},R.getBottomLineOffset=function(){return this.drawingContext.getStemThickness()/2},R.getMaxGlyphHeight=function(){return this.maxGlyphHeight===null&&(this.maxGlyphHeight=[T,Y].map(this.drawingContext.getGlyph,this.drawingContext).map(v).reduce(w.default.min2)),this.maxGlyphHeight},R.getMaxGlyphWidth=function(){return this.maxGlyphWidth===null&&(this.maxGlyphWidth=[T,Y,G].map(this.drawingContext.getGlyph,this.drawingContext).map(b).reduce(w.default.min2)),this.maxGlyphWidth},R.drawRects=function(){const C=P.default.getNbFrets(this.frameData),_=P.default.getNbStrings(this.frameData),st=P.default.getFirstFret(this.frameData),F=this.drawingContext.getGlyph(G);for(let L=0;L<_;L++)for(let I=0;I<=C;I++){const W=(L+1).toString();let V=I;V>0&&(V+=st-1),V=V.toString();const it={fret:V};let Pt=this.getNoteX(W),Yt=this.getNoteY(it,F);Yt-=F.getHeight()/2,Pt-=F.getWidth()/2;const Bt=this.group.append("rect");Bt.attr("width",F.getWidth()),Bt.attr("height",F.getHeight()),Bt.attr("x",Pt),Bt.attr("y",Yt),Bt.setDataEntry("string",W),Bt.setDataEntry("fret",V),Bt.style("opacity","0")}};function v(C){return C.getHeight()}const B=q},409241:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>S});var A=r(269352),w=r(726042);const f="adagio-harmony-uuid",P=function(T){this.init(T)};P.JAZZ_CSS_CLASS="chord",P.CLASSIC_CSS_CLASS="classicChord",P.NAME=P.JAZZ_CSS_CLASS;const a=P.prototype;a.name=P.NAME,a.init=function(T){this.cssClass=T||P.NAME,this.group=null,this.textGroup=null,this.parent=null,this.drawingContext=null,this.symbols=[],this.timePos=null,this.posX=null,this.posY=null,this.width=null,this.spaceBelow=null,this.spaceAbove=null,this.frame=null},a.setHarmonyUuid=function(T){this.harmonyUuid=T},a.setTimePos=function(T){this.timePos=T},a.setParent=function(T){this.parent=T},a.setPosX=function(T){this.posX=T},a.setPosY=function(T){this.posY=T},a.addSymbol=function(T){this.symbols.push(T)},a.setDrawingContext=function(T){this.drawingContext=T,this.symbols.forEach(this.transferDrawingContext,this),this.hasFrame()&&this.frame.setDrawingContext(this.drawingContext)},a.transferDrawingContext=function(T){T.setDrawingContext(this.drawingContext)},a.setFrame=function(T){this.frame=T},a.draw=function(){this.isRendered()||(this.render(),this.format()),this.drawContent(),this.move(),this.bindToParent()},a.isRendered=function(){return this.group!==null},a.render=function(){this.group=new A.A("g"),this.textGroup=this.group.append("g"),this.textGroup.attr("class",this.cssClass),this.symbols.forEach(this.transferParent,this),this.hasFrame()&&(this.frame.setParent(this.group),this.frame.render()),this.harmonyUuid!==null&&(this.textGroup.setDataEntry(f,this.harmonyUuid),this.group.setDataEntry(f,this.harmonyUuid))},a.transferParent=function(T){T.setParent(this.textGroup)},a.format=function(){this.formatVertical(),this.formatHorizontal()},a.formatVertical=function(){if(this.symbols.forEach(this.transferPosY,this),this.hasFrame()){const T=this.getSpaceAbove(),Y=this.frame.getHeight(),G=this.drawingContext.getMarginSize(),q=T+Y+G;this.frame.setPosY(q)}},a.transferPosY=function(T){const Y=this.getSpaceAbove();if(T.setPosY(Y),this.hasFrame()){const G=this.frame.getLeftPadding();this.frame.setPosX(-G)}},a.formatHorizontal=function(){this.symbols.reduce(h,0)};const h=function(T,Y){Y.setPosX(T);const G=Y.getWidth();return T+G};a.drawContent=function(){this.symbols.forEach(d),this.hasFrame()&&this.frame.draw()};const d=function(T){T.draw()};a.move=function(){this.isRendered()&&this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate(${this.posX}, ${this.posY})`)},a.bindToParent=function(){this.parent.append(this.group)},a.getWidth=function(){if(this.width===null){const T=this.symbols.map(l);if(this.width=T.reduce(w.default.add,0),this.frame){const Y=this.frame.getWidth();this.width=Math.max(Y,this.width)}}return this.width};const l=function(T){return T.getWidth()};a.getHeight=function(){const T=this.getSpaceAbove(),Y=this.getSpaceBelow();return T+Y},a.getSpaceAbove=function(){if(this.spaceAbove===null){const T=this.symbols.map(m);this.spaceAbove=T.reduce(w.default.max2,0)}return this.spaceAbove};const m=function(T){return T.getSpaceAbove()};a.getSpaceBelow=function(){if(this.spaceBelow===null){const T=this.symbols.map(x);this.spaceBelow=T.reduce(w.default.max2,0),this.hasFrame()&&(this.spaceBelow+=this.frame.getHeight()+this.drawingContext.getMarginSize())}return this.spaceBelow},a.hasFrame=function(){return this.frame!==null},a.getTimePos=function(){return this.timePos};const x=function(T){return T.getSpaceBelow()},S=P},410199:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});var A=r(364842);const w={LEFT:"left",MIDDLE:"middle",RIGHT:"right"};w.raiseError=function(P){const a=`The hyphen position [${P}] is invalid.`;throw new A.default("BadHyphenPos",a)};const f=w},435648:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>F});var A=r(701387),w=r(123491),f=r(706650),P=r(843678),a=r(668674),h=r(351277),d=r(515819),l=r(209175),m=r(721247),x=r(104907),S=r(292681),T=r(414787),Y=r(353922),G=r(759240);const q=3,R={};R.canShape=function(L){const I=A.default.getNbStaves(L);for(let W=0;W<I;W++)if(A.default.hasSlash(L,W))return!0;return!1},R.shapeMeasure=function(L){let I=A.default.getNotes(L),W=p(I);return W=P.default.map(W,v,L),W=P.default.getValues(W),I=Array.prototype.concat.apply([],W),A.default.setNotes(L,I),L};function p(L){const I={};return L.forEach(b,I),I}function b(L){const I=this,W=w.default.getStaffIdx(L);typeof I[W]=="undefined"&&(I[W]=[]),I[W].push(L)}function v(L,I){const W=this;if(L=parseInt(L,10),!A.default.hasSlash(W,L))return I;const V=A.default.getSlash(W,L);return a.A.isUsingStems(V)?I=B(I,W):I=st(W,I),I}function B(L,I){const W=A.default.getWrappedClef(I),V=A.default.getWrappedStaffDetailsOrDefault(I),it={wrappedClef:W,wrappedStaffDetails:V},[Pt]=L,Yt=w.default.getVoiceIdx(Pt);return L=L.filter(C,Yt),L.forEach(_,it),L}function C(L){const I=this.valueOf();return!(w.default.getVoiceIdx(L)!==I||w.default.isChord(L)||w.default.isGraceNote(L))}function _(L){if(w.default.isRest(L))return;const I=this,W=w.default.getStaffIdx(L);if(w.default.hasPitch(L)){const it=I.wrappedClef.getEntry(W),Pt=h.default.lineToPitch(q,it);w.default.setPitch(L,Pt),w.default.removeAccidental(L)}else{const it=I.wrappedStaffDetails.getEntry(W),Pt=x.default.getNbStaffLines(it),Yt=T.A.lineToPitch(q,Pt);w.default.setUnpitched(L,Yt)}w.default.removeTie(L),L.isRhythmic=!0;const V=w.default.getNotations(L);f.A.setArticulations(V,{}),f.A.setOrnaments(V,{}),f.A.setTechnical(V,{}),w.default.setNotations(L,V),w.default.getHead(L)===Y.A.X?w.default.setHead(L,Y.A.BIG_X):w.default.setHead(L,Y.A.SLASH)}function st(L,I){const[W]=I,V=w.default.getVoiceIdx(W),it=w.default.getStaffIdx(W),Pt=A.default.getWrappedClef(L);let Yt=null,Bt=null;const le=Pt.getEntry(it);if(m.default.isPercussion(le)){const At=A.default.getWrappedStaffDetailsOrDefault(L).getEntry(it),Ht=x.default.getNbStaffLines(At);Bt=T.A.lineToPitch(q,Ht)}else Yt=h.default.lineToPitch(q,le);const ie=A.default.getDpq(L),K=A.default.getAnyTime(L),pe=d.default.getBeatQuarterDuration(K),Ee=d.default.quarterToDuration(pe,ie),tt=l.default.createDefault(),Et=A.default.getNbDivisions(L),Vt=new G.A(0,Et,Ee,ie,tt);return Vt.dispatch(),Vt.getDispatchedRests().map(gt=>{const At=d.default.actualDivisionsToDurationOpts(gt,ie,tt),Ht={};if(w.default.setStaffIdx(Ht,it),w.default.setVoiceIdx(Ht,V),Yt){const Wt=h.default.copy(Yt);w.default.setPitch(Ht,Wt)}else{const Wt=S.default.copy(Bt);w.default.setUnpitched(Ht,Wt)}return w.default.setNbDots(Ht,At.nbDots),w.default.setDuration(Ht,gt),w.default.setHead(Ht,Y.A.SLASH),Ht.isSlash=!0,Ht})}const F=R},443838:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>m});var A=r(364842),w=r(574626),f=r(995677),P=r(723631),a=r(612040),h=r(63254);const d=function(x,S,T,Y,G){this.init(x,S,T,Y,G)},l=d.prototype;l.init=function(x,S,T,Y,G){this.measure=null,this.wedge=null,this.wedgeUuid=G||null,this.measureIdx=null,this.type=x,this.placement=S,this.location=T,this.drawingContext=null,this.horizontalOffset=0,this.timePosition=typeof Y!="undefined"?Y:null},l.setMeasure=function(x){this.measure=x},l.isAbove=function(){return this.getPlacement()===P.A.ABOVE},l.isBelow=function(){return this.getPlacement()===P.A.BELOW},l.getPlacement=function(){return this.placement},l.getTimePos=function(){return this.timePosition},l.getHorizontalPosition=function(){if(this.location===a.A.LEFT)return h.A.WEDGE_START;if(this.location===a.A.RIGHT)return h.A.WEDGE_STOP;throw new A.default("Unexpected")},l.setDrawingContext=function(x){this.drawingContext=x},l.getDrawingContext=function(){return this.drawingContext},l.getWidth=function(){return 0},l.getSpaceBefore=function(){return 0},l.getX=function(){if(this.location===a.A.LEFT_CONTINUE)return this.getLeftX();if(this.location===a.A.RIGHT_CONTINUE)return this.getRightX();if(this.isMiddle())return this.getMiddleX();a.A.raiseError(this.location)},l.isMiddle=function(){return a.A.isMiddle(this.location)},l.getLeftX=function(){const x=this.measure.tickableContent;return this.measure.getXPos()+x.getXPos()-x.getPreviousSpace()},l.getRightX=function(){const x=this.measure,S=x.tickableContent;return x.getXPos()+S.getXPos()+S.getWidth()},l.getMiddleX=function(){if(this.timePosition===null){const G="Cannot compute a middleX position without time position";throw new A.default("Unexpected",G)}const x=this.measure,S=x.tickableContent;let Y=x.getXPos()+S.getXPos()+this.horizontalOffset+S.timePosToX(this.timePosition);return this.location===a.A.RIGHT&&(Y-=this.drawingContext.getSpaceSize()),Y},l.getY=function(){if(this.isAbove())return this.measure.getUpDynamicsY();if(this.isBelow())return this.measure.getDownDynamicsY();throw new A.default("Unexpected")},l.getSpreadType=function(){if(this.isSpreadOpen())return w.A.OPEN;if(this.isSpreadOpenContinue())return w.A.OPEN_CONTINUE;if(this.isSpreadClose())return w.A.CLOSED;if(this.isSpreadCloseContinue())return w.A.CLOSED_CONTINUE;{const x=`The combination of the wedge location [${this.location}] and the type [${this.type}] is unexpected.`;throw new A.default("Unexpected",x)}},l.isSpreadOpen=function(){return this.location===a.A.LEFT&&this.type===f.A.DIMINUENDO||this.location===a.A.RIGHT&&this.type===f.A.CRESCENDO},l.isSpreadOpenContinue=function(){return this.location===a.A.LEFT_CONTINUE&&this.type===f.A.DIMINUENDO||this.location===a.A.RIGHT_CONTINUE&&this.type===f.A.CRESCENDO},l.isSpreadClose=function(){return this.location===a.A.LEFT&&this.type===f.A.CRESCENDO||this.location===a.A.RIGHT&&this.type===f.A.DIMINUENDO},l.isSpreadCloseContinue=function(){return this.location===a.A.LEFT_CONTINUE&&this.type===f.A.CRESCENDO||this.location===a.A.RIGHT_CONTINUE&&this.type===f.A.DIMINUENDO},l.hasWedge=function(){return this.wedge!==null},l.isLeft=function(){return a.A.isLeft(this.location)},l.isRight=function(){return a.A.isRight(this.location)},l.setWedge=function(x){this.wedge=x},l.getWedge=function(){return this.wedge},l.removeWedge=function(){this.isLeft()?this.wedge.removeLeftAnchor():this.isRight()?this.wedge.removeRightAnchor():a.A.raiseError(this.location)},l.setNeedDrawUpdate=function(){this.hasWedge()&&this.getWedge().setNeedDrawUpdate()},l.setHorizontalOffset=function(x){this.horizontalOffset=x},l.setMeasureIdx=function(x){this.measureIdx=x},l.getMeasureIdx=function(){return this.measureIdx},l.getWedgeUuid=function(){return this.wedgeUuid},l.getLocation=function(){return this.location};const m=d},453557:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>p});var A=r(701387),w=r(518558),f=r(377180),P=r(364596),a=r(721247),h=r(54949),d=r(411993),l=r(104907),m=r(123491),x=r(737903),S=r(476943),T=r(843678);const Y={};Y.canShape=function(b){if(A.default.getNbStaves(b)>1)return!1;const B=A.default.getStaffDetails(b)[0];return!!l.default.hasRecorderTabs(B)},Y.shapeMeasure=function(b){const v=A.default.getNbStaves(b),B=0,C=A.default.getWrappedStaffDetailsOrDefault(b);return G(b,v,B,C),b};function G(b,v,B,C){const _=C.getEntry(B),st=l.default.copy(_);l.default.removeRecorderTabs(_),l.default.setNbStaffLines(st,5),C.insertEntry(st,B+1);const F=C.dumpAttribute();A.default.setStaffDetails(b,F);const L=A.default.getWrappedTime(b);let I=L.getEntry(B);I=w.default.copy(I),L.insertEntry(I,B+1);const W=L.dumpAttribute();A.default.setTime(b,W);const V=A.default.getWrappedTranspose(b);let it=V.getEntry(B);it=f.default.copy(it),V.insertEntry(it,B+1);const Pt=V.dumpAttribute();A.default.setTranspose(b,Pt);const Yt=A.default.getWrappedKey(b);let Bt=Yt.getEntry(B);Bt=P.default.copy(Bt),Yt.insertEntry(Bt,B+1);const le=Yt.dumpAttribute();A.default.setKey(b,le);const ie=A.default.getWrappedClef(b);let K=ie.getEntry(B);K=a.default.copy(K),ie.insertEntry(K,B+1);const pe=ie.dumpAttribute();A.default.setClef(b,pe);let Ee=A.default.getNotes(b),tt=Ee.filter(R);tt=h.A.groupStaves(tt)[B],tt=T.default.getAnyValue(d.A.groupVoices(tt)),tt=S.default.isArray(tt)?tt.map(q,{staffIdx:B+1,staffDetails:st,key:Yt.getEntry(B+1)}):[],Ee=Ee.concat(tt),A.default.setNotes(b,Ee),A.default.setNbStaves(b,v+1)}const q=function(b){return b=(0,x.default)(b),m.default.setStaffIdx(b,this.staffIdx),m.default.hasTieStop(b)&&(m.default.removeChordData(b),m.default.setRest(b,m.default.createRest())),b};function R(b){return!m.default.isChord(b)}const p=Y},454921:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(911066),w=r(399564),f=r(756710);function P(a,h){const d=h.getNotesColorMode();if(typeof a.notesSpacingCoeff=="undefined"&&(a.notesSpacingCoeff=h.getNotesSpacingCoeff()),typeof a.spaceBetweenStavesRatio=="undefined"&&(a.spaceBetweenStavesRatio=h.getDistanceBetweenStaves()/10),typeof a.measureNumberingPolicy=="undefined"&&(a.measureNumberingPolicy=h.getMeasureNumberingPolicy()),typeof a.hasPickup=="undefined"&&(a.hasPickup=h.hasPickupShift()),typeof a.spaceBetweenSystemsRatio=="undefined"&&(a.spaceBetweenSystemsRatio=h.getDistanceBetweenSystems()/10),typeof a.useBoomwhackersColors=="undefined"){const l=w.A.getMode(d)===f.A.BOOMWHACKER;a.useBoomwhackersColors=l}typeof a.customColorOptions=="undefined"&&w.A.getMode(d)===f.A.CUSTOM&&(a.customColorOptions=w.A.getColorOptions(d)),typeof a.useShapeNotes=="undefined"&&(a.useShapeNotes=h.isDisplayModeEnabled(A.A.NOTE_SHAPES)),typeof a.usePitchNameNotehead=="undefined"&&(a.usePitchNameNotehead=h.isDisplayModeEnabled(A.A.PITCHES_NAMES)),typeof a.isFixedDo=="undefined"&&(a.isFixedDo=!h.isDisplayModeEnabled(A.A.MOVABLE_DO)),typeof a.solfegeNotehead=="undefined"&&(h.isDisplayModeEnabled(A.A.SOLFEGE_SI)&&(a.solfegeNotehead=A.A.SOLFEGE_SI),h.isDisplayModeEnabled(A.A.SOLFEGE_TI)&&(a.solfegeNotehead=A.A.SOLFEGE_TI),h.isDisplayModeEnabled(A.A.SOLFEGE_JAPANESE)&&(a.solfegeNotehead=A.A.SOLFEGE_JAPANESE)),a.jazzChordPartConfig=h.getJazzChordPartConfigOrDefault(),typeof a.hideTempo=="undefined"&&(a.hideTempo=!h.isTempoMarkVisible()),typeof a.measureNumberingStart=="undefined"&&(a.measureNumberingStart=null,h.hasMeasureNumberingStart()&&(a.measureNumberingStart=h.getMeasureNumberingStart()))}},458098:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});var A=r(34262);function w(f,P){const a=Math.cos(P),h=Math.sin(P),d=f.x*a-f.y*h,l=f.x*h+f.y*a;return(0,A.A)(d,l)}},461996:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>A});function A(w=0){let f=null;const P=new Promise(a=>{f=a});return setTimeout(f,w),P}},462317:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});const A={TRACK:"track",PAGE:"page",RESPONSIVE:"responsive"};A.values=[A.TRACK,A.PAGE,A.RESPONSIVE],A.isValid=function(f){return A.values.includes(f)};const w=A},472744:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(616877);const w=1,f=1/0;function P(){return new A(w,f)}},491197:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(364842),w=r(410199);const P=function(a,h){if(h.left&&!h.right)return w.A.LEFT;if(h.left&&h.right)return w.A.MIDDLE;if(!h.left&&h.right)return w.A.RIGHT;throw new A.default("Unexpected")}},498554:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>a});var A=r(123491);const w=function(h){return f(h)},f=function(h){const d={};return h.forEach(P,d),d},P=function(h){const d=this,l=A.default.getVoiceIdx(h);typeof d[l]=="undefined"&&(d[l]=[]),d[l].push(h)},a=w},513411:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});var A=r(364842),w=r(863426),f=r(269352),P=r(589085);const a=function(){return this.init(),this};a.cssClass="staffLines";const h=a.prototype;h.cssClass=a.cssClass,h.init=function(){this.lines=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.width=null,this.parent=null,this.group=null},h.setParent=function(m){this.parent=m},h.setDrawingContext=function(m){this.drawingContext=m},h.setStaffData=function(m){this.staffData=m},h.getStaffData=function(){return this.staffData===null&&(this.staffData=P.A.createDefault()),this.staffData},h.isTabStaff=function(){const m=this.getStaffData();return P.A.isTabStaff(m)},h.setWidth=function(m){m!==this.width&&(this.width=m,this.isRendered()&&this.updateWidth())},h.updateWidth=function(){this.lines.forEach(this.updateLineWidth,this)},h.updateLineWidth=function(m){m.setX2(this.width)},h.setPosition=function(m){m!==this.posY&&(this.posY=m,this.isRendered()&&this.move())},h.draw=function(){this.renderIfNeeded(),this.drawLines(),this.move(),this.bindToParent()},h.drawLines=function(){this.lines.forEach(d)};const d=function(m){m.draw()};h.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},h.bindToParent=function(){this.parent.prepend(this.group)},h.renderIfNeeded=function(){this.isRendered()||this.render()},h.isRendered=function(){return this.group!==null},h.render=function(){this.createGroup(),this.createLines()},h.createGroup=function(){this.group=new f.A("g"),this.group.attr("class",this.cssClass)},h.createLines=function(){if(!(this.isKodaly()||this.isRecorderTabStaff()))for(let m=0;m<this.getDisplayedNbStaffLines();m++)this.createLine(m)},h.createLine=function(m){const x=this.getLineY(m),T={stroke_width:this.getStaffLineThickness()},Y=new w.A(this.group,T);Y.render(0,x,this.width,x),this.lines.push(Y)},h.getLineY=function(m){const x=this.getDisplayedNbStaffLines(),S=this.getSpaceSize();if(this.isTabStaff()||this.isKodaly()||this.isRecorderTabStaff())return S*m;if(x===5)return S*m;if(x===3)return S*m*2;if(x===1)return S*2;{const T=`The number of staff line [${x}] is not supported for a non tab staff.`;throw new A.default("Unexpected",T)}},h.isKodaly=function(){const m=this.getStaffData();return P.A.isKodalyStaff(m)},h.isRecorderTabStaff=function(){const m=this.getStaffData();return P.A.isRecorderTabStaff(m)},h.getDisplayedNbStaffLines=function(){const m=this.getStaffData();return P.A.getDisplayedNbStaffLines(m)},h.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},h.getStaffLineThickness=function(){return this.drawingContext.getStaffLineThickness()},h.getGroup=function(){return this.group},h.getWidth=function(){return this.width};const l=a},532228:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});var A=r(2255),w=r(364842),f=r(461996),P=(m,x,S)=>new Promise((T,Y)=>{var G=p=>{try{R(S.next(p))}catch(b){Y(b)}},q=p=>{try{R(S.throw(p))}catch(b){Y(b)}},R=p=>p.done?T(p.value):Promise.resolve(p.value).then(G,q);R((S=S.apply(m,x)).next())});const a=function(){this.init()},h=a.prototype;h.init=function(){this.measuresSlice=null,this.scoreDataCache=null,this.measureRenderer=null,this.commonContentBuilder=null,this.commonContent=null,this.systems=null,this.horizontalFormatting=null,this.measurePosition=null,this.drawingContext=null,this.displayIdx=null,this.dataIdx=null,this.measureNumberShift=null,this.measureNumberingPolicy=null},h.setDrawingContext=function(m){this.drawingContext=m},h.setScoreDataCache=function(m){this.scoreDataCache=m},h.setMeasureRenderer=function(m){this.measureRenderer=m},h.setMeasureNumberingPolicy=function(m){this.measureNumberingPolicy=m,this.areSystemsInitialized()&&this.getFlatMeasures().forEach(S=>S.setMeasureNumberingPolicy(m))},h.setSystems=function(m){this.systems=m},h.setDataIdx=function(m){this.dataIdx=m,this.areSystemsInitialized()&&this.getFlatMeasures().forEach(S=>S.setDataIdx(m))},h.setMeasuresSlice=function(m){this.measuresSlice=m},h.getMeasurePosition=function(){return this.measurePosition},h.setMeasurePosition=function(m){this.measurePosition=m,this.getFlatMeasures().forEach(S=>S.setMeasureLocation(m))},h.replaceMeasure=function(m,x){this.horizontalFormatting=null,this.systems[x]=m,m.forEach(S=>S.setMeasureLocation(this.measurePosition)),m.forEach(S=>S.setMeasureNumberingPolicy(this.measureNumberingPolicy)),m.forEach(S=>S.setDataIdx(this.dataIdx)),m.forEach(S=>S.setDisplayIdx(this.displayIdx)),this.measureNumberShift=m[0].getMeasureNumberShift(),this.hasMeasuresSlice()&&this.measuresSlice.replaceMeasure(this,m,x)},h.getWidth=function(){return this.getWidthForPosition(this.measurePosition)},h.getWidthForPosition=function(m){return this.updateWidthComputation(m),this.getFormatting().getWidth()},h.updateWidthComputation=function(m){const x=this.getFormatting();if(!x.hasMeasurePos()||x.getMeasurePos()!==m){x.setMeasurePosition(m);const S=this.drawingContext.getMeasureWidth();x.setWidth(S)}},h.getFormatting=function(){return this.horizontalFormatting===null&&this.refreshFormatting(),this.horizontalFormatting},h.refreshFormatting=function(){const x=this.getFlatMeasures().map(d),S=this.drawingContext.getNotesFormatter(),T=new A.A(this.drawingContext,x,S);T.format(),this.horizontalFormatting=T.getFormatting()},h.hasFormatting=function(){return this.horizontalFormatting!==null};const d=function(m){return m.getHorizontalData()};h.getSystemsMeasure=function(){if(!this.areSystemsInitialized())throw new w.default("Unexpected","Systems are not initialized in measure column.");return this.systems},h.getFlatMeasures=function(){return Array.prototype.concat.apply([],this.systems)},h.getNbSystems=function(){return this.systems.length},h.getSystemMeasure=function(m){return this.systems[m]},h.getDisplayIdx=function(){return this.displayIdx},h.getDataIdx=function(){return this.dataIdx},h.getMeasuresSliceIdx=function(){return this.measuresSlice.getIdx()},h.hasMeasuresSlice=function(){return this.measuresSlice!==null},h.getMeasuresSlice=function(){return this.measuresSlice},h.updateDisplayIdx=function(m){this.displayIdx=m,this.areSystemsInitialized()&&this.getFlatMeasures().forEach(S=>S.setDisplayIdx(m))},h.getFirstSystems=function(){return this.systems.slice(0,1)},h.getOtherSystems=function(){return this.systems.slice(1)},h.areSystemsInitialized=function(){return this.systems!==null},h.initSystems=function(){return P(this,null,function*(){this.systems=yield this.createSystemsMeasure(),this.getMeasureNumberShift(),this.updateDisplayIdx(this.displayIdx),this.setDataIdx(this.dataIdx),this.setMeasureNumberingPolicy(this.measureNumberingPolicy),this.scoreDataCache=null,this.measureRenderer=null})},h.createSystemsMeasure=function(){return P(this,null,function*(){const m=this.scoreDataCache.getNbParts(),x=[];for(let T=0;T<m;T++){const Y=this.createSystemMeasureAsync(T);x.push(Y)}return yield Promise.all(x)})},h.createSystemMeasureAsync=function(m){return P(this,null,function*(){return this.drawingContext.isAsynchronous()&&(yield(0,f.A)()),this.createSystemMeasure(m)})},h.createSystemMeasure=function(m){const x=this.dataIdx,S=this.scoreDataCache.getMeasureDisplayData(m,x),T=this.measureRenderer.renderMeasure(S);return T.forEach(this.dispatchDrawingContext,this),T},h.dispatchDrawingContext=function(m){m.render(this.drawingContext)},h.getMeasureNumberShift=function(){if(this.measureNumberShift===null){const m=this.scoreDataCache.getCommonContent();this.measureNumberShift=m.hasMultiMeasureRest(this.dataIdx)?m.getMultiMeasureRest(this.dataIdx):1}return this.measureNumberShift},h.hasSystemBreakBefore=function(){return this.getTopMeasure().hasSystemBreakBefore()},h.hasSystemBreakAfter=function(){return this.getTopMeasure().hasSystemBreakAfter()},h.hasPageBreakBefore=function(){return this.getTopMeasure().hasPageBreakBefore()},h.hasPageBreakAfter=function(){return this.getTopMeasure().hasPageBreakAfter()},h.isInDisplayedRange=function(){return this.getTopMeasure().isInDisplayedRange()},h.getTopMeasure=function(){return this.getTopSystem()[0]},h.getTopSystem=function(){return this.systems[0]},h.setIsLastOfSystem=function(m){this.getFlatMeasures().forEach(S=>S.setIsLastOfSystem(m))};const l=a},538783:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>x});var A=r(364842);const w="auto",f="up",P="down",a="up-unpitched",h="down-unpitched";function d(S){const T=`Invalid value for stemStrategy: [${S}].`;throw new A.default("BadStemStrategyError",T)}function l(S){return S===f||S===a}function m(S){return S===P||S===h}const x={AUTO:w,UP:f,DOWN:P,UP_UNPITCHED:a,DOWN_UNPITCHED:h,isUp:l,isDown:m,raiseError:d}},562062:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(723631),f=r(372585),P=r(258780);const a=function(l,m,x,S,T,Y){this.init(l,m,x,S,T,Y)},h=a.prototype;h.init=function(l,m,x,S,T,Y){this.measure=null,this.octaveShift=null,this.measureIdx=null,this.type=l,this.size=m,this.location=T,this.placement=x,this.octaveShiftUuid=Y,this.timePos=typeof S!="undefined"?S:null,this.drawingContext=null},h.setLocation=function(l){this.location=l},h.setMeasure=function(l){this.measure=l},h.isAbove=function(){return this.getPlacement()===w.A.ABOVE},h.isBelow=function(){return this.getPlacement()===w.A.BELOW},h.getPlacement=function(){return this.placement},h.getTimePos=function(){return this.timePos},h.getSize=function(){return this.size},h.isLeft=function(){return this.hasLocation()?P.A.isLeft(this.location):this.isStart()},h.isRight=function(){return this.hasLocation()?P.A.isRight(this.location):this.isStop()},h.isStop=function(){return this.type===f.A.STOP},h.isStart=function(){return this.type===f.A.UP||this.type===f.A.DOWN},h.hasLocation=function(){return this.location!==null},h.setDrawingContext=function(l){this.drawingContext=l},h.getDrawingContext=function(){return this.drawingContext},h.getX=function(){if(P.A.isLeft(this.location))return this.getLeftX();if(P.A.isRight(this.location))return this.getRightX();if(this.isStart()||this.isStop())return this.getMiddleX();throw new A.default("Unexpected")},h.getLeftX=function(){const l=this.measure.tickableContent;return this.measure.getXPos()+l.getXPos()-l.getPreviousSpace()},h.getRightX=function(){const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.getWidth()},h.getMiddleX=function(){if(this.timePos===null){const T="Cannot compute a middleX position without time position";throw new A.default("Unexpected",T)}const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.timePosToX(this.timePos)},h.getY=function(){if(this.isAbove())return this.measure.getUpOctaveShiftsY();if(this.isBelow())return this.measure.getDownOctaveShiftsY();throw new A.default("Unexpected")},h.hasOctaveShift=function(){return this.octaveShift!==null},h.setOctaveShift=function(l){this.octaveShift=l},h.removeOctaveShift=function(){if(this.location!==null)P.A.isLeft(this.location)?this.octaveShift.removeLeftAnchor():P.A.isRight(this.location)?this.octaveShift.removeRightAnchor():P.A.raiseError(this.location);else if(this.isStart())this.octaveShift.removeLeftAnchor();else if(this.isStop())this.octaveShift.removeRightAnchor();else throw new A.default("Unexpected");this.octaveShift=null},h.getOctaveShift=function(){return this.octaveShift},h.setNeedDrawUpdate=function(){this.hasOctaveShift()&&this.getOctaveShift().setNeedDrawUpdate()},h.getOctaveShiftUuid=function(){return this.octaveShiftUuid};const d=a},574626:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842);const w="open",f="open-continue",P="closed",a="closed-continue";function h(l){const m=`The wedge spread type [${l}] is invalid.`;throw new A.default("BadWedgeSpreadType",m)}const d={OPEN:w,OPEN_CONTINUE:f,CLOSED:P,CLOSED_CONTINUE:a,raiseError:h}},589085:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>F});var A=r(104907),w=r(721247),f=r(128001);const P=5,a=!1,h=!1,d=!1,l=!1;function m(){return x(P)}function x(L,I=a,W=h,V=d,it=l){return{nbStaffLines:L,isTabStaff:I,isKodalyStaff:W,isHandSign:V,isRecorderTabStaff:it}}function S(L,I){return w.default.isTab(I)?x(L,!a):x(L,a)}function T(L){const I=A.default.getNbStaffLines(L);if(A.default.hasTab(L))return x(I,!a);if(A.default.hasKodaly(L)){const W=A.default.getKodaly(L),V=f.A.isHandSign(W);return x(I,a,!0,V)}else return A.default.hasRecorderTabs(L)?x(I,a,h,d,!0):x(I,a)}function Y(L){return typeof L.nbStaffLines!="undefined"}function G(L){return typeof L.isTabStaff!="undefined"}function q(L){return!!L.isKodalyStaff}function R(L){return!!L.isRecorderTabStaff}function p(L){return!!L.isHandSign}function b(L){return!C(L)&&!q(L)?P:typeof L.nbStaffLines!="undefined"?L.nbStaffLines:P}function v(L){return typeof L.nbStaffLines!="undefined"?L.nbStaffLines:P}function B(L){return C(L)}function C(L){return typeof L.isTabStaff!="undefined"?L.isTabStaff:a}function _(L,I){L.nbStaffLines=I}function st(L,I){L.isTabStaff=I}const F={DEFAULT_IS_HANDSIGN:d,DEFAULT_IS_KODALY_STAFF:h,DEFAULT_IS_TAB_STAFF:a,DEFAULT_NB_STAFF_LINES:P,createDefault:m,create:x,createFromClef:S,createFromStaffDetails:T,hasNbStaffLines:Y,hasIsTabStaff:G,isKodalyStaff:q,isRecorderTabStaff:R,isHandSign:p,getNbStaffLines:b,getDisplayedNbStaffLines:v,getIsTabStaff:B,isTabStaff:C,setNbStaffLines:_,setIsTabStaff:st}},593566:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(269352),f=r(705740);const P="#AAAAAA";class a{constructor(){this.group=null,this.bracket=new f.A,this.systems=[],this.posY=0,this.height=0,this.drawingContext=null,this.groupBracketOffset=null,this.drawn=!1}getSystems(){return this.systems}addSystem(x){this.systems.push(x)}removeSystem(x){const S=this.systems.indexOf(x);if(S<0)throw new A.default("The system is not part of the bracket group.");this.systems.splice(S,1),x.setGroupBracket(null)}setDrawingContext(x){this.drawingContext=x,this.bracket.setDrawingContext(x)}setPosX(x){this.bracket.setPosition(x)}setPosY(x){this.posY=x}setHeight(x){this.height=x,this.bracket.setInputHeight(x)}draw(){this.group===null&&this.render(),this.updateBracketColor(),this.bracket.draw(),this.move(),this.bindToParent()}updateBracketColor(){this.systems[0].hasGroupStart()?this.bracket.setTopColor(null):this.bracket.setTopColor(P),this.systems[this.systems.length-1].hasGroupStop()?this.bracket.setBottomColor(null):this.bracket.setBottomColor(P)}render(){this.group=new w.A("g"),this.bracket.setParent(this.group)}bindToParent(){this.drawn||(this.drawn=!0,this.parent.append(this.group))}hide(){this.drawn&&(this.drawn=!1,this.group.removeFromParent())}setParent(x){this.parent=x}getWidth(){return this.drawingContext.getSpaceSize()}move(){const x=this.posY+this.height/2;this.group.attr("transform",`translate(0 ${x})`)}getBottomSystem(){const x=this.systems.length;if(x===0)throw new A.default("No systems in the group");const S=x-1;return this.systems[S]}getTopSystem(){if(this.systems.length===0)throw new A.default("No systems in the group");return this.systems[0]}extendBarlines(){this.systems.forEach(this.extendSystemBarline,this)}extendSystemBarline(x,S){if(S===0)return;this.systems[S-1].connectWith(x)}refreshGroupBracketOffset(){const x=this.systems.map(h);this.groupBracketOffset=Math.max.apply(null,x),this.systems.forEach(S=>S.dropHeaderWidth())}getGroupBracketOffset(){return this.groupBracketOffset}}function h(m){return m.getGroupBracketOffset()}function d(m,x){new l(m,x).link()}class l{constructor(x,S){this.systems=x,this.drawingContext=S,this.currentBracket=null,this.bracketsSet=new Set}link(){this.systems.forEach(this.processSystem,this),this.removeUnusedSystemsFromBrackets()}processSystem(x,S){if(!x.hasGroup()){this.currentBracket=null;return}const T=this.getSystemBracket(x,S);this.currentBracket=T,this.bracketsSet.add(T),this.setSystemBracket(x)}getSystemBracket(x,S){if(x.hasGroupStart())return x.hasGroupBracket()?x.getGroupBracket():this.createGroupBracket();if(S===0){if(x.hasGroupBracket()){const T=x.getGroupBracket();if(T.getTopSystem()===x)return T}return this.createGroupBracket()}if(this.currentBracket===null)throw new A.default("No ongoing group bracket to connect to");return this.currentBracket}createGroupBracket(){const x=new a;return x.setDrawingContext(this.drawingContext),x}setSystemBracket(x){if(x.hasGroupBracket()){const S=x.getGroupBracket();if(S===this.currentBracket)return;x.hasGroupStart()||S.getTopSystem()===x&&S.hide(),S.removeSystem(x)}x.setGroupBracket(this.currentBracket)}removeUnusedSystemsFromBrackets(){const x=new Set(this.systems);this.bracketsSet.forEach(S=>{S.getSystems().forEach(Y=>{x.has(Y)||S.removeSystem(Y)})})}}},613746:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(723631),f=r(868743),P=r(468852);const a=function(l,m,x,S,T){this.init(l,m,x,S,T)},h=a.prototype;h.init=function(l,m,x,S,T){this.measure=null,this.pedal=null,this.measureIdx=null,this.type=l,this.location=S,this.placement=m,this.pedalUuid=T,this.timePos=typeof x!="undefined"?x:null,this.drawingContext=null},h.setLocation=function(l){this.location=l},h.setMeasure=function(l){this.measure=l},h.isAbove=function(){return this.getPlacement()===w.A.ABOVE},h.isBelow=function(){return this.getPlacement()===w.A.BELOW},h.getPlacement=function(){return this.placement},h.getTimePos=function(){return this.timePos},h.isLeft=function(){return this.hasLocation()?P.A.isLeft(this.location):this.isStart()},h.isRight=function(){return this.hasLocation()?P.A.isRight(this.location):this.isStop()},h.isStop=function(){return this.type===f.A.STOP},h.isStart=function(){return this.type===f.A.START},h.hasLocation=function(){return this.location!==null},h.setDrawingContext=function(l){this.drawingContext=l},h.getDrawingContext=function(){return this.drawingContext},h.getX=function(){if(P.A.isLeft(this.location))return this.getLeftX();if(P.A.isRight(this.location))return this.getRightX();if(this.isStart()||this.isStop())return this.getMiddleX();throw new A.default("Unexpected")},h.getLeftX=function(){const l=this.measure.tickableContent;return this.measure.getXPos()+l.getXPos()-l.getPreviousSpace()},h.getRightX=function(){const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.getWidth()},h.getMiddleX=function(){if(this.timePos===null){const T="Cannot compute a middleX position without time position";throw new A.default("Unexpected",T)}const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.timePosToX(this.timePos)},h.getY=function(){if(this.isAbove())return this.measure.getUpPedalsY();if(this.isBelow())return this.measure.getDownPedalsY();throw new A.default("Unexpected")},h.hasPedal=function(){return this.pedal!==null},h.setPedal=function(l){this.pedal=l},h.removePedal=function(){if(this.location!==null)P.A.isLeft(this.location)?this.pedal.removeLeftAnchor():P.A.isRight(this.location)?this.pedal.removeRightAnchor():P.A.raiseError(this.location);else if(this.isStart())this.pedal.removeLeftAnchor();else if(this.isStop())this.pedal.removeRightAnchor();else throw new A.default("Unexpected");this.pedal=null},h.getPedal=function(){return this.pedal},h.setNeedDrawUpdate=function(){this.hasPedal()&&this.getPedal().setNeedDrawUpdate()},h.getPedalUuid=function(){return this.pedalUuid};const d=a},619370:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(723631),f=r(909748),P=r(332573);const a=function(l,m,x,S,T){this.init(l,m,x,S,T)},h=a.prototype;h.init=function(l,m,x,S,T){this.measure=null,this.tempoChange=null,this.measureIdx=null,this.type=l,this.placement=m,this.location=S,this.timePos=typeof x!="undefined"?x:null,this.tempoChangeUuid=T||null,this.drawingContext=null},h.setLocation=function(l){this.location=l},h.setMeasure=function(l){this.measure=l},h.setMeasureIdx=function(l){this.measureIdx=l},h.isAbove=function(){return this.getPlacement()===w.A.ABOVE},h.isBelow=function(){return this.getPlacement()===w.A.BELOW},h.getPlacement=function(){return this.placement},h.getTimePos=function(){return this.timePos},h.isLeft=function(){return this.hasLocation()?P.A.isLeft(this.location):this.isStart()},h.isRight=function(){return this.hasLocation()?P.A.isRight(this.location):this.isStop()},h.isStop=function(){return this.type===f.A.STOP},h.isStart=function(){return f.A.isStart(this.type)},h.hasLocation=function(){return this.location!==null},h.setDrawingContext=function(l){this.drawingContext=l},h.getDrawingContext=function(){return this.drawingContext},h.getType=function(){return this.type},h.getX=function(){if(P.A.isLeft(this.location))return this.getLeftX();if(P.A.isRight(this.location))return this.getRightX();if(this.isStart()||this.isStop())return this.getMiddleX();throw new A.default("Unexpected")},h.getLeftX=function(){const m=this.measure.tickableContent;return this.measure.getXPos()+m.getXPos()-m.getPreviousSpace()},h.getRightX=function(){const l=this.measure,m=l.tickableContent;return l.getXPos()+m.getXPos()+m.getWidth()},h.getMiddleX=function(){if(this.timePos===null){const T="Cannot compute a middleX position without time position";throw new A.default("Unexpected",T)}const l=this.measure,m=l.tickableContent;let S=l.getXPos()+m.getXPos()+m.timePosToX(this.timePos);return this.isStop()&&(S-=this.drawingContext.getSpaceSize()),S},h.getY=function(){if(this.isAbove())return this.measure.getUpTempoChangesY();if(this.isBelow())return this.measure.getDownTempoChangesY();throw new A.default("Unexpected")},h.hasTempoChange=function(){return this.tempoChange!==null},h.setTempoChange=function(l){this.tempoChange=l},h.removeTempoChange=function(){if(this.location!==null)P.A.isLeft(this.location)?this.tempoChange.removeLeftAnchor():P.A.isRight(this.location)?this.tempoChange.removeRightAnchor():P.A.raiseError(this.location);else if(this.isStart())this.tempoChange.removeLeftAnchor();else if(this.isStop())this.tempoChange.removeRightAnchor();else throw new A.default("Unexpected");this.tempoChange=null},h.getTempoChange=function(){return this.tempoChange},h.setNeedDrawUpdate=function(){this.hasTempoChange()&&this.getTempoChange().setNeedDrawUpdate()},h.getTempoChangeUuid=function(){return this.tempoChangeUuid};const d=a},628516:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>b});var A=r(364842),w=r(269352),f=r(863426);const P=function(){this.init()};P.cssClass="tempoChangeLine";const a=P.prototype;a.cssClass=P.cssClass,a.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.x1=0,this.x2=0,this.y1=0,this.y2=0},a.setDrawingContext=function(v){this.drawingContext=v},a.setParent=function(v){this.parent=v},a.setX1=function(v){this.x1=v,this.isRendered()&&this.line.setX1(v)},a.setX2=function(v){this.x2=v,this.isRendered()&&this.line.setX2(v)},a.setY1=function(v){this.y1=v,this.isRendered()&&this.line.setY1(v)},a.setY2=function(v){this.y2=v,this.isRendered()&&this.line.setY2(v)},a.draw=function(){this.isRendered()||this.render(),this.line.draw()},a.render=function(){if(this.isRendered())return;const v=this.drawingContext.getTempoChangeThickness(),B=this.drawingContext.getTempoChangeDashArrayWidth(),C={stroke_width:v,stroke_dasharray:[B,B*2]};this.line=new f.A(this.parent,C),this.line.render(this.x1,this.y1,this.x2,this.y2)},a.isRendered=function(){return this.line!==null},a.getHeight=function(){return Math.abs(this.y1-this.y2)};const h=P;var d=r(909748),l=r(843678),m=r(100673);const x=l.default.fromPairs([{key:d.A.ACCELERANDO,value:"accel."},{key:d.A.RITARDANDO,value:"rit."}]),S=function(v){this.init(v)};S.cssClass="tempoChangeText";const T=S.prototype;T.cssClass=S.cssClass,T.init=function(v){this.leftAnchor=null,this.rightAnchor=null,this.type=v,this.drawingContext=null,this.parent=null,this.text=null},T.setParent=function(v){this.parent=v},T.setCssClass=function(v){this.cssClass=v},T.setDrawingContext=function(v){this.drawingContext=v},T.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.draw()},T.draw=function(){this.text.draw()},T.render=function(){const v=this.getTextValue(),B=new m.A({"font-family":"Georgia",text:v,"font-style":"italic"});B.setParent(this.parent),B.setDrawingContext(this.drawingContext),B.setFontSize(this.drawingContext.getTempoChangeFontSize()),this.text=B,this.text.render()},T.getTextValue=function(){if(typeof x[this.type]!="undefined")return x[this.type];throw new A.default("Unexpected")},T.getWidth=function(){return this.isRendered()?this.text.getWidth():0},T.getHeight=function(){return this.isRendered()?this.text.getXHeight():0},T.isRendered=function(){return this.text!==null};const Y=S;var G=r(568357);const q="adagio-tempochange-uuid",R=function(){this.init()};R.cssClass="tempoChange";const p=R.prototype;p.cssClass=R.cssClass,p.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.text=null,this.line=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},p.setParent=function(v){this.parent=v},p.setCssClass=function(v){this.cssClass=v},p.setStaffData=function(v){this.staffData=v},p.setDrawingContext=function(v){this.drawingContext=v},p.setLeftAnchor=function(v){this.hasLeftAnchor()&&this.leftAnchor!==v&&this.removeLeftAnchor(),this.leftAnchor=v,this.leftAnchor.setTempoChange(this)},p.hasLeftAnchor=function(){return this.leftAnchor!==null},p.removeLeftAnchor=function(){this.hide(),this.leftAnchor.tempoChange=null,this.leftAnchor=null},p.setRightAnchor=function(v){this.hasRightAnchor()&&this.rightAnchor!==v&&this.removeRightAnchor(),this.rightAnchor=v,this.rightAnchor.setTempoChange(this)},p.hasRightAnchor=function(){return this.rightAnchor!==null},p.removeRightAnchor=function(){this.hide(),this.rightAnchor.tempoChange=null,this.rightAnchor=null},p.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},p.hide=function(){this.drawn&&this.unbindFromParent()},p.isAbove=function(){return this.getLeftAnchor().isAbove()},p.isBelow=function(){return this.getLeftAnchor().isBelow()},p.getLeftAnchor=function(){return this.leftAnchor},p.getRightAnchor=function(){return this.rightAnchor},p.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},p.updateHorizontalDisplay=function(){this.isRendered()||this.render();const v=this.getWidth();this.text!==null&&this.text.updateHorizontalDisplay(v);const B=this.text!==null?this.text.getWidth()+this.drawingContext.getTempoChangeTextMargin():0;this.line.setX1(B),this.line.setX2(v),this.posX=this.getX(),this.draw()},p.updateVerticalDisplay=function(){if(this.isRendered()||this.render(),this.posY=this.getY(),this.text!==null){const v=this.text.getHeight()/2;this.line.setY1(this.isAbove()?-v:v),this.line.setY2(this.isAbove()?-v:v)}this.draw()},p.draw=function(){if(this.isRendered()||this.render(),this.posY=this.getY(),this.text!==null){const C=this.text.getHeight()/2;this.line.setY1(this.isAbove()?-C:C),this.line.setY2(this.isAbove()?-C:C)}const v=this.getWidth();this.text!==null&&this.text.updateHorizontalDisplay(v);const B=this.text!==null?this.text.getWidth()+this.drawingContext.getTempoChangeTextMargin():0;this.line.setX1(B),this.line.setX2(v),this.posX=this.getX(),this.text!==null&&this.text.draw(),this.line.draw(),this.move(),this.bindToParent()},p.getCssClasses=function(){const v=[this.cssClass];return this.leftAnchor.isStart()&&v.push(G.A.START),this.rightAnchor.isStop()&&v.push(G.A.STOP),v.join(" ")},p.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},p.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},p.render=function(){this.group=new w.A("g");const v=this.leftAnchor.getTempoChangeUuid();this.group.setDataEntry(q,v);const B=this.getCssClasses();this.group.attr("class",B);const C=this.getLeftAnchor(),_=C.getType();C.isStart()&&(this.text=new Y(_),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext)),this.line=new h,this.line.setParent(this.group),this.line.setDrawingContext(this.drawingContext);const st=this.getLineY();this.line.setY1(st),this.line.setY2(st)},p.getLineY=function(){const v=this.getHeight();if(this.isAbove())return-(v/4*3);if(this.isBelow())return-(v/4);throw new A.default("Unexpected")},p.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate (${this.posX}, ${this.posY})`)},p.isRendered=function(){return this.group!==null},p.getWidth=function(){const v=this.getX();return this.getRightAnchor().getX()-v},p.getHeight=function(){return this.text!==null?this.text.getHeight():this.line.getHeight()},p.getX=function(){return this.getLeftAnchor().getX()},p.getY=function(){return this.getLeftAnchor().getY()},p.getGroup=function(){return this.group};const b=R},631294:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>G});var A=r(364842),w=r(269352),f=r(723631),P=r(63254);const a="adagio-dynamic-uuid",h="noteheadBlack",d=function(q,R,p,b,v,B){this.init(q,R,p,b,v,B)};d.cssClass="dynamic";const l=d.prototype;l.cssClass=d.cssClass,d.values=["p","pp","ppp","pppp","ppppp","pppppp","f","ff","fff","ffff","fffff","ffffff","mp","mf","sf","sfp","sfpp","fp","rf","rfz","sfz","sffz","fz"];const m={p:.85,f:.6,m:.95,r:.7,s:.9,z:1},x={p:"dynamicPiano",f:"dynamicForte",m:"dynamicMezzo",r:"dynamicRinforzando",s:"dynamicSforzando",z:"dynamicZ",pppp:"dynamicPPPP",ppp:"dynamicPPP",pp:"dynamicPP",mp:"dynamicMP",mf:"dynamicMF",pf:"dynamicPF",ff:"dynamicFF",fff:"dynamicFFF",ffff:"dynamicFFFF",fp:"dynamicFortePiano",fz:"dynamicForzando",sf:"dynamicSforzando1",sfp:"dynamicSforzandoPiano",sfpp:"dynamicSforzandoPianissimo",sfz:"dynamicSforzato",sfzp:"dynamicSforzatoPiano",sffz:"dynamicSforzatoFF",rf:"dynamicRinforzando1",rfz:"dynamicRinforzando2"},S=function(q){if(typeof x[q]=="undefined"){const R=`Dynamic letter not supported: [${q}].`;throw new A.default("BadDynamicLetter",R)}return x[q]};l.init=function(q,R,p,b,v=0,B=0){this.list=T(R),this.offsetX=v,this.offsetY=B,this.style=R,this.placement=q,this.timePos=p,this.dynamicUuid=b||null,this.drawingContext=null,this.horizontalOffset=0,this.xPos=null,this.yPos=null,this.width=null,this.parent=null,this.group=null,this.noteHeadWidth=null};const T=function(q){if(typeof x[q]!="undefined"){const b=S(q);return[{dynamicLetter:q,glyphId:b,glyph:null,path:null,pos:null,isSingle:!0}]}const R=[],p=q.length;for(let b=0;b<p;b++){const v=q.charAt(b),B=S(v),C={dynamicLetter:v,glyphId:B,glyph:null,path:null,pos:null,isSingle:!1};R.push(C)}return R};l.setParent=function(q){this.parent=q},l.getWidth=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.width},l.getHeight=function(){const q=this.getHeights();return Math.max.apply(null,q)},l.getHeights=function(){return this.areGlyphesLoaded()||this.loadGlyphes(),this.list.map(Y)};const Y=function(q){return q.glyph.getHeight()};l.areGlyphesLoaded=function(){return this.width!==null},l.loadGlyphes=function(){this.width=this.list.reduce(this.loadGlyph.bind(this),0)},l.loadGlyph=function(q,R){return R.pos=q,R.glyph=this.drawingContext.getGlyph(R.glyphId),q+=R.glyph.getWidth(),R.isSingle||(q+=m[R.dynamicLetter]),q},l.render=function(q){this.drawingContext=q,this.areGlyphesLoaded()||(this.loadGlyphes(),this.calcOpticalCenter()),this.group=new w.A("g"),this.group.attr("class",this.cssClass),this.dynamicUuid!==null&&this.group.setDataEntry(a,this.dynamicUuid),this.list.forEach(this.renderEntry,this)},l.calcOpticalCenter=function(){const q=this.list[0],R=this.list.length,p=this.list[R-1],b=q.pos+q.glyph.getOpticalCenter().x,v=p.pos+p.glyph.getOpticalCenter().x;this.opticalCenter=(v-b)/2+q.glyph.getOpticalCenter().x},l.renderEntry=function(q){const R=this.group.append("path");R.attr("d",q.glyph.render());const p=this.drawingContext.getSpaceSize(),b=q.pos+this.offsetX*p/10,v=this.drawingContext.getDynamicsMiddle()+this.offsetY*p/10;R.attr("transform",`translate(${b}, ${v})`),q.path=R},l.setPosX=function(q){this.xPos=q},l.setHorizontalOffset=function(q){this.horizontalOffset=q},l.setPosY=function(q){this.yPos=q},l.draw=function(){this.needRender()&&this.render(),this.move(),this.bindToParent()},l.needRender=function(){return this.group===null},l.bindToParent=function(){this.parent.append(this.group)},l.move=function(){const q=this.getNoteHeadWidth(),R=this.xPos+this.horizontalOffset-this.opticalCenter+q/2;this.xPos!==null&&this.yPos!==null&&this.group.attr("transform",`translate(${R}, ${this.yPos})`)},l.getSpaceBefore=function(){const q=this.getNoteHeadWidth();return Math.max(0,this.opticalCenter-q/2)},l.getNoteHeadWidth=function(){if(this.noteHeadWidth===null){const q=this.drawingContext.getGlyph(h);this.noteHeadWidth=q.getWidth()}return this.noteHeadWidth},l.unbindFromParent=function(){this.group.removeFromParent()},l.getHorizontalPosition=function(){return P.A.DYNAMIC},l.getDrawingContext=function(){return this.drawingContext},l.getTimePos=function(){return this.timePos},l.getTimePosition=function(){return this.timePos},l.getGroup=function(){return this.group},l.getDirectionType=function(){return"dynamics"},l.setCssClass=function(q){this.cssClass=q},l.isAbove=function(){return this.getPlacement()===f.A.ABOVE},l.isBelow=function(){return this.getPlacement()===f.A.BELOW},l.getPlacement=function(){return this.placement};const G=d},637475:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(364842),w=r(726042);const f=["Whole","Half","Quarter","8th","16th","32nd","64th","128th","256th","512th","1024th"],P=f.length;function a(l){const m=l-1;return h(m)}function h(l){if(!w.default.isInteger(l)||l<0||l>=P){const m=`The value [${l}] is not an authorized ordinal.`;throw new A.default("InvalidOrdinal",m)}return f[l]}const d={fromDurationType:a,get:h}},658140:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Kr});var A=r(383279),w=r(701387),f=r(589085),P=r(721247),a=r(104907);const d={BRACE:"brace",BRACKET:"bracket"};var l=r(100673),m=r(269352);const x=function(){this.init()};x.NAME="brace";const S=x.prototype;S.name=x.NAME,S.init=function(){this.drawingContext=null,this.inputHeight=null,this.nominalHeight=null,this.posX=null,this.currentPosX=null,this.scalingRatioX=null,this.scalingRatioY=null,this.glyph=null,this.pathText=null,this.parent=null,this.path=null},S.setDrawingContext=function(e){this.drawingContext=e},S.setPosition=function(e){this.posX=e},S.setParent=function(e){this.parent=e},S.setNominalHeight=function(e){this.nominalHeight=e,this.scalingRatioY=null,this.scalingRatioX=null},S.setInputHeight=function(e){e!==this.inputHeight&&(this.inputHeight=e,this.scalingRatioY=null)},S.draw=function(){this.renderIfNeeded(),this.update(),this.bindToParent()},S.renderIfNeeded=function(){this.isRendered()||this.render()},S.isRendered=function(){return this.path!==null},S.render=function(){this.path=new m.A("path"),this.path.attr("class",this.name)},S.update=function(){if(this.isRendered()){if(this.pathText===null){const e=this.getPathText();this.path.attr("d",e)}(this.scalingRatioY===null||this.posX!==this.currentPosX)&&this.canMove()&&this.move()}},S.canMove=function(){return this.posX!==null},S.move=function(){this.currentPosX=this.posX;const i=this.posX,g=this.inputHeight/2,O=`translate(${i}, ${g})`,X=this.getScalingRatioY(),Ut=`scale(${this.getScalingRatioX()} ${X})`;this.path.attr("transform",`${O} ${Ut}`)},S.bindToParent=function(){this.parent.append(this.path)},S.getPathText=function(){return this.pathText===null&&(this.pathText=this.getGlyph().render()),this.pathText},S.getWidth=function(){const e=this.getScalingRatioX();return this.getGlyph().getWidth()*e},S.getScalingRatioX=function(){if(this.scalingRatioX===null){const e=this.getGlyphHeight();this.scalingRatioX=this.nominalHeight/e}return this.scalingRatioX},S.getScalingRatioY=function(){if(this.scalingRatioY===null){const e=this.getGlyphHeight();this.scalingRatioY=this.inputHeight/e}return this.scalingRatioY},S.getGlyphHeight=function(){return this.getGlyph().getHeight()},S.getGlyph=function(){return this.glyph===null&&this.createGlyph(),this.glyph},S.createGlyph=function(){this.glyph=this.drawingContext.getGlyph("brace")},S.getSpaceAboveStaff=function(){return 0},S.getSpaceBelowStaff=function(){return 0};const T=x;var Y=r(705740);const G="adagio-part-uuid",q=function(e){this.init(e)};q.NAME="systemHeader";const R=q.prototype;R.name=q.NAME,R.init=function(e){this.partUuid=e,this.drawingContext=null,this.width=null,this.systemPosY=null,this.middleY=null,this.posX=null,this.clampHeight=null,this.nominalHeight=null,this.isMinimalName=!1,this.textString=null,this.smallName=null,this.groupIdx=null,this.groupBracket=null,this.isFirstOfGroup=!1,this.isLastOfGroup=!1,this.clampType=null,this.clamp=null,this.text=null,this.parent=null,this.currentParent=null,this.insertionPoint=null,this.group=null,this.isRecorderTab=null},R.setDrawingContext=function(e){this.drawingContext=e,this.text!==null&&this.initText(),this.clamp!==null&&this.clamp.setDrawingContext(e)},R.setIsMinimalName=function(e){this.isMinimalName=e},R.toggleMinimalName=function(e){if(this.isMinimalName===e||(this.isMinimalName=!this.isMinimalName,!this.textString))return;const i=this.getTextString();this.text.replace(i),this.width=null},R.setGroupIdx=function(e){this.groupIdx=e},R.getGroupIdx=function(){return this.groupIdx},R.setHasGroupStart=function(e){this.isFirstOfGroup=e},R.setHasGroupStop=function(e){this.isLastOfGroup=e},R.setGroupBracket=function(e){this.groupBracket=e},R.setIsRecorderTab=function(e){this.isRecorderTab=e},R.hasRecorderTabs=function(){return!!this.isRecorderTab},R.hasGroup=function(){return this.groupIdx!==null},R.hasGroupBracket=function(){return this.groupBracket!==null},R.hasGroupStart=function(){return this.isFirstOfGroup},R.hasGroupStop=function(){return this.isLastOfGroup},R.getGroupBracket=function(){return this.groupBracket},R.getGroupBracketOffset=function(){let e=0;return e+=this.groupBracket.getWidth(),this.clamp!==null&&(e+=this.getClampSpaceSize()+this.clamp.getWidth()),e},R.setTextString=function(e){this.textString=e,e=this.getTextString();const i={text:e};this.text=new l.A(i),this.hasDrawingContext()&&this.initText(),this.width=null},R.setSmallName=function(e){this.smallName=e},R.getTextString=function(){return this.isMinimalName?this.smallName:this.textString},R.initText=function(){this.text.setDrawingContext(this.drawingContext),this.text.setFontSize(this.drawingContext.getPartNameFontSize()),this.text.options["font-family"]=this.drawingContext.getPartNameFontFamily(),this.text.options.fill=this.drawingContext.getPartNameFill();const e=this.drawingContext.getPartNameLetterSpacing();if(e!==null){const X=this.getSpaceSize();this.text.style["letter-spacing"]=e*X}const i=this.drawingContext.getPartNameTextTransform();i!==null&&(this.text.style["text-transform"]=i);const g=this.drawingContext.getPartNameFontWeight();this.text.style["font-weight"]=g;const O=this.drawingContext.getPartNameFontStyle();this.text.style["font-style"]=O},R.setNbStaves=function(e){e>1&&this.clamp===null&&!this.hasRecorderTabs()&&(this.createClamp(),this.width=null)},R.setClampType=function(e){this.clamp===null&&(this.clampType=e)},R.createClamp=function(){this.initClamp(),this.hasDrawingContext()&&this.clamp.setDrawingContext(this.drawingContext),this.nominalHeight!==null&&this.clamp.setNominalHeight(this.nominalHeight),this.clampHeight!==null&&this.clamp.setInputHeight(this.clampHeight)},R.initClamp=function(){switch(this.getClampType()){case d.BRACE:this.clamp=new T;break;case d.BRACKET:this.clamp=new Y.A;break;default:this.clamp=new T;break}},R.setNominalHeight=function(e){this.nominalHeight!==e&&(this.nominalHeight=e,this.clamp!==null&&this.clamp instanceof T&&(this.clamp.setNominalHeight(e),this.width=null))},R.setBraceHeight=function(e){this.clampHeight=e,this.clamp!==null&&this.clamp.setInputHeight(e)},R.setParent=function(e){this.parent=e},R.setPosX=function(e){this.posX=e},R.setSystemPosY=function(e){this.systemPosY=e},R.setMiddleY=function(e){this.middleY=e},R.format=function(){let e=0;if(this.text!==null){const i=this.text.getXHeight()/2;this.text.setPosition(e,i),e+=this.text.getWidth(),e+=this.getSpaceSize()}this.groupBracket!==null&&(e+=this.groupBracket.getGroupBracketOffset(),this.clamp!==null&&(e-=this.getClampSpaceSize()+this.clamp.getWidth())),this.clamp!==null&&this.clamp.setPosition(e,0)},R.drawContentRec=function(){this.format(),this.drawContent()},R.getGroup=function(){return this.renderIfNeeded(),this.group},R.renderIfNeeded=function(){this.group===null&&(this.group=new m.A("g"),this.group.attr("class",this.name),this.group.setDataEntry(G,this.partUuid),this.text!==null&&(this.text.setParent(this.group),this.text.render(),this.text.setCssClass("part-name")),this.clamp!==null&&(this.clamp.setParent(this.group),this.clamp.render()))},R.drawContent=function(){this.text!==null&&this.text.draw(),this.clamp!==null&&this.clamp.draw()},R.move=function(){const e=this.getGroup(),i=this.systemPosY+this.middleY;e.attr("transform",`translate(${this.posX}, ${i})`)},R.dropWidth=function(){this.width=null},R.getWidth=function(){return this.width===null&&this.calcWidth(),this.width},R.calcWidth=function(){this.width=0,this.text!==null&&(this.width+=this.getSpaceSize()+this.text.getWidth()),this.groupBracket!==null?this.width+=this.groupBracket.getGroupBracketOffset():this.clamp!==null&&(this.width+=this.getClampSpaceSize()+this.clamp.getWidth())},R.hasDrawingContext=function(){return this.drawingContext!==null},R.getClampSpaceSize=function(){return this.clampType===d.BRACKET?this.drawingContext.getSpaceSize():this.getSpaceSize()},R.getSpaceSize=function(){return this.isMinimalName?this.drawingContext.getSpaceSize()/4:this.drawingContext.getSpaceSize()},R.getClampType=function(){return this.clampType},R.getSpaceAboveFirstStaff=function(){let e=0;if(this.clamp!==null){const i=this.clamp.getSpaceAboveStaff();e=Math.max(e,i)}if(this.hasGroupStart()){const i=this.drawingContext.getGroupBracketSpaceAboveStaff();e=Math.max(e,i)}return e},R.getSpaceBelowLastStaff=function(){let e=0;if(this.clamp!==null){const i=this.clamp.getSpaceBelowStaff();e=Math.max(e,i)}if(this.hasGroupStop()){const i=this.drawingContext.getGroupBracketSpaceBelowStaff();e=Math.max(e,i)}return e},R.setInsertionPoint=function(e){this.insertionPoint=e},R.updateBinding=function(){if(!this.needUpdateBinding())return;const e=this.getGroup();this.parent===null?e.removeFromParent():this.insertionPoint===null?this.parent.append(e):this.parent.insertBefore(e,this.insertionPoint),this.currentParent=this.parent},R.needUpdateBinding=function(){return this.parent!==this.currentParent};const p=q;var b=r(364842),v=r(726042),B=r(701933);const C=1,_=3,st="adagio-part-uuid",F=function(e){this.init(e)};F.NAME="systemContent";const L=F.prototype;L.name=F.NAME,L.init=function(e){this.drawingContext=null,this.posY=null,this.verticalFormattingBySystemLocation={},this.nominalInnerHeight=null,this.partUuid=e,this.headerSpaceAbove=0,this.headerSpaceBelow=0,this.location=null,this.staves=[],this.parent=null,this.currentParent=null,this.insertionPoint=null,this.group=null,this.isRecorderTab=null},L.addStaff=function(e){this.staves.length>0&&e.setSystemLocation(B.A.OTHER),this.staves.push(e)},L.setParent=function(e){this.parent=e},L.setHeaderSpaceAbove=function(e){this.headerSpaceAbove=e},L.setHeaderSpaceBelow=function(e){this.headerSpaceBelow=e},L.setDrawingContext=function(e){this.drawingContext=e,this.staves.forEach(this.dispatchDrawingContext,this)},L.setIsRecorderTab=function(e){this.isRecorderTab=e},L.hasRecorderTabs=function(){return!!this.isRecorderTab},L.dispatchDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},L.setPosition=function(e){this.posY=e},L.setLocation=function(e){const i=this.location;this.location=e,e!==i&&this.staves.forEach((g,O)=>{O===0?g.setSystemLocation(e):g.setSystemLocation(B.A.OTHER)})},L.replaceMeasure=function(e,i){e.forEach(function(g,O){this.getStaff(O).replaceMeasure(g,i)},this)},L.insertMeasure=function(e,i){e.forEach(function(g,O){this.getStaff(O).insertMeasure(g,i)},this)},L.removeMeasure=function(e){this.staves.forEach(function(i){i.eraseMeasure(e)})},L.updateMeasuresBindings=function(){this.staves.forEach(e=>e.updateChildrenBindings())},L.drawContentRec=function(){this.drawContent(),this.staves.forEach(e=>e.drawContentRec())},L.drawContent=function(){this.formatVertically(),this.hasRecorderTabs()||this.extendInnerBarlines()},L.formatVertically=function(){let e,i=null;this.staves.forEach(g=>{if(i===null){const O=this.getSpaceAboveFirstStaff()-g.getSpaceAbove();e=Math.max(O,0)}else{const O=this.getDrawingContext(),X=i.getSpaceAbove(),ft=i.getStaffHeight(),Ut=V(i,g,O);e+=X+ft+Ut-g.getSpaceAbove();const Zt=W(i,g,O);i.setMeasuresGapBelow(Zt),g.setMeasuresGapAbove(Zt)}g.setPosition(e),g.move(),i=g}),this.drawingContext.hasEventsRects()&&this.updateMeasuresEventsRects()},L.getGroup=function(){return this.group===null&&(this.group=new m.A("g"),this.group.attr("class",this.name),this.group.setDataEntry(st,this.partUuid)),this.group},L.move=function(){this.getGroup().attr("transform",`translate(0, ${this.posY})`)},L.getMeasuresHorizontalData=function(e){const i=this.staves.map(function(O){return O.getMeasuresHorizontalData(e)});return Array.prototype.concat.apply([],i)},L.dispatchHorizontalFormattingForVerticalComputation=function(e){this.staves.forEach(i=>i.dispatchHorizontalFormattingForVerticalComputation(e))},L.updateCrossMeasuresHorizontalDisplayForVerticalComputation=function(){this.staves.forEach(e=>e.updateCrossMeasuresHorizontalDisplayForVerticalComputation())},L.dispatchHorizontalFormatting=function(e){this.staves.forEach(i=>i.dispatchHorizontalFormatting(e))},L.dispatchVerticalFormatting=function(){this.staves.forEach(e=>e.dispatchVerticalFormatting())},L.drawCursor=function(e,i){this.getStaff(e.staffIdx).drawCursor(e,i)},L.drawGraceCursor=function(e,i){this.getStaff(e.staffIdx).drawGraceCursor(e,i)},L.drawTabCursor=function(e,i){if(i.hasNoteCursor()){const X=i.getNoteCursor();this.getStaff(0).drawCursor(e,X)}const g=i.getFretCursor();this.getStaff(1).drawCursor(e,g)},L.drawDynamicCursor=function(e,i){this.getStaff(e.staffIdx).drawDynamicCursor(e,i)},L.drawPizzicatoCursor=function(e,i){this.getStaff(e.staffIdx).drawPizzicatoCursor(e,i)},L.drawMuteCursor=function(e,i){this.getStaff(e.staffIdx).drawMuteCursor(e,i)},L.drawHorizontalCursor=function(e,i){this.getStaff(e.staffIdx).drawHorizontalCursor(e,i)},L.drawHorizontalCursorTimePos=function(e,i){this.getStaff(e.staffIdx).drawHorizontalCursorTimePos(e,i)},L.drawHorizontalMeasureWideCursor=function(e,i){this.getStaff(e.staffIdx).drawHorizontalMeasureWideCursor(e,i)},L.drawCrossMeasureNoteCursor=function(e,i){this.getStaff(e.staffIdx).drawCrossMeasureNoteCursor(e,i)},L.setNoteColor=function(e,i){this.getStaff(e.staffIdx).setNoteColor(e,i)},L.dropVerticalFormatting=function(){this.verticalFormattingBySystemLocation={},this.staves.forEach(e=>e.dropVerticalFormatting())},L.setFirstStaffMeasuresGapAbove=function(e){this.getFirstStaff().setMeasuresGapAbove(e)},L.setLastStaffMeasuresGapBelow=function(e){this.getLastStaff().setMeasuresGapBelow(e)},L.connectWith=function(e){const g=e.posY-this.posY+e.getSpaceAboveFirstStaff()-(this.getSpaceAboveFirstStaff()+this.getInnerHeight());this.getLastStaff().extendBarlines(g)},L.extendInnerBarlines=function(){for(let e=0;e<this.staves.length-1;e++){const i=this.getStaff(e),g=this.getStaff(e+1);i.connectWith(g)}},L.reloadAllCrossMeasures=function(){this.staves.forEach(e=>e.reloadCrossMeasures())},L.getNbMeasures=function(){return this.getAnyStaff().getNbMeasures()},L.getNbStaves=function(){return this.staves.length},L.getWidth=function(){return this.getAnyStaff().getWidth()},L.getMiddleY=function(e){const i=this.getSpaceAboveFirstStaff();if(e&&this.hasRecorderTabs()){const O=this.getFirstStaffInnerHeight();return i+O/2}const g=this.getInnerHeight();return i+g/2},L.getFirstStaffInnerHeight=function(){return this.getFirstStaff().getInnerHeight()},L.getInnerHeight=function(){const e=this.getSpaceAboveFirstStaff(),i=this.getSpaceBelowLastStaff();return this.getHeight()-e-i},L.getSpaceAboveFirstStaff=function(){const i=this.getFirstStaff().getSpaceAbove();return Math.max(i,this.headerSpaceAbove)},L.getNotesSpaceAboveFirstStaff=function(){return this.getFirstStaff().getNotesSpaceAbove()},L.getFirstStaff=function(){return this.staves[0]},L.getSpaceBelowLastStaff=function(){const i=this.getLastStaff().getSpaceBelow();return Math.max(i,this.headerSpaceBelow)},L.getNotesSpaceBelowLastStaff=function(){return this.getLastStaff().getNotesSpaceBelow()},L.getLastStaff=function(){const i=this.getNbStaves()-1;return this.staves[i]},L.getHeight=function(){return typeof this.verticalFormattingBySystemLocation[this.location]=="undefined"&&this.calcHeight(),this.verticalFormattingBySystemLocation[this.location]},L.calcHeight=function(){let e=this.staves.reduce(I,0);e+=this.getTopBrackedDiff()+this.getBottomBrackedDiff(),this.verticalFormattingBySystemLocation[this.location]=e};function I(e,i,g,O){const X=i.getHeight();if(e+=X,g>0){const ft=i.getDrawingContext(),Ut=O[g-1],Zt=W(Ut,i,ft);e+=Zt}return e}function W(e,i,g){const O=V(e,i,g),X=e.getSpaceBelow(),ft=i.getSpaceAbove();return O-X-ft}function V(e,i,g){const O=e.getSpaceBelow(),X=i.getSpaceAbove(),ft=g.getSpaceSize()*C,Ut=O+X+ft,Zt=e.getNotesSpaceBelow(),De=i.getNotesSpaceAbove(),Ie=g.getSpaceSize()*_,me=Zt+De+Ie,Qs=g.getSpaceBetweenStaves();return Math.max(Ut,me,Qs)}L.getTopBrackedDiff=function(){const i=this.getFirstStaff().getSpaceAbove(),g=this.headerSpaceAbove-i;return Math.max(g,0)},L.getBottomBrackedDiff=function(){const i=this.getLastStaff().getSpaceBelow(),g=this.headerSpaceBelow-i;return Math.max(g,0)},L.getStaffLyricsUpY=function(e,i,g){return this.getStaff(e).getLyricsUpY(i,g)},L.getStaffWordsY=function(e,i,g){return this.getStaff(e).getMeasureWordsY(i,g)},L.getChordsY=function(e){return this.getStaff(0).getChordsY(e)},L.getTopStaffClassicHarmonyY=function(e){return this.getStaff(0).getClassicHarmonyY(e)},L.getBottomStaffClassicHarmonyY=function(e){const i=this.getNbStaves();return this.getStaff(i-1).getClassicHarmonyY(e)},L.getBottomStaffFiguredBassY=function(e,i){const g=this.getNbStaves();return this.getStaff(g-1).getFiguredBassY(e,i)},L.getMeasureWidth=function(e){return this.getStaff(0).getMeasureWidth(e)},L.getMeasurePosX=function(e){return this.getStaff(0).getMeasurePosX(e)},L.getNoteXInMeasure=function(e,i,g,O){return this.getStaff(e).getNoteXInMeasure(i,g,O)},L.getTimePosXInMeasure=function(e,i,g,O){return this.getStaff(e).getTimePosXInMeasure(i,g,O)},L.getStaffHeight=function(e){return this.getStaff(e).getHeight()},L.getSpaceAboveStaff=function(e){return this.getStaff(e).getSpaceAbove()},L.getMeasureNbNotes=function(e,i,g){return this.getStaff(e).getMeasureNbNotes(i,g)},L.resetGeometries=function(){this.staves.forEach(it)};const it=function(e){e.resetGeometries()};L.getMeasureGeometry=function(e){return this.staves.map(function(O){return O.getMeasureGeometry(e)}).filter(Pt)};const Pt=function(e){return e.isNew};L.hasDrawingContext=function(){return this.drawingContext!==null},L.getAnyStaff=function(){return this.getStaff(0)},L.getMeasureFullAttributesGroup=function(e,i){return this.getStaff(e).getMeasureFullAttributesGroup(i)},L.getStaffInnerHeight=function(e){return this.getStaff(e).getInnerHeight()},L.getStaffElem=function(e){return this.getStaff(e).getGroup()},L.updateMeasuresEventsRects=function(){this.staves.forEach(Yt)};function Yt(e){e.updateMeasuresEventsRects()}L.getStaff=function(e){return this.checkStaffIdx(e),this.staves[e]},L.checkStaffIdx=function(e){if(typeof e!="number"||Number.isNaN(e)||e<0||e>=this.staves.length){const i=`Invalid staffIdx: [${e}].`;throw new b.default("BadStaffIdx",i)}},L.getPosY=function(){return this.posY},L.getDrawingContext=function(){return this.drawingContext},L.getNominalInnerHeight=function(){if(this.nominalInnerHeight===null){const i=this.drawingContext.getSpaceBetweenStaves()*(this.getNbStaves()-1),O=this.staves.map(Bt).reduce(v.default.add);this.nominalInnerHeight=O+i}return this.nominalInnerHeight};const Bt=function(e){return e.getStaffHeight()};L.addVoice=function(e,i){this.getStaff(e).fillVoice(i)},L.getMeasureElem=function(e,i){return this.getStaff(e).getMeasureElem(i)},L.getMeasureEventRect=function(e,i){return this.getStaff(e).getMeasureEventRect(i)},L.getBottomMeasureElem=function(e){return this.getLastStaff().getMeasureElem(e)},L.setFirstDisplayedMeasure=function(e){this.staves.forEach(i=>{i.setFirstDisplayedMeasure(e)})},L.isEmpty=function(){return this.staves.every(e=>e.isEmpty())},L.setInsertionPoint=function(e){this.insertionPoint=e},L.updateBinding=function(){if(!this.needUpdateBinding())return;const e=this.getGroup();this.parent===null?e.removeFromParent():this.insertionPoint===null?this.parent.append(e):this.parent.insertBefore(e,this.insertionPoint),this.currentParent=this.parent},L.needUpdateBinding=function(){return this.parent!==this.currentParent},L.bindStaves=function(){const e=this.getGroup();this.staves.forEach(i=>{i.setParent(e),i.bindToParent()})},L.updateMeasureNumbers=function(){this.staves.forEach(e=>e.updateMeasureNumbers())},L.drawVerticalDebug=function(){this.staves.forEach(function(e){e.drawVerticalDebug()})};const le=F,ie=function(e){this.init(e)},K=ie.prototype;K.init=function(e){this.header=new p(e),this.content=new le(e),this.idx=null,this.partUuid=e,this.firstOfShard=!1,this.drawingContext=null,this.isRecorderTab=null},K.getPartUuid=function(){return this.partUuid},K.setHeaderParent=function(e){this.header.setParent(e)},K.setIsMinimalName=function(e){this.header.setIsMinimalName(e)},K.toggleMinimalName=function(e){this.header.toggleMinimalName(e)},K.isMinimalName=function(){return this.header.isMinimalName},K.setContentParent=function(e){this.content.setParent(e)},K.setDrawingContext=function(e){this.drawingContext=e,this.content.setDrawingContext(e),this.header.setDrawingContext(e)},K.setName=function(e){this.header.setTextString(e)},K.setSmallName=function(e){this.header.setSmallName(e)},K.setGroupIdx=function(e){this.header.setGroupIdx(e)},K.getGroupIdx=function(){return this.header.getGroupIdx()},K.setHasGroupStart=function(e){this.header.setHasGroupStart(e)},K.setHasGroupStop=function(e){this.header.setHasGroupStop(e)},K.setGroupBracket=function(e){e!==null&&e.addSystem(this),this.header!==null&&this.header.setGroupBracket(e)},K.setLocation=function(e){this.content.setLocation(e)},K.hasGroup=function(){return this.header.hasGroup()},K.hasGroupBracket=function(){return this.header.hasGroupBracket()},K.hasGroupStart=function(){return this.header.hasGroupStart()},K.hasGroupStop=function(){return this.header.hasGroupStop()},K.getGroupBracket=function(){return this.header.getGroupBracket()},K.getGroupBracketOffset=function(){return this.header.getGroupBracketOffset()},K.dropHeaderWidth=function(){this.header.dropWidth()},K.connectWith=function(e){this.content.connectWith(e.content)},K.addStaff=function(e){this.content.addStaff(e);const i=this.getNbStaves();this.header.setNbStaves(i)},K.transferHeaderExternalSpace=function(){const e=this.header.getSpaceAboveFirstStaff();this.content.setHeaderSpaceAbove(e);const i=this.header.getSpaceBelowLastStaff();this.content.setHeaderSpaceBelow(i)},K.setClampType=function(e){this.header.setClampType(e)},K.setHeaderX=function(e){this.header.setPosX(e)},K.setContentY=function(e){this.content.setPosition(e),this.header.setSystemPosY(e)},K.setIsRecorderTab=function(e){this.isRecorderTab=e,this.header.setIsRecorderTab(e),this.content.setIsRecorderTab(e)},K.hasRecorderTabs=function(){return!!this.isRecorderTab},K.setIdx=function(e){this.idx=e},K.replaceMeasure=function(e,i){this.content.replaceMeasure(e,i)},K.insertMeasure=function(e,i){this.content.insertMeasure(e,i)},K.removeMeasure=function(e){this.content.removeMeasure(e)},K.needUpdateContentBinding=function(){return this.content.needUpdateBinding()},K.setContentInsertionPoint=function(e){this.content.setInsertionPoint(e)},K.updateContentBinding=function(){this.content.updateBinding()},K.updateMeasuresBindings=function(){this.content.updateMeasuresBindings()},K.getContentGroup=function(){return this.content.getGroup()},K.needUpdateHeaderBinding=function(){return this.header.needUpdateBinding()},K.setHeaderInsertionPoint=function(e){this.header.setInsertionPoint(e)},K.updateHeaderBinding=function(){this.header.updateBinding()},K.getHeaderGroup=function(){return this.header.getGroup()},K.drawContentRec=function(){this.header.drawContentRec(),this.content.drawContentRec()},K.move=function(){this.header.move(),this.content.move()},K.getMeasuresHorizontalData=function(e){return this.content.getMeasuresHorizontalData(e)},K.dispatchHorizontalFormattingForVerticalComputation=function(e){this.content.dispatchHorizontalFormattingForVerticalComputation(e)},K.updateCrossMeasuresHorizontalDisplayForVerticalComputation=function(){this.content.updateCrossMeasuresHorizontalDisplayForVerticalComputation()},K.dispatchHorizontalFormatting=function(e){this.content.dispatchHorizontalFormatting(e)},K.dispatchVerticalFormatting=function(){this.content.dispatchVerticalFormatting(),this.fillHeaderVerticalData()},K.fillHeaderVerticalData=function(){const e=this.content.getMiddleY(!0);this.header.setMiddleY(e);const i=this.content.getInnerHeight();this.header.setBraceHeight(i)},K.drawCursor=function(e,i){this.content.drawCursor(e,i)},K.drawGraceCursor=function(e,i){this.content.drawGraceCursor(e,i)},K.drawTabCursor=function(e,i){this.content.drawTabCursor(e,i)},K.drawDynamicCursor=function(e,i){this.content.drawDynamicCursor(e,i)},K.drawPizzicatoCursor=function(e,i){this.content.drawPizzicatoCursor(e,i)},K.drawMuteCursor=function(e,i){this.content.drawMuteCursor(e,i)},K.drawHorizontalCursor=function(e,i){this.content.drawHorizontalCursor(e,i)},K.drawHorizontalCursorTimePos=function(e,i){this.content.drawHorizontalCursorTimePos(e,i)},K.drawHorizontalMeasureWideCursor=function(e,i){this.content.drawHorizontalMeasureWideCursor(e,i)},K.drawCrossMeasureNoteCursor=function(e,i){this.content.drawCrossMeasureNoteCursor(e,i)},K.setNoteColor=function(e,i){this.content.setNoteColor(e,i)},K.dropVerticalFormatting=function(){this.content.dropVerticalFormatting()},K.initNominalHeight=function(){const e=this.content.getNominalInnerHeight();this.header.setNominalHeight(e)},K.setHeaderPosX=function(e){this.header.setPosX(e)},K.extendInnerBarlines=function(){this.content.extendInnerBarlines()},K.reloadAllCrossMeasures=function(){this.content.reloadAllCrossMeasures()},K.getHeight=function(){return this.content.getHeight()},K.getInnerHeight=function(){return this.content.getInnerHeight()},K.getStaffInnerHeight=function(e){return this.content.getStaffInnerHeight(e)},K.updateMeasuresEventsRects=function(){this.content.updateMeasuresEventsRects()},K.getStaffElem=function(e){return this.content.getStaffElem(e)},K.getStaffLyricsUpY=function(e,i,g){return this.content.getStaffLyricsUpY(e,i,g)},K.getStaffWordsY=function(e,i,g){return this.content.getStaffWordsY(e,i,g)},K.getChordsY=function(e){return this.content.getChordsY(e)},K.getTopStaffClassicHarmonyY=function(e){return this.content.getTopStaffClassicHarmonyY(e)},K.getBottomStaffClassicHarmonyY=function(e){return this.content.getBottomStaffClassicHarmonyY(e)},K.getBottomStaffFiguredBassY=function(e,i){return this.content.getBottomStaffFiguredBassY(e,i)},K.getMeasurePosX=function(e){return this.content.getMeasurePosX(e)},K.getMeasureWidth=function(e){return this.content.getMeasureWidth(e)},K.getNoteXInMeasure=function(e,i,g,O){return this.content.getNoteXInMeasure(e,i,g,O)},K.getTimePosXInMeasure=function(e,i,g,O){return this.content.getTimePosXInMeasure(e,i,g,O)},K.getStaffHeight=function(e){return this.content.getStaffHeight(e)},K.getSpaceAboveStaff=function(e){return this.content.getSpaceAboveStaff(e)},K.getMeasureNbNotes=function(e,i,g){return this.content.getMeasureNbNotes(e,i,g)},K.getMeasureFullAttributesGroup=function(e,i){return this.content.getMeasureFullAttributesGroup(e,i)},K.resetGeometries=function(){this.content.resetGeometries()},K.getMeasureGeometry=function(e){return this.content.getMeasureGeometry(e)},K.getSpaceAboveFirstStaff=function(){return this.content.getSpaceAboveFirstStaff()},K.getSpaceBelowLastStaff=function(){return this.content.getSpaceBelowLastStaff()},K.getNotesSpaceAboveFirstStaff=function(){return this.content.getNotesSpaceAboveFirstStaff()},K.getNotesSpaceBelowLastStaff=function(){return this.content.getNotesSpaceBelowLastStaff()},K.setFirstStaffMeasuresGapAbove=function(e){this.content.setFirstStaffMeasuresGapAbove(e)},K.setLastStaffMeasuresGapBelow=function(e){this.content.setLastStaffMeasuresGapBelow(e)},K.getDrawingContext=function(){return this.drawingContext},K.getNbMeasures=function(){return this.content.getNbMeasures()},K.getNbStaves=function(){return this.content.getNbStaves()},K.getHeaderWidth=function(){return this.header.getWidth()},K.getContentWidth=function(){return this.content.getWidth()},K.getPosY=function(){return this.content.getPosY()},K.getStructure=function(){return this.idx},K.injectHeader=function(e){const i=this.header,g=i.parent;i.setParent(null),i.updateBinding(),e.setParent(g),this.header=e},K.extractHeader=function(){const e=this.header;return e.setParent(null),this.header=null,e},K.getMeasureElem=function(e,i){return this.content.getMeasureElem(e,i)},K.getMeasureEventRect=function(e,i){return this.content.getMeasureEventRect(e,i)},K.getBottomMeasureElem=function(e){return this.content.getBottomMeasureElem(e)},K.setFirstOfShard=function(e){this.firstOfShard=e},K.isFirstOfShard=function(){return this.firstOfShard},K.isEmpty=function(){return this.content.isEmpty()},K.drawVerticalDebug=function(){this.content.drawVerticalDebug()},K.addVoice=function(e,i){this.content.addVoice(e,i)},K.setFirstDisplayedMeasure=function(e){this.content.setFirstDisplayedMeasure(e)},K.bindStaves=function(){this.content.bindStaves()},K.updateMeasureNumbers=function(){this.content.updateMeasureNumbers()};const pe=ie;var Ee=r(903828);function tt(e){const i={},g=e.getWedges(),O=e.getAllSlurs();let X=e.getMeasures(),ft=(0,Ee.A)(X,g,O);i.measures=ft,ft=ft.slice(e.firstDisplayedMeasureIdx),X=X.slice(e.firstDisplayedMeasureIdx);const[Ut]=ft;return Et(i,Ut),Vt(e,ft,X),gt(i,ft),i}function Et(e,i){e.height=i.getHeight(),e.spaceAbove=i.getSpaceAboveStaff(),e.spaceBelow=i.getSpaceBelowStaff()}function Vt(e,i,g){const O=ct(i,g);e.setLyricsUpY(O)}function ct(e,i){const g=i.findIndex(fe,e);return g!==-1?e[g].getLyricsY():null}function fe(e,i){return this[i].hasLyrics()&&e.isInDisplayedRange()}function gt(e,i){let g=0,O=0;i.forEach(X=>{const ft=X.getNotesUpOverflow();g=Math.max(g,ft);const Ut=X.getNotesDownOverflow();O=Math.max(O,Ut)}),e.notesSpaceAbove=g,e.notesSpaceBelow=O}var At=r(2255);function Ht(e,i){const g=e.getDrawingContext(),O=g.getMeasureLocationForMeasureIdx(i),X=e.getMeasuresHorizontalData(i),ft=g.getNotesFormatter(),Ut=new At.A(g,X,ft);Ut.format();const Zt=Ut.getFormatting();return Zt.setMeasurePosition(O),Zt}var Wt=r(188075),k=r(866205),St=r(191581),yt=r(130452),Ct=r(920939);const Mt=function(){this.init()};Mt.cssClass="tie";const Tt=Mt.prototype;Tt.cssClass=Mt.cssClass,Tt.init=function(){this.arcs=null,this.leftAnchor=null,this.rightAnchor=null,this.displayData=null,this.drawingContext=null,this.parent=null,this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass),this.drawn=!1},Tt.setParent=function(e){this.parent=e},Tt.setLeftAnchor=function(e){this.hasLeftAnchor()&&this.leftAnchor!==e&&this.removeLeftAnchor(),this.leftAnchor=e,this.leftAnchor.tie=this},Tt.hasLeftAnchor=function(){return this.leftAnchor!==null},Tt.removeLeftAnchor=function(){this.discardArcs(),this.leftAnchor.tie=null,this.leftAnchor=null},Tt.setRightAnchor=function(e){this.hasRightAnchor()&&this.rightAnchor!==e&&this.removeRightAnchor(),this.rightAnchor=e,this.rightAnchor.tie=this},Tt.hasRightAnchor=function(){return this.rightAnchor!==null},Tt.removeRightAnchor=function(){this.discardArcs(),this.rightAnchor.tie=null,this.rightAnchor=null},Tt.discardArcs=function(){this.displayData=null,this.arcs!==null&&(this.arcs.forEach(nt),this.arcs=null)};const nt=function(e){e.erase()};Tt.setDrawingContext=function(e){this.drawingContext=e},Tt.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},Tt.initArcs=function(){this.displayData=new k.A;const e=this.rightAnchor.note;this.displayData.setRightNote(e.getDisplayData());const i=this.leftAnchor.note;this.displayData.setLeftNote(i.getDisplayData()),this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},Tt.initArc=function(e){const g=this.leftAnchor.note.getMiddleHeadWidth(),O=yt.A.getLeft(e,g),ft=this.rightAnchor.note.getMiddleHeadWidth(),Ut=yt.A.getRight(e,ft),Zt=yt.A.getVertical(e,this.drawingContext),De=f.A.getNbStaffLines(e.staffData),Ie=f.A.isTabStaff(e.staffData),me=this.lineToY(e.line,Ie,De)+Zt,ni=this.lineToY(e.rightLine,Ie,De)+Zt-me,oo=new Wt.A(this.getGroup(),O,Ut,e.placement,ni);oo.setPosY(me),oo.setDrawingContext(this.drawingContext),this.arcs.push(oo)},Tt.lineToY=function(e,i,g){const O=i?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return Ct.A.lineToY(e,O,g)},Tt.updateArcs=function(){this.getArcs().forEach(this.updateArc,this)},Tt.updateArc=function(e){const i=this.drawingContext.getTieHorizontalMargin(),g=this.getLeftOffset(),X=this.leftAnchor.note.getXPos()+i+g,ft=this.getRightOffset(),De=this.rightAnchor.note.getXPos()-i+ft-X,me=te()(De);e.setSize(De,me),e.setPosX(X)},Tt.getLeftOffset=function(){const e=this.leftAnchor.measure,i=e.tickableContent;return e.getXPos()+i.getXPos()},Tt.getRightOffset=function(){const e=this.rightAnchor.measure,i=e.tickableContent;return e.getXPos()+i.getXPos()},Tt.draw=function(){this.updateArcs(),this.getArcs().forEach(vt),this.bindToParent()};const vt=function(e){e.draw()};Tt.bindToParent=function(){this.parent!==null&&(this.parent.append(this.getGroup()),this.drawn=!0)},Tt.getGroup=function(){return this.svgGroup},Tt.erase=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},Tt.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},Tt.getType=function(){return St.A.CROSS_MEASURE},Tt.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()};let Nt=null;const te=function(){if(Nt===null){const i=.6666666666666666,X=v.default.solveLinearA(3,i,30,2),ft=v.default.solveLinearB(3,i,X);Nt=function(Ut){return X*Ut+ft}}return Nt};Tt.getTopY=function(){const e=this.getTopArc(),i=e.getTopY();return e.posY+i},Tt.getTopArc=function(){return this.getArcs()[0]},Tt.getBottomY=function(){const e=this.getBottomArc(),i=e.getBottomY();return e.posY+i},Tt.getBottomArc=function(){const e=this.getArcs(),i=e.length-1;return e[i]};const ee=Mt;var Ot=r(339406),ot=r(737903);const rt=function(e){this.init(e)};rt.cssClass="tie";const at=rt.prototype;at.cssClass=rt.cssClass,at.init=function(e){this.arcs=null,this.anchor=e,e.tie=this,this.displayData=new k.A,this.drawingContext=null,this.parent=null,this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},at.setParent=function(e){this.parent=e},at.setDrawingContext=function(e){this.drawingContext=e},at.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},at.initArcs=function(){const e=this.anchor.getNote().getDisplayData();let i=this.anchor.getRightNote();const g=(0,ot.default)(i.opts);i=new Ot.A(g);const O=e.getBeamData();i.setBeamData(O),i.opts.hasBeam=e.hasBeam(),this.displayData.setLeftNote(e),this.displayData.setRightNote(i),this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},at.initArc=function(e){const g=this.anchor.note.getMiddleHeadWidth(),O=yt.A.getLeft(e,g),X=0,ft=new Wt.A(this.getGroup(),O,0,e.placement,X),Ut=f.A.getNbStaffLines(e.staffData),Zt=f.A.isTabStaff(e.staffData);let De=this.lineToY(e.line,Zt,Ut);De+=yt.A.getVertical(e,this.drawingContext),ft.setPosY(De),ft.setDrawingContext(this.drawingContext),this.arcs.push(ft)},at.lineToY=function(e,i,g){const O=i?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return Ct.A.lineToY(e,O,g)},at.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},at.updateArc=function(e){const i=this.anchor.note,g=this.anchor.measure,O=g.tickableContent,X=g.getXPos()+O.getXPos(),ft=X+O.getWidth(),Ut=this.drawingContext.getTieHorizontalMargin(),Zt=X+i.getXPos()+Ut,De=ft-Zt,me=ue()(De);e.setSize(De,me),e.setPosX(Zt)},at.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},at.draw=function(){this.updateArcs(),this.getArcs().forEach(_t),this.bindToParent()};const _t=function(e){e.draw()};at.bindToParent=function(){this.parent!==null&&(this.parent.append(this.getGroup()),this.drawn=!0)},at.getGroup=function(){return this.svgGroup},at.erase=function(){this.anchor.tie=null,this.drawn&&this.unbindFromParent()},at.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},at.getType=function(){return St.A.RIGHT},at.isComplete=function(){return!0};let qt=null;const ue=function(){if(qt===null){const i=.6666666666666666,X=v.default.solveLinearA(3,i,30,2),ft=v.default.solveLinearB(3,i,X);qt=function(Ut){return X*Ut+ft}}return qt};at.getTopY=function(){const e=this.getTopArc(),i=e.getTopY();return e.posY+i},at.getTopArc=function(){return this.getArcs()[0]},at.getBottomY=function(){const e=this.getBottomArc(),i=e.getBottomY();return e.posY+i},at.getBottomArc=function(){const e=this.getArcs(),i=e.length-1;return e[i]};const ne=rt,be=function(e){this.init(e)};be.cssClass="tie";const oe=be.prototype;oe.cssClass=be.cssClass,oe.init=function(e){this.arcs=null,this.anchor=e,e.tie=this,this.displayData=new k.A,this.drawingContext=null,this.parent=null,this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},oe.setParent=function(e){this.parent=e},oe.setDrawingContext=function(e){this.drawingContext=e},oe.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},oe.initArcs=function(){let e=this.anchor.getLeftNote();const i=(0,ot.default)(e.opts);e=new Ot.A(i);const g=this.anchor.getNote().getDisplayData(),O=g.getBeamData();e.setBeamData(O),e.opts.hasBeam=g.hasBeam(),this.displayData.setLeftNote(e),this.displayData.setRightNote(g),this.displayData.fillData(),this.arcs=[],this.displayData.forEachTie(this.initArc,this)},oe.initArc=function(e){const g=this.anchor.note.getMiddleHeadWidth(),O=yt.A.getRight(e,g),X=0,ft=new Wt.A(this.getGroup(),0,O,e.placement,X),Ut=f.A.getNbStaffLines(e.staffData),Zt=f.A.isTabStaff(e.staffData);let De=this.lineToY(e.line,Zt,Ut);De+=yt.A.getVertical(e,this.drawingContext),ft.setPosY(De),ft.setDrawingContext(this.drawingContext),this.arcs.push(ft)},oe.lineToY=function(e,i,g){const O=i?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return Ct.A.lineToY(e,O,g)},oe.updateArcs=function(){this.getArcs().forEach(this.updateArc,this),this.needDrawUpdate=!1},oe.updateArc=function(e){const i=this.anchor.note,g=this.anchor.measure,O=g.tickableContent,X=g.getXPos()+O.getXPos(),ft=X-O.getPreviousSpace(),Ut=this.drawingContext.getTieHorizontalMargin(),De=X+i.getXPos()-Ut-ft,me=Xt()(De);e.setSize(De,me),e.setPosX(ft)},oe.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},oe.draw=function(){this.updateArcs(),this.getArcs().forEach(us),this.bindToParent()};const us=function(e){e.draw()};oe.bindToParent=function(){this.parent!==null&&(this.parent.append(this.getGroup()),this.drawn=!0)},oe.getGroup=function(){return this.svgGroup},oe.erase=function(){this.anchor.tie=null,this.drawn&&this.unbindFromParent()},oe.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},oe.getType=function(){return St.A.LEFT},oe.isComplete=function(){return!0};let Q=null;const Xt=function(){if(Q===null){const i=.6666666666666666,X=v.default.solveLinearA(3,i,30,2),ft=v.default.solveLinearB(3,i,X);Q=function(Ut){return X*Ut+ft}}return Q};oe.getTopY=function(){const e=this.getTopArc(),i=e.getTopY();return e.posY+i},oe.getTopArc=function(){return this.getArcs()[0]},oe.getBottomY=function(){const e=this.getBottomArc(),i=e.getBottomY();return e.posY+i},oe.getBottomArc=function(){const e=this.getArcs(),i=e.length-1;return e[i]};const bt=be,ve=function(e){this.init(e)},Qt=ve.prototype;Qt.cssClass="staffTies",Qt.init=function(e){this.voiceIdx=e,this.drawingContext=null,this.staffData=null,this.posY=null,this.group=null,this.parent=null,this.ties=[],this.pendingCrossMeasure=null,this.drawn=!1},Qt.setDrawingContext=function(e){this.drawingContext=e,this.ties.forEach(this.transferDrawingContext,this)},Qt.setStaffData=function(e){this.staffData=e},Qt.removeMeasure=function(e){if(e.hasLeftTieAnchor(this.voiceIdx)){const i=e.getLeftTieAnchor(this.voiceIdx);i.hasTie()&&this.removeTie(i.getTie())}if(e.hasRightTieAnchor(this.voiceIdx)){const i=e.getRightTieAnchor(this.voiceIdx);i.hasTie()&&this.removeTie(i.getTie())}},Qt.setParent=function(e){this.parent=e},Qt.setPosition=function(e){this.posY=e},Qt.needRender=function(){return this.group===null},Qt.hasPendingCrossMeasure=function(){return this.pendingCrossMeasure!==null},Qt.removeTies=function(){this.ties.forEach(ae),this.ties=[]};function ae(e){e.erase()}Qt.removeTie=function(e){const i=this.ties.indexOf(e);this.ties.splice(i,1),e.erase()},Qt.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.ties.forEach(this.transfertParent,this)},Qt.draw=function(){this.needRender()&&this.render(),this.ties.forEach(fs),this.move(),this.bindToParent()};function fs(e){e.draw()}Qt.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},Qt.move=function(){this.needRender()||this.group.attr("transform",`translate(0, ${this.posY})`)},Qt.updateHorizontalDisplay=function(){this.ties.forEach(ds)},Qt.updateFromMeasures=function(e,i){this.hasTies()&&this.removeTies(),this.ties=this.extractTies(e,i),this.ties.forEach(this.transferDrawingContext,this),this.needRender()||this.ties.forEach(this.transfertParent,this)},Qt.hasTies=function(){return this.ties.length>0},Qt.transfertParent=function(e){e.setParent(this.group)},Qt.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},Qt.extractTies=function(e,i){const g=[];for(let O=i;O<e.length;O++){const X=e[O],ft=O===i,Ut=O===e.length-1;if(X.hasLeftTieAnchor(this.voiceIdx)){const Zt=X.getLeftTieAnchor(this.voiceIdx);ft?g.push(new bt(Zt)):this.closePendingCrossMeasure(Zt,g)}if(X.hasRightTieAnchor(this.voiceIdx)){const Zt=X.getRightTieAnchor(this.voiceIdx);Ut?g.push(new ne(Zt)):this.openPendingCrossMeasure(Zt)}}return g},Qt.openPendingCrossMeasure=function(e){this.hasPendingCrossMeasure()||(this.pendingCrossMeasure=new ee),this.pendingCrossMeasure.setLeftAnchor(e)},Qt.closePendingCrossMeasure=function(e,i){this.hasPendingCrossMeasure()&&(this.pendingCrossMeasure.setRightAnchor(e),i.push(this.pendingCrossMeasure),this.pendingCrossMeasure=null)};function ds(e){e.draw()}const Xe=ve;var U=r(711527),Gt=r(491197),It=r(843678);const xt=function(){this.init()};xt.cssClass="crossMeasureHyphen";const zt=xt.prototype;zt.cssClass=xt.cssClass,zt.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.hyphens={},this.drawingContext=null,this.parent=null,this.svgGroup=null,this.needDrawUpdate=!0,this.drawn=!1},zt.setParent=function(e){this.parent=e},zt.setLeftAnchor=function(e){this.hasLeftAnchor()&&this.leftAnchor!==e&&this.removeLeftAnchor(),this.leftAnchor=e,this.leftAnchor.hyphen=this},zt.setRightAnchor=function(e){this.hasRightAnchor()&&this.rightAnchor!==e&&this.removeRightAnchor(),this.rightAnchor=e,this.rightAnchor.hyphen=this},zt.setDrawingContext=function(e){this.drawingContext=e,this.isRendered()&&this.forEachHyphen(this.dispatchDrawingContext,this)},zt.dispatchDrawingContext=function(e,i){i.setDrawingContext(this.drawingContext)},zt.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},zt.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()},zt.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},zt.hasLeftAnchor=function(){return this.leftAnchor!==null},zt.hasRightAnchor=function(){return this.rightAnchor!==null},zt.removeLeftAnchor=function(){this.hide(),this.leftAnchor.hyphen=null,this.leftAnchor=null},zt.removeRightAnchor=function(){this.hide(),this.rightAnchor.hyphen=null,this.rightAnchor=null},zt.hide=function(){this.drawn&&this.unbindFromParent()},zt.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},zt.getLeftMeasureIdx=function(){return this.getLeftAnchor().getMeasureIdx()},zt.getRightMeasureIdx=function(){return this.getRightAnchor().getMeasureIdx()},zt.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.needDrawUpdate&&(this.updateHyphens(),this.updateHyphensHorizontal()),this.drawHyphens(),this.bindToParent()},zt.updateHyphens=function(){const e=this.computeConnections();this.removeUnreferencedHyphens(e),this.addMissingHyphens(e);const i=It.default.map(e,Gt.A);this.updateHyphensPositions(i)},zt.computeConnections=function(){const e={};return this.getLeftAnchor().getLevels().forEach(Ne,e),this.getRightAnchor().getLevels().forEach(pi,e),e};const Ne=function(e){const g=Os(this,e);g.left=!0},pi=function(e){const g=Os(this,e);g.right=!0},Os=function(e,i){return typeof e[i]=="undefined"&&(e[i]={left:!1,right:!1}),e[i]};zt.removeUnreferencedHyphens=function(e){for(const i in this.hyphens)typeof e[i]=="undefined"&&(this.hyphens[i].erase(),delete this.hyphens[i])},zt.addMissingHyphens=function(e){for(const i in e)if(typeof this.hyphens[i]=="undefined"){const O=new U.A(null);O.setDrawingContext(this.drawingContext),O.setParent(this.svgGroup),this.hyphens[i]=O}},zt.updateHyphensPositions=function(e){It.default.forEach(e,this.updateHyphenPosition,this)},zt.updateHyphenPosition=function(e,i){this.hyphens[e].setPosition(i)},zt.updateHyphensHorizontal=function(){this.forEachHyphen(this.updateHyphenHorizontal,this),this.needDrawUpdate=!1},zt.updateHyphenHorizontal=function(e,i){const O=this.getLeftAnchor().getX(e),Ut=this.getRightAnchor().getX(e)-O;i.setWidth(Ut),i.setPosX(O)},zt.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.updateHyphensVertical(),this.drawHyphens(),this.bindToParent()},zt.isRendered=function(){return this.svgGroup!==null},zt.render=function(){this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass)},zt.updateHyphensVertical=function(){this.forEachHyphen(this.updateHyphenVertical,this)},zt.updateHyphenVertical=function(e,i){const g=this.getLevelPosY(e);i.setPosY(g)},zt.getLevelPosY=function(e){const i=this.getLeftAnchor(),g=this.getRightAnchor();if(i.hasLyricLevel(e))return i.getLyricLevelPosY(e);if(g.hasLyricLevel(e))return g.getLyricLevelPosY(e);{const O=`There should be at least one lyric side at the level [${e}].`;throw new b.default("Unexpected",O)}},zt.getLeftAnchor=function(){return this.leftAnchor},zt.getRightAnchor=function(){return this.rightAnchor},zt.drawHyphens=function(){this.forEachHyphen(on)},zt.forEachHyphen=function(e,i){It.default.forEach(this.hyphens,e,i)};const on=function(e,i){i.draw()};zt.draw=function(){this.isRendered()||this.render(),this.updateHyphens(),this.updateHyphensHorizontal(),this.updateHyphensVertical(),this.drawHyphens(),this.bindToParent()},zt.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},zt.getGroup=function(){return this.svgGroup};const Fi=xt;var Wi=r(410199),$i=r(72456);const rn=function(){},ss=rn.prototype;ss.reset=function(e,i,g,O,X){this.pendingHyphen=null,this.hyphens=[],this.anchors=[],this.currentMeasureIdx=null,this.leftContinueAnchor=i,this.rightContinueAnchor=g,this.voiceIdx=O,this.firstDisplayedMeasureIdx=X;const ft=e[this.firstDisplayedMeasureIdx];this.leftContinueAnchor.setMeasure(ft);const Ut=e.length,Zt=e[Ut-1];this.rightContinueAnchor.setMeasure(Zt)},ss.updateMeasuresHyphens=function(e,i,g,O,X){return this.reset(e,O,X,g,i),this.parseFirstHyphenAnchor(e),this.parseMeasuresHyphenAnchors(e),this.parseLastHyphenAnchor(e),this.createHyphens(),this.hyphens},ss.parseFirstHyphenAnchor=function(e){const i=this.firstDisplayedMeasureIdx,g=e[i];if(g.hasLeftHyphenAnchor(this.voiceIdx)){this.addAnchor(this.leftContinueAnchor,i);const O=g.getLeftHyphenAnchor(this.voiceIdx);this.addAnchor(O,i)}},ss.parseMeasuresHyphenAnchors=function(e){const i=e.length;for(let g=this.firstDisplayedMeasureIdx;g+1<i;g++){this.currentMeasureIdx=g;const O=e[g],X=e[g+1];this.parseMeasureHyphenAnchors(O,X)}},ss.parseMeasureHyphenAnchors=function(e,i){this.hasConnection(e,i)&&(e.hasRightHyphenAnchor(this.voiceIdx)?this.addAnchor(e.getRightHyphenAnchor(this.voiceIdx),this.currentMeasureIdx):this.addFakeLeftAnchor(e,this.currentMeasureIdx),i.hasLeftHyphenAnchor(this.voiceIdx)?this.addAnchor(i.getLeftHyphenAnchor(this.voiceIdx),this.currentMeasureIdx+1):this.addFakeRightAnchor(i,this.currentMeasureIdx+1))},ss.hasConnection=function(e,i){return e.hasRightHyphenAnchor(this.voiceIdx)||i.hasLeftHyphenAnchor(this.voiceIdx)},ss.addFakeLeftAnchor=function(e,i){const O=new $i.A(null,Wi.A.LEFT);O.setMeasure(e),this.addAnchor(O,i)},ss.addFakeRightAnchor=function(e,i){const O=new $i.A(null,Wi.A.RIGHT);O.setMeasure(e),this.addAnchor(O,i)},ss.parseLastHyphenAnchor=function(e){const i=e.length-1,g=e[i];if(g.hasRightHyphenAnchor(this.voiceIdx)){const O=g.getRightHyphenAnchor(this.voiceIdx);this.addAnchor(O,i),this.addAnchor(this.rightContinueAnchor,i)}},ss.addAnchor=function(e,i){e.setMeasureIdx(i),this.anchors.push(e)},ss.createHyphens=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingHyphen()&&this.discardPendingHyphen()},ss.useAnchor=function(e){if(e.isLeft())this.openPendingHyphen(e);else if(e.isRight(e))this.closePending(e);else throw new b.default("Unexpected")},ss.openPendingHyphen=function(e){this.hasPendingHyphen()&&this.discardPendingHyphen();let i;e.hasHyphen()?i=e.getHyphen():(i=new Fi,i.setLeftAnchor(e)),this.pendingHyphen=i},ss.discardPendingHyphen=function(){this.pendingHyphen.erase(),this.pendingHyphen=null},ss.closePending=function(e){if(!this.hasPendingHyphen())e.hasHyphen()&&e.removeHyphen();else{this.removeHyphenIfDifferentFromPendinf(e);const i=this.getPendingHyphen();e.hasHyphen()||i.setRightAnchor(e),this.hyphens.push(i),this.pendingHyphen=null}},ss.hasPendingHyphen=function(){return this.pendingHyphen!==null},ss.removeHyphenIfDifferentFromPendinf=function(e){if(e.hasHyphen()){const i=e.getHyphen(),g=this.getPendingHyphen();i!==g&&e.removeHyphen()}},ss.getPendingHyphen=function(){return this.pendingHyphen};const vi=rn,Ki=function(e){this.init(e)};Ki.cssClass="staffHyphens";const is=Ki.prototype;is.cssClass=Ki.cssClass,is.init=function(e){this.voiceIdx=e,this.hyphensLinker=new vi,this.hyphens=[],this.drawingContext=null,this.posY=null,this.staffData=null;const i=null;this.leftContinueAnchor=new $i.A(i,Wi.A.LEFT),this.rightContinueAnchor=new $i.A(i,Wi.A.RIGHT),this.parent=null,this.group=null,this.drawn=!1},is.updateFromMeasures=function(e,i){this.hyphens=this.hyphensLinker.updateMeasuresHyphens(e,i,this.voiceIdx,this.leftContinueAnchor,this.rightContinueAnchor),this.hyphens.forEach(this.transferDrawingContext,this),this.isRendered()&&this.hyphens.forEach(this.transfertParent,this)},is.transfertParent=function(e){e.setParent(this.group)},is.removeMeasure=function(e){if(e.hasLeftHyphenAnchor(this.voiceIdx)){const i=e.getLeftHyphenAnchor(this.voiceIdx);i.hasHyphen()&&this.removeHyphen(i.getHyphen())}if(e.hasRightHyphenAnchor(this.voiceIdx)){const i=e.getRightHyphenAnchor(this.voiceIdx);i.hasHyphen()&&this.removeHyphen(i.getHyphen())}},is.removeHyphen=function(e){const i=this.hyphens.indexOf(e);this.hyphens.splice(i,1),e.erase()},is.setDrawingContext=function(e){this.drawingContext=e,this.hyphens.forEach(this.transferDrawingContext,this)},is.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},is.setParent=function(e){this.parent=e},is.setPosition=function(e){this.posY=e},is.setStaffData=function(e){this.staffData=e},is.draw=function(){this.renderIfNeeded(),this.hyphens.forEach(bn),this.move(),this.bindToParent()},is.renderIfNeeded=function(){this.isRendered()||this.render()},is.isRendered=function(){return this.group!==null},is.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.hyphens.forEach(this.transfertParent,this)};const bn=function(e){e.draw()};is.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},is.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},is.updateVerticalDisplay=function(){this.hyphens.forEach(Mn)};const Mn=function(e){e.updateVerticalDisplay()};is.updateHorizontalDisplay=function(){this.hyphens.forEach(pn)};const pn=function(e){e.updateHorizontalDisplay()},ai=Ki;var Ys=r(667193),Ti=r(359932);const ji=function(e){this.init(e)};ji.cssClass="hammerOnPullOff";const Me=ji.prototype;Me.cssClass=ji.cssClass,Me.init=function(e){this.arcs=null,this.text=null,this.anchor=e,this.technicalType=e.getTechnicalType(),e.hammerOnPullOff=this,this.displayData=new Ys.A,this.drawingContext=null,this.parent=null,this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},Me.setParent=function(e){this.parent=e},Me.setDrawingContext=function(e){this.drawingContext=e},Me.getText=function(){return this.hasText()||this.initText(),this.text},Me.hasText=function(){return this.text!==null},Me.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){const e=this.displayData.getHammerOnPullOff(),i=this.getTextValue(),g=new l.A({text:i,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});g.setDrawingContext(this.drawingContext),g.setParent(this.getGroup());const O=f.A.isTabStaff(e.staffData);let X=this.stringToY(e.string,O);X+=yt.A.getVertical(e,this.drawingContext);const ft=v.default.min2(X-g.getXHeight()-this.drawingContext.getTieVerticalMargin(),-g.getXHeight());g.setYPos(ft),g.render(),this.text=g}},Me.getTextValue=function(){if(this.technicalType===Ti.default.HAMMER_ON)return"H";if(this.technicalType===Ti.default.PULL_OFF)return"P";throw new b.default("Unexpected")},Me.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},Me.initArcs=function(){const i=this.anchor.note.getDisplayData(),g=(0,ot.default)(i.opts);g.hammerOnPullOffStarts=g.hammerOnPullOffStops.slice();const O=new Ot.A(g),X=i.getBeamData();O.setBeamData(X),this.displayData.setLeftNote(O),this.displayData.setRightNote(i),this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()&&this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)},Me.renderArc=function(e){const g=this.anchor.note.getFretsWidth()/2,O=yt.A.getRight(e,g),X=0,ft=new Wt.A(this.getGroup(),0,O,e.placement,X),Ut=f.A.isTabStaff(e.staffData);let Zt=this.stringToY(e.string,Ut);Zt+=yt.A.getVertical(e,this.drawingContext),ft.setPosY(Zt),ft.setDrawingContext(this.drawingContext),this.arcs.push(ft)},Me.stringToY=function(e,i){const g=i?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return Ct.A.stringToY(e,g)},Me.updateArc=function(){this.updateArcs()},Me.updateArcs=function(){this.getArcs().forEach(function(i){const g=this.anchor.note,O=this.anchor.measure,X=O.tickableContent,ft=O.getXPos()+X.getXPos(),Ut=ft-X.getPreviousSpace(),Zt=this.drawingContext.getTieHorizontalMargin(),Ie=ft+g.getXPos()-Zt-Ut,Qs=Rn()(Ie);i.setSize(Ie,Qs),i.setPosX(Ut)},this),this.needDrawUpdate=!1},Me.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},Me.draw=function(){this.updateArc(),this.getArcs().forEach(function(e){e.draw()}),this.bindToParent()},Me.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},Me.getGroup=function(){return this.svgGroup},Me.erase=function(){this.anchor.hammerOnPullOff=null,this.drawn&&this.unbindFromParent()},Me.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},Me.getType=function(){return St.A.LEFT},Me.isComplete=function(){return!0};let an=null;const Rn=function(){if(an===null){const i=.6666666666666666,X=v.default.solveLinearA(3,i,30,2),ft=v.default.solveLinearB(3,i,X);an=function(Ut){return X*Ut+ft}}return an};Me.getTopY=function(){const e=this.getTopArc(),i=e.getTopY();return e.posY+i},Me.getTopArc=function(){return this.getArcs()[0]},Me.getBottomY=function(){const e=this.getBottomArc(),i=e.getBottomY();return e.posY+i},Me.getBottomArc=function(){const e=this.getArcs();return e[e.length-1]};const Qi=ji,We=function(e){this.init(e)};We.cssClass="hammerOnPullOff";const Re=We.prototype;Re.cssClass=We.cssClass,Re.init=function(e){this.arcs=null,this.text=null,this.anchor=e,this.technicalType=e.getTechnicalType(),e.hammerOnPullOff=this,this.displayData=new Ys.A,this.drawingContext=null,this.parent=null,this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass),this.needDrawUpdate=!0,this.drawn=!1},Re.setParent=function(e){this.parent=e},Re.setDrawingContext=function(e){this.drawingContext=e},Re.getText=function(){return this.hasText()||this.initText(),this.text},Re.hasText=function(){return this.text!==null},Re.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){const e=this.displayData.getHammerOnPullOff(),i=this.getTextValue(),g=new l.A({text:i,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});g.setDrawingContext(this.drawingContext),g.setParent(this.getGroup());const O=f.A.isTabStaff(e.staffData);let X=this.stringToY(e.string,O);X+=yt.A.getVertical(e,this.drawingContext);const ft=v.default.min2(X-g.getXHeight()-this.drawingContext.getTieVerticalMargin(),-g.getXHeight());g.setYPos(ft),g.render(),this.text=g}},Re.getTextValue=function(){if(this.technicalType===Ti.default.HAMMER_ON)return"H";if(this.technicalType===Ti.default.PULL_OFF)return"P";throw new b.default("Unexpected")},Re.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},Re.initArcs=function(){const i=this.anchor.note.getDisplayData(),g=(0,ot.default)(i.opts);g.hammerOnPullOffStops=g.hammerOnPullOffStarts.slice();const O=new Ot.A(g),X=i.getBeamData();O.setBeamData(X),this.displayData.setLeftNote(i),this.displayData.setRightNote(O),this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()&&this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)},Re.renderArc=function(e){const g=this.anchor.note.getFretsWidth()/2,O=yt.A.getLeft(e,g),X=0,ft=new Wt.A(this.getGroup(),O,0,e.placement,X),Ut=f.A.isTabStaff(e.staffData);let Zt=this.stringToY(e.string,Ut);Zt+=yt.A.getVertical(e,this.drawingContext),ft.setPosY(Zt),ft.setDrawingContext(this.drawingContext),this.arcs.push(ft)},Re.stringToY=function(e,i){const g=i?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return Ct.A.stringToY(e,g)},Re.updateArc=function(){this.updateArcs()},Re.updateArcs=function(){this.getArcs().forEach(function(i){const g=this.anchor.note,O=this.anchor.measure,X=O.tickableContent,ft=O.getXPos()+X.getXPos(),Ut=ft+X.getWidth(),Zt=this.drawingContext.getTieHorizontalMargin(),De=ft+g.getXPos()+Zt,Ie=Ut-De,Qs=mn()(Ie);i.setSize(Ie,Qs),i.setPosX(De)},this),this.needDrawUpdate=!1},Re.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},Re.draw=function(){this.updateArc(),this.getArcs().forEach(function(e){e.draw()}),this.bindToParent()},Re.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},Re.getGroup=function(){return this.svgGroup},Re.erase=function(){this.anchor.hammerOnPullOff=null,this.drawn&&this.unbindFromParent()},Re.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},Re.getType=function(){return St.A.RIGHT},Re.isComplete=function(){return!0};let Ji=null;const mn=function(){if(Ji===null){const i=.6666666666666666,X=v.default.solveLinearA(3,i,30,2),ft=v.default.solveLinearB(3,i,X);Ji=function(Ut){return X*Ut+ft}}return Ji};Re.getTopY=function(){const e=this.getTopArc(),i=e.getTopY();return e.posY+i},Re.getTopArc=function(){return this.getArcs()[0]},Re.getBottomY=function(){const e=this.getBottomArc(),i=e.getBottomY();return e.posY+i},Re.getBottomArc=function(){const e=this.getArcs();return e[e.length-1]};const Li=We,Gi=function(e){this.init(e)};Gi.cssClass="hammerOnPullOff";const re=Gi.prototype;re.cssClass=Gi.cssClass,re.init=function(e){this.technicalType=e,this.arcs=null,this.text=null,this.leftAnchor=null,this.rightAnchor=null,this.displayData=null,this.drawingContext=null,this.parent=null,this.svgGroup=new m.A("g"),this.svgGroup.attr("class",this.cssClass),this.drawn=!1},re.setParent=function(e){this.parent=e},re.setLeftAnchor=function(e){this.hasLeftAnchor()&&this.leftAnchor!==e&&this.removeLeftAnchor(),this.leftAnchor=e,this.leftAnchor.hammerOnPullOff=this},re.hasLeftAnchor=function(){return this.leftAnchor!==null},re.removeLeftAnchor=function(){this.discardArc(),this.leftAnchor.hammerOnPullOff=null,this.leftAnchor=null},re.setRightAnchor=function(e){this.hasRightAnchor()&&this.rightAnchor!==e&&this.removeRightAnchor(),this.rightAnchor=e,this.rightAnchor.hammerOnPullOff=this},re.hasRightAnchor=function(){return this.rightAnchor!==null},re.removeRightAnchor=function(){this.discardArc(),this.rightAnchor.hammerOnPullOff=null,this.rightAnchor=null},re.discardArc=function(){this.displayData=null,this.arcs!==null&&(this.arcs.forEach(function(e){e.erase()}),this.arcs=null)},re.setDrawingContext=function(e){this.drawingContext=e},re.getText=function(){return this.hasText()||this.initText(),this.text},re.hasText=function(){return this.text!==null},re.initText=function(){if(this.text=null,this.displayData.hasHammerOnPullOff()){const e=this.displayData.getHammerOnPullOff(),i=this.getTextValue(),g=new l.A({text:i,"font-size":this.drawingContext.getHammerOnPullOffFontSize()});g.setDrawingContext(this.drawingContext),g.setParent(this.getGroup());const O=f.A.isTabStaff(e.staffData);let X=this.stringToY(e.string,O);X+=yt.A.getVertical(e,this.drawingContext);const ft=v.default.min2(X-g.getXHeight()-this.drawingContext.getTieVerticalMargin(),-g.getXHeight());g.setYPos(ft),g.render(),this.text=g}},re.getTextValue=function(){if(this.technicalType===Ti.default.HAMMER_ON)return"H";if(this.technicalType===Ti.default.PULL_OFF)return"P";throw new b.default("Unexpected")},re.getArcs=function(){return this.arcs===null&&this.initArcs(),this.arcs},re.initArcs=function(){this.displayData=new Ys.A;const e=this.rightAnchor.note;this.displayData.setRightNote(e.getDisplayData());const i=this.leftAnchor.note;this.displayData.setLeftNote(i.getDisplayData()),this.displayData.fillData(),this.arcs=[],this.displayData.hasHammerOnPullOffs()&&this.displayData.getHammerOnPullOffs().forEach(this.renderArc,this)},re.renderArc=function(e){const g=this.leftAnchor.note.getFretsWidth()/2,O=yt.A.getLeft(e,g),ft=this.rightAnchor.note.getFretsWidth()/2,Ut=yt.A.getRight(e,ft),Zt=yt.A.getVertical(e,this.drawingContext),De=f.A.isTabStaff(e.staffData),Ie=this.stringToY(e.string,De)+Zt,Qs=this.stringToY(e.rightString,De)+Zt-Ie,ni=new Wt.A(this.getGroup(),O,Ut,e.placement,Qs);ni.setPosY(Ie),ni.setDrawingContext(this.drawingContext),this.arcs.push(ni)},re.stringToY=function(e,i){const g=i?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize();return Ct.A.stringToY(e,g)},re.updateArc=function(){this.updateArcs()},re.updateArcs=function(){this.getArcs().forEach(function(i){const g=this.drawingContext.getTieHorizontalMargin(),O=this.getLeftOffset(),ft=this.leftAnchor.note.getXPos()+g+O,Ut=this.getRightOffset(),Ie=this.rightAnchor.note.getXPos()-g+Ut-ft,Qs=pt()(Ie);i.setSize(Ie,Qs),i.setPosX(ft)},this)},re.getLeftOffset=function(){const e=this.leftAnchor.measure,i=e.tickableContent;return e.getXPos()+i.getXPos()},re.getRightOffset=function(){const e=this.rightAnchor.measure,i=e.tickableContent;return e.getXPos()+i.getXPos()},re.draw=function(){this.updateArc(),this.getArcs().forEach(function(e){e.draw()}),this.bindToParent()},re.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},re.getGroup=function(){return this.svgGroup},re.erase=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},re.unbindFromParent=function(){this.svgGroup.removeFromParent(),this.drawn=!1},re.getType=function(){return St.A.CROSS_MEASURE},re.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()};let D=null;const pt=function(){if(D===null){const i=.6666666666666666,X=v.default.solveLinearA(3,i,30,2),ft=v.default.solveLinearB(3,i,X);D=function(Ut){return X*Ut+ft}}return D};re.getTopY=function(){const e=this.getTopArc(),i=e.getTopY();return e.posY+i},re.getTopArc=function(){return this.getArcs()[0]},re.getBottomY=function(){const e=this.getBottomArc(),i=e.getBottomY();return e.posY+i},re.getBottomArc=function(){const e=this.getArcs();return e[e.length-1]};const Dt=Gi,Oe=function(){},Ge=Oe.prototype;Ge.reset=function(e,i){this.pendingHammerOnPullOff=null,this.hammerOnPullOffs=[],this.voiceIdx=e,this.firstDisplayedMeasureIdx=i},Ge.updateMeasuresHammerOnPullOffs=function(e,i,g){return this.reset(g,i),e.forEach(this.updateMeasureHammerOnPullOffs,this),this.hammerOnPullOffs=this.hammerOnPullOffs.filter(Ui),this.hammerOnPullOffs},Ge.updateMeasureHammerOnPullOffs=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftHammerOnPullOffAnchor(this.voiceIdx)&&this.updateLeftAnchor(e.getLeftHammerOnPullOffAnchor(this.voiceIdx),O),e.hasRightHammerOnPullOffAnchor(this.voiceIdx)&&this.updateRightAnchor(e.getRightHammerOnPullOffAnchor(this.voiceIdx),X)},Ge.updateLeftAnchor=function(e,i){i?(si(e),this.addLeftHammerOnPullOff(e)):(gs(e),this.closePending(e))};const si=function(e){e.hasHammerOnPullOff()&&e.getHammerOnPullOff().getType()===St.A.CROSS_MEASURE&&e.removeHammerOnPullOff()};Ge.addLeftHammerOnPullOff=function(e){let i;e.hasHammerOnPullOff()?i=e.getHammerOnPullOff():i=new Qi(e),this.hammerOnPullOffs.push(i)},Ge.closePending=function(e){if(!this.hasPendingHammerOnPullOff())e.hasHammerOnPullOff()&&e.removeHammerOnPullOff();else{this.removeHammerOnPullOffIfDifferentFromPending(e);const i=this.getPendingHammerOnPullOff();e.hasHammerOnPullOff()||i.setRightAnchor(e),this.hammerOnPullOffs.push(i),this.pendingHammerOnPullOff=null}},Ge.removeHammerOnPullOffIfDifferentFromPending=function(e){if(e.hasHammerOnPullOff()){const i=e.getHammerOnPullOff(),g=this.getPendingHammerOnPullOff();i!==g&&e.removeHammerOnPullOff()}},Ge.getPendingHammerOnPullOff=function(){return this.pendingHammerOnPullOff},Ge.hasPendingHammerOnPullOff=function(){return this.pendingHammerOnPullOff!==null},Ge.updateRightAnchor=function(e,i){i?(Ei(e),this.addRightHammerOnPullOff(e)):(gs(e),this.openPendingHammerOnPullOff(e))};const Ei=function(e){if(e.hasHammerOnPullOff()){const i=e.getHammerOnPullOff();i.getType()===St.A.CROSS_MEASURE&&i.erase()}};Ge.addRightHammerOnPullOff=function(e){let i;e.hasHammerOnPullOff()?i=e.getHammerOnPullOff():i=new Li(e),this.hammerOnPullOffs.push(i)};const gs=function(e){if(e.hasHammerOnPullOff()){const i=e.getHammerOnPullOff();i.getType()!==St.A.CROSS_MEASURE&&i.erase()}};Ge.openPendingHammerOnPullOff=function(e){this.hasPendingHammerOnPullOff()&&this.discardPendingHammerOnPullOff();let i;if(e.hasHammerOnPullOff())i=e.getHammerOnPullOff();else{const g=e.getTechnicalType();i=new Dt(g),i.setLeftAnchor(e)}this.pendingHammerOnPullOff=i},Ge.discardPendingHammerOnPullOff=function(){this.pendingHammerOnPullOff.erase(),this.pendingHammerOnPullOff=null};const Ui=function(e){return e.isComplete()?!0:(e.erase(),!1)},bi=Oe,Xs=function(e){this.init(e)};Xs.cssClass="staffHammerOnPullOffs";const os=Xs.prototype;os.cssClass=Xs.cssClass,os.init=function(e){this.voiceIdx=e,this.hammerOnPullOffsLinker=new bi,this.hammerOnPullOffs=[],this.drawingContext=null,this.posY=null,this.staffData=null,this.parent=null,this.group=null,this.drawn=!1},os.updateFromMeasures=function(e,i){this.hammerOnPullOffs=this.hammerOnPullOffsLinker.updateMeasuresHammerOnPullOffs(e,i,this.voiceIdx),this.hammerOnPullOffs.forEach(this.transferDrawingContext,this),this.isRendered()&&this.hammerOnPullOffs.forEach(this.transfertParent,this)},os.transfertParent=function(e){e.setParent(this.group)},os.removeMeasure=function(e){if(e.hasLeftHammerOnPullOffAnchor(this.voiceIdx)){const i=e.getLeftHammerOnPullOffAnchor(this.voiceIdx);i.hasLeftHammerOnPullOff()?this.removeHammerOnPullOff(i.getHammerOnPullOff()):i.hasCrossMeasureHammerOnPullOff()&&i.removeHammerOnPullOff()}if(e.hasRightHammerOnPullOffAnchor(this.voiceIdx)){const i=e.getRightHammerOnPullOffAnchor(this.voiceIdx);i.hasHammerOnPullOff()&&this.removeHammerOnPullOff(i.getHammerOnPullOff())}},os.removeHammerOnPullOff=function(e){const i=this.hammerOnPullOffs.indexOf(e);this.hammerOnPullOffs.splice(i,1),e.erase()},os.setDrawingContext=function(e){this.drawingContext=e,this.hammerOnPullOffs.forEach(this.transferDrawingContext,this)},os.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},os.setParent=function(e){this.parent=e},os.setPosition=function(e){this.posY=e},os.setStaffData=function(e){this.staffData=e},os.draw=function(){this.renderIfNeeded(),this.hammerOnPullOffs.forEach(qn),this.move(),this.bindToParent()},os.renderIfNeeded=function(){this.isRendered()||this.render()},os.isRendered=function(){return this.group!==null},os.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.hammerOnPullOffs.forEach(this.transfertParent,this)},os.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},os.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},os.updateHorizontalDisplay=function(){this.hammerOnPullOffs.forEach(On)};const On=function(e){e.draw()},qn=function(e){e.draw()},Un=Xs;var An=r(847857),Mi=r(403521);const zn=function(e){this.init(e)},Je=zn.prototype;Je.cssClass="crossMeasureGlissando",Je.init=function(){this.drawn=!1,this.leftAnchor=null,this.rightAnchor=null,this.group=null,this.parent=null,this.drawingContext=null,this.glissandos={},this.displayData=new Mi.A},Je.setLeftAnchor=function(e){this.leftAnchor=e,this.leftAnchor.setGlissando(this),this.displayData.setLeftNote(e.getNote().getDisplayData())},Je.setRightAnchor=function(e){this.rightAnchor=e,this.rightAnchor.setGlissando(this),this.displayData.setRightNote(e.getNote().getDisplayData())},Je.setParent=function(e){this.parent=e},Je.setDrawingContext=function(e){this.drawingContext=e},Je.needRender=function(){return this.group===null},Je.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},Je.draw=function(){this.needRender()&&this.render();const e=this.getGlissandos();It.default.forEach(e,this.drawGlissando),this.bindToParent()},Je.getGlissandos=function(){return this.displayData.getGlissandoStarts().forEach(function(i,g){const O=this.getRightGlissandoData(i);if(typeof O!="undefined"){let X;const ft=i.line,Ut=O.line;typeof this.glissandos[g]!="undefined"?X=this.glissandos[g]:(X=new An.A,this.glissandos[g]=X),X.setDrawingContext(this.drawingContext),X.setParent(this.group),X.setPosX1(this.getLeftPosX()),X.setPosY1(this.lineToY(ft)),X.setPosX2(this.getRightPosX()),X.setPosY2(this.lineToY(Ut))}},this),this.glissandos},Je.getRightGlissandoData=function(e){const i=this.displayData.getGlissandoStops(),g=e.number;return i.find(function(O){const X=O.number;return g===X})},Je.getLeftPosX=function(){const e=this.leftAnchor.getNote(),i=this.leftAnchor.getMeasure(),g=i.tickableContent;return i.getXPos()+g.getXPos()+e.getXPos()+e.getMiddleHeadWidth()+this.drawingContext.getGlissandoHorizontalMargin()},Je.getRightPosX=function(){const e=this.rightAnchor.getNote(),i=this.rightAnchor.getMeasure(),g=i.tickableContent;return i.getXPos()+g.getXPos()+e.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},Je.lineToY=function(e){const i=this.drawingContext.getSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.lineToY(e,i,g)},Je.drawGlissando=function(e,i){i.draw()},Je.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.drawn=!0,this.parent.append(this.group))},Je.remove=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},Je.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},Je.hasLeftAnchor=function(){return this.leftAnchor!==null},Je.removeLeftAnchor=function(){this.leftAnchor.glissando=null,this.leftAnchor=null},Je.hasRightAnchor=function(){return this.rightAnchor!==null},Je.removeRightAnchor=function(){this.rightAnchor.glissando=null,this.rightAnchor=null};const kn=zn,Vs=function(e){this.init(e)},ps=Vs.prototype;ps.cssClass="rightGlissando",ps.init=function(e){this.anchor=e,this.anchor.setGlissando(this),this.group=null,this.parent=null,this.drawingContext=null,this.drawn=!1,this.glissandos={},this.displayData=new Mi.A,this.initDisplayData()},ps.initDisplayData=function(){const e=this.anchor.getNote().getDisplayData(),i=this.anchor.getRightNote();this.displayData.setLeftNote(e),this.displayData.setRightNote(i)},ps.setParent=function(e){this.parent=e},ps.setDrawingContext=function(e){this.drawingContext=e},ps.needRender=function(){return this.group===null},ps.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},ps.draw=function(){this.needRender()&&this.render();const e=this.getGlissandos();It.default.forEach(e,this.drawGlissando),this.bindToParent()},ps.getGlissandos=function(){return this.displayData.getGlissandoStarts().forEach(function(i,g){const O=this.getRightGlissandoData(i);if(typeof O!="undefined"){const X=typeof this.glissandos[g]!="undefined"?this.glissandos[g]:new An.A,ft=i.line,Ut=O.line;X.setDrawingContext(this.drawingContext),X.setParent(this.group),X.setPosX1(this.getLeftPosX()),X.setPosY1(this.lineToY(ft)),X.setPosX2(this.getRightPosX()),X.setPosY2(this.lineToY(Ut)),this.glissandos[g]=X}},this),this.glissandos},ps.updateHorizontalDisplay=function(){this.glissandos!==null&&this.displayData.getGlissandoStarts().forEach(function(i,g){const O=this.getRightGlissandoData(i);if(typeof O!="undefined"){const X=this.glissandos[g],ft=i.line,Ut=O.line;X.setPosX1(this.getLeftPosX()),X.setPosY1(this.lineToY(ft)),X.setPosX2(this.getRightPosX()),X.setPosY2(this.lineToY(Ut)),X.update()}},this)},ps.getRightGlissandoData=function(e){const i=this.displayData.getGlissandoStops(),g=e.number;return i.find(function(O){const X=O.number;return g===X})},ps.getLeftPosX=function(){const e=this.anchor.getNote(),i=this.anchor.getMeasure(),g=i.tickableContent;return i.getXPos()+g.getXPos()+e.getXPos()+e.getMiddleHeadWidth()},ps.getRightPosX=function(){const e=this.anchor.getMeasure();return e.getXPos()+e.getWidth()-this.drawingContext.getGlissandoHorizontalMargin()},ps.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},ps.drawGlissando=function(e,i){i.draw()},ps.lineToY=function(e){const i=this.drawingContext.getSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.lineToY(e,i,g)},ps.remove=function(){!this.needRender()&&this.drawn&&(this.group.removeFromParent(),this.drawn=!1)};const Sn=Vs,$=function(e){this.init(e)},ms=$.prototype;ms.cssClass="leftGlissando",ms.init=function(e){this.anchor=e,this.anchor.setGlissando(this),this.group=null,this.parent=null,this.drawingContext=null,this.drawn=!1,this.glissandos={},this.displayData=new Mi.A,this.initDisplayData()},ms.initDisplayData=function(){const e=this.anchor.getLeftNote(),i=this.anchor.getNote().getDisplayData();this.displayData.setLeftNote(e),this.displayData.setRightNote(i)},ms.setParent=function(e){this.parent=e},ms.setDrawingContext=function(e){this.drawingContext=e},ms.needRender=function(){return this.group===null},ms.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},ms.draw=function(){this.needRender()&&this.render();const e=this.getGlissandos();It.default.forEach(e,this.drawGlissando),this.bindToParent()},ms.getGlissandos=function(){return this.displayData.getGlissandoStarts().forEach(function(i,g){const O=this.getRightGlissandoData(i);if(typeof O!="undefined"){const X=typeof this.glissandos[g]!="undefined"?this.glissandos[g]:new An.A,ft=i.line,Ut=O.line;X.setDrawingContext(this.drawingContext),X.setParent(this.group),X.setPosX1(this.getLeftPosX()),X.setPosY1(this.lineToY(ft)),X.setPosX2(this.getRightPosX()),X.setPosY2(this.lineToY(Ut)),this.glissandos[g]=X}},this),this.glissandos},ms.getRightGlissandoData=function(e){const i=this.displayData.getGlissandoStops(),g=e.number;return i.find(function(O){const X=O.number;return g===X})},ms.getLeftPosX=function(){const e=this.anchor.getMeasure(),i=e.getAttributes();return e.getXPos()+i.getWidth()},ms.getRightPosX=function(){const e=this.anchor.getNote(),i=this.anchor.getMeasure(),g=i.tickableContent;return i.getXPos()+g.getXPos()+e.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},ms.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},ms.drawGlissando=function(e,i){i.draw()},ms.lineToY=function(e){const i=this.drawingContext.getSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.lineToY(e,i,g)},ms.remove=function(){!this.needRender()&&this.drawn&&(this.group.removeFromParent(),this.drawn=!1)};const Ri=$,Nn=function(e){this.init(e)},Ve=Nn.prototype;Ve.cssClass="staffGlissando",Ve.init=function(e){this.voiceIdx=e,this.drawingContext=null,this.staffData=null,this.posY=null,this.group=null,this.parent=null,this.glissandos=[],this.pendingCrossMeasure=null,this.drawn=!1},Ve.setDrawingContext=function(e){this.drawingContext=e,this.glissandos.forEach(this.transferDrawingContext,this)},Ve.setStaffData=function(e){this.staffData=e},Ve.removeMeasure=function(e){if(e.hasLeftGlissandoAnchor(this.voiceIdx)){const i=e.getLeftGlissandoAnchor(this.voiceIdx);i.hasGlissando()&&this.removeGlissando(i.getGlissando())}if(e.hasRightGlissandoAnchor(this.voiceIdx)){const i=e.getRightGlissandoAnchor(this.voiceIdx);i.hasGlissando()&&this.removeGlissando(i.getGlissando())}},Ve.setParent=function(e){this.parent=e},Ve.setPosition=function(e){this.posY=e},Ve.needRender=function(){return this.group===null},Ve.hasPendingCrossMeasure=function(){return this.pendingCrossMeasure!==null},Ve.removeGlissandos=function(){this.glissandos.forEach(M),this.glissandos=[]};function M(e){e.remove()}Ve.removeGlissando=function(e){const i=this.glissandos.indexOf(e);this.glissandos.splice(i,1),e.remove()},Ve.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.glissandos.forEach(this.transfertParent,this)},Ve.draw=function(){this.needRender()&&this.render(),this.glissandos.forEach(et),this.move(),this.bindToParent()};function et(e){e.draw()}Ve.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},Ve.move=function(){this.needRender()||this.group.attr("transform",`translate(0 ${this.posY})`)},Ve.updateHorizontalDisplay=function(){this.glissandos.forEach(this.drawGlissando)},Ve.updateFromMeasures=function(e,i){this.hasGlissandos()&&this.removeGlissandos(),this.glissandos=this.extractGlissandos(e,i),this.glissandos.forEach(this.transferDrawingContext,this),this.needRender()||this.glissandos.forEach(this.transfertParent,this)},Ve.hasGlissandos=function(){return this.glissandos.length>0},Ve.transfertParent=function(e){e.setParent(this.group)},Ve.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},Ve.extractGlissandos=function(e,i){const g=[];for(let O=i;O<e.length;O++){const X=e[O],ft=O===i,Ut=O===e.length-1;if(X.hasLeftGlissandoAnchor(this.voiceIdx)){const Zt=X.getLeftGlissandoAnchor(this.voiceIdx);ft?g.push(new Ri(Zt)):this.closePendingCrossMeasure(Zt,g)}if(X.hasRightGlissandoAnchor(this.voiceIdx)){const Zt=X.getRightGlissandoAnchor(this.voiceIdx);Ut?g.push(new Sn(Zt)):this.openPendingCrossMeasure(Zt)}}return g},Ve.openPendingCrossMeasure=function(e){this.hasPendingCrossMeasure()||(this.pendingCrossMeasure=new kn),this.pendingCrossMeasure.setLeftAnchor(e)},Ve.closePendingCrossMeasure=function(e,i){this.hasPendingCrossMeasure()&&(this.pendingCrossMeasure.setRightAnchor(e),i.push(this.pendingCrossMeasure),this.pendingCrossMeasure=null)},Ve.drawGlissando=function(e){e.draw()};const Z=Nn;var mt=r(794165),$t=r(746845);const Ye=function(e){this.init(e)},de=Ye.prototype;de.cssClass="crossMeasureSlide",de.init=function(){this.drawn=!1,this.leftAnchor=null,this.rightAnchor=null,this.group=null,this.parent=null,this.drawn=!1,this.drawingContext=null,this.slides={},this.displayData=new $t.A},de.setLeftAnchor=function(e){this.leftAnchor=e,this.leftAnchor.setSlide(this),this.displayData.setLeftNote(e.getNote().getDisplayData())},de.setRightAnchor=function(e){this.rightAnchor=e,this.rightAnchor.setSlide(this),this.displayData.setRightNote(e.getNote().getDisplayData())},de.setParent=function(e){this.parent=e},de.setDrawingContext=function(e){this.drawingContext=e},de.needRender=function(){return this.group===null},de.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},de.draw=function(){this.needRender()&&this.render();const e=this.getSlides();It.default.forEach(e,this.drawSlide),this.bindToParent()},de.getSlides=function(){return this.getSlidePairs().forEach(function(i){const g=typeof this.slides[i.$number]!="undefined"?this.slides[i.$number]:new mt.A;g.setDrawingContext(this.drawingContext),g.setParent(this.group),this.fillSlidePosition(g,i),this.slides[i.$number]=g},this),this.slides},de.getSlidePairs=function(){return this.isTabStaff()?this.displayData.getTabSlidePairs():this.displayData.getSlidePairs()},de.isTabStaff=function(){return this.displayData.isTabStaff()},de.fillSlidePosition=function(e,i){if(e.setPosX1(this.getLeftPosX()),e.setPosX2(this.getRightPosX()),this.isTabStaff()){const g=this.drawingContext.getTabSlideYOffset(),O=this.stringToY(i.leftString);let X=O,ft=O;i.leftFret>i.rightFret?(X-=g,ft+=g):(X+=g,ft-=g),e.setPosY1(X),e.setPosY2(ft)}else e.setPosY1(this.lineToY(i.leftLine)),e.setPosY2(this.lineToY(i.rightLine))},de.getLeftPosX=function(){const e=this.leftAnchor.getNote(),i=this.leftAnchor.getMeasure(),g=i.tickableContent;let O;return this.isTabStaff()?O=e.getFretsWidth():O=e.getMiddleHeadWidth(),i.getXPos()+g.getXPos()+e.getXPos()+O+this.drawingContext.getGlissandoHorizontalMargin()},de.getRightPosX=function(){const e=this.rightAnchor.getNote(),i=this.rightAnchor.getMeasure(),g=i.tickableContent;return i.getXPos()+g.getXPos()+e.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},de.lineToY=function(e){const i=this.drawingContext.getSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.lineToY(e,i,g)},de.stringToY=function(e){const i=this.drawingContext.getTabSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.stringToY(e,i,g)},de.drawSlide=function(e,i){i.draw()},de.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.drawn=!0,this.parent.append(this.group))},de.remove=function(){this.drawn&&this.unbindFromParent(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},de.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},de.hasLeftAnchor=function(){return this.leftAnchor!==null},de.removeLeftAnchor=function(){this.leftAnchor.slide=null,this.leftAnchor=null},de.hasRightAnchor=function(){return this.rightAnchor!==null},de.removeRightAnchor=function(){this.rightAnchor.slide=null,this.rightAnchor=null};const xs=Ye,Fs=function(e){this.init(e)},jt=Fs.prototype;jt.cssClass="rightSlide",jt.init=function(e){this.anchor=e,this.anchor.setSlide(this),this.group=null,this.parent=null,this.drawn=!1,this.drawingContext=null,this.slides={},this.displayData=new $t.A,this.initDisplayData()},jt.initDisplayData=function(){const e=this.anchor.getNote().getDisplayData(),i=this.anchor.getRightNote();this.displayData.setLeftNote(e),this.displayData.setRightNote(i)},jt.setParent=function(e){this.parent=e},jt.setDrawingContext=function(e){this.drawingContext=e},jt.needRender=function(){return this.group===null},jt.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},jt.draw=function(){this.needRender()&&this.render();const e=this.getSlides();It.default.forEach(e,this.drawSlide),this.bindToParent()},jt.getSlides=function(){return this.getSlidePairs().forEach(function(i){const g=typeof this.slides[i.$number]!="undefined"?this.slides[i.$number]:new mt.A;g.setDrawingContext(this.drawingContext),g.setParent(this.group),this.fillSlidePosition(g,i),this.slides[i.$number]=g},this),this.slides},jt.getSlidePairs=function(){return this.isTabStaff()?this.displayData.getTabSlidePairs():this.displayData.getSlidePairs()},jt.isTabStaff=function(){return this.displayData.isTabStaff()},jt.fillSlidePosition=function(e,i){if(e.setPosX1(this.getLeftPosX()),e.setPosX2(this.getRightPosX()),this.isTabStaff()){const g=this.drawingContext.getTabSlideYOffset(),O=this.stringToY(i.leftString);let X=O,ft=O;i.leftFret>i.rightFret?(X-=g,ft+=g):(X+=g,ft-=g),e.setPosY1(X),e.setPosY2(ft)}else e.setPosY1(this.lineToY(i.leftLine)),e.setPosY2(this.lineToY(i.rightLine))},jt.getLeftPosX=function(){const e=this.anchor.getNote(),i=this.anchor.getMeasure(),g=i.tickableContent;let O;return this.isTabStaff()?O=e.getFretsWidth():O=e.getMiddleHeadWidth(),i.getXPos()+g.getXPos()+e.getXPos()+O},jt.getRightPosX=function(){const e=this.anchor.getMeasure();return e.getXPos()+e.getWidth()-this.drawingContext.getGlissandoHorizontalMargin()},jt.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},jt.drawSlide=function(e,i){i.draw()},jt.lineToY=function(e){const i=this.drawingContext.getSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.lineToY(e,i,g)},jt.stringToY=function(e){const i=this.drawingContext.getTabSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.stringToY(e,i,g)},jt.remove=function(){!this.needRender()&&this.drawn&&(this.group.removeFromParent(),this.drawn=!1)};const As=Fs,hi=function(e){this.init(e)},ye=hi.prototype;ye.cssClass="leftSlide",ye.init=function(e){this.anchor=e,this.anchor.setSlide(this),this.group=null,this.parent=null,this.drawn=!1,this.drawingContext=null,this.slides={},this.displayData=new $t.A,this.initDisplayData()},ye.initDisplayData=function(){const e=this.anchor.getLeftNote(),i=this.anchor.getNote().getDisplayData();this.displayData.setLeftNote(e),this.displayData.setRightNote(i)},ye.setParent=function(e){this.parent=e},ye.setDrawingContext=function(e){this.drawingContext=e},ye.needRender=function(){return this.group===null},ye.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},ye.draw=function(){this.needRender()&&this.render();const e=this.getSlides();It.default.forEach(e,this.drawSlide),this.bindToParent()},ye.getSlides=function(){return this.getSlidePairs().forEach(function(i){const g=typeof this.slides[i.$number]!="undefined"?this.slides[i.$number]:new mt.A;g.setDrawingContext(this.drawingContext),g.setParent(this.group),this.fillSlidePosition(g,i),this.slides[i.$number]=g},this),this.slides},ye.getSlidePairs=function(){return this.isTabStaff()?this.displayData.getTabSlidePairs():this.displayData.getSlidePairs()},ye.isTabStaff=function(){return this.displayData.isTabStaff()},ye.fillSlidePosition=function(e,i){if(e.setPosX1(this.getLeftPosX()),e.setPosX2(this.getRightPosX()),this.isTabStaff()){const g=this.drawingContext.getTabSlideYOffset(),O=this.stringToY(i.leftString);let X=O,ft=O;i.leftFret>i.rightFret?(X-=g,ft+=g):(X+=g,ft-=g),e.setPosY1(X),e.setPosY2(ft)}else e.setPosY1(this.lineToY(i.leftLine)),e.setPosY2(this.lineToY(i.rightLine))},ye.getRightSlideData=function(e){const i=this.displayData.getSlideStops(),g=e.number;return i.find(function(O){const X=O.number;return g===X})},ye.getLeftPosX=function(){const e=this.anchor.getMeasure(),i=e.getAttributes();return e.getXPos()+i.getWidth()},ye.getRightPosX=function(){const e=this.anchor.getNote(),i=this.anchor.getMeasure(),g=i.tickableContent;return i.getXPos()+g.getXPos()+e.getXPos()-this.drawingContext.getGlissandoHorizontalMargin()},ye.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},ye.drawSlide=function(e,i){i.draw()},ye.lineToY=function(e){const i=this.drawingContext.getSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.lineToY(e,i,g)},ye.stringToY=function(e){const i=this.drawingContext.getTabSpaceSize(),g=this.displayData.getNbStaffLines();return Ct.A.stringToY(e,i,g)},ye.remove=function(){!this.needRender()&&this.drawn&&(this.group.removeFromParent(),this.drawn=!1)};const ci=hi,uo=function(e){this.init(e)},Ze=uo.prototype;Ze.cssClass="staffSlide",Ze.init=function(e){this.voiceIdx=e,this.drawingContext=null,this.staffData=null,this.posY=null,this.group=null,this.parent=null,this.drawn=!1,this.slides=[],this.pendingCrossMeasure=null},Ze.setDrawingContext=function(e){this.drawingContext=e,this.slides.forEach(this.transferDrawingContext,this)},Ze.setStaffData=function(e){this.staffData=e},Ze.removeMeasure=function(e){if(e.hasLeftSlideAnchor(this.voiceIdx)){const i=e.getLeftSlideAnchor(this.voiceIdx);i.hasSlide()&&this.removeSlide(i.getSlide())}if(e.hasRightSlideAnchor(this.voiceIdx)){const i=e.getRightSlideAnchor(this.voiceIdx);i.hasSlide()&&this.removeSlide(i.getSlide())}},Ze.setParent=function(e){this.parent=e},Ze.setPosition=function(e){this.posY=e},Ze.needRender=function(){return this.group===null},Ze.hasPendingCrossMeasure=function(){return this.pendingCrossMeasure!==null},Ze.removeSlides=function(){this.slides.forEach(fo),this.slides=[]};function fo(e){e.remove()}Ze.removeSlide=function(e){const i=this.slides.indexOf(e);this.slides.splice(i,1),e.remove()},Ze.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.slides.forEach(this.transfertParent,this)},Ze.draw=function(){this.needRender()&&this.render(),this.slides.forEach(this.drawSlide),this.move(),this.bindToParent()},Ze.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},Ze.move=function(){this.needRender()||this.group.attr("transform",`translate(0 ${this.posY})`)},Ze.updateHorizontalDisplay=function(){this.slides.forEach(this.drawSlide)},Ze.updateFromMeasures=function(e,i){this.hasSlides()&&this.removeSlides(),this.slides=this.extractSlides(e,i),this.slides.forEach(this.transferDrawingContext,this),this.needRender()||this.slides.forEach(this.transfertParent,this)},Ze.hasSlides=function(){return this.slides.length>0},Ze.transfertParent=function(e){e.setParent(this.group)},Ze.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},Ze.extractSlides=function(e,i){const g=[];for(let O=i;O<e.length;O++){const X=e[O],ft=O===i,Ut=O===e.length-1;if(X.hasLeftSlideAnchor(this.voiceIdx)){const Zt=X.getLeftSlideAnchor(this.voiceIdx);ft?g.push(new ci(Zt)):this.closePendingCrossMeasure(Zt,g)}if(X.hasRightSlideAnchor(this.voiceIdx)){const Zt=X.getRightSlideAnchor(this.voiceIdx);Ut?g.push(new As(Zt)):this.openPendingCrossMeasure(Zt)}}return g},Ze.openPendingCrossMeasure=function(e){this.hasPendingCrossMeasure()||(this.pendingCrossMeasure=new xs),this.pendingCrossMeasure.setLeftAnchor(e)},Ze.closePendingCrossMeasure=function(e,i){this.hasPendingCrossMeasure()&&(this.pendingCrossMeasure.setRightAnchor(e),i.push(this.pendingCrossMeasure),this.pendingCrossMeasure=null)},Ze.drawSlide=function(e){e.draw()};const zi=uo;var Wo=r(793491);const Ce=function(){},vs=Ce.prototype;vs.reset=function(e){this.pendingWedge=null,this.wedges=[],this.anchors=[],this.currentMeasureIdx=null,this.firstDisplayedMeasureIdx=e},vs.parseMeasuresWedges=function(e,i){return this.reset(i),e.forEach(this.parseMeasureWedgeAnchors,this),this.createWedges(),this.wedges},vs.parseMeasureWedgeAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftWedgeAnchor()&&this.updateLeftAnchor(e.getLeftWedgeAnchor(),O);const ft=e.getMiddleWedgesAnchors();this.addAnchors(ft),e.hasRightWedgeAnchor()&&this.updateRightAnchor(e.getRightWedgeAnchor(),X)},vs.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasWedge()&&e.getWedge().erase()},vs.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasWedge()&&e.getWedge().erase()},vs.addAnchors=function(e){e.forEach(this.addAnchor,this)},vs.addAnchor=function(e){e.setMeasureIdx(this.currentMeasureIdx),this.anchors.push(e)},vs.createWedges=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingWedge()&&this.discardPendingWedge()},vs.useAnchor=function(e){if(e.isLeft())this.openPendingWedge(e);else if(e.isRight(e))this.closePending(e);else throw new b.default("Unexpected")},vs.openPendingWedge=function(e){this.hasPendingWedge()&&this.discardPendingWedge();let i;e.hasWedge()?i=e.getWedge():(i=new Wo.A,i.setLeftAnchor(e)),this.pendingWedge=i},vs.discardPendingWedge=function(){this.pendingWedge.erase(),this.pendingWedge=null},vs.closePending=function(e){if(!this.hasPendingWedge())e.hasWedge()&&e.removeWedge();else{this.removeWedgeIfDifferentFromPending(e);const i=this.getPendingWedge();e.hasWedge()||i.setRightAnchor(e),this.wedges.push(i),this.pendingWedge=null}},vs.hasPendingWedge=function(){return this.pendingWedge!==null},vs.removeWedgeIfDifferentFromPending=function(e){if(e.hasWedge()){const i=e.getWedge(),g=this.getPendingWedge();i!==g&&e.removeWedge()}},vs.getPendingWedge=function(){return this.pendingWedge};const Zi=Ce,bs=function(){this.init()};bs.cssClass="staffWedges";const ns=bs.prototype;ns.cssClass=bs.cssClass,ns.init=function(){this.wedgesLinker=new Zi,this.wedges=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},ns.setStaffData=function(e){this.staffData=e},ns.updateFromMeasures=function(e,i){this.wedges=this.wedgesLinker.parseMeasuresWedges(e,i),this.wedges.forEach(this.transferDrawingContext,this),this.wedges.forEach(this.transferStaffData,this),this.isRendered()&&this.wedges.forEach(this.transfertParent,this)},ns.transfertParent=function(e){e.setParent(this.group)},ns.transferStaffData=function(e){e.setStaffData(this.staffData)},ns.removeMeasure=function(e){e.getAllWedgesAnchors().forEach(this.unbindAnchor,this)},ns.unbindAnchor=function(e){if(e.hasWedge()){const i=e.getWedge();this.removeWedge(i)}},ns.removeWedge=function(e){const i=this.wedges.indexOf(e);this.wedges.splice(i,1),e.erase()},ns.setPosition=function(e){this.posY=e},ns.setDrawingContext=function(e){this.drawingContext=e,this.wedges.forEach(this.transferDrawingContext,this)},ns.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},ns.setParent=function(e){this.parent=e},ns.draw=function(){this.renderIfNeeded(),this.wedges.forEach(Bn),this.move(),this.bindToParent()},ns.renderIfNeeded=function(){this.isRendered()||this.render()},ns.isRendered=function(){return this.group!==null},ns.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.wedges.forEach(this.transfertParent,this)},ns.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},ns.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)};const Bn=function(e){e.draw()};ns.updateVerticalDisplay=function(){this.wedges.forEach(Ts)};const Ts=function(e){e.updateVerticalDisplay()};ns.updateHorizontalDisplay=function(){this.wedges.forEach(Go)};const Go=function(e){e.updateHorizontalDisplay()};ns.getWedges=function(){return this.wedges},ns.getGroup=function(){return this.group};const Uo=bs;var hn=r(392639);const $s=function(){},Ws=$s.prototype;Ws.reset=function(e){this.pendingOctaveShift=null,this.octaveShifts=[],this.anchors=[],this.currentMeasureIdx=null,this.firstDisplayedMeasureIdx=e},Ws.parseMeasuresOctaveShifts=function(e,i){return this.reset(i),e.forEach(this.parseMeasureOctaveShiftAnchors,this),this.createOctaveShifts(),this.octaveShifts},Ws.parseMeasureOctaveShiftAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftOctaveShiftAnchor()&&this.updateLeftAnchor(e.getLeftOctaveShiftAnchor(),O);const ft=e.getMiddleOctaveShiftsAnchors();this.addAnchors(ft),e.hasRightOctaveShiftAnchor()&&this.updateRightAnchor(e.getRightOctaveShiftAnchor(),X)},Ws.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasOctaveShift()&&e.getOctaveShift().erase()},Ws.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasOctaveShift()&&e.getOctaveShift().erase()},Ws.addAnchors=function(e){e.forEach(this.addAnchor,this)},Ws.addAnchor=function(e){this.anchors.push(e)},Ws.createOctaveShifts=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingOctaveShift()&&this.discardPendingOctaveShift()},Ws.useAnchor=function(e){if(e.isLeft())this.openPendingOctaveShift(e);else if(e.isRight())this.closePending(e);else throw new b.default("Unexpected")},Ws.openPendingOctaveShift=function(e){this.hasPendingOctaveShift()&&this.discardPendingOctaveShift();let i;e.hasOctaveShift()?i=e.getOctaveShift():(i=new hn.A,i.setLeftAnchor(e)),this.pendingOctaveShift=i},Ws.discardPendingOctaveShift=function(){this.pendingOctaveShift.erase(),this.pendingOctaveShift=null},Ws.closePending=function(e){if(!this.hasPendingOctaveShift())e.hasOctaveShift()&&e.removeOctaveShift();else{this.removeOctaveShiftIfDifferentFromPending(e);const i=this.getPendingOctaveShift();e.hasOctaveShift()||i.setRightAnchor(e),this.octaveShifts.push(i),this.pendingOctaveShift=null}},Ws.removeOctaveShiftIfDifferentFromPending=function(e){if(e.hasOctaveShift()){const i=e.getOctaveShift(),g=this.getPendingOctaveShift();i!==g&&e.removeOctaveShift()}},Ws.hasPendingOctaveShift=function(){return this.pendingOctaveShift!==null},Ws.getPendingOctaveShift=function(){return this.pendingOctaveShift};const zo=$s,Xn=function(){this.init()};Xn.cssClass="staffOctaveShifts";const $e=Xn.prototype;$e.cssClass=Xn.cssClass,$e.init=function(){this.octaveShiftsLinker=new zo,this.octaveShifts=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},$e.setStaffData=function(e){this.staffData=e},$e.updateFromMeasures=function(e,i){this.octaveShifts=this.octaveShiftsLinker.parseMeasuresOctaveShifts(e,i),this.octaveShifts.forEach(this.transferDrawingContext,this),this.octaveShifts.forEach(this.transferStaffData,this),this.isRendered()&&this.octaveShifts.forEach(this.transfertParent,this)},$e.transfertParent=function(e){e.setParent(this.group)},$e.transferStaffData=function(e){e.setStaffData(this.staffData)},$e.removeMeasure=function(e){e.getAllOctaveShiftsAnchors().forEach(this.unbindAnchor,this)},$e.unbindAnchor=function(e){if(e.hasOctaveShift()){const i=e.getOctaveShift();this.removeOctaveShift(i)}},$e.removeOctaveShift=function(e){const i=this.octaveShifts.indexOf(e);this.octaveShifts.splice(i,1),e.erase()},$e.setPosition=function(e){this.posY=e},$e.setDrawingContext=function(e){this.drawingContext=e,this.octaveShifts.forEach(this.transferDrawingContext,this)},$e.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},$e.setParent=function(e){this.parent=e},$e.draw=function(){this.renderIfNeeded(),this.octaveShifts.forEach(this.drawEntity),this.move(),this.bindToParent()},$e.renderIfNeeded=function(){this.isRendered()||this.render()},$e.isRendered=function(){return this.group!==null},$e.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.octaveShifts.forEach(this.transfertParent,this)},$e.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0 ,${this.posY})`)},$e.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)},$e.drawEntity=function(e){e.draw()},$e.updateVerticalDisplay=function(){this.octaveShifts.forEach(this.updateVerticalDisplayEntity)},$e.updateVerticalDisplayEntity=function(e){e.updateVerticalDisplay()},$e.updateHorizontalDisplay=function(){this.octaveShifts.forEach(this.updateHorizontalDisplayEntity)},$e.updateHorizontalDisplayEntity=function(e){e.updateHorizontalDisplay()},$e.getOctaveShifts=function(){return this.octaveShifts},$e.getGroup=function(){return this.group};const ko=Xn;var Vn=r(64316);const li=function(){},Gs=li.prototype;Gs.reset=function(e){this.pendingPluckedRange=null,this.pluckedRanges=[],this.anchors=[],this.currentMeasureIdx=null,this.firstDisplayedMeasureIdx=e},Gs.parseMeasuresPluckedRanges=function(e,i){return this.reset(i),e.forEach(this.parseMeasurePluckedRangeAnchors,this),this.createPluckedRanges(),this.pluckedRanges},Gs.parseMeasurePluckedRangeAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftPluckedRangeAnchor()&&this.updateLeftAnchor(e.getLeftPluckedRangeAnchor(),O);const ft=e.getMiddlePluckedRangesAnchors();this.addAnchors(ft),e.hasRightPluckedRangeAnchor()&&this.updateRightAnchor(e.getRightPluckedRangeAnchor(),X)},Gs.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasPluckedRange()&&e.getPluckedRange().erase()},Gs.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasPluckedRange()&&e.getPluckedRange().erase()},Gs.addAnchors=function(e){e.forEach(this.addAnchor,this)},Gs.addAnchor=function(e){this.anchors.push(e)},Gs.createPluckedRanges=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingPluckedRange()&&this.discardPendingPluckedRange()},Gs.useAnchor=function(e){if(e.isLeft())this.openPendingPluckedRange(e);else if(e.isRight())this.closePending(e);else throw new b.default("Unexpected")},Gs.openPendingPluckedRange=function(e){this.hasPendingPluckedRange()&&this.discardPendingPluckedRange();let i;e.hasPluckedRange()?i=e.getPluckedRange():(i=new Vn.A,i.setLeftAnchor(e)),this.pendingPluckedRange=i},Gs.discardPendingPluckedRange=function(){this.pendingPluckedRange.erase(),this.pendingPluckedRange=null},Gs.closePending=function(e){if(!this.hasPendingPluckedRange())e.hasPluckedRange()&&e.removePluckedRange();else{this.removePluckedRangeIfDifferentFromPending(e);const i=this.getPendingPluckedRange();e.hasPluckedRange()||i.setRightAnchor(e),this.pluckedRanges.push(i),this.pendingPluckedRange=null}},Gs.removePluckedRangeIfDifferentFromPending=function(e){if(e.hasPluckedRange()){const i=e.getPluckedRange(),g=this.getPendingPluckedRange();i!==g&&e.removePluckedRange()}},Gs.hasPendingPluckedRange=function(){return this.pendingPluckedRange!==null},Gs.getPendingPluckedRange=function(){return this.pendingPluckedRange};const go=li,Ns=function(){this.init()};Ns.cssClass="staffPluckedRanges";const Ke=Ns.prototype;Ke.cssClass=Ns.cssClass,Ke.init=function(){this.pluckedRangesLinker=new go,this.pluckedRanges=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},Ke.setStaffData=function(e){this.staffData=e},Ke.updateFromMeasures=function(e,i){this.pluckedRanges=this.pluckedRangesLinker.parseMeasuresPluckedRanges(e,i),this.pluckedRanges.forEach(this.transferDrawingContext,this),this.pluckedRanges.forEach(this.transferStaffData,this),this.isRendered()&&this.pluckedRanges.forEach(this.transfertParent,this)},Ke.transfertParent=function(e){e.setParent(this.group)},Ke.transferStaffData=function(e){e.setStaffData(this.staffData)},Ke.removeMeasure=function(e){e.getAllPluckedRangesAnchors().forEach(this.unbindAnchor,this)},Ke.unbindAnchor=function(e){if(e.hasPluckedRange()){const i=e.getPluckedRange();this.removePluckedRange(i)}},Ke.removePluckedRange=function(e){const i=this.pluckedRanges.indexOf(e);this.pluckedRanges.splice(i,1),e.erase()},Ke.setPosition=function(e){this.posY=e},Ke.setDrawingContext=function(e){this.drawingContext=e,this.pluckedRanges.forEach(this.transferDrawingContext,this)},Ke.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},Ke.setParent=function(e){this.parent=e},Ke.draw=function(){this.renderIfNeeded(),this.pluckedRanges.forEach(this.drawEntity),this.move(),this.bindToParent()},Ke.renderIfNeeded=function(){this.isRendered()||this.render()},Ke.isRendered=function(){return this.group!==null},Ke.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.pluckedRanges.forEach(this.transfertParent,this)},Ke.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0 ,${this.posY})`)},Ke.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)},Ke.drawEntity=function(e){e.draw()},Ke.updateVerticalDisplay=function(){this.pluckedRanges.forEach(this.updateVerticalDisplayEntity)},Ke.updateVerticalDisplayEntity=function(e){e.updateVerticalDisplay()},Ke.updateHorizontalDisplay=function(){this.pluckedRanges.forEach(this.updateHorizontalDisplayEntity)},Ke.updateHorizontalDisplayEntity=function(e){e.updateHorizontalDisplay()},Ke.getPluckedRanges=function(){return this.pluckedRanges},Ke.getGroup=function(){return this.group};const Ue=Ns;var $n=r(628516);const mi=function(){},Us=mi.prototype;Us.reset=function(e){this.pendingTempoChange=null,this.tempoChanges=[],this.anchors=[],this.currentMeasureIdx=null,this.firstDisplayedMeasureIdx=e},Us.parseMeasuresTempoChanges=function(e,i){return this.reset(i),e.forEach(this.parseMeasureTempoChangeAnchors,this),this.createTempoChanges(),this.tempoChanges},Us.parseMeasureTempoChangeAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftTempoChangeAnchor()&&this.updateLeftAnchor(e.getLeftTempoChangeAnchor(),O);const ft=e.getMiddleTempoChangesAnchors();this.addAnchors(ft),e.hasRightTempoChangeAnchor()&&this.updateRightAnchor(e.getRightTempoChangeAnchor(),X)},Us.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasTempoChange()&&e.getTempoChange().erase()},Us.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasTempoChange()&&e.getTempoChange().erase()},Us.addAnchors=function(e){e.forEach(this.addAnchor,this)},Us.addAnchor=function(e){this.anchors.push(e)},Us.createTempoChanges=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingTempoChange()&&this.discardPendingTempoChange()},Us.useAnchor=function(e){if(e.isLeft())this.openPendingTempoChange(e);else if(e.isRight())this.closePending(e);else throw new b.default("Unexpected")},Us.openPendingTempoChange=function(e){this.hasPendingTempoChange()&&this.discardPendingTempoChange();let i;e.hasTempoChange()?i=e.getTempoChange():(i=new $n.A,i.setLeftAnchor(e)),this.pendingTempoChange=i},Us.discardPendingTempoChange=function(){this.pendingTempoChange.erase(),this.pendingTempoChange=null},Us.closePending=function(e){if(!this.hasPendingTempoChange())e.hasTempoChange()&&e.removeTempoChange();else{this.removeTempoChangeIfDifferentFromPending(e);const i=this.getPendingTempoChange();e.hasTempoChange()||i.setRightAnchor(e),this.tempoChanges.push(i),this.pendingTempoChange=null}},Us.removeTempoChangeIfDifferentFromPending=function(e){if(e.hasTempoChange()){const i=e.getTempoChange(),g=this.getPendingTempoChange();i!==g&&e.removeTempoChange()}},Us.hasPendingTempoChange=function(){return this.pendingTempoChange!==null},Us.getPendingTempoChange=function(){return this.pendingTempoChange};const Xo=mi,yn=function(){this.init()};yn.cssClass="staffTempoChanges";const ge=yn.prototype;ge.cssClass=yn.cssClass,ge.init=function(){this.tempoChangesLinker=new Xo,this.tempoChanges=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},ge.setStaffData=function(e){this.staffData=e},ge.updateFromMeasures=function(e,i){const g=this.tempoChanges;this.tempoChanges=this.tempoChangesLinker.parseMeasuresTempoChanges(e,i),this.tempoChanges.forEach(this.transferDrawingContext,this),this.tempoChanges.forEach(this.transferStaffData,this),this.isRendered()&&this.tempoChanges.forEach(this.transfertParent,this),this.dropFormerTempoChanges(g)},ge.transfertParent=function(e){e.setParent(this.group)},ge.transferStaffData=function(e){e.setStaffData(this.staffData)},ge.removeMeasure=function(e){e.getAllTempoChangesAnchors().forEach(this.unbindAnchor,this)},ge.unbindAnchor=function(e){if(e.hasTempoChange()){const i=e.getTempoChange();this.removeTempoChange(i)}},ge.removeTempoChange=function(e){const i=this.tempoChanges.indexOf(e);this.tempoChanges.splice(i,1),e.erase()},ge.setPosition=function(e){this.posY=e},ge.setDrawingContext=function(e){this.drawingContext=e,this.tempoChanges.forEach(this.transferDrawingContext,this)},ge.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},ge.setParent=function(e){this.parent=e},ge.draw=function(){this.renderIfNeeded(),this.tempoChanges.forEach(this.drawEntity),this.move(),this.bindToParent()},ge.renderIfNeeded=function(){this.isRendered()||this.render()},ge.isRendered=function(){return this.group!==null},ge.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.tempoChanges.forEach(this.transfertParent,this)},ge.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0 ,${this.posY})`)},ge.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)},ge.drawEntity=function(e){e.draw()},ge.updateVerticalDisplay=function(){this.tempoChanges.forEach(this.updateVerticalDisplayEntity)},ge.updateVerticalDisplayEntity=function(e){e.updateVerticalDisplay()},ge.updateHorizontalDisplay=function(){this.tempoChanges.forEach(this.updateHorizontalDisplayEntity)},ge.updateHorizontalDisplayEntity=function(e){e.updateHorizontalDisplay()},ge.getTempoChanges=function(){return this.tempoChanges},ge.getGroup=function(){return this.group},ge.dropFormerTempoChanges=function(e){const i=new Set(this.tempoChanges);e=e.filter(g=>!i.has(g)),e.forEach(g=>g.erase())};const Ai=yn;var Hn=r(863426);const Kn=function(e,i){this.init(e,i)};Kn.cssClass="endingBracket";const Be=Kn.prototype;Be.cssClass=Kn.cssClass,Be.init=function(e,i){this.parent=null,this.group=null,this.middleLine=null,this.rightLine=null,this.leftLine=null,this.drawingContext=null,this.width=null,this.posY=null,this.leftClosed=e,this.rightClosed=i},Be.setParent=function(e){this.parent=e},Be.createGroup=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass)},Be.setDrawingContext=function(e){this.drawingContext=e},Be.draw=function(){this.render(),this.move(),this.bindToParent()},Be.bindToParent=function(){this.parent.append(this.group)},Be.move=function(){const i=this.posY;this.group.attr("transform",`translate(0 ${i})`)},Be.render=function(){this.isRendered()||(this.createGroup(),this.isLeftClosed()&&this.renderLeftLine(),this.renderMiddleLine(),this.isRightClosed()&&this.renderRightLine())},Be.isRendered=function(){return this.group!==null},Be.renderLeftLine=function(){const e=this.getX1(),i=0,g=this.getY2(),X={stroke_width:this.drawingContext.getRepeatEndingLineThickness()},ft=new Hn.A(this.group,X);ft.render(e,i,e,g),ft.draw(),this.leftLine=ft},Be.renderMiddleLine=function(){const e=this.getX1(),i=this.getX2(),g=this.getY2(),X={stroke_width:this.drawingContext.getRepeatEndingLineThickness()},ft=new Hn.A(this.group,X);ft.render(e,g,i,g),ft.draw(),this.middleLine=ft},Be.isLeftClosed=function(){return this.leftClosed},Be.isRightClosed=function(){return this.rightClosed},Be.renderRightLine=function(){const e=this.getX2(),i=this.getY2(),g=0,X={stroke_width:this.drawingContext.getRepeatEndingLineThickness()},ft=new Hn.A(this.group,X);ft.render(e,i,e,g),ft.draw(),this.rightLine=ft},Be.getX1=function(){return this.drawingContext.getThinBarlineThickness()},Be.getX2=function(){let e;return e=this.width,e-=this.drawingContext.getThinBarlineThickness(),e},Be.getY2=function(){return-this.drawingContext.getSpaceSize()*2},Be.setWidth=function(e){this.width=e},Be.getWidth=function(){return this.width},Be.updateDisplay=function(){this.updateWidth()},Be.updateWidth=function(){if(this.isRendered()){const e=this.getX2();this.isRightClosed()&&(this.rightLine.setX1(e),this.rightLine.setX2(e)),this.middleLine.setX2(e)}},Be.setPosY=function(e){this.posY=e},Be.getPosX=function(){return this.posX},Be.getPosY=function(){return this.posY};const Vo=Kn,to=2,_n=function(){this.init()};_n.NAME="ending";const xe=_n.prototype;xe.name=_n.NAME,xe.cssClass=_n.NAME,xe.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.text=null,this.bracket=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.posX=null,this.posY=null,this.drawn=!1},xe.setParent=function(e){this.parent=e},xe.setCssClass=function(e){this.cssClass=e},xe.setStaffData=function(e){this.staffData=e},xe.setDrawingContext=function(e){this.drawingContext=e},xe.setLeftAnchor=function(e){this.hasLeftAnchor()&&this.leftAnchor!==e&&this.removeLeftAnchor(),this.leftAnchor=e,this.leftAnchor.setEnding(this)},xe.hasLeftAnchor=function(){return this.leftAnchor!==null},xe.removeLeftAnchor=function(){this.hide(),this.leftAnchor.ending=null,this.leftAnchor=null},xe.setRightAnchor=function(e){this.hasRightAnchor()&&this.rightAnchor!==e&&this.removeRightAnchor(),this.rightAnchor=e,this.rightAnchor.setEnding(this)},xe.hasRightAnchor=function(){return this.rightAnchor!==null},xe.removeRightAnchor=function(){this.hide(),this.rightAnchor.ending=null,this.rightAnchor=null},xe.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},xe.hide=function(){this.drawn&&this.unbindFromParent()},xe.getLeftAnchor=function(){return this.leftAnchor},xe.getRightAnchor=function(){return this.rightAnchor},xe.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},xe.updateHorizontalDisplay=function(){this.isRendered()||this.render();const e=this.getWidth();this.bracket.setWidth(e),this.bracket.updateDisplay(),this.posX=this.getX(),this.draw()},xe.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.posY=this.getY(),this.draw()},xe.draw=function(){this.isRendered()||this.render(),this.posY=this.getY();const e=this.getWidth();this.bracket.setWidth(e),this.bracket.updateDisplay(),this.posX=this.getX(),this.text!==null&&this.text.draw(),this.bracket.draw(),this.move(),this.bindToParent()},xe.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},xe.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},xe.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass);const e=this.getLeftAnchor(),i=this.drawingContext.getSpaceSize();if(e.hasText()){const Ut={text:e.getText()};this.text=new l.A(Ut),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext),this.text.setFontSize(i*to),this.text.render()}const g=this.getRightAnchor(),O=e.isLeftClosed(),X=g.isRightClosed();this.bracket=new Vo(O,X),this.bracket.setParent(this.group),this.bracket.setDrawingContext(this.drawingContext),this.format()},xe.format=function(){this.formatX(),this.formatY()},xe.formatX=function(){if(this.text!==null){const e=this.drawingContext.getSpaceSize();this.text.setXPos(e)}},xe.formatY=function(){const e=this.getSpaceBelow();this.text!==null&&this.text.setYPos(-e),this.bracket.setPosY(-e)},xe.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate (${this.posX}, ${this.posY})`)},xe.isRendered=function(){return this.group!==null},xe.getWidth=function(){const e=this.getX();return this.getRightAnchor().getX()-e},xe.getX=function(){return this.getLeftAnchor().getX()},xe.getY=function(){return this.getLeftAnchor().getY()},xe.getGroup=function(){return this.group},xe.getHeight=function(){const e=this.getSpaceAbove(),i=this.getSpaceBelow();return e+i},xe.getSpaceAbove=function(){return this.drawingContext.getSpaceSize()*to},xe.getSpaceBelow=function(){return this.drawingContext.getSpaceSize()*to/2};const $o=_n,po=function(){},zs=po.prototype;zs.reset=function(e){this.pendingEnding=null,this.endings=[],this.anchors=[],this.currentMeasureIdx=null,this.firstDisplayedMeasureIdx=e},zs.parseMeasuresEndings=function(e,i){return this.reset(i),e.forEach(this.parseMeasureEndingAnchors,this),this.createEndings(),this.endings},zs.parseMeasureEndingAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftEndingAnchor()&&this.updateLeftAnchor(e.getLeftEndingAnchor(),O);const ft=e.getMiddleEndingsAnchors();this.addAnchors(ft),e.hasRightEndingAnchor()&&this.updateRightAnchor(e.getRightEndingAnchor(),X)},zs.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasEnding()&&e.getEnding().erase()},zs.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasEnding()&&e.getEnding().erase()},zs.addAnchors=function(e){e.forEach(this.addAnchor,this)},zs.addAnchor=function(e){this.anchors.push(e)},zs.createEndings=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingEnding()&&this.discardPendingEnding()},zs.useAnchor=function(e){if(e.isLeft())this.openPendingEnding(e);else if(e.isRight())this.closePending(e);else throw new b.default("Unexpected")},zs.openPendingEnding=function(e){this.hasPendingEnding()&&this.discardPendingEnding();let i;e.hasEnding()?i=e.getEnding():(i=new $o,i.setLeftAnchor(e)),this.pendingEnding=i},zs.discardPendingEnding=function(){this.pendingEnding.erase(),this.pendingEnding=null},zs.closePending=function(e){if(!this.hasPendingEnding())e.hasEnding()&&e.removeEnding();else{this.removeEndingIfDifferentFromPending(e);const i=this.getPendingEnding();e.hasEnding()||i.setRightAnchor(e),this.endings.push(i),this.pendingEnding=null}},zs.removeEndingIfDifferentFromPending=function(e){if(e.hasEnding()){const i=e.getEnding(),g=this.getPendingEnding();i!==g&&e.removeEnding()}},zs.hasPendingEnding=function(){return this.pendingEnding!==null},zs.getPendingEnding=function(){return this.pendingEnding};const Ko=po,cn=function(){this.init()};cn.cssClass="staffEndings";const dt=cn.prototype;dt.cssClass=cn.cssClass,dt.init=function(){this.endingsLinker=new Ko,this.endings=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},dt.setStaffData=function(e){this.staffData=e},dt.updateFromMeasures=function(e,i){const g=this.endings;this.endings=this.endingsLinker.parseMeasuresEndings(e,i),this.endings.forEach(this.transferDrawingContext,this),this.endings.forEach(this.transferStaffData,this),this.isRendered()&&this.endings.forEach(this.transfertParent,this),this.dropFormerEndings(g)},dt.transfertParent=function(e){e.setParent(this.group)},dt.transferStaffData=function(e){e.setStaffData(this.staffData)},dt.removeMeasure=function(e){e.getAllEndingsAnchors().forEach(this.unbindAnchor,this)},dt.unbindAnchor=function(e){if(e.hasEnding()){const i=e.getEnding();this.removeEnding(i)}},dt.removeEnding=function(e){const i=this.endings.indexOf(e);this.endings.splice(i,1),e.erase()},dt.setPosition=function(e){this.posY=e},dt.setDrawingContext=function(e){this.drawingContext=e,this.endings.forEach(this.transferDrawingContext,this)},dt.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},dt.setParent=function(e){this.parent=e},dt.draw=function(){this.renderIfNeeded(),this.endings.forEach(this.drawEntity),this.move(),this.bindToParent()},dt.renderIfNeeded=function(){this.isRendered()||this.render()},dt.isRendered=function(){return this.group!==null},dt.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.endings.forEach(this.transfertParent,this)},dt.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0 ,${this.posY})`)},dt.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)},dt.drawEntity=function(e){e.draw()},dt.updateVerticalDisplay=function(){this.endings.forEach(this.updateVerticalDisplayEntity)},dt.updateVerticalDisplayEntity=function(e){e.updateVerticalDisplay()},dt.updateHorizontalDisplay=function(){this.endings.forEach(this.updateHorizontalDisplayEntity)},dt.updateHorizontalDisplayEntity=function(e){e.updateHorizontalDisplay()},dt.getEndings=function(){return this.endings},dt.getGroup=function(){return this.group},dt.dropFormerEndings=function(e){const i=new Set(this.endings);e=e.filter(g=>!i.has(g)),e.forEach(g=>g.erase())};const jo=cn;var Qo=r(679333);const eo=function(){},Ss=eo.prototype;Ss.reset=function(e,i){this.pendingSlur=null,this.slurs=[],this.anchors=[],this.currentMeasureIdx=null,this.voiceIdx=e,this.firstDisplayedMeasureIdx=i},Ss.setStaff=function(e){this.staff=e},Ss.parseMeasuresSlurs=function(e,i,g){return this.reset(g,i),e.forEach(this.parseMeasureSlurAnchors,this),this.createSlurs(),this.slurs},Ss.parseMeasureSlurAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftSlurAnchor(this.voiceIdx)&&this.updateLeftAnchor(e.getLeftSlurAnchor(this.voiceIdx),O);const ft=e.getMiddleSlursAnchors(this.voiceIdx);this.addAnchors(ft),e.hasRightSlurAnchor(this.voiceIdx)&&this.updateRightAnchor(e.getRightSlurAnchor(this.voiceIdx),X)},Ss.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasSlur()&&e.getSlur().erase()},Ss.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasSlur()&&e.getSlur().erase()},Ss.addAnchors=function(e){e.forEach(this.addAnchor,this)},Ss.addAnchor=function(e){e.setMeasureIdx(this.currentMeasureIdx),this.anchors.push(e)},Ss.createSlurs=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingSlur()&&this.discardPendingSlur()},Ss.useAnchor=function(e){if(e.isLeft())this.openPendingSlur(e);else if(e.isRight(e))this.closePending(e);else throw new b.default("Unexpected")},Ss.openPendingSlur=function(e){this.hasPendingSlur()&&this.discardPendingSlur();let i;e.hasSlur()?i=e.getSlur():(i=new Qo.A,i.setStaff(this.staff),i.setLeftAnchor(e)),this.pendingSlur=i},Ss.discardPendingSlur=function(){this.pendingSlur.erase(),this.pendingSlur=null},Ss.closePending=function(e){if(!this.hasPendingSlur())e.hasSlur()&&e.removeSlur();else{this.removeSlurIfDifferentFromPending(e);const i=this.getPendingSlur();e.hasSlur()||i.setRightAnchor(e),this.slurs.push(i),this.pendingSlur=null}},Ss.hasPendingSlur=function(){return this.pendingSlur!==null},Ss.removeSlurIfDifferentFromPending=function(e){if(e.hasSlur()){const i=e.getSlur(),g=this.getPendingSlur();i!==g&&e.removeSlur()}},Ss.getPendingSlur=function(){return this.pendingSlur};const jn=eo,Jo="adagio-voice-uuid",In=function(e,i){this.init(e,i)};In.cssClass="staffSlurs slurs-";const Qe=In.prototype;Qe.cssClass=In.cssClass,Qe.init=function(e,i){this.voiceIdx=e,this.voiceUuid=i,this.slursLinker=new jn,this.slurs=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=null},Qe.setStaff=function(e){this.slursLinker.setStaff(e)},Qe.updateFromMeasures=function(e,i){this.slurs=this.slursLinker.parseMeasuresSlurs(e,i,this.voiceIdx),this.slurs.forEach(this.transferDrawingContext,this),this.slurs.forEach(this.transferStaffData,this),this.isRendered()&&this.slurs.forEach(this.transfertParent,this)},Qe.transfertParent=function(e){e.setParent(this.group)},Qe.removeMeasure=function(e){e.getAllSlursAnchors(this.voiceIdx).forEach(this.unbindAnchor,this)},Qe.unbindAnchor=function(e){if(e.hasSlur()){const i=e.getSlur();this.removeSlur(i)}},Qe.removeSlur=function(e){const i=this.slurs.indexOf(e);this.slurs.splice(i,1),e.erase()},Qe.setPosition=function(e){this.posY=e},Qe.setDrawingContext=function(e){this.drawingContext=e,this.slurs.forEach(this.transferDrawingContext,this)},Qe.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},Qe.setStaffData=function(e){this.staffData=e,this.slurs.forEach(this.transferStaffData,this)},Qe.transferStaffData=function(e){e.setStaffData(this.staffData)},Qe.setParent=function(e){this.parent=e},Qe.draw=function(){this.renderIfNeeded(),this.slurs.forEach(Si),this.move(),this.bindToParent()},Qe.renderIfNeeded=function(){this.isRendered()||this.render()},Qe.isRendered=function(){return this.group!==null},Qe.render=function(){this.group=new m.A("g"),this.group.setDataEntry(Jo,this.voiceUuid),this.group.attr("class",this.cssClass+this.voiceIdx),this.slurs.forEach(this.transfertParent,this)},Qe.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},Qe.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)};const Si=function(e){e.draw()};Qe.updateVerticalDisplay=function(){this.slurs.forEach(so)};const so=function(e){e.updateVerticalDisplay()};Qe.updateHorizontalDisplay=function(){this.slurs.forEach(yi)};const yi=function(e){e.updateHorizontalDisplay()};Qe.getSlurs=function(){return this.slurs},Qe.getGroup=function(){return this.group};const wt=In;var mo=r(321038);const Ao=function(){},o=Ao.prototype;o.reset=function(e){this.pendingPedal=null,this.pedals=[],this.anchors=[],this.currentMeasureIdx=null,this.firstDisplayedMeasureIdx=e},o.parseMeasuresPedals=function(e,i){return this.reset(i),e.forEach(this.parseMeasurePedalAnchors,this),this.createPedals(),this.pedals},o.parseMeasurePedalAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftPedalAnchor()&&this.updateLeftAnchor(e.getLeftPedalAnchor(),O);const ft=e.getMiddlePedalsAnchors();this.addAnchors(ft),e.hasRightPedalAnchor()&&this.updateRightAnchor(e.getRightPedalAnchor(),X)},o.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasPedal()&&e.getPedal().erase()},o.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasPedal()&&e.getPedal().erase()},o.addAnchors=function(e){e.forEach(this.addAnchor,this)},o.addAnchor=function(e){this.anchors.push(e)},o.createPedals=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingPedal()&&this.discardPendingPedal()},o.useAnchor=function(e){if(e.isLeft())this.openPendingPedal(e);else if(e.isRight())this.closePending(e);else throw new b.default("Unexpected")},o.openPendingPedal=function(e){this.hasPendingPedal()&&this.discardPendingPedal();let i;e.hasPedal()?i=e.getPedal():(i=new mo.A,i.setLeftAnchor(e)),this.pendingPedal=i},o.discardPendingPedal=function(){this.pendingPedal.erase(),this.pendingPedal=null},o.closePending=function(e){if(!this.hasPendingPedal())e.hasPedal()&&e.removePedal();else{this.removePedalIfDifferentFromPending(e);const i=this.getPendingPedal();e.hasPedal()||i.setRightAnchor(e),this.pedals.push(i),this.pendingPedal=null}},o.removePedalIfDifferentFromPending=function(e){if(e.hasPedal()){const i=e.getPedal(),g=this.getPendingPedal();i!==g&&e.removePedal()}},o.hasPendingPedal=function(){return this.pendingPedal!==null},o.getPendingPedal=function(){return this.pendingPedal};const u=Ao,E=function(){this.init()};E.cssClass="staffPedals";const H=E.prototype;H.cssClass=E.cssClass,H.init=function(){this.pedalsLinker=new u,this.pedals=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},H.setStaffData=function(e){this.staffData=e},H.updateFromMeasures=function(e,i){this.pedals=this.pedalsLinker.parseMeasuresPedals(e,i),this.pedals.forEach(this.transferDrawingContext,this),this.pedals.forEach(this.transferStaffData,this),this.isRendered()&&this.pedals.forEach(this.transfertParent,this)},H.transfertParent=function(e){e.setParent(this.group)},H.transferStaffData=function(e){e.setStaffData(this.staffData)},H.removeMeasure=function(e){e.getAllPedalsAnchors().forEach(this.unbindAnchor,this)},H.unbindAnchor=function(e){if(e.hasPedal()){const i=e.getPedal();this.removePedal(i)}},H.removePedal=function(e){const i=this.pedals.indexOf(e);this.pedals.splice(i,1),e.erase()},H.setPosition=function(e){this.posY=e},H.setDrawingContext=function(e){this.drawingContext=e,this.pedals.forEach(this.transferDrawingContext,this)},H.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},H.setParent=function(e){this.parent=e},H.draw=function(){this.renderIfNeeded(),this.pedals.forEach(ht),this.move(),this.bindToParent()},H.renderIfNeeded=function(){this.isRendered()||this.render()},H.isRendered=function(){return this.group!==null},H.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.pedals.forEach(this.transfertParent,this)},H.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},H.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.prepend(this.group),this.drawn=!0)};const ht=function(e){e.draw()};H.updateVerticalDisplay=function(){this.pedals.forEach(ut)};const ut=function(e){e.updateVerticalDisplay()};H.updateHorizontalDisplay=function(){this.pedals.forEach(Jt)};const Jt=function(e){e.updateHorizontalDisplay()};H.getPedals=function(){return this.pedals},H.getGroup=function(){return this.group};const se=E;var we=r(513411),ki=r(465730),qe=r(694426);const qi=It.default.fromPairs([{key:qe.A.BEND,value:"arrowheadBlackUp"},{key:qe.A.PRE_BEND,value:"arrowheadBlackRight"},{key:qe.A.RELEASE,value:"arrowheadBlackDown"}]),Pn=.4,Yn=function(e){this.init(e)},Ks=Yn.prototype;Ks.init=function({type:e,parentGroup:i}){this.type=e,this.parentGroup=i,this.posX=null,this.posY=null,this.path=new m.A("path"),this.needRender=!0},Ks.render=function(){const e=this.getGlyphId();this.glyph=this.drawingContext.getScaledGlyph(e,Pn);const i=this.glyph.render();this.path.attr("d",i),this.needRender=!1},Ks.getGlyphId=function(){const e=qi[this.type];if(typeof e=="undefined")qe.A.raiseError(this.type);else return e},Ks.setDrawingContext=function(e){this.drawingContext=e},Ks.draw=function(){this.needRender&&this.render(),this.move(),this.bindToParent()},Ks.bindToParent=function(){this.parentGroup.append(this.path)},Ks.move=function(){let e=this.posX,i=this.posY;this.type===qe.A.PRE_BEND?(i+=this.glyph.getHeight()/2,e-=this.glyph.getWidth()*9/10):this.type===qe.A.BEND?(e-=this.glyph.getWidth()/2,i+=this.glyph.getWidth()):this.type===qe.A.RELEASE?e-=this.glyph.getWidth()/2:qe.A.raiseError(this.type),this.path.attr("transform",`translate(${e} ${i})`)},Ks.setPosX=function(e){this.posX=e},Ks.setPosY=function(e){this.posY=e},Ks.getHeight=function(){return this.needRender&&this.render(),this.glyph.getHeight()},Ks.getTopY=function(){return this.needRender&&this.render(),Math.min(this.upLeftY,this.upMidY,this.upRightY)};const Qn=Yn,kt=function(e){this.init(e)},ui=kt.prototype;ui.init=function({parentGroup:e,textStr:i,shifted:g,down:O}){this.text=new l.A({text:i}),this.text.setParent(e),this.shifted=g,this.down=O,this.needRender=!0,this.posX=null,this.posY=null},ui.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.needRender=!1},ui.setDrawingContext=function(e){this.drawingContext=e;const i=e.getBendFontSize(),g=e.getHarmonyFontFamily();this.text.options["font-family"]=g,this.text.setDrawingContext(e),this.text.setFontSize(i)},ui.setPosX=function(e){this.posX=e;const i=this.text.getWidth();this.shifted?e-=i:e-=i/2,this.text.setXPos(e)},ui.setPosY=function(e){if(this.posY=e,this.down)e+=this.text.getFontSize()*2/3;else{const i=this.drawingContext.getMarginSize();e-=i}this.text.setYPos(e)},ui.draw=function(){this.needRender&&this.render(),this.bindToParent()},ui.bindToParent=function(){this.text.bindToParent()},ui.move=function(){this.text.move()},ui.getTopY=function(){return this.needRender&&this.render(),Math.min(this.upLeftY,this.upMidY,this.upRightY)};const io=kt,rr=function(e){this.init(e)},fi=rr.prototype;fi.cssClass="preBendLine",fi.init=function({parentGroup:e,bottomY:i,topY:g,text:O}){this.parentGroup=e,this.group=new m.A("g"),this.line=this.group.append("line"),this.line.attr("class",this.cssClass),this.line.style("stroke","black"),this.arrow=new Qn({type:qe.A.BEND,parentGroup:this.group}),this.arrow.setPosY(g),this.text=null,O!==null&&(this.text=new io({textStr:O,parentGroup:this.group})),this.bottomY=i,this.topY=g,this.drawingContext=null,this.width=null,this.posX=null,this.posY=null,this.needRender=!0},fi.setDrawingContext=function(e){this.drawingContext=e,this.arrow.setDrawingContext(this.drawingContext),this.text&&(this.text.setDrawingContext(this.drawingContext),this.text.setPosY(this.topY),this.text.setPosX(0))},fi.render=function(){this.renderPath(),this.needRender=!1},fi.renderPath=function(){this.line.attr("x1",0),this.line.attr("x2",0),this.line.attr("y1",this.topY),this.line.attr("y2",this.bottomY);const e=this.drawingContext.getBendLineThickness();this.line.attr("stroke-width",e)},fi.draw=function(){this.needRender&&this.render(),this.arrow.draw(),this.text&&this.text.draw(),this.move(),this.bindToParent()},fi.bindToParent=function(){this.parentGroup.append(this.group)},fi.erase=function(){this.parent!==null&&this.unbindFromParent()},fi.unbindFromParent=function(){this.group.removeFromParent()},fi.move=function(){this.group.attr("transform",`translate(${this.posX} ${this.posY})`)},fi.setPosX=function(e){this.posX=e},fi.setPosY=function(e){this.posY=e},fi.updateHorizontalDisplay=function(){this.needRender&&this.render(),this.arrow.move(),this.text&&this.text.move(),this.move()},fi.getTopY=function(){return this.needRender&&this.render(),Math.min(this.upLeftY,this.upMidY,this.upRightY)};const Yr=rr,He=function(e){this.init(e)},Fe=He.prototype;Fe.cssClass="bendCurve",Fe.init=function({parentGroup:e,leftY:i,rightY:g,text:O,type:X,shiftText:ft}){this.parentGroup=e,this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.path=this.group.append("path"),this.path.style("fill","none"),this.path.style("stroke","#000000"),this.type=X,this.arrow=new Qn({type:X,parentGroup:this.group}),this.arrow.setPosY(g),this.text=null,O!==null&&(this.text=new io({textStr:O,parentGroup:this.group,shifted:ft,down:X===qe.A.RELEASE})),this.leftY=i,this.rightY=g,this.drawingContext=null,this.width=null,this.posX=null,this.posY=null,this.needRender=!0},Fe.setDrawingContext=function(e){this.drawingContext=e,this.arrow.setDrawingContext(this.drawingContext),this.text&&(this.text.setDrawingContext(this.drawingContext),this.text.setPosY(this.rightY))},Fe.setWidth=function(e){this.width=e,this.arrow.setPosX(e),this.text&&this.text.setPosX(e),this.needRender=!0},Fe.render=function(){this.renderPath(),this.needRender=!1},Fe.renderPath=function(){let e=this.rightY;this.type===qe.A.BEND?e+=this.arrow.getHeight()*7/10:this.type===qe.A.RELEASE&&(e-=this.arrow.getHeight()*9/10);const i=`M 0 ${this.leftY} Q ${this.width} ${this.leftY} ${this.width} ${e}`;this.path.attr("d",i);const g=this.drawingContext.getBendLineThickness();this.path.style("stroke-width",g)},Fe.draw=function(){this.needRender&&this.render(),this.arrow.draw(),this.text&&this.text.draw(),this.move(),this.bindToParent()},Fe.bindToParent=function(){this.parentGroup.append(this.group)},Fe.erase=function(){this.parent!==null&&this.unbindFromParent()},Fe.unbindFromParent=function(){this.group.removeFromParent()},Fe.move=function(){this.group.attr("transform",`translate(${this.posX} ${this.posY})`),this.text&&this.text.move()},Fe.setPosX=function(e){this.posX=e},Fe.setPosY=function(e){this.posY=e},Fe.updateHorizontalDisplay=function(){this.needRender&&this.render(),this.arrow.move(),this.text&&this.text.move(),this.move()},Fe.getTopY=function(){return this.needRender&&this.render(),Math.min(this.upLeftY,this.upMidY,this.upRightY)};const wn=He,no=function(e){this.init(e)};no.cssClass="bend";const _e=no.prototype;_e.cssClass=no.cssClass,_e.init=function(){this.group=null,this.parent=null,this.bendCurve=null,this.preBendLine=null,this.needDrawUpdate=!0,this.drawn=!1,this.leftAnchor=null,this.rightAnchor=null,this.drawingContext=null},_e.setParent=function(e){this.parent=e},_e.setLeftAnchor=function(e){this.hasLeftAnchor()&&this.leftAnchor!==e&&this.removeLeftAnchor(),this.leftAnchor=e,this.leftAnchor.bend=this},_e.hasLeftAnchor=function(){return this.leftAnchor!==null},_e.removeLeftAnchor=function(){this.hide(),this.leftAnchor.bend=null,this.leftAnchor=null},_e.setRightAnchor=function(e){this.hasRightAnchor()&&this.rightAnchor!==e&&this.removeRightAnchor(),this.rightAnchor=e,this.rightAnchor.bend=this},_e.hasRightAnchor=function(){return this.rightAnchor!==null},_e.removeRightAnchor=function(){this.hide(),this.rightAnchor.bend=null,this.rightAnchor=null},_e.hide=function(){this.drawn&&this.unbindFromParent()},_e.setDrawingContext=function(e){this.drawingContext=e},_e.render=function(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.renderPreBendIfNeeded(),this.renderBendIfNeeded()},_e.renderPreBendIfNeeded=function(){this.hasPreBend()&&this.renderPreBend()},_e.hasPreBend=function(){return this.leftAnchor.hasPreBend()&&!this.leftAnchor.isTiedLeft()},_e.renderPreBend=function(){const e=this.leftAnchor.getPreBendBottomY(),i=this.leftAnchor.getPreBendTopY(),g=this.leftAnchor.getPreBendX(),O=this.leftAnchor.getLeftText();this.preBendLine=new Yr({parentGroup:this.group,bottomY:e,topY:i,text:O}),this.preBendLine.setDrawingContext(this.drawingContext),this.preBendLine.setPosX(g),this.preBendLine.setPosY(0)},_e.renderBendIfNeeded=function(){this.hasBend()&&this.renderBend()},_e.hasBend=function(){return!!(!this.leftAnchor.hasPreBend()||this.rightAnchor.isTiedRight()||this.leftAnchor.isTiedLeft()||this.rightAnchor.getRightBendType()!==qe.A.PRE_BEND)},_e.renderBend=function(){const e=this.leftAnchor.getLeftY(),i=this.rightAnchor.getRightY(),g=this.leftAnchor.getBendLeftX(),O=this.rightAnchor.getBendRightX(),X=this.rightAnchor.getRightText(),ft=this.rightAnchor.getRightBendType(),Ut=this.rightAnchor.isTextShifted();this.bendCurve=new wn({parentGroup:this.group,leftY:e,rightY:i,text:X,type:ft,shiftText:Ut});const Zt=O-g;this.bendCurve.setDrawingContext(this.drawingContext),this.bendCurve.setPosX(g),this.bendCurve.setWidth(Zt),this.bendCurve.setPosY(0)},_e.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},_e.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.needDrawUpdate&&(this.preBendLine&&this.updatePreBendLine(),this.bendCurve&&this.updateBendCurve(),this.needDrawUpdate=!1),this.bendCurve&&this.bendCurve.draw(),this.preBendLine&&this.preBendLine.draw(),this.bindToParent()},_e.updateBendCurve=function(){const e=this.leftAnchor.getBendLeftX(),g=this.rightAnchor.getBendRightX()-e;this.bendCurve.setPosX(e),this.bendCurve.setWidth(g)},_e.updatePreBendLine=function(){const e=this.leftAnchor.getPreBendX();this.preBendLine.setPosX(e)},_e.draw=function(){this.isRendered()||this.render(),this.preBendLine&&this.updatePreBendLine(),this.bendCurve&&this.updateBendCurve(),this.bendCurve&&this.bendCurve.draw(),this.preBendLine&&this.preBendLine.draw(),this.bindToParent()},_e.updateVerticalDisplay=function(){},_e.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},_e.isRendered=function(){return this.group!==null},_e.getGroup=function(){return this.group},_e.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},_e.hide=function(){this.drawn&&this.unbindFromParent()},_e.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1};const Ae=no,ar=function(){},ii=ar.prototype;ii.reset=function(e,i,g){this.pendingBend=null,this.bends=[],this.anchors=[],this.currentMeasureIdx=null,this.voiceIdx=e,this.firstDisplayedMeasureIdx=i,this.string=g},ii.parseMeasuresBends=function(e,i,g,O){return this.reset(g,i,O),e.forEach(this.parseMeasureBendAnchors,this),this.createBends(),this.bends},ii.parseMeasureBendAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i;const O=i===this.firstDisplayedMeasureIdx,X=i===g.length-1;e.hasLeftBendAnchor(this.voiceIdx,this.string)&&this.updateLeftAnchor(e.getLeftBendAnchor(this.voiceIdx,this.string),O);const ft=e.getMiddleBendsAnchors(this.voiceIdx,this.string);this.addAnchors(ft),e.hasRightBendAnchor(this.voiceIdx,this.string)&&this.updateRightAnchor(e.getRightBendAnchor(this.voiceIdx,this.string),X)},ii.updateLeftAnchor=function(e,i){i?this.addAnchor(e):e.hasBend()&&e.getBend().erase()},ii.updateRightAnchor=function(e,i){i?this.addAnchor(e):e.hasBend()&&e.getBend().erase()},ii.addAnchors=function(e){e.forEach(this.addAnchor,this)},ii.addAnchor=function(e){this.anchors.push(e)},ii.createBends=function(){this.anchors.forEach(this.useAnchor,this),this.hasPendingBend()&&this.discardPendingBend()},ii.useAnchor=function(e){if(e.isLeft())this.openPendingBend(e);else if(e.isRight(e))this.closePending(e);else throw new b.default("Unexpected")},ii.openPendingBend=function(e){this.hasPendingBend()&&this.discardPendingBend();let i;e.hasBend()?i=e.getBend():(i=new Ae,i.setLeftAnchor(e)),this.pendingBend=i},ii.discardPendingBend=function(){this.pendingBend.erase(),this.pendingBend=null},ii.closePending=function(e){if(!this.hasPendingBend())e.hasBend()&&e.removeBend();else{this.removeBendIfDifferentFromPending(e);const i=this.getPendingBend();e.hasBend()||i.setRightAnchor(e),this.bends.push(i),this.pendingBend=null}},ii.hasPendingBend=function(){return this.pendingBend!==null},ii.removeBendIfDifferentFromPending=function(e){if(e.hasBend()){const i=e.getBend(),g=this.getPendingBend();i!==g&&e.removeBend()}},ii.getPendingBend=function(){return this.pendingBend};const hr=ar,Fr="adagio-voice-uuid",So=function(e){this.init(e)};So.cssClass="staffBends bends-";const as=So.prototype;as.cssClass=So.cssClass,as.init=function({voiceIdx:e,voiceUuid:i}){this.voiceIdx=e,this.voiceUuid=i,this.bendsLinker=new hr,this.bends=[],this.drawingContext=null,this.staffData=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},as.updateFromMeasures=function(e,i){this.bends=[];let g=0;f.A.hasIsTabStaff(this.staffData)&&(g=f.A.getNbStaffLines(this.staffData));for(let O=1;O<=g;O++){const X=this.bendsLinker.parseMeasuresBends(e,i,this.voiceIdx,O);Array.prototype.push.apply(this.bends,X)}this.bends.forEach(this.transferDrawingContext,this),this.isRendered()&&this.bends.forEach(this.transfertParent,this)},as.transfertParent=function(e){e.setParent(this.group)},as.removeMeasure=function(e){e.getAllBendsAnchors(this.voiceIdx).forEach(this.unbindAnchor,this)},as.unbindAnchor=function(e){if(e.hasBend()){const i=e.getBend();this.removeBend(i)}},as.removeBend=function(e){const i=this.bends.indexOf(e);this.bends.splice(i,1),e.erase()},as.setPosition=function(e){this.posY=e},as.setDrawingContext=function(e){this.drawingContext=e,this.bends.forEach(this.transferDrawingContext,this)},as.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},as.setStaffData=function(e){this.staffData=e},as.setParent=function(e){this.parent=e},as.draw=function(){this.renderIfNeeded(),this.bends.forEach(Wr),this.move(),this.bindToParent()};function Wr(e){e.draw()}as.renderIfNeeded=function(){this.isRendered()||this.render()},as.isRendered=function(){return this.group!==null},as.render=function(){this.group=new m.A("g"),this.group.setDataEntry(Fr,this.voiceUuid),this.group.attr("class",this.cssClass+this.voiceIdx),this.bends.forEach(this.transfertParent,this)},as.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},as.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)},as.updateVerticalDisplay=function(){this.bends.forEach(yo)};const yo=function(e){e.updateVerticalDisplay()};as.updateHorizontalDisplay=function(){this.bends.forEach(Gr)};const Gr=function(e){e.updateHorizontalDisplay()};as.getBends=function(){return this.bends},as.getGroup=function(){return this.group};const Ur=So;var Po=r(752670),wo=r(331537);class ts{constructor(){this.group=null,this.line=null,this.parent=null,this.needDrawUpdate=!0,this.drawn=!1,this.leftAnchor=null,this.rightAnchor=null,this.continuedAnchors=[],this.drawingContext=null}setLeftAnchor(i){this.hasLeftAnchor()&&this.leftAnchor!==i&&this.removeLeftAnchor(),this.leftAnchor=i,this.leftAnchor.setMelisma(this)}hasLeftAnchor(){return this.leftAnchor!==null}setParent(i){this.parent=i}getLeftAnchor(){return this.leftAnchor}setNeedDrawUpdate(){this.needDrawUpdate=!0}erase(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor(),this.hasContinuedAnchors()&&this.removeContinuedAnchors()}removeLeftAnchor(){this.hide(),this.leftAnchor.melisma=null,this.leftAnchor=null}setRightAnchor(i){this.hasRightAnchor()&&this.rightAnchor!==i&&this.removeRightAnchor(),this.rightAnchor=i,this.rightAnchor.setMelisma(this)}hasRightAnchor(){return this.rightAnchor!==null}getRightAnchor(){return this.rightAnchor}removeRightAnchor(){this.hide(),this.rightAnchor.melisma=null,this.rightAnchor=null}setContinuedAnchors(i){this.hasContinuedAnchors()&&this.removeContinuedAnchors(),this.continuedAnchors=i,i.forEach(g=>{g.setMelisma(this)})}hasContinuedAnchors(){return this.continuedAnchors.length>0}removeContinuedAnchors(){this.hide(),this.continuedAnchors.forEach(i=>{i.melisma=null}),this.continuedAnchors=[]}removeContinuedAnchor(i){const g=this.continuedAnchors.indexOf(i);g>=0&&(this.hide(),this.continuedAnchors.splice(g,1))}hide(){this.drawn&&this.unbindFromParent()}setDrawingContext(i){this.drawingContext=i}updateHorizontalDisplay(){this.isRendered()||this.render(),this.needDrawUpdate&&(this.updateMelismaHorizontal(),this.needDrawUpdate=!1),this.drawMelisma(),this.bindToParent()}updateVerticalDisplay(){this.isRendered()||this.render(),this.updateMelismaVertical(),this.drawMelisma(),this.bindToParent()}drawMelisma(){if(this.line.isRendered()||typeof this.line.x1=="undefined"||typeof this.line.y1=="undefined")return;const i=this.drawingContext.getMelismaWidth();this.line.options.stroke_width=i,this.line.render(this.line.x1,this.line.y1,this.line.x2,this.line.y2),this.line.draw()}isRendered(){return this.group!==null}render(){this.group=new m.A("g"),this.group.attr("class",this.cssClass),this.line=new Hn.A(this.group)}unbindFromParent(){this.group.removeFromParent(),this.drawn=!1}updateMelismaHorizontal(){const i=this.leftAnchor.getX(),g=this.rightAnchor.getX();this.line.setX1(i),this.line.setX2(g)}updateMelismaVertical(){const i=this.leftAnchor.getLyricPosY();this.line.setY1(i),this.line.setY2(i)}draw(){this.isRendered()||this.render(),this.updateMelismaHorizontal(),this.updateMelismaVertical(),this.drawMelisma(),this.bindToParent()}bindToParent(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)}}const Zo=function(){},ze=Zo.prototype;ze.reset=function(e,i,g){this.pendingAnchor=null,this.continuedAnchors=[],this.melismas=[],this.anchors=[],this.currentMeasureIdx=null,this.voiceIdx=e,this.firstDisplayedMeasureIdx=i,this.level=g},ze.parseMeasuresMelismas=function(e,i,g,O){return this.reset(g,i,O),e.forEach(this.parseMeasureMelismaAnchors,this),this.hasPending()&&this.tryClosePending(),this.melismas},ze.parseMeasureMelismaAnchors=function(e,i,g){if(i<this.firstDisplayedMeasureIdx)return;this.currentMeasureIdx=i,this.currentMeasure=e,this.isFirstMeasure=i===this.firstDisplayedMeasureIdx,this.isLastMeasure=i===g.length-1;const O=e.getMelismaAnchorsAtLevel(this.voiceIdx,this.level);this.addAnchors(O)},ze.addAnchors=function(e){e.forEach(this.addAnchor,this)},ze.addAnchor=function(e){if(this.anchors.push(e),e.isRight())this.addRightAnchor(e);else if(e.isLeft())this.addLeftAnchor(e);else throw new b.default("Unexpected")},ze.addRightAnchor=function(e){e.isContinued()?this.addRightContinuedAnchor(e):this.addRightStoping(e)},ze.addRightContinuedAnchor=function(e){this.hasPending()||this.createLeftPending(e),this.continuedAnchors.push(e)},ze.addRightStoping=function(e){this.hasPending()||this.createLeftPending(e),this.createConnection(e)},ze.hasContinued=function(){return this.continuedAnchors.length>0},ze.hasPending=function(){return this.pendingAnchor!==null},ze.addLeftAnchor=function(e){this.addPendingAnchor(e)},ze.createLeftPending=function(e){if(this.isFirstMeasure&&e.isAtTheBeginingOfMeasure())this.pendingAnchor=new Po.A({pos:wo.A.LEFT_PENDING,level:this.level});else{const i=e.getRenderedNote();this.pendingAnchor=new Po.A({renderedNote:i,pos:wo.A.LEFT_PENDING,level:this.level})}this.pendingAnchor.setMeasure(this.currentMeasure)},ze.tryClosePending=function(){const e=this.currentMeasure;if(!this.canClosePending())return;const i=new Po.A({pos:wo.A.RIGHT_PENDING,level:this.level});i.setMeasure(e),this.createConnection(i)},ze.canClosePending=function(){if(this.hasContinued())return!0;const e=this.currentMeasure;return!(this.pendingAnchor.getMeasure()!==e||!this.pendingAnchor.isAtTheEndOfMeasure())},ze.addPendingAnchor=function(e){this.hasPending(),this.pendingAnchor=e},ze.createConnection=function(e){let i=null;return this.pendingAnchor.hasMelisma()?i=this.pendingAnchor.getMelisma():e.hasMelisma()?i=e.getMelisma():i=new ts,i.setLeftAnchor(this.pendingAnchor),i.setRightAnchor(e),this.pendingAnchor=null,this.melismas.push(i),this.hasContinued()&&(i.setContinuedAnchors(this.continuedAnchors),this.continuedAnchors=[]),i};const zr=Zo,kr="adagio-voice-uuid",Do=function(e){this.init(e)};Do.cssClass="staffMelismas melismas-";const ys=Do.prototype;ys.cssClass=Do.cssClass,ys.init=function({voiceIdx:e,voiceUuid:i}){this.voiceIdx=e,this.voiceUuid=i,this.melismasLinker=new zr,this.melismas=[],this.drawingContext=null,this.posY=null,this.parent=null,this.group=null,this.drawn=!1},ys.updateFromMeasures=function(e,i){this.melismas=[];const g={};e.forEach(O=>{O.hasVoice(this.voiceIdx)&&O.getVoiceMelismaLevels(this.voiceIdx).forEach(cr,g)});for(const O in g){const X=this.melismasLinker.parseMeasuresMelismas(e,i,this.voiceIdx,O);Array.prototype.push.apply(this.melismas,X)}this.melismas.forEach(this.transferDrawingContext,this),this.isRendered()&&this.melismas.forEach(this.transfertParent,this)};function cr(e){const i=this;i[e]=!0}ys.transfertParent=function(e){e.setParent(this.group)},ys.removeMeasure=function(e){e.getAllMelismasAnchors(this.voiceIdx).forEach(this.unbindAnchor,this)},ys.unbindAnchor=function(e){if(e.hasMelisma()){const i=e.getMelisma();this.removeMelisma(i)}},ys.removeMelisma=function(e){const i=this.melismas.indexOf(e);this.melismas.splice(i,1),e.erase()},ys.setPosition=function(e){this.posY=e},ys.setDrawingContext=function(e){this.drawingContext=e,this.melismas.forEach(this.transferDrawingContext,this)},ys.transferDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},ys.setParent=function(e){this.parent=e},ys.draw=function(){this.renderIfNeeded(),this.melismas.forEach(Xr),this.move(),this.bindToParent()},ys.renderIfNeeded=function(){this.isRendered()||this.render()},ys.isRendered=function(){return this.group!==null},ys.render=function(){this.group=new m.A("g"),this.group.setDataEntry(kr,this.voiceUuid),this.group.attr("class",this.cssClass+this.voiceIdx),this.melismas.forEach(this.transfertParent,this)},ys.move=function(){this.isRendered()&&this.group.attr("transform",`translate(0, ${this.posY})`)},ys.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.group),this.drawn=!0)};const Xr=function(e){e.draw()};ys.updateVerticalDisplay=function(){this.melismas.forEach(Fn)};const Fn=function(e){e.updateVerticalDisplay()};ys.updateHorizontalDisplay=function(){this.melismas.forEach(Co)};const Co=function(e){e.updateHorizontalDisplay()};ys.getMelismas=function(){return this.melismas},ys.getGroup=function(){return this.group};const Ps=Do,Vr="adagio-staff-uuid",Dn=function(e,i,g){this.init(e,i,g)};Dn.cssClass="staff",Dn.tabCssClass="tab-staff";const Lt=Dn.prototype;Lt.cssClass=Dn.cssClass,Lt.tabCssClass=Dn.tabCssClass,Lt.init=function(e,i,g){this.drawingContext=null,this.staffData=f.A.createDefault(),this.posY=null,this.verticalFormattingBySystemLocation={},this.width=null,this.lyricsUpY=null,this.firstDisplayedMeasureIdx=0,this.staffUuid=i,this.voiceIdxToUuidMapping=g,this.systemLocation=B.A.OTHER,this.drawnSystemLocation=null,this.parent=null,this.group=null,this.measures=[],this.fakeMeasure=null,this.ties={},this.hyphens={},this.hammerOnPullOffs={},this.slurs={},this.bends={},this.melismas={},this.glissandos={},this.slides={},this.staffLines=new we.A,this.wedges=new Uo,this.octaveShifts=new ko,this.pluckedRanges=new Ue,this.tempoChanges=new Ai,this.staffEndings=new jo,this.pedals=new se,this.crossMeasuresContainers=[this.wedges,this.octaveShifts,this.pluckedRanges,this.tempoChanges,this.staffEndings,this.pedals],this.staffData=null,this.fillVoices(e);const O=f.A.createDefault();this.setStaffData(O)},Lt.fillVoices=function(e){e.forEach(this.fillVoice,this)},Lt.fillVoice=function(e){const i=this.voiceIdxToUuidMapping[e],g=new Xe(e),O=new ai(e),X=new wt(e,i),ft=new Ur({voiceIdx:e,voiceUuid:i}),Ut=new Ps({voiceIdx:e,voiceUuid:i}),Zt=new Z(e),De=new zi(e),Ie=new Un(e);if(X.setStaff(this),this.ties[e]=g,this.hyphens[e]=O,this.slurs[e]=X,this.bends[e]=ft,this.melismas[e]=Ut,this.glissandos[e]=Zt,this.slides[e]=De,this.hammerOnPullOffs[e]=Ie,this.crossMeasuresContainers.push(g),this.crossMeasuresContainers.push(O),this.crossMeasuresContainers.push(X),this.crossMeasuresContainers.push(ft),this.crossMeasuresContainers.push(Ut),this.crossMeasuresContainers.push(Zt),this.crossMeasuresContainers.push(De),this.crossMeasuresContainers.push(Ie),this.drawingContext!==null&&(g.setDrawingContext(this.drawingContext),O.setDrawingContext(this.drawingContext),X.setDrawingContext(this.drawingContext),ft.setDrawingContext(this.drawingContext),Ut.setDrawingContext(this.drawingContext),Zt.setDrawingContext(this.drawingContext),De.setDrawingContext(this.drawingContext),Ie.setDrawingContext(this.drawingContext)),this.staffData!==null){const me=this.getStaffData();g.setStaffData(me),O.setStaffData(me),X.setStaffData(me),ft.setStaffData(me),Zt.setStaffData(me),De.setStaffData(me),Ie.setStaffData(me)}if(this.group!==null){const me=this.getSpaceAbove();g.setParent(this.group),g.setPosition(me),g.draw(),O.setParent(this.group),O.setPosition(me),O.draw(),X.setParent(this.group),X.setPosition(me),X.draw(),ft.setParent(this.group),ft.setPosition(me),ft.draw(),Ut.setParent(this.group),Ut.setPosition(me),Ut.draw(),Zt.setParent(this.group),Zt.setPosition(me),Zt.draw(),De.setParent(this.group),De.setPosition(me),De.draw(),Ie.setParent(this.group),Ie.setPosition(me),Ie.draw()}},Lt.setParent=function(e){this.parent=e},Lt.setSystemLocation=function(e){this.systemLocation!==e&&(this.systemLocation=e,this.measures.forEach(i=>i.setSystemLocation(e)),this.systemLocation!==this.drawnSystemLocation&&this.reloadCommonContentCrossMeasures())},Lt.setDrawingContext=function(e){this.drawingContext=e,this.crossMeasuresContainers.forEach(this.dispatchDrawingContext,this),this.staffLines.setDrawingContext(e)},Lt.dispatchDrawingContext=function(e){e.setDrawingContext(this.drawingContext)},Lt.setPosition=function(e){this.posY=e},Lt.setLyricsUpY=function(e){this.lyricsUpY=e},Lt.setStaffData=function(e){this.staffData=e,this.crossMeasuresContainers.forEach(this.dispatchStaffData,this),this.staffLines.setStaffData(e)},Lt.dispatchStaffData=function(e){e.setStaffData&&e.setStaffData(this.getStaffData())},Lt.insertMeasure=function(e,i){e.setSystemLocation(this.systemLocation),this.measures.splice(i,0,e),e.setStaffData(this.staffData);const g=this.getGroup();e.setParent(g),this.width=null},Lt.replaceMeasure=function(e,i){const g=this.measures[i];g.setParent(null),g.updateBinding(),this.signalRemovedToCrossMeasures(g),e.setSystemLocation(this.systemLocation),this.measures[i]=e,e.setStaffData(this.getStaffData());const O=this.getGroup();e.setParent(O),this.width=null},Lt.eraseMeasure=function(e){if(typeof e!="undefined"){const i=this.measures.splice(e,1)[0];i.setParent(null),i.updateBinding(),this.signalRemovedToCrossMeasures(i)}this.width=null},Lt.signalRemovedToCrossMeasures=function(e){this.crossMeasuresContainers.forEach($r,e)};function $r(e){const i=this;e.removeMeasure(i)}Lt.updateChildrenBindings=function(){for(let e=this.measures.length-1;e>=0;e--){const i=this.measures[e];if(!i.isInDisplayedRange()){i.unbind();continue}if(!i.needUpdateBinding())continue;if(e===this.measures.length-1)i.setInsertionPoint(this.fakeMeasure);else{const X=this.measures[e+1].getGroup();i.setInsertionPoint(X)}i.updateBinding()}},Lt.drawContentRec=function(){this.drawnMeasures=this.measures.filter(e=>e.isInDisplayedRange()),this.drawContent(),this.drawnMeasures.forEach(e=>e.drawContentRec())},Lt.drawContent=function(){this.formatHorizontally(),this.formatVertically(),this.staffLines.isRendered()||this.staffLines.draw(),this.isRecorderTabStaff()||this.crossMeasuresContainers.forEach(e=>e.draw()),this.drawnMeasures.forEach(e=>e.move())},Lt.formatHorizontally=function(){const e=this.getWidth();this.staffLines.setWidth(e)},Lt.formatVertically=function(){const e=this.getSpaceAbove();this.staffLines.setPosition(e),this.crossMeasuresContainers.forEach(i=>i.setPosition(e)),this.drawnMeasures.forEach(i=>i.setPosY(e))},Lt.getGroup=function(){return this.group===null&&(this.group=new m.A("g"),this.group.setDataEntry(Vr,this.staffUuid),this.group.attr("class",this.isTabStaff()?`${this.cssClass} ${this.tabCssClass}`:this.cssClass),this.crossMeasuresContainers.forEach(this.dispatchParent,this),this.staffLines.setParent(this.group)),this.group},Lt.dispatchParent=function(e){e.setParent(this.group)},Lt.move=function(){this.getGroup().attr("transform",`translate(0, ${this.posY})`)},Lt.bindToParent=function(){this.parent.append(this.group)},Lt.getMeasuresHorizontalData=function(e){return[this.measures[e].getHorizontalData()]},Lt.dispatchHorizontalFormattingForVerticalComputation=function(e){if(this.measures.length!==e.length)throw new b.default("Number of horizontal formattings must equal number of measures");let i=0;this.measures.forEach((g,O)=>{g.setPosX(i);const X=e[O];g.dispatchHorizontalFormattingForVerticalComputation(X);const ft=X.getNominalWidth();i+=ft}),this.updateCrossMeasuresHorizontalDisplayForVerticalComputation()},Lt.updateCrossMeasuresHorizontalDisplayForVerticalComputation=function(){this.forEachVoiceTies(qo),this.forEachVoiceSlurs(qo),this.forEachVoiceHammerOnPullOffs(qo)};function qo(e){e.updateHorizontalDisplay()}Lt.dispatchHorizontalFormatting=function(e){if(this.measures.length!==e.length)throw new b.default("Number of horizontal formattings must equal number of measures");let i=0;this.measures.forEach((g,O)=>{g.setPosX(i);const X=e[O];g.isInDisplayedRange()&&g.dispatchHorizontalFormatting(X);const ft=X.getWidth();i+=ft}),this.width=i},Lt.dispatchVerticalFormatting=function(){const e=this.getVerticalFormatting();if(this.measures.length!==e.measures.length)throw new b.default("Number of horizontal formattings must equal number of measures");this.measures.forEach((i,g)=>{const O=e.measures[g];O!==null&&i.dispatchVerticalFormatting(O)})},Lt.getHeight=function(){return this.getVerticalFormatting().height},Lt.getSpaceAbove=function(){return this.getVerticalFormatting().spaceAbove},Lt.getSpaceBelow=function(){return this.getVerticalFormatting().spaceBelow},Lt.getNotesSpaceAbove=function(){return this.getVerticalFormatting().notesSpaceAbove},Lt.getNotesSpaceBelow=function(){return this.getVerticalFormatting().notesSpaceBelow},Lt.getVerticalFormatting=function(){if(typeof this.verticalFormattingBySystemLocation[this.systemLocation]=="undefined"){const e=tt(this);this.verticalFormattingBySystemLocation[this.systemLocation]=e}return this.verticalFormattingBySystemLocation[this.systemLocation]},Lt.dropVerticalFormatting=function(){this.verticalFormattingBySystemLocation={}},Lt.drawCursor=function(e,i){this.measures[e.measureIdx].drawCursor(e,i)},Lt.drawGraceCursor=function(e,i){this.measures[e.measureIdx].drawGraceCursor(e,i)},Lt.drawDynamicCursor=function(e,i){this.measures[e.measureIdx].drawDynamicCursor(e,i)},Lt.drawPizzicatoCursor=function(e,i){this.measures[e.measureIdx].drawPizzicatoCursor(e,i)},Lt.drawMuteCursor=function(e,i){this.measures[e.measureIdx].drawMuteCursor(e,i)},Lt.drawHorizontalMeasureWideCursor=function(e,i){const O=this.measures[e.measureIdx].getNbNotes(e.voiceIdx),X={startMeasureIdx:e.measureIdx,startNoteIdx:0,stopMeasureIdx:e.measureIdx,stopNoteIdx:O,startVoiceIdx:e.voiceIdx,stopVoiceIdx:e.voiceIdx};this.drawHorizontalCursor(X,i)},Lt.drawHorizontalCursor=function(e,i){let g;e.startNoteIdx!==null?g=this.getMeasure(e.startMeasureIdx).getNote(e.startVoiceIdx,e.startNoteIdx).getTimePos():g=null;let O;if(e.stopNoteIdx!==null){const X=this.getMeasure(e.stopMeasureIdx),ft=X.getNbNotes(e.stopVoiceIdx);e.stopNoteIdx===ft?O=X.getTickableContent().getNbDivisions():O=X.getNote(e.stopVoiceIdx,e.stopNoteIdx).getTimePos()}else O=null;i.addSegment(this,e.startMeasureIdx,g,e.stopMeasureIdx,O)},Lt.drawHorizontalCursorTimePos=function(e,i){i.addSegment(this,e.startMeasureIdx,e.startTimePos,e.stopMeasureIdx,e.stopTimePos)},Lt.drawCrossMeasureNoteCursor=function(e,i){i.addSegment(this,e.startMeasureIdx,e.startNoteIdx,e.stopMeasureIdx,e.stopNoteIdx)},Lt.setNoteColor=function(e,i){this.getMeasure(e.measureIdx).setNoteColor(e,i)},Lt.autoUpdateHorizontalDisplay=function(){const e=this.measures.length,i=[];for(let g=0;g<e;g++){const O=Ht(this,g);i.push(O)}this.dispatchHorizontalFormatting(i)},Lt.autoUpdateVerticalDisplay=function(){this.dispatchVerticalFormatting()},Lt.reloadCrossMeasures=function(){this.crossMeasuresContainers.forEach(this.callUpdateFromMeasures,this),this.drawnSystemLocation=this.systemLocation},Lt.reloadCommonContentCrossMeasures=function(){this.callUpdateFromMeasures(this.tempoChanges),this.callUpdateFromMeasures(this.staffEndings),this.drawnSystemLocation=this.systemLocation},Lt.callUpdateFromMeasures=function(e){e.updateFromMeasures(this.measures,this.firstDisplayedMeasureIdx)},Lt.connectWith=function(e){const g=e.posY-this.posY+e.getSpaceAbove()-(this.getSpaceAbove()+this.getStaffHeight());this.extendBarlines(g)},Lt.extendBarlines=function(e){this.measures.forEach(function(i){i.extendBarlines(e)})},Lt.getWidth=function(){return this.width===null&&this.calcWidth(),this.width},Lt.calcWidth=function(){const e=this.measures[this.measures.length-1],i=e.getXPos(),g=e.getWidth();this.width=i+g;const O=this.measures.map(ma);this.width=O.reduce(v.default.add)};const ma=function(e){return e.getWidth()};Lt.getNbMeasures=function(){return this.measures.length},Lt.getLyricsUpY=function(e,i){i=di(i);const g=this.getGlobalLyricsUpY(),O=this.getMeasureLyricsUpY(e);let X=Math.max(g,O);return X+=this.drawingContext.getLyricsFontSize()*i,X};const di=function(e){return ki.default.isValid(e)?e:0};Lt.getMeasureLyricsUpY=function(e){const i=this.measures[e];let g=i.getLyricsUpY();return i.hasLyrics()||(g+=this.drawingContext.getSpaceSize()),g},Lt.getGlobalLyricsUpY=function(){return this.lyricsUpY!==null?this.lyricsUpY:0},Lt.getMeasureWordsY=function(e,i){return this.getMeasure(e).getWordsY(i)},Lt.getChordsY=function(e){return this.getMeasure(e).getChordsY()},Lt.getClassicHarmonyY=function(e){return this.getMeasure(e).getClassicHarmonyY()},Lt.getFiguredBassY=function(e,i){return this.getMeasure(e).getFiguredBassY(i)},Lt.getMeasureWidth=function(e){return this.getMeasure(e).getWidth()},Lt.getMeasurePosX=function(e){return this.getMeasure(e).getXPos()},Lt.getNoteXInMeasure=function(e,i,g){const X=this.getMeasure(e).getTickableContent();return g>0?X.getNoteX(i,g):X.getXPos()},Lt.getTimePosXInMeasure=function(e,i,g){const X=this.getMeasure(e).getTickableContent(),Ut=X.getDpq()/g,Zt=i*Ut,De=X.timePosToXSafe(Zt);return X.getXPos()+De},Lt.getMeasureNbNotes=function(e,i){return this.getMeasure(e).getNbNotes(i)},Lt.setMeasuresGapAbove=function(e){this.measures.forEach(xo,e)};function xo(e){const i=this.valueOf();e.setGapAbove(i)}Lt.setMeasuresGapBelow=function(e){this.measures.forEach(lr,e)};function lr(e){const i=this.valueOf();e.setGapBelow(i)}Lt.resetGeometries=function(){this.measures.forEach(js)};const js=function(e){e.resetGeometry()};Lt.getMeasureGeometry=function(e){return this.measures[e].getGeometry()},Lt.getMeasures=function(){return this.measures},Lt.getNotes=function(){const e=[];return this.measures.forEach(function(i){e.push(i.getNotes())},this),e},Lt.getDrawingContext=function(){return this.drawingContext},Lt.getInnerHeight=function(){const e=this.getHeight(),i=this.getSpaceAbove(),g=this.getSpaceBelow();return e-(i+g)},Lt.getStaffData=function(){return this.staffData},Lt.getNbStaffLines=function(){const e=this.getStaffData();return f.A.getNbStaffLines(e)},Lt.isTabStaff=function(){const e=this.getStaffData();return f.A.isTabStaff(e)},Lt.isRecorderTabStaff=function(){const e=this.getStaffData();return f.A.isRecorderTabStaff(e)},Lt.getSpaceSize=function(){return this.isTabStaff()?this.drawingContext.getTabSpaceSize():this.drawingContext.getSpaceSize()},Lt.getStaffHeight=function(){return this.getSpaceSize()*(this.getNbStaffLines()-1)},Lt.getWedges=function(){return this.wedges.getWedges()},Lt.getOctaveShifts=function(){return this.octaveShifts.getOctaveShifts()},Lt.getPluckedRanges=function(){return this.octaveShifts.getPluckedRanges()},Lt.getTempoChanges=function(){return this.tempoChanges.getTempoChanges()},Lt.getStaffEndings=function(){return this.staffEndings.getEndings()},Lt.getPedals=function(){return this.pedals.getPedals()},Lt.getWedgesContainer=function(){return this.wedges},Lt.getOctaveShiftsContainer=function(){return this.octaveShifts},Lt.getPluckedRangesContainer=function(){return this.octaveShifts},Lt.getTempoChangesContainer=function(){return this.tempoChanges},Lt.getEndingsContainer=function(){return this.endings},Lt.getPedalsContainer=function(){return this.pedals},Lt.hasDrawingContext=function(){return this.drawingContext!==null},Lt.getMeasureFullAttributesGroup=function(e){return this.getMeasure(e).getFullAttributesGroup()},Lt.updateMeasuresEventsRects=function(){this.measures.forEach(ur)};function ur(e){e.updateEventsRect()}Lt.getMeasure=function(e){return this.checkMeasureIdx(e),this.measures[e]},Lt.getAllSlurs=function(){const i=It.default.getValues(this.slurs).map(fr);return Array.prototype.concat.apply([],i)};const fr=function(e){return e.getSlurs()};Lt.getSlurs=function(e){if(!v.default.isInteger(e)||typeof this.slurs[e]=="undefined")throw new b.default("BadVoiceIdx",`the voiceIdx [${e}] is invalid.`);return this.slurs[e]},Lt.checkMeasureIdx=function(e){if(typeof e!="number"||Number.isNaN(e)||e<0||e>=this.measures.length){const i=`Invalid measureIdx: [${e}].`;throw new b.default("BadMeasureIdx",i)}},Lt.forEachVoiceTies=function(e,i){for(const g in this.ties){const O=this.ties[g];e.call(i,O,g)}},Lt.forEachVoiceHammerOnPullOffs=function(e,i){for(const g in this.hammerOnPullOffs){const O=this.hammerOnPullOffs[g];e.call(i,O,g)}},Lt.forEachVoiceSlurs=function(e,i){for(const g in this.slurs){const O=this.slurs[g];e.call(i,O,g)}},Lt.getMeasureElem=function(e){return this.getMeasure(e).getGroup()},Lt.getMeasureEventRect=function(e){return this.getMeasure(e).getEventRect()},Lt.setFakeMeasure=function(e){this.fakeMeasure=e},Lt.getFirstDisplayedMeasure=function(){return this.measures[this.firstDisplayedMeasureIdx]},Lt.setFirstDisplayedMeasure=function(e){this.firstDisplayedMeasureIdx=e,this.measures.forEach((i,g)=>{const O=g>=e;i.setIsMeasureInDisplayedRange(O)})},Lt.isEmpty=function(){return this.measures.every(e=>e.isEmpty())},Lt.updateMeasureNumbers=function(){this.measures.forEach(e=>e.updateMeasureNumberDisplay())},Lt.drawVerticalDebug=function(){this.measures.forEach(function(e){e.drawVerticalDebug()})};const dr=Dn,tn=/(\d+)/,tr=10,vo=function(e,i,g){this.init(e,i,g)},Ls=vo.prototype;Ls.init=function(e,i,g){this.scoreDataCache=e,this.drawingContext=i,this.pageOpts=g,this.fillDefaults(),this.partsNamesPanel=null},Ls.setPartsNamesPanel=function(e){this.partsNamesPanel=e},Ls.fillDefaults=function(){typeof this.pageOpts.displayFirstLinePartsNames=="undefined"&&(this.pageOpts.displayFirstLinePartsNames=!0),typeof this.pageOpts.displayOtherLinesPartsNames=="undefined"&&(this.pageOpts.displayOtherLinesPartsNames=!0)},Ls.setDrawingContext=function(e){this.drawingContext=e},Ls.getAllSystems=function(e){const i=[],g=this.getNbSystems();for(let O=0;O<g;O++){const X=this.getSystem(O,e);i.push(X)}return i},Ls.getNbSystems=function(){return this.scoreDataCache.getNbParts()},Ls.getSystem=function(e,i){const g=this.getPartUuid(e),O=this.getNbStaves(e),X=this.getWrappedStaffDetails(e),ft=this.getWrappedClef(e),Ut=X.dumpAttribute().some(a.default.hasRecorderTabs),Zt=ft.dumpAttribute().some(P.default.isTab),De=X.dumpAttribute().some(a.default.hasKodaly),Ie=Zt||De?d.BRACKET:d.BRACE,me=new pe(g);Ut&&me.setIsRecorderTab(!0);let Qs;i?this.pageOpts.displayFirstLinePartsNames&&(Qs=this.getSystemName(e,i)):this.pageOpts.displayFirstLinePartsNames&&this.pageOpts.displayOtherLinesPartsNames&&(Qs=this.getSystemName(e,i)),this.partsNamesPanel!==null&&me.setIsMinimalName(!0),Qs&&Qs.trim()!==""&&this.setSystemName(me,Qs,e),me.setDrawingContext(this.drawingContext),me.setClampType(Ie);for(let ni=0;ni<O;ni++){const oo=X.getEntry(ni),To=f.A.createFromStaffDetails(oo);let er,Lo;const jr=this.getVoiceIdxToUuidMapping(e);f.A.isTabStaff(To)||f.A.isKodalyStaff(To)||f.A.isRecorderTabStaff(To)?(er=this.getVoicesIndexes(e,0),Lo=this.getStaffUuid(e,0)):(er=this.getVoicesIndexes(e,ni),Lo=this.getStaffUuid(e,ni));const ro=new dr(er,Lo,jr);ro.setStaffData(To),ro.setDrawingContext(this.drawingContext),me.addStaff(ro)}return me.initNominalHeight(),me.transferHeaderExternalSpace(),me.setIdx(e),me},Ls.setSystemName=function(e,i,g){if(i=i.trim(),this.partsNamesPanel){const O=gr(i);e.setSmallName(O),i.length>tr&&(i=this.getSystemName(g,!1),i=i.trim()),i.length>tr&&(i=i.slice(0,tr-1),i=`${i.trim()}.`)}e.setName(i)};function gr(e){const i=e.slice(0,1),O=e.slice(1).match(tn);return O===null?`${i}.`:`${i}${O[0]}`}Ls.insertGroups=function(e){this.scoreDataCache.getGroups().forEach((g,O)=>{g.forEach(X=>{e[X].setGroupIdx(O)})})},Ls.getPartUuid=function(e){return this.scoreDataCache.getPartUuid(e)},Ls.getStaffUuid=function(e,i){return this.scoreDataCache.getPartStaffUuid(e,i)},Ls.getVoiceIdxToUuidMapping=function(e){return this.scoreDataCache.getPartVoiceIdxToUUidMapping(e)},Ls.getVoicesIndexes=function(e,i){return this.scoreDataCache.getPartStaffVoicesIndexes(e,i)},Ls.getSystemName=function(e,i){const g=this.scoreDataCache.getPartHeader(e);return i?A.default.getName(g):A.default.hasAbbreviation(g)?A.default.getAbbreviation(g):A.default.inferAbbreviation(g)},Ls.getNbStaves=function(e){const i=this.getFirstMeasure(e);return w.default.getNbStaves(i)},Ls.getWrappedStaffDetails=function(e){const i=this.getFirstMeasure(e);return w.default.getWrappedStaffDetailsOrDefault(i)},Ls.getWrappedClef=function(e){const i=this.getFirstMeasure(e);return w.default.getWrappedClef(i)},Ls.getFirstMeasure=function(e){return this.scoreDataCache.getMeasure(e,0)},Ls.hasSingleStaff=function(){if(this.getNbSystems()>1)return!1;const i=this.getNbStaves(0),O=this.getWrappedStaffDetails(0).dumpAttribute().some(a.default.hasRecorderTabs);return!(i>1&&!O)};const Kr=vo},658628:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>x});var A=r(364842),w=r(794799),f=r(75861),P=r(435808),a=r(900576);const h=function(S,T,Y,G,q){this.init(S,T,Y,G,q)},d=h.prototype;d.init=function(S,T,Y,G,q){this.measure=null,this.slur=null,this.slurUuid=G||null,this.measureIdx=null,this.type=S,this.noteIdx=T,this.voiceIdx=Y,this.placement=q},d.setMeasure=function(S){this.measure=S},d.hasPosition=function(){return this.measure.getXPos()!==null},d.hasExplicitPlacement=function(){return this.placement!==P.A.AUTO},d.getPlacement=function(){return this.placement},d.getLocation=function(){const S=this.getNoteIdx();return a.A.create(this.measureIdx,this.voiceIdx,S)},d.getFirstStem=function(){const S=this.getNoteIdx(),T=this.inferVoiceIdx(),Y=this.measure.getNote(T,S);return Y.isRest()?f.A.UP:Y.getDisplayData().getStemValue()},d.getNoteIdx=function(){if(this.noteIdx!==null)return this.noteIdx;if(this.type===w.A.START)return 0;if(this.type===w.A.STOP){const S=this.inferVoiceIdx();return this.measure.getNbNotes(S)-1}else throw new A.default("Unexpected")},d.inferVoiceIdx=function(){return this.measure.getTickableContent().getAnyVoiceIdx(this.voiceIdx)},d.getLeftCrossPoints=function(){if(this.type!==w.A.START||this.isMiddle()){const p="Cannot call `getLeftCrossPoints` on a non left cross measure anchor.";throw new A.default("Unexpected",p)}const S=this.measure.tickableContent,T=this.measure.getXPos()+S.getXPos(),G=this.measure.drawingContext.getMarginSize(),q=T-(S.getPreviousSpace()+G);return this.createPoints(q)},d.getRightCrossPoints=function(){if(this.type!==w.A.STOP||this.isMiddle()){const R="Cannot call `getRightCrossPoints` on a non right cross measure anchor.";throw new A.default("Unexpected",R)}const S=this.measure,T=S.tickableContent,G=S.getXPos()+T.getXPos()+T.getWidth();return this.createPoints(G)},d.createPoints=function(S){const T=this.getNoteIdx(),Y=this.inferVoiceIdx(),G=this.measure.getNote(Y,T),q={above:[],below:[]},R=l(G),p={x:S,y:R};q.above.push(p);const b=m(G),v={x:S,y:b};return q.below.push(v),q};const l=function(S){const G=-S.drawingContext.getMarginSize(),q=S.getHighestYWithMarge();return Math.min(G,q)},m=function(S){const T=S.getNbStaffLines(),Y=S.drawingContext,G=S.isTabStaff()?Y.getTabSpaceSize():Y.getSpaceSize(),q=(T-.5)*G,R=S.getLowestYWithMarge();return Math.max(q,R)};d.isMiddle=function(){return this.noteIdx!==null},d.hasCrossMeasure=function(){return this.noteIdx===null},d.hasSlur=function(){return this.slur!==null},d.isLeft=function(){return this.type===w.A.START},d.isRight=function(){return this.type===w.A.STOP},d.setSlur=function(S){this.slur=S},d.getSlur=function(){return this.slur},d.removeSlur=function(){this.isLeft()?this.slur.removeLeftAnchor():this.isRight()?this.slur.removeRightAnchor():w.A.raiseError(this.type)},d.setNeedDrawUpdate=function(){this.hasSlur()&&this.getSlur().setNeedDrawUpdate()},d.setMeasureIdx=function(S){this.measureIdx=S},d.getMeasureIdx=function(){return this.measureIdx},d.getVoiceIdx=function(){return this.voiceIdx},d.getSlurUuid=function(){return this.slurUuid};const x=h},667193:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});const A=function(){this.init()},w=A.prototype;w.init=function(){this.strings=[],this.higherHammerOnPullOff=null,this.lowerHammerOnPullOff=null},w.setLeftNote=function(P){this.leftNote=P},w.setRightNote=function(P){this.rightNote=P},w.fillData=function(){this.extractHammerOnPullOffs()},w.extractHammerOnPullOffs=function(){this.strings=this.leftNote.getHammerOnPullOffStarts();const P=this.rightNote.getHammerOnPullOffStops();this.strings.forEach(function(a,h){a<=3?(this.higherHammerOnPullOff===null||this.higherHammerOnPullOff.string>a)&&this.setHigherHammerOnPullOff(a,P[h]):(this.lowerHammerOnPullOff===null||this.lowerHammerOnPullOff.string<a)&&this.setLowerHammerOnPullOff(a,P[h])},this)},w.setHigherHammerOnPullOff=function(P,a){const h={string:P,rightString:a,staffData:this.leftNote.getStaffData(),placement:"above",rightSide:{},leftSide:{},isExternal:!0};this.higherHammerOnPullOff=h},w.setLowerHammerOnPullOff=function(P,a){const h={string:P,rightString:a,staffData:this.leftNote.getStaffData(),placement:"below",rightSide:{},leftSide:{},isExternal:!0};this.lowerHammerOnPullOff=h},w.hasHammerOnPullOffs=function(){return this.higherHammerOnPullOff!==null||this.lowerHammerOnPullOff!==null},w.getHammerOnPullOffs=function(){const P=[];return this.higherHammerOnPullOff!==null&&P.push(this.higherHammerOnPullOff),this.lowerHammerOnPullOff!==null&&P.push(this.lowerHammerOnPullOff),P};const f=A},679333:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>fe});var A=r(900576);const w=function(gt,At,Ht){const Wt={above:[],below:[]},k=At.getLocation(),St=Ht.getLocation(),yt=A.A.copy(k);for(;!yt.endReached;){if(!x(gt,yt)){S(gt,yt,St);continue}let Ct=h(gt,yt);const Mt=l(gt,yt),Tt=m(Mt);Ct+=Tt,A.A.isEqual(yt,k)||f(yt,gt,Wt,Ct);const nt=P(Mt),vt={x:Ct,y:nt,type:"note"};Wt.above.push(vt);const Nt=a(Mt),te={x:Ct,y:Nt,type:"note"};Wt.below.push(te),S(gt,yt,St)}return Wt},f=function(gt,At,Ht,Wt){d(At,gt).forEach(function(St){const yt=St.getXPos(),Ct=Wt+yt,Mt=P(St),Tt={x:Ct,y:Mt,type:"note"};Ht.above.push(Tt);const nt=a(St),vt={x:Ct,y:nt,type:"note"};Ht.below.push(vt)})},P=function(gt){const Ht=gt.drawingContext.getMarginSize(),Wt=-Ht,k=gt.getHighestTupletY()-Ht;return Math.min(Wt,k)},a=function(gt){const At=gt.getNbStaffLines(),Ht=gt.drawingContext,Wt=gt.isTabStaff()?Ht.getTabSpaceSize():Ht.getSpaceSize(),k=Ht.getMarginSize(),St=(At-.5)*Wt,yt=gt.getLowestTupletY()+k;return Math.max(St,yt)},h=function(gt,At){const Ht=gt.getMeasure(At.measureIdx),Wt=T(Ht,At.voiceIdx);return Ht.getNoteX(Wt,At.noteIdx)},d=function(gt,At){const Ht=gt.getMeasure(At.measureIdx),Wt=T(Ht,At.voiceIdx);return Ht.getNoteGraces(Wt,At.noteIdx)},l=function(gt,At){const Ht=gt.getMeasure(At.measureIdx),Wt=T(Ht,At.voiceIdx);return Ht.getNote(Wt,At.noteIdx)},m=function(gt){return gt.getMiddleHeadWidth()/2},x=function(gt,At){const Ht=gt.getMeasure(At.measureIdx),Wt=T(Ht,At.voiceIdx),k=Ht.getNbNotes(Wt);return At.noteIdx<k&&At.noteIdx>=0},S=function(gt,At,Ht){if(A.A.isGreaterOrEqual(At,Ht)){At.endReached=!0;return}At.noteIdx++;let Wt=gt.getMeasure(At.measureIdx),k=T(Wt,At.voiceIdx);const St=Wt.getNbNotes(k);for(At.noteIdx>=St&&(At.measureIdx++,At.noteIdx=0),Wt=gt.getMeasure(At.measureIdx),k=T(Wt,At.voiceIdx);k===null;)At.measureIdx++,Wt=gt.getMeasure(At.measureIdx),k=T(Wt,At.voiceIdx)},T=function(gt,At){return gt.getTickableContent().getAnyVoiceIdx(At)},Y=w,G=function(gt,At,Ht){const Wt={above:[],below:[]},k=At.getMeasureIdx(),St=Ht.getMeasureIdx(),yt=At.getVoiceIdx();for(let Ct=k;Ct<=St;Ct++){const Mt=gt.getMeasure(Ct),Tt=R(Mt,yt),nt=Mt.getTickableContent(),vt=nt.getVoiceInternalTies(Tt),Nt={points:Wt,measure:Mt,tickableContent:nt};vt.forEach(q,Nt)}return Wt},q=function(gt){const At=this,Ht=gt.leftNote,Wt=gt.rightNote.getXPos()-Ht.getXPos(),St=At.measure.getXPos()+At.tickableContent.getXPos()+Ht.getXPos()+Wt/2,yt=gt.getTopY(),Ct={x:St,y:yt,type:"tie"};At.points.above.push(Ct);const Mt=gt.getBottomY(),Tt={x:St,y:Mt,type:"tie"};At.points.below.push(Tt)},R=function(gt,At){return gt.getTickableContent().getAnyVoiceIdx(At)},p=G,v=function(gt,At){const Ht={above:[],below:[]};let Wt=0,k=0;const St=gt.above.length,yt=At.above.length;for(;Wt<St||k<yt;){let Ct,Mt;Wt>=St?Ct=null:Ct=gt.above[Wt].x,k>=yt?Mt=null:Mt=At.above[k].x,Mt!==null&&(Ct===null||Mt<Ct)?(Ht.above.push(At.above[k]),Ht.below.push(At.below[k]),k++):Ct!==null&&(Mt===null||Ct<=Mt)&&(Ht.above.push(gt.above[Wt]),Ht.below.push(gt.below[Wt]),Wt++)}return Ht},B=function(gt,At){const Ht={};return Ht.above=gt.above.filter(C,At),Ht.below=gt.below.filter(C,At),Ht},C=function(gt){const At=this,Ht=gt.x;return At.startX<=Ht&&Ht<=At.stopX},_=B;var st=r(364842),F=r(538783),L=r(435808);const I=function(gt,At,Ht){if(At.hasExplicitPlacement())return W(At);const Wt=At.getMeasureIdx(),k=Ht.getMeasureIdx(),St=At.getVoiceIdx();return V(Wt,k,St,gt).reduce(it)};function W(gt){const At=gt.getPlacement();if(At===L.A.ABOVE)return F.A.UP;if(At===L.A.BELOW)return F.A.DOWN;throw new st.default("Unexpected")}const V=function(gt,At,Ht,Wt){const k=[];for(let St=gt;St<=At;St++){const Ct=Wt.getMeasure(St).getTickableContent();if(Ct.hasVoice(Ht)){const Mt=Ct.getVoiceStemStrategy(Ht);k.push(Mt)}else k.push(F.A.AUTO)}return k},it=function(gt,At){if(gt===F.A.AUTO&&At===F.A.AUTO)return F.A.AUTO;if(gt!==F.A.AUTO&&At!==F.A.AUTO&&!Pt(gt,At)){const Ht="Some stem strategies are incompatible within the same voice.";throw new st.default("Unexpected",Ht)}else{if(gt!==F.A.AUTO)return gt;if(At!==F.A.AUTO)return At;throw new st.default("Unexpected")}};function Pt(gt,At){return!!(F.A.isUp(gt)&&F.A.isUp(At)||F.A.isDown(gt)&&F.A.isDown(At))}const Yt=I;var Bt=r(680285),le=r(269352),ie=r(589085),K=r(568357);const pe="adagio-slur-uuid",Ee=function(){this.init()};Ee.cssClass="slur";const tt=Ee.prototype;tt.cssClass=Ee.cssClass,tt.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.staff=null,this.curve=new Bt.A,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.drawn=!1},tt.setStaff=function(gt){this.staff=gt},tt.setParent=function(gt){this.parent=gt},tt.setCssClass=function(gt){this.cssClass=gt},tt.setStaffData=function(gt){this.staffData=gt},tt.setLeftAnchor=function(gt){this.hasLeftAnchor()&&this.leftAnchor!==gt&&this.removeLeftAnchor(),this.leftAnchor=gt,this.leftAnchor.slur=this},tt.hasLeftAnchor=function(){return this.leftAnchor!==null},tt.removeLeftAnchor=function(){this.hide(),this.leftAnchor.slur=null,this.leftAnchor=null},tt.setRightAnchor=function(gt){this.hasRightAnchor()&&this.rightAnchor!==gt&&this.removeRightAnchor(),this.rightAnchor=gt,this.rightAnchor.slur=this},tt.hasRightAnchor=function(){return this.rightAnchor!==null},tt.removeRightAnchor=function(){this.hide(),this.rightAnchor.slur=null,this.rightAnchor=null},tt.hide=function(){this.drawn&&this.unbindFromParent()},tt.setDrawingContext=function(gt){this.drawingContext=gt,this.curve.setDrawingContext(this.drawingContext)},tt.updateCurveHorizontal=function(){if(this.hasMissingPosition())return;const gt=this.getLeftAnchor(),At=gt.getFirstStem(),Ht=this.getRightAnchor(),Wt=this.getStaff(),k=Yt(Wt,gt,Ht),St=Y(Wt,gt,Ht);let yt=p(Wt,gt,Ht);yt=Et(yt,St);const Ct=v(St,yt);if(gt.hasCrossMeasure()){const Mt=gt.getLeftCrossPoints();ct(Ct,Mt)}if(Ht.hasCrossMeasure()){const Mt=Ht.getRightCrossPoints();Vt(Ct,Mt)}this.curve.setData(Ct.above,Ct.below,At,k)};const Et=function(gt,At){const Ht=At.above.length,Wt=At.above[0].x,k=At.below[Ht-1].x;return gt=_(gt,{startX:Wt,stopX:k}),gt};tt.hasMissingPosition=function(){const gt=this.getLeftMeasureIdx(),At=this.getRightMeasureIdx(),Ht=this.getStaff();for(let Wt=gt;Wt<=At;Wt++)if(Ht.getMeasure(Wt).getXPos()===null)return!0;return!1},tt.getStaff=function(){return this.staff};const Vt=function(gt,At){Array.prototype.push.apply(gt.above,At.above),Array.prototype.push.apply(gt.below,At.below)},ct=function(gt,At){Array.prototype.unshift.apply(gt.above,At.above),Array.prototype.unshift.apply(gt.below,At.below)};tt.getLeftAnchor=function(){return this.leftAnchor},tt.getRightAnchor=function(){return this.rightAnchor},tt.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.updateCurveHorizontal(),this.curve.draw(),this.bindToParent()},tt.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.curve.draw(),this.bindToParent()},tt.draw=function(){this.isRendered()||this.render(),this.updateCurveHorizontal(),this.curve.draw(),this.bindToParent()},tt.isRendered=function(){return this.group!==null},tt.render=function(){this.group=new le.A("g");const gt=this.getCssClasses();this.group.attr("class",gt),this.curve.setParent(this.group);const At=this.leftAnchor.getSlurUuid();this.group.setDataEntry(pe,At)},tt.getCssClasses=function(){const gt=[this.cssClass];return this.leftAnchor.isMiddle()&&gt.push(K.A.START),this.rightAnchor.isMiddle()&&gt.push(K.A.STOP),gt.join(" ")},tt.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},tt.getGroup=function(){return this.group},tt.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},tt.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},tt.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()},tt.getGroup=function(){return this.group},tt.getLeftMeasureIdx=function(){return this.getLeftAnchor().getMeasureIdx()},tt.getRightMeasureIdx=function(){return this.getRightAnchor().getMeasureIdx()},tt.getUpOverflow=function(){return-this.curve.getBBox().min.y},tt.getDownOverflow=function(){const At=this.drawingContext.getSpaceSize()*(this.getNbStaffLines()-1);return this.curve.getBBox().max.y-At},tt.getNbStaffLines=function(){return ie.A.getNbStaffLines(this.staffData)},tt.isAbove=function(){return this.curve.getPlacement()===L.A.ABOVE},tt.isBelow=function(){return this.curve.getPlacement()===L.A.BELOW};const fe=Ee},680285:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Tt});var A=r(269352),w=r(364842),f=r(435808),P=r(726042);const h=function(nt){const vt=[],Nt=[[],[]];let te,ee,Ot,ot,rt,at,_t,qt;for(let oe=0;oe<2;++oe){if(oe===0?(ee=6*nt[0].x-12*nt[1].x+6*nt[2].x,te=-3*nt[0].x+9*nt[1].x-9*nt[2].x+3*nt[3].x,Ot=3*nt[1].x-3*nt[0].x):(ee=6*nt[0].y-12*nt[1].y+6*nt[2].y,te=-3*nt[0].y+9*nt[1].y-9*nt[2].y+3*nt[3].y,Ot=3*nt[1].y-3*nt[0].y),Math.abs(te)<1e-12){if(Math.abs(ee)<1e-12)continue;ot=-Ot/ee,0<ot&&ot<1&&vt.push(ot);continue}_t=ee*ee-4*Ot*te,qt=Math.sqrt(_t),!(_t<0)&&(rt=(-ee+qt)/(2*te),0<rt&&rt<1&&vt.push(rt),at=(-ee-qt)/(2*te),0<at&&at<1&&vt.push(at))}let ue=vt.length,ne;const be=ue;for(;ue--;)ot=vt[ue],ne=1-ot,Nt[0][ue]=ne*ne*ne*nt[0].x+3*ne*ne*ot*nt[1].x+3*ne*ot*ot*nt[2].x+ot*ot*ot*nt[3].x,Nt[1][ue]=ne*ne*ne*nt[0].y+3*ne*ne*ot*nt[1].y+3*ne*ot*ot*nt[2].y+ot*ot*ot*nt[3].y;return Nt[0][be]=nt[0].x,Nt[1][be]=nt[0].y,Nt[0][be+1]=nt[3].x,Nt[1][be+1]=nt[3].y,Nt[0].length=Nt[1].length=be+2,{min:{x:Math.min.apply(0,Nt[0]),y:Math.min.apply(0,Nt[1])},max:{x:Math.max.apply(0,Nt[0]),y:Math.max.apply(0,Nt[1])}}};var d=r(276463);const l=function(nt,vt,Nt,te,ee){const Ot=m(nt,vt,Nt),ot=x(nt,te,ee);return{above:Ot,below:ot}},m=function(nt,vt,Nt){const te=nt.indexOf(Nt);S(te);const ee=nt.indexOf(vt);S(ee);const Ot=T(nt,te,ee+1);return Ot.reverse(),Ot},x=function(nt,vt,Nt){const te=nt.indexOf(vt);S(te);const ee=nt.indexOf(Nt);return S(ee),T(nt,te,ee+1)},S=function(nt){if(nt===-1){const vt="an extreme point is outside the hull.";throw new w.default("PointNotFound",vt)}},T=function(nt,vt,Nt){if(Nt>vt)return nt.slice(vt,Nt);{const te=nt.slice(vt),ee=nt.slice(0,Nt);return te.concat(ee)}},Y=l;var G=r(75861),q=r(538783),R=r(825711);const b=function(nt,vt){const Nt=(0,R.A)(nt),te=(0,R.A)(vt);return Nt>te?f.A.ABOVE:f.A.BELOW},B=function(nt,vt,Nt){if(q.A.isUp(vt))return f.A.ABOVE;if(q.A.isDown(vt))return f.A.BELOW;if(vt===q.A.AUTO){if(nt===G.A.DOWN)return f.A.ABOVE;if(nt===G.A.UP)return b(Nt.above,Nt.below);G.A.raiseError(nt)}else throw new w.default("Unexpected")};var C=r(148029),_=r(800097),st=r(458098);const F=P.default.degreesToGradians(30),L=Math.PI-F,I=Math.cos(L),W=function(nt,vt){const Nt=V(nt);return it(Nt)&&Pt(Nt,vt),Nt},V=function(nt){const vt=nt.length,Nt=nt[0],te=nt[1],ee=nt[vt-1],Ot=nt[vt-2],ot=(0,C.A)(Nt,te),rt=(0,C.A)(ee,Ot);return{left:ot,right:rt}},it=function(nt){return(0,_.A)(nt.left,nt.right)<I},Pt=function(nt,vt){const te=Yt(vt)*F/2,ee=-te;nt.left=(0,st.A)(nt.left,te),nt.right=(0,st.A)(nt.right,ee),nt.increased=!0},Yt=function(nt){if(nt===f.A.ABOVE)return-1;if(nt===f.A.BELOW)return 1;f.A.raiseError(nt)},Bt=W;var le=r(245814),ie=r(741696);const K=1/3,pe=24,tt=function(nt,vt,Nt){const te=nt.length,ee=nt[0],Ot=nt[te-1];let ot=Ot.x-ee.x;if(vt.increased){const qt=Nt.getSpaceSize();ot=Math.min(ot,pe*qt)}(0,le.A)(vt.left,ot*K),(0,le.A)(vt.right,-ot*K);const rt=(0,ie.A)(ee,vt.left),at=(0,ie.A)(Ot,vt.right);return{left:rt,right:at}},Vt=function(nt,vt,Nt,te,ee,Ot){return`M ${nt.x} ${nt.y-ee/2} C ${vt.x} ${vt.y-Ot/2} ${Nt.x} ${Nt.y-Ot/2} ${te.x} ${te.y-ee/2} L ${te.x} ${te.y+ee/2} C ${Nt.x} ${Nt.y+Ot/2} ${vt.x} ${vt.y+Ot/2} ${nt.x} ${nt.y+ee/2} Z`},ct=function(nt,vt,Nt,te,ee){const Ot={},ot=nt.length,rt=nt[0],at=nt[ot-1],_t=vt[0],qt=vt[ot-1],ue=nt.concat(vt);let ne=(0,d.A)(ue);const be=Y(ne,rt,at,_t,qt);Ot.placement=B(Nt,te,be),ne=fe(Ot.placement,be);const oe=gt(ne,Ot.placement);let us=Bt(ne,Ot.placement),Q=tt(ne,us,ee);for(;ne.length>2&&!Ht(Q,ne,oe,Ot.placement);)Wt(ne,Ot.placement,ee),us=Bt(ne,Ot.placement),Q=tt(ne,us,ee);Ot.controlPoint1=Q.left,Ot.controlPoint2=Q.right;const Xt=ee.getSlurEndpointThickness(),bt=ee.getSlurMidpointThickness(),ve=ne.length,Qt=ne[0],ae=ne[ve-1],fs=Vt(Qt,Q.left,Q.right,ae,Xt,bt);return Ot.leftPoint=Qt,Ot.rightPoint=ae,Ot.pathStr=fs,Ot},fe=function(nt,vt){if(nt===f.A.ABOVE)return vt.above;if(nt===f.A.BELOW)return vt.below;f.A.raiseError(nt)},gt=function(nt,vt){const Nt=nt.map(At);if(vt===f.A.ABOVE)return Nt.reduce(P.default.min2);if(vt===f.A.BELOW)return Nt.reduce(P.default.max2);throw new w.default("Unexpected")},At=function(nt){return nt.y},Ht=function(nt,vt,Nt,te){const ee=vt.length,Ot=vt[0],ot=vt[ee-1],rt=[Ot,nt.left,nt.right,ot],at=h(rt);if(te===f.A.ABOVE)return at.min.y<Nt;if(te===f.A.BELOW)return at.max.y>Nt;throw new w.default("Unexpected")},Wt=function(nt,vt,Nt){const te=k(vt),ee=Nt.getSpaceSize()*2*te;nt.forEach(St,ee)},k=function(nt){if(nt===f.A.ABOVE)return-1;if(nt===f.A.BELOW)return 1;throw new w.default("Unexpected")},St=function(nt,vt,Nt){const te=Nt.length;if(vt>0&&vt<te-1){const ee=this.valueOf();nt.y+=ee}},yt=ct,Ct=function(){this.init()};Ct.cssClass="slurCurve";const Mt=Ct.prototype;Mt.cssClass=Ct.cssClass,Mt.init=function(){this.abovePoints=null,this.belowPoints=null,this.firstStem=null,this.stemStrategy=null,this.drawingContext=null,this.bBox=null,this.bezierData=null,this.drawn=!1,this.path=null,this.parent=null},Mt.setData=function(nt,vt,Nt,te){this.abovePoints=nt,this.belowPoints=vt,this.firstStem=Nt,this.stemStrategy=te,this.bezierData=null,this.bBox=null},Mt.setParent=function(nt){this.parent!==nt&&(this.drawn=!1),this.parent=nt,this.isRendered()&&this.bindToParent()},Mt.setDrawingContext=function(nt){this.drawingContext=nt},Mt.draw=function(){if(this.renderIfNeeded(),this.hasData()){const nt=this.getPathStr();this.path.attr("d",nt)}this.bindToParent()},Mt.renderIfNeeded=function(){this.isRendered()||this.render()},Mt.isRendered=function(){return this.path!==null},Mt.render=function(){if(this.path=new A.A("path"),this.path.attr("class",this.cssClass),this.hasData()){const nt=this.getPathStr();this.path.attr("d",nt)}},Mt.bindToParent=function(){this.drawn||(this.parent.append(this.path),this.drawn=!0)},Mt.unbindFromParent=function(){this.drawn&&(this.path.removeFromParent(),this.drawn=!1)},Mt.updateHorizontalDisplay=function(){if(this.isRendered()&&this.hasData()){const nt=this.getPathStr();this.path.attr("d",nt)}},Mt.hasData=function(){return this.abovePoints!==null&&this.belowPoints!==null&&this.firstStem!==null&&this.stemStrategy!==null},Mt.getPlacement=function(){return this.getBezierData().placement},Mt.getBottomPointY=function(){const nt=this.getBezierData(),vt=nt.leftPoint.y,Nt=nt.rightPoint.y;return Math.max(vt,Nt)},Mt.getTopPointY=function(){const nt=this.getBezierData(),vt=nt.leftPoint.y,Nt=nt.rightPoint.y;return Math.min(vt,Nt)},Mt.getBBox=function(){return this.bBox===null&&this.calcBBox(),this.bBox},Mt.calcBBox=function(){const nt=this.getBezierData(),vt=[nt.leftPoint,nt.controlPoint1,nt.controlPoint2,nt.rightPoint];this.bBox=h(vt)},Mt.getPathStr=function(){return this.getBezierData().pathStr},Mt.getBezierData=function(){return this.bezierData===null&&this.calcBezierData(),this.bezierData},Mt.calcBezierData=function(){this.bezierData=yt(this.abovePoints,this.belowPoints,this.firstStem,this.stemStrategy,this.drawingContext)},Mt.getGroup=function(){return this.path};const Tt=Ct},701933:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});const w={FIRST_OF_SLICE:"first-of-slice",FIRST_OF_SHARD:"first-of-shard",OTHER:"other"}},705740:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(269352),w=r(863426);const f=.1,P=function(){this.init()};P.NAME="bracket";const a=P.prototype;a.name=P.NAME,a.bracketTopGlyphId="bracketTop",a.bracketBottomGlyphId="bracketBottom",a.init=function(){this.drawingContext=null,this.inputHeight=null,this.parent=null,this.group=null,this.line=null,this.topGlyph=null,this.bottomGlyph=null,this.topBracket=null,this.bottomBracket=null,this.posX=null,this.topColor=null,this.bottomColor=null},a.setDrawingContext=function(d){this.drawingContext=d},a.setParent=function(d){this.parent=d},a.setInputHeight=function(d){this.inputHeight=d+this.drawingContext.getSpaceSize()*2},a.setPosition=function(d){this.posX=d},a.getInputHeight=function(){return this.inputHeight},a.getWidth=function(){return 0},a.getBracketTopGlyph=function(){return this.topGlyph===null&&(this.topGlyph=this.drawingContext.getGlyph(this.bracketTopGlyphId)),this.topGlyph},a.getBracketBottomGlyph=function(){return this.bottomGlyph===null&&(this.bottomGlyph=this.drawingContext.getGlyph(this.bracketBottomGlyphId)),this.bottomGlyph},a.setTopColor=function(d){this.topColor=d},a.setBottomColor=function(d){this.bottomColor=d},a.draw=function(){this.renderIfNeeded(),this.drawGlyphs(),this.drawLine(),this.update(),this.bindToParent()},a.drawGlyphs=function(){this.drawBracketTop(),this.drawBracketBottom()},a.drawBracketTop=function(){const d=this.getBracketTopGlyph();this.topBracket===null&&(this.topBracket=this.group.append("path"),this.topBracket.attr("d",d.render()),this.topBracket.attr("class",this.bracketTopGlyphId)),this.topColor?this.topBracket.style("fill",this.topColor):this.topBracket.unsetStyle("fill"),this.moveTopBracket()},a.drawBracketBottom=function(){const d=this.getBracketBottomGlyph();this.bottomBracket===null&&(this.bottomBracket=this.group.append("path"),this.bottomBracket.attr("d",d.render()),this.bottomBracket.attr("class",this.bracketBottomGlyphId)),this.bottomColor?this.bottomBracket.style("fill",this.bottomColor):this.bottomBracket.unsetStyle("fill"),this.moveBottomBracket()},a.moveTopBracket=function(){const d=this.drawingContext.getSpaceSize(),l=f*d;this.topBracket.attr("transform",`translate(0 ${l})`)},a.moveBottomBracket=function(){const d=this.getInputHeight(),l=this.drawingContext.getSpaceSize(),m=f*l;this.bottomBracket.attr("transform",`translate(0 ${d-m})`)},a.drawLine=function(){this.line.draw()},a.update=function(){this.canMove()&&this.isRendered()&&(this.move(),this.moveTopBracket(),this.moveBottomBracket(),this.updateLine())},a.move=function(){const d=this.posX,l=this.getInputHeight()/2;this.group.attr("transform",`translate(${d} ${-l})`)},a.renderIfNeeded=function(){this.isRendered()||this.render()},a.render=function(){this.group=new A.A("g"),this.group.attr("class",this.name),this.renderLine()},a.renderLine=function(){const d=this.drawingContext.getBracketStrokeWidth(),l={stroke_width:d},m=d/2;let x=this.getInputHeight();x===null&&(x=0),this.line=new w.A(this.group,l),this.line.render(m,0,m,x)},a.updateLine=function(){const d=this.getInputHeight();this.line.setY2(d)},a.isRendered=function(){return this.group!==null},a.bindToParent=function(){this.parent.append(this.group)},a.canMove=function(){return this.posX!==null},a.getSpaceAboveStaff=function(){const d=this.drawingContext.getSpaceSize(),m=this.getBracketTopGlyph().getHeight();return d+m},a.getSpaceBelowStaff=function(){const d=this.drawingContext.getSpaceSize(),m=this.getBracketBottomGlyph().getHeight();return d+m};const h=P},706627:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>a});var A=r(100673),w=r(51342);const f=function(h,d){this.init(h,d)};f.NAME="chord.superScript";const P=f.prototype;P.name=f.NAME,P.init=function(h,d){this.str=h,typeof d=="string"&&(this.name=d),this.text=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},P.createText=function(){const h={text:this.str};this.text=new A.A(h)},P.setParent=function(h){this.parent=h,this.text.setParent(h)},P.setPosX=function(h){this.posX=h},P.setPosY=function(h){this.posY=h},P.setDrawingContext=function(h){this.drawingContext=h,this.text.setDrawingContext(h);const d=this.getFontSize();this.text.setFontSize(d);const l=h.getHarmonyFontFamily(),m=h.getHarmonyFontStyle(),x=h.getHarmonyFontWeight();this.text.options["font-family"]=l,this.text.options["font-style"]=m,this.text.options["font-weight"]=x},P.draw=function(){this.rendered||this.render(),this.move()},P.render=function(){this.text.render(),this.text.setCssClass(this.name),this.text.draw(),this.rendered=!0},P.move=function(){if(this.rendered&&this.posX!==null&&this.posY!==null){const h=this.getYShift(),d=this.posY-h;this.text.setPosition(this.posX,d),this.text.move()}},P.getWidth=function(){return this.text.getWidth()},P.getHeight=function(){const h=this.getSpaceAbove(),d=this.getSpaceBelow();return h+d},P.getSpaceAbove=function(){const h=this.getYShift(),d=this.getFontSize();return h+d},P.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*w.A.SUPSCRIPT_BASELINE},P.getFontSize=function(){return this.drawingContext.getHarmonyFontSize()*w.A.SMALL_FONT_SIZE},P.getSpaceBelow=function(){return this.drawingContext.getHarmonyFontSize()/2};const a=f},711527:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(269352),w=r(100673),f=r(410199);const P=function(d){this.init(d)};P.cssClass="hyphen";const a=P.prototype;a.cssClass=P.cssClass,a.init=function(d){this.position=d,this.parentGroup=null,this.text=null,this.group=null,this.drawn=!1,this.drawingContext=null,this.width=null,this.posX=null,this.posY=null},a.setDrawingContext=function(d){this.drawingContext=d},a.setParent=function(d){this.parentGroup=d},a.setPosition=function(d){this.position=d},a.render=function(){this.group=new A.A("g"),this.group.attr("class",this.cssClass);const d={};d["font-size"]=this.drawingContext.getLyricsFontSize(),d["font-family"]=this.drawingContext.getLyricFontFamily(),d["font-weight"]=this.drawingContext.getLyricFontWeight(),d["font-style"]=this.drawingContext.getLyricFontStyle();const l="-";d.text=l,this.text=new w.A(d),this.text.setParent(this.group),this.text.setDrawingContext(this.drawingContext),this.text.render(),this.width!==null&&this.updateTextPos()},a.setWidth=function(d){this.width=d,this.isRendered()&&this.updateTextPos()},a.updateTextPos=function(){const d=this.getTextXPos();this.text.setXPos(d),this.text.move()},a.getTextXPos=function(){const d=this.text.getWidth(),l=this.getWidth();if(this.position===f.A.LEFT)return d;if(this.position===f.A.MIDDLE)return l/2-d/2;if(this.position===f.A.RIGHT)return l-d*2;f.A.raiseError(this.position)},a.getWidth=function(){return this.width},a.draw=function(){this.isRendered()||this.render(),this.text.draw(),this.move(),this.bindToParent()},a.isRendered=function(){return this.group!==null},a.bindToParent=function(){this.drawn||(this.parentGroup.append(this.group),this.drawn=!0)},a.erase=function(){this.unbindFromParent()},a.unbindFromParent=function(){this.drawn&&(this.group.removeFromParent(),this.drawn=!1)},a.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate(${this.posX} ${this.posY})`)},a.setPosX=function(d){this.posX=d},a.setPosY=function(d){this.posY=d};const h=P},725885:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>I});var A=r(364842),w=r(920939),f=r(726042),P=r(100673);class a{constructor(V){this.textStr=V,this.drawingContext=null,this.text=null,this.isSmall=!1}setIsSmall(V){this.isSmall=V}setDrawingContext(V){this.drawingContext=V}setParent(V){this.getText().setParent(V)}getText(){this.text===null&&(this.text=new P.A({text:this.textStr})),this.text.setDrawingContext(this.drawingContext);const V=this.drawingContext.getTabSpaceSize()*this.getSizeRatio();this.text.setFontSize(V);const it=this.getFontFamily();this.text.options["font-family"]=it;const Pt=this.getHeight();return this.text.setYPos(Pt/2),this.text}getFontFamily(){return this.drawingContext.hasFretNumberFont()?this.drawingContext.getFretFontFamily():this.drawingContext.getHarmonyFontFamily()}getHeight(){const V=this.getSizeRatio();return this.drawingContext.getTabSpaceSize()*2/3*V}getSizeRatio(){return this.isSmall?this.drawingContext.getGraceSizeCoeff():1}getWidth(){return this.getText().getWidth()}setPosX(V){this.getText().setXPos(V)}draw(){const V=this.getText();V.render(),V.draw()}render(){this.getText().render()}style(V,it){this.getText().text.style(V,it)}}var h=r(269352);class d{constructor({glyphId:V,isVerticallyCentered:it,isGrace:Pt}){this.glyphId=V,this.isGrace=!!Pt,this.isVerticallyCentered=!!it,this.drawingContext=null,this.path=null,this.posX=0,this.glyph=null,this.parent=null}setDrawingContext(V){this.drawingContext=V}getGlyph(){if(this.glyph===null)if(this.isGrace){const V=this.drawingContext.getGraceSizeCoeff();return this.drawingContext.getScaledGlyph(this.glyphId,V)}else this.glyph=this.drawingContext.getGlyph(this.glyphId);return this.glyph}getHeight(){return this.getGlyph().getHeight()}getWidth(){return this.getGlyph().getWidth()}setPosX(V){this.posX=V}setParent(V){this.parent=V}draw(){this.render(),this.move(),this.bindToParent()}render(){if(this.path===null){this.path=new h.A("path");const it=this.getGlyph().render();this.path.attr("d",it)}}move(){let V=0;this.isVerticallyCentered||(V=this.getHeight()/2),this.path.attr("transform",`translate(${this.posX} ${V})`)}bindToParent(){this.parent.append(this.path)}style(V,it){this.path.style(V,it)}}class l{constructor(){this.drawingContext=null}setDrawingContext(V){this.drawingContext=V}getGlyph(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph}getHeight(){return 0}getWidth(){return this.drawingContext.getTabSpaceSize()/3}setPosX(){}setParent(){}draw(){}style(){}}class m{merge(V){this.cache=[],this.result=[],V.forEach(this.processEntity,this),this.flushCache();const it=this.result;return this.result=null,it}processEntity(V){if(V instanceof d||V instanceof l)this.flushCache(),this.result.push(V);else if(V instanceof a)this.canAddInCache(V)||this.flushCache(),this.cache.push(V);else throw new A.default("An invalid fret entity is provided")}canAddInCache(V){if(this.cache.length===0)return!0;const[it]=this.cache;return V.isSmall===it.isSmall}flushCache(){if(this.cache.length!==0)if(this.cache.length===1)this.result.push(this.cache.pop());else{const V=this.cache[0].isSmall,it=this.cache.map(Yt=>Yt.textStr).join(""),Pt=new a(it);Pt.setIsSmall(V),this.result.push(Pt),this.cache=[]}}}const x=new m;function S(W){return x.merge(W)}const T="rgb(200,200,200)",Y="noteheadParenthesisLeft",G="noteheadParenthesisRight",q={4:"restWhole",2:"restHalf",1:"restQuarter",.5:"rest8th",.25:"rest16th",.125:"rest32nd",.0625:"rest64th"},R=["luteItalianFret0","luteItalianFret1","luteItalianFret2","luteItalianFret3","luteItalianFret4","luteItalianFret5","luteItalianFret6","luteItalianFret7","luteItalianFret8","luteItalianFret9"],p=function(W){this.displayData=W,this.frets=this.displayData.getFrets(),this.group=null,this.heads=null,this.widths=null,this.maxWidth=null};p.cssClass="head head-TAB",p.restSuffix=" rest-TAB";const b=p.prototype;b.cssClass=p.cssClass,b.canDraw=function(){return this.displayData.isTabStaff()},b.draw=function(W,V){this.renderedNote=W,this.svg=W.getGroup(),this.ctx=V,this.needRender()&&this.render(),this.initHeads(),this.computeWidths(),this.heads.forEach(this.setHeadPosX,this),this.drawFrets(),this.fillRenderedNoteData(W),W.setLeftStemX(0)},b.needRender=function(){return this.group===null},b.render=function(){this.group=this.svg.append("g")},b.drawFrets=function(){this.heads.forEach(this.drawFret,this),this.heads.length===0&&this.drawRestHead()},b.drawFret=function(W){this.head=W,this.renderHeadGroup(),!(this.head.isHidden&&this.ctx.hideTiedFrets())&&(this.renderHeadRect(),W.entities.forEach(this.drawEntity,this))},b.drawEntity=function(W,V){let it=this.getTotalWidthToIdx(V);W.glyphId===G&&(it+=W.glyph.getBBoxNE().x),W.setPosX(it),W.draw(),this.head.isGreyed&&W.style("fill",T)},b.renderHeadRect=function(){const W=this.getTotalWidth(),V=this.getHighestHeight(),it=this.head.group.append("rect");it.style("fill","rgb(255,255,255)"),it.style("stroke","rgb(255,255,255)"),it.attr("width",`${W}px`),it.attr("height",`${V}px`),it.attr("transform",`translate(0 ${-V/2})`)},b.drawRestHead=function(){const W=this.svg.append("g");if(W.attr("class",this.cssClass+p.restSuffix),!this.ctx.showTabRests()&&!this.ctx.hideNonTab()||![3,4].includes(this.displayData.opts.lines[0]))return;const V=this.displayData.getBaseQuarterDuration(),it=B(V),Pt=this.ctx.getGlyph(it);W.append("path").attr("d",Pt.render());const Bt=this.displayData.getNbStaffLines(),le=v(V,Bt),ie=this.getSpaceSize(),K=w.A.lineToY(le,ie,Bt);W.attr("transform",`translate(0 ${K})`)};function v(W,V){if(W===4||W===2){const Pt=Math.ceil(V/2);return W===4?Pt+1:Pt}return Math.floor(V/2)+1}function B(W){const V=q[W];if(typeof V=="undefined"){const it=`There is no rest glyph for the quarter duration [${W}].`;throw new A.default("NoRestGlyph",it)}return V}b.renderHeadGroup=function(){const W=this.getYPos();this.head.group=this.svg.append("g"),this.head.group.attr("class",this.cssClass),this.head.group.attr("transform",`translate(${this.head.posX} ${W})`),this.renderedNote.setFret(this.getStringLine(),this.head.group),this.head.entities.forEach(C,this.head.group)};function C(W){const V=this;W.setParent(V)}b.getTotalWidth=function(){if(typeof this.head!="undefined"){const W=this.head.entities;return this.getTotalWidthToIdx(W.length)}else return this.getRestWidth()},b.getRestWidth=function(){const W=R[0],V=new d({glyphId:W});return V.setDrawingContext(this.ctx),V.getWidth()},b.getTotalWidthToIdx=function(W){if(typeof this.head!="undefined"){const it=this.head.entities.slice(0,W);return it.length!==0?it.map(this.getWidth,this).reduce(L):0}return 0},b.getHighestHeight=function(){return typeof this.head!="undefined"?this.head.entities.map(F).reduce(f.default.max2,0):0},b.getYPos=function(){const W=this.getStringLine(),V=this.getSpaceSize();return w.A.stringToY(W,V,this.displayData.getNbStaffLines())},b.getStringLine=function(){return this.head.string},b.getSpaceSize=function(){return this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize()},b.initHeads=function(){this.heads=this.frets.filter(_).map(this.initHead,this)};function _(W){return W!==null}b.initHead=function(W){let V=[];if(W.isDeadNote){const Pt=new a("X");V.push(Pt)}else{const Pt=this.displayData.isGrace(),Yt=this.ctx.hasFretNumberFont(),Bt=st(W.fretNumber,Pt,Yt);if(Array.prototype.push.apply(V,Bt),typeof W.artificialHarmonicTouchingFretNumber!="undefined"){const le=this.getFretSpace();V.push(le);const ie=this.getLeftParenthesis();V.push(ie);const K=st(W.artificialHarmonicTouchingFretNumber,!1,Yt);Array.prototype.push.apply(V,K);const pe=this.getRightParenthesis();V.push(pe)}}if(W.isNaturalHarmonic){const Pt=new a("<");V.unshift(Pt);const Yt=new a(">");V.push(Yt)}if(W.hasParenthesis){const Pt=this.getLeftParenthesis();V.unshift(Pt);const Yt=this.getRightParenthesis();V.push(Yt)}return V=S(V),V.forEach(this.transferDrawingContext,this),{entities:V,string:W.string,isHidden:W.isHidden,posX:null,isGreyed:W.isGreyed}},b.getFretSpace=function(){return this.ctx.hasFretNumberFont()?new a(" "):new l},b.getLeftParenthesis=function(){return this.ctx.hasFretNumberFont()?new a("("):new d({glyphId:Y,isVerticallyCentered:!0})},b.getRightParenthesis=function(){return this.ctx.hasFretNumberFont()?new a(")"):new d({glyphId:G,isVerticallyCentered:!0})},b.transferDrawingContext=function(W){W.setDrawingContext(this.ctx)};function st(W,V,it){if(W=W.toString(),it){const Yt=new a(W);return Yt.setIsSmall(V),[Yt]}const Pt=[];for(let Yt=0;Yt<W.length;Yt++){const Bt=W[Yt],le=parseInt(Bt,10),ie=R[le],K=new d({glyphId:ie,isGrace:V});Pt.push(K)}return Pt}b.computeWidths=function(){this.heads.length===0?(this.maxWidth=this.getRestWidth(),this.widths=[this.maxWidth]):(this.widths=this.heads.map(this.computeHeadWidth,this),this.maxWidth=Math.max(...this.widths))},b.computeHeadWidth=function(W){return this.head=W,this.getTotalWidth()},b.setHeadPosX=function(W,V){const it=this.widths[V];W.posX=(this.maxWidth-it)/2},b.getWidth=function(W){const V=.1*this.ctx.getSpaceSize();return W.getWidth()+V};function F(W){return W.getHeight()}b.fillRenderedNoteData=function(W){W.setLeftHeadWidth(0),W.setRightHeadWidth(0),W.setFretsWidth(this.maxWidth),W.setMiddleHeadWidth(this.maxWidth)};const L=function(W,V){return W+V},I=p},732799:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});var A=r(390253);const f=function(P){const a=A.A.MM_PER_INCH/(A.A.TENTH_PER_EM*A.A.POINTS_BY_INCH);return P.scaleToMillimeters(1)/a}},732868:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>L});var A=r(364842),w=r(996636),f=r(640231),P=r(96410),a=r(614653),h=r(200675),d=r(197799),l=r(48264),m=r(956149),x=r(113599),S=r(836252),T=r(409241),Y=r(100673),G=r(51342);const q=function(I,W,V){this.init(I,W,V)};q.NAME="chord.inversion";const R=q.prototype;R.name=q.NAME,R.init=function(I,W,V){this.topStr=I,this.bottomStr=W,typeof V=="string"&&(this.name=V),this.topText=null,this.bottomText=null,this.parent=null,this.drawingContext=null,this.rendered=!1,this.posX=null,this.posY=null,this.createText()},R.createText=function(){const I={text:this.topStr};if(this.topText=new Y.A(I),this.bottomStr!==null){const W={text:this.bottomStr};this.bottomText=new Y.A(W)}},R.setParent=function(I){this.parent=I,this.topText.setParent(I),this.bottomText!==null&&this.bottomText.setParent(I)},R.setPosX=function(I){this.posX=I},R.setPosY=function(I){this.posY=I},R.setDrawingContext=function(I){this.drawingContext=I;const W=this.getFontSize(),V=I.getHarmonyFontFamily(),it=I.getHarmonyFontStyle(),Pt=I.getHarmonyFontWeight();this.topText.options["font-family"]=V,this.topText.options["font-style"]=it,this.topText.options["font-weight"]=Pt,this.topText.setDrawingContext(I),this.topText.setFontSize(W),this.bottomText!==null&&(this.bottomText.options["font-family"]=V,this.bottomText.setDrawingContext(I),this.bottomText.setFontSize(W))},R.draw=function(){this.rendered||this.render(),this.move()},R.render=function(){this.topText.render(),this.topText.setCssClass(this.name),this.topText.draw(),this.bottomText!==null&&(this.bottomText.render(),this.bottomText.setCssClass(this.name),this.bottomText.draw()),this.rendered=!0},R.move=function(){if(this.rendered&&this.posX!==null&&this.posY!==null){const I=this.getTopYShift(),W=this.posY-I;if(this.topText.setPosition(this.posX,W),this.topText.move(),this.bottomText!==null){const V=this.getBottomYShift(),it=this.posY+V;this.bottomText.setPosition(this.posX,it),this.bottomText.move()}}},R.getWidth=function(){let I=0;return I=Math.max(I,this.topText.getWidth()),this.bottomText!==null&&(I=Math.max(I,this.bottomText.getWidth())),I},R.getHeight=function(){const I=this.getSpaceAbove(),W=this.getSpaceBelow();return I+W},R.getSpaceAbove=function(){const I=this.getTopYShift(),W=this.getFontSize();return I+W},R.getTopYShift=function(){return this.drawingContext.getHarmonyFontSize()*G.A.SUPSCRIPT_BASELINE},R.getBottomYShift=function(){return this.getFontSize()/3},R.getSpaceBelow=function(){let I=this.drawingContext.getHarmonyFontSize()/2;return this.bottomText!==null&&(I+=this.getBottomYShift()),I},R.getFontSize=function(){return this.drawingContext.getHarmonyFontSize()*G.A.SMALL_FONT_SIZE};const p=q;var b=r(843678);const v=function(){this.init()},B=b.default.fromPairs([{key:f.A.ITALIAN,value:"It"},{key:f.A.FRENCH,value:"Fr"},{key:f.A.GERMAN,value:"Ger"}]),C=v.prototype;C.init=function(){},C.build=function(I){this.reset();const W=a.default.getTimePos(I),V=a.default.getHarmonyUuid(I);this.createChord(W,V);let it=a.default.getFunction(I);const Pt=a.default.getKindValue(I),Yt=a.default.getAlter(I);this.createAlter(Yt),it=_(it,Pt),this.createFunction(it),this.createKind(Pt);const Bt=a.default.getInversion(I);if(this.createInversion(Bt,Pt),a.default.hasSecondaryFunction(I)){this.createSlash();const le=a.default.getSecondaryAlter(I);this.createAlter(le);let ie=a.default.getSecondaryFunction(I);const K=a.default.getSecondaryKind(I);ie=_(ie,K),this.createFunction(ie),this.createKind(K);const pe=a.default.getSecondaryInversion(I);this.createInversion(pe,K)}return this.chord};function _(I,W){if(W===f.A.NEAPOLITAN)return"N";const V=B[W];return typeof V=="string"?V:I}C.reset=function(){this.functionDrawer=null,this.kindDrawers=[],this.inversionDrawer=null,this.chord=null},C.createAlter=function(I){if(I!==0){const W=new d.A(I);this.chord.addSymbol(W)}},C.createFunction=function(I){const W=new h.A(I);this.chord.addSymbol(W)},C.createKind=function(I){st(I)(this.chord)};const st=function(I){if(typeof F[I]!="undefined")return F[I];{const W=`There is no builder for the kind [${I}].`;throw new A.default("BadKind",W)}},F={};F[f.A.MAJOR]=function(){},F[f.A.MINOR]=function(){},F[f.A.NEAPOLITAN]=function(){},F[f.A.ITALIAN]=function(){},F[f.A.FRENCH]=function(){},F[f.A.GERMAN]=function(){},F[f.A.AUGMENTED]=function(I){const W=new m.A;I.addSymbol(W)},F[f.A.DIMINISHED]=function(I){const W=new x.A;I.addSymbol(W)},F[f.A.DOMINANT]=function(){},F[f.A.MAJOR_7]=function(I){const W=new l.A(w.A.LOWER_CASE_LONG);I.addSymbol(W)},F[f.A.MINOR_7]=function(){},F[f.A.DIMINISHED_7]=function(I){const W=new x.A;I.addSymbol(W)},F[f.A.HALF_DIMINISHED]=function(I){const W=new S.A;I.addSymbol(W)},F[f.A.AUGMENTED_7]=function(I){const W=new m.A;I.addSymbol(W)},F[f.A.MAJOR_MINOR]=function(I){const W=new l.A(w.A.LOWER_CASE_LONG);I.addSymbol(W)},C.createInversion=function(I,W){if(f.A.isAugmentedSixth(W)){const Pt="+6",Yt=new p(Pt,null);this.chord.addSymbol(Yt);return}const V=f.A.getNbNotes(W),it=P.A.getTopDigit(I,V);if(it!==null){const Pt=P.A.getBottomDigit(I,V),Yt=new p(it,Pt);this.chord.addSymbol(Yt)}},C.createChord=function(I,W){const V=new T.A(T.A.CLASSIC_CSS_CLASS);V.setTimePos(I),V.setHarmonyUuid(W),this.chord=V},C.createSlash=function(){const I=new h.A("/");this.chord.addSymbol(I)};const L=v},741696:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});var A=r(34262);function w(f,P){const a=f.x+P.x,h=f.y+P.y;return(0,A.A)(a,h)}},744771:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>m});var A=r(269352),w=r(723631),f=r(956112);const P="adagio-mute-uuid",a="brassMuteClosed",h="brassMuteOpen",d="mute";function l(x){if(x===f.A.ON)return a;if(x===f.A.OFF)return h;f.A.raiseError(x)}class m{constructor({placement:S,type:T,timePos:Y,uuid:G}){this.type=T,this.placement=S,this.timePos=Y,this.uuid=G||null,this.cssClass=d,this.drawingContext=null,this.parent=null,this.x=null,this.y=null,this.glyph=null,this.path=null}setParent(S){this.parent=S}setDrawingContext(S){this.drawingContext=S}setPosX(S){this.xPos=S}setPosY(S){this.yPos=S}setCssClass(S){this.cssClass=S}draw(){this.path===null&&this.render(),this.bindToParent(),this.move()}render(){const S=this.getGlyph();this.path=new A.A("path"),this.path.attr("class",this.cssClass);const T=S.render();this.path.attr("d",T),this.uuid!==null&&this.path.setDataEntry(P,this.uuid)}move(){this.path!==null&&this.path.attr("transform",`translate(${this.xPos}, ${this.yPos})`)}bindToParent(){this.parent.append(this.path)}unbindFromParent(){this.path.removeFromParent()}getWidth(){return this.getGlyph().getWidth()}getHeight(){return this.getGlyph().getHeight()}getSpaceAbove(){return this.getHeight()+this.getMargin()}getSpaceBelow(){return this.getMargin()}getMargin(){return this.drawingContext.getMarginSize()}getGlyph(){if(this.glyph===null){const S=l(this.type);this.glyph=this.drawingContext.getGlyph(S)}return this.glyph}isAbove(){return this.placement===w.A.ABOVE}isBelow(){return this.placement===w.A.BELOW}getDrawingContext(){return this.drawingContext}getTimePos(){return this.timePos}getPath(){return this.path}}},746845:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});var A=r(843678);const w=function(){this.init()},f=w.prototype;f.init=function(){this.leftNote=null,this.rightNote=null,this.slidePairs=null},f.setLeftNote=function(m){this.leftNote=m,this.slidePairs=null},f.setRightNote=function(m){this.rightNote=m,this.slidePairs=null},f.hasLeftNote=function(){return this.leftNote!==null},f.hasRightNote=function(){return this.rightNote!==null},f.getTabSlidePairs=function(){let m=this.getSlidePairs();return m=m.filter(P),m};function P(m){return m.leftString===m.rightString&&m.leftFret!==m.rightFret}f.getSlidePairs=function(){if(this.slidePairs===null){const m=this.getSlideStarts(),x=this.getSlideStops(),S={};m.forEach(a,S),x.forEach(h,S);let T=A.default.getValues(S);T=T.filter(d),this.slidePairs=T}return this.slidePairs};function a(m){const x=this;typeof x[m.number]=="undefined"&&(x[m.number]={$number:m.number});const S=x[m.number];S.leftLine=m.line,S.leftString=m.string,S.leftFret=m.fret}function h(m){const x=this;typeof x[m.number]=="undefined"&&(x[m.number]={$number:m.number});const S=x[m.number];S.rightLine=m.line,S.rightString=m.string,S.rightString=m.string,S.rightFret=m.fret}function d(m){return typeof m.leftLine!="undefined"&&m.rightLine!=="undefined"}f.getSlideStarts=function(){return this.hasLeftNote()?this.leftNote.getSlideStarts():[]},f.getSlideStops=function(){return this.hasRightNote()?this.rightNote.getSlideStops():[]},f.getNbStaffLines=function(){return this.leftNote.getNbStaffLines()},f.isTabStaff=function(){return this.leftNote.isTabStaff()};const l=w},752670:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});var A=r(331537),w=r(364842);class f{constructor({renderedNote:a=null,pos:h,level:d,isFirstNote:l,isLastNote:m,isContinued:x}){this.melisma=null,this.renderedNote=a,this.position=h,this.level=d,this.isFirstNote=l,this.isLastNote=m,this.continued=x,this.measure=null,this.height=null}setNeedDrawUpdate(){this.hasMelisma()&&this.melisma.setNeedDrawUpdate()}hasMelisma(){return this.melisma!==null}setMelisma(a){this.hasMelisma()?this.melisma!==a&&(this.detachFromMelisma(),this.melisma=a):this.melisma=a}detachFromMelisma(){if(this.isContinued())this.melisma.removeContinuedAnchor(this);else if(this.isLeft())this.melisma.removeLeftAnchor();else if(this.isRight())this.melisma.removeRightAnchor();else throw new w.default("Unexpected");this.melisma=null}getMelisma(){return this.melisma}isContinued(){return this.continued}setDrawingContext(a){this.drawingContext=a}setMeasure(a){this.measure=a,this.drawingContext=this.measure.drawingContext}isLeft(){return A.A.isLeft(this.position)}isAtTheBeginingOfMeasure(){return this.isFirstNote}isAtTheEndOfMeasure(){return this.isLastNote}isRight(){return A.A.isRight(this.position)}getRenderedNote(){return this.renderedNote}getMeasure(){if(this.measure===null)throw new w.default("No measure available");return this.measure}getLyricPosY(){const a=this.drawingContext.getLyricsFontSize();let h=this.measure.getLyricsUpY();return h+=this.level*a,h+=this.getXHeight(),h}getXHeight(){const a=this.drawingContext.getLyricFontFamily(),h=this.drawingContext.getLyricsFontSize(),d=[a];return this.drawingContext.getTextXHeight(d,h)}getHeight(){if(this.height===null){const a=this.getXHeight()*2,h=this.drawingContext.getLyricsFontSize();this.height=a+h*this.level}return this.height}hasRenderedNote(){return this.renderedNote!==null}getLyricLevelHorizontalData(){const a=this.renderedNote;let h=0,d=0;if(this.position===A.A.LEFT){const l=a.getMiddleHeadWidth();if(a.hasLyricLevel(this.level)){const m=a.getLyricLevelWidth(this.level);h=l/2+m/2}else h=l}else if(this.position===A.A.RIGHT){const l=a.getMiddleHeadWidth(),m=this.drawingContext.getMarginSize();h=l+m}else this.position===A.A.RIGHT_PENDING||this.position===A.A.LEFT_PENDING&&(d=this.drawingContext.getMarginSize());return{spaceAfter:h,spaceBefore:d}}getX(){if(this.position===A.A.LEFT)return this.getNoteLeftX();if(this.position===A.A.RIGHT)return this.getNoteRightX();if(this.position===A.A.RIGHT_PENDING)return this.getContinuedRightX();if(this.position===A.A.LEFT_PENDING)return this.getContinuedLeftX()}getNoteLeftX(){const a=this.renderedNote,h=this.measure,d=h.tickableContent;let l=h.getXPos()+d.getXPos()+a.getXPos();const m=a.getMiddleHeadWidth();if(a.hasLyricLevel(this.level)){const x=a.getLyricLevelWidth(this.level);l+=m/2+x/2}else l+=m;return l}getNoteRightX(){const a=this.measure,h=a.tickableContent,d=this.renderedNote,l=d.getMiddleHeadWidth(),m=this.drawingContext.getMarginSize();return a.getXPos()+h.getXPos()+d.getXPos()+l+m}getContinuedRightX(){const a=this.measure,h=a.tickableContent;return a.getXPos()+h.getXPos()+h.getWidth()}getContinuedLeftX(){const a=this.measure,h=a.tickableContent;let d=a.getXPos()+h.getXPos();if(this.renderedNote!==null){const l=this.renderedNote;d+=l.getXPos();const m=this.drawingContext.getMarginSize();d-=m}else d-=h.getPreviousSpace();return d}getLevel(){return this.level}}},760210:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>R});var A=r(364842),w=r(269352),f=r(726042),P=r(593566);const a=1,h=3,d=function(){this.init()};d.NAME="scoreShard";const l=d.prototype;l.name=d.NAME,l.init=function(){this.drawingContext=null,this.posY=null,this.posX=0,this.contentX=null,this.height=null,this.headerWidth=null,this.pageContent=null,this.systemBreakPolicy=null,this.measuresSlice=null,this.systems=[],this.verticalLine=null,this.parent=null,this.currentParent=null,this.insertionPoint=null,this.contentGroup=null,this.group=null,this.headersGroup=null,this.needUpdateFormatting=!0,this.idx=null,this.isFirst=null,this.metrics=null,this.breakBefore=!1,this.breakAfter=!1},l.setDrawingContext=function(p){this.drawingContext=p,this.systems.forEach(this.dispatchDrawingContext,this)},l.setSystemBreakPolicy=function(p){this.systemBreakPolicy=p},l.setHeadersGroup=function(p){this.headersGroup=p},l.getMaxNbMeasuresPerLine=function(){return this.systemBreakPolicy.getMaxNbMeasuresPerLine()},l.setParent=function(p){this.parent=p},l.setPosition=function(p){this.posY=p},l.setPosX=function(p){this.posX=p},l.setContentX=function(p){this.contentX=p},l.setIdx=function(p){this.idx=p},l.setMetrics=function(p){this.metrics=p},l.setIsFirst=function(p){this.isFirst=p},l.hasPartContent=function(){return this.pageContent!==null},l.setPageContent=function(p){this.pageContent=p},l.dispatchDrawingContext=function(p){p.setDrawingContext(this.drawingContext)},l.setBreakBefore=function(p){this.breakBefore=p},l.setBreakAfter=function(p){this.breakAfter=p},l.canFit=function(p){if(this.systems.length===0)return!0;if(this.metrics.unlimitedHeight)return!0;{const b=this.getTargetHeight()-this.getHeight(),v=this.getLastSystem(),B=S(v,p,this.drawingContext);return p.getHeight()+B<b}},l.getLastSystem=function(){const p=this.getNbSystems();return this.systems[p-1]},l.getTargetHeight=function(){return this.isFirst?this.metrics.firstShardAvailableHeight:this.metrics.otherShardsAvailableHeight},l.pushSystem=function(p){if(this.dispatchGroup(p),this.height!==null){if(this.systems.length>0){const v=this.systems[this.systems.length-1],B=this.getDrawingContext(),C=S(v,p,B);this.height+=C}const b=p.getHeight();this.height+=b}this.systems.push(p)},l.popLastGroupSystems=function(){if(this.systems.length===0)throw new A.default("Cannot pop a system when there is none");if(!this.systems[this.systems.length-1].hasGroup())throw new A.default("The bottom system is not part of a group");const p=[];let b=null;do b=this.popSystem(),p.unshift(b);while(!b.hasGroupStart());return p},l.popSystem=function(){if(this.systems.length===0)throw new A.default("Cannot pop a system when there is none");const p=this.systems.pop();if(p.setHeaderParent(null),p.setContentParent(null),this.height!==null)if(this.systems.length>0){const b=this.systems[this.systems.length-1],v=this.getDrawingContext(),B=S(b,p,v);this.height-=B;const C=p.getHeight();this.height-=C}else this.height=0;return p},l.insertMeasure=function(p,b){p.forEach(function(v,B){this.getSystem(B).insertMeasure(v,b)},this)},l.removeMeasure=function(p){this.systems.forEach(function(b){b.removeMeasure(p)})},l.drawContentRec=function(){this.drawContent(),this.systems.forEach(p=>p.drawContentRec())},l.drawContent=function(){this.formatHorizontally(),this.formatVertically(),this.updateVerticalLine(),this.updateBracketGroupsDisplay()},l.getGroup=function(){return this.renderIfNeeded(),this.group},l.getContentGroup=function(){return this.renderIfNeeded(),this.contentGroup},l.getHeadersGroup=function(){return this.renderIfNeeded(),this.headersGroup},l.renderIfNeeded=function(){this.group===null&&(this.group=new w.A("g"),this.headersGroup===null&&(this.headersGroup=this.group),this.group.attr("class",this.name),this.contentGroup=new w.A("g"),this.contentGroup.attr("class",`${this.name}-content`),this.group.append(this.contentGroup))},l.dispatchGroup=function(p){const b=this.getHeadersGroup();p.setHeaderParent(b);const v=this.getContentGroup();p.setContentParent(v)},l.createVerticalLine=function(){this.verticalLine=new w.A("line");const p=this.getFirstLineWidth();this.verticalLine.attr("stroke-width",p);const b=0;this.verticalLine.attr("x1",b),this.verticalLine.attr("x2",b),this.getContentGroup().append(this.verticalLine)},l.move=function(){this.getGroup().attr("transform",`translate(${this.posX}, ${this.posY})`)},l.getMeasuresHorizontalData=function(p){const b=this.systems.map(function(B){return B.getMeasuresHorizontalData(p)});return Array.prototype.concat.apply([],b)},l.updateCrossMeasuresHorizontalDisplayForVerticalComputation=function(){this.systems.forEach(p=>p.updateCrossMeasuresHorizontalDisplayForVerticalComputation())},l.dispatchVerticalFormatting=function(){this.systems.forEach(p=>p.dispatchVerticalFormatting())},l.dispatchHorizontalFormatting=function(p){this.systems.forEach(b=>b.dispatchHorizontalFormatting(p))},l.dropVerticalFormatting=function(){this.height=null,this.systems.forEach(p=>p.dropVerticalFormatting())},l.drawBasicCursor=function(p,b){this.getSystem(p.partIdx).drawCursor(p,b)},l.drawGraceCursor=function(p,b){this.getSystem(p.partIdx).drawGraceCursor(p,b)},l.drawTabCursor=function(p,b){this.getSystem(p.partIdx).drawTabCursor(p,b)},l.drawDynamicCursor=function(p,b){this.getSystem(p.partIdx).drawDynamicCursor(p,b)},l.drawPizzicatoCursor=function(p,b){this.getSystem(p.partIdx).drawPizzicatoCursor(p,b)},l.drawMuteCursor=function(p,b){this.getSystem(p.partIdx).drawMuteCursor(p,b)},l.drawHorizontalCursor=function(p,b){this.getSystem(p.partIdx).drawHorizontalCursor(p,b)},l.drawHorizontalCursorTimePos=function(p,b){this.getSystem(p.partIdx).drawHorizontalCursorTimePos(p,b)},l.drawHorizontalMeasureWideCursor=function(p,b){this.getSystem(p.partIdx).drawHorizontalMeasureWideCursor(p,b)},l.drawCrossMeasureNoteCursor=function(p,b){this.getSystem(p.partIdx).drawCrossMeasureNoteCursor(p,b)},l.setNoteColor=function(p,b){this.getSystem(p.systemIdx).setNoteColor(p,b)},l.autoSetExternalSystemMeasureGaps=function(){const p=this.getExternalSystemMeasureGap();this.setFirstSystemMeasureGapAbove(p),this.setLastSystemMeasureGapBelow(p)},l.getExternalSystemMeasureGap=function(){return this.drawingContext.getSpaceSize()*h},l.updateHorizontalDisplay=function(p){this.systems.forEach(function(b){b.updateHorizontalDisplay(p)})},l.formatVertically=function(){let p=0,b=null;this.systems.forEach(v=>{if(b!==null){const B=this.getDrawingContext(),C=b.getSpaceAboveFirstStaff(),_=b.getInnerHeight(),st=T(b,v,B);p+=C+_+st-v.getSpaceAboveFirstStaff();const F=S(b,v,B);b.setLastStaffMeasuresGapBelow(F),v.setFirstStaffMeasuresGapAbove(F)}v.setContentY(p),v.move(),b=v})},l.setFirstSystemMeasureGapAbove=function(p){this.getSystem(0).setFirstStaffMeasuresGapAbove(p)},l.setLastSystemMeasureGapBelow=function(p){const b=this.getNbSystems();this.getSystem(b-1).setLastStaffMeasuresGapBelow(p)},l.toggleMinimalName=function(p){this.resetHeadersWidth(),this.systems.forEach(b=>b.toggleMinimalName(p)),this.updateGroupBracketsOffsets(),this.formatHorizontally(),this.systems.forEach(b=>{b.header.drawContentRec(),b.header.move()}),this.updateBracketGroupsDisplay()},l.isMinimalName=function(){return this.systems[0].isMinimalName()},l.formatHorizontally=function(){const p=this.getHeaderWidth();this.systems.forEach(function(B){const C=B.getHeaderWidth(),_=p-C;B.setHeaderPosX(_)});let b=0;this.hasForeignHeaderGroup()||(b=p),this.getContentGroup().attr("transform",`translate(${b}, 0)`)},l.hasForeignHeaderGroup=function(){const p=this.getHeadersGroup(),b=this.getGroup();return p!==b},l.linkGroupBracket=function(){(0,P.A)(this.systems,this.drawingContext)},l.reloadAllCrossMeasures=function(){this.systems.forEach(function(p){p.reloadAllCrossMeasures()})},l.updateVerticalLine=function(){if(this.verticalLine===null)return;const b=this.getSpaceAboveFirstStaff();this.verticalLine.attr("y1",b);const v=this.getHeight(),B=this.getSpaceBelowLastStaff(),C=v-B;this.verticalLine.attr("y2",C)},l.updateGroupBracketsOffsets=function(){this.systems.forEach((p,b)=>{if(!p.hasGroup()||!p.hasGroupStart()&&b!==0)return;p.getGroupBracket().refreshGroupBracketOffset()}),this.resetHeadersWidth()},l.updateBracketGroupsDisplay=function(){const p=this.getHeaderWidth();this.systems.forEach((b,v)=>{if(!b.hasGroup()||!b.hasGroupStart()&&v!==0)return;const B=b.getGroupBracket(),C=B.getGroupBracketOffset(),_=p-C;B.setPosX(_);const st=b.getPosY()+b.getSpaceAboveFirstStaff();B.setPosY(st);const F=B.getBottomSystem(),I=F.getPosY()+F.getSpaceAboveFirstStaff()+F.getInnerHeight()-st;B.setHeight(I),B.setParent(this.headersGroup),B.draw(),B.extendBarlines()})},l.getFirstLineWidth=function(){return this.drawingContext.getThinBarlineThickness()},l.getDrawingContext=function(){return this.drawingContext},l.getStaffLyricsUpY=function(p,b,v,B){return this.getSystem(b).getStaffLyricsUpY(p,v,B)},l.getStaffWordsY=function(p,b,v,B){return this.getSystem(b).getStaffWordsY(p,v,B)},l.getSystemChordsY=function(p,b){return this.getSystem(p).getChordsY(b)},l.getSystemTopStaffClassicHarmonyY=function(p,b){return this.getSystem(p).getTopStaffClassicHarmonyY(b)},l.getSystemBottomStaffClassicHarmonyY=function(p,b){return this.getSystem(p).getBottomStaffClassicHarmonyY(b)},l.getSystemBottomStaffFiguredBassY=function(p,b,v){return this.getSystem(p).getBottomStaffFiguredBassY(b,v)},l.getMeasureWidth=function(p,b){return this.getSystem(p).getMeasureWidth(b)},l.getNoteXInMeasure=function(p,b,v,B,C){return this.getSystem(p).getNoteXInMeasure(b,v,B,C)},l.getTimePosXInMeasure=function(p,b,v,B,C){return this.getSystem(p).getTimePosXInMeasure(b,v,B,C)},l.getMeasureNbNotes=function(p,b,v,B){return this.getSystem(p).getMeasureNbNotes(b,v,B)},l.getSpaceAboveStaff=function(p,b){return this.getSystem(p).getSpaceAboveStaff(b)},l.resetGeometries=function(){this.systems.forEach(m)};const m=function(p){p.resetGeometries()};l.getAllMeasuresGeometries=function(){const p=this.getNbMeasures(),b=[];for(let v=0;v<p;v++){const B=this.getMeasureGeometry(v);b.push(B)}return Array.prototype.concat.apply([],b)},l.getMeasureGeometry=function(p){const b=[];return this.systems.forEach(function(v){const B=v.getMeasureGeometry(p);b.push(B)}),Array.prototype.concat.apply([],b)},l.getSystemMeasureGeometry=function(p,b){return this.getSystem(p).getMeasureGeometry(b)},l.getMeasurePosX=function(p){return this.getSystem(0).getMeasurePosX(p)},l.getSpaceAboveFirstStaff=function(){return this.systems[0].getSpaceAboveFirstStaff()},l.getNotesSpaceAboveFirstStaff=function(){return this.systems[0].getNotesSpaceAboveFirstStaff()},l.getSpaceBelowLastStaff=function(){const p=this.systems.length-1;return this.systems[p].getSpaceBelowLastStaff()},l.getNotesSpaceBelowLastStaff=function(){const p=this.systems.length-1;return this.systems[p].getNotesSpaceBelowLastStaff()},l.getBBox=function(){const p=this.getHeight();return{width:this.getWidth(),height:p}},l.getHeight=function(){return this.height===null&&this.calcHeight(),this.height},l.calcHeight=function(){this.height=this.systems.reduce(x,0)};const x=function(p,b,v,B){const C=b.getHeight();if(p+=C,v>0){const _=b.getDrawingContext(),st=B[v-1],F=S(st,b,_);p+=F}return p},S=function(p,b,v){const B=T(p,b,v),C=p.getSpaceBelowLastStaff(),_=b.getSpaceAboveFirstStaff();return B-C-_},T=function(p,b,v){const B=p.getSpaceBelowLastStaff(),C=b.getSpaceAboveFirstStaff(),_=v.getSpaceSize()*a,st=B+C+_,F=p.getNotesSpaceBelowLastStaff(),L=b.getNotesSpaceAboveFirstStaff(),I=v.getSpaceSize()*h,W=F+L+I,V=v.getSpaceBetweenStaves();return Math.max(st,W,V)};l.getWidth=function(){return this.hasForeignHeaderGroup()?this.getContentWidth():this.getContentWidth()+this.getHeaderWidth()},l.getContentWidth=function(){return this.getAnySystem().getContentWidth()},l.resetHeadersWidth=function(){this.headerWidth=null},l.getHeaderWidth=function(){return this.headerWidth===null&&this.calcHeaderWidth(),this.headerWidth},l.calcHeaderWidth=function(){const p=this.systems.map(Y);this.headerWidth=p.reduce(f.default.max2)};const Y=function(p){return p.getHeaderWidth()};l.hasDrawingContext=function(){return this.drawingContext!==null},l.getStaffInnerHeight=function(p,b){return this.getSystem(p).getStaffInnerHeight(b)},l.getSystemHeight=function(p){return this.getSystem(p).getHeight()},l.hasSystem=function(p){return this.getSystems().includes(p)},l.getSystems=function(){return this.systems},l.getNbMeasures=function(){return this.getAnySystem().getNbMeasures()},l.getMeasureFullAttributesGroup=function(p,b,v){return this.getSystem(p).getMeasureFullAttributesGroup(b,v)},l.getAnySystem=function(){return this.getSystem(0)},l.getStaffElem=function(p,b){return this.getSystem(p).getStaffElem(b)},l.hasEventsRects=function(){return this.drawingContext.hasEventsRects()},l.updateMeasuresEventsRects=function(){this.systems.forEach(G)};function G(p){p.updateMeasuresEventsRects()}l.getSystem=function(p){return this.checkSystemIdx(p),this.systems[p]},l.checkSystemIdx=function(p){if(typeof p!="number"||Number.isNaN(p)||p<0||p>=this.systems.length){const b=`Invalid systemIdx: [${p}].`;throw new A.default("BadSystemIdx",b)}},l.getNbSystems=function(){return this.systems.length},l.getStructure=function(){const p=this.getNbMeasures(),b=this.measuresSlice.getMeasureStartDataIdx(),v=this.getSystemsStructures();return{idx:this.idx,startMeasureIdx:b,nbMeasures:p,systems:v}},l.getSystemsStructures=function(){return this.systems.map(q)};const q=function(p){return p.getStructure()};l.getIdx=function(){return this.idx},l.isEmpty=function(){return this.getNbMeasures()===0},l.hasPageContent=function(){return this.pageContent!==null},l.getPageContent=function(){return this.pageContent},l.getPageIdx=function(){return this.pageContent.getIdx()},l.shouldBreakBefore=function(){return this.breakBefore||this.measuresSlice.hasPageBreakBefore()},l.shouldBreakAfter=function(){return this.breakAfter},l.getPartBottomMeasureElem=function(p,b){return this.getSystem(p).getBottomMeasureElem(b)},l.getMeasureElem=function(p,b,v){return this.getSystem(p).getMeasureElem(b,v)},l.getMeasureEventRect=function(p,b,v){return this.getSystem(p).getMeasureEventRect(b,v)},l.hasOnlyOneGroup=function(){if(this.systems.length===0)return!1;const[p,...b]=this.systems;if(!p.hasGroup())return!1;const v=p.getGroupIdx(),B=b.length;for(let C=0;C<B;C++){const _=b[C];if(!_.hasGroup()||_.getGroupIdx()!==v)return!1}return!0},l.updateChildrenBindings=function(){for(let p=this.systems.length-1;p>=0;p--){const b=this.systems[p],v=p===this.systems.length-1;if(b.needUpdateContentBinding()){if(v)b.setContentInsertionPoint(null);else{const C=this.systems[p+1].getContentGroup();b.setContentInsertionPoint(C)}b.updateContentBinding()}if(b.needUpdateHeaderBinding()){if(v)if(this.hasForeignHeaderGroup())b.setHeaderInsertionPoint(null);else{const B=this.getContentGroup();b.setHeaderInsertionPoint(B)}else{const C=this.systems[p+1].getHeaderGroup();b.setHeaderInsertionPoint(C)}b.updateHeaderBinding()}}},l.setInsertionPoint=function(p){this.insertionPoint=p},l.destroy=function(){this.currentParent!==null&&(this.getGroup().removeFromParent(),this.currentParent=null),this.parent=null,this.insertionPoint=null,this.measuresSlice=null,this.systems=null},l.updateBinding=function(){if(!this.needUpdateBinding())return;const p=this.getGroup();this.parent===null?p.removeFromParent():this.insertionPoint===null?this.parent.append(p):this.parent.insertBefore(p,this.insertionPoint),this.currentParent=this.parent},l.needUpdateBinding=function(){return this.parent!==this.currentParent},l.setMeasuresSlice=function(p){this.measuresSlice=p},l.getMeasuresSlice=function(){return this.measuresSlice},l.updateMeasureNumbers=function(){this.systems.forEach(p=>p.updateMeasureNumbers())},l.drawVerticalDebug=function(){this.systems.forEach(function(p){p.drawVerticalDebug()})};const R=d},781942:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Wt});var A=r(123491),w=r(515819),f=r(351277),P=r(414787),a=r(737903),h=r(287719),d=r(648920),l=r(589085),m=r(50060),x=r(724926),S=r(316197),T=r(511890),Y=r(860716),G=r(364596),q=r(104907),R=r(794741),p=r(936945),b=r(197510),v=r(762691),B=r(259563),C=r(359932),_=r(601277),st=r(129283),F=r(538783),L=r(369790),I=r(724095),W=r(339406),V=r(955154),it=r(353922),Pt=r(579283);const Yt=5,Bt="TUpper",le=function(k,St,yt){return new ie(k,St,yt).getDisplayData()},ie=function(k,St,yt){this.init(k,St,yt)},K=ie.prototype;K.init=function(k,St,yt){this.notes=k.slice(),this.note=k[0],this.attrs=St,this.stemStrategy=yt.stemStrategy,this.noteIdx=yt.noteIdx,this.isAlone=yt.isAlone,this.isPickup=yt.isPickup,this.timePos=yt.timePos,this.isFullMeasureRest=this.computeIsFullMeasureRest(),this.clef=null,this.staffData=null},K.computeIsFullMeasureRest=function(){return A.default.isRest(this.note)?!!(A.default.isFullMeasureRest(this.note)||this.isAlone&&!this.isPickup):!1},K.getDisplayData=function(){this.extractData();const k={lines:this.lines,nbDots:this.nbDots,accidentals:this.accidentals,quarterBaseDuration:this.quarterBaseDuration,duration:this.duration,isRest:this.isRest,hasBeam:this.hasBeam,beams:this.beams,voiceIdx:this.voiceIdx,tieStops:this.tieStops,tieStarts:this.tieStarts,tieStartsDirections:this.tieStartsDirections,heads:this.heads,staffData:this.staffData,technical:pe(this.note),articulations:A.default.getFullArticulationsList(this.note).filter(A.default.isValidArticulation),ornaments:A.default.getOrnamentsListForDrawer(this.note),frets:this.frets,hasArpeggio:this.hasArpeggio,isGrace:A.default.isGraceNote(this.note),lyrics:this.lyrics,glissandoStarts:this.glissandoStarts,glissandoStops:this.glissandoStops,slideStarts:this.slideStarts,slideStops:this.slideStops,globalCssClassesStr:this.globalCssClassesStr,hammerOnPullOffStarts:this.hammerOnPullOffStarts,hammerOnPullOffStops:this.hammerOnPullOffStops,hasFlagDash:this.hasFlagDash,stemStrategy:this.stemStrategy,fingerings:this.fingerings,staffIdx:this.staffIdx,noteIdx:this.noteIdx,restColor:this.restColor,isSlash:!!this.note.isSlash,isRhythmic:!!this.note.isRhythmic,isUnpitched:this.isUnpitched,fingeringDiagramFormula:this.getFingeringDiagramFormula(),fingeringDisplayType:this.getFingeringDisplayType()};return new W.A(k)};function pe(k){const St=A.default.getTechnicalList(k).filter(C.default.isValid);if(A.default.hasHarmonic(k)){const yt=A.default.getHarmonic(k),Ct=Y.default.getType(yt);Ct===V.default.NATURAL_SOUNDING&&St.push(Ct)}return St}K.extractData=function(){this.staffIdx=A.default.getStaffIdx(this.note),this.extractDuration(),this.extractLyric(),this.extractQuarterBaseDuration(),this.extractNbDots(),this.extractStaffData(),this.isRest=A.default.isRest(this.note),this.extractLines(),this.sortLinesAndNotes(),this.extractAccidentals(),this.extractHeads(),this.extractFingerings(),this.extractArticulations(),this.extractFrets(),this.initTies(),this.initHammerOnPullOffs(),this.extractBeams(),this.voiceIdx=A.default.getVoiceIdx(this.note),this.extractArpeggiate(),this.extractGlissandos(),this.extractSlides(),this.extractCommonHistory(),this.extractHasFlagDash(),this.extractRestColor(),this.isUnpitched=A.default.hasUnpitched(this.note)},K.extractDuration=function(){A.default.hasDuration(this.note)?this.duration=A.default.getFloatingDuration(this.note):this.duration=null},K.extractQuarterBaseDuration=function(){A.default.isGraceNote(this.note)?this.extractQuarterBaseDurationFromGrace():this.extractQuarterBaseDurationFromNormal()},K.extractQuarterBaseDurationFromGrace=function(){const k=A.default.getDurationType(this.note);this.quarterBaseDuration=B.default.toQuarterDuration(k)},K.extractQuarterBaseDurationFromNormal=function(){if(this.isFullMeasureRest)this.quarterBaseDuration=B.default.toQuarterDuration(B.default.FULL);else{const k=this.attrs.getDpq(),St=A.default.getNormalQuarterDuration(this.note,k);this.quarterBaseDuration=w.default.extractBaseDuration(St),A.default.hasTremoloSide(this.note)&&(this.quarterBaseDuration*=2)}},K.extractNbDots=function(){this.isFullMeasureRest?this.nbDots=0:this.nbDots=A.default.getNbDots(this.note)},K.extractLines=function(){this.lines=this.notes.map(this.extractLine,this),this.hasFakeLine()&&this.lines.push(4)},K.extractLine=function(k){return A.default.isRest(k)&&typeof k["display-octave"]=="undefined"?this.getDefaultRestLine():this.getSpecifiedLine(k)},K.extractArticulations=function(){this.articulations=(0,a.default)(A.default.getArticulations(this.note)),A.default.hasNotation(this.note,_.default.FERMATA)&&(this.articulations[_.default.FERMATA]={})},K.extractLyric=function(){let k=A.default.getLyrics(this.note);k=k.filter(Ee),k=k.map(m.default.copy),k.sort(m.default.compare),this.lyrics=k};function Ee(k){return!m.default.hasLeftMelisma(k)}K.getDefaultRestLine=function(){const k=this.quarterBaseDuration;let St;if(this.isRecorderTabStaff())return null;if(this.isKodalyStaff())return k===B.default.toQuarterDuration(B.default.FULL)?7:6;const yt=this.getDisplayedNbStaffLines();return k===B.default.toQuarterDuration(B.default.FULL)?yt===5?St=4:yt===3||yt===1?St=3:St=4:yt===5||yt===1?St=3:yt===3?St=1:St=3,F.A.isUp(this.stemStrategy)?St+=2:F.A.isDown(this.stemStrategy)&&(St-=2),St},K.isKodalyStaff=function(){const k=this.getStaffData();return l.A.isKodalyStaff(k)},K.isRecorderTabStaff=function(){const k=this.getStaffData();return l.A.isRecorderTabStaff(k)},K.getDisplayedNbStaffLines=function(){const k=this.getStaffData();return l.A.getDisplayedNbStaffLines(k)},K.getSpecifiedLine=function(k){if(A.default.hasUnpitched(k)){const St=this.getDisplayedNbStaffLines(),yt=A.default.getUnpitched(k);return P.A.pitchToLine(yt,St)}else{if(this.isRecorderTabStaff())return null;if(this.isKodalyStaff())return 1.5;{const St=this.getClef();let yt;return A.default.isRest(k)?yt={step:k["display-step"],octave:k["display-octave"]}:yt=k.pitch,f.default.pitchToLine(yt,St)}}},K.getClef=function(){return this.attrs.getClefAtTimePos(this.staffIdx,this.timePos)},K.getNbStaffLines=function(){const k=this.getStaffData();return l.A.getNbStaffLines(k)},K.getStaffData=function(){return this.staffData===null&&this.extractStaffData(),this.staffData},K.getFingeringDiagramFormula=function(){if(!this.isRecorderTabStaff()||!A.default.hasPitch(this.note))return null;const k=this.attrs.getStaffDetails(this.staffIdx),St=q.default.getRecorderTabs(k),yt=R.A.getType(St);let Ct=A.default.getPitch(this.note);const Mt=this.attrs.getTranspose(0);return Ct=f.default.transpose(Ct,Mt,!1),(0,b.A)(Ct,yt)},K.getFingeringDisplayType=function(){if(!this.isRecorderTabStaff()||!A.default.hasPitch(this.note))return null;const k=this.attrs.getStaffDetails(this.staffIdx),St=q.default.getRecorderTabs(k);return R.A.getDisplayType(St)},K.extractStaffData=function(){const k=this.attrs.getStaffDetails(this.staffIdx);this.staffData=l.A.createFromStaffDetails(k)},K.sortLinesAndNotes=function(){const k=[];for(;this.notes.length>0;){const St=this.notes.shift(),yt=this.lines.shift();k.push({note:St,line:yt})}for(k.sort(tt);k.length>0;){const St=k.shift();this.notes.push(St.note),this.lines.push(St.line)}};const tt=function(k,St){return Et(k.line,St.line)},Et=function(k,St){return St-k};K.extractAccidentals=function(){this.accidentals=[],this.notes.forEach(function(k,St){const yt=this.lines[St];let Ct;if(A.default.hasCourtesyAccidental(k)){const Mt=A.default.getAlter(k);Ct={accidental:f.default.alterToAccidental(Mt),line:yt,parentheses:!0},this.accidentals.push(Ct)}else A.default.hasAccidental(k)&&(Ct={accidental:A.default.getAccidental(k),line:yt,parentheses:!1},A.default.hasAccidentalColor(k)&&(Ct.color=A.default.getAccidentalColor(k)),this.accidentals.push(Ct))},this)},K.extractHeads=function(){this.heads=[],this.notes.forEach(function(k,St){const yt=v.default.getHeadCssClassesStr(k);let Ct=this.lines[St];this.hasFakeLine()&&(Ct=this.lines[St+1]);const Mt=A.default.getHead(k),Tt=A.default.hasHeadParentheses(k),nt=A.default.isShapeNote(k),vt=A.default.isOutOfTessiture(k),Nt=fe(k),te=Vt(k),ee=ct(k),Ot=A.default.hasTieStop(k),ot={line:Ct,notehead:Mt,cssClassesStr:yt,hasParentheses:Tt,isTieStop:Ot,isShapeNote:nt,color:Nt,isHarmonicArtificialTouching:te,isHarmonicNaturalTouching:ee,isOutOfTessiture:vt};if(A.default.hasPitch(k)){const rt=A.default.getPitch(k);ot.step=f.default.getStep(rt),ot.alter=f.default.getAlter(rt),ot.octave=f.default.getOctave(rt)}if(A.default.isTemplateLocked(k)&&(ot.isTemplateLocked=!0),A.default.hasPitch(k)){const rt=A.default.getPitch(k),at=this.getCPitch(rt);ot.cStep=f.default.getStep(at),ot.cAlter=f.default.getAlter(at)}this.heads.push(ot)},this)},K.getCPitch=function(k){k=f.default.copy(k),f.default.setOctave(k,4);const St=this.attrs.getKey(this.staffIdx),yt=G.default.getTonic(St);f.default.setOctave(yt,4);const Ct=f.default.create(4,"C"),Mt=f.default.getTransposeDiff(Ct,yt);return f.default.transpose(k,Mt)};function Vt(k){if(!A.default.hasHarmonic(k))return!1;const St=A.default.getHarmonic(k);return Y.default.getType(St)===V.default.ARTIFICIAL_TOUCHING}function ct(k){if(!A.default.hasHarmonic(k))return!1;const St=A.default.getHarmonic(k);return Y.default.getType(St)===V.default.NATURAL_TOUCHING}K.hasFakeLine=function(){return this.isKodalyStaff()&&!this.isRest&&this.quarterBaseDuration>1||this.isRecorderTabStaff()};function fe(k){return A.default.hasColor(k)?A.default.getColor(k):null}K.extractFingerings=function(){this.fingerings=this.notes.filter(A.default.hasFingering).map(gt),this.fingerings=[].concat(...this.fingerings);const k=this.attrs.getStaffDetails(this.staffIdx);if(this.fingerings.length===0&&q.default.hasBrassFingering(k)&&A.default.hasPitch(this.note)){let St=A.default.getPitch(this.note);const yt=this.attrs.getTranspose(0);St=f.default.transpose(St,yt,!1);const Mt=q.default.getBrassFingering(k),Tt=(0,p.A)(St,Mt);typeof Tt!="undefined"&&this.fingerings.push(Tt)}};function gt(k){const St=A.default.getFingerings(k);return St.length===0&&A.default.hasFretData(k)&&St[0]===Yt?[Bt]:St}K.extractFrets=function(){this.frets=[],this.notes.forEach(function(k){if(A.default.hasFretData(k)){const St=A.default.getFretData(k),yt={fretNumber:St.fret,string:St.string,notehead:A.default.getHead(k)};if(A.default.hasTieStop(k)&&(yt.isGreyed=!0,this.noteIdx===0?yt.hasParenthesis=!0:yt.isHidden=!0),A.default.getHead(k)===it.A.X&&(yt.isDeadNote=!0),A.default.hasHarmonic(k)){const Mt=A.default.getHarmonic(k),Tt=Y.default.getType(Mt);if(Tt===V.default.NATURAL_TOUCHING)yt.isNaturalHarmonic=!0;else if(Tt===V.default.ARTIFICIAL_BASE){const nt=this.getTouchingFret(k);nt!==null&&(yt.artificialHarmonicTouchingFretNumber=nt)}}A.default.hasHeadParentheses(k)&&(yt.hasParenthesis=!0),this.frets.push(yt)}else this.frets.push(null)},this)},K.getTouchingFret=function(k){const St=this.notes.filter(At,k);if(St.length===0)return null;St.sort(Ht);const[yt]=St,Ct=A.default.getFretData(k),Mt=this.attrs.getStaffDetails(this.staffIdx),Tt=A.default.getPitch(yt);return(0,Pt.default)(Tt,Ct.string,Mt)};function At(k){if(!A.default.hasHarmonic(k))return!1;const St=A.default.getHarmonic(k);if(Y.default.getType(St)!==V.default.ARTIFICIAL_TOUCHING)return!1;const Ct=A.default.getPitch(k),Mt=this,Tt=A.default.getPitch(Mt);return f.default.naiveComparePitch(Ct,Tt)>0}function Ht(k,St){const yt=A.default.getPitch(k),Ct=A.default.getPitch(St);return f.default.naiveComparePitch(yt,Ct)}K.initTies=function(){this.tieStops=[],this.tieStarts=[],this.tieStartsDirections=[],this.notes.forEach(function(k,St){const yt=this.lines[St];if(A.default.hasTieStart(k)){this.tieStarts.push(yt);const Ct=A.default.getTieDirection(k);this.tieStartsDirections.push(Ct)}A.default.hasTieStop(k)&&this.tieStops.push(yt)},this)},K.initHammerOnPullOffs=function(){this.hammerOnPullOffStarts=[],this.hammerOnPullOffStops=[],this.notes.forEach(function(k,St){const yt=this.frets[St];if(yt!==null){const Ct=this.getHammerOnPullOffTechnicalOpts(L.A.START);(A.default.hasTechnical(k,C.default.HAMMER_ON,Ct)||A.default.hasTechnical(k,C.default.PULL_OFF,Ct))&&this.hammerOnPullOffStarts.push(yt.string);const Mt=this.getHammerOnPullOffTechnicalOpts(L.A.STOP);(A.default.hasTechnical(k,C.default.HAMMER_ON,Mt)||A.default.hasTechnical(k,C.default.PULL_OFF,Mt))&&this.hammerOnPullOffStops.push(yt.string)}},this)},K.getHammerOnPullOffTechnicalOpts=function(k){return{hammerOnPullOff:x.A.create(k)}},K.extractBeams=function(){if(this.hasBeam=A.default.hasBeam(this.note)||A.default.hasTremoloSide(this.note),this.hasBeam){let k=A.default.getBeams(this.note);if(k=k.map(d.A.copy),k.sort(d.A.compare),A.default.hasTremoloSide(this.note)){let St=0;k.length>0&&(k.splice(0,1),St=k.length);const{nbBeam:yt,type:Ct}=A.default.getOrnamentOpts(this.note,I.A.TREMOLO),Mt=h.A.createFromTremolo(yt,Ct,St);k.push(...Mt),k.forEach(d.A.setNumber)}this.beams=k}},K.extractArpeggiate=function(){this.hasArpeggio=A.default.hasArpeggiate(this.note)},K.extractGlissandos=function(){this.glissandoStarts=[],this.glissandoStops=[],this.notes.forEach(function(k,St){const yt=this.lines[St];this.extractGlissandoStarts(k,yt),this.extractGlissandoStops(k,yt)},this)},K.extractGlissandoStarts=function(k,St){A.default.hasGlissandoType(k,st.default.START)&&A.default.getGlissandosType(k,st.default.START).forEach(function(Ct){const Mt={line:St,number:S.default.getNumber(Ct)};this.glissandoStarts.push(Mt)},this)},K.extractGlissandoStops=function(k,St){A.default.hasGlissandoType(k,st.default.STOP)&&A.default.getGlissandosType(k,st.default.STOP).forEach(function(Ct){const Mt={line:St,number:S.default.getNumber(Ct)};this.glissandoStops.push(Mt)},this)},K.extractSlides=function(){this.slideStarts=[],this.slideStops=[],this.notes.forEach(function(k,St){const yt=this.lines[St];this.extractSlideStarts(k,yt),this.extractSlideStops(k,yt)},this)},K.extractSlideStarts=function(k,St){A.default.hasSlideStart(k)&&A.default.getSlideStarts(k).forEach(function(Ct){const Mt={line:St,number:T.default.getNumber(Ct)};if(A.default.hasFretData(k)){const Tt=A.default.getFretData(k);Mt.string=Tt.string,Mt.fret=Tt.fret}this.slideStarts.push(Mt)},this)},K.extractSlideStops=function(k,St){A.default.hasSlideStop(k)&&A.default.getSlideStops(k).forEach(function(Ct){const Mt={line:St,number:T.default.getNumber(Ct)};if(A.default.hasFretData(k)){const Tt=A.default.getFretData(k);Mt.string=Tt.string,Mt.fret=Tt.fret}this.slideStops.push(Mt)},this)},K.extractCommonHistory=function(){this.globalCssClassesStr=v.default.getGlobalCssClassesStr(this.note)},K.extractHasFlagDash=function(){this.hasFlagDash=A.default.isSlashedGrace(this.note)},K.extractRestColor=function(){this.restColor=null,this.isRest&&A.default.hasColor(this.note)&&(this.restColor=A.default.getColor(this.note))};const Wt=le},790850:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Ve});var A=r(364842),w=r(726042),f=r(446921),P=r(383279),a=r(601770);const h=function(M,et,Z,mt){this.init(M,et,Z,mt)},d=h.prototype;d.init=function(M,et,Z,mt){this.commonContent=M,this.partsHeaders=et,this.partsContents=Z,this.measuresHeaders=mt},d.getNbMeasures=function(){return this.commonContent.getNbMeasures()},d.getNbParts=function(){return this.partsHeaders.length},d.getCommonContent=function(){return this.commonContent},d.getPartsHeaders=function(){return this.partsHeaders},d.getPartsContents=function(){return this.partsContents},d.getMeasure=function(M,et){this.checkPartIdx(M);const Z=this.getNbMeasures();if(!w.default.isInteger(et)||et<0||et>=Z){const Ye=`Bad measure idx [${et}<${typeof et}>] on a static view of the ScoreData.`;throw new A.default("BadMeasureIdx",Ye)}const mt=this.partsContents[M];return f.A.getMeasure(mt,et)},d.getPartStaffMapping=function(M){const et=this.getPartHeader(M);return P.default.getStaffMapping(et)},d.getPartStaffVoicesIndexes=function(M,et){const Z=this.getPartHeader(M);return P.default.getStaffVoicesIndexes(Z,et)},d.getPartHeader=function(M){return this.checkPartIdx(M),this.partsHeaders[M]},d.checkPartIdx=function(M){const et=this.getNbParts();if(!w.default.isInteger(M)||M<0||M>=et){const Z=`Bad part idx [${M}<${typeof M}>] on a static view of the ScoreData.`;throw new A.default("BadPartIdx",Z)}},d.getPartUuid=function(M){const et=this.getPartHeader(M);return P.default.getUuid(et)},d.getMeasureUuid=function(M){const et=this.getMeasureHeader(M);return a.A.getUuid(et)},d.getMeasureHeader=function(M){return this.measuresHeaders[M]},d.getPartStaffUuid=function(M,et){const Z=this.getPartHeader(M);return P.default.getStaffUuid(Z,et)},d.getPartVoiceUuid=function(M,et){const Z=this.getPartHeader(M);return P.default.getVoiceUuid(Z,et)},d.getPartVoiceIdxToUUidMapping=function(M){const et=this.getPartHeader(M);return P.default.getVoiceIdxToUuidMapping(et)};const l=h;class m extends Error{constructor(et,Z){super(et),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="DisplayError",typeof Z!="undefined"&&(this.code=Z)}}const x=function(M,et){const Z=M[0],mt=f.A.getNbMeasures(Z),$t=S(et,mt);return M=M.map(T,$t),M},S=function(M,et){const Z={};if(typeof M.firstMeasureIdx=="number"){const mt=M.firstMeasureIdx;if(mt<0||mt>=et)throw new m(`first measure idx [${mt}] is out of bounds`);Z.firstMeasureIdx=mt}else Z.firstMeasureIdx=0;if(typeof M.lastMeasureIdx=="number"){const mt=M.lastMeasureIdx;if(mt<Z.firstMeasureIdx||mt>=et)throw new m(`last measure idx [${mt}] is out of bounds`);Z.lastMeasureIdx=mt}else Z.lastMeasureIdx=et-1;return Z},T=function(M){const et=this;let Z=f.A.getMeasures(M);return Z=Z.slice(et.firstMeasureIdx,et.lastMeasureIdx+1),M={measure:Z},M},Y=x;var G=r(586745),q=r(518558),R=r(737903);const p=function(M,et){const Z=M.getNbMeasures(),mt=b(et,Z);return M=v(M,mt),M},b=function(M,et){const Z={};if(typeof M.firstMeasureIdx=="number"){const mt=M.firstMeasureIdx;if(mt<0||mt>=et)throw new m(`first measure idx [${mt}] is out of bounds`);Z.firstMeasureIdx=mt}else Z.firstMeasureIdx=0;if(typeof M.lastMeasureIdx=="number"){const mt=M.lastMeasureIdx;if(mt<Z.firstMeasureIdx||mt>=et)throw new m(`last measure idx [${mt}] is out of bounds`);Z.lastMeasureIdx=mt}else Z.lastMeasureIdx=et-1;return Z},v=function(M,et){const Z=new G.A;for(let mt=et.firstMeasureIdx;mt<=et.lastMeasureIdx;mt++){const $t=mt-et.firstMeasureIdx,Ye=M.getTempo(mt),de=M.getSwing(mt);if(Z.addMeasure($t,Ye,de),($t===0||M.hasOwnTempo(mt))&&Z.setOwnTempo($t,Ye),($t===0||M.hasOwnSwing(mt))&&Z.setOwnSwing($t,de),M.hasRehearsal(mt)){const jt=M.getRehearsal(mt);Z.setRehearsal($t,jt)}if(M.hasEnding(mt)){let jt=M.getEnding(mt);jt=jt.slice(),Z.setEnding($t,jt)}if(M.hasJumpTag(mt)){const jt=M.getJumpTag(mt);Z.setJumpTag($t,jt)}if(M.hasJumpCall(mt)){const jt=M.getJumpCall(mt);Z.setJumpCall($t,jt)}if(M.hasTempoChanges(mt)){let jt=M.getTempoChanges(mt);jt=jt.slice(),Z.setTempoChanges(mt,jt)}if(M.hasLeftTempoChange(mt)){let jt=M.getLeftTempoChange(mt);jt=(0,R.default)(jt),Z.setLeftTempoChange(mt,jt)}if(M.hasRightTempoChange(mt)){let jt=M.getRightTempoChange(mt);jt=(0,R.default)(jt),Z.setRightTempoChange(mt,jt)}if(M.hasSystemBreak(mt)){const jt=M.getSystemBreak(mt);Z.setSystemBreak($t,jt)}if(M.hasPageBreak(mt)){const jt=M.getPageBreak(mt);Z.setPageBreak($t,jt)}let xs=M.getBeatsList(mt);xs=(0,R.default)(xs),Z.setBeatsList($t,xs),M.hasRestsInsideBeams(mt)&&Z.setRestsInsideBeams($t,!0);let Fs=M.getDisplayedTime(mt);Fs=q.default.copy(Fs),Z.setDisplayedTime($t,Fs)}return Z},B=p;var C=r(701387);function _(M,et,Z){const mt=M.getDisplayedTime(Z),[$t]=et,Ye=f.A.getMeasure($t,Z),de=C.default.getAnyTime(Ye);return!q.default.isSameFraction(de,mt)}const F=function(M,et){return!M.hasJumpCall(et)};var L=r(476943),I=r(123491),W=r(555172),V=r(952818),it=r(668674),Pt=r(178295);const Yt=function(M){return!(C.default.getNotes(M).some(K)||Bt(M)||le(M)||C.default.hasHarmonies(M)||!C.default.getAllDirections(M).every(ie)||C.default.hasRightBarline(M)&&C.default.getRightBarlineStyle(M)!==W.A.DEFAULT_STYLE)};function Bt(M){const et=C.default.getNbStaves(M);for(let Z=0;Z<et;Z++)if(C.default.hasMeasureRepeat(M,Z))return!0;return!1}function le(M){const et=C.default.getNbStaves(M);for(let Z=0;Z<et;Z++)if(C.default.hasSlash(M,Z)){const mt=C.default.getSlash(M,Z);if(!it.A.isUsingStems(mt))return!0}return!1}function ie(M){return V.A.getTimePos(M)===0&&(0,Pt.A)(M)}const K=function(M){return!I.default.isRest(M)||I.default.needRestLock(M)},pe=Yt,Ee=function(M,et,Z){return L.default.isObject(Z.partsDisplayed)&&(M=M.filter(tt,Z)),M.every(Et,et)},tt=function(M,et){return typeof this.partsDisplayed[et]!="undefined"},Et=function(M){const et=this.valueOf(),Z=f.A.getMeasure(M,et);return pe(Z)},Vt=Ee,fe=function(M,et,Z,mt){return!(_(M,et,Z)||!F(M,Z)||!Vt(et,Z,mt))};var gt=r(110976),At=r(777345);const Wt=function(M,et){if(M.hasEnding(et)||M.hasRehearsal(et)||M.hasJumpTag(et))return!1;const Z=M.getDisplayedTime(et),mt=M.getDisplayedTime(et-1);if(!q.default.isSame(mt,Z))return!1;const $t=M.getTempo(et),Ye=M.getTempo(et-1);if(!gt.default.isSame($t,Ye))return!1;const de=M.getSwing(et),xs=M.getSwing(et-1);return!!At.default.isSame(de,xs)};var k=r(35802);const St=function(M){return!(C.default.getNotes(M).some(Tt)||yt(M)||Ct(M)||C.default.hasHarmonies(M)||C.default.getAllDirections(M).length>0||C.default.hasLeftBarline(M)&&C.default.getLeftBarlineStyle(M)!==W.A.DEFAULT_STYLE||Mt(M))};function yt(M){const et=C.default.getNbStaves(M);for(let Z=0;Z<et;Z++)if(C.default.hasMeasureRepeat(M,Z))return!0;return!1}function Ct(M){const et=C.default.getNbStaves(M);for(let Z=0;Z<et;Z++)if(C.default.hasSlash(M,Z)){const mt=C.default.getSlash(M,Z);if(!it.A.isUsingStems(mt))return!0}return!1}function Mt(M){if(!C.default.hasOwnAttributes(M))return!1;const et=C.default.getOwnAttributes(M);return!!(k.default.hasClef(et)||k.default.hasKey(et))}const Tt=function(M){return!I.default.isRest(M)||I.default.needRestLock(M)},nt=St,vt=function(M,et,Z){return L.default.isObject(Z.partsDisplayed)&&(M=M.filter(Nt,Z)),M.every(te,et)},Nt=function(M,et){return typeof this.partsDisplayed[et]!="undefined"},te=function(M){const et=this.valueOf(),Z=f.A.getMeasure(M,et);return nt(Z)},ee=vt,ot=function(M,et,Z,mt){return!(_(M,et,Z)||!Wt(M,Z)||!ee(et,Z,mt))},at=function(M,et){if(M.hasEnding(et)||M.hasRehearsal(et)||M.hasJumpCall(et)||M.hasJumpTag(et))return!1;const Z=M.getDisplayedTime(et),mt=M.getDisplayedTime(et-1);if(!q.default.isSame(mt,Z))return!1;const $t=M.getTempo(et),Ye=M.getTempo(et-1);if(!gt.default.isSame($t,Ye))return!1;const de=M.getSwing(et),xs=M.getSwing(et-1);return!!At.default.isSame(de,xs)},_t=function(M){return!(C.default.getNotes(M).some(be)||qt(M)||ue(M)||C.default.hasHarmonies(M)||C.default.getAllDirections(M).length>0||C.default.hasRightBarline(M)&&C.default.getRightBarlineStyle(M)!==W.A.DEFAULT_STYLE||C.default.hasLeftBarline(M)&&C.default.getLeftBarlineStyle(M)!==W.A.DEFAULT_STYLE||ne(M))};function qt(M){const et=C.default.getNbStaves(M);for(let Z=0;Z<et;Z++)if(C.default.hasMeasureRepeat(M,Z))return!0;return!1}function ue(M){const et=C.default.getNbStaves(M);for(let Z=0;Z<et;Z++)if(C.default.hasSlash(M,Z)){const mt=C.default.getSlash(M,Z);if(!it.A.isUsingStems(mt))return!0}return!1}function ne(M){if(!C.default.hasOwnAttributes(M))return!1;const et=C.default.getOwnAttributes(M);return!!(k.default.hasClef(et)||k.default.hasKey(et))}const be=function(M){return!I.default.isRest(M)||I.default.needRestLock(M)},oe=_t,us=function(M,et,Z){return L.default.isObject(Z.partsDisplayed)&&(M=M.filter(Q,Z)),M.every(Xt,et)},Q=function(M,et){return typeof this.partsDisplayed[et]!="undefined"},Xt=function(M){const et=this.valueOf(),Z=f.A.getMeasure(M,et);return oe(Z)},bt=us,Qt=function(M,et,Z,mt){return!(_(M,et,Z)||!at(M,Z)||!bt(et,Z,mt))};function ae(M,et,Z,mt){let $t=null;if(M.hasMultiMeasureRest(Z)&&($t={nbMeasures:M.getMultiMeasureRest(Z),nbDataMeasures:1}),!fe(M,et,Z,mt))return $t;const Ye=M.getNbMeasures();if(Z+1>=Ye||!ot(M,et,Z+1,mt))return $t;for($t===null&&($t={nbMeasures:1,nbDataMeasures:1}),$t.nbDataMeasures++,M.hasMultiMeasureRest(Z+1)?$t.nbMeasures+=M.getMultiMeasureRest(Z+1):$t.nbMeasures+=1,Z++;Z+1<Ye;){if(!Qt(M,et,Z,mt)||!ot(M,et,Z+1,mt))return $t;M.hasMultiMeasureRest(Z+1)?$t.nbMeasures+=M.getMultiMeasureRest(Z+1):$t.nbMeasures+=1,$t.nbDataMeasures++,Z++}return $t}var fs=Object.defineProperty,ds=Object.defineProperties,Xe=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,Gt=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable,xt=(M,et,Z)=>et in M?fs(M,et,{enumerable:!0,configurable:!0,writable:!0,value:Z}):M[et]=Z,zt=(M,et)=>{for(var Z in et||(et={}))Gt.call(et,Z)&&xt(M,Z,et[Z]);if(U)for(var Z of U(et))It.call(et,Z)&&xt(M,Z,et[Z]);return M},Ne=(M,et)=>ds(M,Xe(et));function pi(M,et,Z){const mt=[];let $t=0;const Ye=M.getNbMeasures();for(;$t<Ye;){const de=ae(M,et,$t,Z);de!==null?(mt.push(Ne(zt({},de),{measureIdx:$t})),$t+=de.nbDataMeasures):$t++}return mt}const Os=function(M,et,Z){const mt={commonContent:M,partsContents:et};Z.forEach(on,mt)},on=function(M){const et=this.commonContent;et.setMultiMeasureRest(M.measureIdx,M.nbMeasures);const Z=Fi(et,M.measureIdx+M.nbDataMeasures-1);Wi(et,M.measureIdx,Z);for(let $t=1;$t<M.nbDataMeasures;$t++)et.removeMeasure(M.measureIdx+1);this.partsContents.forEach($i,M)};function Fi(M,et){return M.getMeasure(et)}function Wi(M,et,Z){Z.jumpCall!==null&&M.setJumpCall(et,Z.jumpCall)}const $i=function(M){const et=this,Z=f.A.getMeasures(M),mt=Z[et.measureIdx+et.nbDataMeasures-1];Z.splice(et.measureIdx+1,et.nbDataMeasures-1);const $t=Z[et.measureIdx];rn($t,mt)};function rn(M,et){if(C.default.hasRightBarline(et)){const Z=C.default.getRightBarline(et);C.default.removeRightBarline(M),C.default.addBarline(M,Z)}}const ss=Os,vi=3,Ki=function(M,et,Z){let mt=pi(M,et,Z);mt=mt.filter(is),mt.reverse(),ss(M,et,mt)},is=function(M){return M.nbMeasures!==M.nbDataMeasures?!0:M.nbMeasures>=vi},bn=Ki;var Mn=r(31278),pn=r(737296),ai=r(515819),Ys=r(832560),Ti=r(673817),ji=r(405347),Me=r(788705),an=r(843678);const Rn=function(M){const et={};return M.forEach(Qi,et),an.default.getValues(et)},Qi=function(M){const et=this,Z=I.default.getVoiceIdx(M);typeof et[Z]=="undefined"&&(et[Z]=[]),et[Z].push(M)},We=Rn;var Re=r(209175);function Ji(M,et){return Li(M)?mn(M):Gi(M,et)}function mn(M){const Z=M.map(I.default.getDuration).reduce(w.default.add),mt=M[0];return I.default.setDuration(mt,Z),I.default.setFullMeasureRest(mt,!0),I.default.removeTupletBounds(mt),[mt]}function Li(M){return M.length>1&&M.every(D)}function Gi(M,et){M.forEach(re);let Z,mt=M;do Z=!1,mt=mt.reduce(($t,Ye)=>{const de=$t[$t.length-1];if(Dt(de)&&Dt(Ye)){const xs=Oe(de,Ye,et);return I.default.getDuration(xs[0])!==I.default.getDuration(de)&&(Z=!0),$t.splice(-1,1,...xs),$t}return $t.push(Ye),$t},[]);while(Z);return mt}function re(M){I.default.isRest(M)&&I.default.setFullMeasureRest(M,!1)}function D(M){return I.default.isRest(M)&&!I.default.needRestLock(M)}function pt(M){const et=I.default.getTimeModif(M);return!Re.default.isNormal(et)}function Dt(M){return M&&D(M)&&!pt(M)}function Oe(M,et,Z){const mt=I.default.getDuration(M)+I.default.getDuration(et),$t=I.default.getVoiceIdx(M),Ye=I.default.getStaffIdx(M),de=[];let xs=ai.default.divisionsToQuarter(mt,Z);for(;xs>0;){const Fs=ai.default.extractQuarterPossibleDuration(xs),jt=ai.default.quarterToDivisions(Fs,Z),As=ai.default.extractNbDots(Fs),hi=I.default.createRest();I.default.setDuration(hi,jt),I.default.setVoiceIdx(hi,$t),I.default.setStaffIdx(hi,Ye),I.default.setNbDots(hi,As),de.push(hi),xs-=Fs}return de}const si=function(M,et){let Z=We(M);return Z=Z.map(mt=>Ji(mt,et)),M=Array.prototype.concat.apply([],Z),M};var Ei=Object.defineProperty,gs=Object.defineProperties,Ui=Object.getOwnPropertyDescriptors,bi=Object.getOwnPropertySymbols,Xs=Object.prototype.hasOwnProperty,os=Object.prototype.propertyIsEnumerable,On=(M,et,Z)=>et in M?Ei(M,et,{enumerable:!0,configurable:!0,writable:!0,value:Z}):M[et]=Z,qn=(M,et)=>{for(var Z in et||(et={}))Xs.call(et,Z)&&On(M,Z,et[Z]);if(bi)for(var Z of bi(et))os.call(et,Z)&&On(M,Z,et[Z]);return M},Un=(M,et)=>gs(M,Ui(et));function An(M,et){const Z=C.default.getAnyTime(M);if(q.default.isSameFraction(Z,et)){let mt=C.default.getNotes(M);const $t=C.default.getDivisions(M);mt=si(mt,$t),C.default.setNotes(M,mt)}else Mi(M)}function Mi(M){const et=C.default.getAnyTime(M),Z=new Ys.A(M);Z.getVoicesIndexes().forEach($t=>{const Ye=Z.getVoice($t);if(!Je(Ye))return;const de=ai.default.timeToQuarter(et),xs=ai.default.extractQuarterPossibleDuration(de),Fs=ai.default.quarterToDurationOpts(xs),jt=Un(qn({measureIdx:0,partIdx:0,voiceIdx:$t,noteIdx:0},Fs),{insertMode:pn.default.REPLACE}),As=new Ti.A;let hi=new ji.default(Z,jt,As);try{hi.checkPreconditions(),hi=new Me.default(Z,jt,As),hi.perform()}catch(ye){if(!zn(ye))throw ye}})}function zn(M){return M instanceof Mn.default}function Je(M){const et=M.getNbNotes(M);for(let Z=0;Z<et;Z++){const mt=M.getNote(Z);if(!kn(mt))return!1}return!0}function kn(M){return I.default.isRest(M)&&!I.default.needRestLock(M)&&!I.default.hasTupletBounds(M)}const ps=function(M,et){f.A.getMeasures(M).forEach((mt,$t)=>{const Ye=et.getDisplayedTime($t);An(mt,Ye)})};function Sn(M,et){M.forEach(Z=>ps(Z,et))}const $=function(M,et){const Z=new ms(M);return Z.applyOpts(et),Z.getDataSource()},ms=function(M){this.init(M)},Ri=ms.prototype;Ri.init=function(M){this.modified=!1,this.scoreData=M,this.partsContents=M.getPartsContents(),this.commonContent=M.getCommonContent()},Ri.applyOpts=function(M){Nn(M)&&this.slice(M),M.mergeEmptyMeasures&&this.mergeConsecutiveEmptyMeasures(M),M.mergeRests&&this.mergePartsRests()};const Nn=function(M){return w.default.isInteger(M.firstMeasureIdx)||w.default.isInteger(M.lastMeasureIdx)};Ri.slice=function(M){this.partsContents=Y(this.partsContents,M),this.commonContent=B(this.commonContent,M),this.modified=!0},Ri.mergeConsecutiveEmptyMeasures=function(M){bn(this.commonContent,this.partsContents,M),this.modified=!0},Ri.mergePartsRests=function(){Sn(this.partsContents,this.commonContent),this.modified=!0},Ri.getDataSource=function(){if(this.modified){this.scoreData.makeReadOnly();const M=this.scoreData.getPartsHeaders(),et=this.scoreData.getMeasuresHeaders();return new l(this.commonContent,M,this.partsContents,et)}else return this.scoreData};const Ve=$},793491:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Y});var A=r(574626),w=r(269352),f=r(863426);const P=function(){this.init()};P.cssClass="wedgeLines";const a=P.prototype;a.cssClass=P.cssClass,a.init=function(){this.parentGroup=null,this.group=null,this.upLine=null,this.downLine=null,this.drawingContext=null,this.width=null,this.leftSpread=null,this.rightSpread=null,this.posX=null,this.posY=null,this.needRender=!0},a.setDrawingContext=function(G){this.drawingContext=G},a.setParent=function(G){this.parentGroup=G},a.setSize=function(G,q){this.width=G,this.tieHeight=q,this.needRender=!0},a.render=function(){this.group=new w.A("g"),this.group.attr("class",this.cssClass);const G=this.drawingContext.getHairpinThickness(),q={stroke_width:G};this.upLine=new f.A(this.group,q);const R=this.getUpLeftY(),p=this.getUpRightY();this.upLine.render(0,R,this.width,p),this.upLine.draw();const b={stroke_width:G};this.downLine=new f.A(this.group,b);const v=this.getDownLeftY(),B=this.getDownRightY();this.downLine.render(0,v,this.width,B),this.downLine.draw()},a.setWidth=function(G){this.width=G,this.isRendered()&&(this.upLine.setX2(G),this.downLine.setX2(G))},a.setLeftSpread=function(G){if(this.leftSpread=G,this.height=Math.max(this.leftSpread,this.rightSpread),this.isRendered()){const q=this.getUpLeftY(),R=this.getDownLeftY();this.upLine.setY1(q),this.downLine.setY1(R)}},a.getUpLeftY=function(){return-(this.leftSpread/2)},a.getDownLeftY=function(){return this.leftSpread/2},a.setRightSpread=function(G){if(this.rightSpread=G,this.height=Math.max(this.leftSpread,this.rightSpread),this.isRendered()){const q=this.getUpRightY(),R=this.getDownRightY();this.upLine.setY2(q),this.downLine.setY2(R)}},a.getUpRightY=function(){return-(this.rightSpread/2)},a.getDownRightY=function(){return this.rightSpread/2},a.getWidth=function(){return this.width},a.getHeight=function(){return Math.max(this.rightSpread,this.leftSpread)},a.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},a.isRendered=function(){return this.group!==null},a.bindToParent=function(){this.parentGroup.append(this.group)},a.move=function(){this.posX!==null&&this.posY!==null&&this.group.attr("transform",`translate(${this.posX} ${this.posY})`)},a.setPosX=function(G){this.posX=G},a.setPosY=function(G){this.posY=G};const h=P;var d=r(723631),l=r(612040),m=r(568357);const x="adagio-wedge-uuid",S=function(){this.init()};S.cssClass="wedge";const T=S.prototype;T.cssClass=S.cssClass,T.init=function(){this.leftAnchor=null,this.rightAnchor=null,this.wedgeLines=null,this.drawingContext=null,this.staffData=null,this.parent=null,this.group=null,this.needDrawUpdate=!0,this.drawn=!1},T.setParent=function(G){this.parent=G},T.setCssClass=function(G){this.cssClass=G},T.setStaffData=function(G){this.staffData=G},T.setLeftAnchor=function(G){this.hasLeftAnchor()&&this.leftAnchor!==G&&this.removeLeftAnchor(),this.leftAnchor=G,this.leftAnchor.wedge=this},T.hasLeftAnchor=function(){return this.leftAnchor!==null},T.removeLeftAnchor=function(){this.hide(),this.leftAnchor.wedge=null,this.leftAnchor=null},T.setRightAnchor=function(G){this.hasRightAnchor()&&this.rightAnchor!==G&&this.removeRightAnchor(),this.rightAnchor=G,this.rightAnchor.wedge=this},T.hasRightAnchor=function(){return this.rightAnchor!==null},T.removeRightAnchor=function(){this.hide(),this.rightAnchor.wedge=null,this.rightAnchor=null},T.hide=function(){this.drawn&&this.unbindFromParent()},T.setDrawingContext=function(G){this.drawingContext=G,this.isRendered()&&this.wedgeLines.setDrawingContext(G)},T.updateLinesHorizontal=function(){const G=this.getLeftAnchor(),q=G.getX(),R=this.spreadTypeToY(G.getSpreadType()),p=this.getRightAnchor(),b=p.getX(),v=this.spreadTypeToY(p.getSpreadType()),B=b-q;this.wedgeLines.setWidth(B),this.wedgeLines.setLeftSpread(R),this.wedgeLines.setRightSpread(v),this.wedgeLines.setPosX(q),this.needDrawUpdate=!1},T.isAbove=function(){return this.getPlacement()===d.A.ABOVE},T.isBelow=function(){return this.getPlacement()===d.A.BELOW},T.getPlacement=function(){return this.getLeftAnchor().getPlacement()},T.spreadTypeToY=function(G){if(G===A.A.OPEN)return this.drawingContext.getHairpinOpenSpread();if(G===A.A.OPEN_CONTINUE)return this.drawingContext.getHairpinOpenContinueSpread();if(G===A.A.CLOSED)return this.drawingContext.getHairpinCloseSpread();if(G===A.A.CLOSED_CONTINUE)return this.drawingContext.getHairpinCloseContinueSpread();A.A.raiseError(G)},T.updateLinesVertical=function(){const G=this.getY();this.wedgeLines.setPosY(G)},T.getY=function(){return this.getLeftAnchor().getY()},T.getLeftAnchor=function(){return this.leftAnchor},T.getRightAnchor=function(){return this.rightAnchor},T.setNeedDrawUpdate=function(){this.needDrawUpdate=!0},T.updateHorizontalDisplay=function(){this.isRendered()||this.render(),this.needDrawUpdate&&this.updateLinesHorizontal(),this.wedgeLines.draw(),this.bindToParent()},T.updateVerticalDisplay=function(){this.isRendered()||this.render(),this.updateLinesVertical(),this.wedgeLines.draw(),this.bindToParent()},T.draw=function(){this.isRendered()||this.render(),this.updateLinesVertical(),this.updateLinesHorizontal(),this.wedgeLines.draw(),this.bindToParent()},T.isRendered=function(){return this.group!==null},T.render=function(){this.group=new w.A("g");const G=this.getCssClasses();this.group.attr("class",G),this.wedgeLines=new h,this.wedgeLines.setParent(this.group),this.wedgeLines.setDrawingContext(this.drawingContext);const q=this.leftAnchor.getWedgeUuid();this.group.setDataEntry(x,q)},T.getCssClasses=function(){const G=[this.cssClass];return this.leftAnchor.getLocation()===l.A.LEFT&&G.push(m.A.START),this.rightAnchor.getLocation()===l.A.RIGHT&&G.push(m.A.STOP),G.join(" ")},T.bindToParent=function(){this.parent!==null&&!this.drawn&&(this.parent.append(this.getGroup()),this.drawn=!0)},T.getGroup=function(){return this.group},T.erase=function(){this.hide(),this.hasLeftAnchor()&&this.removeLeftAnchor(),this.hasRightAnchor()&&this.removeRightAnchor()},T.unbindFromParent=function(){this.group.removeFromParent(),this.drawn=!1},T.isComplete=function(){return this.hasLeftAnchor()&&this.hasRightAnchor()},T.getGroup=function(){return this.group},T.getLeftMeasureIdx=function(){return this.getLeftAnchor().getMeasureIdx()},T.getRightMeasureIdx=function(){return this.getRightAnchor().getMeasureIdx()};const Y=S},794165:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(269352);const w=function(){this.init()},f=w.prototype;f.cssClass="slide",f.init=function(){this.drawingContext=null,this.parent=null,this.line=null,this.posX1=null,this.posY1=null,this.posX2=null,this.posY2=null},f.setDrawingContext=function(a){this.drawingContext=a},f.setParent=function(a){this.parent=a},f.setPosY1=function(a){this.posY1=a},f.setPosX1=function(a){this.posX1=a},f.setPosX2=function(a){this.posX2=a},f.setPosY2=function(a){this.posY2=a},f.needRender=function(){return this.line===null},f.render=function(){this.line=new A.A("line"),this.line.attr("class",this.cssClass)},f.draw=function(){this.needRender()&&this.render(),this.drawLine(),this.bindToParent()},f.update=function(){this.draw()},f.drawLine=function(){const a=this.posX1,h=this.posX2,d=this.posY1,l=this.posY2,m=this.drawingContext.getHairpinThickness();this.line.attr("x1",a).attr("x2",h).attr("y1",d).attr("y2",l).attr("stroke-width",m)},f.bindToParent=function(){this.parent!==null&&this.parent.append(this.line)};const P=w},800097:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});var A=r(189954);function w(P,a){return P.x*a.x+P.y*a.y}function f(P,a){const h=(0,A.A)(P),d=(0,A.A)(a);return w(P,a)/(h*d)}},801370:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Ot});var A=r(364842),w=r(607801),f=r(15049),P=r(737903),a=r(210888),h=r(522117),d=r(726042),l=r(701387),m=r(54949),x=r(411993),S=r(843678),T=r(123491),Y=r(377180),G=r(351277),q=r(345912),R=r(886766),p=r(372585),b=r(773948);const v={};v.canShape=function(ot){return B(ot)};const B=function(ot){const rt=l.default.getNbStaves(ot);for(let at=0;at<rt;at++){const _t=st(ot,at),qt=l.default.getOctaveShifts(ot,at);if(_t!==null||qt.length>0)return!0}return!1};v.shapeMeasure=function(ot){const rt=l.default.getNotes(ot),at=m.A.groupStaves(rt);S.default.forEach(at,C,ot)};const C=function(ot,rt){ot=d.default.intPart(ot);const at=this,_t=x.A.groupVoices(rt),qt=st(at,ot),ue=l.default.getOctaveShifts(at,ot);S.default.forEach(_t,_,{leftOctaveShift:qt,octaveShifts:ue})},_=function(ot,rt){const at=this.leftOctaveShift,_t=this.octaveShifts;let qt=0,ue;rt.forEach(function(ne){T.default.isChord(ne)||(ue=(0,R.A)(at,_t,qt,!0)),ue&&T.default.hasPitch(ne)&&F(ne,ue),T.default.isChord(ne)||(qt+=T.default.getDuration(ne))})},st=function(ot,rt){return l.default.hasLeftOctaveShift(ot,rt)?l.default.getLeftOctaveShift(ot,rt):null},F=function(ot,rt){let at=T.default.getPitch(ot);const _t=L(rt),qt=Y.default.createDefault();Y.default.setOctaveChange(qt,_t),at=G.default.transpose(at,qt,!0),T.default.setPitch(ot,at)},L=function(ot){const rt=q.A.getSize(ot),at=q.A.getType(ot),_t=b.A.sizeToOctaveShift(rt);return at===p.A.DOWN?-_t:_t},I=v;var W=r(78750),V=r(721247);const it={};it.canShape=function(ot,rt){const at=l.default.getClef(ot)[0],_t=V.default.isPercussion(at);return rt.useShapeNotes===!0&&!_t},it.shapeMeasure=function(ot){let rt=l.default.getNotes(ot);rt=rt.filter(T.default.hasPitch),rt=rt.filter(Pt),rt.forEach(T.default.setIsShapeNote)};function Pt(ot){return!T.default.hasHead(ot)}const Yt=it;var Bt=r(561248),le=r(777345),ie=r(548830),K=r(383279),pe=r(546513),Ee=r(453557),tt=r(435648),Et=r(555172),Vt=r(269032);const fe=function(ot,rt){for(let at=rt-1;at>=0;at--)if(ot.hasJumpCall(at)){const _t=ot.getJumpCall(at);if(w.A.isJumpForward(_t))return _t}return null};var gt=r(280958),At=r(890439);const Ht={};Ht.createFullPartsDisplayed=function(ot){const rt={};for(let at=0;at<ot;at++)rt[at]=!0;return rt},Ht.createDispayedToDataMap=function(ot){const rt=At.Ay.toList(ot).map(d.default.intPart);return rt.sort(d.default.cmp),rt},Ht.createDataToDisplayedMap=function(ot){const rt={};return ot.forEach(Wt,rt),rt};const Wt=function(ot,rt){const at=this;at[ot]=rt};Ht.check=function(ot,rt){let at;if(!d.default.isInteger(ot)||ot<=0)throw at=new A.default("BadNbParts",`The number of parts [${ot}] is invalid.`),at.nbDataParts=ot,at;if(At.Ay.isEmpty(rt))throw new A.default("NoPartsDisplayed","There should be at least one displayed part.");for(const _t in rt){const qt=parseInt(_t,10);if(!d.default.isInteger(qt))throw at=new A.default("BadDataPartIdx",`The part index [${_t}] is invalid.`),at.dataPartIdx=_t,at;if(qt<0||qt>=ot)throw at=new A.default("BadDataPartIdx",`The part index [${qt}] does not match existing part.`),at.dataPartIdx=qt,at}};const k=Ht,St=function(ot,rt){this.init(ot,rt)},yt=St.prototype;yt.init=function(ot,rt){this.nbDataParts=ot,rt===null&&(rt=k.createFullPartsDisplayed(ot)),k.check(ot,rt),this.displayedToDataMap=k.createDispayedToDataMap(rt),this.dataToDisplayedMap=k.createDataToDisplayedMap(this.displayedToDataMap)},yt.isPartDisplayed=function(ot){return typeof this.dataToDisplayedMap[ot]!="undefined"},yt.dataToDisplayedIdx=function(ot){const rt=this.dataToDisplayedMap[ot];if(typeof rt=="number")return rt;{const at=`The data partIdx [${ot}] is not displayed.`,_t=new A.default("BadDataPartIdx",at);throw _t.dataPartIdx=ot,_t}},yt.displayedToDataIdx=function(ot){const rt=this.displayedToDataMap[ot];if(typeof rt=="number")return rt;{const at=`The displayed partIdx [${ot}] is invalid.`,_t=new A.default("BadDisplayPartIdx",at);throw _t.displayedPartIdx=ot,_t}},yt.getNbDisplayedParts=function(){return this.displayedToDataMap.length};const Ct=St;var Mt=r(61122),Tt=r(925368);const nt=function(ot,rt){this.init(ot,rt)},vt=nt.prototype;vt.init=function(ot,rt){this.scoreData=ot,this.dataId=a.default.generate(),this.pageOpts=rt,this.updated=!0,this.dataCache={},this.displayCache={},this.groups=null;const at=rt.partsDisplayed||null,_t=ot.getNbParts();this.partsProxy=new Ct(_t,at)},vt.stateDataChanged=function(){this.dataId=a.default.generate(),this.updated=!1,this.dataCache={},this.displayCache={},this.groups=null},vt.stateUpdated=function(){this.updated=!0},vt.assertUpdated=function(){if(!this.updated){const ot="The displayed is supposed to be updated when querying measure data.";throw new A.default("Unexpected",ot)}},vt.hasDataChangedSince=function(ot){return this.dataId!==ot},vt.getDataId=function(){return this.dataId},vt.getMeasureDisplayData=function(ot,rt){return typeof this.displayCache[ot]=="undefined"&&(this.displayCache[ot]={}),typeof this.displayCache[ot][rt]=="undefined"&&this.createMeasureDisplayData(ot,rt),this.displayCache[ot][rt]},vt.getPartStaffUuid=function(ot,rt){const at=this.displayedToDataPartIdx(ot);return this.scoreData.getPartStaffUuid(at,rt)},vt.getPartUuid=function(ot){const rt=this.displayedToDataPartIdx(ot);return this.scoreData.getPartUuid(rt)},vt.createMeasureDisplayData=function(ot,rt){const at=this.scoreData.getNbMeasures(),_t=this.scoreData.getCommonContent(),qt=_t.getDisplayedTime(rt),ue=Nt(_t,rt),ne=this.displayedToDataPartIdx(ot),be=this.scoreData.getPartStaffMapping(ne),oe=this.scoreData.getPartVoiceIdxToUUidMapping(ne),us=this.getMeasure(ot,rt),Q=this.scoreData.getMeasureUuid(rt),bt={partUuid:this.scoreData.getPartUuid(ne),measureUuid:Q,current:us,previous:null,next:null,nextJumpTag:null,ownTempo:null,rehearsal:null,ending:null,leftEnding:null,rightEnding:null,jumpTag:null,repeatTimes:null,jumpCall:null,tempoChanges:null,leftTempoChange:null,rightTempoChange:null,ownSwing:ue,displayedTime:qt,previousDisplayedTime:null,isFirstPart:ot===0,staffMapping:be,voiceIdxToUuidMapping:oe,systemBreak:null,pageBreak:null,nbMmr:null};if(rt>0&&(bt.previous=this.getMeasure(ot,rt-1),bt.previousDisplayedTime=_t.getDisplayedTime(rt-1)),rt<at-1&&(bt.next=this.getMeasure(ot,rt+1),_t.hasJumpTag(rt+1)&&(bt.nextJumpTag=_t.getJumpTag(rt+1))),_t.hasOwnTempo(rt)&&(bt.ownTempo=_t.getOwnTempo(rt)),_t.hasRehearsal(rt)&&(bt.rehearsal=Bt.A.copy(_t.getRehearsal(rt))),_t.hasEnding(rt)&&(bt.ending=_t.getEnding(rt),rt>0&&_t.hasEnding(rt-1)&&(bt.leftEnding=_t.getEnding(rt-1)),rt<at-1&&_t.hasEnding(rt+1)&&(bt.rightEnding=_t.getEnding(rt+1))),_t.hasJumpTag(rt)&&(bt.jumpTag=_t.getJumpTag(rt)),l.default.hasRepeatBackward(us)){const ve=l.default.getRightBarline(us),Qt=Et.A.getRepeat(ve),ae=Vt.A.getTimes(Qt);ae>2&&(bt.repeatTimes=ae)}te(bt,rt,_t),_t.hasMultiMeasureRest(rt)&&(bt.nbMmr=_t.getMultiMeasureRest(rt)),_t.hasTempoChanges(rt)&&(bt.tempoChanges=_t.getTempoChanges(rt)),_t.hasLeftTempoChange(rt)&&(bt.leftTempoChange=_t.getLeftTempoChange(rt)),_t.hasRightTempoChange(rt)&&(bt.rightTempoChange=_t.getRightTempoChange(rt)),(!this.pageOpts.isResponsiveLayout||this.pageOpts.respectSystemBreaks)&&_t.hasSystemBreak(rt)&&(bt.systemBreak=_t.getSystemBreak(rt)),rt+1<at&&_t.hasSystemBreak(rt+1)&&(bt.nextSystemBreak=_t.getSystemBreak(rt+1)),_t.hasPageBreak(rt)&&(bt.pageBreak=_t.getPageBreak(rt)),rt+1<at&&_t.hasPageBreak(rt+1)&&(bt.nextPageBreak=_t.getPageBreak(rt+1)),this.hideEmptyParts()&&(bt.isEmpty=(0,Tt.A)(us)),this.displayCache[ot][rt]=bt},vt.hideEmptyParts=function(){return this.pageOpts.hideEmptyParts===f.A.ALL_SYSTEMS||this.pageOpts.hideEmptyParts===f.A.AFTER_FIRST_SYSTEM};function Nt(ot,rt){if(!ot.hasOwnSwing(rt))return null;const at=ot.getOwnSwing(rt),_t=le.default.isSwinging(at);return rt!==0||_t?_t:null}vt.dataToDisplayedPartIdx=function(ot){return this.partsProxy.dataToDisplayedIdx(ot)};const te=function(ot,rt,at){ot.formerJumpCall=null,at.hasJumpCall(rt)&&(ot.jumpCall=at.getJumpCall(rt),w.A.isJumpBackward(ot.jumpCall)&&(ot.formerJumpCall=fe(at,rt)))};vt.getMeasure=function(ot,rt){const at=this.displayedToDataPartIdx(ot);return typeof this.dataCache[at]=="undefined"&&(this.dataCache[at]={}),typeof this.dataCache[at][rt]=="undefined"&&this.createMeasure(at,rt),this.dataCache[at][rt]},vt.displayedToDataPartIdx=function(ot){return this.partsProxy.displayedToDataIdx(ot)},vt.createMeasure=function(ot,rt){let at=this.scoreData.getMeasure(ot,rt);at=(0,P.default)(at),gt.A.call({},at);const _t=this.scoreData.getPartHeader(ot);if(K.default.hasPitchRange(_t)){const qt=K.default.getPitchRange(_t);(0,Mt.A)(at,qt)}h.A.canShape(at)&&h.A.shapeMeasure(at,rt,this.scoreData.getCommonContent()),I.canShape(at)&&I.shapeMeasure(at),W.A.canShape(at)&&W.A.shapeMeasure(at,this.pageOpts),Yt.canShape(at,this.pageOpts)&&Yt.shapeMeasure(at),pe.A.canShape(at,this.pageOpts)&&pe.A.shapeMeasure(at,this.pageOpts),Ee.A.canShape(at)&&Ee.A.shapeMeasure(at),tt.A.canShape(at)&&tt.A.shapeMeasure(at),this.dataCache[ot][rt]=at},vt.getNbMeasures=function(){return this.scoreData.getNbMeasures()},vt.getPartsHeaders=function(){const ot=[],rt=this.getNbParts();for(let at=0;at<rt;at++){const _t=this.getPartHeader(at);ot.push(_t)}return ot},vt.getGroups=function(){if(this.groups===null){this.groups=[];const ot=this.scoreData.getPartsHeaders(),at=ie.A.getGroups(ot).map(_t=>{const qt=[];for(let ue=0;ue<_t.length;ue++){const ne=_t[ue];if(this.isPartDisplayed(ne)){const be=this.dataToDisplayedPartIdx(ne);qt.push(be)}}return qt});this.groups=at.filter(ee)}return this.groups};function ee(ot){return ot.length>=2}vt.getNbParts=function(){return this.partsProxy.getNbDisplayedParts()},vt.getCommonContent=function(){return this.scoreData.getCommonContent()},vt.getPartHeader=function(ot){const rt=this.displayedToDataPartIdx(ot);return this.scoreData.getPartHeader(rt)},vt.getPartStaffVoicesIndexes=function(ot,rt){const at=this.displayedToDataPartIdx(ot);return this.scoreData.getPartStaffVoicesIndexes(at,rt)},vt.getPartVoiceIdxToUUidMapping=function(ot){const rt=this.displayedToDataPartIdx(ot);return this.scoreData.getPartVoiceIdxToUUidMapping(rt)},vt.isPartDisplayed=function(ot){return this.partsProxy.isPartDisplayed(ot)};const Ot=nt},822605:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>m});var A=r(364842),w=r(123491);const f=function(x,S){return a().format(S)};let P=null;const a=function(){return P===null&&(P=new h),P},h=function(){},d=h.prototype;d.format=function(x){if(this.reset(),x.forEach(this.addNote,this),this.hasChord()&&this.closeChord(),this.hasGraces())throw new A.default("Unexpected","There are orphan graces in draw.");return this.entries},d.reset=function(){this.timePos=0,this.graces=[],this.entries=[],this.chord=null},d.addNote=function(x){!w.default.isChord(x)&&this.hasChord()&&this.closeChord(),this.addToChord(x)},d.closeChord=function(){this.isChordGrace()?this.addChordToGraces():this.addChordToNotes()},d.isChordGrace=function(){return w.default.isGraceNote(this.chord[0])},d.addChordToGraces=function(){this.graces.push(this.chord),this.chord=null},d.addChordToNotes=function(){const x={graces:this.graces,chordJson:this.chord,timePos:this.timePos};this.entries.push(x);const S=w.default.getDuration(this.chord[0]);this.timePos+=S,this.graces=[],this.chord=null},d.addToChord=function(x){const S=this.getChord();l(S,x),S.push(x)},d.getChord=function(){return this.hasChord()||(this.chord=[]),this.chord},d.hasChord=function(){return this.chord!==null};const l=function(x,S){if(x.length===0)return;const T=x[0],Y=w.default.isGraceNote(T),G=w.default.isGraceNote(S);if(Y!==G)throw new A.default("Unexpected","Cannot mix grace and non grace in a chord for display.")};d.hasGraces=function(){return this.graces.length>0};const m=f},825711:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>d});var A=r(726042);function w(l){const m=l.length,x=[],S=l[0];for(let T=1;T+1<m;T++){const Y=l[T],G=l[T+1],q=[S,Y,G];x.push(q)}return x}var f=r(148029),P=r(380725);const h=function(l){const m=(0,f.A)(l[0],l[1]),x=(0,f.A)(l[0],l[2]),S=(0,P.A)(m,x);return Math.abs(S)/2};function d(l){return l.length<=2?0:w(l).map(h).reduce(A.default.add)}},836252:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(269352),w=r(51342);const f="csymHalfDiminished",P=function(){this.init()};P.NAME="chord.diminished";const a=P.prototype;a.name=P.NAME,a.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},a.setParent=function(d){this.parent=d},a.setPosX=function(d){this.posX=d},a.setPosY=function(d){this.posY=d},a.setDrawingContext=function(d){this.drawingContext=d},a.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},a.render=function(){const d=this.getGlyph(),l=new A.A("path"),m=d.render();l.attr("d",m),l.attr("class",this.name),this.path=l},a.isRendered=function(){return this.path!==null},a.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const d=this.getYShift(),l=this.posY-d;this.path.attr("transform",`translate(${this.posX}, ${l})`)}},a.bindToParent=function(){this.parent.append(this.path)},a.getWidth=function(){return this.getGlyph().getWidth()},a.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},a.getSpaceAbove=function(){const d=this.getYShift();return-this.getGlyph().getBBoxNE().y+d},a.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*w.A.SUPSCRIPT_BASELINE},a.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},a.getGlyph=function(){if(this.glyph===null){const d=w.A.SMALL_FONT_SIZE*this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(f,d)}return this.glyph};const h=P},847857:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>P});var A=r(269352);const w=function(){this.init()},f=w.prototype;f.cssClass="glissando",f.glyphId="wiggleGlissando",f.init=function(){this.drawingContext=null,this.group=null,this.parent=null,this.wiggles=[],this.glyph=null,this.posX1=null,this.posY1=null,this.posX2=null,this.posY2=null},f.setDrawingContext=function(a){this.drawingContext=a},f.setParent=function(a){this.parent=a},f.setPosY1=function(a){this.posY1=a},f.setPosX1=function(a){this.posX1=a},f.setPosX2=function(a){this.posX2=a},f.setPosY2=function(a){this.posY2=a},f.getGlyph=function(){return this.glyph===null&&(this.glyph=this.drawingContext.getGlyph(this.glyphId)),this.glyph},f.getHeight=function(){return Math.abs(this.posY2-this.posY1)},f.getWidth=function(){const a=Math.pow(this.posX2-this.posX1,2),h=Math.pow(this.posY2-this.posY1,2);return Math.sqrt(a+h)},f.needRender=function(){return this.group===null},f.render=function(){this.group=new A.A("g"),this.group.attr("class",this.cssClass)},f.draw=function(){this.needRender()&&this.render(),this.drawPieces(),this.move(),this.bindToParent()},f.update=function(){this.draw()},f.drawPieces=function(){const a=this.getGlyph(),h=a.getWidth()-this.drawingContext.getGlissandoExcessWidth(),d=this.getWidth(),l=Math.floor(d/h);if(this.wiggles.length>l)this.wiggles.splice(l,this.wiggles.length-l).forEach(this.removeWiggle);else for(let m=this.wiggles.length;m<l;m++){const x=this.group.append("path");x.attr("d",a.render()),x.attr("transform",`translate(${m*h} 0)`),this.wiggles.push(x)}},f.getAngle=function(){return Math.atan2(this.posY2-this.posY1,this.posX2-this.posX1)*(180/Math.PI)},f.move=function(){const h=this.getGlyph().getWidth()-this.drawingContext.getGlissandoExcessWidth(),d=this.getWidth(),l=Math.floor(d/h)*h,m=this.posX1+(d-l)/2,x=this.posY1+this.drawingContext.getSpaceSize(),S=this.getAngle();this.group.attr("transform",`translate(${m} ${x}) rotate(${S})`)},f.bindToParent=function(){this.parent!==null&&this.parent.append(this.group)},f.removeWiggle=function(a){a.removeFromParent()};const P=w},850354:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>f});var A=r(364842);const w={C:"#F72D3F","C#":"#FA6D1E",D:"#FF9929","D#":"#FFC000",E:"#FFE100",F:"#77CA34","F#":"#00AF50",G:"#009688","G#":"#005cb2",A:"#673AB7","A#":"#AF5DFF",B:"#D843A1"};function f(P){const a=w[P];if(typeof a=="undefined"){const h=`The step value '${P}' is invalid.`;throw new A.default("Unexpected",h)}return a}},863426:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>a});var A=r(354093),w=r(269352);const f=function(h,d){this.init(h,d),this.line=null},P=f.prototype;P.defaultOptions={stroke_width:null,stroke_dasharray:[]},P.init=function(h,d){this.options=A.A.mergeOptions(this.defaultOptions,d),this.parent=h},P.getLine=function(){return this.line},P.render=function(h,d,l,m){return this.isRendered()?this:(this.x1=h,this.y1=d,this.x2=l,this.y2=m,this.line=new w.A("line").attr("x1",h).attr("y1",d).attr("x2",l).attr("y2",m).attr("stroke-width",this.options.stroke_width).attr("stroke-dasharray",this.options.stroke_dasharray),this)},P.getWidth=function(){return Math.abs(this.x1-this.x2)},P.setY2=function(h){this.y2=h,this.isRendered()&&this.line.attr("y2",h)},P.setY1=function(h){this.y1=h,this.isRendered()&&this.line.attr("y1",h)},P.setX1=function(h){this.x1=h,this.isRendered()&&this.line.attr("x1",h)},P.setX2=function(h){this.x2=h,this.isRendered()&&this.line.attr("x2",h)},P.isRendered=function(){return this.line!==null},P.draw=function(){this.parent.append(this.line)},P.getGroup=function(){return this.getLine()};const a=f},866205:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>x});var A=r(75861),w=r(760367),f=r(141624),P=r(538783);const a=function(){this.init()},h=a.prototype;h.init=function(){this.lines=[],this.ties={}},h.setLeftNote=function(S){this.leftNote=S},h.setRightNote=function(S){this.rightNote=S},h.fillData=function(){this.extractTies(),this.fillPlacement(),this.fillAllExternals(),this.fillLeftTieColliding(),this.fillRightTieColliding(),this.fillLeftSideShift(),this.fillRightSideShift()},h.extractTies=function(){this.lines=this.leftNote.getTieStarts().slice();const S=this.rightNote.getTieStops().slice();d(this.lines,S),this.lines.forEach(function(T,Y){const G=S[Y];this.addTie(T,G)},this)};const d=function(S,T){const Y=S.length-T.length;Y>0?S.splice(0,Y):Y<0&&T.splice(0,Y)};h.addTie=function(S,T){const Y={line:S,rightLine:T,rightSide:{},leftSide:{},staffData:this.leftNote.getStaffData()};this.ties[S]=Y},h.fillPlacement=function(){this.isChord()?this.fillChordPlacement():this.fillSingleNotePlacement(),this.leftNote.getTieStartsDirections().forEach((T,Y)=>{const G=this.lines[Y],q=this.ties[G];T===w.A.FLIPPED&&(q.placement=l(q.placement))})};function l(S){if(S===f.A.ABOVE)return f.A.BELOW;if(S===f.A.BELOW)return f.A.ABOVE;f.A.raiseError(S)}h.isChord=function(){return this.lines.length>1},h.fillSingleNotePlacement=function(){const S=this.ties[this.lines[0]],T=this.leftNote.getStemStrategy();T===P.A.UP?S.placement=f.A.ABOVE:T===P.A.DOWN||T===P.A.UP_UNPITCHED?S.placement=f.A.BELOW:T===P.A.DOWN_UNPITCHED?S.placement=f.A.ABOVE:this.hasSameStemDirection()?this.leftNote.getStemValue()===A.A.UP?S.placement="below":S.placement="above":S.line>=3?S.placement="above":S.placement="below"},h.hasSameStemDirection=function(){return this.leftNote.getStemValue()===this.rightNote.getStemValue()},h.fillChordPlacement=function(){const S=this.getHighestTie(),T=this.getLowestTie();S.placement="above",T.placement="below",this.getInternalLines().forEach(function(G){const q=this.ties[G];G>=3?q.placement="above":q.placement="below"},this)},h.fillAllExternals=function(){const S=this.getHighestLine();if(this.fillExternal(S),this.isChord()){const T=this.getLowestLine();this.fillExternal(T),this.getInternalLines().forEach(this.setNotExternal,this)}},h.fillExternal=function(S){const T=this.ties[S],Y=T.placement,G=m(this.leftNote,S,Y),q=m(this.rightNote,S,Y);T.isExternal=G&&q};const m=function(S,T,Y){return Y==="above"?S.isHighestLine(T):S.isLowestLine(T)};h.getInternalLines=function(){return this.lines.slice(1,-1)},h.setNotExternal=function(S){const T=this.ties[S];T.isExternal=!1},h.fillLeftTieColliding=function(){const S=this.getHighestTie(),T=this.leftNote.hasStem()&&this.leftNote.getStemValue()===A.A.UP&&S.placement==="above";S.leftSide.stemColliding=T},h.getHighestTie=function(){const S=this.getHighestLine();return this.ties[S]},h.fillRightTieColliding=function(){const S=this.getLowestTie(),T=this.rightNote.hasStem()&&this.rightNote.getStemValue()===A.A.DOWN&&S.placement==="below";S.rightSide.stemColliding=T},h.getLowestTie=function(){const S=this.getLowestLine();return this.ties[S]},h.getHighestLine=function(){return this.lines[0]},h.getLowestLine=function(){return this.lines[this.lines.length-1]},h.fillLeftSideShift=function(){this.fillShift(this.leftNote,function(S){return S.leftSide})},h.fillRightSideShift=function(){this.fillShift(this.rightNote,function(S){return S.rightSide})},h.fillShift=function(S,T){this.lines.forEach(function(Y){const G=this.ties[Y],q=T(G),R=S.getStemValue();R===A.A.UP&&S.isSecondHigher(Y)?q.shiftRight=!0:R===A.A.DOWN&&S.isSecondLower(Y)&&(q.shiftLeft=!0)},this)},h.forEachTie=function(S,T){this.lines.forEach(function(Y,G){const q=this.ties[Y];S.call(T,q,G)},this)};const x=a},900576:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>w});const A={};A.copy=function(f){return A.create(f.measureIdx,f.voiceIdx,f.noteIdx)},A.create=function(f,P,a){return{measureIdx:f,voiceIdx:P,noteIdx:a}},A.isGreaterOrEqual=function(f,P){return A.isEqual(f,P)||A.isGreater(f,P)},A.isEqual=function(f,P){return f.measureIdx===P.measureIdx&&f.noteIdx===P.noteIdx},A.isGreater=function(f,P){const a=f.measureIdx-P.measureIdx;return a>0?!0:a<0?!1:f.noteIdx-P.noteIdx>0},A.isLower=function(f,P){const a=f.measureIdx-P.measureIdx;return a<0?!0:a>0?!1:f.noteIdx-P.noteIdx<0};const w=A},903828:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>Gi});const A=function(D){this.init(D)},w=A.prototype;w.init=function(D){this.verticalData=D,this.reset()},w.reset=function(){this.upLimitY=null,this.metronomeY=null,this.endingY=null,this.upDynamicsY=null,this.downDynamicsY=null,this.downPedalsY=null,this.upOctaveShiftsY=null,this.downOctaveShiftsY=null,this.upPluckedRangesY=null,this.downPluckedRangesY=null,this.upWordY=null,this.downWordY=null,this.upTempoChangesY=null,this.downTempoChangesY=null,this.chordsY=null,this.lyricsY=null,this.figuredBassY=null,this.classicChordY=null,this.downLimitY=null},w.getHeight=function(){const D=this.getSpaceAboveStaff(),pt=this.getDownLimitY();return D+pt},w.getSpaceAboveStaff=function(){return-this.getUpLimitY()},w.getSpaceBelowStaff=function(){return this.getDownLimitY()-this.verticalData.staffHeight},w.setUpLimitY=function(D){this.upLimitY=D},w.getUpLimitY=function(){if(this.upLimitY!==null)return this.upLimitY;{let D=0;const pt=this.getMetronomeY()-this.verticalData.metronomeHeight;D=Math.min(D,pt);const Dt=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;D=Math.min(D,Dt);const Oe=this.getJumpCallY()-this.verticalData.jumpCallHeight;return D=Math.min(D,Oe),D}},w.getMetronomeY=function(){if(this.metronomeY!==null)return this.metronomeY;let D=0;const pt=this.getRehearsalY()-this.verticalData.rehearsalHeight;if(D=Math.min(D,pt),this.verticalData.metronomeHeight===0)return pt;if(this.isMetronomeOverNotes()){const Dt=this.getJumpCallY()-this.verticalData.jumpCallHeight;D=Math.min(D,Dt)}return D},w.setMetronomeY=function(D){this.metronomeY=D},w.isMetronomeOverNotes=function(){return this.verticalData.metronomeRightX>this.verticalData.notesLeftX},w.getRehearsalY=function(){let D=0;const pt=this.getJumpTagY()-this.verticalData.jumpTagHeight;if(D=Math.min(D,pt),this.verticalData.rehearsalHeight===0)return D;if(this.isRehearsalOverNotes()){const Dt=this.getJumpCallY()-this.verticalData.jumpCallHeight;D=Math.min(D,Dt)}return D-this.verticalData.rehearsalMargin},w.isRehearsalOverNotes=function(){return this.verticalData.rehearsalRightX>this.verticalData.notesLeftX},w.getJumpCallY=function(){let D=-this.verticalData.rightUpAttributesOverflow;const pt=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;if(D=Math.min(D,pt),this.verticalData.jumpCallHeight===0)return D;if(this.verticalData.endingHeight>0){const Dt=this.getEndingY()-this.verticalData.endingHeight;D=Math.min(D,Dt)}return D-this.verticalData.jumpCallMargin},w.getJumpTagY=function(){let D=0;const pt=this.getEndingY()-this.verticalData.endingHeight;if(D=Math.min(D,pt),this.verticalData.jumpHeight===0)return D;if(this.isJumpOverNotes()||this.verticalData.jumpCallHeight>0){const Dt=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;D=Math.min(D,Dt)}return D-this.verticalData.jumpTagMargin},w.isJumpOverNotes=function(){return this.verticalData.jumpRightX>this.verticalData.notesLeftX},w.setEndingY=function(D){this.endingY=D},w.getEndingY=function(){if(this.endingY!==null)return this.endingY;{let D=0;const pt=this.getMeasureNumberY()-this.verticalData.measureNumberHeight;if(D=Math.min(D,pt),this.verticalData.endingHeight>0){const Dt=this.getUpTempoChangesY()-this.verticalData.upTempoChangesHeight;D=Math.min(D,Dt)}return D}},w.setUpTempoChangesY=function(D){this.upTempoChangesY=D},w.getUpTempoChangesY=function(){if(this.upTempoChangesY!==null)return this.upTempoChangesY;{let D=-this.verticalData.upTempoChangesMargin;const pt=this.getChordsY()-this.verticalData.chordsHeight-this.verticalData.upTempoChangesMargin;return D=Math.min(D,pt),D}},w.setChordsY=function(D){this.chordsY=D},w.getChordsY=function(){if(this.chordsY!==null)return this.chordsY;{const D=this.getUpWordY(),pt=this.verticalData.upWordHeight;return D-pt}},w.setUpWordY=function(D){this.upWordY=D},w.getUpWordY=function(){if(this.upWordY!==null)return this.upWordY;{const D=this.getUpPluckedRangesY(),pt=this.verticalData.upPluckedRangesHeight;let Dt=D-pt;const Oe=-this.verticalData.rightUpAttributesOverflow;if(Dt=Math.min(Dt,Oe),this.verticalData.upWordContinued){const Ge=this.getMeasureNumberY()-this.verticalData.measureNumberHeight;Dt=Math.min(Dt,Ge)}return Dt}},w.setUpPluckedRangesY=function(D){this.upPluckedRangesY=D},w.getUpPluckedRangesY=function(){if(this.upPluckedRangesY!==null)return this.upPluckedRangesY;{const D=this.getUpOctaveShiftsY(),pt=this.verticalData.upOctaveShiftsHeight,Dt=this.verticalData.upPluckedRangeSpaceBelow;return D-(pt+Dt)}},w.setUpOctaveShiftsY=function(D){this.upOctaveShiftsY=D},w.getUpOctaveShiftsY=function(){if(this.upOctaveShiftsY!==null)return this.upOctaveShiftsY;{const D=this.getUpMuteY(),pt=this.verticalData.upMuteHeight,Dt=this.verticalData.upOctaveShiftsMargin;return D-(pt+Dt)}},w.getUpMuteY=function(){const D=this.getUpPizzicatoY(),pt=this.verticalData.upPizzicatoHeight;return D-pt},w.getUpPizzicatoY=function(){const D=this.getUpDynamicsY(),pt=this.verticalData.upDynamicsHeight;return D-pt},w.setUpDynamicsY=function(D){this.upDynamicsY=D},w.getUpDynamicsY=function(){if(this.upDynamicsY!==null)return this.upDynamicsY;{let D=this.getRepeatTimesY()-this.verticalData.repeatTimesHeight;if(this.verticalData.measureNumberHeight>0&&this.isMeasureNumberOverNotes()){const pt=this.getMeasureNumberY()-this.verticalData.measureNumberHeight;D=Math.min(D,pt)}return D-this.verticalData.upDynamicsMargin}},w.getMeasureNumberY=function(){let D=0;const pt=-this.verticalData.upAttributesOverflow;if(D=Math.min(D,pt),this.verticalData.measureNumberHeight===0)return D;if(this.isMeasureNumberOverNotes()){const Dt=this.verticalData.notesUpOverflow;D=Math.min(D,-Dt)}return D-this.verticalData.measureNumberMargin},w.isMeasureNumberOverNotes=function(){return this.verticalData.notesLeftX===0},w.getRepeatTimesY=function(){const D=-this.verticalData.rightUpAttributesOverflow,pt=-this.verticalData.notesUpOverflow;let Dt=Math.min(D,pt);return Dt-=this.verticalData.repeatTimesMargin,Dt},w.getNotesUpOverflow=function(){return this.verticalData.notesUpOverflow},w.setDownLimitY=function(D){this.downLimitY=D},w.getDownLimitY=function(){if(this.downLimitY!==null)return this.downLimitY;{const D=this.getClassicChordY(),pt=this.verticalData.classicChordSpaceBelow,Dt=this.getDownAttributesY();return Math.max(D+pt,Dt)}},w.setClassicChordY=function(D){this.classicChordY=D},w.getClassicChordY=function(){if(this.classicChordY!==null)return this.classicChordY;{const D=this.getFiguredBassY(),pt=this.verticalData.figuredBassSpaceBelow,Dt=this.verticalData.classicChordSpaceAbove;return D+pt+Dt}},w.setFiguredBassY=function(D){this.figuredBassY=D},w.getFiguredBassY=function(){if(this.figuredBassY!==null)return this.figuredBassY;{const D=this.getLyricsY(),pt=this.verticalData.lyricsHeight,Dt=this.verticalData.figuredBassSpaceAbove;return D+pt+Dt}},w.setLyricsY=function(D){this.lyricsY=D},w.getLyricsY=function(){if(this.lyricsY!==null)return this.lyricsY;{const D=this.getDownWordY(),pt=this.verticalData.downWordHeight,Dt=this.verticalData.lyricsMargin;return D+pt+Dt}},w.setDownWordY=function(D){this.downWordY=D},w.getDownWordY=function(){if(this.downWordY!==null)return this.downWordY;{const D=this.getDownPluckedRangesY(),pt=this.verticalData.downPluckedRangesHeight;let Dt=D+pt;const Oe=this.getRightDownAttributesY();if(Dt=Math.max(Dt,Oe),this.verticalData.downWordContinued){const Ge=this.getDownAttributesY();Dt=Math.max(Dt,Ge)}return Dt}},w.setDownPluckedRangesY=function(D){this.downPluckedRangesY=D},w.getDownPluckedRangesY=function(){if(this.downPluckedRangesY!==null)return this.downPluckedRangesY;{const D=this.getDownOctaveShiftsY(),pt=this.verticalData.downOctaveShiftsHeight;return D+pt}},w.setDownOctaveShiftsY=function(D){this.downOctaveShiftsY=D},w.getDownOctaveShiftsY=function(){if(this.downOctaveShiftsY!==null)return this.downOctaveShiftsY;{const D=this.getDownMuteY(),pt=this.verticalData.downMuteHeight,Dt=this.verticalData.downOctaveShiftsMargin;return D+pt+Dt}},w.getDownMuteY=function(){const D=this.getDownPizzicatoY(),pt=this.verticalData.downPizzicatoHeight;return D+pt},w.getDownPizzicatoY=function(){const D=this.getDownPedalsY(),pt=this.verticalData.downPedalsHeight;return D+pt},w.getDownPedalsHeight=function(){return this.verticalData.downPedalsHeight},w.setDownPedalsY=function(D){this.downPedalsY=D},w.getDownPedalsY=function(){if(this.downPedalsY!==null)return this.downPedalsY;{const D=this.getDownDynamicsY(),pt=this.verticalData.downDynamicsHeight,Dt=this.verticalData.downPedalsMargin;return D+pt+Dt}},w.setDownDynamicsY=function(D){this.downDynamicsY=D},w.getDownDynamicsY=function(){if(this.downDynamicsY!==null)return this.downDynamicsY;{const D=this.getDownTempoChangesY(),pt=this.verticalData.downTempoChangesHeight,Dt=this.verticalData.downDynamicsMargin;return D+pt+Dt}},w.setDownTempoChangesY=function(D){this.downTempoChangesY=D},w.getDownAttributesY=function(){const pt=this.verticalData.staffHeight,Dt=this.verticalData.downAttributesOverflow;return 0+pt+Dt},w.getRightDownAttributesY=function(){const pt=this.verticalData.staffHeight,Dt=this.verticalData.rightDownAttributesOverflow;return 0+pt+Dt},w.getDownTempoChangesY=function(){if(this.downTempoChangesY!==null)return this.downTempoChangesY;{const pt=this.verticalData.staffHeight,Dt=this.verticalData.notesDownOverflow,Oe=this.verticalData.downTempoChangesMargin;return 0+pt+Dt+Oe}},w.hasLyrics=function(){return this.lyricsY!==null},w.getNotesDownOverflow=function(){return this.verticalData.notesDownOverflow};const f=A,P=function(D,pt){D=D.filter(d),D.forEach(a,pt)},a=function(D){const pt=this,Dt=D.getLeftMeasureIdx(),Oe=D.getRightMeasureIdx(),Ge=D.getUpOverflow();for(let si=Dt;si<=Oe;si++){const Ei=pt[si];h(Ei,Ge)}},h=function(D,pt){const Dt=D.verticalData.notesUpOverflow;D.verticalData.notesUpOverflow=Math.max(Dt,pt)},d=function(D){return D.isAbove()},l=P,m=function(D,pt){D=D.filter(T),D.forEach(x,pt)},x=function(D){const pt=this,Dt=D.getLeftMeasureIdx(),Oe=D.getRightMeasureIdx(),Ge=D.getDownOverflow();for(let si=Dt;si<=Oe;si++){const Ei=pt[si];S(Ei,Ge)}},S=function(D,pt){const Dt=D.verticalData.notesDownOverflow;D.verticalData.notesDownOverflow=Math.max(Dt,pt)},T=function(D){return D.isBelow()},Y=m;var G=r(726042);const q=function(D){if(D=D.filter(R),D.length===0)return;const Dt=D.map(p).reduce(G.default.min2);D.forEach(b,Dt)};function R(D){return D!==null&&D.verticalData.upDynamicsHeight!==0}const p=function(D){return D.getUpDynamicsY()},b=function(D){const pt=parseFloat(this);D.setUpDynamicsY(pt)},v=q,B=function(D){if(D=D.filter(C),D.length===0)return;const Dt=D.map(_).reduce(G.default.max2);D.forEach(st,Dt)};function C(D){return D!==null&&D.verticalData.downDynamicsHeight!==0}const _=function(D){return D.getDownDynamicsY()},st=function(D){const pt=parseFloat(this);D.setDownDynamicsY(pt)},F=B,L=function(D){if(D=D.filter(I),D.length>0){const Dt=D.map(W).reduce(G.default.max2);D.forEach(V,Dt)}},I=function(D){return D!==null&&D.verticalData.lyricsHeight>0},W=function(D){return D.getLyricsY()},V=function(D){const pt=parseFloat(this);D.setLyricsY(pt)},it=L,Pt=function(D){if(D=D.filter(Yt),D.length>0){const Dt=D.map(Bt).reduce(G.default.min2);D.forEach(le,Dt)}},Yt=function(D){return D!==null&&D.verticalData.endingHeight>0},Bt=function(D){return D.getEndingY()},le=function(D){const pt=parseFloat(this);D.setEndingY(pt)},ie=Pt,K=function(D){if(D=D.filter(pe),D.length>0){const Dt=D.map(Ee).reduce(G.default.min2);D.forEach(tt,Dt)}},pe=function(D){return D!==null&&D.verticalData.upOctaveShiftsHeight>0},Ee=function(D){return D.getUpOctaveShiftsY()},tt=function(D){const pt=parseFloat(this);D.setUpOctaveShiftsY(pt)},Et=K,Vt=function(D){if(D=D.filter(ct),D.length>0){const Dt=D.map(fe).reduce(G.default.max2);D.forEach(gt,Dt)}},ct=function(D){return D!==null&&D.verticalData.downOctaveShiftsHeight>0},fe=function(D){return D.getDownOctaveShiftsY()},gt=function(D){const pt=parseFloat(this);D.setDownOctaveShiftsY(pt)},At=Vt,Ht=function(D){if(D=D.filter(Wt),D.length>0){const Dt=D.map(k).reduce(G.default.max2);D.forEach(St,Dt)}},Wt=function(D){return D!==null&&D.verticalData.downPluckedRangeHeight>0},k=function(D){return D.getDownPluckedRangeY()},St=function(D){const pt=parseFloat(this);D.setDownPluckedRangeY(pt)},yt=Ht,Ct=function(D){if(D=D.filter(Mt),D.length>0){const Dt=D.map(Tt).reduce(G.default.min2);D.forEach(nt,Dt)}},Mt=function(D){return D!==null&&D.verticalData.upPluckedRangeHeight>0},Tt=function(D){return D.getUpPluckedRangeY()},nt=function(D){const pt=parseFloat(this);D.setUpPluckedRangeY(pt)},vt=Ct,Nt=function(D){if(D=D.filter(te),D.length>0){const Dt=D.map(ee).reduce(G.default.min2);D.forEach(Ot,Dt)}},te=function(D){return D!==null&&D.verticalData.upWordHeight>0},ee=function(D){return D.getUpWordY()},Ot=function(D){const pt=parseFloat(this);D.setUpWordY(pt)},ot=Nt,rt=function(D){if(D=D.filter(at),D.length>0){const Dt=D.map(_t).reduce(G.default.max2);D.forEach(qt,Dt)}},at=function(D){return D!==null&&D.verticalData.downWordHeight>0},_t=function(D){return D.getDownWordY()},qt=function(D){const pt=parseFloat(this);D.setDownWordY(pt)},ue=rt,ne=function(D){if(D=D.filter(be),D.length>0){const Dt=D.map(oe).reduce(G.default.min2);D.forEach(us,Dt)}},be=function(D){return D!==null&&D.verticalData.chordsHeight>0},oe=function(D){return D.getChordsY()},us=function(D){const pt=parseFloat(this);D.setChordsY(pt)},Q=ne,Xt=function(D){if(D=D.filter(bt),D.length>0){const Dt=D.map(ve).reduce(G.default.max2);D.forEach(Qt,Dt)}},bt=function(D){return D!==null&&D.verticalData.classicChordSpaceAbove>0},ve=function(D){return D.getClassicChordY()},Qt=function(D){const pt=parseFloat(this);D.setClassicChordY(pt)},ae=Xt,fs=function(D){if(D=D.filter(ds),D.length>0){const Dt=D.map(Xe).reduce(G.default.max2);D.forEach(U,Dt)}},ds=function(D){return D!==null&&D.verticalData.figuredBassSpaceAbove>0},Xe=function(D){return D.getFiguredBassY()},U=function(D){const pt=parseFloat(this);D.setFiguredBassY(pt)},Gt=fs,It=function(D){if(D=D.filter(xt),D.length>0){const Dt=D.map(zt).reduce(G.default.min2);D.forEach(Ne,Dt)}},xt=function(D){return D!==null&&D.verticalData.upTempoChangesHeight>0},zt=function(D){return D.getUpTempoChangesY()},Ne=function(D){const pt=parseFloat(this);D.setUpTempoChangesY(pt)},pi=It,Os=function(D){if(D=D.filter(on),D.length>0){const Dt=D.map(Fi).reduce(G.default.min2);D.forEach(Wi,Dt)}},on=function(D){return D!==null&&D.verticalData.metronomeHeight>0},Fi=function(D){return D.getMetronomeY()},Wi=function(D){const pt=parseFloat(this);D.setMetronomeY(pt)},$i=Os,rn=function(D,pt){const Dt=D.map(ss);Dt.push(pt);const Oe=Dt.reduce(G.default.min2);D.forEach(vi,Oe)},ss=function(D){return D.getUpLimitY()},vi=function(D){const pt=parseFloat(this);D.setUpLimitY(pt)},Ki=rn,is=function(D,pt){const Dt=D.map(bn);Dt.push(pt);const Oe=Dt.reduce(G.default.max2);D.forEach(Mn,Oe)},bn=function(D){return D.getDownLimitY()},Mn=function(D){const pt=parseFloat(this);D.setDownLimitY(pt)},pn=is,ai=function(D){if(D=D.filter(Ys),D.length>0){const Dt=D.map(Ti).reduce(G.default.max2);D.forEach(ji,Dt)}},Ys=function(D){return D!==null&&D.verticalData.downPedalsHeight>0},Ti=function(D){return D.getDownPedalsY()},ji=function(D){const pt=parseFloat(this);D.setDownPedalsY(pt)},Me=ai,an=function(D,pt,Dt){l(Dt,D),Y(Dt,D),v(D),F(D),Me(D),it(D),Et(D),At(D),vt(D),yt(D),ot(D),ue(D),Q(D),Gt(D),ae(D),pi(D),ie(D),$i(D);const Oe=D.filter(Rn);Qi(Oe),We(Oe)};function Rn(D){return D!==null}const Qi=function(D){Ki(D,0)},We=function(D){const Dt=D[0].verticalData.staffHeight;pn(D,Dt)},Re=an;var Ji=r(364842);function mn(D,pt){D.forEach(Li,pt)}function Li(D,pt,Dt){if(!D.isInDisplayedRange())return;const Oe=this;D.tickableContent.words.forEach(Ge=>{const si=D.getWidth();let gs=D.tickableContent.getXPos()+Ge.xPos+Ge.getWidth()-si;for(;gs>=0;){if(pt++,pt>=Dt.length)return;const Ui=Oe[pt];if(Ui===null)return;const bi=D.drawingContext.getWordHeight();if(Ge.isAbove())Ui.verticalData.upWordHeight=bi,Ui.verticalData.upWordContinued=!0;else if(Ge.isBelow())Ui.verticalData.downWordHeight=bi,Ui.verticalData.downWordContinued=!0;else throw new Ji.default("InvalidPlacement");const os=Dt[pt].getWidth();gs-=os}})}function Gi(D,pt,Dt){const Oe=D.map(re);return mn(D,Oe),Re(Oe,pt,Dt),Oe}function re(D){if(!D.isInDisplayedRange())return null;const pt=D.getVerticalData();return new f(pt)}},918705:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});var A=r(364842),w=r(891959),f=r(377072),P=r(701933);const a=function(m,x){this.init(m,x)},h=a.prototype;h.init=function(m,x){this.policyType=m,this.hasPickup=x},h.shouldDisplay=function(m,x,S){if(x===P.A.OTHER)return!1;if(this.policyType===w.A.EVERY)return this.shouldDisplayEvery(m);if(this.policyType===w.A.FIRST_OF_SYSTEM)return this.shouldDisplayFirstOfSystem(m,S);if(this.policyType===w.A.NONE)return!1;w.A.raiseError(this.policyType)},h.shouldDisplayEvery=function(m){if(m===f.A.FIRST_OF_SCORE)return!1;if(m===f.A.FIRST_OF_LINE||m===f.A.OTHER)return!0;d(m)},h.shouldDisplayFirstOfSystem=function(m,x){if(m===f.A.FIRST_OF_LINE)return!0;if(m===f.A.FIRST_OF_SCORE)return!1;if(m===f.A.OTHER)return this.isAfterPickup(x);d(m)},h.isAfterPickup=function(m){return this.hasPickup&&m===1};const d=function(m){const x=`Bad measure measureLocation [${m}].`;throw new A.default("Unexpected",x)},l=a},925368:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(701387),w=r(123491),f=r(668674),P=r(346797),a=r(657335);function h(S){if(A.default.getNotes(S).some(m)||d(S)||l(S)||A.default.hasHarmonies(S))return!1;let Y=A.default.getAllDirections(S);return Y=Y.filter(x),!(Y.length>0)}function d(S){const T=A.default.getNbStaves(S);for(let Y=0;Y<T;Y++)if(A.default.hasMeasureRepeat(S,Y))return!0;return!1}function l(S){const T=A.default.getNbStaves(S);for(let Y=0;Y<T;Y++)if(A.default.hasSlash(S,Y)){const G=A.default.getSlash(S,Y);if(!f.A.isUsingStems(G))return!0}return!1}function m(S){return!w.default.isRest(S)||w.default.needRestLock(S)}function x(S){return!(P.A.isInstanceOf(S)||a.A.isInstanceOf(S))}},934825:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>us});var A=r(364842),w=r(353922),f=r(75861);const P="BAD_SHAPE_STEP",a={C:w.A.DO,D:w.A.RE,E:w.A.MI,G:w.A.SO,A:w.A.LA,B:w.A.TI};function h(Q,Xt){return Q==="F"?d(Q,Xt):l(Q)}function d(Q,Xt){if(Xt===f.A.UP)return w.A.FA_UP;if(Xt===f.A.DOWN)return w.A.FA;f.A.raiseError(Xt)}function l(Q){if(typeof a[Q]!="undefined")return a[Q];m(Q)}function m(Q){const Xt=`There is no note shape for the step "${Q}".`,bt=new A.default(P,Xt);throw bt.step=Q,bt}var x=r(850354),S=r(62340),T=r(726042),Y=r(386033);const G=255*3/2;function q(Q,Xt){if(!Q)return"white";const bt=S(Q);if(!bt)return"white";if(bt.alpha===0)return"rgba(0, 0, 0, 0)";if(Xt!==Y.A.QUARTER)return"white";const{values:ve}=bt;return ve.reduce(T.default.add,0)>G?"black":"white"}const p={LEFT:"left",RIGHT:"right",MIDDLE:"middle"};var b=r(851291),v=r(606741);const B="note",C="Flat",_="Sharp",st="Whole",F="Half",L="Black";function I(Q,Xt,bt){let ve=B;return ve+=W(Q),ve+=V(Xt),ve+=it(bt),ve}function W(Q){if(!v.default.isValid(Q))throw new A.default(`Bad step value ${Q}`);return Q}function V(Q){if(Q===0)return"";if(Q<0)return C;if(Q>0)return _;throw new A.default(`Bad alter value ${Q}`)}function it(Q){if(Q===Y.A.WHOLE)return st;if(Q===Y.A.HALF)return F;if(Q===Y.A.QUARTER)return L;throw new A.default(`Bad head duration value ${Q}`)}var Pt=r(911066);const Yt="Si",Bt="So",le=new Map([["C",[null,"Do","Di"]],["D",["Ra","Re","Ri"]],["E",["Me","Mi",null]],["F",[null,"Fa","Fi"]],["G",["Se","So","Si"]],["A",["Le","La","Li"]],["B",["Te","Ti",null]]]),ie="Ja",K="note",pe="Whole",Ee="Half",tt="Black";function Et(Q,Xt,bt,ve){let Qt=K;return ve===Pt.A.SOLFEGE_JAPANESE&&(Qt+=ie),Qt+=Vt(Q,Xt,ve),Qt+=fe(bt),Qt}function Vt(Q,Xt,bt){if(bt===Pt.A.SOLFEGE_JAPANESE&&(Xt=0),(Xt===2||Xt===-2)&&(Xt/=2),Q==="B"&&[0,1].includes(Xt)&&[Pt.A.SOLFEGE_SI,Pt.A.SOLFEGE_JAPANESE].includes(bt))return Yt;if(Q==="G"&&Xt===1&&bt===Pt.A.SOLFEGE_SI)return Bt;if(!le.has(Q))throw new A.default(`Bad step value ${Q}`);return ct(Q,Xt)}function ct(Q,Xt){const bt=le.get(Q),ve=Xt+1;let Qt=bt[ve];return Qt===null&&(Qt=bt[1]),Qt}function fe(Q){if(Q===Y.A.WHOLE)return pe;if(Q===Y.A.HALF)return Ee;if(Q===Y.A.QUARTER)return tt;throw new A.default(`Bad head duration value ${Q}`)}const gt="noteEmptyWhole",At="noteEmptyHalf",Ht="noteEmptyBlack";function Wt(Q){if(Q===Y.A.WHOLE)return gt;if(Q===Y.A.HALF)return At;if(Q===Y.A.QUARTER)return Ht;throw new A.default(`Bad head duration value ${Q}`)}var k=r(920939),St=r(259563),yt=r(351277),Ct=r(364596),Mt=r(595382),Tt=r(399564);const nt={4:"restWhole",2:"restHalf",1:"restQuarter",.5:"rest8th",.25:"rest16th",.125:"rest32nd",.0625:"rest64th"},vt="noteheadParenthesisLeft",Nt="noteheadParenthesisRight",te="adagio-note-color",ee="adagio-template-lock",Ot="adagio-note-opacity",ot="rgb(0, 0, 150)",rt=function(Q){this.init(Q)};rt.cssClass="head";const at=rt.prototype;at.cssClass=rt.cssClass,at.init=function(Q){this.baseQuarterDuration=Q.getBaseQuarterDuration(),this.displayData=Q,this.glyphId=null,this.renderedNote=null,this.leftHeads=[],this.middleHeads=[],this.rightHeads=[],this.middleWidth=null,this.baseHead=null,this.baseLine=null,this.leftOffset=0,this.rightOffset=0},at.canDraw=function(){return this.displayData.isNormalStaff()},at.draw=function(Q,Xt){this.renderedNote=Q,this.ctx=Xt,this.baseLine=this.displayData.getFrontHeadLine(),this.createHeads(),this.fillGlyphes(),this.initStemPosition(),this.drawHeads(),this.fillRenderedNoteData()},at.createHeads=function(){this.displayData.isRest()?this.createRestHead():this.createSoundHeads()},at.createRestHead=function(){const Q=_t(this.baseQuarterDuration),bt={line:this.displayData.getLines()[0],cssClassesStr:"",hasParentheses:!1,color:this.displayData.getRestColor()};this.addHead(Q,p.MIDDLE,bt)};const _t=function(Q){const Xt=nt[Q];if(typeof Xt=="undefined"){const bt=`There is no rest glyph for the quarter duration [${Q}].`;throw new A.default("NoRestGlyph",bt)}return Xt};at.createSoundHeads=function(){this.initHeadDuration(),this.displayData.getHeads().forEach(this.createSoundHead,this)},at.initHeadDuration=function(){this.isWhole()?this.headDuration=Y.A.WHOLE:this.isHalf()?this.headDuration=Y.A.HALF:this.headDuration=Y.A.QUARTER},at.isWhole=function(){const Q=St.default.toQuarterDuration(St.default.FULL);return this.baseQuarterDuration===Q},at.isHalf=function(){const Q=St.default.toQuarterDuration(St.default.HALF);return this.baseQuarterDuration===Q},at.createSoundHead=function(Q){let Xt;if(this.ctx.usePitchNameNotehead()&&Q.step&&Q.notehead===w.A.NORMAL){const Qt=this.getStep(Q);let ae=this.getAlter(Q);ae=yt.default.normaliseAlterToHalfTone(ae),Xt=I(Qt,ae,this.headDuration),Q.hideStaff=!0}else if(this.ctx.useSolfegeNotehead()&&Q.step&&Q.notehead===w.A.NORMAL){const Qt=this.getStep(Q);let ae=this.getAlter(Q);ae=yt.default.normaliseAlterToHalfTone(ae),Xt=Et(Qt,ae,this.headDuration,this.ctx.getSolfegeType()),Q.hideStaff=!0}else{let Qt;if(Q.isShapeNote){const ae=this.displayData.getStemValue(),fs=this.getStep(Q);Qt=h(fs,ae)}else Q.isHarmonicNaturalTouching?Qt=w.A.DIAMOND:Qt=Q.notehead;Xt=(0,b.A)(Qt,this.headDuration,Q.isHarmonicArtificialTouching)}const bt=Q.line,ve=this.getSlot(bt);if(!Q.color&&Q.step&&this.ctx.useBoomwhackersColors()){let Qt=this.getStep(Q);const ae=yt.default.normaliseAlterToHalfTone(this.getAlter(Q));Qt=qt(Qt,ae),Q.color=(0,x.A)(Qt)}if(!Q.color&&this.ctx.customColorOptions()){const Qt=this.getStep(Q),ae=yt.default.normaliseAlterToHalfTone(this.getAlter(Q)),fs=this.getOctave(Q),ds=Q.isOutOfTessiture,U=this.displayData.isUnpitched()?{}:{step:Qt,alter:ae,octave:fs,outOfPitch:ds},Gt=Tt.A.getCustomColor(U,this.ctx.customColorOptions());Gt&&(Q.color=Gt)}Q.color&&this.ctx.outlineColoredNotes()&&(Q.strokeColor="black"),Q.isTemplateLocked&&(Q.color?Q.strokeColor=ot:Q.color=ot),this.addHead(Xt,ve,Q)},at.getStep=function(Q){return this.ctx.isFixedDo()?Q.step:Q.cStep},at.getAlter=function(Q){return this.ctx.isFixedDo()?Q.alter:Q.cAlter},at.getOctave=function(Q){return Q.octave};function qt(Q,Xt){if(Xt===0)return Q;const bt=Ct.default.createDefault(),ve=yt.default.create(4,Q,Xt);let Qt=Mt.A.switchEnharmonic(ve,bt);if(Xt===-2){if(yt.default.getAlter(Qt)===0)return yt.default.getStep(Qt);Qt=Mt.A.switchEnharmonic(Qt,bt)}let ae=ve;if(yt.default.getAlter(Qt)>=0&&(ae=Qt),Xt=yt.default.getAlter(ae),Q=yt.default.getStep(ae),Xt===1)return`${Q}#`;if(Xt===0)return Q;throw new A.default("Unexpected")}at.getSlot=function(Q){const Xt=this.displayData.getStemValue();return Xt===f.A.UP&&this.displayData.isSecondHigher(Q)?p.RIGHT:Xt===f.A.DOWN&&this.displayData.isSecondLower(Q)?p.LEFT:p.MIDDLE},at.addHead=function(Q,Xt,bt){const ve={glyphId:Q,line:bt.line,slot:Xt,step:bt.step,glyph:null,path:null,hideStaff:bt.hideStaff,backgroundGlyph:null,backgroundPath:null,cssClassesStr:bt.cssClassesStr,hasParentheses:bt.hasParentheses,isOutOfTessiture:bt.isOutOfTessiture,color:bt.color,strokeColor:bt.strokeColor,isTemplateLocked:bt.isTemplateLocked,isHarmonicArtificialTouching:bt.isHarmonicArtificialTouching};if(Xt===p.LEFT)this.leftHeads.push(ve);else if(Xt===p.MIDDLE)this.middleHeads.push(ve);else if(Xt===p.RIGHT)this.rightHeads.push(ve);else throw new A.default("unreachable");bt.line===this.baseLine&&(this.baseHead=ve)},at.fillGlyphes=function(){this.leftHeads.forEach(this.fillGlyph,this),this.rightHeads.forEach(this.fillGlyph,this),this.middleHeads.forEach(this.fillGlyph,this)},at.fillGlyph=function(Q){Q.glyph=this.getGlyph(Q.glyphId,Q.isHarmonicArtificialTouching)},at.getGlyph=function(Q,Xt){if(!this.displayData.isGrace()&&!Xt)return this.ctx.getGlyph(Q);{const bt=this.ctx.getGraceSizeCoeff();return this.ctx.getScaledGlyph(Q,bt)}},at.initStemPosition=function(){const Q=this.displayData.getStemValue(),Xt=this.ctx.getStemThickness();if(Q===f.A.UP)this.rightStemX=be(this.baseHead),this.leftStemX=this.rightStemX-Xt,this.renderedNote.setStemYOffset(ue(this.baseHead));else if(Q===f.A.DOWN)this.leftStemX=oe(this.baseHead),this.rightStemX=this.leftStemX+Xt,this.renderedNote.setStemYOffset(ne(this.baseHead));else throw new A.default("Unexpected");this.renderedNote.setLeftStemX(this.leftStemX+Xt/2)};const ue=function(Q){return Q.glyph.hasStemAnchor()?Q.glyph.getStemUpSE().y:0},ne=function(Q){return Q.glyph.hasStemAnchor()?Q.glyph.getStemDownNW().y:0};at.drawHeads=function(){this.leftHeads.forEach(this.drawHead,this),this.rightHeads.forEach(this.drawHead,this),this.middleHeads.forEach(this.drawHead,this)},at.drawHead=function(Q){const Xt=Q.line,bt=this.renderedNote.getHead(Xt);if(Q.hideStaff){const U=Wt(this.headDuration),Gt=this.getGlyph(U),It=bt.append("path");It.attr("d",Gt.render());const xt=q(Q.color,this.headDuration);if(It.style("fill",xt),Q.strokeColor){const zt=this.ctx.getStemThickness();It.style("stroke",Q.strokeColor),It.style("stroke-width",`${zt}px`)}}if(Q.path=bt.append("path"),Q.path.attr("d",Q.glyph.render()),this.shouldAddFillRule()&&Q.path.attr("fill-rule","evenodd"),Q.isOutOfTessiture&&this.ctx.displayOutOfPitch()&&!Q.color){const U="red";this.ctx.styleGroupChildElements()?(Q.path.style("fill",U),Q.path.style("opacity",.6)):(bt.style("fill",U),bt.style("opacity",.6)),bt.setDataEntry(te,U),bt.setDataEntry(Ot,.6)}const ve=this.ctx.getSpaceSize(),Qt=this.calcShiftValue(Q),ae=-(Qt+Q.glyph.getBBoxSW().x),fs=Qt+Q.glyph.getBBoxNE().x-this.getMiddleWidth();this.leftOffset=Math.max(this.leftOffset,ae),this.rightOffset=Math.max(this.rightOffset,fs);const ds=this.lineToY(Xt,ve);this.renderedNote.setHighestY(ds+Q.glyph.getBBoxNE().y),this.renderedNote.setLowestY(ds+Q.glyph.getBBoxSW().y),bt.attr("transform",`translate(${Qt} ${ds})`);const Xe=Q.cssClassesStr;if(bt.attr("class",`${this.cssClass} ${Xe}`),Q.color&&(this.ctx.styleGroupChildElements()?Q.path.style("fill",Q.color):bt.style("fill",Q.color),bt.setDataEntry(te,Q.color)),Q.strokeColor&&!Q.hideStaff){const U=this.ctx.getStemThickness();this.ctx.styleGroupChildElements()?(Q.path.style("stroke",Q.strokeColor),Q.path.style("stroke-width",`${U}px`)):(bt.style("stroke",Q.strokeColor),bt.style("stroke-width",`${U}px`))}if(Q.hasParentheses){const U=bt.append("path"),Gt=this.ctx.getGlyph(vt),It=-(this.ctx.getStemThickness()+this.ctx.getLegerLineThickness());U.attr("d",Gt.render()),U.attr("transform",`translate(${It}, 0)`);const xt=bt.append("path"),zt=this.ctx.getGlyph(Nt),Ne=be(Q);xt.attr("d",zt.render()),xt.attr("transform",`translate(${Ne}, 0)`),this.ctx.styleGroupChildElements()&&(U.style("fill",Q.color),xt.style("fill",Q.color))}Q.isTemplateLocked&&bt.setDataEntry(ee,!0)},at.shouldAddFillRule=function(){return this.ctx.useSolfegeNotehead()&&this.ctx.getSolfegeType()===Pt.A.SOLFEGE_JAPANESE},at.calcShiftValue=function(Q){const Xt=Q.slot;if(Xt===p.LEFT)return this.rightStemX-be(Q);if(Xt===p.MIDDLE)return this.displayData.getStemValue()===f.A.UP?this.rightStemX-be(Q):this.leftStemX-oe(Q);if(Xt===p.RIGHT)return this.leftStemX-oe(Q);throw new A.default("unreachable")},at.lineToY=function(Q){const Xt=this.displayData.isTabStaff()?this.ctx.getTabSpaceSize():this.ctx.getSpaceSize(),bt=this.displayData.getNbStaffLines();return k.A.lineToY(Q,Xt,bt)},at.fillRenderedNoteData=function(){this.renderedNote.setLeftHeadWidth(this.leftOffset),this.renderedNote.setRightHeadWidth(this.rightOffset);const Q=this.getMiddleWidth();this.renderedNote.setMiddleHeadWidth(Q)},at.getMiddleWidth=function(){return this.middleWidth===null&&(this.middleWidth=be(this.baseHead)),this.middleWidth};const be=function(Q){if(Q.glyph.hasStemAnchor())return Q.glyph.getStemUpSE().x;{const Xt=0-Q.glyph.getBBoxSW().x;return Q.glyph.getBBoxNE().x-Xt}},oe=function(Q){return Q.glyph.hasStemAnchor()?Q.glyph.getStemDownNW().x:0},us=rt},936945:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>m});var A=r(140887),w=r(575502),f=r(498041),P=r(351277),a=r(377180);const h=new Map([["F1/2",123],["G/2",13],["G1/2",23],["A/2",12],["A1/2",1],["B/2",2],["C/3",0],["C1/3",123],["D/3",13],["D1/3",23],["E/3",12],["F/3",1],["F1/3",2],["G/3",0],["G1/3",23],["A/3",12],["A1/3",1],["B/3",2],["C/4",0],["C1/4",12],["D/4",1],["D1/4",2],["E/4",0],["F/4",1],["F1/4",2],["G/4",0],["G1/4",23],["A/4",12],["A1/4",1],["B/4",2],["C/5",0],["C1/5",2],["D/5",0],["D1/5",2],["E/5",0],["F/5",1],["F1/5",2],["G/5",0],["G1/5",23],["A/5",12],["A1/5",1],["B/5",2],["C/6",0]]),d=new Map([[A.A.TRUMPET,{reverseTranspose:a.default.createComplete(2,1,0),fingeringsMap:new Map([["F1/3",123],["G/3",13],["G1/3",23],["A/3",12],["A1/3",1],["B/3",2],["C/4",0],["C1/4",123],["D/4",13],["D1/4",23],["E/4",12],["F/4",1],["F1/4",2],["G/4",0],["G1/4",23],["A/4",12],["A1/4",1],["B/4",2],["C/5",0],["C1/5",12],["D/5",1],["D1/5",2],["E/5",0],["F/5",1],["F1/5",2],["G/5",0],["G1/5",23],["A/5",12],["A1/5",1],["B/5",2],["C/6",0],["C1/6",12],["D/6",1],["D1/6",2],["E/6",0],["F/6",1]])}],[A.A.HORN_C,{reverseTranspose:a.default.createComplete(0,0,1),fingeringsMap:h}],[A.A.HORN_D,{reverseTranspose:a.default.createComplete(10,6,0),fingeringsMap:h}],[A.A.HORN_F,{reverseTranspose:a.default.createComplete(7,4,0),fingeringsMap:h}],[A.A.TROMBONE,{reverseTranspose:a.default.createComplete(0,0,0),fingeringsMap:new Map([["E/2",7],["F/2",6],["F1/2",5],["G/2",4],["G1/2",3],["A/2",2],["A1/2",1],["B/2",7],["C/3",6],["C1/3",5],["D/3",4],["D1/3",3],["E/3",2],["F/3",1],["F1/3",5],["G/3",4],["G1/3",3],["A/3",2],["A1/3",1],["B/3",4],["C/4",3],["C1/4",2],["D/4",1],["D1/4",3],["E/4",2],["F/4",1],["F1/4",3],["G/4",2],["G1/4",3],["A/4",2],["A1/4",1]])}],[A.A.EUPHONIUM,{reverseTranspose:a.default.createComplete(0,0,0),fingeringsMap:new Map([["E/2",123],["F/2",13],["F1/2",12],["G/2",23],["G1/2",3],["A/2",2],["A1/2",0],["B/2",123],["C/3",13],["C1/3",12],["D/3",23],["D1/3",3],["E/3",2],["F/3",0],["F1/3",12],["G/3",23],["G1/3",12],["A/3",2],["A1/3",0],["B/3",23],["C/4",3],["C1/4",2],["D/4",0],["D1/4",3],["E/4",2],["F/4",0],["F1/4",12],["G/4",23],["G1/4",3],["A/4",2],["A1/4",0]])}]]),l=x=>{const{step:S,octave:T,alter:Y}=x;return`${S}${Y!=null?Y:""}/${T}`};function m(x,S){const T=w.A.getInstrument(S),{reverseTranspose:Y,fingeringsMap:G}=d.get(T);let q=P.default.transpose(x,Y);q=(0,f.A)(q);const R=l(q);return G.get(R)}},956149:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>h});var A=r(269352),w=r(51342);const f="csymAugmented",P=function(){this.init()};P.NAME="chord.augmented";const a=P.prototype;a.name=P.NAME,a.init=function(){this.path=null,this.parent=null,this.drawingContext=null,this.glyph=null,this.posX=null,this.posY=null},a.setParent=function(d){this.parent=d},a.setPosX=function(d){this.posX=d},a.setPosY=function(d){this.posY=d},a.setDrawingContext=function(d){this.drawingContext=d},a.draw=function(){this.isRendered()||this.render(),this.move(),this.bindToParent()},a.render=function(){const d=this.getGlyph(),l=new A.A("path"),m=d.render();l.attr("d",m),l.attr("class",this.name),this.path=l},a.isRendered=function(){return this.path!==null},a.move=function(){if(this.isRendered()&&this.posX!==null&&this.posY!==null){const d=this.getYShift(),l=this.posY-d,m=this.getLeftPadding(),x=this.posX+m;this.path.attr("transform",`translate(${x}, ${l})`)}},a.bindToParent=function(){this.parent.append(this.path)},a.getWidth=function(){return this.getGlyph().getWidth()+this.getLeftPadding()},a.getLeftPadding=function(){const d=this.drawingContext.getHarmonyGlyphRatio();return this.drawingContext.getSpaceSize()*w.A.SUPSCRIPT_BASELINE*d/2},a.getHeight=function(){return this.getSpaceAbove()+this.getSpaceBelow()},a.getSpaceAbove=function(){const d=this.getYShift();return-this.getGlyph().getBBoxNE().y+d},a.getYShift=function(){return this.drawingContext.getHarmonyFontSize()*w.A.SUPSCRIPT_BASELINE},a.getSpaceBelow=function(){return this.getGlyph().getBBoxSW().y},a.getGlyph=function(){if(this.glyph===null){const d=w.A.SMALL_FONT_SIZE*this.drawingContext.getHarmonyGlyphRatio();this.glyph=this.drawingContext.getScaledGlyph(f,d)}return this.glyph};const h=P},967220:(Rt,J,r)=>{"use strict";r.d(J,{A:()=>l});const A="note",w="lyric",f="harmony",P="dynamic",a="multi-measure-rest",h="figured-bass";function d(m){return m===A||m===a}const l={NOTE:A,LYRIC:w,HARMONY:f,DYNAMIC:P,MMR:a,FIGURED_BASS:h,isInsideStaff:d}}}]);})();


//# debugId=778fb4ab-402f-5412-8e3a-4535e263da89
