"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="ab58ce94-c93d-5902-b55e-c284aa382338")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[55021],{3771:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(157158);const _=h.A},26927:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(139560),_=t(701387),f=t(721247);function v(r,d){const o=(0,h.A)(d),e=n(r,d);return c(r,o,e)}function n(r,d){if(l(d)){const s=r.getDpqValue();return d.timePos*s/d.divisions}return r.getVoice(d.voiceIdx).getRangeSpace(0,d.noteIdx)}function l(r){return typeof r.timePos=="number"&&typeof r.divisions=="number"}function c(r,d,o){let e=r.getClef(d);const s=r.getMeasure();if(!_.default.hasMiddleClefs(s,d))return e;const i=_.default.getMiddleClefs(s,d);for(let u=0;u<i.length;u++){const a=i[u];if(f.default.getTimePos(a)<=o)e=a;else return e}return e}},32381:(A,E,t)=>{t.d(E,{A:()=>s});var h=t(259563),_=t(123491),f=t(515819),v=t(209175),n=t(737296),l=t(582458),c=t(3771),r=t(964039),d=t(793317);const o=function(i,u,a){this.init(i,u,a)};o.NAME="composite.FormatRests";const e=o.prototype;e.name=o.NAME,e.initMeasureData=d.default,e.init=function(i,u,a){this.initMeasureData(i,u),this.cancelStack=a,this.opts=u,this.availableSpace=null,this.dispatchedRests=null},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpq(),this.gatherAvailableSpace(),this.divideSpace(),this.applyDivisions()},e.adaptDpq=function(){const i=this.getDivisionsPerBeat();let a=this.getVoice().getAbsoluteTimeModif();const m=this.getDivisionsPerQuarter(),D=f.default.actualDivisionsToDurationOpts(i,m,a);a=v.default.copy(a);const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:D.durationType,nbDots:D.nbDots,timeModif:a};new c.A(this.measureData,p,this.cancelStack).perform()},e.gatherAvailableSpace=function(){let i=0;const u=this.getVoice(),a=u.getStopNoteIdx();for(let m=this.opts.noteIdx;m<=a&&u.isRest(m);m++){const D=u.getNote(m);if(m!==this.opts.noteIdx&&(_.default.hasTupletStart(D)||_.default.needRestLock(D)))break;const p=_.default.getDuration(D);i+=p}this.availableSpace=i},e.divideSpace=function(){const i=this.getTimePosition(),u=this.availableSpace,a=this.getDivisionsPerBeat(),m=this.getDivisionsPerQuarter(),D=this.getTimeModif(),p=new r.A(i,u,a,m,D);p.dispatch(),this.dispatchedRests=p.getDispatchedRests()},e.getTimePosition=function(){const i=this.getVoice();let u=0;for(let a=i.getStartNoteIdx();a<this.opts.noteIdx;a++){const m=i.getNote(a),D=_.default.getDuration(m);u+=D}return u},e.getDivisionsPerBeat=function(){const i=this.getVoice();return i.isTuplet()?this.getDivPerBeatFromTimeModif(i):this.getDivPerBeatFromTimeSignature()},e.getDivPerBeatFromTimeSignature=function(){const i=this.measureData.getAnyTime(),u=f.default.getBeatQuarterDuration(i),a=this.getDivisionsPerQuarter();return f.default.quarterToDuration(u,a)},e.getDivPerBeatFromTimeModif=function(i){const u=i.getAbsoluteTimeModif(),a=i.getDurationType(),m=this.getDivisionsPerQuarter(),D=h.default.toQuarterDuration(a),p=f.default.quarterToDuration(D,m);return f.default.normalToActual(p,u)},e.getDivisionsPerQuarter=function(){return this.measureData.getDivisionsPerQuarterValue()},e.applyDivisions=function(){this.dispatchedRests.forEach(this.applyDivision,this)},e.applyDivision=function(i,u){const a=this.opts.noteIdx+u,D=this.getVoice().getNote(a);_.default.getDuration(D)!==i&&this.changeDuration(a,i)},e.changeDuration=function(i,u){const a=this.divisionsToDurationOpts(u),m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:i,insertMode:n.default.REPLACE,durationType:a.durationType,nbDots:a.nbDots};new l.default(this.measureData,m,this.cancelStack).perform()},e.divisionsToDurationOpts=function(i){const u=this.getDivisionsPerQuarter(),a=this.getTimeModif();return f.default.actualDivisionsToDurationOpts(i,u,a)},e.getTimeModif=function(){return this.getVoice().getAbsoluteTimeModif()},e.getVoice=function(){const i=this.opts.voiceIdx,u=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(i,u)};const s=o},39584:(A,E,t)=>{t.d(E,{A:()=>c});var h=t(990937),_=t(726042),f=t(125911),v=t(653631);const n=function(r,d){typeof d.timePos!="undefined"&&l(r,d)},l=function(r,d){const o=r.getDivisions().getDivisions(),e=_.default.lcm(o,d.divisions),s=e/o,i=e/d.divisions;d.timePos*=i;const u=r.getVoice(d.voiceIdx);if((0,f.A)(u,s,d.timePos))d.noteIdx=(0,v.A)(u,s,d.timePos),delete d.timePos,delete d.divisions;else throw new h.A(d.timePos,e,h.A.GET)},c=n},45876:(A,E,t)=>{t.d(E,{A:()=>r});var h=t(351277),_=t(476943),f=t(123491),v=t(793317),n=t(56807);const l=function(d,o,e){this.init(d,o,e)};l.NAME="composite.RemoveChordRightGlissandos";const c=l.prototype;c.name=l.NAME,c.initMeasureData=v.default,c.init=function(d,o,e){this.initMeasureData(d,o),this.opts=o,this.cancelStack=e},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeChordRightGlissandos()},c.removeChordRightGlissandos=function(){let o=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);o=_.default.makeArray(o),o.map(f.default.getPitch).forEach(this.removeHeadRightGlissandos,this)},c.removeHeadRightGlissandos=function(d){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(d)};new n.A(this.measureData,o,this.cancelStack).perform()};const r=l},56807:(A,E,t)=>{t.d(E,{A:()=>a});var h=t(351277),_=t(123491),f=t(316197),v=t(669208),n=t(793317),l=t(691309),c=t(364842);function r(m,D){const I=m.getRightChord().find(d,D);if(I)return _.default.getPitch(I);throw new c.default("Unexpected",`There is no glissando stop with the number ${D}`)}function d(m){const D=this.valueOf();return _.default.getGlissandoStops(m).some(o,D)}function o(m){const D=this.valueOf();return f.default.getNumber(m)===D}var e=t(519405);const s=function(m,D,p){this.init(m,D,p)};s.NAME="composite.RemoveHeadRightGlissandos";const i=s.prototype;i.name=s.NAME,i.initMeasureData=n.default,i.init=function(m,D,p){this.initMeasureData(m,D),this.opts=D,this.cancelStack=p,this.crossMeasure=new l.default(this.measureData,D.voiceIdx,D.noteIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHeadRightGlissandos()},i.removeHeadRightGlissandos=function(){this.getGlissandoStarts().map(f.default.getNumber).map(this.findRightPitch,this).forEach(this.removeGlissando,this)},i.getGlissandoStarts=function(){const D=this.crossMeasure.getLeftChord().find(u,this.opts.pitch);return _.default.getGlissandoStarts(D)};function u(m){const D=this,p=_.default.getPitch(m);return h.default.isSameLine(p,D)}i.findRightPitch=function(m){return r(this.crossMeasure,m)},i.removeGlissando=function(m){const D={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:h.default.copy(this.opts.pitch),rightPitch:h.default.copy(m)},p=new v.default(this.measureData,D,this.cancelStack);(0,e.default)(p)};const a=s},79869:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(139560),_=t(701387),f=t(886766);const v=function(c,r){const d=(0,h.A)(r),o=c.getMeasure(),e=n(o,d),s=_.default.getOctaveShifts(o,d),i=_.default.getDpq(o),u=r.timePos*i/r.divisions;return(0,f.A)(e,s,u,!0)},n=function(c,r){return _.default.hasLeftOctaveShift(c,r)?_.default.getLeftOctaveShift(c,r):null},l=v},100040:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(951066);function _(c){return`the measure numbering start value [${c}] is invalid.`}class f extends h.A{constructor(r){const d=_(r);super(d),Object.defineProperty(this,"measureNumberingStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadMeasureNumberingStartError",this.measureNumberingStart=r}}var v=t(726042);const n={};n.check=function(c){if(!n.isValid(c))throw new f(c)},n.isValid=function(c){return v.default.isInteger(c)&&c>=1};const l=n},103219:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(123491),_=t(316197),f=t(351277);function v(o,e,s){const i=n(o,e);return c(o,s,i)}function n(o,e){const i=o.getLeftChord().find(r,e),u={};return h.default.getGlissandoStarts(i).forEach(l,u),u}function l(o){const e=this,s=_.default.getNumber(o);e[s]=!0}function c(o,e,s){const u=o.getRightChord().find(r,e);return h.default.getGlissandoStops(u).some(d,s)}function r(o){const e=this,s=h.default.getPitch(o);return f.default.isSameLine(s,e)}function d(o){const e=this.valueOf(),s=_.default.getNumber(o);return typeof e[s]!="undefined"}},121720:(A,E,t)=>{t.d(E,{A:()=>n});var h=t(123491),_=t(316197),f=t(351277),v=t(364842);function n(e,s,i){const u=l(e,s),a=r(e,i,u);if(a===null)throw new v.default("Unexpected",`There is no glissando stop matching the 
    left pitch ${f.default.stringify(s)} with the right pitch 
    ${f.default.stringify(i)}`);return a}function l(e,s){const u=e.getLeftChord().find(d,s),a={};return h.default.getGlissandoStarts(u).forEach(c,a),a}function c(e){const s=this,i=_.default.getNumber(e);s[i]=!0}function r(e,s,i){const a=e.getRightChord().find(d,s),D=h.default.getGlissandoStops(a).find(o,i);return D?_.default.getNumber(D):null}function d(e){const s=this,i=h.default.getPitch(e);return f.default.isSameLine(i,s)}function o(e){const s=this.valueOf(),i=_.default.getNumber(e);return typeof s[i]!="undefined"}},139560:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(428925);const _=h.A},145170:(A,E,t)=>{t.d(E,{A:()=>r});var h=t(364842),_=t(123491),f=t(737296),v=t(443923),n=t(793317);const l=function(d,o,e){this.init(d,o,e)};l.NAME="composite.UnlockRests";const c=l.prototype;c.name=l.NAME,c.initMeasureData=n.default,c.init=function(d,o,e){this.initMeasureData(d,o),this.cancelStack=e,this.opts=o},c.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===f.default.INSERT)this.unlockAtEnd();else if(this.opts.insertMode===f.default.REPLACE)this.unlockAtIdx();else{const d=`Unexpected insert mode: [${this.opts.insertMode}].`;throw new h.default("Unexpected",d)}},c.unlockAtEnd=function(){let d=this.opts.duration;const o=this.getVoice();for(let e=o.getStopNoteIdx();d>0;e--)d=this.unlockRestAndConsumeDuration(e,d)},c.unlockAtIdx=function(){for(let d=this.opts.duration;d>0;this.opts.noteIdx++)d=this.unlockRestAndConsumeDuration(this.opts.noteIdx,d)},c.unlockRestAndConsumeDuration=function(d,o){const s=this.getVoice().getNote(d),i=_.default.getDuration(s);return o-=i,this.unlockRest(d),o},c.getVoice=function(){const d=this.opts.voiceIdx,o=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(d,o)},c.unlockRest=function(d){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:d};new v.A(this.measureData,o,this.cancelStack).perform()};const r=l},208979:(A,E,t)=>{t.d(E,{A:()=>u});var h=t(364842),_=t(737903),f=t(476943),v=t(726042),n=t(123491),l=t(515819),c=t(762691),r=t(975924),d=t(349386),o=t(793317),e=t(852363);const s=function(a,m,D){this.init(a,m,D)};s.NAME="primitive.ChangeDuration";const i=s.prototype;i.name=s.NAME,i.initMeasureData=o.default,i.init=function(a,m,D){this.initMeasureData(a,m),this.cancelStack=D,this.opts=m,l.default.fillDefaultOpts(this.opts)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const a=this.getCurrentDurationOpts();this.changeDuration(),this.updateStack(a)},i.getCurrentDurationOpts=function(){const a=this.getNote(),m=n.default.getNbDots(a),D=this.getDurationType(a);return{nbDots:m,durationType:D}},i.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},i.getDurationType=function(a){const m=this.measureData.getDpqValue();return(0,r.default)(a,m)},i.changeDuration=function(){const a=this.getVoice();let m=a.getChord(this.opts.noteIdx);if(m=f.default.makeArray(m),m.forEach(this.changeHeadDuration,this),this.cancelStack.hasPayload()){const D=a.getNote(this.opts.noteIdx),p=this.cancelStack.getPayload(),I=(0,_.default)(p.headCssClassesSet);c.default.setGlobalCssClassesSet(D,I)}},i.changeHeadDuration=function(a){const m=this.getDuration();if(n.default.setDuration(a,m),n.default.setNbDots(a,this.opts.nbDots),this.cancelStack.hasPayload()){const D=this.cancelStack.getPayload(),p=(0,_.default)(D.headCssClassesSet);c.default.setHeadCssClassesSet(a,p)}},i.getDuration=function(){const a=this.measureData.getDpqValue(),D=this.getVoiceOrTupletForGet().getAbsoluteTimeModif(),p=(0,d.default)(this.opts,a,D);if(!v.default.isInteger(p)){const I=`At this point, the divisions duration [${p}] should be an integer.`;throw new h.default("IntegerExpected",I)}return p},i.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},i.getVoiceOrTupletForGet=function(){const a=this.opts.voiceIdx,m=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,m)},i.updateStack=function(a){const m={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,previousDurationType:a.durationType,previousNbDots:a.nbDots}};this.cancelStack.push(m),(0,e.default)(this.cancelStack,this.measureData,this.opts)};const u=s},210052:(A,E,t)=>{t.d(E,{A:()=>i});var h=t(364842),_=t(297098),f=t(123491),v=t(50060),n=t(793317),l=t(852363);const c=function(u,a,m){this.init(u,a,m)};c.NAME="primitive.SetSyllabic";const r=c.prototype;r.name=c.NAME,r.initMeasureData=n.default,r.init=function(u,a,m){this.initMeasureData(u,a),this.cancelStack=m,this.opts=a},r.perform=function(){this.setSyllabic(),this.updateStack()},r.setSyllabic=function(){const u=this.getLyric();v.default.setSyllabic(u,this.opts.syllabicType)},r.getLyric=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),m=this.opts.level;if(f.default.hasLyricAtLevel(a,m))return f.default.getLyricAtLevel(a,m);{const D=`There should be a lyric at the level [${m}].`;throw new h.default("NoNoteAtLevel",D)}},r.updateStack=function(){const u={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},a={type:this.name,opts:u};this.cancelStack.push(a),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const d=c;var o=t(691309);const e=function(u,a,m){this.init(u,a,m)};e.NAME="primitive.UpdateSyllabic";const s=e.prototype;s.name=e.NAME,s.initMeasureData=n.default,s.init=function(u,a,m){this.initMeasureData(u,a),this.cancelStack=m,this.opts=a,this.crossMeasure=new o.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)},s.perform=function(){const u=this.getSyllabicType();this.setSyllabic(u)},s.getSyllabicType=function(){const u=this.hasPreviousRightConnection(),a=this.hasRightConnection();return u?a?_.A.MIDDLE:_.A.END:a?_.A.BEGIN:_.A.SINGLE},s.hasPreviousRightConnection=function(){if(this.hasPreviousNote()){const u=this.getPreviousNote();if(f.default.hasLyricAtLevel(u,this.opts.level)){const a=f.default.getLyricAtLevel(u,this.opts.level);return v.default.hasRightConnection(a)}else return!1}else return!1},s.hasPreviousNote=function(){return this.crossMeasure.hasLeftOverflow()?this.measureData.hasPreviousMeasure()?!!this.crossMeasure.hasLeftVoice():!1:!0},s.getPreviousNote=function(){const u=this.crossMeasure.getLeftVoice(),a=this.crossMeasure.getLeftNoteIdx();return u.getNote(a)},s.hasRightConnection=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),m=this.opts.level;if(f.default.hasLyricAtLevel(a,m)){const D=f.default.getLyricAtLevel(a,m);return v.default.hasRightConnection(D)}else{const D=`There should be a lyric at the level [${m}].`;throw new h.default("NoNoteAtLevel",D)}},s.setSyllabic=function(u){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level,syllabicType:u};new d(this.measureData,a,this.cancelStack).perform()};const i=e},218371:(A,E,t)=>{t.d(E,{A:()=>r});var h=t(351277),_=t(476943),f=t(123491),v=t(793317),n=t(941837);const l=function(d,o,e){this.init(d,o,e)};l.NAME="composite.RemoveChordRightSlides";const c=l.prototype;c.name=l.NAME,c.initMeasureData=v.default,c.init=function(d,o,e){this.initMeasureData(d,o),this.opts=o,this.cancelStack=e},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeChordRightSlides()},c.removeChordRightSlides=function(){let o=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);o=_.default.makeArray(o),o.map(f.default.getPitch).forEach(this.removeHeadRightSlides,this)},c.removeHeadRightSlides=function(d){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:h.default.copyWithoutAlter(d)};new n.A(this.measureData,o,this.cancelStack).perform()};const r=l},230373:(A,E,t)=>{t.d(E,{A:()=>s});var h=t(364842),_=t(351277),f=t(345912),v=t(748478),n=t(79869),l=t(26927);const c=function(i,u){const a=(0,l.A)(i,u);let m=_.default.pitchToLine(u.pitch,a);const D=r(i,u);return D&&(m=f.A.applyShiftToLine(D,m)),m},r=function(i,u){return d(u)(i,u)},d=function(i){if(o(i))return n.A;if(e(i))return v.A;throw new h.default("Unexpected")},o=function(i){return typeof i.timePos=="number"&&typeof i.divisions=="number"},e=function(i){return typeof i.noteIdx=="number"},s=c},236378:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(607682);const _=function(v){return`No note found on the fret [${v.fret}] of the string [${v.string}].`};class f extends h.default{constructor(n){const l=_(n);super(l),Object.defineProperty(this,"fretData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="NoNoteAtFretError",this.fretData=n}}},243183:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(813864);const _=h.A},246508:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(951066);class _ extends h.A{constructor(n){const l=f(n);super(l),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadHasPickupShiftError",this.value=n}}const f=function(v){return`The value for \`hasPickupShift:${v}\` is invalid.It must be an integer.`}},257818:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(123491),_=t(476943);function f(v,n){let l=v.getRangeSpace(0,n);const c=v.getNbNotes();for(let r=n;r<c;r++){_.default.makeArray(v.getChord(r)).forEach(i=>h.default.setTimePos(i,l));const o=v.getNbGraces(r);for(let i=0;i<o;i++)_.default.makeArray(v.getGraceChord(r,i)).forEach(a=>h.default.setTimePos(a,l));const e=v.getNote(r),s=h.default.getDuration(e);l+=s}}},272980:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(209175),_=t(343568),f=t(157158);const v=function(c,r,d){this.init(c,r,d)};v.NAME="composite.AdaptDpqToTuplet";const n=v.prototype;n.initMeasureData=_.A,n.name=v.NAME,n.init=function(c,r,d){this.initMeasureData(c,r),this.cancelStack=d,this.opts=r},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const c=this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx);if(!c.isTuplet())return;const r=c.getAbsoluteTimeModif(),d=c.getDurationType(),o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timeModif:h.default.copy(r),durationType:d,nbDots:0};new f.A(this.measureData,o,this.cancelStack).perform()};const l=v},284269:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(123491),_=t(852363),f=t(793317);const v=function(c,r,d){this.init(c,r,d)};v.NAME="primitive.RemoveNotation";const n=v.prototype;n.name=v.NAME,n.initMeasureData=f.default,n.init=function(c,r,d){this.initMeasureData(c,r),this.cancelStack=d,this.opts=r},n.perform=function(){const r=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);h.default.removeNotation(r,this.opts.notationType),this.updateStack()},n.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(c),(0,_.default)(this.cancelStack,this.measureData,this.opts)};const l=v},313499:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(351277),_=t(364842);const v=function(){let c;if(typeof this.opts.staffIdx!="undefined")c=this.opts.staffIdx;else{const d="Cannot retrieve a clef since no staff idx is provided. ";throw new _.default("NoStaffIdx",d)}return this.measureData.getClef(c)},l=function(){if(typeof this.opts.line!="undefined"){const r=(this.getClef||v).call(this),d=h.default.lineToPitch(this.opts.line,r);this.opts.octave=d.octave,this.opts.step=d.step,delete this.opts.line}}},325600:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(898439);const _=h.A},330751:(A,E,t)=>{t.d(E,{A:()=>D});var h=t(364842),_=t(971249),f=t(123491),v=t(50060),n=t(674411),l=t(793317),c=t(852363);const r=function(p,I,P){this.init(p,I,P)};r.NAME="primitive.SetMelisma";const d=r.prototype;d.name=r.NAME,d.initMeasureData=l.default,d.init=function(p,I,P){this.initMeasureData(p,I),this.cancelStack=P,this.opts=I},d.perform=function(){this.setMelisma(),this.updateStack()},d.setMelisma=function(){const p=this.getLyric(),I=n.A.create(this.opts.melismaType);v.default.setMelisma(p,I)},d.getLyric=function(){const I=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),P=this.opts.level;if(f.default.hasLyricAtLevel(I,P))return f.default.getLyricAtLevel(I,P);{const g=`There should be a lyric at the level [${P}].`;throw new h.default("NoNoteAtLevel",g)}},d.updateStack=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},I={type:this.name,opts:p};this.cancelStack.push(I),(0,c.default)(this.cancelStack,this.measureData,this.opts)};const o=r,e=function(p,I,P){this.init(p,I,P)};e.NAME="primitive.RemoveMelisma";const s=e.prototype;s.name=e.NAME,s.initMeasureData=l.default,s.init=function(p,I,P){this.initMeasureData(p,I),this.cancelStack=P,this.opts=I},s.perform=function(){this.setMelisma(),this.updateStack()},s.setMelisma=function(){const p=this.getLyric();v.default.removeMelisma(p)},s.getLyric=function(){const I=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),P=this.opts.level;if(f.default.hasLyricAtLevel(I,P))return f.default.getLyricAtLevel(I,P);{const g=`There should be a lyric at the level [${P}].`;throw new h.default("NoNoteAtLevel",g)}},s.updateStack=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},I={type:this.name,opts:p};this.cancelStack.push(I),(0,c.default)(this.cancelStack,this.measureData,this.opts)};const i=e;var u=t(691309);const a=function(p,I,P){this.init(p,I,P)};a.NAME="composite.UpdateMelisma";const m=a.prototype;m.name=a.NAME,m.initMeasureData=l.default,m.init=function(p,I,P){this.initMeasureData(p,I),this.cancelStack=P,this.opts=I,this.crossMeasure=new u.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},m.perform=function(){const p=this.getMelismaType();this.setMelismaType(p)},m.getMelismaType=function(){const p=this.hasNextLeftConnection(),I=this.hasLeftConnection();return p?I?_.A.CONTINUE:_.A.START:I?_.A.STOP:null},m.hasNextLeftConnection=function(){if(this.hasNextNote()){const p=this.getNextNote();if(f.default.hasLyricAtLevel(p,this.opts.level)){const I=f.default.getLyricAtLevel(p,this.opts.level);return v.default.hasLeftMelisma(I)}else return!1}else return!1},m.hasNextNote=function(){return this.crossMeasure.hasRightOverflow()?this.measureData.hasNextMeasure()?!!this.crossMeasure.hasRightVoice():!1:!0},m.getNextNote=function(){const p=this.crossMeasure.getRightVoice(),I=this.crossMeasure.getRightNoteIdx();return p.getNote(I)},m.hasLeftConnection=function(){const I=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),P=this.opts.level;if(f.default.hasLyricAtLevel(I,P)){const g=f.default.getLyricAtLevel(I,P);return v.default.hasLeftMelisma(g)}else{const g=`There should be a lyric at the level [${P}].`;throw new h.default("NoNoteAtLevel",g)}},m.setMelismaType=function(p){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};p!==null?(I.melismaType=p,new o(this.measureData,I,this.cancelStack).perform()):new i(this.measureData,I,this.cancelStack).perform()};const D=a},346735:(A,E,t)=>{t.d(E,{A:()=>_});const _=function(f,v){const n=f.getVoiceMainStaffIdx(v.voiceIdx);return f.getStaffDetails(n)}},363258:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(607682);class _ extends h.default{constructor(n){super(f(n)),Object.defineProperty(this,"notationType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="DoesntHaveNotationError",this.notationType=n}}const f=function(v){return`Note doesn't have a notation of the type [${v}].`}},382536:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(364842);const _=function(n){this.voice=n},f=_.prototype;f.forEach=function(n){let l=this.getFirstCursor();for(n(l);this.hasNextEntity(l.noteIdx,l.graceIdx);)l=this.getNextCursor(l.noteIdx,l.graceIdx),n(l)},f.getFirstCursor=function(){if(this.voice.getNbNotes()===0)throw new h.default("Unexpected","Voice should not be empty.");return this.voice.hasGrace(0)?{noteIdx:0,graceIdx:0}:{noteIdx:0,graceIdx:null}},f.hasNextEntity=function(n,l){return typeof l=="number"?this.hasEntityAfterGrace(n,l):this.hasEntityAfterNote(n)},f.hasEntityAfterGrace=function(n,l){return this.voice.assertGraceIdx(n,l),!0},f.hasEntityAfterNote=function(n){this.voice.assertNoteIdx(n);const l=this.voice.getNbNotes();return n+1<l},f.getNextCursor=function(n,l){return typeof l=="number"?this.getCursorAfterGrace(n,l):this.getCursorAfterNote(n)},f.getCursorAfterGrace=function(n,l){const c=this.voice.getNbGraces(n);return l+1<c?{noteIdx:n,graceIdx:l+1}:{noteIdx:n,graceIdx:null}},f.getCursorAfterNote=function(n){return this.voice.hasGrace(n+1)?{noteIdx:n+1,graceIdx:0}:{noteIdx:n+1,graceIdx:null}},f.hasPreviousEntity=function(n,l){return typeof l=="number"?this.hasEntityBeforeGrace(n,l):this.hasEntityBeforeNote(n)},f.hasEntityBeforeGrace=function(n,l){return this.voice.assertGraceIdx(n,l),l>0||n>0},f.hasEntityBeforeNote=function(n){return this.voice.assertNoteIdx(n),this.voice.hasGrace(n)?!0:n>0},f.getPreviousCursor=function(n,l){return typeof l=="number"?this.getCursorBeforeGrace(n,l):this.getCursorBeforeNote(n)},f.getCursorBeforeGrace=function(n,l){return l>0?{noteIdx:n,graceIdx:l-1}:{noteIdx:n-1,graceIdx:null}},f.getCursorBeforeNote=function(n){if(this.voice.hasGrace(n)){const l=this.voice.getNbGraces(n);return{noteIdx:n,graceIdx:l-1}}else return{noteIdx:n-1,graceIdx:null}};const v=_},420771:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(607682);class _ extends h.default{constructor(v){super(`The lyric level [${v}] is invalid.`),Object.defineProperty(this,"lyricLevel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadLyricLevelError",this.lyricLevel=v}}},442044:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(123491),_=t(793317),f=t(852363);const v=function(c,r,d){this.init(c,r,d)};v.NAME="primitive.RemoveLyric";const n=v.prototype;n.name=v.NAME,n.initMeasureData=_.default,n.init=function(c,r,d){this.initMeasureData(c,r),this.cancelStack=d,this.opts=r},n.perform=function(){const r=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);h.default.removeLyricAtLevel(r,this.opts.level),this.updateStack()},n.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,f.default)(this.cancelStack,this.measureData,this.opts)};const l=v},443923:(A,E,t)=>{t.d(E,{A:()=>e});var h=t(364842),_=t(115866),f=t(638908),v=t(160965),n=t(793317),l=t(519405),c=t(601277),r=t(123491);const d=function(s,i,u){this.init(s,i,u)};d.NAME="primitive.UnlockRest";const o=d.prototype;o.name=d.NAME,o.initMeasureData=n.default,o.init=function(s,i,u){this.initMeasureData(s,i),this.cancelStack=u,this.opts=i},o.perform=function(){this.assertRest(),this.removeLyrics(),this.removeFermata(),this.removeColor()},o.assertRest=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).isRest(this.opts.noteIdx))throw new h.default("RestExpected")},o.removeLyrics=function(){const s=this.getNote();if(r.default.getLyrics(s).length===0)return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},u=new _.default(this.measureData,i,this.cancelStack);(0,l.default)(u)},o.removeFermata=function(){const s=this.getNote();if(!r.default.hasNotation(s,c.default.FERMATA))return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,notationType:c.default.FERMATA},u=new f.default(this.measureData,i,this.cancelStack);(0,l.default)(u)},o.removeColor=function(){const s=this.getNote();if(!r.default.hasColor(s))return;const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},u=new v.default(this.measureData,i,this.cancelStack);(0,l.default)(u)},o.getNote=function(){return this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx)};const e=d},445330:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(123491),_=t(511890),f=t(351277);function v(o,e,s){const i=n(o,e);return c(o,s,i)}function n(o,e){const i=o.getLeftChord().find(r,e),u={};return h.default.getSlideStarts(i).forEach(l,u),u}function l(o){const e=this,s=_.default.getNumber(o);e[s]=!0}function c(o,e,s){const u=o.getRightChord().find(r,e);return h.default.getSlideStops(u).some(d,s)}function r(o){const e=this,s=h.default.getPitch(o);return f.default.isSameLine(s,e)}function d(o){const e=this.valueOf(),s=_.default.getNumber(o);return typeof e[s]!="undefined"}},524795:(A,E,t)=>{t.d(E,{A:()=>e});var h=t(793317),_=t(476943),f=t(123491),v=t(724926),n=t(351277),l=t(359932),c=t(369790),r=t(652413);const d=function(s,i,u){this.init(s,i,u)};d.NAME="composite.RemoveHammerOnPullOffs";const o=d.prototype;o.name=d.NAME,o.initMeasureData=h.default,o.init=function(s,i,u){this.initMeasureData(s,i),this.opts=i,this.cancelStack=u},o.perform=function(){let i=this.getVoice().getChord(this.opts.noteIdx);i=_.default.makeArray(i);const u=this.getTechnicalOpts(c.A.START);i.forEach(function(a){if(f.default.hasTechnical(a,l.default.HAMMER_ON,u)||f.default.hasTechnical(a,l.default.PULL_OFF,u)){const m=f.default.getPitch(a);this.removeHammerOnPullOff(m)}},this)},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},o.getTechnicalOpts=function(s){return{hammerOnPullOff:v.A.create(s)}},o.removeHammerOnPullOff=function(s){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:n.default.copy(s)},u=new r.default(this.measureData,i,this.cancelStack);u.checkPreconditions(),u.perform()};const e=d},525766:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(123491),_=t(351277);function f(v){const{pitch:n,fretData:{string:l,fret:c}}=this;if(!h.default.hasFretData(v))return!1;const r=h.default.getPitch(v);if(!_.default.isSameLine(r,n))return!1;const{string:d,fret:o}=h.default.getFretData(v);return!(d!==l||o!==c)}},541909:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(951066);function _(c){return`The notes spacing coeff [${c}] is invalid. It must be a number between 1 and 10.`}class f extends h.A{constructor(r){const d=_(r);super(d),Object.defineProperty(this,"coeff",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadNotesSpacingCoeffError",this.coeff=r}}var v=t(726042);const n={};n.check=function(c){if(!n.isValid(c))throw new f(c)},n.isValid=function(c){return v.default.isNumber(c)&&1<=c&&c<=5};const l=n},545496:(A,E,t)=>{t.d(E,{A:()=>s});var h=t(476943),_=t(123491),f=t(351277),v=t(364596),n=t(382536);const l=function(i,u,a,m,D,p){const I=i.getVoice(a),P=c(I,u,D,p);return typeof P!="undefined"?_.default.getAlter(P):e(i,m,D)},c=function(i,u,a,m){const D=new n.A(i);let p={noteIdx:u,graceIdx:m};for(;D.hasPreviousEntity(p.noteIdx,p.graceIdx);)if(p=D.getPreviousCursor(p.noteIdx,p.graceIdx),r(i,p)){let I=d(i,p);I=h.default.makeArray(I);const P=I.find(o,a);if(typeof P!="undefined")return p.noteIdx===0&&_.default.hasTieStop(P)?void 0:P}},r=function(i,u){return u.graceIdx!==null?!0:!i.isRest(u.noteIdx)},d=function(i,u){return u.graceIdx!==null?i.getGraceChord(u.noteIdx,u.graceIdx):i.getChord(u.noteIdx)},o=function(i){const u=this,a=_.default.getPitch(i);return f.default.isSameLine(a,u)},e=function(i,u,a){const m=f.default.getStep(a),D=i.getKey(u),p=v.default.getFifths(D);return f.default.stepToAlter(m,p)},s=l},550601:(A,E,t)=>{t.d(E,{A:()=>d});var h=t(123491),_=t(351277),f=t(551690);const v=f.A;var n=t(762860),l=t(793317);const c=function(o,e,s){this.init(o,e,s)};c.NAME="composite.RemoveGraceAccidentalIfNeeded";const r=c.prototype;r.initMeasureData=l.default,r.name=c.NAME,r.init=function(o,e,s){this.initMeasureData(o,e),this.cancelStack=s,this.opts=e},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needRemove()&&this.remove()},r.needRemove=function(){const o=this.getGraceAtPitch();return h.default.hasAccidental(o)},r.getGraceAtPitch=function(){const o=this.measureData.getVoice(this.opts.voiceIdx);return(0,n.A)(o,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},r.remove=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:_.default.copy(this.opts.pitch)};new v(this.measureData,o,this.cancelStack).perform()};const d=c},566575:(A,E,t)=>{t.d(E,{A:()=>n});var h=t(476943),_=t(123491);const f=function(l,c,r){let d=l.getChord(c);return d=h.default.makeArray(d),d.find(v,r)},v=function(l){const c=this;if(_.default.hasTabData(l)){const r=_.default.getTabData(l);return r.fret===c.fret&&r.string===c.string}else return!1},n=f},577811:(A,E,t)=>{t.d(E,{A:()=>o});var h=t(123491),_=t(351277),f=t(121720),v=t(691309),n=t(793317),l=t(852363);const c=function(e,s,i){this.init(e,s,i)};c.NAME="primitive.RemoveGlissando";const r=c.prototype;r.name=c.NAME,r.initMeasureData=n.default,r.init=function(e,s,i){this.initMeasureData(e,s),this.opts=s,this.cancelStack=i,this.crossMeasure=new v.default(this.measureData,s.voiceIdx,s.noteIdx)},r.perform=function(){this.removeGlissando(),this.updateStack()},r.removeGlissando=function(){const e=this.getNumber();this.removeGlissandoToLeftNote(e),this.removeGlissandoToRightNote(e)},r.getNumber=function(){return(0,f.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch)},r.removeGlissandoToLeftNote=function(e){const i=this.crossMeasure.getLeftChord().find(d,this.opts.leftPitch);h.default.removeGlissandoStart(i,e)},r.removeGlissandoToRightNote=function(e){const i=this.crossMeasure.getRightChord().find(d,this.opts.rightPitch);h.default.removeGlissandoStop(i,e)};function d(e){const s=this,i=h.default.getPitch(e);return _.default.isSameLine(i,s)}r.updateStack=function(){const e=this.crossMeasure.getLeftMeasureIdx(),s=this.crossMeasure.getRightMeasureIdx(),i=this.opts.partIdx,u={type:this.name,opts:{partIdx:i,measureIdx:e}};this.cancelStack.push(u),(0,l.default)(this.cancelStack,this.measureData,{partIdx:i,measureIdx:e});const a={type:`${this.name}-close`,opts:{partIdx:i,measureIdx:s}};this.cancelStack.push(a),s!==e&&(0,l.default)(this.cancelStack,this.measureData,{partIdx:i,measureIdx:s})};const o=c},582558:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(951066);function _(v){return`The add note source [${v}] is invalid.`}class f extends h.A{constructor(n){const l=_(n);super(l),Object.defineProperty(this,"addNoteSource",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadAddNoteSourceError",this.addNoteSource=n}}},599888:(A,E,t)=>{t.d(E,{A:()=>o});var h=t(793317),_=t(724095),f=t(123491),v=t(852363);const n=function(e,s,i){this.init(e,s,i)};n.NAME="primitive.RemoveTremolo2";const l=n.prototype;l.name=n.NAME,l.initMeasureData=h.default,l.init=function(e,s,i){this.initMeasureData(e,s),this.cancelStack=i,this.opts=s},l.perform=function(){const e=this.measureData.getVoice(this.opts.voiceIdx);this.removeLeftSide(e),this.removeRightSide(e),this.updateStack()},l.removeLeftSide=function(e){const s=e.getNote(this.opts.noteIdx);f.default.removeOrnament(s,_.A.TREMOLO)},l.removeRightSide=function(e){const s=e.getNote(this.opts.noteIdx+1);f.default.removeOrnament(s,_.A.TREMOLO)},l.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const c=n,r=function(e,s,i){this.init(e,s,i)};r.NAME="composite.RemoveTremolo2";const d=r.prototype;d.name=r.NAME,d.init=function(e,s,i){h.default.call(this,e,s),this.cancelStack=i,this.opts=s,this.voice=null},d.perform=function(){this.removeTremolo()},d.removeTremolo=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new c(this.measureData,e,this.cancelStack).perform()};const o=r},607512:(A,E,t)=>{t.d(E,{A:()=>D});var h=t(123491),_=t(351277),f=t(511890),v=t(364842);function n(p,I,P){const g=l(p,I),M=r(p,P,g);if(M===null)throw new v.default("Unexpected",`There is no slide stop matching the 
    left pitch ${_.default.stringify(I)} with the right pitch 
    ${_.default.stringify(P)}`);return M}function l(p,I){const g=p.getLeftChord().find(d,I),M={};return h.default.getSlideStarts(g).forEach(c,M),M}function c(p){const I=this,P=f.default.getNumber(p);I[P]=!0}function r(p,I,P){const M=p.getRightChord().find(d,I),x=h.default.getSlideStops(M).find(o,P);return x?f.default.getNumber(x):null}function d(p){const I=this,P=h.default.getPitch(p);return _.default.isSameLine(P,I)}function o(p){const I=this.valueOf(),P=f.default.getNumber(p);return typeof I[P]!="undefined"}var e=t(691309),s=t(793317),i=t(852363);const u=function(p,I,P){this.init(p,I,P)};u.NAME="primitive.RemoveSlide";const a=u.prototype;a.name=u.NAME,a.initMeasureData=s.default,a.init=function(p,I,P){this.initMeasureData(p,I),this.opts=I,this.cancelStack=P,this.crossMeasure=new e.default(this.measureData,I.voiceIdx,I.noteIdx)},a.perform=function(){this.removeSlide(),this.updateStack()},a.removeSlide=function(){const p=this.getNumber();this.removeSlideToLeftNote(p),this.removeSlideToRightNote(p)},a.getNumber=function(){return n(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch)},a.removeSlideToLeftNote=function(p){const P=this.crossMeasure.getLeftChord().find(m,this.opts.leftPitch);h.default.removeSlideStart(P,p)},a.removeSlideToRightNote=function(p){const P=this.crossMeasure.getRightChord().find(m,this.opts.rightPitch);h.default.removeSlideStop(P,p)};function m(p){const I=this,P=h.default.getPitch(p);return _.default.isSameLine(P,I)}a.updateStack=function(){const p=this.crossMeasure.getLeftMeasureIdx(),I=this.crossMeasure.getRightMeasureIdx(),P=this.opts.partIdx,g={type:this.name,opts:{partIdx:P,measureIdx:p}};this.cancelStack.push(g),(0,i.default)(this.cancelStack,this.measureData,{partIdx:P,measureIdx:p});const M={type:`${this.name}-close`,opts:{partIdx:P,measureIdx:I}};this.cancelStack.push(M),I!==p&&(0,i.default)(this.cancelStack,this.measureData,{partIdx:P,measureIdx:I})};const D=u},644370:(A,E,t)=>{t.d(E,{A:()=>c});var h=t(364842),_=t(123491),f=t(793317),v=t(852363);const n=function(r,d,o){this.init(r,d,o)};n.NAME="primitive.RemoveColorFromRest";const l=n.prototype;l.name=n.NAME,l.initMeasureData=f.default,l.init=function(r,d,o){this.initMeasureData(r,d),this.cancelStack=o,this.opts=d},l.perform=function(){this.removeColor(),this.updateStack()},l.removeColor=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!_.default.isRest(d))throw new h.default("RestExpected");_.default.removeColor(d)},l.updateStack=function(){const r={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(r),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const c=n},645166:(A,E,t)=>{t.d(E,{A:()=>m});var h=t(123491),_=t(351277),f=t(916045),v=t(728675),n=t(689582),l=t(550601),c=t(545496),r=t(578918),d=t(762860),o=t(382536),e=t(793317);const s=function(D,p,I){this.init(D,p,I)};s.NAME="composite.UpdateAccidental";const i=s.prototype;i.initMeasureData=e.default,i.name=s.NAME,i.init=function(D,p,I){this.initMeasureData(D,p),this.cancelStack=I,this.opts=p},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);let D=this.getPreviousAlter();this.isFirstNoteAndLeftTied()?this.removeAccidental(this.opts.noteIdx,null):D=this.updateCurrentAccidental(D),this.updateNextAccidental(D)},i.getPreviousAlter=function(){return(0,c.A)(this.measureData,this.opts.noteIdx,this.opts.voiceIdx,this.opts.staffIdx,this.opts.pitch,null)},i.isFirstNoteAndLeftTied=function(){if(this.opts.noteIdx>0)return!1;const D=this.getNoteAtPitch();return!(!D||!h.default.hasTieStop(D))},i.updateCurrentAccidental=function(D){const p=this.getNoteAtPitch();if(typeof p!="undefined"){const I=h.default.getPitch(p),P=_.default.getAlter(I);return this.updateAccidental(p,this.opts.noteIdx,D,null),P}else return D},i.getNoteAtPitch=function(){const D=this.measureData.getVoice(this.opts.voiceIdx);if(!D.isRest(this.opts.noteIdx))return(0,r.default)(D,this.opts.noteIdx,this.opts.pitch)},i.updateNextAccidental=function(D){const p=this.measureData.getVoice(this.opts.voiceIdx),I=u(p,this.opts.noteIdx,this.opts.pitch);if(I!==null){const P=this.getNextNoteAtPitch(I);this.updateAccidental(P,I.noteIdx,D,I.graceIdx)}},i.getNextNoteAtPitch=function(D){const p=this.measureData.getVoice(this.opts.voiceIdx);return D.graceIdx===null?(0,r.default)(p,D.noteIdx,this.opts.pitch):(0,d.A)(p,D.noteIdx,D.graceIdx,this.opts.pitch)};const u=function(D,p,I){const P=new o.A(D);let g={noteIdx:p,graceIdx:null};for(;P.hasNextEntity(g.noteIdx,g.graceIdx);)if(g=P.getNextCursor(g.noteIdx,g.graceIdx),a(D,g)&&typeof(0,r.default)(D,g.noteIdx,I,g.graceIdx)!="undefined")return g;return null},a=function(D,p){return p.graceIdx!==null?!0:!D.isRest(p.noteIdx)};i.updateAccidental=function(D,p,I,P){const g=h.default.getPitch(D),M=_.default.getAlter(g);if(M===I)this.removeAccidental(p,P);else{const O=_.default.alterToAccidental(M);this.addAccidental(p,O,P)}},i.removeAccidental=function(D,p){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:D,pitch:_.default.copy(this.opts.pitch)};let P;p===null?P=new n.A(this.measureData,I,this.cancelStack):(I.graceIdx=p,P=new l.A(this.measureData,I,this.cancelStack)),P.perform()},i.addAccidental=function(D,p,I){const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:D,pitch:_.default.copy(this.opts.pitch),accidental:p};let g;I===null?g=new f.A(this.measureData,P,this.cancelStack):(P.graceIdx=I,g=new v.A(this.measureData,P,this.cancelStack)),g.perform()};const m=s},653631:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(364842),_=t(123491);const v=function(n,l,c){let r=0;const d=n.size();let o;for(o=0;o<d-1&&r<c;o++){const e=n.getNote(o),s=_.default.getDuration(e);r+=s*l}if(r===c)return o;{const e=`There is no noteIdx for time position [${c}].`;throw new h.default("Unexpected",e)}}},663534:(A,E,t)=>{t.d(E,{A:()=>r});var h=t(992781),_=t(476943),f=t(890439),v=t(423790),n=t(726042);const l=4;function c(u){u.length===0&&(u=[0]);let a=u.reduce(n.default.min2),m=u.reduce(n.default.max2);const D=m-a;let p=l-D;return p=Math.max(p,0),m+=p,a-=p,a=Math.max(a,0),{maxFret:m,minFret:a}}function r(u,a,m){_.default.isArray(m)||(m=[]);const D=m.map(d),p=c(D),I=m.map(o),P=f.Ay.fromList(I);let g=(0,v.A)(u,a);if(g=g.filter(e,P),g.forEach(s,p),g.sort(i),g.length===0)throw new h.A(u);{const[M]=g;return{string:M.string,fret:M.fret}}}function d({fret:u}){return u}function o({string:u}){return u}function e({string:u}){return typeof this[u]=="undefined"}function s(u){const{minFret:a,maxFret:m}=this,{fret:D}=u;u.isInInterval=D>=a&&D<=m}function i(u,a){return u.isInInterval===!0&&a.isInInterval===!1?-1:u.isInInterval===!1&&a.isInInterval===!0?1:u.fret-a.fret}},689582:(A,E,t)=>{t.d(E,{A:()=>d});var h=t(123491),_=t(351277),f=t(49906);const v=f.default;var n=t(578918),l=t(793317);const c=function(o,e,s){this.init(o,e,s)};c.NAME="composite.RemoveAccidentalIfNeeded";const r=c.prototype;r.initMeasureData=l.default,r.name=c.NAME,r.init=function(o,e,s){this.initMeasureData(o,e),this.cancelStack=s,this.opts=e},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needRemove()&&this.remove()},r.needRemove=function(){const o=this.getNoteAtPitch();return h.default.hasAccidental(o)},r.getNoteAtPitch=function(){const o=this.measureData.getVoice(this.opts.voiceIdx);return(0,n.default)(o,this.opts.noteIdx,this.opts.pitch)},r.remove=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:_.default.copy(this.opts.pitch)};new v(this.measureData,o,this.cancelStack).perform()};const d=c},727867:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(607682);class _ extends h.default{constructor(v){super("There is no fret data linked to this note."),Object.defineProperty(this,"pitch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="NoFretDataError",this.pitch=v}}},728675:(A,E,t)=>{t.d(E,{A:()=>d});var h=t(123491),_=t(351277),f=t(749138);const v=f.A;var n=t(762860),l=t(793317);const c=function(o,e,s){this.init(o,e,s)};c.NAME="composite.SetGraceAccidentalIfNeeded";const r=c.prototype;r.initMeasureData=l.default,r.name=c.NAME,r.init=function(o,e,s){this.initMeasureData(o,e),this.cancelStack=s,this.opts=e},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSet()&&this.setAccidental()},r.needSet=function(){const o=this.getGraceAtPitch();if(h.default.hasAccidental(o)){const e=h.default.getAccidental(o);return this.opts.accidental!==e}else return!0},r.getGraceAtPitch=function(){const o=this.measureData.getVoice(this.opts.voiceIdx);return(0,n.A)(o,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},r.setAccidental=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:_.default.copy(this.opts.pitch),accidental:this.opts.accidental};new v(this.measureData,o,this.cancelStack).perform()};const d=c},736252:(A,E,t)=>{t.d(E,{A:()=>D});var h=t(59377);const f={INVALIDATED:"INVALIDATED",DEFAULT:"unsetted",LOCAL:"local",UNDO:"undo",REDO:"redo",REMOTE:"remote"};var v=t(31278),n=t(607682),l=t(330369),c=t(951066),r=t(364842),d=t(737903),o=t(878639);const e="noop",s=function(p){return function(I,P){if(I.actionOrigin===f.INVALIDATED)throw new r.default("InvalidatedOpts","Using invalidated opts.");const g=this;g.assertWritable(),g.lockDataWrite(`edit-${p.NAME}`);let M;const O=`adagio.${p.NAME}`;o.HAS_PERF_API&&performance.mark(`${O}.s`);try{(function(){P=P||new h.default,P.resetAction();const x=new p(g,I,P);let S=!0;try{x.checkPreconditions()}catch(T){if(T instanceof v.default||T instanceof l.A)S=!1;else throw T}if(S){g.stateHasChanged();try{x.perform()}catch(T){T instanceof l.A||i(x,T)}}else P.createSubstack(e);M=P.getActions(),M.forEach(a,I),I.actionOrigin=f.INVALIDATED,typeof I.logs!="undefined"&&M.forEach(m,I.logs)}).call(this),g.unlockDataWrite()}catch(x){throw g.unlockDataWrite(),o.HAS_PERF_API&&(performance.mark(`${O}.e`),performance.measure(O,`${O}.s`,`${O}.e`)),x}return o.HAS_PERF_API&&(performance.mark(`${O}.e`),performance.measure(O,`${O}.s`,`${O}.e`)),M}},i=function(p,I){if(!u(I))throw I;const P=`Error while performing action [${p.name}]: ${I.message}`,g=new r.default("Unexpected",P);throw g.cause=I,g},u=function(p){return p instanceof n.default||p instanceof v.default||p instanceof c.A},a=function(p){const P=this.actionOrigin||f.DEFAULT;p.opts.settedOrigin=P},m=function(p){const I=this;p.opts.logs=(0,d.default)(I)},D=s},742735:(A,E,t)=>{t.d(E,{A:()=>o});var h=t(123491),_=t(351277),f=t(292681),v=t(353922);const n={};n.tieChords=function(e,s,i){n.getUntiedPairs(e,s,i).forEach(n.tiePair)},n.canTieChords=function(e,s,i){return n.getUntiedPairs(e,s,i).length>0},n.getUntiedPairs=function(e,s,i){return n.getMatchingNotes(e,s,i).filter(n.isPairUntied)},n.untieChords=function(e,s,i){n.getTiedPairs(e,s,i).forEach(n.untiePair)},n.canUntieChords=function(e,s,i){return n.getTiedPairs(e,s,i).length>0},n.getTiedPairs=function(e,s,i){return n.getMatchingNotes(e,s,i).filter(n.isPairTied)},n.getMatchingNotes=function(e,s,i){const u=i?r:c;e=e.slice(),s=s.slice(),e.sort(u),s.sort(u);let a=0;for(;a<e.length&&a<s.length;){const D=e[a],p=s[a],I=u(D,p);I>0?s.splice(a,1):I<0?e.splice(a,1):a++}let m;return a<e.length?(m=e.length-a,e.splice(a,m)):a<s.length&&(m=s.length-a,s.splice(a,m)),l(e,s)};const l=function(e,s){const i=[];return e.forEach(function(u,a){const m=s[a],D={left:u,right:m};i.push(D)}),i},c=function(e,s){const i=h.default.getPitch(e),u=h.default.getPitch(s);return _.default.naiveComparePitch(i,u)},r=function(e,s){const i=h.default.getUnpitched(e),u=h.default.getUnpitched(s),a=f.default.compare(i,u);return a!==0?a:d(e,s)},d=function(e,s){const i=h.default.getHead(e),u=h.default.getHead(s);return v.A.getNoteHeadIdx(i)-v.A.getNoteHeadIdx(u)};n.isPairUntied=function(e){return!n.isPairTied(e)},n.isPairTied=function(e){return n.areNotesTied(e.left,e.right)},n.areNotesTied=function(e,s){return h.default.hasTieStart(e)&&h.default.hasTieStop(s)},n.untiePair=function(e){n.untieNotes(e.left,e.right)},n.untieNotes=function(e,s){h.default.removeTieStart(e),h.default.removeTieStop(s)},n.tiePair=function(e){n.tieNotes(e.left,e.right)},n.tieNotes=function(e,s){h.default.addTieStart(e),h.default.addTieStop(s)};const o=n},748478:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(39573);const _=h.A},754272:(A,E,t)=>{t.d(E,{A:()=>e});var h=t(345912),_=t(748478),f=t(79869),v=t(364842);const n=function(s,i){const u=l(s,i);u&&o(u,i)},l=function(s,i){return c(i)(s,i)},c=function(s){if(r(s))return f.A;if(d(s))return _.A;throw new v.default("Unexpected")},r=function(s){return typeof s.timePos=="number"&&typeof s.divisions=="number"},d=function(s){return typeof s.noteIdx=="number"},o=function(s,i){i.line=h.A.removeShiftFromLine(s,i.line)},e=n},760147:(A,E,t)=>{t.d(E,{A:()=>l});var h=t(951066);function _(c){return`the page numbering start value [${c}] is invalid.`}class f extends h.A{constructor(r){const d=_(r);super(d),Object.defineProperty(this,"pageNumberingStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadPageNumberingStartError",this.pageNumberingStart=r}}var v=t(726042);const n={};n.check=function(c){if(!n.isValid(c))throw new f(c)},n.isValid=function(c){return v.default.isInteger(c)&&c>=1};const l=n},762860:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(161733);const _=h.A},765350:(A,E,t)=>{t.d(E,{A:()=>d});var h=t(518558),_=t(209175),f=t(515819),v=t(259563),n=t(3771),l=t(793317);const c=function(o,e,s){this.init(o,e,s)};c.NAME="composite.AdaptDpqToTimeSignature";const r=c.prototype;r.initMeasureData=l.default,r.name=c.NAME,r.init=function(o,e,s){this.initMeasureData(o,e),this.cancelStack=s,this.opts=e},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpqToDuration()},r.adaptDpqToDuration=function(){const o=this.measureData.getAnyTime(),e=h.default.getBeatType(o),s=f.default.beatTypeToQuarter(e),i=v.default.quarterToDurationType(s),u=_.default.createDefault(),a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:i,nbDots:0,timeModif:u};new n.A(this.measureData,a,this.cancelStack).perform()};const d=c},766457:(A,E,t)=>{t.d(E,{A:()=>c});var h=t(236378),_=t(737903),f=t(123491),v=t(351277),n=t(566575);const c=function(r,d){const o=r.getVoice(d.voiceIdx),e=(0,n.A)(o,d.noteIdx,d.fretData);if(typeof e!="undefined"){let s=f.default.getPitch(e);return s=v.default.copy(s),s}else{const s=(0,_.default)(d.fretData);throw new h.A(s)}}},797698:(A,E,t)=>{t.d(E,{A:()=>r});var h=t(123491),_=t(210052),f=t(442044),v=t(793317),n=t(691309);const l=function(d,o,e){this.init(d,o,e)};l.NAME="primitive.RemoveLyric";const c=l.prototype;c.name=l.NAME,c.initMeasureData=v.default,c.init=function(d,o,e){this.initMeasureData(d,o),this.cancelStack=e,this.opts=o,this.crossMeasure=new n.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},c.perform=function(){this.removeLyric(),this.hasLyricAfter()&&this.updateNextSyllabicType()},c.removeLyric=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new f.A(this.measureData,d,this.cancelStack).perform()},c.hasLyricAfter=function(){if(this.hasNoteAfter()){const d=this.getNoteAfter();return h.default.hasLyricAtLevel(d,this.opts.level)}else return!1},c.hasNoteAfter=function(){return this.crossMeasure.hasRightOverflow()?this.measureData.hasNextMeasure()?!!this.crossMeasure.hasRightVoice():!1:!0},c.getNoteAfter=function(){const d=this.crossMeasure.getRightVoice(),o=this.crossMeasure.getRightNoteIdx();return d.getNote(o)},c.updateNextSyllabicType=function(){const d=this.crossMeasure.getRightMeasureIdx(),o=this.crossMeasure.getRightMeasure(),e=this.crossMeasure.getRightNoteIdx(),s={partIdx:this.opts.partIdx,measureIdx:d,voiceIdx:this.opts.voiceIdx,noteIdx:e,level:this.opts.level};new _.A(o,s,this.cancelStack).perform()};const r=l},800946:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(607682);class _ extends h.default{constructor(){super("This operation is not possible on nontab."),this.name="NotPossibleOnNonTabError"}}},803192:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(346735),_=t(104907);const v=function(n,l){const c=(0,h.A)(n,l);return _.default.getNbStaffLines(c)}},804617:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(908300);const _=h.A},807205:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(607682);const _=function(v,n){let l=`cannot perform tie operation ${v}`;return n&&(l+=`: ${n}`),l};class f extends h.default{constructor(n,l){super(_(n,l)),Object.defineProperty(this,"actionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TieError",this.actionName=n}}},810663:(A,E,t)=>{t.d(E,{A:()=>u});var h=t(691309),_=t(793317),f=t(578918),v=t(852363),n=t(123491);const l=function(a,m,D){this.init(a,m,D)};l.NAME="primitive.RemoveHammerOnPullOffSide";const c=l.prototype;c.name=l.NAME,c.initMeasureData=_.default,c.init=function(a,m,D){this.initMeasureData(a,m),this.opts=m,this.cancelStack=D},c.perform=function(){const a=this.measureData.getVoice(this.opts.voiceIdx),m=(0,f.default)(a,this.opts.noteIdx,this.opts.pitch);n.default.hasTechnical(m,this.opts.technicalType,this.opts.technicalOpts)&&n.default.removeTechnical(m,this.opts.technicalType,this.opts.technicalOpts),this.updateStack()},c.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx}};this.cancelStack.push(a),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const r=l;var d=t(724926),o=t(351277),e=t(369790);const s=function(a,m,D){this.init(a,m,D)};s.NAME="composite.RemoveHammerOnPullOff";const i=s.prototype;i.name=s.NAME,i.initMeasureData=_.default,i.init=function(a,m,D){this.initMeasureData(a,m),this.opts=m,this.cancelStack=D,this.crossMeasure=new h.default(this.measureData,m.voiceIdx,m.noteIdx),this.leftNote=null,this.rightNote=null},i.perform=function(){this.removeStartHammerOnPullOff(),this.removeStopHammerOnPullOff()},i.removeStartHammerOnPullOff=function(){const a=this.getTechnicalOpts(e.A.START),m=this.getLeftNote(),D={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:a,pitch:n.default.getPitch(m)};new r(this.crossMeasure.getLeftMeasure(),D,this.cancelStack).perform()},i.removeStopHammerOnPullOff=function(){const a=this.getTechnicalOpts(e.A.STOP),m=this.getRightNote(),D={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:a,pitch:n.default.getPitch(m)};new r(this.crossMeasure.getRightMeasure(),D,this.cancelStack).perform()},i.getTechnicalOpts=function(a){return{hammerOnPullOff:d.A.create(a)}},i.getLeftNote=function(){if(this.leftNote===null){const a=this.crossMeasure.getLeftChord();this.leftNote=a.find(this.pitchPredicate,this)}return this.leftNote},i.pitchPredicate=function(a){const m=n.default.getPitch(a);return o.default.isSameLine(m,this.opts.pitch)},i.getRightNote=function(){if(this.rightNote===null){const a=this.getLeftNote(),m=this.crossMeasure.getRightChord(),D=n.default.getFretData(a);this.rightNote=m.find(this.stringPredicate,D)}return this.rightNote},i.stringPredicate=function(a){const m=this;return n.default.getFretData(a).string===m.string};const u=s},817490:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(951066);function _(v){return`Notation ${v}is invalid.`}class f extends h.A{constructor(n){const l=_(n);super(l),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadNotationTypeError",this.type=n}}},821828:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(607682);class _ extends h.default{constructor(){super("There is no hammer-on/pull-off at this location."),this.name="NoHammerOnPullOffToRemove"}}},823722:(A,E,t)=>{t.d(E,{A:()=>d});var h=t(364842),_=t(123491),f=t(737296),v=t(901095),n=t(804617),l=t(793317);const c=function(o,e,s){this.init(o,e,s)};c.NAME="composite.RemoveRests";const r=c.prototype;r.name=c.NAME,r.initMeasureData=l.default,r.init=function(o,e,s){this.initMeasureData(o,e),this.cancelStack=s,this.opts=e},r.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.insertMode===f.default.INSERT)this.removeAtEnd();else if(this.opts.insertMode===f.default.REPLACE)this.removeAtIdx();else{const o=`Unexpected insert mode: [${this.opts.insertMode}].`;throw new h.default("Unexpected",o)}},r.removeAtEnd=function(){let o=this.opts.duration;const e=this.getVoice();for(let s=e.getStopNoteIdx();o>0;s--)o=this.processRest(s,o)},r.removeAtIdx=function(){let o=this.opts.duration;for(;o>0;)o=this.processRest(this.opts.noteIdx,o)},r.processRest=function(o,e){const i=this.getVoice().getNote(o),u=_.default.getDuration(i);if(u<=e)e-=u,this.removeRest(o);else{const a=u-e;e=0;const m=_.default.getStaffIdx(i);this.removeRest(o),this.restoreRest(o,a,m)}return e},r.getVoice=function(){const o=this.opts.voiceIdx,e=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(o,e)},r.removeRest=function(o){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:o};new n.A(this.measureData,e,this.cancelStack).perform()},r.restoreRest=function(o,e,s){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:s,noteIdx:o,duration:e,insertMode:this.opts.insertMode};new v.A(this.measureData,i,this.cancelStack).perform()};const d=c},831250:(A,E,t)=>{t.d(E,{A:()=>n});var h=t(803192),_=t(414787),f=t(292681);const n=function(){if(typeof this.opts.line!="undefined"){const l=(0,h.A)(this.measureData,this.opts),c=_.A.lineToPitch(this.opts.line,l);this.opts["display-octave"]=f.default.getOctave(c),this.opts["display-step"]=f.default.getStep(c),delete this.opts.line}}},857579:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(832560);const _=h.A},890294:(A,E,t)=>{t.d(E,{A:()=>r});var h=t(123491),_=t(330751),f=t(442044),v=t(793317),n=t(691309);const l=function(d,o,e){this.init(d,o,e)};l.NAME="primitive.RemoveLyricMelisma";const c=l.prototype;c.name=l.NAME,c.initMeasureData=v.default,c.init=function(d,o,e){this.initMeasureData(d,o),this.cancelStack=e,this.opts=o,this.crossMeasure=new n.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)},c.perform=function(){this.removeLyric(),this.hasLyricBefore()&&this.updatePreviousSyllabicType()},c.removeLyric=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new f.A(this.measureData,d,this.cancelStack).perform()},c.hasLyricBefore=function(){if(this.hasNoteBefore()){const d=this.getNoteBefore();return h.default.hasLyricAtLevel(d,this.opts.level)}else return!1},c.hasNoteBefore=function(){return this.crossMeasure.hasLeftOverflow()?this.measureData.hasPreviousMeasure()?!!this.crossMeasure.hasLeftVoice():!1:!0},c.getNoteBefore=function(){const d=this.crossMeasure.getLeftVoice(),o=this.crossMeasure.getLeftNoteIdx();return d.getNote(o)},c.updatePreviousSyllabicType=function(){const d=this.crossMeasure.getLeftMeasureIdx(),o=this.crossMeasure.getLeftMeasure(),e=this.crossMeasure.getLeftNoteIdx(),s={partIdx:this.opts.partIdx,measureIdx:d,voiceIdx:this.opts.voiceIdx,noteIdx:e,level:this.opts.level};new _.A(o,s,this.cancelStack).perform()};const r=l},901095:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(469019);const _=h.A},916045:(A,E,t)=>{t.d(E,{A:()=>d});var h=t(123491),_=t(351277),f=t(275722);const v=f.default;var n=t(578918),l=t(793317);const c=function(o,e,s){this.init(o,e,s)};c.NAME="composite.SetAccidentalIfNeeded";const r=c.prototype;r.initMeasureData=l.default,r.name=c.NAME,r.init=function(o,e,s){this.initMeasureData(o,e),this.cancelStack=s,this.opts=e},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSet()&&this.setAccidental()},r.needSet=function(){const o=this.getNoteAtPitch();if(h.default.hasAccidental(o)){const e=h.default.getAccidental(o);return this.opts.accidental!==e}else return!0},r.getNoteAtPitch=function(){const o=this.measureData.getVoice(this.opts.voiceIdx);return(0,n.default)(o,this.opts.noteIdx,this.opts.pitch)},r.setAccidental=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:_.default.copy(this.opts.pitch),accidental:this.opts.accidental};new v(this.measureData,o,this.cancelStack).perform()};const d=c},927403:(A,E,t)=>{t.d(E,{A:()=>v});var h=t(800946),_=t(243183);const v=function(n,l){if(n=(0,_.A)(n),!n.isPartTab(l.partIdx))throw new h.A}},941837:(A,E,t)=>{t.d(E,{A:()=>i});var h=t(351277),_=t(123491),f=t(511890),v=t(417477),n=t(793317),l=t(691309),c=t(24724);const r=c.A;var d=t(519405);const o=function(u,a,m){this.init(u,a,m)};o.NAME="composite.RemoveHeadRightSlides";const e=o.prototype;e.name=o.NAME,e.initMeasureData=n.default,e.init=function(u,a,m){this.initMeasureData(u,a),this.opts=a,this.cancelStack=m,this.crossMeasure=new l.default(this.measureData,a.voiceIdx,a.noteIdx)},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHeadRightSlides()},e.removeHeadRightSlides=function(){this.getSlideStarts().map(f.default.getNumber).map(this.findRightPitch,this).forEach(this.removeSlide,this)},e.getSlideStarts=function(){const a=this.crossMeasure.getLeftChord().find(s,this.opts.pitch);return _.default.getSlideStarts(a)};function s(u){const a=this,m=_.default.getPitch(u);return h.default.isSameLine(m,a)}e.findRightPitch=function(u){return r(this.crossMeasure,u)},e.removeSlide=function(u){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:h.default.copy(this.opts.pitch),rightPitch:h.default.copy(u)},m=new v.default(this.measureData,a,this.cancelStack);(0,d.default)(m)};const i=o},964039:(A,E,t)=>{t.d(E,{A:()=>_});var h=t(759240);const _=h.A},992781:(A,E,t)=>{t.d(E,{A:()=>f});var h=t(607682);function _(v){return`No fret found for pitch [${JSON.stringify(v)}]`}class f extends h.default{constructor(n){const l=_(n);super(l),Object.defineProperty(this,"pitch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="NoFretFound",this.pitch=n}}}}]);})();


//# debugId=ab58ce94-c93d-5902-b55e-c284aa382338
