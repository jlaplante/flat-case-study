"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="911a6cf2-eb30-5269-bef0-d2e35aa0867c")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[76400],{10533:(j,x,t)=>{t.r(x),t.d(x,{default:()=>o});var C=t(195446),W=t(748803),T=t(632879),D=t(569445),v=t(31278),M=t(123491),A=t(351277),U=t(476943),O=t(377180),L=t(205043),E=t(898039),I=t(52275),g=t(704621),m=t(981801),d=t(519405),a=t(509319),r=t(793317),c=t(42651);const s=function(h,_,p){this.init(h,_,p)};s.NAME="action.TransposeGraceChord";const i=s.prototype;i.name=s.NAME,i.initMeasureData=r.default,i.init=function(h,_,p){(0,I.default)(h,_),(0,g.default)(h,_),(0,m.default)(h,_),this.initMeasureData(h,_),this.cancelStack=p,this.opts=_,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},i.checkPreconditions=function(){if(this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,E.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),O.default.check(this.opts.transpose),this.sanitizeIfNeeded(),O.default.isIdentity(this.opts.transpose))throw new v.default;const h=this.getWrappedActions();if(!h.some(n))throw h[0].error};const n=function(h){try{h.action.checkPreconditions()}catch(_){if(e(_))return h.checked=!0,h.error=_,!1;throw _}return h.checked=!0,!0};i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,E.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},i.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const h=this.getLocation(),_=O.default.copy(this.opts.transpose),p={partUuid:h.partUuid,measureUuid:h.measureUuid,voiceUuid:h.voiceUuid,divisions:h.dpq,timePos:h.timePos,transpose:_,checkLine:this.opts.checkLine,preserveColor:!!this.opts.preserveColor},f={actionName:this.name,opts:p};this.cancelStack.storeAction(f)}},i.getLocation=function(){if(this.location===null){const h=this.measureData.getScoreData(),_=h.getPartUuid(this.opts.partIdx),p=h.getMeasureUuid(this.opts.measureIdx),f=h.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),l=this.measureData.getDpqValue(),u=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:_,measureUuid:p,voiceUuid:f,dpq:l,timePos:u}}return this.location},i.getWrappedActions=function(){return this.wrappedActions===null&&this.createWrappedActions(),this.wrappedActions},i.createWrappedActions=function(){let _=this.getVoice().getGraceChord(this.opts.noteIdx,this.opts.graceIdx);_=U.default.makeArray(_);let p=_.map(M.default.getPitch);p=(0,a.A)(p,this.opts.transpose),this.wrappedActions=p.map(this.createWrappedAction,this)},i.createWrappedAction=function(h){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:A.default.copyWithoutAlter(h),transpose:O.default.copy(this.opts.transpose),checkLine:this.opts.checkLine,preserveColor:this.opts.preserveColor},p=null;return{action:new L.default(this.measureData,_,p),error:null,checked:!1}},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},i.callPerform=function(h){h.error===null&&(h.action.cancelStack=this.cancelStack,h.checked?h.action.perform():(0,d.default)(h.action,e))};const e=function(h){return h instanceof W.default||h instanceof T.A||h instanceof D.A||h instanceof v.default};(0,c.default)(s);const o=s},19551:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(244616),A=t(466032),U=t(578918),O=t(19405),L=t(476031),E=t(898039),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(287296),r=t(793317),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.AddColorToNote",s.isNoChange=function(e){return e instanceof C.default};const i=s.prototype;i.name=s.NAME,i.initMeasureData=r.default,i.init=function(e,o,h){(0,I.default)(e,o),(0,g.default)(e,o),(0,m.default)(e,o),(0,d.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.noteHead=null,this.voice=null,this.location=null},i.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,E.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkDifferentFingering()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkValues=function(){(0,O.default)(this.opts),M.default.check(this.opts.color)},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,L.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts)},i.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const o=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,o)}},i.checkDifferentFingering=function(){const e=this.getNoteAtPitch();if(D.default.hasColor(e)&&D.default.getColor(e)===this.opts.color)throw new C.default},i.getNoteAtPitch=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,U.default)(e,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addColorToNote(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,color:this.opts.color},h={actionName:this.name,opts:o};this.cancelStack.storeAction(h)}},i.addColorToNote=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),color:this.opts.color};new A.default(this.measureData,e,this.cancelStack).perform()},i.updateStack=function(){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch)},h={type:this.name,noDraw:!0,opts:o};this.cancelStack.push(h)},i.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),l=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:h,voiceUuid:_,dpq:p,timePos:l,isConcertPitch:!1}}return this.location},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},24443:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(702544),W=t(153271),T=t(443749),D=t(646456),v=t(31278),M=t(701387),A=t(726042),U=t(536949),O=t(438896),L=t(316610),E=t(52275),I=t(704621),g=t(783177),m=t(42651);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemovePizzicatoAtTimePos",d.isAuthorizedException=function(c){return c instanceof C.default||c instanceof W.default||c instanceof T.default||c instanceof D.A||c instanceof v.default};const a=d.prototype;a.name=d.NAME,a.init=function(c,s,i){(0,E.default)(c,s),(0,I.default)(c,s),(0,g.default)(c,s),this.scoreData=c,this.cancelStack=i,this.opts=s,this.measure=null,this.pizzicatos=null,this.location=null,this.pizzicatoIdx=null,this.localTimePos=null},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let c=!0;try{this.checkPreconditions()}catch(s){if(d.isAuthorizedException(s))c=!1;else throw s}return c},a.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const c=this.getMeasure(),s=M.default.getNbStaves(c),i=this.opts.staffIdx;if(!A.default.isNumber(i)||i<0||i>=s)throw new T.default(i)},a.checkTimePos=function(){const c=this.getLocalTimePos(),s=this.getMeasure(),i=M.default.getNbDivisions(s);if(!A.default.isNumber(c)||c<0||c>i){const n=M.default.getDpq(s);throw new D.A(c,n)}},a.checkExistence=function(){this.fetchPizzicatoIdx()},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getPreviousData();this.removePizzicato(),this.updateStack(c)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,staffUuid:c.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(s)}},a.getPreviousData=function(){const c=this.getPizzicato(),s=U.A.getStaffIdx(c),i=U.A.getPlacement(c),n=U.A.getTimePos(c),e=U.A.getType(c),o=this.getMeasure(),h=M.default.getDpq(o);return{staffIdx:s,placement:i,timePos:n,dpq:h,type:e}},a.getPizzicato=function(){const c=this.getPizzicatos(),s=this.getPizzicatoIdx();return c[s]},a.removePizzicato=function(){const c=this.getPizzicatoIdx(),s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,pizzicatoIdx:c};new O.A(this.scoreData,s,this.cancelStack).perform()},a.getPizzicatoIdx=function(){return this.pizzicatoIdx===null&&this.fetchPizzicatoIdx(),this.pizzicatoIdx},a.fetchPizzicatoIdx=function(){if(this.pizzicatoIdx=null,this.getPizzicatos().some(this.checkPizzicatoTimePos,this),this.pizzicatoIdx===null)throw new v.default},a.getPizzicatos=function(){if(this.pizzicatos===null){const c=this.getMeasure();this.pizzicatos=M.default.getPizzicatos(c,this.opts.staffIdx)}return this.pizzicatos},a.checkPizzicatoTimePos=function(c,s){const i=this.getLocalTimePos(),n=U.A.getTimePos(c);return n<i?!1:(n===i&&(this.pizzicatoIdx=s),!0)},a.getLocalTimePos=function(){if(this.localTimePos===null){const c=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,c)}return this.localTimePos},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},a.updateStack=function(c){const s=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,staffUuid:s.staffUuid,placement:c.placement,timePos:c.timePos,dpq:c.dpq,type:c.type}};this.cancelStack.push(i)},a.getLocation=function(){if(this.location===null){const c=this.scoreData.getPartUuid(this.opts.partIdx),s=this.scoreData.getMeasureUuid(this.opts.measureIdx),i=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:c,measureUuid:s,staffUuid:i}}return this.location},(0,m.default)(d);const r=d},30335:(j,x,t)=>{t.r(x),t.d(x,{default:()=>a});var C=t(821828),W=t(195446),T=t(748803),D=t(727867),v=t(737903),M=t(351277),A=t(123491),U=t(652413),O=t(42651),L=t(793317),E=t(922679),I=t(927403),g=t(691309);const m=function(r,c,s){this.init(r,c,s)};m.isAuthorizedException=function(r){return U.default.isAuthorizedException(r)},m.NAME="action.RemoveEdgeHammerOnPullOffs";const d=m.prototype;d.performIfPossible=function(){this.isPossible()&&this.perform()},d.isPossible=function(){let r=!0;try{this.checkPreconditions()}catch(c){if(m.isAuthorizedException(c))r=!1;else throw c}return r},d.name=m.NAME,d.initMeasureData=L.default,d.getVoice=E.A,d.init=function(r,c,s){this.initMeasureData(r,c),this.cancelStack=s,this.opts=c,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null,this.leftNote=null,this.rightNote=null,this.crossMeasure=new g.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)},d.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const r=this.getVoice();r.checkNoteIdx(this.opts.noteIdx),r.checkNotRest(this.opts.noteIdx),this.checkTabPart(),this.checkPitch(),this.checkNoteAtPitch(),this.checkFretData(),this.checkCanUntie()},d.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},d.checkTabPart=function(){(0,I.A)(this.measureData,this.opts)},d.checkPitch=function(){M.default.check(this.opts.pitch)},d.checkNoteAtPitch=function(){if(typeof this.getRightNote()=="undefined"){const c=M.default.copy(this.opts.pitch);throw new T.default(T.default.GET,c)}},d.checkFretData=function(){const r=this.getRightNote();if(!A.default.hasFretData(r))throw new D.A(this.opts.pitch)},d.checkCanUntie=function(){const r=this.canUntieLeft(),c=this.canUntieRight();if(!r&&!c)throw new C.A("There is nothing to untie")},d.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){const r=this.getLeftAction();r.cancelStack=this.cancelStack,r.perform()}if(this.canUntieRight()){const r=this.getRightAction();r.cancelStack=this.cancelStack,r.perform()}},d.canUntieRight=function(){if(this.untieRight===null){const r=this.getRightAction();try{r.checkPreconditions(),this.untieRight=!0}catch(c){if(U.default.isAuthorizedException(c))this.untieRight=!1;else throw c}}return this.untieRight},d.getRightAction=function(){if(this.rightAction===null){const r=this.getRightNote(),c=A.default.getPitch(r),s=(0,v.default)(this.opts);s.pitch=M.default.copy(c),this.rightAction=new U.default(this.measureData,s,this.cancelStack)}return this.rightAction},d.canUntieLeft=function(){if(this.untieLeft===null)try{this.crossMeasure.checkLeftVoiceIdx(),this.crossMeasure.checkLeftNoteIdx(),this.crossMeasure.isLeftRest()||!this.getLeftNote()?this.untieLeft=!1:(this.getLeftAction().checkPreconditions(),this.untieLeft=!0)}catch(r){if(U.default.isAuthorizedException(r))this.untieLeft=!1;else throw r}return this.untieLeft},d.getLeftAction=function(){if(this.leftAction===null){const r=this.getLeftNote(),c=A.default.getPitch(r),s=(0,v.default)(this.opts);s.pitch=M.default.copy(c),s.noteIdx--,this.leftAction=new U.default(this.measureData,s,this.cancelStack)}return this.leftAction},d.getLeftNote=function(){if(this.leftNote===null){const r=this.getRightNote(),c=this.crossMeasure.getLeftChord(),s=A.default.getFretData(r);this.leftNote=c.find(this.stringPredicate,s)}return this.leftNote},d.stringPredicate=function(r){const c=this;return A.default.hasFretData(r)?A.default.getFretData(r).string===c.string:!1},d.getRightNote=function(){if(this.rightNote===null){const r=this.crossMeasure.getRightChord();this.rightNote=r.find(this.pitchPredicate,this)}return this.rightNote},d.pitchPredicate=function(r){const c=A.default.getPitch(r);return M.default.isSameLine(c,this.opts.pitch)},(0,O.default)(m);const a=m},41140:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(195446),W=t(748803),T=t(632879),D=t(569445),v=t(31278),M=t(377180),A=t(10533),U=t(898039),O=t(52275),L=t(704621),E=t(519405),I=t(793317),g=t(42651);const m=function(s,i,n){this.init(s,i,n)};m.NAME="action.TransposeGraces";const d=m.prototype;d.name=m.NAME,d.initMeasureData=I.default,d.init=function(s,i,n){(0,O.default)(s,i),(0,L.default)(s,i),this.initMeasureData(s,i),this.cancelStack=n,this.opts=i,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},d.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,U.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),M.default.check(this.opts.transpose),this.sanitizeIfNeeded();const s=this.getWrappedActions();if(s.length===0)throw new v.default;if(!s.some(a))throw s[0].error};const a=function(s){try{s.action.checkPreconditions()}catch(i){if(r(i))return s.checked=!0,s.error=i,!1;throw i}return s.checked=!0,!0};d.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},d.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},d.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,U.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},d.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)},d.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i=M.default.copy(this.opts.transpose),n={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceIdx:this.opts.voiceIdx,divisions:s.dpq,timePos:s.timePos,transpose:i,checkLine:this.opts.checkLine,preserveColor:!!this.opts.preserveColor},e={actionName:this.name,opts:n};this.cancelStack.storeAction(e)}},d.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),i=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),e=this.measureData.getDpqValue(),h=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:i,measureUuid:n,dpq:e,timePos:h}}return this.location},d.getWrappedActions=function(){if(this.wrappedActions===null){this.wrappedActions=[];const i=this.getVoice().getNbGraces(this.opts.noteIdx);for(let n=0;n<i;n++){const e=this.createWrappedAction(n);this.wrappedActions.push(e)}}return this.wrappedActions},d.createWrappedAction=function(s){const i=M.default.copy(this.opts.transpose),n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:s,checkLine:this.opts.checkLine,preserveColor:this.opts.preserveColor,transpose:i,isConcertPitch:!1},e=null;return{action:new A.default(this.measureData,n,e),error:null,checked:!1}},d.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},d.callPerform=function(s){s.error===null&&(s.action.cancelStack=this.cancelStack,s.checked?s.action.perform():(0,E.default)(s.action,r))};const r=function(s){return s instanceof W.default||s instanceof T.A||s instanceof D.A||s instanceof v.default};(0,g.default)(m);const c=m},67737:(j,x,t)=>{t.r(x),t.d(x,{default:()=>m});var C=t(195446),W=t(737903),T=t(351277),D=t(123491),v=t(52275),M=t(704621),A=t(981801),U=t(898039),O=t(317534),L=t(793317),E=t(42651);const I=function(d,a,r){this.init(d,a,r)};I.NAME="action.DeleteGraceNote";const g=I.prototype;g.name=I.NAME,g.initMeasureData=L.default,g.init=function(d,a,r){(0,v.default)(d,a),(0,M.default)(d,a),(0,A.default)(d,a),this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,(0,U.default)(this.measureData,this.opts),this.location=null},g.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const d=this.measureData.getVoice(this.opts.voiceIdx);d.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),d.checkGraceNotChord(this.opts.noteIdx,this.opts.graceIdx);const a=d.getGrace(this.opts.noteIdx,this.opts.graceIdx);D.default.checkNotLocked(a)},g.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const d=this.getNoteData();this.deleteGraceNote(),this.updateStack(d)},g.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(a)}},g.getNoteData=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx),r=D.default.getStaffIdx(a),s=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,r),i=D.default.getDurationType(a),n=D.default.getPitch(a),e=T.default.getAlter(n),o=T.default.alterToAccidental(e),h={staffUuid:s,durationType:i,pitch:T.default.copyWithoutAlter(n),accidental:o};return D.default.hasFretData(a)&&(h.fretData=D.default.getFretData(a)),h},g.deleteGraceNote=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new O.A(this.measureData,d,this.cancelStack).perform()},g.updateStack=function(d){const a=this.getLocation(),r=T.default.copy(d.pitch),c={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,staffUuid:d.staffUuid,graceIdx:this.opts.graceIdx,timePos:a.timePos,divisions:a.dpq,durationType:d.durationType,pitch:r,accidental:d.accidental}};d.fretData&&(c.opts.fretData=(0,W.default)(d.fretData)),this.cancelStack.push(c)},g.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),a=d.getPartUuid(this.opts.partIdx),r=d.getMeasureUuid(this.opts.measureIdx),c=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),s=this.measureData.getDpqValue(),n=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:r,voiceUuid:c,dpq:s,timePos:n}}return this.location},(0,E.default)(I);const m=I},91894:(j,x,t)=>{t.r(x),t.d(x,{default:()=>f});var C=t(748803),W=t(195446),T=t(351277),D=t(123491),v=t(209175),M=t(737296),A=t(476031),U=t(19405),O=t(578918),L=t(898039),E=t(975924),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(287296),r=t(992035),c=t(477172),s=t(570986),i=t(288572),n=t(42651),e=t(793317),o=t(519405);const h=!1,_=function(l,P,u){this.init(l,P,u)};_.NAME="action.RemoveNote";const p=_.prototype;p.name=_.NAME,p.initMeasureData=e.default,p.init=function(l,P,u){(0,I.default)(l,P),(0,g.default)(l,P),(0,m.default)(l,P),(0,d.default)(l,P),this.initMeasureData(l,P),this.cancelStack=u,this.opts=P,this.sanitized=!1,this.voice=null,this.action=null,this.location=null,(0,L.default)(this.measureData,this.opts)},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),(0,U.default)(this.opts),this.sanitizeIfNeeded(),this.checkPitch(),this.checkAction()},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.isChord=function(){return this.getVoice().isChord(this.opts.noteIdx)},p.checkPitch=function(){const l=this.getNoteAtPitch();if(typeof l=="undefined"){const P=T.default.copy(this.opts.pitch);throw new C.default(C.default.GET,P)}D.default.checkNotLocked(l)},p.getNoteAtPitch=function(){const l=this.getVoice();return(0,O.default)(l,this.opts.noteIdx,this.opts.pitch)},p.checkAction=function(){this.getAction().checkPreconditions()},p.getAction=function(){return this.action===null&&this.createAction(),this.action},p.createAction=function(){this.isChord()?this.createRemoveFromChord():this.createRemoveSingleNote()},p.createRemoveFromChord=function(){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:T.default.copy(this.opts.pitch),record:!1};this.action=new c.default(this.measureData,l,this.cancelStack)},p.createRemoveSingleNote=function(){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests,keepFormer:this.opts.keepFormer};this.action=new s.default(this.measureData,l,this.cancelStack)},p.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();const l=this.getNoteAtPitch();this.storeAction(l);const P=this.getAction();P.cancelStack=this.cancelStack,P.perform(),this.updateStack(l),this.shouldFormatRests()&&this.formatRests()},p.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,A.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts),typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=M.default.REPLACE),typeof this.opts.formatRests=="undefined"&&(this.opts.formatRests=h),typeof this.opts.keepFormer=="undefined"&&(this.opts.keepFormer=!0),this.sanitized=!0)},p.updateStack=function(l){const P=D.default.getAlter(l),u=T.default.alterToAccidental(P),R=D.default.getStaffIdx(l),K=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,R),B=D.default.getNbDots(l),N=this.extractNoteDurationType(l),y=D.default.getTimeModif(l),k=this.extractFretData(l),V=this.getLocation(),G={partUuid:V.partUuid,measureUuid:V.measureUuid,voiceUuid:V.voiceUuid,staffUuid:K,timePos:V.timePos,divisions:V.dpq,pitch:T.default.copy(this.opts.pitch),accidental:u,fretData:k,nbDots:B,durationType:N,insertMode:this.opts.insertMode,timeModif:v.default.copy(y)},z={type:this.name,noDraw:!0,opts:G};this.cancelStack.push(z)},p.extractNoteDurationType=function(l){const P=this.measureData.getDivisionsPerQuarterValue();return(0,E.default)(l,P)},p.extractFretData=function(l){return(0,r.default)(l)},p.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation(),P={actionName:this.name,opts:{partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid,timePos:l.timePos,divisions:l.dpq,pitch:T.default.copy(this.opts.pitch),insertMode:this.opts.insertMode,formatRests:this.opts.formatRests,keepFormer:this.opts.keepFormer}};this.cancelStack.storeAction(P)}},p.getLocation=function(){if(this.location===null){const l=this.measureData.getScoreData(),P=l.getPartUuid(this.opts.partIdx),u=l.getMeasureUuid(this.opts.measureIdx),R=l.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),S=this.measureData.getDpqValue(),B=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:P,measureUuid:u,voiceUuid:R,dpq:S,timePos:B}}return this.location},p.shouldFormatRests=function(){return this.opts.formatRests?this.getAction()instanceof s.default:!1},p.formatRests=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).isRest(this.opts.noteIdx))return;const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},u=new i.default(this.measureData,P,this.cancelStack);(0,o.default)(u)},(0,n.default)(_);const f=_},95627:(j,x,t)=>{t.r(x),t.d(x,{default:()=>s});var C=t(646456),W=t(464173),T=t(613903),D=t(726042),v=t(701387),M=t(529355),A=t(681670),U=t(359363),O=t(416961),L=t(316610),E=t(52275),I=t(704621),g=t(42651),m=t(902630);const d=function(i,n,e){this.init(i,n,e)};d.NAME="action.AddHarmonyAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(i,n,e){(0,E.default)(i,n),(0,I.default)(i,n),this.scoreData=i,this.cancelStack=e,this.opts=n,this.sanitized=!1,this.localTimePos=null,this.measure=null,this.location=null},a.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkValue(),this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos()},a.checkValue=function(){W.A.checkJazz(this.opts.kind),M.A.check(this.opts.root),T.A.check(this.opts.type),this.opts.bass!==null&&A.A.check(this.opts.bass),U.A.check(this.opts.degrees),this.opts.frame&&m.default.check(this.opts.frame)},a.checkTimePos=function(){const i=this.getLocalTimePos(),n=this.getMeasure(),e=v.default.getNbDivisions(n);if(!D.default.isNumber(i)||i<0||i>=e){const o=v.default.getDpq(n);throw new C.A(i,o)}},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addHarmony(),this.updateStack()},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.bass=="undefined"&&(this.opts.bass=null),typeof this.opts.degrees=="undefined"&&(this.opts.degrees=[]),typeof this.opts.type=="undefined"&&(this.opts.type=T.A.DEFAULT),this.sanitized=!0)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),n=M.A.copy(this.opts.root),e=r(this.opts.bass),o=U.A.copy(this.opts.degrees),h=c(this.opts.frame),_={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos,root:n,kind:this.opts.kind,bass:e,degrees:o,frame:h,type:this.opts.type}};this.cancelStack.storeAction(_)}},a.addHarmony=function(){const i=M.A.copy(this.opts.root),n=r(this.opts.bass),e=c(this.opts.frame),o=U.A.copy(this.opts.degrees),h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:i,kind:this.opts.kind,bass:n,frame:e,degrees:o,type:this.opts.type};new O.A(this.scoreData,h,this.cancelStack).perform()};const r=function(i){return i===null?i:A.A.copy(i)};function c(i){return i?m.default.copy(i):null}a.getLocalTimePos=function(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,i)}return this.localTimePos},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},a.updateStack=function(){const i=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.push(n)},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),n=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:i,measureUuid:n}}return this.location},(0,g.default)(d);const s=d},99241:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(247739),W=t(292681),T=t(123491),D=t(104907),v=t(2835),M=t(52275),A=t(704621),U=t(981801),O=t(898039),L=t(831121),E=t(76004),I=t(378916),g=t(793317),m=t(42651);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemoveGraceFromChordPercu";const a=d.prototype;a.name=d.NAME,a.initMeasureData=g.default,a.init=function(c,s,i){(0,M.default)(c,s),(0,A.default)(c,s),(0,U.default)(c,s),this.initMeasureData(c,s),this.cancelStack=i,this.opts=s,(0,O.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null},a.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const c=this.measureData.getVoice(this.opts.voiceIdx);c.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),c.checkGraceChord(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.checkPitch()},a.checkUnpitchedPart=function(){(0,L.default)(this.measureData)},a.checkPitch=function(){this.sanitizeIfNeeded();const c=this.measureData.getVoice(this.opts.voiceIdx),s=(0,E.A)(c,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);if(typeof s=="undefined"){const i=W.default.copy(this.opts.unpitched),n=this.opts.staffIdx||0,e=this.measureData.getStaffDetails(n),o=D.default.getNbStaffLines(e);throw new C.A(C.A.GET,i,o)}T.default.checkNotLocked(s)},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();const c=this.getNoteData();this.removeGraceFromChord(),this.updateStack(c)},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,v.default)(this.measureData,this.opts),this.sanitized=!0)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,timePos:c.timePos,divisions:c.dpq,graceIdx:this.opts.graceIdx,unpitched:W.default.copy(this.opts.unpitched)}};this.cancelStack.storeAction(s)}},a.getNoteData=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),s=(0,E.A)(c,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched),i=T.default.getStaffIdx(s),e=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,i),o=T.default.getHead(s);return{staffUuid:e,notehead:o}},a.removeGraceFromChord=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:W.default.copy(this.opts.unpitched)};new I.A(this.measureData,c,this.cancelStack).perform()},a.updateStack=function(c){const s=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,staffUuid:c.staffUuid,graceIdx:this.opts.graceIdx,timePos:s.timePos,divisions:s.dpq,unpitched:W.default.copy(this.opts.unpitched),notehead:c.notehead}};this.cancelStack.push(i)},a.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),s=c.getPartUuid(this.opts.partIdx),i=c.getMeasureUuid(this.opts.measureIdx),n=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getDpqValue(),h=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:s,measureUuid:i,voiceUuid:n,dpq:e,timePos:h}}return this.location},(0,m.default)(d);const r=d},109049:(j,x,t)=>{t.r(x),t.d(x,{default:()=>O});var C=t(153271),W=t(31278),T=t(308192),D=t(704621),v=t(726042),M=t(42651);const A=function(L,E,I){this.init(L,E,I)};A.NAME="action.RemoveMultiMeasureRest";const U=A.prototype;U.name=A.NAME,U.init=function(L,E,I){this.scoreData=L,this.cancelStack=I,this.opts=E,(0,D.default)(this.scoreData,E),this.location=null},U.checkPreconditions=function(){this.checkLocation(),this.checkHasMmr()},U.checkLocation=function(){const L=this.scoreData.getNbMeasures(),E=this.opts.measureIdx;if(!v.default.isInteger(E)||E<0||E>=L)throw new C.default(E,C.default.GET)},U.checkHasMmr=function(){if(!this.scoreData.getCommonContent().hasMultiMeasureRest(this.opts.measureIdx))throw new W.default},U.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const L=this.getPreviousData();this.storeAction(),this.removeMmr(),this.updateStack(L)},U.getPreviousData=function(){return{nbMeasures:this.scoreData.getCommonContent().getMultiMeasureRest(this.opts.measureIdx)}},U.storeAction=function(){if(!this.cancelStack.hasAction()){const L=this.getLocation(),E={actionName:this.name,opts:{measureUuid:L.measureUuid}};this.cancelStack.storeAction(E)}},U.removeMmr=function(){const L={measureIdx:this.opts.measureIdx};new T.A(this.scoreData,L,this.cancelStack).perform()},U.updateStack=function(L){const E=this.getLocation(),I={type:this.name,noDraw:!0,opts:{measureUuid:E.measureUuid,nbMeasures:L.nbMeasures}};this.cancelStack.push(I)},U.getLocation=function(){if(this.location===null){const L=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={measureUuid:L}}return this.location},(0,M.default)(A);const O=A},122007:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(737296),W=t(831121),T=t(2835),D=t(52275),v=t(704621),M=t(981801),A=t(898039),U=t(708377),O=t(478067),L=t(737903),E=t(292681),I=t(793317),g=t(42651);const m=!1,d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemoveNotePercu";const a=d.prototype;a.name=d.NAME,a.initMeasureData=I.default,a.init=function(c,s,i){(0,D.default)(c,s),(0,v.default)(c,s),(0,M.default)(c,s),this.initMeasureData(c,s),this.cancelStack=i,this.opts=s,this.sanitized=!1,this.voice=null,this.action=null,this.location=null,(0,A.default)(this.measureData,this.opts)},a.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkAction()},a.checkUnpitched=function(){(0,W.default)(this.measureData)},a.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},a.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},a.isChord=function(){return this.getVoice().isChord(this.opts.noteIdx)},a.checkAction=function(){this.getAction().checkPreconditions()},a.getAction=function(){return this.action===null&&this.createAction(),this.action},a.createAction=function(){if(this.isChord()){const c=(0,L.default)(this.opts);this.action=new U.default(this.measureData,c,this.cancelStack)}else{const c=(0,L.default)(this.opts);this.action=new O.default(this.measureData,c,this.cancelStack)}},a.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},a.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getAction();c.cancelStack=this.cancelStack,c.perform()},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s=E.default.copy(this.opts.unpitched),i={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos,insertMode:this.opts.insertMode,formatRests:!!this.opts.formatRests,keepFormer:!!this.opts.keepFormer,unpitched:s}};this.cancelStack.storeAction(i)}},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,T.default)(this.measureData,this.opts),typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=C.default.REPLACE),typeof this.opts.formatRests=="undefined"&&(this.opts.formatRests=m),this.sanitized=!0)},a.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),s=c.getPartUuid(this.opts.partIdx),i=c.getMeasureUuid(this.opts.measureIdx),n=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getDpqValue(),h=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:s,measureUuid:i,dpq:e,timePos:h,voiceUuid:n}}return this.location},(0,g.default)(d);const r=d},137427:(j,x,t)=>{t.r(x),t.d(x,{default:()=>L});var C=t(807205),W=t(195446),T=t(737903),D=t(414208),v=t(42651),M=t(793317),A=t(922679);const U=function(E,I,g){this.init(E,I,g)};U.isAuthorizedException=function(E){return D.default.isAuthorizedException(E)},U.NAME="action.UntieNote";const O=U.prototype;O.performIfPossible=function(){this.isPossible()&&this.perform()},O.isPossible=function(){let E=!0;try{this.checkPreconditions()}catch(I){if(U.isAuthorizedException(I))E=!1;else throw I}return E},O.name=U.NAME,O.initMeasureData=M.default,O.getVoice=A.A,O.init=function(E,I,g){this.initMeasureData(E,I),this.cancelStack=g,this.opts=I,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},O.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const E=this.getVoice();E.checkNoteIdx(this.opts.noteIdx),E.checkNotRest(this.opts.noteIdx),this.checkCanUntie()},O.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},O.checkCanUntie=function(){const E=this.canUntieLeft(),I=this.canUntieRight();if(!E&&!I)throw new C.A("There is nothing to untie")},O.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){const E=this.getLeftAction();E.cancelStack=this.cancelStack,E.perform()}if(this.canUntieRight()){const E=this.getRightAction();E.cancelStack=this.cancelStack,E.perform()}},O.canUntieRight=function(){if(this.untieRight===null){const E=this.getRightAction();try{E.checkPreconditions(),this.untieRight=!0}catch(I){if(D.default.isAuthorizedException(I))this.untieRight=!1;else throw I}}return this.untieRight},O.getRightAction=function(){if(this.rightAction===null){const E=(0,T.default)(this.opts);this.rightAction=new D.default(this.measureData,E,this.cancelStack)}return this.rightAction},O.canUntieLeft=function(){if(this.untieLeft===null){const E=this.getLeftAction();try{E.checkPreconditions(),this.untieLeft=!0}catch(I){if(D.default.isAuthorizedException(I))this.untieLeft=!1;else throw I}}return this.untieLeft},O.getLeftAction=function(){if(this.leftAction===null){const E=(0,T.default)(this.opts);E.noteIdx--,this.leftAction=new D.default(this.measureData,E,this.cancelStack)}return this.leftAction},(0,v.default)(U);const L=U},159238:(j,x,t)=>{t.r(x),t.d(x,{default:()=>g});var C=t(292681),W=t(123491),T=t(52275),D=t(704621),v=t(981801),M=t(898039),A=t(831121),U=t(334282),O=t(793317),L=t(42651);const E=function(m,d,a){this.init(m,d,a)};E.NAME="action.DeleteGraceNotePercu";const I=E.prototype;I.name=E.NAME,I.initMeasureData=O.default,I.init=function(m,d,a){(0,T.default)(m,d),(0,D.default)(m,d),(0,v.default)(m,d),this.initMeasureData(m,d),this.cancelStack=a,this.opts=d,(0,M.default)(this.measureData,this.opts),this.location=null},I.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const m=this.measureData.getVoice(this.opts.voiceIdx);m.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),m.checkGraceNotChord(this.opts.noteIdx,this.opts.graceIdx);const d=m.getGrace(this.opts.noteIdx,this.opts.graceIdx);W.default.checkNotLocked(d)},I.checkUnpitched=function(){(0,A.default)(this.measureData)},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const m=this.getNoteData();this.deleteGraceNote(),this.updateStack(m)},I.storeAction=function(){if(!this.cancelStack.hasAction()){const m=this.getLocation(),d={actionName:this.name,opts:{partUuid:m.partUuid,measureUuid:m.measureUuid,voiceUuid:m.voiceUuid,timePos:m.timePos,divisions:m.dpq,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(d)}},I.getNoteData=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx),a=W.default.getStaffIdx(d),c=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,a),s=W.default.getDurationType(d);let i=W.default.getUnpitched(d);i=C.default.copy(i);const n=W.default.getHead(d);return{staffUuid:c,durationType:s,unpitched:i,notehead:n}},I.deleteGraceNote=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new U.A(this.measureData,m,this.cancelStack).perform()},I.updateStack=function(m){const d=this.getLocation(),a=C.default.copy(m.unpitched),r={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,staffUuid:m.staffUuid,timePos:d.timePos,divisions:d.dpq,graceIdx:this.opts.graceIdx,durationType:m.durationType,notehead:m.notehead,unpitched:a}};this.cancelStack.push(r)},I.getLocation=function(){if(this.location===null){const m=this.measureData.getScoreData(),d=m.getPartUuid(this.opts.partIdx),a=m.getMeasureUuid(this.opts.measureIdx),r=m.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),c=this.measureData.getDpqValue(),i=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:d,measureUuid:a,voiceUuid:r,dpq:c,timePos:i}}return this.location},(0,L.default)(E);const g=E},165259:(j,x,t)=>{t.r(x),t.d(x,{default:()=>l});var C=t(31278),W=t(195446),T=t(748803),D=t(992781),v=t(123491),M=t(351277),A=t(860716),U=t(104907),O=t(737903),L=t(955154),E=t(680023),I=t(298009),g=t(578918),m=t(19405),d=t(476031),a=t(898039),r=t(52275),c=t(704621),s=t(981801),i=t(783177),n=t(287296),e=t(519405),o=t(793317),h=t(42651),_=t(701236);const p=function(P,u,R){this.init(P,u,R)};p.NAME="action.RemoveHarmonicAndRestoreFret",p.isNoChange=function(P){return P instanceof C.default};const f=p.prototype;f.name=p.NAME,f.initMeasureData=o.default,f.init=function(P,u,R){(0,r.default)(P,u),(0,c.default)(P,u),(0,s.default)(P,u),(0,i.default)(P,u),this.initMeasureData(P,u),this.cancelStack=R,this.opts=u,this.noteHead=null,this.voice=null,this.location=null},f.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,a.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkHarmonic()},f.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},f.checkValues=function(){(0,m.default)(this.opts)},f.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},f.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},f.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,d.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,n.default)(this.measureData,this.opts)},f.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const u=M.default.copy(this.opts.pitch);throw new T.default(T.default.GET,u)}},f.checkHarmonic=function(){const P=this.getNoteAtPitch();if(!v.default.hasHarmonic(P))throw new C.default},f.getNoteAtPitch=function(){if(this.noteHead===null){const P=this.getVoice();this.noteHead=(0,g.default)(P,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.canSetFret()?this.setFret():this.removeHarmonic()},f.canSetFret=function(){const P=this.getNoteAtPitch(),u=v.default.getHarmonic(P),R=A.default.getType(u);if(R!==L.default.NATURAL_SOUNDING&&R!==L.default.ARTIFICIAL_TOUCHING)return!1;const S=v.default.getStaffIdx(P),K=this.measureData.getStaffDetails(S);if(!U.default.hasStaffTuning(K))return!1;const B=v.default.getPitch(P),N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:S,noteIdx:this.opts.noteIdx,pitch:M.default.copy(B)};try{(0,_.A)(this.measureData,N,null)}catch(y){if(y instanceof D.A)return!1;throw y}return this.fretData=N.fretData,!0},f.setFret=function(){const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:M.default.copy(this.opts.pitch),fretData:(0,O.default)(this.fretData)},u=new I.default(this.measureData,P,this.cancelStack);(0,e.default)(u)},f.removeHarmonic=function(){const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:M.default.copy(this.opts.pitch)};new E.default(this.measureData,P,this.cancelStack).perform()},f.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,h.default)(p);const l=p},195783:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(278243),W=t(748803),T=t(195446),D=t(123491),v=t(351277),M=t(691309),A=t(898039),U=t(325600),O=t(52275),L=t(704621),E=t(981801),I=t(103219),g=t(764649),m=t(793317),d=t(313499),a=t(42651),r=t(31278);const c=function(e,o,h){this.init(e,o,h)};c.NAME="action.AddGlissando";const s=c.prototype;s.name=c.NAME,s.initMeasureData=m.default,s.lineToDestPitch=d.A,s.init=function(e,o,h){(0,O.default)(e,o),(0,L.default)(e,o),(0,E.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,(0,A.default)(this.measureData,o),this.crossMeasure=new M.default(this.measureData,o.voiceIdx,o.noteIdx),this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},s.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new C.A},s.isLeftRest=function(){return this.crossMeasure.isLeftRest()},s.isRightRest=function(){return this.crossMeasure.isRightRest()},s.checkPitch=function(){let e;const o=this.getLeftChord(),h=this.getRightChord();if(typeof o.find(i,this.opts.leftPitch)=="undefined")throw e={msgPrefix:"there is no left note"},new W.default(e,this.opts.leftPitch);if(typeof h.find(i,this.opts.rightPitch)=="undefined")throw e={msgPrefix:"there is no right note"},new W.default(e,this.opts.rightPitch);if((0,I.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch))throw new r.default};function i(e){const o=this,h=D.default.getPitch(e);return v.default.isSameLine(h,o)}s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addGlissando(),this.updateStack()},s.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,divisions:e.dpq,timePos:e.timePos,voiceUuid:e.voiceUuid,leftPitch:v.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:v.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.storeAction(o)}},s.getLeftChord=function(){return this.crossMeasure.getLeftChord()},s.getRightChord=function(){return this.crossMeasure.getRightChord()},s.addGlissando=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),leftPitch:v.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:v.default.copyWithoutAlter(this.opts.rightPitch)},o=this.crossMeasure.getLeftMeasure();new g.A(o,e,this.cancelStack).perform()},s.updateStack=function(){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const e=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:e.timePos,divisions:e.dpq,voiceUuid:e.voiceUuid,leftPitch:v.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:v.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.push(o)},s.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=this.crossMeasure.getLeftMeasureIdx(),_=e.getMeasureUuid(h),p=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),f=this.crossMeasure.getLeftMeasure().getDpqValue(),l=this.crossMeasure.getLeftVoice(),P=this.crossMeasure.getLeftNoteIdx(),u=(0,U.A)(l,P);this.location={partUuid:o,measureUuid:_,voiceUuid:p,dpq:f,timePos:u}}return this.location},(0,a.default)(c);const n=c},200665:(j,x,t)=>{t.r(x),t.d(x,{default:()=>p});var C=t(916502),W=t(834951),T=t(804963),D=t(748803),v=t(992781),M=t(31278),A=t(52275),U=t(704621),O=t(981801),L=t(793317),E=t(898039),I=t(662188),g=t(762860),m=t(379084),d=t(544885),a=t(42651),r=t(351277),c=t(964845),s=t(104907),i=t(123491),n=t(737903),e=t(359932),o=t(431043);const h=function(f,l,P){this.init(f,l,P)};h.isAuthorizedException=function(f){return f instanceof M.default||f instanceof v.A},h.NAME="action.SetGraceFret";const _=h.prototype;_.name=h.NAME,_.initMeasureData=L.default,_.init=function(f,l,P){(0,A.default)(f,l),(0,U.default)(f,l),(0,O.default)(f,l),this.initMeasureData(f,l),this.opts=l,this.cancelStack=P,this.sanitized=!1,this.location=null,(0,E.default)(this.measureData,this.opts)},_.performIfPossible=function(){this.isPossible()&&this.perform()},_.isPossible=function(){let f=!0;try{this.checkPreconditions()}catch(l){if(h.isAuthorizedException(l))f=!1;else throw l}return f},_.checkPreconditions=function(){this.checkLocation(),this.checkPitch(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkFretData(),this.checkFretDataOpts(),this.checkExistence()},_.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const f=this.getVoice();f.checkNoteIdx(this.opts.noteIdx),f.checkNotRest(this.opts.noteIdx),f.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},_.checkPitch=function(){r.default.check(this.opts.pitch)},_.sanitizeIfNeeded=function(){this.sanitized||(this.opts.fretData!==null&&(typeof this.opts.fretData=="undefined"||!c.A.hasTechnical(this.opts.fretData,e.default.FRET)||!c.A.hasTechnical(this.opts.fretData,e.default.STRING))&&this.convertPitchToFret(),typeof this.opts.record=="undefined"&&(this.opts.record=!1),this.sanitized=!0)},_.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},_.getGraceAtPitch=function(){const f=this.getVoice();return(0,g.A)(f,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)},_.checkNoteAtPitch=function(){if(typeof this.getGraceAtPitch()=="undefined"){const l=r.default.copy(this.opts.pitch);throw new D.default(D.default.GET,l)}},_.checkFretData=function(){if(typeof this.opts.fretData=="undefined")throw new C.default("fretData");if(this.opts.fretData!==null){if(!c.A.hasTechnical(this.opts.fretData,e.default.FRET))throw new W.A("fret");if(!c.A.hasTechnical(this.opts.fretData,e.default.STRING))throw new W.A("string")}},_.checkFretDataOpts=function(){if(this.opts.fretData!==null){const f=parseInt(this.opts.fretData.fret,10);o.A.check(f);const P=this.measureData.getScoreData().getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),u=this.measureData.getStaffDetails(P),R=s.default.getNbStaffLines(u),S=parseInt(this.opts.fretData.string,10);if(S<1||S>R)throw new T.A("string")}},_.checkExistence=function(){if(this.opts.fretData===null){const f=this.getGraceAtPitch();if(!i.default.hasTechnical(f,e.default.STRING)&&!i.default.hasTechnical(f,e.default.FRET))throw new M.default("No fret to remove")}},_.convertPitchToFret=function(){const f=typeof this.opts.fretData=="undefined"?null:this.opts.fretData.lastString;(0,I.A)(this.measureData,this.opts,f)},_.getOldFretData=function(){const f=this.getGraceAtPitch();return i.default.hasTechnical(f,e.default.STRING)&&i.default.hasTechnical(f,e.default.FRET)?{fret:i.default.getTechnicalContent(f,e.default.FRET),string:i.default.getTechnicalContent(f,e.default.STRING)}:null},_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const f=this.getOldFretData();this.opts.fretData!==null?this.setFret():this.unsetFret(),this.opts.record&&this.updateStack(f)},_.setFret=function(){const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:this.opts.pitch,fretData:this.opts.fretData};new m.A(this.measureData,f,this.cancelStack).perform()},_.unsetFret=function(){const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:this.opts.pitch};new d.A(this.measureData,f,this.cancelStack).perform()},_.updateStack=function(f){const l=this.getLocation(),P={type:this.name,noDraw:!0,opts:{partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid,timePos:l.timePos,divisions:l.dpq,graceIdx:this.opts.graceIdx,pitch:r.default.copy(this.opts.pitch),fretData:f!==null?(0,n.default)(f):null}};this.cancelStack.push(P)},_.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),l={actionName:this.name,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceUuid:f.voiceUuid,timePos:f.timePos,divisions:f.dpq,graceIdx:this.opts.graceIdx,pitch:r.default.copy(this.opts.pitch),fretData:this.opts.fretData!==null?(0,n.default)(this.opts.fretData):null,sameStringAsPreviousNotes:!!this.opts.sameStringAsPreviousNotes}};this.cancelStack.storeAction(l)}},_.getLocation=function(){if(this.location===null){const f=this.measureData.getScoreData(),l=f.getPartUuid(this.opts.partIdx),P=f.getMeasureUuid(this.opts.measureIdx),u=f.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),R=this.measureData.getDpqValue(),K=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:l,measureUuid:P,voiceUuid:u,dpq:R,timePos:K}}return this.location},(0,a.default)(h);const p=h},205043:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(378432),W=t(195446),T=t(748803),D=t(632879),v=t(123491),M=t(351277),A=t(377180),U=t(951805),O=t(377328),L=t(762860),E=t(793317),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(287296),r=t(476031),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.TransposeGraceHead";const i=s.prototype;i.name=s.NAME,i.initMeasureData=E.default,i.init=function(e,o,h){(0,I.default)(e,o),(0,g.default)(e,o),(0,m.default)(e,o),(0,d.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null},i.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),A.default.check(this.opts.transpose),this.sanitizeIfNeeded(),M.default.check(this.opts.pitch),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.checkNoteAtPitch=function(){if(typeof this.getGraceAtPitch()=="undefined"){const o=M.default.copy(this.opts.pitch);throw new T.default(T.default.GET,o)}},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();const e=this.getAction();e.cancelStack=this.cancelStack,e.perform()},i.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,r.default)(this.measureData,this.opts,!0),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&((0,a.default)(this.measureData,this.opts),M.default.check(this.opts.pitch)),this.sanitized=!0)},i.getGraceAtPitch=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,L.A)(e,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},i.getAction=function(){if(this.action===null){const e=this.getGraceAtPitch(),o=v.default.getPitch(e),h=v.default.getStaffIdx(e);let _;try{_=M.default.transpose(o,this.opts.transpose,!0)}catch(u){if(u instanceof C.A){const R=M.default.copy(o),S=A.default.copy(this.opts.transpose);throw new D.A(R,S)}else throw u}const p=M.default.getAlter(_),f=M.default.alterToAccidental(p),l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},P=null;M.default.isSameLine(o,_)?(l.pitch=M.default.copyWithoutAlter(o),l.accidental=f,this.action=new U.default(this.measureData,l,P)):(l.fromPitch=M.default.copyWithoutAlter(o),l.toPitch=M.default.copyWithoutAlter(_),l.accidental=f,l.checkLine=this.opts.checkLine,l.staffIdx=h,l.preserveColor=this.opts.preserveColor,this.action=new O.default(this.measureData,l,P))}return this.action},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},228546:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(646456),W=t(990937),T=t(726042),D=t(701387),v=t(614653),M=t(529355),A=t(681670),U=t(902630),O=t(244240),L=t(184469),E=t(820771),I=t(316610),g=t(52275),m=t(704621),d=t(42651);const a=function(n,e,o){this.init(n,e,o)};a.NAME="action.RemoveHarmonyAtTimePos",a.isAuthorizedException=function(n){return n instanceof W.A};const r=a.prototype;r.name=a.NAME,r.init=function(n,e,o){(0,g.default)(n,e),(0,m.default)(n,e),this.scoreData=n,this.cancelStack=o,this.opts=e,this.localTimePos=null,this.measure=null,this.harmonyIdx=null,this.location=null},r.performIfPossible=function(){this.isPossible()&&this.perform()},r.isPossible=function(){let n=!0;try{this.checkPreconditions()}catch(e){if(a.isAuthorizedException(e))n=!1;else throw e}return n},r.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos(),this.checkHarmony()},r.checkTimePos=function(){const n=this.getLocalTimePos(),e=this.getMeasure(),o=D.default.getNbDivisions(e);if(!T.default.isNumber(n)||n<0||n>=o){const h=D.default.getDpq(e);throw new C.A(n,h)}},r.checkHarmony=function(){this.fetchHarmonyIdx()},r.perform=function(){this.storeAction();const e=D.default.getJazzHarmonies(this.getMeasure())[this.getHarmonyIdx()],o=v.default.getRoot(e),h=(0,O.A)(e),_=v.default.getAdagioKind(e),p=(0,L.A)(_,h),f=c(e),l=s(e),P=v.default.getType(e);this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeHarmony(),this.updateStack(o,_,f,p,P,l)};const c=function(n){if(v.default.hasBass(n)){let e=v.default.getBass(n);return e=A.A.copy(e),e}else return null},s=function(n){if(v.default.hasFrame(n)){let e=v.default.getFrame(n);return e=U.default.copy(e),e}else return null};r.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={actionName:this.name,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos}};this.cancelStack.storeAction(e)}},r.removeHarmony=function(){const n=this.getHarmonyIdx(),e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,harmonyIdx:n};new E.A(this.scoreData,e,this.cancelStack).perform()},r.getHarmonyIdx=function(){return this.harmonyIdx===null&&this.fetchHarmonyIdx(),this.harmonyIdx},r.fetchHarmonyIdx=function(){this.harmonyIdx=null;const n=this.getMeasure();if(D.default.getJazzHarmonies(n).some(this.checkHarmonyTimePos,this),this.harmonyIdx===null){const o=this.getLocalTimePos(),h=D.default.getDpq(n);throw new W.A(o,h)}},r.checkHarmonyTimePos=function(n,e){const o=this.getLocalTimePos(),h=v.default.getTimePos(n);return h<o?!1:(h===o&&(this.harmonyIdx=e),!0)},r.getLocalTimePos=function(){if(this.localTimePos===null){const n=this.getMeasure();this.localTimePos=(0,I.A)(this.opts,n)}return this.localTimePos},r.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},r.updateStack=function(n,e,o,h,_,p){const f=this.getLocation(),l={type:this.name,noDraw:!0,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,root:M.A.copy(n),kind:e,bass:o,degrees:h,type:_,frame:p}};this.cancelStack.push(l)},r.getLocation=function(){if(this.location===null){const n=this.scoreData.getPartUuid(this.opts.partIdx),e=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:n,measureUuid:e}}return this.location},(0,d.default)(a);const i=a},244651:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(667032),A=t(578918),U=t(19405),O=t(476031),L=t(898039),E=t(52275),I=t(704621),g=t(981801),m=t(783177),d=t(287296),a=t(793317),r=t(42651);const c=function(n,e,o){this.init(n,e,o)};c.NAME="action.RemoveColorFromNote",c.isNoChange=function(n){return n instanceof C.default};const s=c.prototype;s.name=c.NAME,s.initMeasureData=a.default,s.init=function(n,e,o){(0,E.default)(n,e),(0,I.default)(n,e),(0,g.default)(n,e),(0,m.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkColor()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},s.checkValues=function(){(0,U.default)(this.opts)},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts)},s.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const e=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,e)}},s.checkColor=function(){const n=this.getNoteAtPitch();if(!D.default.hasColor(n))throw new C.default},s.getNoteAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,A.default)(n,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const n=this.extractColor();this.removeColorFromNote(),this.updateStack(n)},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},o={actionName:this.name,opts:e};this.cancelStack.storeAction(o)}},s.extractColor=function(){const n=this.getNoteAtPitch();return D.default.getColor(n)},s.removeColorFromNote=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)};new M.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(n){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),color:n},h={type:this.name,noDraw:!0,opts:o};this.cancelStack.push(h)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f,isConcertPitch:!1}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(c);const i=c},246451:(j,x,t)=>{t.r(x),t.d(x,{default:()=>m});var C=t(850883),W=t(623671),T=t(123491),D=t(359932),v=t(793317),M=t(898039),A=t(52275),U=t(704621),O=t(981801),L=t(759428),E=t(42651);const I=function(d,a,r){this.init(d,a,r)};I.NAME="action.RemoveTechnical";const g=I.prototype;g.initMeasureData=v.default,g.name=I.NAME,g.init=function(d,a,r){(0,A.default)(d,a),(0,U.default)(d,a),(0,O.default)(d,a),this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,this.location=null,(0,M.default)(this.measureData,this.opts)},g.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},g.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const d=this.measureData.getVoice(this.opts.voiceIdx);d.checkNoteIdx(this.opts.noteIdx),d.checkNotRest(this.opts.noteIdx)},g.checkExistence=function(){if(!D.default.isCommonValid(this.opts.technicalType))throw new W.A(this.opts.technicalType);const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!T.default.hasTechnical(a,this.opts.technicalType,this.opts.technicalOpts))throw new C.A(this.opts.technicalType)},g.extractTechnicalOpts=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),r=T.default.getTechnicalOpts(a,this.opts.technicalType);this.opts.technicalOpts=r},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.extractTechnicalOpts(),this.storeAction();const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,noteIdx:this.opts.noteIdx};new L.A(this.measureData,d,this.cancelStack).perform(),this.updateStack()},g.updateStack=function(){const d=this.getLocation(),a={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts}};this.cancelStack.push(a)},g.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq,technicalType:this.opts.technicalType,technicalOpts:this.opts.technicalOpts}};this.cancelStack.storeAction(a)}},g.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),a=d.getPartUuid(this.opts.partIdx),r=d.getMeasureUuid(this.opts.measureIdx),c=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),s=this.measureData.getDpqValue(),n=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:r,voiceUuid:c,dpq:s,timePos:n}}return this.location},(0,E.default)(I);const m=I},253941:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(872523),W=t(443749),T=t(646456),D=t(701387),v=t(952818),M=t(726042),A=t(446921),U=t(52275),O=t(704621),L=t(783177),E=t(316610),I=t(224874),g=t(809650),m=t(865123),d=t(42651);const a=function(s,i,n){this.init(s,i,n)};a.NAME="action.RemovePluckedRangeAtTimePos";const r=a.prototype;r.name=a.NAME,r.init=function(s,i,n){(0,U.default)(s,i),(0,O.default)(s,i),(0,L.default)(s,i),this.scoreData=s,this.cancelStack=n,this.opts=i,this.localTimePos=null,this.measureData=null,this.location=null,this.previousData=null},r.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},r.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const s=this.getMeasure(),i=D.default.getNbStaves(s),n=this.opts.staffIdx;if(!M.default.isInteger(n)||n<0||n>=i)throw new W.default(n)},r.checkTimePos=function(){const s=this.getLocalTimePos(),i=this.getMeasure(),n=D.default.getNbDivisions(i);if(!M.default.isNumber(s)||s<0||s>=n){const e=D.default.getDpq(i);throw new T.A(s,e)}},r.checkExistence=function(){if(!this.hasPluckedRange())throw new C.A},r.hasPluckedRange=function(){const s=this.getLocalTimePos(),i=this.getMeasure(),n=D.default.getPluckedRanges(i,this.opts.staffIdx),e=this.extractLeftPluckedRange(i);return(0,g.A)(e,n,s)!==null},r.extractLeftPluckedRange=function(s){return D.default.hasLeftPluckedRange(s,this.opts.staffIdx)?D.default.getLeftPluckedRange(s,this.opts.staffIdx):null},r.searchPluckedRange=function(s){const i=this;return v.A.getPosTime(s)===i},r.getLocalTimePos=function(){if(this.localTimePos===null){const s=this.getMeasure();this.localTimePos=(0,E.A)(this.opts,s)}return this.localTimePos},r.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const s=this.getPreviousData();this.removePluckedRange(),this.updateStack(s)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,staffUuid:s.staffUuid}};this.cancelStack.storeAction(i)}},r.getPreviousData=function(){if(this.previousData===null){const s=this.getLocalTimePos(),i=this.scoreData.getPartContent(this.opts.partIdx),n=A.A.getMeasures(i),e=(0,I.A)(n,this.opts.measureIdx,this.opts.staffIdx,s),o=e.startMeasureIdx,h=this.scoreData.getMeasureUuid(o),_=e.stopMeasureIdx,p=this.scoreData.getMeasureUuid(_),f=this.scoreData.getMeasure(this.opts.partIdx,e.startMeasureIdx),l=D.default.getDpq(f),P=this.scoreData.getMeasure(this.opts.partIdx,e.stopMeasureIdx),u=D.default.getDpq(P);this.previousData={startMeasureUuid:h,startMeasureIdx:o,startTimePos:e.startTimePos,startDpq:l,stopMeasureUuid:p,stopMeasureIdx:_,stopTimePos:e.stopTimePos,stopDpq:u,placement:e.placement,type:e.type}}return this.previousData},r.removePluckedRange=function(){const s=this.getLocalTimePos(),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:s};new m.A(this.scoreData,i,this.cancelStack).perform()},r.updateStack=function(s){const i=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,startMeasureUuid:s.startMeasureUuid,startTimePos:s.startTimePos,startDpq:s.startDpq,stopMeasureUuid:s.stopMeasureUuid,stopTimePos:s.stopTimePos,stopDpq:s.stopDpq,staffUuid:i.staffUuid,placement:s.placement,type:s.type}};this.cancelStack.push(n)},r.getLocation=function(){if(this.location===null){const s=this.scoreData.getPartUuid(this.opts.partIdx),i=this.scoreData.getMeasureUuid(this.opts.measureIdx),n=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:s,staffUuid:n,measureUuid:i}}return this.location},(0,d.default)(a);const c=a},275225:(j,x,t)=>{t.r(x),t.d(x,{default:()=>s});var C=t(702544),W=t(153271),T=t(443749),D=t(646456),v=t(31278),M=t(701387),A=t(726042),U=t(496819),O=t(679534),L=t(316610),E=t(52275),I=t(704621),g=t(783177),m=t(94014),d=t(42651),a=t(519405);const r=function(i,n,e){this.init(i,n,e)};r.NAME="action.RemoveDynamicAtTimePos",r.isAuthorizedException=function(i){return i instanceof C.default||i instanceof W.default||i instanceof T.default||i instanceof D.A||i instanceof v.default};const c=r.prototype;c.name=r.NAME,c.init=function(i,n,e){(0,E.default)(i,n),(0,I.default)(i,n),(0,g.default)(i,n),this.scoreData=i,this.cancelStack=e,this.opts=n,this.measure=null,this.dynamics=null,this.location=null,this.dynamicIdx=null,this.localTimePos=null},c.performIfPossible=function(){this.isPossible()&&this.perform()},c.isPossible=function(){let i=!0;try{this.checkPreconditions()}catch(n){if(r.isAuthorizedException(n))i=!1;else throw n}return i},c.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},c.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const i=this.getMeasure(),n=M.default.getNbStaves(i),e=this.opts.staffIdx;if(!A.default.isNumber(e)||e<0||e>=n)throw new T.default(e)},c.checkTimePos=function(){const i=this.getLocalTimePos(),n=this.getMeasure(),e=M.default.getNbDivisions(n);if(!A.default.isNumber(i)||i<0||i>e){const o=M.default.getDpq(n);throw new D.A(i,o)}},c.checkExistence=function(){this.fetchDynamicIdx()},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const i=this.getPreviousData();this.resetRelativePositionIfNeeded(),this.removeDynamic(),this.updateStack(i)},c.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),n={actionName:this.name,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(n)}},c.resetRelativePositionIfNeeded=function(){const{offsetX:i,offsetY:n}=this.getPreviousData();if(i===0&&n===0)return;const e={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,relativePos:{x:0,y:0}},o=new m.A(this.scoreData,e,this.cancelStack);(0,a.default)(o)},c.getPreviousData=function(){const i=this.getDynamic(),n=U.A.getStaffIdx(i),e=U.A.getPlacement(i),o=U.A.getTimePos(i),h=U.A.getStyle(i),_=U.A.getOffsetX(i),p=U.A.getOffsetY(i);let f=null;U.A.hasSound(i)&&(f=U.A.getSound(i));const l=this.getMeasure(),P=M.default.getDpq(l);return{staffIdx:n,placement:e,timePos:o,dpq:P,style:h,sound:f,offsetX:_,offsetY:p}},c.getDynamic=function(){const i=this.getDynamics(),n=this.getDynamicIdx();return i[n]},c.removeDynamic=function(){const i=this.getDynamicIdx(),n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,dynamicIdx:i};new O.A(this.scoreData,n,this.cancelStack).perform()},c.getDynamicIdx=function(){return this.dynamicIdx===null&&this.fetchDynamicIdx(),this.dynamicIdx},c.fetchDynamicIdx=function(){if(this.dynamicIdx=null,this.getDynamics().some(this.checkDynamicTimePos,this),this.dynamicIdx===null)throw new v.default},c.getDynamics=function(){if(this.dynamics===null){const i=this.getMeasure();this.dynamics=M.default.getDynamics(i,this.opts.staffIdx)}return this.dynamics},c.checkDynamicTimePos=function(i,n){const e=this.getLocalTimePos(),o=U.A.getTimePos(i);return o<e?!1:(o===e&&(this.dynamicIdx=n),!0)},c.getLocalTimePos=function(){if(this.localTimePos===null){const i=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,i)}return this.localTimePos},c.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},c.updateStack=function(i){const n=this.getLocation(),e={type:this.name,noDraw:!0,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,staffUuid:n.staffUuid,placement:i.placement,timePos:i.timePos,dpq:i.dpq,sound:i.sound,style:i.style}};this.cancelStack.push(e)},c.getLocation=function(){if(this.location===null){const i=this.scoreData.getPartUuid(this.opts.partIdx),n=this.scoreData.getMeasureUuid(this.opts.measureIdx),e=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,measureUuid:n,staffUuid:e}}return this.location},(0,d.default)(r);const s=r},278572:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(31278),W=t(247739),T=t(123491),D=t(292681),v=t(104907),M=t(231477),A=t(768498),U=t(2835),O=t(898039),L=t(52275),E=t(704621),I=t(981801),g=t(831121),m=t(793317),d=t(42651);const a=function(s,i,n){this.init(s,i,n)};a.NAME="action.RemoveColorFromNotePercu",a.isNoChange=function(s){return s instanceof C.default};const r=a.prototype;r.name=a.NAME,r.initMeasureData=m.default,r.init=function(s,i,n){(0,L.default)(s,i),(0,E.default)(s,i),(0,I.default)(s,i),this.initMeasureData(s,i),this.cancelStack=n,this.opts=i,this.noteHead=null,this.voice=null,this.location=null},r.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,O.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkGhost()},r.checkUnpitchedPart=function(){(0,g.default)(this.measureData)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,U.default)(this.measureData,this.opts)},r.checkNoteAtUnpitched=function(){if(typeof this.getNoteAtUnpitched()=="undefined"){const i=D.default.copy(this.opts.unpitched),n=this.opts.staffIdx||0,e=this.measureData.getStaffDetails(n),o=v.default.getNbStaffLines(e);throw new W.A(W.A.GET,i,o)}},r.checkGhost=function(){const s=this.getNoteAtUnpitched();if(!T.default.hasColor(s))throw new C.default},r.getNoteAtUnpitched=function(){if(this.noteHead===null){const s=this.getVoice();this.noteHead=(0,A.A)(s,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const s=this.extractColor();this.removeColorFromNotePercu(),this.updateStack(s)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,unpitched:D.default.copy(this.opts.unpitched)},n={actionName:this.name,opts:i};this.cancelStack.storeAction(n)}},r.extractColor=function(){const s=this.getNoteAtUnpitched();return T.default.getColor(s)},r.removeColorFromNotePercu=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:D.default.copy(this.opts.unpitched)};new M.A(this.measureData,s,this.cancelStack).perform()},r.updateStack=function(s){const i=this.getLocation(),n={partUuid:i.partUuid,measureUuid:i.measureUuid,voiceUuid:i.voiceUuid,divisions:i.dpq,timePos:i.timePos,unpitched:D.default.copy(this.opts.unpitched),color:s},e={type:this.name,noDraw:!0,opts:n};this.cancelStack.push(e)},r.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),i=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),e=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),_=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:i,measureUuid:n,voiceUuid:e,dpq:o,timePos:_,isConcertPitch:!1}}return this.location},r.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,d.default)(a);const c=a},287179:(j,x,t)=>{t.r(x),t.d(x,{default:()=>f});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(737903),A=t(614426),U=t(298009),O=t(30335),L=t(42651),E=t(883861),I=t(578918),g=t(19405),m=t(476031),d=t(610860),a=t(898039),r=t(52275),c=t(704621),s=t(981801),i=t(783177),n=t(714898),e=t(534512),o=t(793317),h=t(519405);const _=function(l,P,u){this.init(l,P,u)};_.NAME="action.AddAccidentals",_.isNoChange=function(l){return l instanceof C.default};const p=_.prototype;p.name=_.NAME,p.initMeasureData=o.default,p.init=function(l,P,u){(0,r.default)(l,P),(0,c.default)(l,P),(0,s.default)(l,P),(0,i.default)(l,P),this.initMeasureData(l,P),this.cancelStack=u,this.opts=P,this.sanitized=!1,this.noteHead=null,this.voice=null,this.location=null,this.fretAction=null},p.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,a.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkAlterDifferent(),this.checkNotLocked()},p.checkValues=function(){(0,g.default)(this.opts),this.opts.accidental!==null&&A.default.check(this.opts.accidental)},p.checkPitch=function(){v.default.check(this.opts.pitch)},p.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},p.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},p.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},p.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const P=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,P)}},p.checkAlterDifferent=function(){const l=this.getNoteAtPitch(),P=D.default.getPitch(l),u=v.default.getAlter(P);if(v.default.getAlter(this.opts.pitch)===u)throw new C.default},p.checkNotLocked=function(){const l=this.getNoteAtPitch();D.default.checkNotLocked(l)},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,a.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();let l;if(this.opts.record&&(l=this.getPreviousData()),this.addAccidental(),this.isTabStaff()){this.removeHammerOnPullOff();const P=this.getFretAction();P.cancelStack=this.cancelStack,P.performIfPossible()}this.opts.record&&this.updateStack(l)},p.sanitizeIfNeeded=function(){if(!this.sanitized){if(typeof this.opts.line!="undefined"&&(0,m.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,n.default)(this.measureData,this.opts),this.checkNoteAtPitch(),(0,d.A)(this.measureData,this.opts),typeof this.opts.record=="undefined"&&(this.opts.record=!0),this.measureData.getScoreData().isPartTab(this.opts.partIdx)){const P=this.opts.fretData||{},u=this.getNoteAtPitch();D.default.hasString(u)&&(P.lastString=D.default.getString(u)),this.opts.fretData=P}this.sanitized=!0}},p.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation(),P={partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid,divisions:l.dpq,timePos:l.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental};typeof this.opts.fretData!="undefined"&&(P.fretData=(0,M.default)(this.opts.fretData));const u={actionName:this.name,opts:P};this.cancelStack.storeAction(u)}},p.getPreviousData=function(){const l=this.getNoteAtPitch(),P=D.default.getAlter(l),R={accidental:v.default.alterToAccidental(P)};if(D.default.hasTabData(l)){const S=D.default.getTabData(l);R.fretData=(0,M.default)(S)}return R},p.addAccidental=function(){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),fretData:this.opts.fretData};new E.A(this.measureData,l,this.cancelStack).perform()},p.isTabStaff=function(){return(0,e.default)(this.measureData,this.opts)},p.removeHammerOnPullOff=function(){const l=this.getNoteAtPitch();if(!D.default.hasHammerOnPullOffStart(l)&&!D.default.hasHammerOnPullOffStop(l))return;const P={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)},u=new O.default(this.measureData,P,this.cancelStack);(0,h.default)(u)},p.getFretAction=function(){if(this.fretAction===null){const l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),fretData:(0,M.default)(this.opts.fretData)},P=null;this.fretAction=new U.default(this.measureData,l,P)}return this.fretAction},p.getNoteAtPitch=function(){if(this.noteHead===null){const l=this.getVoice();this.noteHead=(0,I.default)(l,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},p.updateStack=function(l){const P=this.getLocation(),u={partUuid:P.partUuid,measureUuid:P.measureUuid,voiceUuid:P.voiceUuid,divisions:P.dpq,timePos:P.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),previousAccidental:l.accidental};typeof l.fretData!="undefined"&&(u.fretData=(0,M.default)(l.fretData));const R={type:this.name,noDraw:!0,opts:u};this.cancelStack.push(R)},p.getLocation=function(){if(this.location===null){const l=this.measureData.getScoreData(),P=l.getPartUuid(this.opts.partIdx),u=l.getMeasureUuid(this.opts.measureIdx),R=l.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),S=this.measureData.getDpqValue(),B=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:P,measureUuid:u,voiceUuid:R,dpq:S,timePos:B}}return this.location},p.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,L.default)(_);const f=_},298009:(j,x,t)=>{t.r(x),t.d(x,{default:()=>K});var C=t(916502),W=t(834951),T=t(804963),D=t(748803),v=t(992781),M=t(31278),A=t(52275),U=t(704621),O=t(981801),L=t(793317),E=t(898039),I=t(701236),g=t(578918),m=t(519405),d=t(314302),a=t(819373),r=t(30335),c=t(330179),s=t(955832),i=t(680023),n=t(42651),e=t(351277),o=t(964845),h=t(104907),_=t(123491),p=t(860716),f=t(737903),l=t(359932),P=t(431043),u=t(955154);const R=function(B,N,y){this.init(B,N,y)};R.isAuthorizedException=function(B){return B instanceof M.default||B instanceof v.A},R.NAME="action.SetFret";const S=R.prototype;S.name=R.NAME,S.initMeasureData=L.default,S.init=function(B,N,y){(0,A.default)(B,N),(0,U.default)(B,N),(0,O.default)(B,N),this.initMeasureData(B,N),this.opts=N,this.cancelStack=y,this.sanitized=!1,this.location=null,(0,E.default)(this.measureData,this.opts)},S.performIfPossible=function(){this.isPossible()&&this.perform()},S.isPossible=function(){let B=!0;try{this.checkPreconditions()}catch(N){if(R.isAuthorizedException(N))B=!1;else throw N}return B},S.checkPreconditions=function(){this.checkLocation(),this.checkPitch(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkFretData(),this.checkFretDataOpts(),this.checkExistence()},S.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const B=this.getVoice();B.checkNoteIdx(this.opts.noteIdx),B.checkNotRest(this.opts.noteIdx)},S.checkPitch=function(){e.default.check(this.opts.pitch)},S.sanitizeIfNeeded=function(){this.sanitized||(this.opts.fretData!==null&&(typeof this.opts.fretData=="undefined"||!o.A.hasTechnical(this.opts.fretData,l.default.FRET)||!o.A.hasTechnical(this.opts.fretData,l.default.STRING))&&this.convertPitchToFret(),typeof this.opts.record=="undefined"&&(this.opts.record=!1),this.sanitized=!0)},S.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},S.getNoteAtPitch=function(){const B=this.getVoice();return(0,g.default)(B,this.opts.noteIdx,this.opts.pitch)},S.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const N=e.default.copy(this.opts.pitch);throw new D.default(D.default.GET,N)}},S.checkFretData=function(){if(typeof this.opts.fretData=="undefined")throw new C.default("fretData");if(this.opts.fretData!==null){if(!o.A.hasTechnical(this.opts.fretData,l.default.FRET))throw new W.A("fret");if(!o.A.hasTechnical(this.opts.fretData,l.default.STRING))throw new W.A("string")}},S.checkFretDataOpts=function(){if(this.opts.fretData!==null){const B=parseInt(this.opts.fretData.fret,10);P.A.check(B);const y=this.measureData.getScoreData().getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),k=this.measureData.getStaffDetails(y),V=h.default.getNbStaffLines(k),G=parseInt(this.opts.fretData.string,10);if(G<1||G>V)throw new T.A("string")}},S.checkExistence=function(){if(this.opts.fretData===null){const B=this.getNoteAtPitch();if(!_.default.hasTechnical(B,l.default.STRING)&&!_.default.hasTechnical(B,l.default.FRET))throw new M.default("No fret to remove")}},S.convertPitchToFret=function(){const B=typeof this.opts.fretData=="undefined"?null:this.opts.fretData.lastString;(0,I.A)(this.measureData,this.opts,B)},S.getOldFretData=function(){const B=this.getNoteAtPitch();return _.default.hasTechnical(B,l.default.STRING)&&_.default.hasTechnical(B,l.default.FRET)?{fret:_.default.getTechnicalContent(B,l.default.FRET),string:_.default.getTechnicalContent(B,l.default.STRING)}:null},S.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const B=this.getOldFretData();this.removeConnections(),this.removeBend(),this.removePreBend(),this.removeHarmonic(),this.opts.fretData!==null?this.setFret():this.unsetFret(),this.opts.record&&this.updateStack(B)},S.removeConnections=function(){const B=this.getNoteAtPitch();if(!_.default.hasHammerOnPullOffStart(B)&&!_.default.hasHammerOnPullOffStop(B))return;const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:e.default.copy(this.opts.pitch)},y=new r.default(this.measureData,N,this.cancelStack);(0,m.default)(y)},S.removeBend=function(){const B=this.getNoteAtPitch();if(!_.default.hasBend(B)||!_.default.hasFretData(B))return;const N=_.default.getFretData(B),y=e.default.copy(this.opts.pitch),k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:y,fretData:N},V=new c.default(this.measureData,k,this.cancelStack);(0,m.default)(V)},S.removePreBend=function(){const B=this.getNoteAtPitch();if(!_.default.hasPreBend(B)||!_.default.hasFretData(B))return;const N=_.default.getFretData(B),y=e.default.copy(this.opts.pitch),k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:y,fretData:N},V=new s.default(this.measureData,k,this.cancelStack);(0,m.default)(V)},S.removeHarmonic=function(){const B=this.getNoteAtPitch();if(!_.default.hasHarmonic(B))return;const N=_.default.getHarmonic(B),y=p.default.getType(N);if(y!==u.default.ARTIFICIAL_TOUCHING&&y!==u.default.NATURAL_SOUNDING)return;const k=e.default.copy(this.opts.pitch),V={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:k},G=new i.default(this.measureData,V,this.cancelStack);(0,m.default)(G)},S.setFret=function(){const B={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:this.opts.pitch,fretData:this.opts.fretData};new d.A(this.measureData,B,this.cancelStack).perform()},S.unsetFret=function(){const B={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:this.opts.pitch};new a.A(this.measureData,B,this.cancelStack).perform()},S.updateStack=function(B){const N=this.getLocation(),y={type:this.name,noDraw:!0,opts:{partUuid:N.partUuid,measureUuid:N.measureUuid,voiceUuid:N.voiceUuid,timePos:N.timePos,divisions:N.dpq,pitch:e.default.copy(this.opts.pitch),fretData:B!==null?(0,f.default)(B):null}};this.cancelStack.push(y)},S.storeAction=function(){if(!this.cancelStack.hasAction()){const B=this.getLocation(),N={actionName:this.name,opts:{partUuid:B.partUuid,measureUuid:B.measureUuid,voiceUuid:B.voiceUuid,timePos:B.timePos,divisions:B.dpq,pitch:e.default.copy(this.opts.pitch),fretData:this.opts.fretData!==null?(0,f.default)(this.opts.fretData):null,sameStringAsPreviousNotes:!!this.opts.sameStringAsPreviousNotes}};this.cancelStack.storeAction(N)}},S.getLocation=function(){if(this.location===null){const B=this.measureData.getScoreData(),N=B.getPartUuid(this.opts.partIdx),y=B.getMeasureUuid(this.opts.measureIdx),k=B.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),V=this.measureData.getDpqValue(),z=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:N,measureUuid:y,voiceUuid:k,dpq:V,timePos:z}}return this.location},(0,n.default)(R);const K=R},310107:(j,x,t)=>{t.r(x),t.d(x,{default:()=>e});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(244616),A=t(760367),U=t(576660),O=t(578918),L=t(19405),E=t(476031),I=t(898039),g=t(52275),m=t(704621),d=t(981801),a=t(783177),r=t(287296),c=t(793317),s=t(42651);const i=function(o,h,_){this.init(o,h,_)};i.NAME="action.SetTieDirection",i.isNoChange=function(o){return o instanceof C.default};const n=i.prototype;n.name=i.NAME,n.initMeasureData=c.default,n.init=function(o,h,_){(0,g.default)(o,h),(0,m.default)(o,h),(0,d.default)(o,h),(0,a.default)(o,h),this.initMeasureData(o,h),this.cancelStack=_,this.opts=h,this.noteHead=null,this.voice=null,this.location=null},n.checkPreconditions=function(){A.A.check(this.opts.tieDirection),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,I.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkNoChange()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},n.checkValues=function(){(0,L.default)(this.opts),M.default.check(this.opts.color)},n.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},n.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},n.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,E.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,r.default)(this.measureData,this.opts)},n.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const h=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,h)}},n.checkNoChange=function(){const o=this.getNoteAtPitch();if(D.default.getTieDirection(o)===this.opts.tieDirection)throw new C.default},n.getNoteAtPitch=function(){if(this.noteHead===null){const o=this.getVoice();this.noteHead=(0,O.default)(o,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const o=this.getPreviousData();this.setTieDirection(),this.updateStack(o)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),h={partUuid:o.partUuid,measureUuid:o.measureUuid,voiceUuid:o.voiceUuid,divisions:o.dpq,timePos:o.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,tieDirection:this.opts.tieDirection},_={actionName:this.name,opts:h};this.cancelStack.storeAction(_)}},n.getPreviousData=function(){const o=this.getNoteAtPitch();return{tieDirection:D.default.getTieDirection(o)}},n.setTieDirection=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),tieDirection:this.opts.tieDirection};new U.A(this.measureData,o,this.cancelStack).perform()},n.updateStack=function({tieDirection:o}){const h=this.getLocation(),_={partUuid:h.partUuid,measureUuid:h.measureUuid,voiceUuid:h.voiceUuid,divisions:h.dpq,timePos:h.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),tieDirection:o},p={type:this.name,noDraw:!0,opts:_};this.cancelStack.push(p)},n.getLocation=function(){if(this.location===null){const o=this.measureData.getScoreData(),h=o.getPartUuid(this.opts.partIdx),_=o.getMeasureUuid(this.opts.measureIdx),p=o.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),f=this.measureData.getDpqValue(),P=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:h,measureUuid:_,voiceUuid:p,dpq:f,timePos:P,isConcertPitch:!1}}return this.location},n.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,s.default)(i);const e=i},320725:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(244616),A=t(766246),U=t(762860),O=t(19405),L=t(476031),E=t(898039),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(287296),r=t(793317),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.AddColorToGrace",s.isNoChange=function(e){return e instanceof C.default};const i=s.prototype;i.name=s.NAME,i.initMeasureData=r.default,i.init=function(e,o,h){(0,I.default)(e,o),(0,g.default)(e,o),(0,m.default)(e,o),(0,d.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.noteHead=null,this.voice=null,this.location=null},i.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,E.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkDifferentFingering()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkValues=function(){(0,O.default)(this.opts),M.default.check(this.opts.color)},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},i.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,L.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts)},i.checkNoteAtPitch=function(){if(typeof this.getGraceAtPitch()=="undefined"){const o=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,o)}},i.checkDifferentFingering=function(){const e=this.getGraceAtPitch();if(D.default.hasColor(e)&&D.default.getColor(e)===this.opts.color)throw new C.default},i.getGraceAtPitch=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,U.A)(e,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addColorToGrace(),this.updateStack()},i.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,graceIdx:this.opts.graceIdx,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1,color:this.opts.color},h={actionName:this.name,opts:o};this.cancelStack.storeAction(h)}},i.addColorToGrace=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:v.default.copy(this.opts.pitch),color:this.opts.color};new A.A(this.measureData,e,this.cancelStack).perform()},i.updateStack=function(){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,graceIdx:this.opts.graceIdx,timePos:e.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch)},h={type:this.name,noDraw:!0,opts:o};this.cancelStack.push(h)},i.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),l=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:h,voiceUuid:_,dpq:p,timePos:l,isConcertPitch:!1}}return this.location},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},321097:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(748803),W=t(807205),T=t(195446),D=t(476943),v=t(123491),M=t(351277),A=t(737903),U=t(679676),O=t(42651),L=t(793317),E=t(922679),I=t(313499),g=t(287296),m=t(578918);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.UntieNoteHead",d.isAuthorizedException=function(c){return U.default.isAuthorizedException(c)};const a=d.prototype;a.name=d.NAME,a.initMeasureData=L.default,a.getVoice=E.A,a.lineToDestPitch=I.A,a.init=function(c,s,i){this.initMeasureData(c,s),this.cancelStack=i,this.opts=s,this.lineToDestPitch(),this.opts.isConcertPitch&&(this.opts.pitch=M.default.copy(this.opts),(0,g.default)(this.measureData,this.opts),this.opts.octave=M.default.getOctave(this.opts.pitch),this.opts.step=M.default.getStep(this.opts.pitch)),this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let c=!0;try{this.checkPreconditions()}catch(s){if(d.isAuthorizedException(s))c=!1;else throw s}return c},a.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const c=this.getVoice();c.checkNoteIdx(this.opts.noteIdx),c.checkNotRest(this.opts.noteIdx),this.checkPitch()},a.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},a.checkPitch=function(){let c,i=this.getVoice().getChord(this.opts.noteIdx);if(i=D.default.makeArray(i),typeof i.find(this.pitchPredicate,this)=="undefined")throw c={msgPrefix:"there is no left note"},new C.default(c,this.opts);const e=this.canUntieLeft(),o=this.canUntieRight();if(!e&&!o)throw new W.A("There is nothing to untie")},a.pitchPredicate=function(c){const s=v.default.getPitch(c);return M.default.isSameLine(s,this.opts)},a.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){const c=this.getLeftAction();c.cancelStack=this.cancelStack,c.perform()}if(this.canUntieRight()){const c=this.getRightAction();c.cancelStack=this.cancelStack,c.perform()}},a.canUntieRight=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),s=(0,m.default)(c,this.opts.noteIdx,this.opts);if(!v.default.hasTieStart(s))return!1;if(this.untieRight===null){const i=this.getRightAction();try{i.checkPreconditions(),this.untieRight=!0}catch(n){if(U.default.isAuthorizedException(n))this.untieRight=!1;else throw n}}return this.untieRight},a.getRightAction=function(){if(this.rightAction===null){const c=(0,A.default)(this.opts);this.rightAction=new U.default(this.measureData,c,this.cancelStack)}return this.rightAction},a.canUntieLeft=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),s=(0,m.default)(c,this.opts.noteIdx,this.opts);if(!v.default.hasTieStop(s))return!1;if(this.untieLeft===null){const i=this.getLeftAction();try{i.checkPreconditions(),this.untieLeft=!0}catch(n){if(U.default.isAuthorizedException(n))this.untieLeft=!1;else throw n}}return this.untieLeft},a.getLeftAction=function(){if(this.leftAction===null){const c=(0,A.default)(this.opts);c.noteIdx--,this.leftAction=new U.default(this.measureData,c,this.cancelStack)}return this.leftAction},(0,O.default)(d);const r=d},326582:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(278243),W=t(748803),T=t(195446),D=t(123491),v=t(351277),M=t(691309),A=t(898039),U=t(325600),O=t(52275),L=t(704621),E=t(981801),I=t(445330),g=t(591114),m=t(793317),d=t(313499),a=t(42651),r=t(31278);const c=function(e,o,h){this.init(e,o,h)};c.NAME="action.AddSlide";const s=c.prototype;s.name=c.NAME,s.initMeasureData=m.default,s.lineToDestPitch=d.A,s.init=function(e,o,h){(0,O.default)(e,o),(0,L.default)(e,o),(0,E.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,(0,A.default)(this.measureData,o),this.crossMeasure=new M.default(this.measureData,o.voiceIdx,o.noteIdx),this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},s.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new C.A},s.isLeftRest=function(){return this.crossMeasure.isLeftRest()},s.isRightRest=function(){return this.crossMeasure.isRightRest()},s.checkPitch=function(){let e;const o=this.getLeftChord(),h=this.getRightChord();if(typeof o.find(i,this.opts.leftPitch)=="undefined")throw e={msgPrefix:"there is no left note"},new W.default(e,this.opts.leftPitch);if(typeof h.find(i,this.opts.rightPitch)=="undefined")throw e={msgPrefix:"there is no right note"},new W.default(e,this.opts.rightPitch);if((0,I.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch))throw new r.default};function i(e){const o=this,h=D.default.getPitch(e);return v.default.isSameLine(h,o)}s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.addSlide(),this.updateStack()},s.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,divisions:e.dpq,timePos:e.timePos,voiceUuid:e.voiceUuid,leftPitch:v.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:v.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.storeAction(o)}},s.getLeftChord=function(){return this.crossMeasure.getLeftChord()},s.getRightChord=function(){return this.crossMeasure.getRightChord()},s.addSlide=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),leftPitch:v.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:v.default.copyWithoutAlter(this.opts.rightPitch)},o=this.crossMeasure.getLeftMeasure();new g.A(o,e,this.cancelStack).perform()},s.updateStack=function(){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const e=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:e.timePos,divisions:e.dpq,voiceUuid:e.voiceUuid,leftPitch:v.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:v.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.push(o)},s.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=this.crossMeasure.getLeftMeasureIdx(),_=e.getMeasureUuid(h),p=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),f=this.crossMeasure.getLeftMeasure().getDpqValue(),l=this.crossMeasure.getLeftVoice(),P=this.crossMeasure.getLeftNoteIdx(),u=(0,U.A)(l,P);this.location={partUuid:o,measureUuid:_,voiceUuid:p,dpq:f,timePos:u}}return this.location},(0,a.default)(c);const n=c},330179:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(31278),W=t(195446),T=t(160814),D=t(476943),v=t(737903),M=t(123491),A=t(351277),U=t(967104),O=t(264358),L=t(52275),E=t(704621),I=t(981801),g=t(783177),m=t(898039),d=t(287296),a=t(793317),r=t(575349),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.RemoveBend",s.isNoChange=function(e){return e instanceof C.default};const i=s.prototype;i.name=s.NAME,i.initMeasureData=a.default,i.init=function(e,o,h){(0,L.default)(e,o),(0,E.default)(e,o),(0,I.default)(e,o),(0,g.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.noteHead=null,this.voice=null,this.location=null},i.checkPreconditions=function(){A.default.check(this.opts.pitch),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,m.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitchFret(),this.checkHasBend()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.sanitizeIfNeeded=function(){this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts)},i.checkNoteAtPitchFret=function(){if(typeof this.getNoteAtPitchFret()=="undefined"){const o=A.default.copy(this.opts.pitch),h=(0,v.default)(this.opts.fretData);throw new T.A(o,h)}},i.checkHasBend=function(){const e=this.getNoteAtPitchFret();if(!M.default.hasBend(e))throw new C.default},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.removeBend(),this.updateStack(e)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData),isConcertPitch:!1},h={actionName:this.name,opts:o};this.cancelStack.storeAction(h)}},i.getPreviousData=function(){const e=this.getNoteAtPitchFret(),o=M.default.getBend(e),h=U.A.getType(o),_=U.A.getAlter(o);return{type:h,alter:_}},i.getNoteAtPitchFret=function(){if(this.noteHead===null){let o=this.getVoice().getChord(this.opts.noteIdx);o=D.default.makeArray(o),this.noteHead=o.find(r.A,this.opts)}return this.noteHead},i.removeBend=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copy(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData)};new O.A(this.measureData,e,this.cancelStack).perform()},i.updateStack=function({type:e,alter:o}){const h=this.getLocation(),_={partUuid:h.partUuid,measureUuid:h.measureUuid,voiceUuid:h.voiceUuid,divisions:h.dpq,timePos:h.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData),type:e,alter:o},p={type:this.name,noDraw:!0,opts:_};this.cancelStack.push(p)},i.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),l=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:h,voiceUuid:_,dpq:p,timePos:l}}return this.location},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},346546:(j,x,t)=>{t.r(x),t.d(x,{default:()=>s});var C=t(857552),W=t(990937),T=t(31278),D=t(346843),v=t(52275),M=t(407819),A=t(2110),U=t(519405),O=t(726042),L=t(123491),E=t(701387),I=t(377180),g=t(614653),m=t(42651);const d=function(i,n,e){this.init(i,n,e)};d.NAME="action.TransposeHarmoniesRange";const a=d.prototype;a.name=d.NAME,a.init=function(i,n,e){(0,M.default)(i,n),(0,v.default)(i,n),this.scoreData=i,this.measuresScroller=null,this.cancelStack=e,this.opts=n,this.location=null,this.wrappedActions=null},a.checkPreconditions=function(){if(I.default.check(this.opts.transpose),I.default.isIdentity(this.opts.transpose))throw new T.default;this.checkLocation(),this.checkActions()},a.checkLocation=function(){this.scoreData.checkMeasureIdx(this.opts.startMeasureIdx),this.scoreData.checkMeasureIdx(this.opts.stopMeasureIdx);const i=this.opts.startMeasureIdx,n=this.opts.stopMeasureIdx,e=n-i;if(e<0)throw new C.default(C.default.MEASURE,i,n);this.hasNoteIndexes()&&(this.checkNoteIndexes(e),this.convertNoteIndexes()),this.checkTimePos(e)},a.hasNoteIndexes=function(){return typeof this.opts.startNoteIdx!="undefined"||typeof this.opts.startVoiceIdx!="undefined"||typeof this.opts.stopNoteIdx!="undefined"||typeof this.opts.stopVoiceIdx!="undefined"},a.checkNoteIndexes=function(){const i=this.getMeasuresScroller(),n=i.getMeasureData(this.opts.startMeasureIdx);n.checkVoiceIdx(this.opts.startVoiceIdx),n.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);const o=i.getMeasureData(this.opts.stopMeasureIdx);o.checkVoiceIdx(this.opts.stopVoiceIdx),o.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},a.convertNoteIndexes=function(){const i=this.getMeasuresScroller(),n=i.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=n.getDpqValue();const e=n.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=e.getRangeSpace(0,this.opts.startNoteIdx);const o=i.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=o.getDpqValue();const h=o.getVoice(this.opts.stopVoiceIdx),_=h.getNote(this.opts.stopNoteIdx),p=L.default.getDuration(_);this.opts.stopTimePos=h.getRangeSpace(0,this.opts.stopNoteIdx)+p,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},a.getMeasuresScroller=function(){return this.measuresScroller===null&&(this.measuresScroller=(0,A.A)(this.scoreData,this.opts)),this.measuresScroller},a.checkTimePos=function(i){const n=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx);this.checkStartTimePos(n,this.opts.startDpq,this.opts.startTimePos);const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx);if(this.checkStopTimePos(e,this.opts.stopDpq,this.opts.stopTimePos),i===0){const o=O.default.lcm(this.opts.startDpq,this.opts.stopDpq),h=this.opts.startTimePos*o/this.opts.startDpq,_=this.opts.stopTimePos*o/this.opts.stopDpq;if(h>_)throw new C.default(C.default.TIME_POS,h,_)}},a.checkStartTimePos=function(i,n,e){const o=E.default.getDpq(i);let h=E.default.getNbDivisions(i);const _=O.default.lcm(o,n);if(h*=_/o,e*=_/n,!O.default.isInteger(e)||e<0||e>=h)throw new W.A(e,_)},a.checkStopTimePos=function(i,n,e){const o=E.default.getDpq(i);let h=E.default.getNbDivisions(i);const _=O.default.lcm(o,n);if(h*=_/o,e*=_/n,!O.default.isInteger(e)||e<0||e>h)throw new W.A(e,_)},a.checkActions=function(){const i=this.getWrappedActions();if(i.length===0)throw new T.default;if(!i.some(r))throw i[0].error};const r=function(i){try{i.action.checkPreconditions()}catch(n){if(c(n))return i.checked=!0,i.error=n,!1;throw n}return i.checked=!0,!0};a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),n=i.measureUuids.slice(),e=I.default.copy(this.opts.transpose),o={actionName:this.name,opts:{partUuid:i.partUuid,measureUuids:n,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,transpose:e}};this.cancelStack.storeAction(o)}},a.getLocation=function(){if(this.location===null){const i=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),n=this.scoreData.getPartUuid(this.opts.partIdx);this.location={partUuid:n,measureUuids:i}}return this.location},a.getWrappedActions=function(){return this.wrappedActions===null&&this.createWrappedActions(),this.wrappedActions},a.createWrappedActions=function(){this.wrappedActions=[];let i=this.opts.startMeasureIdx;const n=this.opts.stopMeasureIdx;for(;i<=n;i++){const e=this.scoreData.getMeasure(this.opts.partIdx,i);let o=E.default.getJazzHarmonies(e);this.measureIdx=i,o=o.filter(this.isHarmonyWithinBounds,this),o.forEach(this.createWrappedAction,this)}},a.isHarmonyWithinBounds=function(i){const n=g.default.getTimePos(i);if(this.measureIdx===this.opts.startMeasureIdx){const e=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),o=E.default.getDpq(e),h=this.opts.startTimePos*o/this.opts.startDpq;if(n<h)return!1}if(this.measureIdx===this.opts.stopMeasureIdx){const e=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),o=E.default.getDpq(e),h=this.opts.stopTimePos*o/this.opts.stopDpq;if(n>=h)return!1}return!0},a.createWrappedAction=function(i){const n=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),e=E.default.getDpq(n),o=g.default.getTimePos(i),h=I.default.copy(this.opts.transpose),_={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,timePos:o,dpq:e,transpose:h},p=null,l={action:new D.default(this.scoreData,_,p),error:null,checked:!1};this.wrappedActions.push(l)},a.callPerform=function(i){i.error===null&&(i.action.cancelStack=this.cancelStack,i.checked?i.action.perform():(0,U.default)(i.action,c))};const c=function(){return!1};(0,m.default)(d);const s=d},346843:(j,x,t)=>{t.r(x),t.d(x,{default:()=>d});var C=t(31278),W=t(646456),T=t(990937),D=t(726042),v=t(701387),M=t(614653),A=t(377180),U=t(95627),O=t(52275),L=t(704621),E=t(793317),I=t(42651);const g=function(a,r,c){this.init(a,r,c)};g.NAME="action.TransposeHarmony";const m=g.prototype;m.name=g.NAME,m.initMeasureData=E.default,m.init=function(a,r,c){(0,O.default)(a,r),(0,L.default)(a,r),this.scoreData=a,this.cancelStack=c,this.opts=r,this.localTimePos=null,this.harmonyIdx=null,this.action=null,this.location=null},m.checkPreconditions=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx),this.checkTimePos(),this.checkHarmony(),this.checkTranspose(),this.getAction().checkPreconditions()},m.checkTimePos=function(){const a=this.getLocalTimePos(),r=this.getMeasure(),c=v.default.getNbDivisions(r);if(!D.default.isNumber(a)||a<0||a>=c){const s=v.default.getDpq(r);throw new W.A(a,s)}},m.checkHarmony=function(){this.fetchHarmonyIdx()},m.checkTranspose=function(){if(A.default.check(this.opts.transpose),A.default.isUnison(this.opts.transpose))throw new C.default},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const a=this.getAction();a.cancelStack=this.cancelStack,a.perform()},m.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r=A.default.copy(this.opts.transpose),c={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,dpq:this.opts.dpq,timePos:this.opts.timePos,transpose:r}};this.cancelStack.storeAction(c)}},m.getLocation=function(){if(this.location===null){const a=this.scoreData.getPartUuid(this.opts.partIdx),r=this.scoreData.getMeasureUuid(this.opts.measureIdx);this.location={partUuid:a,measureUuid:r}}return this.location},m.getAction=function(){if(this.action===null){let a=this.getCurrentHarmony();a=M.default.transpose(a,this.opts.transpose);let r=null;M.default.hasBass(a)&&(r=M.default.getBass(a));const c=M.default.getRoot(a),s=M.default.getKindValue(a),i=M.default.getDegrees(a),n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,root:c,kind:s,bass:r,degrees:i},e=null;this.action=new U.default(this.scoreData,n,e)}return this.action},m.getCurrentHarmony=function(){const a=this.getMeasure(),r=v.default.getJazzHarmonies(a),c=this.getHarmonyIdx();return r[c]},m.getHarmonyIdx=function(){return this.harmonyIdx===null&&this.fetchHarmonyIdx(),this.harmonyIdx},m.fetchHarmonyIdx=function(){const a=this.getMeasure();if(v.default.getJazzHarmonies(a).some(this.checkHarmonyTimePos,this),this.harmonyIdx===null){const c=this.getLocalTimePos(),s=v.default.getDpq(a);throw new T.A(c,s)}},m.checkHarmonyTimePos=function(a,r){const c=this.getLocalTimePos(),s=M.default.getTimePos(a);return s<c?!1:(s===c&&(this.harmonyIdx=r),!0)},m.getLocalTimePos=function(){if(this.localTimePos===null){const a=this.getMeasure(),r=v.default.getDpq(a),c=this.opts.dpq;this.localTimePos=this.opts.timePos*r/c}return this.localTimePos},m.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},(0,I.default)(g);const d=g},377328:(j,x,t)=>{t.r(x),t.d(x,{default:()=>e});var C=t(195446),W=t(674212),T=t(490884),D=t(320725),v=t(737903),M=t(123491),A=t(351277),U=t(793317),O=t(52275),L=t(704621),E=t(981801),I=t(783177),g=t(898039),m=t(476031),d=t(287296),a=t(714898),r=t(762860),c=t(534512),s=t(42651);const i=function(o,h,_){this.init(o,h,_)};i.NAME="action.ChangeGracePitch",i.copyAddOpts=function(o){const h={partIdx:o.partIdx,measureIdx:o.measureIdx,voiceIdx:o.voiceIdx,staffIdx:o.staffIdx,noteIdx:o.noteIdx,graceIdx:o.graceIdx,accidental:o.accidental,fretData:o.fretData,isConcertPitch:o.isConcertPitch,checkLine:o.checkLine};return typeof o.toLine!="undefined"?h.line=o.toLine:typeof o.toPitch!="undefined"&&(h.pitch=A.default.copy(o.toPitch)),h},i.copyRemoveOpts=function(o){const h={partIdx:o.partIdx,measureIdx:o.measureIdx,voiceIdx:o.voiceIdx,noteIdx:o.noteIdx,graceIdx:o.graceIdx,isConcertPitch:o.isConcertPitch};return typeof o.fromLine!="undefined"?(h.line=o.fromLine,h.staffIdx=o.staffIdx):typeof o.fromPitch!="undefined"&&(h.pitch=A.default.copy(o.fromPitch)),h};const n=i.prototype;n.name=i.NAME,n.initMeasureData=U.default,n.init=function(o,h,_){(0,O.default)(o,h),(0,L.default)(o,h),(0,E.default)(o,h),(0,I.default)(o,h),this.initMeasureData(o,h),this.cancelStack=_,this.opts=h,(0,g.default)(this.measureData,this.opts),this.addAction=null,this.removeAction=null,this.location=null,this.graceAtPitch=null,this.sanitized=!1},n.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkPitchedPart();const o=this.measureData.getVoice(this.opts.voiceIdx);o.checkNoteIdx(this.opts.noteIdx),o.checkNotRest(this.opts.noteIdx),o.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.getAddAction().checkPreconditions(),this.getRemoveAction().checkPitchExist()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},n.sanitizeIfNeeded=function(){if(!this.sanitized){if(typeof this.opts.fromLine!="undefined"){const o={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isConcertPitch:this.opts.isConcertPitch,line:this.opts.fromLine};(0,m.default)(this.measureData,o,!0),this.opts.fromPitch=A.default.copy(o.pitch),delete this.opts.fromLine}if(typeof this.opts.toLine!="undefined"){const o={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isConcertPitch:this.opts.isConcertPitch,line:this.opts.toLine};(0,m.default)(this.measureData,o,!0),this.opts.toPitch=A.default.copy(o.pitch),delete this.opts.toLine}if(this.opts.isConcertPitch){const o={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,isConcertPitch:this.opts.isConcertPitch,pitch:this.opts.fromPitch};(0,d.default)(this.measureData,o),this.opts.fromPitch=A.default.copy(o.pitch);const h={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,isConcertPitch:this.opts.isConcertPitch,pitch:this.opts.toPitch,accidental:this.opts.accidental};(0,a.default)(this.measureData,h),this.opts.toPitch=A.default.copy(h.pitch),this.opts.accidental=h.accidental,this.opts.isConcertPitch=!1}if(this.isTabStaff()){const o=typeof this.opts.fretData=="undefined"?{}:(0,v.default)(this.opts.fretData),h=this.getGraceAtPitch();typeof h!="undefined"&&M.default.hasFretData(h)&&(o.lastString=M.default.getString(h)),this.opts.fretData=o}this.sanitized=!0}},n.isTabStaff=function(){return(0,c.default)(this.measureData,this.opts)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getActions().forEach(this.callPerform,this)},n.callPerform=function(o){o.cancelStack=this.cancelStack,o.perform()},n.getActions=function(){const o=[this.getAddAction(),this.getRemoveAction()];if(this.opts.preserveColor&&this.hasColor()){const h=this.getColorAction();o.push(h)}return o},n.getAddAction=function(){if(this.addAction===null){const o=i.copyAddOpts(this.opts);this.addAction=new W.default(this.measureData,o,this.cancelStack)}return this.addAction},n.getRemoveAction=function(){if(this.removeAction===null){const o=i.copyRemoveOpts(this.opts);this.removeAction=new T.default(this.measureData,o,this.cancelStack)}return this.removeAction},n.hasColor=function(){const o=this.getGraceAtPitch();return M.default.hasColor(o)},n.getColorAction=function(){const o=this.getGraceAtPitch(),h=this.getAddAction(),_=M.default.getColor(o),p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:A.default.copy(h.opts.pitch),color:_};return new D.default(this.measureData,p,this.cancelStack)},n.getGraceAtPitch=function(){if(this.graceAtPitch===null){const o=this.getRemoveAction(),h=this.measureData.getVoice(this.opts.voiceIdx);this.graceAtPitch=(0,r.A)(h,this.opts.noteIdx,this.opts.graceIdx,o.opts.pitch)}return this.graceAtPitch},n.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),h=this.getRemoveAction(),_=A.default.copyWithoutAlter(h.opts.pitch),p=this.getAddAction(),f=A.default.copyWithoutAlter(p.opts.pitch),l={partUuid:o.partUuid,measureUuid:o.measureUuid,voiceUuid:o.voiceUuid,staffUuid:o.staffUuid,timePos:o.timePos,divisions:o.dpq,graceIdx:this.opts.graceIdx,accidental:this.opts.accidental,fromPitch:_,toPitch:f,checkLine:this.opts.checkLine,preserveColor:!!this.opts.preserveColor};this.opts.fretData&&typeof this.opts.fretData.string!="undefined"&&(l.fretData=(0,v.default)(this.opts.fretData),delete l.fretData.lastString);const P={actionName:this.name,opts:l};this.cancelStack.storeAction(P)}},n.getLocation=function(){if(this.location===null){const o=this.measureData.getScoreData(),h=o.getPartUuid(this.opts.partIdx),_=o.getMeasureUuid(this.opts.measureIdx),p=o.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),f=o.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),l=this.measureData.getDpqValue(),u=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:h,measureUuid:_,staffUuid:p,voiceUuid:f,dpq:l,timePos:u}}return this.location},(0,s.default)(i);const e=i},379097:(j,x,t)=>{t.r(x),t.d(x,{default:()=>m});var C=t(31278),W=t(505657),T=t(123491),D=t(474976),v=t(793317),M=t(898039),A=t(52275),U=t(704621),O=t(981801),L=t(184360),E=t(42651);const I=function(d,a,r){this.init(d,a,r)};I.NAME="action.RemoveArticulation";const g=I.prototype;g.initMeasureData=v.default,g.name=I.NAME,g.init=function(d,a,r){(0,A.default)(d,a),(0,U.default)(d,a),(0,O.default)(d,a),this.initMeasureData(d,a),this.cancelStack=r,this.opts=a,(0,M.default)(this.measureData,this.opts),this.location=null},g.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},g.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const d=this.measureData.getVoice(this.opts.voiceIdx);d.checkNoteIdx(this.opts.noteIdx),d.checkNotRest(this.opts.noteIdx)},g.checkExistence=function(){if(!D.default.isValid(this.opts.articulationType))throw new W.A(this.opts.placement);const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!T.default.hasArticulation(a,this.opts.articulationType))throw new C.default(this.opts.articulationType)},g.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx};new L.A(this.measureData,d,this.cancelStack).perform(),this.storeAction(),this.updateStack()},g.updateStack=function(){const d=this.getLocation(),a={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,articulationType:this.opts.articulationType,timePos:d.timePos,divisions:d.dpq}};this.cancelStack.push(a)},g.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),a={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,articulationType:this.opts.articulationType,timePos:d.timePos,divisions:d.dpq}};this.cancelStack.storeAction(a)}},g.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),a=d.getPartUuid(this.opts.partIdx),r=d.getMeasureUuid(this.opts.measureIdx),c=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),s=this.measureData.getDpqValue(),n=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:r,voiceUuid:c,dpq:s,timePos:n}}return this.location},(0,E.default)(I);const m=I},381642:(j,x,t)=>{t.r(x),t.d(x,{default:()=>p});var C=t(748803),W=t(195446),T=t(614426),D=t(476943),v=t(123491),M=t(351277),A=t(737903),U=t(606611),O=t(19405),L=t(610860),E=t(476031),I=t(33674),g=t(573559),m=t(714898),d=t(52275),a=t(704621),r=t(981801),c=t(783177),s=t(898039),i=t(8963),n=t(793317),e=t(42651);const o=function(f,l,P){this.init(f,l,P)};o.NAME="action.AddToChord",o.isNoChange=function(f){return f instanceof C.default};const h=o.prototype;h.name=o.NAME,h.initMeasureData=n.default,h.init=function(f,l,P){(0,d.default)(f,l),(0,a.default)(f,l),(0,r.default)(f,l),(0,c.default)(f,l),this.initMeasureData(f,l),this.cancelStack=P,this.opts=l,this.sanitized=!1,this.voice=null,this.location=null,(0,s.default)(this.measureData,this.opts)},h.checkPreconditions=function(){this.checkPitchedPart(),this.checkValues(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkLineOverflow(),this.checkPitchInsertion()},h.checkValues=function(){(0,O.default)(this.opts),this.opts.accidental!==null&&T.default.check(this.opts.accidental)},h.checkPitch=function(){M.default.check(this.opts.pitch)},h.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},h.checkCompatibleVoiceStaffIdx=function(){(0,I.default)(this.measureData,this.opts)},h.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},h.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},h.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},h.checkLineOverflow=function(){this.opts.checkLine&&(0,g.A)(this.measureData,this.opts)},h.checkPitchInsertion=function(){if(this.getChord().findIndex(_,this.opts.pitch)!==-1){const P=M.default.copy(this.opts.pitch);throw new C.default(C.default.INSERT,P)}},h.getChord=function(){const l=this.getVoice().getChord(this.opts.noteIdx);return D.default.makeArray(l)};const _=function(f){const l=v.default.getPitch(f),P=this;return M.default.isSameLine(l,P)};h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addToChord(),this.opts.record&&this.updateCancelStack()},h.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),typeof this.opts.line!="undefined"&&(0,E.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,m.default)(this.measureData,this.opts),(0,i.A)(this.measureData,this.opts),typeof this.opts.record=="undefined"&&(this.opts.record=!0),(0,L.A)(this.measureData,this.opts),this.sanitized=!0)},h.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),l={partUuid:f.partUuid,measureUuid:f.measureUuid,voiceUuid:f.voiceUuid,staffUuid:f.staffUuid,divisions:f.dpq,timePos:f.timePos,pitch:M.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine};typeof this.opts.fretData!="undefined"&&(l.fretData=(0,A.default)(this.opts.fretData));const P={actionName:this.name,opts:l};this.cancelStack.storeAction(P)}},h.addToChord=function(){const f={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,pitch:M.default.copy(this.opts.pitch),fretData:this.opts.fretData,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new U.A(this.measureData,f,this.cancelStack).perform()},h.performAction=function(f){f.cancelStack=this.cancelStack,f.perform()},h.updateCancelStack=function(){const f=this.getLocation(),l={type:this.name,noDraw:!0,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceUuid:f.voiceUuid,divisions:f.dpq,timePos:f.timePos,pitch:M.default.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.push(l)},h.getLocation=function(){if(this.location===null){const f=this.measureData.getScoreData(),l=f.getPartUuid(this.opts.partIdx),P=f.getMeasureUuid(this.opts.measureIdx),u=f.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),R=f.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),S=this.measureData.getDpqValue(),B=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:l,measureUuid:P,staffUuid:u,voiceUuid:R,dpq:S,timePos:B}}return this.location},(0,e.default)(o);const p=o},407304:(j,x,t)=>{t.r(x),t.d(x,{default:()=>d});var C=t(934664),W=t(209175),T=t(123491),D=t(758035),v=t(793317),M=t(52275),A=t(704621),U=t(981801),O=t(898039),L=t(975924),E=t(702868),I=t(42651);const g=function(a,r,c){this.init(a,r,c)};g.NAME="action.RemoveTuplet";const m=g.prototype;m.name=g.NAME,m.initMeasureData=v.default,m.init=function(a,r,c){(0,M.default)(a,r),(0,A.default)(a,r),(0,U.default)(a,r),this.initMeasureData(a,r),this.cancelStack=c,this.opts=r,this.location=null,this.startNoteIdx=null,(0,O.default)(this.measureData,this.opts)},m.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkTuplet()},m.checkNoteIdx=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},m.checkTuplet=function(){const r=this.getVoiceOrTupletForGet().getAbsoluteTimeModif();if(W.default.isNormal(r))throw new C.A},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.startNoteIdx=this.getStartNoteIdx(),this.tupletType=this.getTupletType(),this.storeAction(),this.removeTuplet(),this.updateStack(),this.measureData.clearTupletCache(this.opts.voiceIdx)},m.getTupletType=function(){const a=this.getVoiceOrTupletForGet();return E.A.fromTimeModif(a.getAbsoluteTimeModif())},m.getStartNoteIdx=function(){return this.getVoiceOrTupletForGet().getStartNoteIdx()},m.getVoiceOrTupletForGet=function(){const a=this.opts.voiceIdx,r=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(a,r)},m.storeAction=function(){if(!this.cancelStack.hasAction()){const r=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx),c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:r}};this.cancelStack.storeAction(s)}},m.removeTuplet=function(){const a=this.getStartNoteIdx(),r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a};new D.A(this.measureData,r,this.cancelStack).perform()},m.updateStack=function(){const a=this.getLocation(),r=this.startNoteIdx,c=this.tupletType,s=this.measureData.getVoice(this.opts.voiceIdx),i=this.measureData.getDpqValue(),n=s.getNote(r),e=T.default.getNbDots(n),o=(0,L.default)(n,i);let h=T.default.getTimeModif(n);h=W.default.copy(h);const _={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,timePos:a.startTimePos,divisions:a.dpq,tupletType:c,timeModif:h,durationType:o,nbDots:e}};this.cancelStack.push(_)},m.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),r=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),s=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),i=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.startNoteIdx);this.location={partUuid:r,measureUuid:c,voiceUuid:s,dpq:i,startTimePos:e}}return this.location},(0,I.default)(g);const d=g},408649:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(570092),A=t(762860),U=t(19405),O=t(476031),L=t(898039),E=t(52275),I=t(704621),g=t(981801),m=t(783177),d=t(287296),a=t(793317),r=t(42651);const c=function(n,e,o){this.init(n,e,o)};c.NAME="action.RemoveColorFromGrace",c.isNoChange=function(n){return n instanceof C.default};const s=c.prototype;s.name=c.NAME,s.initMeasureData=a.default,s.init=function(n,e,o){(0,E.default)(n,e),(0,I.default)(n,e),(0,g.default)(n,e),(0,m.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkColor()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},s.checkValues=function(){(0,U.default)(this.opts)},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},s.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts)},s.checkNoteAtPitch=function(){if(typeof this.getGraceAtPitch()=="undefined"){const e=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,e)}},s.checkColor=function(){const n=this.getGraceAtPitch();if(!D.default.hasColor(n))throw new C.default},s.getGraceAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,A.A)(n,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.noteHead},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const n=this.extractColor();this.removeColorFromGrace(),this.updateStack(n)},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,graceIdx:this.opts.graceIdx,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},o={actionName:this.name,opts:e};this.cancelStack.storeAction(o)}},s.extractColor=function(){const n=this.getGraceAtPitch();return D.default.getColor(n)},s.removeColorFromGrace=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:v.default.copy(this.opts.pitch)};new M.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(n){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,graceIdx:this.opts.graceIdx,pitch:v.default.copyWithoutAlter(this.opts.pitch),color:n},h={type:this.name,noDraw:!0,opts:o};this.cancelStack.push(h)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f,isConcertPitch:!1}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(c);const i=c},424654:(j,x,t)=>{t.r(x),t.d(x,{default:()=>g});var C=t(31278),W=t(46056),T=t(328365),D=t(123491),v=t(52275),M=t(704621),A=t(981801),U=t(898039),O=t(793317),L=t(42651);const E=function(m,d,a){this.init(m,d,a)};E.NAME="action.RemoveGraceSlur",E.isNoChange=function(m){return m instanceof C.default};const I=E.prototype;I.name=E.NAME,I.initMeasureData=O.default,I.init=function(m,d,a){(0,v.default)(m,d),(0,M.default)(m,d),(0,A.default)(m,d),this.initMeasureData(m,d),this.cancelStack=a,this.opts=d,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null,(0,U.default)(this.measureData,this.opts)},I.checkPreconditions=function(){this.checkNoteIdx(),this.checkNotRest(),this.checkHasGraceNote(),this.checkHasNoGraceSlur()},I.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},I.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},I.checkHasGraceNote=function(){if(this.measureData.getScoreData().getNoteData(this.opts).nbGraces===0)throw new W.A},I.checkHasNoGraceSlur=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!D.default.hasGraceSlur(d))throw new C.default},I.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeGraceSlur(),this.updateStack()},I.storeAction=function(){if(!this.cancelStack.hasAction()){const m=this.getLocation(),d={actionName:this.name,opts:{partUuid:m.partUuid,measureUuid:m.measureUuid,voiceUuid:m.voiceUuid,divisions:m.dpq,timePos:m.timePos}};this.cancelStack.storeAction(d)}},I.removeGraceSlur=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new T.A(this.measureData,m,this.cancelStack).perform()},I.updateStack=function(){const m=this.getLocation(),d={type:this.name,noDraw:!0,opts:{partUuid:m.partUuid,measureUuid:m.measureUuid,voiceUuid:m.voiceUuid,timePos:m.timePos,divisions:m.dpq}};this.cancelStack.push(d)},I.getLocation=function(){if(this.location===null){const m=this.measureData.getScoreData(),d=m.getPartUuid(this.opts.partIdx),a=m.getMeasureUuid(this.opts.measureIdx),r=m.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),c=this.measureData.getDpqValue(),i=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:d,measureUuid:a,voiceUuid:r,dpq:c,timePos:i}}return this.location},(0,L.default)(E);const g=E},432456:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(364842),W=t(14822),T=t(920091),D=t(31278),v=t(123491),M=t(245826),A=t(2110),U=t(698716),O=t(563310),L=t(896275),E=t(52275),I=t(596463),g=t(981801),m=t(609817),d=t(42651);const a=function(s,i,n){this.init(s,i,n)};a.NAME="action.MoveSlurSide";const r=a.prototype;r.name=a.NAME,r.init=function(s,i,n){(0,E.default)(s,i),(0,I.A)(s,i),(0,g.default)(s,i),this.measuresScroller=(0,A.A)(s,i),this.cancelStack=n,this.opts=i,this.location=null,(0,m.A)(this.measuresScroller,this.opts)},r.checkPreconditions=function(){this.checkLocation(),this.checkPreviousNoteIdx(),this.checkNewNoteIdx()},r.checkLocation=function(){this.measuresScroller.checkMeasureIdx(this.opts.oldMeasureIdx);const s=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx);s.checkVoiceIdx(this.opts.voiceIdx),s.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.oldNoteIdx),this.measuresScroller.checkMeasureIdx(this.opts.newMeasureIdx);const n=this.measuresScroller.getMeasureData(this.opts.newMeasureIdx);n.checkVoiceIdx(this.opts.voiceIdx),n.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.newNoteIdx)},r.checkPreviousNoteIdx=function(){const s=this.getPreviousNote();if(!v.default.hasSlur(s))throw new W.A},r.getPreviousNote=function(){return this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.opts.oldNoteIdx)},r.checkNewNoteIdx=function(){this.checkNotRest(),this.checkInterval()},r.checkNotRest=function(){this.measuresScroller.getMeasureData(this.opts.newMeasureIdx).getVoice(this.opts.voiceIdx).checkNotRest(this.opts.newNoteIdx)},r.checkInterval=function(){const s=U.A.create(this.opts.oldMeasureIdx,this.opts.oldNoteIdx);s.voiceIdx=this.opts.voiceIdx;const i=U.A.create(this.opts.newMeasureIdx,this.opts.newNoteIdx);let n;if(U.A.isEqual(s,i))throw new D.default;if(U.A.isGreater(i,s))n=(0,L.A)(this.measuresScroller,s,i);else if(U.A.isLower(i,s))n=(0,O.A)(this.measuresScroller,s,i);else throw new C.default("Unexpected");if(n===null||!U.A.isEqual(n,i))throw new T.A},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.moveSlurSide(),this.updateCancelStack()},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i={partUuid:s.partUuid,voiceUuid:s.voiceUuid,oldMeasureUuid:s.oldMeasureUuid,oldDivisions:s.oldDivisions,oldTimePos:s.oldTimePos,newMeasureUuid:s.newMeasureUuid,newDivisions:s.newDivisions,newTimePos:s.newTimePos},n={actionName:this.name,opts:i};this.cancelStack.storeAction(n)}},r.moveSlurSide=function(){const s={partIdx:this.opts.partIdx,oldMeasureIdx:this.opts.oldMeasureIdx,newMeasureIdx:this.opts.newMeasureIdx,voiceIdx:this.opts.voiceIdx,oldNoteIdx:this.opts.oldNoteIdx,newNoteIdx:this.opts.newNoteIdx};new M.A(this.measuresScroller,s,this.cancelStack).perform()},r.updateCancelStack=function(){const s=this.getLocation(),i={partUuid:s.partUuid,voiceUuid:s.voiceUuid,oldMeasureUuid:s.oldMeasureUuid,oldDivisions:s.oldDivisions,oldTimePos:s.oldTimePos,newMeasureUuid:s.newMeasureUuid,newDivisions:s.newDivisions,newTimePos:s.newTimePos},n={type:this.name,noDraw:!0,opts:i};this.cancelStack.push(n)},r.getLocation=function(){if(this.location===null){const s=this.measuresScroller.getScoreData(),i=s.getPartUuid(this.opts.partIdx),n=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=s.getMeasureUuid(this.opts.oldMeasureIdx),o=this.measuresScroller.getMeasureData(this.opts.oldMeasureIdx),h=o.getDpqValue(),p=o.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.oldNoteIdx),f=s.getMeasureUuid(this.opts.newMeasureIdx),l=this.measuresScroller.getMeasureData(this.opts.newMeasureIdx),P=l.getDpqValue(),R=l.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.newNoteIdx);this.location={partUuid:i,voiceUuid:n,oldMeasureUuid:e,oldDivisions:h,oldTimePos:p,newMeasureUuid:f,newDivisions:P,newTimePos:R}}return this.location},(0,d.default)(a);const c=a},473990:(j,x,t)=>{t.r(x),t.d(x,{default:()=>d});var C=t(735696),W=t(31278),T=t(737903),D=t(123491),v=t(793317),M=t(898039),A=t(52275),U=t(704621),O=t(981801),L=t(724095),E=t(451183),I=t(42651);const g=function(a,r,c){this.init(a,r,c)};g.NAME="action.RemoveOrnament";const m=g.prototype;m.initMeasureData=v.default,m.name=g.NAME,m.init=function(a,r,c){(0,A.default)(a,r),(0,U.default)(a,r),(0,O.default)(a,r),this.initMeasureData(a,r),this.cancelStack=c,this.opts=(0,T.default)(r),this.location=null,(0,M.default)(this.measureData,this.opts)},m.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},m.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const a=this.measureData.getVoice(this.opts.voiceIdx);a.checkNoteIdx(this.opts.noteIdx),a.checkNotRest(this.opts.noteIdx)},m.checkExistence=function(){if(!L.A.isValid(this.opts.ornamentType))throw new C.A(this.opts.ornamentType);const r=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!D.default.hasOrnamentType(r,this.opts.ornamentType))throw new W.default;if(this.opts.ornamentType===L.A.TREMOLO&&D.default.hasTremoloSide(r))throw new W.default},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const a=this.extractOrnamentsOpts();this.storeAction();const r={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:this.opts.ornamentType};new E.A(this.measureData,r,this.cancelStack).perform(),this.updateStack(a)},m.extractOrnamentsOpts=function(){const r=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);return D.default.getOrnamentOpts(r,this.opts.ornamentType)},m.updateStack=function(a){const r=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:r.partUuid,measureUuid:r.measureUuid,voiceUuid:r.voiceUuid,timePos:r.timePos,divisions:r.dpq,ornamentType:this.opts.ornamentType,ornamentsOpts:(0,T.default)(a)}};this.cancelStack.push(c)},m.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),r={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,timePos:a.timePos,divisions:a.dpq,ornamentType:this.opts.ornamentType}};this.cancelStack.storeAction(r)}},m.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),r=a.getPartUuid(this.opts.partIdx),c=a.getMeasureUuid(this.opts.measureIdx),s=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),i=this.measureData.getDpqValue(),e=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:r,measureUuid:c,voiceUuid:s,dpq:i,timePos:e}}return this.location},(0,I.default)(g);const d=g},477172:(j,x,t)=>{t.r(x),t.d(x,{default:()=>_});var C=t(195446),W=t(748803),T=t(615428),D=t(351277),v=t(209175),M=t(737903),A=t(123491),U=t(476943),O=t(446625),L=t(19405),E=t(476031),I=t(578918),g=t(287296),m=t(52275),d=t(704621),a=t(981801),r=t(783177),c=t(898039),s=t(975924),i=t(793317),n=t(42651);const e=function(p,f,l){this.init(p,f,l)};e.NAME="action.RemoveFromChord";const o=e.prototype;o.name=e.NAME,o.initMeasureData=i.default,o.init=function(p,f,l){(0,m.default)(p,f),(0,d.default)(p,f),(0,a.default)(p,f),(0,r.default)(p,f),this.initMeasureData(p,f),this.cancelStack=l,this.opts=f,this.sanitized=!1,this.voice=null,this.location=null,(0,c.default)(this.measureData,this.opts)},o.checkPreconditions=function(){(0,L.default)(this.opts),this.sanitizeIfNeeded(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.checkSingleNote(),this.checkPitch()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},o.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},o.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},o.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},o.checkPitch=function(){this.sanitizeIfNeeded();const p=this.getVoice(),f=(0,I.default)(p,this.opts.noteIdx,this.opts.pitch);if(typeof f=="undefined"){const l=D.default.copy(this.opts.pitch);throw new W.default(W.default.GET,l)}A.default.checkNotLocked(f)},o.checkSingleNote=function(){if(!this.getVoice().isChord(this.opts.noteIdx))throw new T.A},o.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();let p;this.opts.record&&(p=this.getPreviousData()),this.removeFromChord(),this.opts.record&&this.updateCancelStack(p)},o.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,E.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,g.default)(this.measureData,this.opts),typeof this.opts.record=="undefined"&&(this.opts.record=!0),this.sanitized=!0)},o.getPreviousData=function(){const p=this.getVoice(),f=(0,I.default)(p,this.opts.noteIdx,this.opts.pitch),l=A.default.getStaffIdx(f),u=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,l),R=A.default.getPitch(f),S=D.default.getAlter(R),K=D.default.alterToAccidental(S),B=this.measureData.getDpqValue(),N=(0,s.default)(f,B),y=A.default.getNbDots(f),k=A.default.getTimeModif(f),V={staffUuid:u,accidental:K,durationType:N,nbDots:y,timeModif:v.default.copy(k)};return A.default.hasTabData(f)&&(V.fretData=this.extractFretData(f)),V},o.extractFretData=function(p){let f=A.default.getTabData(p);f=(0,M.default)(f);let P=this.getVoice().getChord(this.opts.noteIdx);return P=U.default.makeArray(P),P=P.filter(h,f),P.length>1&&(f.lastString=f.string),f};const h=function(p){return A.default.hasTabData(p)?A.default.getString(p)===this.string:!1};o.storeAction=function(){if(!this.cancelStack.hasAction()){const p=this.getLocation(),f={actionName:this.name,opts:{partUuid:p.partUuid,measureUuid:p.measureUuid,voiceUuid:p.voiceUuid,timePos:p.timePos,divisions:p.dpq,pitch:D.default.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.storeAction(f)}},o.removeFromChord=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:D.default.copy(this.opts.pitch)};new O.A(this.measureData,p,this.cancelStack).perform()},o.updateCancelStack=function(p){const f=this.getLocation(),l={partUuid:f.partUuid,measureUuid:f.measureUuid,voiceUuid:f.voiceUuid,staffUuid:p.staffUuid,timePos:f.timePos,divisions:f.dpq,pitch:D.default.copyWithoutAlter(this.opts.pitch),accidental:p.accidental,nbDots:p.nbDots,durationType:p.durationType,timeModif:v.default.copy(p.timeModif)};typeof p.fretData!="undefined"&&(l.fretData=(0,M.default)(p.fretData));const P={noDraw:!0,type:this.name,opts:l};this.cancelStack.push(P)},o.getLocation=function(){if(this.location===null){const p=this.measureData.getScoreData(),f=p.getPartUuid(this.opts.partIdx),l=p.getMeasureUuid(this.opts.measureIdx),P=p.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),u=this.measureData.getDpqValue(),S=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:f,measureUuid:l,voiceUuid:P,dpq:u,timePos:S}}return this.location},(0,n.default)(e);const _=e},478067:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(417226),W=t(737903),T=t(209175),D=t(123491),v=t(292681),M=t(737296),A=t(831121),U=t(52275),O=t(704621),L=t(981801),E=t(898039),I=t(975924),g=t(895615),m=t(288572),d=t(793317),a=t(42651),r=t(519405);const c=!1,s=function(e,o,h){this.init(e,o,h)};s.NAME="action.RemoveSingleNotePercu";const i=s.prototype;i.name=s.NAME,i.initMeasureData=d.default,i.init=function(e,o,h){(0,U.default)(e,o),(0,O.default)(e,o),(0,L.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.sanitized=!1,this.voice=null,this.location=null,(0,E.default)(this.measureData,this.opts)},i.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotChord(),this.checkNotRest(),this.checkNotLocked()},i.checkUnpitched=function(){(0,A.default)(this.measureData)},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.checkNotLocked=function(){const o=this.getVoice().getNote(this.opts.noteIdx);D.default.checkNotLocked(o)},i.checkNotChord=function(){if(this.getVoice().isChord(this.opts.noteIdx))throw new C.A},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},i.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const o=this.getVoice().getNote(this.opts.noteIdx),h=(0,W.default)(this.opts);new g.A(this.measureData,h,this.cancelStack).perform(),this.updateStack(o),this.opts.formatRests&&this.formatRests()},i.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=M.default.REPLACE),typeof this.opts.formatRests=="undefined"&&(this.opts.formatRests=c),this.sanitized=!0)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,insertMode:this.opts.insertMode}};this.cancelStack.storeAction(o)}},i.updateStack=function(e){const o=this.getLocation(),h=this.getDurationType(e),_=D.default.getUnpitched(e);let p=D.default.getTimeModif(e);p=T.default.copy(p);const f=D.default.getStaffIdx(e),P=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,f),u={type:this.name,noDraw:!0,opts:{partUuid:o.partUuid,measureUuid:o.measureUuid,voiceUuid:o.voiceUuid,staffUuid:P,timePos:o.timePos,divisions:o.dpq,durationType:h,nbDots:D.default.getNbDots(e),notehead:D.default.getHead(e),unpitched:v.default.copy(_),timeModif:p,insertMode:this.opts.insertMode}};this.cancelStack.push(u)},i.getDurationType=function(e){const o=this.measureData.getDivisionsPerQuarterValue();return(0,I.default)(e,o)},i.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),l=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:h,voiceUuid:_,dpq:p,timePos:l}}return this.location},i.formatRests=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).isRest(this.opts.noteIdx))return;const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},h=new m.default(this.measureData,o,this.cancelStack);(0,r.default)(h)},(0,a.default)(s);const n=s},485594:(j,x,t)=>{t.r(x),t.d(x,{default:()=>l});var C=t(153271),W=t(443749),T=t(857552),D=t(990937),v=t(748803),M=t(632879),A=t(569445),U=t(195446),O=t(31278),L=t(772162),E=t(346546),I=t(980845),g=t(52275),m=t(783177),d=t(407819),a=t(2110),r=t(519405),c=t(726042),s=t(701387),i=t(123491),n=t(377180),e=t(446921),o=t(42651);const h=function(P,u,R){this.init(P,u,R)};h.NAME="action.TransposeStaffRange";const _=h.prototype;_.name=h.NAME,_.init=function(P,u,R){(0,d.default)(P,u),(0,g.default)(P,u),(0,m.default)(P,u),this.measuresScroller=(0,a.A)(P,u),this.cancelStack=R,this.opts=u,this.location=null,this.wrappedActions=null},_.checkPreconditions=function(){if(this.checkLocation(),n.default.check(this.opts.transpose),this.sanitize(),n.default.isIdentity(this.opts.transpose))throw new O.default;this.checkActions()},_.checkLocation=function(){this.checkPitchedPart();const u=this.measuresScroller.getScoreData().getPartContent(this.opts.partIdx),R=e.A.getNbStaves(u),S=this.opts.staffIdx;if(!c.default.isInteger(S)||S<0||S>=R)throw new W.default(S);this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const K=this.opts.startMeasureIdx,B=this.opts.stopMeasureIdx,N=B-K;if(N<0)throw new T.default(T.default.MEASURE,K,B);this.hasNoteIndexes()&&(this.checkNoteIndexes(N),this.convertNoteIndexes()),this.checkTimePos(N)},_.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new U.default},_.checkMeasureIdx=function(P){const u=this.measuresScroller.getNbMeasures();if(!c.default.isInteger(P)||P<0||P>=u)throw new C.default(P,C.default.GET)},_.checkNoteIndexes=function(){const P=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);P.checkVoiceIdx(this.opts.startVoiceIdx),P.getVoice(this.opts.startVoiceIdx).checkNoteIdx(this.opts.startNoteIdx);const R=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);R.checkVoiceIdx(this.opts.stopVoiceIdx),R.getVoice(this.opts.stopVoiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},_.checkTimePos=function(P){const u=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(u,this.opts.startDpq,this.opts.startTimePos);const R=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(R,this.opts.stopDpq,this.opts.stopTimePos),P===0){const S=c.default.lcm(this.opts.startDpq,this.opts.stopDpq),K=this.opts.startTimePos*S/this.opts.startDpq,B=this.opts.stopTimePos*S/this.opts.stopDpq;if(K>B)throw new T.default(T.default.NOTE,K,B)}},_.checkStartTimePos=function(P,u,R){const S=P.getDpqValue(),K=P.getMeasure();let B=s.default.getNbDivisions(K);const N=c.default.lcm(S,u);if(B*=N/S,R*=N/u,!c.default.isInteger(R)||R<0||R>=B)throw new D.A(R,N)},_.checkStopTimePos=function(P,u,R){const S=P.getDpqValue(),K=P.getMeasure();let B=s.default.getNbDivisions(K);const N=c.default.lcm(S,u);if(B*=N/S,R*=N/u,!c.default.isInteger(R)||R<0||R>B)throw new D.A(R,N)},_.sanitize=function(){typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),typeof this.opts.updateKeys=="undefined"&&(this.opts.updateKeys=!1),typeof this.opts.preserveTies=="undefined"&&(this.opts.preserveTies=!1),typeof this.opts.updateGraces=="undefined"&&(this.opts.updateGraces=!1),typeof this.opts.updateHarmonies=="undefined"&&(this.opts.updateHarmonies=!1)},_.checkActions=function(){const P=this.getWrappedActions();if(!P.some(p)&&!this.shouldUpdateKeys())throw P[0].error};const p=function(P){try{P.action.checkPreconditions()}catch(u){if(f(u))return P.checked=!0,P.error=u,!1;throw u}return P.checked=!0,!0};_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this),this.shouldUpdateKeys()&&this.updateMeasuresKeys()},_.hasNoteIndexes=function(){return typeof this.opts.startNoteIdx!="undefined"||typeof this.opts.startVoiceIdx!="undefined"||typeof this.opts.stopNoteIdx!="undefined"||typeof this.opts.stopVoiceIdx!="undefined"},_.convertNoteIndexes=function(){const P=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.opts.startDpq=P.getDpqValue();const u=P.getVoice(this.opts.startVoiceIdx);this.opts.startTimePos=u.getRangeSpace(0,this.opts.startNoteIdx);const R=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);this.opts.stopDpq=R.getDpqValue();const S=R.getVoice(this.opts.stopVoiceIdx),K=S.getNote(this.opts.stopNoteIdx),B=i.default.getDuration(K);this.opts.stopTimePos=S.getRangeSpace(0,this.opts.stopNoteIdx)+B,delete this.opts.startVoiceIdx,delete this.opts.startNoteIdx,delete this.opts.stopVoiceIdx,delete this.opts.stopNoteIdx},_.storeAction=function(){if(!this.cancelStack.hasAction()){const P=this.getLocation(),u=P.measureUuids.slice(),R=n.default.copy(this.opts.transpose),S={actionName:this.name,opts:{partUuid:P.partUuid,measureUuids:u,staffIdx:this.opts.staffIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,updateKeys:this.opts.updateKeys,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,updateHarmonies:this.opts.updateHarmonies,transpose:R,preserveColor:!!this.opts.preserveColor}};this.cancelStack.storeAction(S)}},_.getLocation=function(){if(this.location===null){const P=this.measuresScroller.getScoreData(),u=P.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),R=P.getPartUuid(this.opts.partIdx);this.location={partUuid:R,measureUuids:u}}return this.location},_.getWrappedActions=function(){return this.wrappedActions===null&&this.createWrappedActions(),this.wrappedActions},_.createWrappedActions=function(){const P=this.getStaffVoicesIndexes();this.wrappedActions=P.map(this.createWrappedAction,this),this.shouldUpdateHarmonies()&&this.addUpdateHarmonies()},_.getStaffVoicesIndexes=function(){return this.measuresScroller.getScoreData().getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},_.createWrappedAction=function(P){const u=n.default.copy(this.opts.transpose),R={partIdx:this.opts.partIdx,voiceIdx:P,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,transpose:u,checkLine:this.opts.checkLine,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,preserveColor:this.opts.preserveColor},S=null;return{action:new L.default(this.measuresScroller,R,S),error:null,checked:!1}},_.callPerform=function(P){P.error===null&&(P.action.cancelStack=this.cancelStack,P.checked?P.action.perform():(0,r.default)(P.action,f))};const f=function(P){return P instanceof v.default||P instanceof M.A||P instanceof A.A||P instanceof T.default&&P.type===T.default.NOTE||P instanceof O.default};_.shouldUpdateKeys=function(){return this.opts.updateKeys&&!n.default.isUnison(this.opts.transpose)},_.updateMeasuresKeys=function(){let P=this.opts.startMeasureIdx,u=null,R=null;for(this.opts.startTimePos===0&&(u=P,R=P),P++;P<=this.opts.stopMeasureIdx;P++)u===null&&(u=P),R=P;if(u!==null){const S=n.default.copy(this.opts.transpose),K={partIdx:this.opts.partIdx,startMeasureIdx:u,stopMeasureIdx:R,staffIdx:this.opts.staffIdx,transpose:S},B=this.measuresScroller.getScoreData();new I.A(B,K,this.cancelStack).perform()}},_.shouldUpdateHarmonies=function(){return this.opts.updateHarmonies&&!n.default.isUnison(this.opts.transpose)},_.addUpdateHarmonies=function(){const P=n.default.copy(this.opts.transpose),u={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,transpose:P},R=this.measuresScroller.getScoreData(),K={action:new E.default(R,u,this.cancelStack),error:null,checked:!1};this.wrappedActions.push(K)},(0,o.default)(h);const l=h},490884:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(195446),W=t(748803),T=t(737903),D=t(351277),v=t(123491),M=t(19405),A=t(476031),U=t(52275),O=t(704621),L=t(981801),E=t(783177),I=t(898039),g=t(287296),m=t(762860),d=t(635018),a=t(793317),r=t(42651);const c=function(n,e,o){this.init(n,e,o)};c.NAME="action.RemoveGraceFromChord";const s=c.prototype;s.name=c.NAME,s.initMeasureData=a.default,s.init=function(n,e,o){(0,U.default)(n,e),(0,O.default)(n,e),(0,L.default)(n,e),(0,E.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,(0,I.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null},s.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const n=this.measureData.getVoice(this.opts.voiceIdx);n.checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),n.checkGraceChord(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.checkPitch(),this.checkPitchExist()},s.checkValues=function(){(0,M.default)(this.opts)},s.checkPitch=function(){D.default.check(this.opts.pitch)},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},s.checkPitchExist=function(){this.sanitizeIfNeeded();const n=this.measureData.getVoice(this.opts.voiceIdx),e=(0,m.A)(n,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch);if(typeof e=="undefined"){const o=D.default.copy(this.opts.pitch);throw new W.default(W.default.GET,o)}v.default.checkNotLocked(e)},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();const n=this.getNoteData();this.removeGraceFromChord(),this.updateStack(n)},s.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,A.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,g.default)(this.measureData,this.opts),this.sanitized=!0)},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={actionName:this.name,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,timePos:n.timePos,divisions:n.dpq,graceIdx:this.opts.graceIdx,pitch:D.default.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.storeAction(e)}},s.getNoteData=function(){const n=this.measureData.getVoice(this.opts.voiceIdx),e=(0,m.A)(n,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch),o=v.default.getStaffIdx(e),_=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,o),p=v.default.getPitch(e),f=D.default.getAlter(p),l=D.default.alterToAccidental(f),P={staffUuid:_,accidental:l};return v.default.hasFretData(e)&&(P.fretData=v.default.getFretData(e)),P},s.removeGraceFromChord=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:D.default.copy(this.opts.pitch)};new d.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(n){const e=this.getLocation(),o={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,staffUuid:n.staffUuid,graceIdx:this.opts.graceIdx,timePos:e.timePos,divisions:e.dpq,pitch:D.default.copyWithoutAlter(this.opts.pitch),accidental:n.accidental}};n.fretData&&(o.opts.fretData=(0,T.default)(n.fretData)),this.cancelStack.push(o)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f}}return this.location},(0,r.default)(c);const i=c},504005:(j,x,t)=>{t.r(x),t.d(x,{default:()=>R});var C=t(278243),W=t(748803),T=t(195446),D=t(702544),v=t(153271),M=t(883782),A=t(847051),U=t(807205),O=t(123491),L=t(351277),E=t(742735),I=t(708836),g=t(955832),m=t(805396),d=t(645166),a=t(691309),r=t(898039),c=t(325600),s=t(52275),i=t(704621),n=t(981801),e=t(287296),o=t(852363),h=t(519405),_=t(793317),p=t(313499),f=t(42651),l=t(737903);const P=function(S,K,B){this.init(S,K,B)};P.NAME="action.AddTieArc",P.isAuthorizedException=function(S){return S instanceof D.default||S instanceof v.default||S instanceof M.default||S instanceof A.A||S instanceof U.A||S instanceof C.A||S instanceof W.default||S instanceof T.default};const u=P.prototype;u.name=P.NAME,u.initMeasureData=_.default,u.lineToDestPitch=p.A,u.init=function(S,K,B){(0,s.default)(S,K),(0,i.default)(S,K),(0,n.default)(S,K),this.initMeasureData(S,K),this.cancelStack=B,this.opts=K,(0,r.default)(this.measureData,K),this.lineToDestPitch(),this.opts.isConcertPitch&&(this.opts.pitch=L.default.copy(this.opts),(0,e.default)(this.measureData,this.opts),this.opts.octave=L.default.getOctave(this.opts.pitch),this.opts.step=L.default.getStep(this.opts.pitch)),this.crossMeasure=new a.default(this.measureData,K.voiceIdx,K.noteIdx),this.location=null},u.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},u.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},u.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new C.A},u.isLeftRest=function(){return this.crossMeasure.isLeftRest()},u.isRightRest=function(){return this.crossMeasure.isRightRest()},u.checkPitch=function(){if(this.crossMeasure.hasRightGrace())throw new U.A(this.name,"right not cannot have graces notes attached.");let S;const K=this.getLeftChord(),B=this.getRightChord(),N=K.find(this.pitchPredicate,this);if(typeof N=="undefined")throw S={msgPrefix:"there is no left note"},new W.default(S,this.opts);const y=B.find(this.pitchPredicate,this);if(typeof y=="undefined")throw S={msgPrefix:"there is no right note"},new W.default(S,this.opts);const k=O.default.getPitch(N),V=O.default.getPitch(y);if(!L.default.isSamePitch(k,V))throw new U.A(this.name,"notes must have the same pitch");if(E.A.areNotesTied(N,y))throw new U.A(this.name,"notes are already tied")},u.pitchPredicate=function(S){const K=O.default.getPitch(S);return L.default.isSameLine(K,this.opts)},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeRightArpeggio(),this.removePreBend(),this.removeTremolo2IfNeeded();const S=this.getLeftChord(),K=this.getRightChord(),B=S.find(this.pitchPredicate,this),N=K.find(this.pitchPredicate,this),y=L.default.copy(O.default.getPitch(B));E.A.tieNotes(B,N),this.isLastOfMeasure()&&this.updateRightAccidental(N),this.updateStack(y)},u.storeAction=function(){if(!this.cancelStack.hasAction()){const S=this.getLocation(),K={actionName:this.name,opts:{partUuid:S.partUuid,measureUuid:S.measureUuid,divisions:S.dpq,timePos:S.timePos,voiceUuid:S.voiceUuid,octave:this.opts.octave,step:this.opts.step}};this.cancelStack.storeAction(K)}},u.removeRightArpeggio=function(){const S=this.crossMeasure.getRightMeasure(),K=S.getVoice(this.opts.voiceIdx),B=this.crossMeasure.getRightNoteIdx(),N=K.getNote(B);if(!O.default.hasArpeggiate(N))return;const y={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx()},k=new I.default(S,y,this.cancelStack);(0,h.default)(k)},u.removeTremolo2IfNeeded=function(){const[S]=this.crossMeasure.getLeftChord();if(O.default.hasTremoloStart(S)){const K={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()},B=this.crossMeasure.getRightMeasure(),N=new m.default(B,K,this.cancelStack);(0,h.default)(N)}},u.removePreBend=function(){const K=this.getRightChord().find(this.pitchPredicate,this);if(!O.default.hasFretData(K)||!O.default.hasPreBend(K)||!O.default.hasBend(K))return;const B=O.default.getFretData(K),N=O.default.getPitch(K),y={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),pitch:L.default.copy(N),fretData:(0,l.default)(B)},k=this.crossMeasure.getRightMeasure(),V=new g.default(k,y,this.cancelStack);(0,h.default)(V)},u.getLeftChord=function(){return this.crossMeasure.getLeftChord()},u.getRightChord=function(){return this.crossMeasure.getRightChord()},u.isLastOfMeasure=function(){const B=this.crossMeasure.getLeftMeasure().getVoice(this.opts.voiceIdx).getNbNotes();return this.opts.noteIdx===B-1},u.updateRightAccidental=function(S){let K=O.default.getPitch(S);const B=O.default.getStaffIdx(S),N=this.crossMeasure.getRightMeasure(),y=this.crossMeasure.getRightMeasureIdx(),k=this.crossMeasure.getRightNoteIdx();K=L.default.copy(K);const V={partIdx:this.opts.partIdx,measureIdx:y,voiceIdx:this.opts.voiceIdx,staffIdx:B,noteIdx:k,pitch:K};new d.A(N,V,this.cancelStack).perform()},u.updateStack=function(S){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const K=this.getLocation(),B={type:this.name,opts:{partUuid:K.partUuid,partIdx:this.opts.partIdx,measureUuid:K.measureUuid,measureIdx:this.opts.leftMeasureIdx,noteIdx:this.opts.leftNoteIdx,timePos:K.timePos,divisions:K.dpq,voiceUuid:K.voiceUuid,pitch:L.default.copy(S)}};this.cancelStack.push(B),(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const N={type:`${this.name}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:L.default.copy(S)}};this.cancelStack.push(N),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},u.getLocation=function(){if(this.location===null){const S=this.measureData.getScoreData(),K=S.getPartUuid(this.opts.partIdx),B=this.crossMeasure.getLeftMeasureIdx(),N=S.getMeasureUuid(B),y=S.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),k=this.crossMeasure.getLeftMeasure().getDpqValue(),V=this.crossMeasure.getLeftVoice(),G=this.crossMeasure.getLeftNoteIdx(),z=(0,c.A)(V,G);this.location={partUuid:K,measureUuid:N,voiceUuid:y,dpq:k,timePos:z}}return this.location},(0,f.default)(P);const R=P},516e3:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(781852),W=t(31278),T=t(465730),D=t(546835),v=t(307501),M=t(793317),A=t(52275),U=t(704621),O=t(981801),L=t(19850),E=t(766472),I=t(42651),g=t(209175),m=t(123491);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.AddLyric";const a=d.prototype;a.initMeasureData=M.default,a.name=d.NAME,a.init=function(c,s,i){(0,A.default)(c,s),(0,U.default)(c,s),(0,O.default)(c,s),this.initMeasureData(c,s),this.cancelStack=i,this.opts=s,(0,E.default)(s),(0,L.default)(this.measureData,s),this.location=null,this.sanitized=!1},a.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkLocation(),this.checkParam()},a.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},a.checkParam=function(){if(T.default.check(this.opts.level),!this.opts.isMelisma){if(typeof this.opts.lyric!="string")throw new C.default(this.opts.lyric);if(this.opts.lyric=this.opts.lyric.trim(),this.opts.lyric===""){const c="Cannot add lyric with empty text";throw new W.default(c)}}},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.opts.isMelisma?this.addMelisma():this.addLyric(),this.updateStack()},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.level=="undefined"&&(this.opts.level=0),typeof this.opts.hasRightConnection=="undefined"&&(this.opts.hasRightConnection=!1),this.sanitized=!0)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s=g.default.copy(c.timeModif),i={partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos,level:this.opts.level,timeModif:s};this.opts.isMelisma?i.isMelisma=!0:(i.lyric=this.opts.lyric,i.hasRightConnection=this.opts.hasRightConnection);const n={actionName:this.name,opts:i};this.cancelStack.storeAction(n)}},a.addLyric=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,lyric:this.opts.lyric,level:this.opts.level,hasRightConnection:this.opts.hasRightConnection};new D.default(this.measureData,c,this.cancelStack).perform()},a.addMelisma=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};new v.default(this.measureData,c,this.cancelStack).perform()},a.updateStack=function(){const c=this.getLocation(),s={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos,level:this.opts.level}};this.cancelStack.push(s)},a.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),s=c.getPartUuid(this.opts.partIdx),i=c.getMeasureUuid(this.opts.measureIdx),n=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getDpqValue(),o=this.measureData.getVoice(this.opts.voiceIdx),h=o.getRangeSpace(0,this.opts.noteIdx),_=o.getNote(this.opts.noteIdx);let p=m.default.getTimeModif(_);p=g.default.copy(p),this.location={partUuid:s,measureUuid:i,voiceUuid:n,dpq:e,timePos:h,timeModif:p}}return this.location},(0,I.default)(d);const r=d},540781:(j,x,t)=>{t.r(x),t.d(x,{default:()=>e});var C=t(195446),W=t(278243),T=t(748803),D=t(31278),v=t(476031),M=t(898039),A=t(52275),U=t(704621),O=t(981801),L=t(783177),E=t(287296),I=t(578918),g=t(327558),m=t(476943),d=t(123491),a=t(351277),r=t(793317),c=t(42651),s=t(353922);const i=function(o,h,_){this.init(o,h,_)};i.NAME="action.ChangePitchedHead",i.isNoChange=function(o){return o instanceof D.default};const n=i.prototype;n.name=i.NAME,n.initMeasureData=r.default,n.init=function(o,h,_){(0,A.default)(o,h),(0,U.default)(o,h),(0,O.default)(o,h),(0,L.default)(o,h),this.initMeasureData(o,h),this.cancelStack=_,this.opts=h,this.sanitized=!1,this.voice=null,this.location=null,(0,M.default)(this.measureData,this.opts)},n.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkPitch(),s.A.checkPitched(this.opts.notehead),this.checkUpdate()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},n.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},n.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},n.checkNotRest=function(){if(this.getVoice().isRest(this.opts.noteIdx))throw new W.A},n.checkPitch=function(){const o=this.getVoice();if(!(0,I.default)(o,this.opts.noteIdx,this.opts.pitch)){const _=a.default.copy(this.opts.pitch);throw new T.default(T.default.GET,_)}},n.getChord=function(){const h=this.getVoice().getChord(this.opts.noteIdx);return m.default.makeArray(h)},n.checkUpdate=function(){const o=this.getVoice(),h=(0,I.default)(o,this.opts.noteIdx,this.opts.pitch),_=d.default.getHead(h);if(this.opts.notehead===_)throw new D.default},n.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const o=this.getPreviousData();this.changePitchedHead(),this.updateStack(o)},n.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,v.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,E.default)(this.measureData,this.opts),this.sanitized=!0)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const o=this.getLocation(),h=a.default.copyWithoutAlter(this.opts.pitch),_={actionName:this.name,opts:{partUuid:o.partUuid,measureUuid:o.measureUuid,voiceUuid:o.voiceUuid,divisions:o.dpq,timePos:o.timePos,pitch:h,notehead:this.opts.notehead}};this.cancelStack.storeAction(_)}},n.changePitchedHead=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:a.default.copy(this.opts.pitch),notehead:this.opts.notehead};new g.A(this.measureData,o,this.cancelStack).perform()},n.getPreviousData=function(){const o=this.getVoice(),h=(0,I.default)(o,this.opts.noteIdx,this.opts.pitch);return{notehead:d.default.getHead(h)}},n.updateStack=function({notehead:o}){const h=this.getLocation(),_={type:this.name,noDraw:!0,opts:{partUuid:h.partUuid,measureUuid:h.measureUuid,voiceUuid:h.voiceUuid,timePos:h.timePos,divisions:h.dpq,pitch:a.default.copyWithoutAlter(this.opts.pitch),notehead:o}};this.cancelStack.push(_)},n.getLocation=function(){if(this.location===null){const o=this.measureData.getScoreData(),h=o.getPartUuid(this.opts.partIdx),_=o.getMeasureUuid(this.opts.measureIdx),p=o.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),f=this.measureData.getDpqValue(),P=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:h,measureUuid:_,voiceUuid:p,dpq:f,timePos:P}}return this.location},(0,c.default)(i);const e=i},547336:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(31278),W=t(247739),T=t(123491),D=t(292681),v=t(104907),M=t(17773),A=t(768498),U=t(2835),O=t(898039),L=t(52275),E=t(704621),I=t(981801),g=t(831121),m=t(793317),d=t(42651);const a=function(s,i,n){this.init(s,i,n)};a.NAME="action.RemoveGhostNotePercus",a.isNoChange=function(s){return s instanceof C.default};const r=a.prototype;r.name=a.NAME,r.initMeasureData=m.default,r.init=function(s,i,n){(0,L.default)(s,i),(0,E.default)(s,i),(0,I.default)(s,i),this.initMeasureData(s,i),this.cancelStack=n,this.opts=i,this.noteHead=null,this.voice=null,this.location=null},r.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,O.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkGhost()},r.checkUnpitchedPart=function(){(0,g.default)(this.measureData)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,U.default)(this.measureData,this.opts)},r.checkNoteAtUnpitched=function(){if(typeof this.getNoteAtUnpitched()=="undefined"){const i=D.default.copy(this.opts.unpitched),n=this.opts.staffIdx||0,e=this.measureData.getStaffDetails(n),o=v.default.getNbStaffLines(e);throw new W.A(W.A.GET,i,o)}},r.checkGhost=function(){const s=this.getNoteAtUnpitched();if(!T.default.hasHeadParentheses(s))throw new C.default},r.getNoteAtUnpitched=function(){if(this.noteHead===null){const s=this.getVoice();this.noteHead=(0,A.A)(s,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeGhostNotePercu(),this.updateStack()},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,unpitched:D.default.copy(this.opts.unpitched)},n={actionName:this.name,opts:i};this.cancelStack.storeAction(n)}},r.removeGhostNotePercu=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:D.default.copy(this.opts.unpitched)};new M.A(this.measureData,s,this.cancelStack).perform()},r.updateStack=function(){const s=this.getLocation(),i={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,unpitched:D.default.copy(this.opts.unpitched)},n={type:this.name,noDraw:!0,opts:i};this.cancelStack.push(n)},r.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),i=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),e=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),_=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:i,measureUuid:n,voiceUuid:e,dpq:o,timePos:_,isConcertPitch:!1}}return this.location},r.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,d.default)(a);const c=a},570986:(j,x,t)=>{t.r(x),t.d(x,{default:()=>O});var C=t(195446),W=t(417226),T=t(737296),D=t(675531),v=t(793317),M=t(42651);const A=function(L,E,I){this.init(L,E,I)};A.NAME="action.RemoveSingleNote";const U=A.prototype;U.name=A.NAME,U.initMeasureData=v.default,U.init=function(L,E,I){this.initMeasureData(L,E),this.cancelStack=I,this.opts=E,this.sanitized=!1,this.voice=null},U.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotChord(),this.checkNotRest()},U.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},U.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},U.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},U.checkNotChord=function(){if(this.getVoice().isChord(this.opts.noteIdx))throw new W.A},U.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},U.perform=function(){this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name);const L={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,keepFormer:this.opts.keepFormer};new D.A(this.measureData,L,this.cancelStack).perform()},U.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.insertMode=="undefined"&&(this.opts.insertMode=T.default.REPLACE),this.sanitized=!0)},(0,M.default)(A);const O=A},605268:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(145638),W=t(443749),T=t(646456),D=t(701387),v=t(952818),M=t(726042),A=t(446921),U=t(52275),O=t(704621),L=t(783177),E=t(316610),I=t(363297),g=t(162621),m=t(887076),d=t(42651),a=t(584416);const r=function(e,o,h){this.init(e,o,h)};r.NAME="action.RemovePedalAtTimePos";const c=r.prototype;c.name=r.NAME,c.init=function(e,o,h){(0,U.default)(e,o),(0,O.default)(e,o),(0,L.default)(e,o),this.scoreData=e,this.cancelStack=h,this.opts=o,this.localTimePos=null,this.measureData=null,this.location=null},c.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},c.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const e=this.getMeasure(),o=D.default.getNbStaves(e),h=this.opts.staffIdx;if(!M.default.isInteger(h)||h<0||h>=o)throw new W.default(h)},c.checkTimePos=function(){const e=this.getLocalTimePos(),o=this.getMeasure(),h=D.default.getNbDivisions(o);if(!M.default.isNumber(e)||e<0||e>=h){const _=D.default.getDpq(o);throw new T.A(e,_)}},c.checkExistence=function(){if(!this.hasPedal())throw new C.A},c.hasPedal=function(){const e=this.getLocalTimePos(),o=this.getMeasure(),h=D.default.getPedals(o,this.opts.staffIdx),_=this.extractLeftPedal(o);return!!((0,g.A)(_,h,e)!==null||s(h,e))},c.extractLeftPedal=function(e){return D.default.hasLeftPedal(e,this.opts.staffIdx)?D.default.getLeftPedal(e,this.opts.staffIdx):null},c.searchPedal=function(e){const o=this;return v.A.getPosTime(e)===o};const s=function(e,o){return e.some(i,o)},i=function(e){const o=this.valueOf();return a.A.getTimePos(e)===o&&a.A.isStop(e)};c.getLocalTimePos=function(){if(this.localTimePos===null){const e=this.getMeasure();this.localTimePos=(0,E.A)(this.opts,e)}return this.localTimePos},c.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.removePedal(),this.updateStack(e)},c.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,staffUuid:e.staffUuid}};this.cancelStack.storeAction(o)}},c.getPreviousData=function(){const e=this.getLocalTimePos(),o=this.scoreData.getPartContent(this.opts.partIdx),h=A.A.getMeasures(o),_=(0,I.A)(h,this.opts.measureIdx,this.opts.staffIdx,e),p=this.scoreData.getMeasureUuid(_.startMeasureIdx),f=this.scoreData.getMeasureUuid(_.stopMeasureIdx),l=this.scoreData.getMeasure(this.opts.partIdx,_.startMeasureIdx),P=D.default.getDpq(l),u=this.scoreData.getMeasure(this.opts.partIdx,_.stopMeasureIdx),R=D.default.getDpq(u);return{startMeasureUuid:p,startTimePos:_.startTimePos,stopTimePos:_.stopTimePos,startDpq:P,stopMeasureUuid:f,stopDpq:R,placement:_.placement}},c.removePedal=function(){const e=this.getLocalTimePos(),o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e};new m.A(this.scoreData,o,this.cancelStack).perform()},c.updateStack=function(e){const o=this.getLocation(),h={type:this.name,noDraw:!0,opts:{partUuid:o.partUuid,startMeasureUuid:e.startMeasureUuid,startTimePos:e.startTimePos,startDpq:e.startDpq,stopMeasureUuid:e.stopMeasureUuid,stopTimePos:e.stopTimePos,stopDpq:e.stopDpq,staffUuid:o.staffUuid,placement:e.placement}};this.cancelStack.push(h)},c.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx),h=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:e,staffUuid:h,measureUuid:o}}return this.location},(0,d.default)(r);const n=r},618496:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(702544),W=t(153271),T=t(443749),D=t(646456),v=t(31278),M=t(701387),A=t(726042),U=t(788220),O=t(701043),L=t(316610),E=t(52275),I=t(704621),g=t(783177),m=t(42651);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemoveWordAtTimePos",d.isAuthorizedException=function(c){return c instanceof C.default||c instanceof W.default||c instanceof T.default||c instanceof D.A||c instanceof v.default};const a=d.prototype;a.name=d.NAME,a.init=function(c,s,i){(0,E.default)(c,s),(0,I.default)(c,s),(0,g.default)(c,s),this.scoreData=c,this.cancelStack=i,this.opts=s,this.measure=null,this.words=null,this.location=null,this.wordIdx=null,this.localTimePos=null},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let c=!0;try{this.checkPreconditions()}catch(s){if(d.isAuthorizedException(s))c=!1;else throw s}return c},a.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const c=this.getMeasure(),s=M.default.getNbStaves(c),i=this.opts.staffIdx;if(!A.default.isNumber(i)||i<0||i>=s)throw new T.default(i)},a.checkTimePos=function(){const c=this.getLocalTimePos(),s=this.getMeasure(),i=M.default.getNbDivisions(s);if(!A.default.isNumber(c)||c<0||c>i){const n=M.default.getDpq(s);throw new D.A(c,n)}},a.checkExistence=function(){this.fetchWordIdx()},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getPreviousData();this.removeWord(),this.updateStack(c)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,staffUuid:c.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(s)}},a.getPreviousData=function(){const c=this.getWord(),s=U.A.getStaffIdx(c),i=U.A.getPlacement(c),n=U.A.getTimePos(c),e=U.A.getText(c),o=this.getMeasure(),h=M.default.getDpq(o);return{staffIdx:s,placement:i,timePos:n,dpq:h,text:e}},a.getWord=function(){const c=this.getWords(),s=this.getWordIdx();return c[s]},a.removeWord=function(){const c=this.getWordIdx(),s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,wordIdx:c};new O.A(this.scoreData,s,this.cancelStack).perform()},a.getWordIdx=function(){return this.wordIdx===null&&this.fetchWordIdx(),this.wordIdx},a.fetchWordIdx=function(){if(this.wordIdx=null,this.getWords().some(this.checkWordTimePos,this),this.wordIdx===null)throw new v.default},a.getWords=function(){if(this.words===null){const c=this.getMeasure();this.words=M.default.getWords(c,this.opts.staffIdx)}return this.words},a.checkWordTimePos=function(c,s){const i=this.getLocalTimePos(),n=U.A.getTimePos(c);return n<i?!1:(n===i&&(this.wordIdx=s),!0)},a.getLocalTimePos=function(){if(this.localTimePos===null){const c=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,c)}return this.localTimePos},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},a.updateStack=function(c){const s=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,staffUuid:s.staffUuid,placement:c.placement,timePos:c.timePos,dpq:c.dpq,text:c.text}};this.cancelStack.push(i)},a.getLocation=function(){if(this.location===null){const c=this.scoreData.getPartUuid(this.opts.partIdx),s=this.scoreData.getMeasureUuid(this.opts.measureIdx),i=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:c,measureUuid:s,staffUuid:i}}return this.location},(0,m.default)(d);const r=d},643569:(j,x,t)=>{t.r(x),t.d(x,{default:()=>I});var C=t(31278),W=t(123491),T=t(677772),D=t(898039),v=t(52275),M=t(704621),A=t(981801),U=t(793317),O=t(42651);const L=function(g,m,d){this.init(g,m,d)};L.NAME="action.RemoveGraceSlash",L.isNoChange=function(g){return g instanceof C.default};const E=L.prototype;E.name=L.NAME,E.initMeasureData=U.default,E.init=function(g,m,d){(0,v.default)(g,m),(0,M.default)(g,m),(0,A.default)(g,m),this.initMeasureData(g,m),this.cancelStack=d,this.opts=m,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null},E.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,D.default)(this.measureData,this.opts),this.checkGraceIdx(),this.checkSlash()},E.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},E.checkSlash=function(){const m=this.getVoice().getGrace(this.opts.noteIdx,this.opts.graceIdx);if(!W.default.isSlashedGrace(m))throw new C.default},E.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},E.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeGraceSlash(),this.updateStack()},E.storeAction=function(){if(!this.cancelStack.hasAction()){const g=this.getLocation(),m={actionName:this.name,opts:{partUuid:g.partUuid,measureUuid:g.measureUuid,voiceUuid:g.voiceUuid,divisions:g.dpq,timePos:g.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.storeAction(m)}},E.removeGraceSlash=function(){const g={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new T.A(this.measureData,g,this.cancelStack).perform()},E.updateStack=function(){const g=this.getLocation(),m={type:this.name,noDraw:!0,opts:{partUuid:g.partUuid,measureUuid:g.measureUuid,voiceUuid:g.voiceUuid,divisions:g.dpq,timePos:g.timePos,graceIdx:this.opts.graceIdx}};this.cancelStack.push(m)},E.getLocation=function(){if(this.location===null){const g=this.measureData.getScoreData(),m=g.getPartUuid(this.opts.partIdx),d=g.getMeasureUuid(this.opts.measureIdx),a=g.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),r=this.measureData.getDpqValue(),s=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:m,measureUuid:d,voiceUuid:a,dpq:r,timePos:s}}return this.location},(0,O.default)(L);const I=L},656529:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(702544),W=t(153271),T=t(443749),D=t(646456),v=t(31278),M=t(701387),A=t(726042),U=t(447819),O=t(908576),L=t(316610),E=t(52275),I=t(704621),g=t(783177),m=t(42651);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemoveMuteAtTimePos",d.isAuthorizedException=function(c){return c instanceof C.default||c instanceof W.default||c instanceof T.default||c instanceof D.A||c instanceof v.default};const a=d.prototype;a.name=d.NAME,a.init=function(c,s,i){(0,E.default)(c,s),(0,I.default)(c,s),(0,g.default)(c,s),this.scoreData=c,this.cancelStack=i,this.opts=s,this.measure=null,this.mutes=null,this.location=null,this.muteIdx=null,this.localTimePos=null},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let c=!0;try{this.checkPreconditions()}catch(s){if(d.isAuthorizedException(s))c=!1;else throw s}return c},a.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const c=this.getMeasure(),s=M.default.getNbStaves(c),i=this.opts.staffIdx;if(!A.default.isNumber(i)||i<0||i>=s)throw new T.default(i)},a.checkTimePos=function(){const c=this.getLocalTimePos(),s=this.getMeasure(),i=M.default.getNbDivisions(s);if(!A.default.isNumber(c)||c<0||c>i){const n=M.default.getDpq(s);throw new D.A(c,n)}},a.checkExistence=function(){this.fetchMuteIdx()},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getPreviousData();this.removeMute(),this.updateStack(c)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,staffUuid:c.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(s)}},a.getPreviousData=function(){const c=this.getMute(),s=U.A.getStaffIdx(c),i=U.A.getPlacement(c),n=U.A.getTimePos(c),e=U.A.getType(c),o=this.getMeasure(),h=M.default.getDpq(o);return{staffIdx:s,placement:i,timePos:n,dpq:h,type:e}},a.getMute=function(){const c=this.getMutes(),s=this.getMuteIdx();return c[s]},a.removeMute=function(){const c=this.getMuteIdx(),s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,muteIdx:c};new O.A(this.scoreData,s,this.cancelStack).perform()},a.getMuteIdx=function(){return this.muteIdx===null&&this.fetchMuteIdx(),this.muteIdx},a.fetchMuteIdx=function(){if(this.muteIdx=null,this.getMutes().some(this.checkMuteTimePos,this),this.muteIdx===null)throw new v.default},a.getMutes=function(){if(this.mutes===null){const c=this.getMeasure();this.mutes=M.default.getMutes(c,this.opts.staffIdx)}return this.mutes},a.checkMuteTimePos=function(c,s){const i=this.getLocalTimePos(),n=U.A.getTimePos(c);return n<i?!1:(n===i&&(this.muteIdx=s),!0)},a.getLocalTimePos=function(){if(this.localTimePos===null){const c=this.getMeasure();this.localTimePos=(0,L.A)(this.opts,c)}return this.localTimePos},a.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},a.updateStack=function(c){const s=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,staffUuid:s.staffUuid,placement:c.placement,timePos:c.timePos,dpq:c.dpq,type:c.type}};this.cancelStack.push(i)},a.getLocation=function(){if(this.location===null){const c=this.scoreData.getPartUuid(this.opts.partIdx),s=this.scoreData.getMeasureUuid(this.opts.measureIdx),i=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:c,measureUuid:s,staffUuid:i}}return this.location},(0,m.default)(d);const r=d},674212:(j,x,t)=>{t.r(x),t.d(x,{default:()=>h});var C=t(195446),W=t(748803),T=t(737903),D=t(351277),v=t(614426),M=t(19405),A=t(8963),U=t(172788),O=t(476031),L=t(33674),E=t(573559),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(898039),r=t(714898),c=t(762860),s=t(267529),i=t(793317),n=t(42651);const e=function(_,p,f){this.init(_,p,f)};e.NAME="action.AddGraceToChord";const o=e.prototype;o.name=e.NAME,o.initMeasureData=i.default,o.init=function(_,p,f){(0,I.default)(_,p),(0,g.default)(_,p),(0,m.default)(_,p),(0,d.default)(_,p),this.initMeasureData(_,p),this.cancelStack=f,this.opts=p,(0,a.default)(this.measureData,this.opts),this.sanitized=!1,this.location=null},o.checkPreconditions=function(){this.checkValues(),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkCompatibleVoiceStaffIdx(),this.measureData.getVoice(this.opts.voiceIdx).checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx),this.sanitizeIfNeeded(),this.checkPitch(),this.opts.checkLine&&(0,E.A)(this.measureData,this.opts),this.checkPitchCollision(),(0,A.A)(this.measureData,this.opts)},o.checkValues=function(){(0,M.default)(this.opts),this.opts.accidental!==null&&v.default.check(this.opts.accidental)},o.checkPitch=function(){D.default.check(this.opts.pitch)},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},o.checkCompatibleVoiceStaffIdx=function(){(0,L.default)(this.measureData,this.opts)},o.checkPitchCollision=function(){const _=this.measureData.getVoice(this.opts.voiceIdx);if(typeof(0,c.A)(_,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)!="undefined"){const f=D.default.copy(this.opts.pitch);throw new W.default(W.default.INSERT,f)}},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.addGraceToChord(),this.updateStack()},o.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,r.default)(this.measureData,this.opts),(0,U.A)(this.measureData,this.opts),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const _=this.getLocation(),p={actionName:this.name,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,staffUuid:_.staffUuid,graceIdx:this.opts.graceIdx,timePos:_.timePos,divisions:_.dpq,pitch:D.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental,checkLine:this.opts.checkLine,sameStringAsPreviousNotes:!!this.opts.sameStringAsPreviousNotes}};typeof this.opts.fretData!="undefined"&&(p.opts.fretData=(0,T.default)(this.opts.fretData)),this.cancelStack.storeAction(p)}},o.addGraceToChord=function(){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:D.default.copy(this.opts.pitch),fretData:this.opts.fretData,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new s.A(this.measureData,_,this.cancelStack).perform()},o.updateStack=function(){const _=this.getLocation(),p={type:this.name,noDraw:!0,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,timePos:_.timePos,divisions:_.dpq,graceIdx:this.opts.graceIdx,pitch:D.default.copyWithoutAlter(this.opts.pitch)}};this.cancelStack.push(p)},o.getLocation=function(){if(this.location===null){const _=this.measureData.getScoreData(),p=_.getPartUuid(this.opts.partIdx),f=_.getMeasureUuid(this.opts.measureIdx),l=_.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),P=_.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),u=this.measureData.getDpqValue(),S=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:p,measureUuid:f,voiceUuid:l,staffUuid:P,dpq:u,timePos:S}}return this.location},(0,n.default)(e);const h=e},679725:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(378432),W=t(195446),T=t(748803),D=t(632879),v=t(123491),M=t(351277),A=t(377180),U=t(287179),O=t(953952),L=t(578918),E=t(793317),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(287296),r=t(476031),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.TransposeNoteHead";const i=s.prototype;i.name=s.NAME,i.initMeasureData=E.default,i.init=function(e,o,h){(0,I.default)(e,o),(0,g.default)(e,o),(0,m.default)(e,o),(0,d.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.sanitized=!1,this.noteHead=null,this.voice=null,this.action=null},i.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkNoteIdx(),this.checkNotRest(),A.default.check(this.opts.transpose),this.sanitizeIfNeeded(),M.default.check(this.opts.pitch),this.checkNoteAtPitch(),this.getAction().checkPreconditions()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const o=M.default.copy(this.opts.pitch);throw new T.default(T.default.GET,o)}},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded();const e=this.getAction();e.cancelStack=this.cancelStack,e.perform()},i.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,r.default)(this.measureData,this.opts,!0),typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.opts.isConcertPitch&&((0,a.default)(this.measureData,this.opts),M.default.check(this.opts.pitch)),this.sanitized=!0)},i.getNoteAtPitch=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,L.default)(e,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},i.getAction=function(){if(this.action===null){const e=this.getNoteAtPitch(),o=v.default.getPitch(e),h=v.default.getStaffIdx(e);let _;try{_=M.default.transpose(o,this.opts.transpose,!0)}catch(u){if(u instanceof C.A){const R=M.default.copy(o),S=A.default.copy(this.opts.transpose);throw new D.A(R,S)}else throw u}const p=M.default.getAlter(_),f=M.default.alterToAccidental(p),l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},P=null;M.default.isSameLine(o,_)?(l.pitch=M.default.copyWithoutAlter(o),l.accidental=f,this.action=new U.default(this.measureData,l,P)):(l.fromPitch=M.default.copyWithoutAlter(o),l.toPitch=M.default.copyWithoutAlter(_),l.accidental=f,l.checkLine=this.opts.checkLine,l.staffIdx=h,l.preserveColor=this.opts.preserveColor,this.action=new O.default(this.measureData,l,P))}return this.action},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},680023:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(860716),A=t(212258),U=t(578918),O=t(19405),L=t(476031),E=t(898039),I=t(52275),g=t(704621),m=t(981801),d=t(783177),a=t(287296),r=t(793317),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.RemoveHarmonic",s.isNoChange=function(e){return e instanceof C.default};const i=s.prototype;i.name=s.NAME,i.initMeasureData=r.default,i.init=function(e,o,h){(0,I.default)(e,o),(0,g.default)(e,o),(0,m.default)(e,o),(0,d.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.noteHead=null,this.voice=null,this.location=null},i.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,E.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkHarmonic()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkValues=function(){(0,O.default)(this.opts)},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,L.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,a.default)(this.measureData,this.opts)},i.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const o=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,o)}},i.checkHarmonic=function(){const e=this.getNoteAtPitch();if(!D.default.hasHarmonic(e))throw new C.default},i.getNoteAtPitch=function(){if(this.noteHead===null){const e=this.getVoice();this.noteHead=(0,U.default)(e,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.removeHarmonic(),this.updateStack(e)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},h={actionName:this.name,opts:o};this.cancelStack.storeAction(h)}},i.getPreviousData=function(){const e=this.getNoteAtPitch(),o=D.default.getHarmonic(e);return{type:M.default.getType(o)}},i.removeHarmonic=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)};new A.A(this.measureData,e,this.cancelStack).perform()},i.updateStack=function({type:e}){const o=this.getLocation(),h={partUuid:o.partUuid,measureUuid:o.measureUuid,voiceUuid:o.voiceUuid,divisions:o.dpq,timePos:o.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),type:e},_={type:this.name,noDraw:!0,opts:h};this.cancelStack.push(_)},i.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),l=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:h,voiceUuid:_,dpq:p,timePos:l,isConcertPitch:!1}}return this.location},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},682756:(j,x,t)=>{t.r(x),t.d(x,{default:()=>L});var C=t(807205),W=t(99923),T=t(737903),D=t(846541),v=t(793317),M=t(922679),A=t(42651);const U=function(E,I,g){this.init(E,I,g)};U.isAuthorizedException=function(E){return D.default.isAuthorizedException(E)},U.NAME="action.UntieNotePercu";const O=U.prototype;O.performIfPossible=function(){this.isPossible()&&this.perform()},O.isPossible=function(){let E=!0;try{this.checkPreconditions()}catch(I){if(U.isAuthorizedException(I))E=!1;else throw I}return E},O.name=U.NAME,O.initMeasureData=v.default,O.getVoice=M.A,O.init=function(E,I,g){this.initMeasureData(E,I),this.cancelStack=g,this.opts=I,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},O.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const E=this.getVoice();E.checkNoteIdx(this.opts.noteIdx),E.checkNotRest(this.opts.noteIdx),this.checkCanUntie()},O.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new W.A},O.checkCanUntie=function(){const E=this.canUntieLeft(),I=this.canUntieRight();if(!E&&!I)throw new C.A("There is nothing to untie")},O.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){const E=this.getLeftAction();E.cancelStack=this.cancelStack,E.perform()}if(this.canUntieRight()){const E=this.getRightAction();E.cancelStack=this.cancelStack,E.perform()}},O.canUntieRight=function(){if(this.untieRight===null){const E=this.getRightAction();try{E.checkPreconditions(),this.untieRight=!0}catch(I){if(D.default.isAuthorizedException(I))this.untieRight=!1;else throw I}}return this.untieRight},O.getRightAction=function(){if(this.rightAction===null){const E=(0,T.default)(this.opts);this.rightAction=new D.default(this.measureData,E,this.cancelStack)}return this.rightAction},O.canUntieLeft=function(){if(this.untieLeft===null){const E=this.getLeftAction();try{E.checkPreconditions(),this.untieLeft=!0}catch(I){if(D.default.isAuthorizedException(I))this.untieLeft=!1;else throw I}}return this.untieLeft},O.getLeftAction=function(){if(this.leftAction===null){const E=(0,T.default)(this.opts);E.noteIdx--,this.leftAction=new D.default(this.measureData,E,this.cancelStack)}return this.leftAction},(0,A.default)(U);const L=U},691120:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(41261),A=t(578918),U=t(19405),O=t(476031),L=t(898039),E=t(52275),I=t(704621),g=t(981801),m=t(783177),d=t(287296),a=t(793317),r=t(42651);const c=function(n,e,o){this.init(n,e,o)};c.NAME="action.RemoveCourtesyAccidentals",c.isNoChange=function(n){return n instanceof C.default};const s=c.prototype;s.name=c.NAME,s.initMeasureData=a.default,s.init=function(n,e,o){(0,E.default)(n,e),(0,I.default)(n,e),(0,g.default)(n,e),(0,m.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkCourtesy()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},s.checkValues=function(){(0,U.default)(this.opts)},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts)},s.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const e=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,e)}},s.checkCourtesy=function(){const n=this.getNoteAtPitch();if(!D.default.hasCourtesyAccidental(n))throw new C.default},s.getNoteAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,A.default)(n,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeCourtesyAccidental(),this.updateStack()},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},o={actionName:this.name,opts:e};this.cancelStack.storeAction(o)}},s.removeCourtesyAccidental=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)};new M.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch)},o={type:this.name,noDraw:!0,opts:e};this.cancelStack.push(o)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f,isConcertPitch:!1}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(c);const i=c},703447:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(195446),W=t(443749),T=t(646456),D=t(411146),v=t(31278),M=t(701387),A=t(721247),U=t(726042),O=t(52275),L=t(704621),E=t(783177),I=t(316610),g=t(668341),m=t(42651);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemoveMiddleMeasureClefAtTimePos";const a=d.prototype;a.name=d.NAME,a.init=function(c,s,i){(0,O.default)(c,s),(0,L.default)(c,s),(0,E.default)(c,s),this.scoreData=c,this.cancelStack=i,this.opts=s,this.localTimePos=null,this.clefIdx=null,this.location=null},a.checkPreconditions=function(){this.checkLocation(),this.checkPitchedPart(),this.checkTimePos(),this.checkExistence()},a.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const c=this.getMeasure(),s=M.default.getNbStaves(c);if(this.opts.staffIdx<0||this.opts.staffIdx>=s)throw new W.default(this.opts.staffIdx)},a.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new C.default},a.checkTimePos=function(){const c=this.getLocalTimePos(),s=this.getMeasure(),i=M.default.getNbDivisions(s);if(!U.default.isNumber(c)||c<0||c>=i){const n=M.default.getDpq(s);throw new T.A(c,n)}if(this.opts.timePos===0)throw new D.A(D.A.MEASURE)},a.getLocalTimePos=function(){if(this.localTimePos===null){const c=this.getMeasure();this.localTimePos=(0,I.A)(this.opts,c)}return this.localTimePos},a.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},a.checkExistence=function(){this.fetchClefIdx()},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getPreviousData();this.removeClef(),this.updateStack(c)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,staffUuid:c.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(s)}},a.getPreviousData=function(){const c=this.getMeasure(),s=M.default.getMiddleClefs(c,this.opts.staffIdx),i=this.getClefIdx(),n=s[i];return{clef:A.default.copy(n)}},a.removeClef=function(){const c=this.getClefIdx(),s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,clefIdx:c};new g.A(this.scoreData,s,this.cancelStack).perform()},a.getClefIdx=function(){return this.clefIdx===null&&this.fetchClefIdx(),this.clefIdx},a.fetchClefIdx=function(){this.clefIdx=null;const c=this.getMeasure();if(M.default.getMiddleClefs(c,this.opts.staffIdx).some(this.checkClefTimePos,this),this.clefIdx===null){const i=this.getLocalTimePos(),n=M.default.getDpq(c);throw new v.default(i,n)}},a.checkClefTimePos=function(c,s){const i=this.getLocalTimePos(),n=A.default.getTimePos(c);return n<i?!1:(n===i&&(this.clefIdx=s),!0)},a.updateStack=function(c){const s=A.default.copy(c.clef),i=this.getLocation(),n={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuid:i.measureUuid,staffUuid:i.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,clef:s}};this.cancelStack.push(n)},a.getLocation=function(){if(this.location===null){const c=this.scoreData.getPartUuid(this.opts.partIdx),s=this.scoreData.getMeasureUuid(this.opts.measureIdx),i=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:c,measureUuid:s,staffUuid:i}}return this.location},(0,m.default)(d);const r=d},708377:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(247739),W=t(615428),T=t(831121),D=t(2835),v=t(52275),M=t(704621),A=t(981801),U=t(898039),O=t(750103),L=t(737903),E=t(476943),I=t(123491),g=t(292681),m=t(104907),d=t(793317),a=t(42651);const r=function(n,e,o){this.init(n,e,o)};r.NAME="action.RemoveFromChordPercu";const c=r.prototype;c.name=r.NAME,c.initMeasureData=d.default,c.init=function(n,e,o){(0,v.default)(n,e),(0,M.default)(n,e),(0,A.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,this.sanitized=!1,this.voice=null,this.location=null,(0,U.default)(this.measureData,this.opts)},c.checkPreconditions=function(){this.checkUnpitched(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.sanitizeIfNeeded(),this.checkNoteIdx(),this.checkNotRest(),this.checkSingleNote(),this.checkPitch()},c.checkUnpitched=function(){(0,T.default)(this.measureData)},c.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},c.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},c.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},c.checkPitch=function(){this.sanitizeIfNeeded();const n=this.getChord(),e=n.findIndex(s,this.opts.unpitched);if(e===-1){const h=g.default.copy(this.opts.unpitched),_=this.opts.staffIdx||0,p=this.measureData.getStaffDetails(_),f=m.default.getNbStaffLines(p);throw new C.A(C.A.GET,h,f)}const o=n[e];I.default.checkNotLocked(o)};const s=function(n){const e=I.default.getUnpitched(n),o=this;return g.default.isSameLine(e,o)};c.getChord=function(){const e=this.getVoice().getChord(this.opts.noteIdx);return E.default.makeArray(e)},c.checkSingleNote=function(){if(!this.getVoice().isChord(this.opts.noteIdx))throw new W.A},c.perform=function(){const o=this.getVoice().getChord(this.opts.noteIdx).find(s,this.opts.unpitched);this.sanitizeIfNeeded(),this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeFromChord(),this.updateStack(o)},c.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,D.default)(this.measureData,this.opts),this.sanitized=!0)},c.removeFromChord=function(){const n=(0,L.default)(this.opts);new O.A(this.measureData,n,this.cancelStack).perform()},c.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e=g.default.copy(this.opts.unpitched),o={actionName:this.name,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,unpitched:e}};this.cancelStack.storeAction(o)}},c.updateStack=function(n){const e=this.getLocation(),o=I.default.getUnpitched(n),h=I.default.getHead(n),_=I.default.getStaffIdx(n),f=this.measureData.getScoreData().getPartStaffUuid(this.opts.partIdx,_),l={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,staffUuid:f,timePos:e.timePos,divisions:e.dpq,unpitched:g.default.copy(o),notehead:h}};this.cancelStack.push(l)},c.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f}}return this.location},(0,a.default)(r);const i=r},708836:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(31278),W=t(195446),T=t(702544),D=t(153271),v=t(847051),M=t(883782),A=t(123491),U=t(898039),O=t(52275),L=t(704621),E=t(981801),I=t(793317),g=t(639673),m=t(42651);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.RemoveArpeggio",d.isAuthorizedException=function(c){return c instanceof T.default||c instanceof D.default||c instanceof M.default||c instanceof v.A||c instanceof C.default||c instanceof W.default},d.isNoChange=function(c){return c instanceof C.default};const a=d.prototype;a.initMeasureData=I.default,a.name=d.NAME,a.init=function(c,s,i){(0,O.default)(c,s),(0,L.default)(c,s),(0,E.default)(c,s),this.initMeasureData(c,s),this.cancelStack=i,this.opts=s,(0,U.default)(this.measureData,this.opts),this.location=null},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let c=!0;try{this.checkPreconditions()}catch(s){if(d.isAuthorizedException(s))c=!1;else throw s}return c},a.checkPreconditions=function(){this.checkPitchedPart(),this.checkLocation(),this.checkUsage()},a.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},a.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},a.checkUsage=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!A.default.hasArpeggiate(s)){const i="There is no arpeggio at this location.";throw new C.default(i)}},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),typeof this.opts.record=="undefined"&&(this.opts.record=!0),this.storeAction(),this.removeArpeggio(),this.updateStack()},a.removeArpeggio=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new g.A(this.measureData,c,this.cancelStack).perform()},a.updateStack=function(){const c=this.getLocation(),s={type:this.name,noDraw:!0,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos}};this.cancelStack.push(s)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),s={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,voiceUuid:c.voiceUuid,divisions:c.dpq,timePos:c.timePos}};this.cancelStack.storeAction(s)}},a.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),s=c.getPartUuid(this.opts.partIdx),i=c.getMeasureUuid(this.opts.measureIdx),n=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getDpqValue(),h=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:s,measureUuid:i,voiceUuid:n,dpq:e,timePos:h}}return this.location},a.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,m.default)(d);const r=d},714015:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(583904),A=t(578918),U=t(19405),O=t(476031),L=t(898039),E=t(52275),I=t(704621),g=t(981801),m=t(783177),d=t(287296),a=t(793317),r=t(42651);const c=function(n,e,o){this.init(n,e,o)};c.NAME="action.RemoveGhostNotes",c.isNoChange=function(n){return n instanceof C.default};const s=c.prototype;s.name=c.NAME,s.initMeasureData=a.default,s.init=function(n,e,o){(0,E.default)(n,e),(0,I.default)(n,e),(0,g.default)(n,e),(0,m.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,this.sanitized=!1,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkGhost()},s.checkValues=function(){(0,U.default)(this.opts)},s.checkPitch=function(){v.default.check(this.opts.pitch)},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const e=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,e)}},s.checkGhost=function(){const n=this.getNoteAtPitch();if(!D.default.hasHeadParentheses(n))throw new C.default},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,L.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.removeGhostNote(),this.updateStack()},s.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts),this.checkNoteAtPitch(),this.sanitized=!0)},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch)},o={actionName:this.name,opts:e};this.cancelStack.storeAction(o)}},s.removeGhostNote=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)};new M.A(this.measureData,n,this.cancelStack).perform()},s.getNoteAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,A.default)(n,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},s.updateStack=function(){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch)},o={type:this.name,noDraw:!0,opts:e};this.cancelStack.push(o)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(c);const i=c},726271:(j,x,t)=>{t.r(x),t.d(x,{default:()=>g});var C=t(443749),W=t(31278),T=t(701387),D=t(726042),v=t(52275),M=t(704621),A=t(783177),U=t(687396),O=t(42651),L=t(838603);const E=function(m,d,a){this.init(m,d,a)};E.NAME="action.RemoveMeasureRepeat";const I=E.prototype;I.name=E.NAME,I.init=function(m,d,a){(0,v.default)(m,d),(0,M.default)(m,d),(0,A.default)(m,d),this.scoreData=m,this.cancelStack=a,this.opts=d,this.localTimePos=null,this.clefIdx=null,this.location=null},I.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},I.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const m=this.getMeasure(),d=T.default.getNbStaves(m),a=this.opts.staffIdx;if(!D.default.isInteger(a)||a<0||a>=d)throw new C.default(this.opts.staffIdx)},I.checkExistence=function(){const m=this.getMeasure();if(!T.default.hasMeasureRepeat(m,this.opts.staffIdx))throw new W.default},I.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const m=this.getPreviousData();this.removeMeasureRepeat(),this.updateStack(m)},I.storeAction=function(){if(!this.cancelStack.hasAction()){const m=this.getLocation(),d={actionName:this.name,opts:{partUuid:m.partUuid,measureUuid:m.measureUuid,staffUuid:m.staffUuid}};this.cancelStack.storeAction(d)}},I.getPreviousData=function(){const m=this.getMeasure(),d=T.default.getMeasureRepeat(m,this.opts.staffIdx);return{patternNbMeasures:L.A.getPatternNbMeasures(d)}},I.removeMeasureRepeat=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new U.A(this.scoreData,m,this.cancelStack).perform()},I.updateStack=function(m){const d=this.getLocation(),a={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,staffUuid:d.staffUuid,patternNbMeasures:m.patternNbMeasures}};this.cancelStack.push(a)},I.getLocation=function(){if(this.location===null){const m=this.scoreData.getPartUuid(this.opts.partIdx),d=this.scoreData.getMeasureUuid(this.opts.measureIdx),a=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:m,measureUuid:d,staffUuid:a}}return this.location},(0,O.default)(E);const g=E},742253:(j,x,t)=>{t.r(x),t.d(x,{default:()=>g});var C=t(31278),W=t(123491),T=t(748049),D=t(898039),v=t(52275),M=t(704621),A=t(981801),U=t(793317),O=t(3926),L=t(42651);const E=function(m,d,a){this.init(m,d,a)};E.NAME="action.SetNoteBeamStatus",E.isNoChange=function(m){return m instanceof C.default};const I=E.prototype;I.initMeasureData=U.default,I.name=E.NAME,I.init=function(m,d,a){(0,v.default)(m,d),(0,M.default)(m,d),(0,A.default)(m,d),this.initMeasureData(m,d),this.cancelStack=a,this.opts=d,(0,D.default)(this.measureData,this.opts),this.location=null},I.checkPreconditions=function(){this.checkLocation(),this.checkNotRest(),T.A.check(this.opts.beamStatus),this.checkNoChange()},I.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},I.checkNotRest=function(){this.measureData.getVoice(this.opts.voiceIdx).checkNotRest(this.opts.noteIdx)},I.checkNoChange=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(W.default.getBeamStatus(d)===this.opts.beamStatus)throw new C.default},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const m=this.getPreviousData();this.setNoteBeamStatus(),this.updateStack(m)},I.setNoteBeamStatus=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,beamStatus:this.opts.beamStatus};new O.A(this.measureData,m,this.cancelStack).perform()},I.getPreviousData=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);return{beamStatus:W.default.getBeamStatus(d)}},I.updateStack=function(m){const d=this.getLocation(),a={type:this.name,noDraw:!0,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,divisions:d.dpq,timePos:d.timePos,beamStatus:m.beamStatus}};this.cancelStack.push(a)},I.storeAction=function(){if(!this.cancelStack.hasAction()){const m=this.getLocation(),d={actionName:this.name,opts:{partUuid:m.partUuid,measureUuid:m.measureUuid,voiceUuid:m.voiceUuid,divisions:m.dpq,timePos:m.timePos,beamStatus:this.opts.beamStatus}};this.cancelStack.storeAction(d)}},I.getLocation=function(){if(this.location===null){const m=this.measureData.getScoreData(),d=m.getPartUuid(this.opts.partIdx),a=m.getMeasureUuid(this.opts.measureIdx),r=m.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),c=this.measureData.getDpqValue(),i=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:d,measureUuid:a,voiceUuid:r,dpq:c,timePos:i}}return this.location},I.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,L.default)(E);const g=E},754998:(j,x,t)=>{t.r(x),t.d(x,{default:()=>r});var C=t(247739),W=t(807205),T=t(99923),D=t(476943),v=t(123491),M=t(292681),A=t(737903),U=t(934462),O=t(42651),L=t(793317),E=t(922679),I=t(831250),g=t(803192),m=t(768498);const d=function(c,s,i){this.init(c,s,i)};d.NAME="action.UntieNoteHeadPercu",d.isAuthorizedException=function(c){return U.default.isAuthorizedException(c)};const a=d.prototype;a.name=d.NAME,a.initMeasureData=L.default,a.getVoice=E.A,a.lineToDestUnpitched=I.A,a.init=function(c,s,i){this.initMeasureData(c,s),this.cancelStack=i,this.opts=s,this.untieRight=null,this.untieLeft=null,this.rightAction=null,this.leftAction=null},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let c=!0;try{this.checkPreconditions()}catch(s){if(d.isAuthorizedException(s))c=!1;else throw s}return c},a.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const c=this.getVoice();c.checkNoteIdx(this.opts.noteIdx),c.checkNotRest(this.opts.noteIdx),this.lineToDestUnpitched(),this.checkUnpitched()},a.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new T.A},a.checkUnpitched=function(){const c=this.getVoice(),s=(0,g.A)(this.measureData,this.opts);let i=c.getChord(this.opts.noteIdx);if(i=D.default.makeArray(i),typeof i.find(this.unpitchedPredicate,this)=="undefined")throw new C.A(C.A.GET,this.opts,s);const e=this.canUntieLeft(),o=this.canUntieRight();if(!e&&!o)throw new W.A("There is nothing to untie")},a.unpitchedPredicate=function(c){const s=v.default.getUnpitched(c);return M.default.isSameLine(s,this.opts)},a.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.canUntieLeft()){const c=this.getLeftAction();c.cancelStack=this.cancelStack,c.perform()}if(this.canUntieRight()){const c=this.getRightAction();c.cancelStack=this.cancelStack,c.perform()}},a.canUntieRight=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),s=(0,m.A)(c,this.opts.noteIdx,this.opts);if(!v.default.hasTieStart(s))return!1;if(this.untieRight===null){const i=this.getRightAction();try{i.checkPreconditions(),this.untieRight=!0}catch(n){if(U.default.isAuthorizedException(n))this.untieRight=!1;else throw n}}return this.untieRight},a.getRightAction=function(){if(this.rightAction===null){const c=(0,A.default)(this.opts);this.rightAction=new U.default(this.measureData,c,this.cancelStack)}return this.rightAction},a.canUntieLeft=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),s=(0,m.A)(c,this.opts.noteIdx,this.opts);if(!v.default.hasTieStop(s))return!1;if(this.untieLeft===null){const i=this.getLeftAction();try{i.checkPreconditions(),this.untieLeft=!0}catch(n){if(U.default.isAuthorizedException(n))this.untieLeft=!1;else throw n}}return this.untieLeft},a.getLeftAction=function(){if(this.leftAction===null){const c=(0,A.default)(this.opts);c.noteIdx--,this.leftAction=new U.default(this.measureData,c,this.cancelStack)}return this.leftAction},(0,O.default)(d);const r=d},772162:(j,x,t)=>{t.r(x),t.d(x,{default:()=>P});var C=t(153271),W=t(857552),T=t(990937),D=t(195446),v=t(748803),M=t(569445),A=t(632879),U=t(883782),O=t(31278),L=t(985623),E=t(41140),I=t(497306),g=t(52275),m=t(407819),d=t(2110),a=t(486110),r=t(956750),c=t(519405),s=t(618996),i=t(726042),n=t(701387),e=t(377180),o=t(42651);const h=function(u,R,S){this.init(u,R,S)};h.NAME="action.TransposeVoiceRange";const _=h.prototype;_.name=h.NAME,_.init=function(u,R,S){(0,m.default)(u,R),(0,g.default)(u,R),this.measuresScroller=(0,d.A)(u,R),this.cancelStack=S,this.opts=R,this.location=null,this.wrappedActions=null},_.checkPreconditions=function(){if(this.checkLocation(),e.default.check(this.opts.transpose),e.default.isIdentity(this.opts.transpose))throw new O.default;this.sanitize(),this.checkActions()},_.checkLocation=function(){this.checkPitchedPart(),this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const u=this.opts.startMeasureIdx,R=this.opts.stopMeasureIdx,S=R-u;if(S<0)throw new W.default(W.default.MEASURE,u,R);this.checkVoiceIdx(),this.hasNoteIndexes()?(this.startMeasureIdx=u,this.stopMeasureIdx=R):(this.checkTimePos(S),this.convertTimePosToNoteIndexes()),this.checkNoteIndexes(S)},_.checkPitchedPart=function(){if(this.measuresScroller.getScoreData().isPartUnpitched(this.opts.partIdx))throw new D.default},_.checkMeasureIdx=function(u){const R=this.measuresScroller.getNbMeasures();if(!i.default.isInteger(u)||u<0||u>=R)throw new C.default(u,C.default.GET)},_.checkVoiceIdx=function(){if(!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new U.default(this.opts.voiceIdx)},_.checkNoteIndexes=function(u){if(u===0&&this.opts.startNoteIdx>this.opts.stopNoteIdx)throw new W.default(W.default.NOTE,this.opts.startNoteIdx,this.opts.stopNoteIdx);const R=this.measuresScroller.getMeasureData(this.startMeasureIdx);R.checkVoiceIdx(this.opts.voiceIdx),R.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.startNoteIdx);const K=this.measuresScroller.getMeasureData(this.stopMeasureIdx);K.checkVoiceIdx(this.opts.voiceIdx),K.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.stopNoteIdx)},_.hasNoteIndexes=function(){return typeof this.opts.startNoteIdx!="undefined"||typeof this.opts.stopNoteIdx!="undefined"},_.checkTimePos=function(u){const R=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);this.checkStartTimePos(R,this.opts.startDpq,this.opts.startTimePos);const S=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);if(this.checkStopTimePos(S,this.opts.stopDpq,this.opts.stopTimePos),u===0){const K=i.default.lcm(this.opts.startDpq,this.opts.stopDpq),B=this.opts.startTimePos*K/this.opts.startDpq,N=this.opts.stopTimePos*K/this.opts.stopDpq;if(B>N)throw new W.default(W.default.NOTE,B,N)}},_.checkStartTimePos=function(u,R,S){const K=u.getDpqValue(),B=u.getMeasure();let N=n.default.getNbDivisions(B);const y=i.default.lcm(K,R);if(N*=y/K,S*=y/R,!i.default.isInteger(S)||S<0||S>=N)throw new T.A(S,y)},_.checkStopTimePos=function(u,R,S){const K=u.getDpqValue(),B=u.getMeasure();let N=n.default.getNbDivisions(B);const y=i.default.lcm(K,R);if(N*=y/K,S*=y/R,!i.default.isInteger(S)||S<0||S>N)throw new T.A(S,y)},_.convertTimePosToNoteIndexes=function(){let u={startMeasureIdx:this.opts.startMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopMeasureIdx:this.opts.stopMeasureIdx,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};if(u=(0,a.A)(this.measuresScroller,u,this.opts.voiceIdx),u===null)throw new O.default;this.startMeasureIdx=u.startMeasureIdx,this.opts.startNoteIdx=u.startNoteIdx,this.stopMeasureIdx=u.stopMeasureIdx,this.opts.stopNoteIdx=u.stopNoteIdx},_.sanitize=function(){typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0)},_.checkActions=function(){const u=this.getWrappedActions();if(u.length===0)throw new O.default;if(!u.some(p))throw u[0].error};const p=function(u){try{u.action.checkPreconditions()}catch(R){if(l(R))return u.checked=!0,u.error=R,!1;throw R}return u.checked=!0,!0};_.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.preserveTies&&this.recordTies(),this.getWrappedActions().forEach(this.callPerform,this),this.opts.preserveTies&&this.restoreTies()},_.storeAction=function(){if(!this.cancelStack.hasAction()){const u=this.getLocation(),R=u.measureUuids.slice();this.hasTimePos()||this.convertNoteIndexesToTimePos();const S=e.default.copy(this.opts.transpose),K={actionName:this.name,opts:{partUuid:u.partUuid,measureUuids:R,voiceIdx:this.opts.voiceIdx,startDpq:this.opts.startDpq,startTimePos:this.opts.startTimePos,stopDpq:this.opts.stopDpq,stopTimePos:this.opts.stopTimePos,checkLine:this.opts.checkLine,preserveTies:!!this.opts.preserveTies,updateGraces:!!this.opts.updateGraces,preserveColor:!!this.opts.preserveColor,transpose:S}};this.cancelStack.storeAction(K)}},_.getLocation=function(){if(this.location===null){const u=this.measuresScroller.getScoreData(),R=u.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),S=u.getPartUuid(this.opts.partIdx);this.location={partUuid:S,measureUuids:R}}return this.location},_.hasTimePos=function(){return typeof this.opts.startTimePos!="undefined"||typeof this.opts.startDpq!="undefined"||typeof this.opts.stopTimePos!="undefined"||typeof this.opts.stopDpq!="undefined"},_.convertNoteIndexesToTimePos=function(){let u={startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,startVoiceIdx:this.opts.voiceIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx,stopVoiceIdx:this.opts.voiceIdx};u=(0,r.A)(this.measuresScroller,u),this.opts.startTimePos=u.startTimePos,this.opts.startDpq=u.startDpq,this.opts.stopTimePos=u.stopTimePos,this.opts.stopDpq=u.stopDpq},_.recordTies=function(){const u={voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx};this.chordsTies=(0,s.A)(this.measuresScroller,u)},_.getWrappedActions=function(){return this.wrappedActions===null&&this.createWrappedActions(),this.wrappedActions},_.createWrappedActions=function(){this.wrappedActions=[];let u=this.opts.startNoteIdx,R=this.startMeasureIdx;const S=this.opts.stopNoteIdx,K=this.stopMeasureIdx;for(;f(R,K,u,S);){const B=this.measuresScroller.getMeasureData(R);if(B.hasVoice(this.opts.voiceIdx)){const N=B.getVoice(this.opts.voiceIdx);N.isRest(u)||this.createWrappedAction(B,R,u),u++,u===N.getNbNotes()&&(u=0,R++)}else u=0,R++}};const f=function(u,R,S,K){return u<R?!0:u===R?S<=K:!1};_.createWrappedAction=function(u,R,S){const K=e.default.copy(this.opts.transpose),B={partIdx:this.opts.partIdx,measureIdx:R,voiceIdx:this.opts.voiceIdx,noteIdx:S,transpose:K,checkLine:this.opts.checkLine,preserveColor:this.opts.preserveColor},N=null,k={action:new L.default(u,B,N),error:null,checked:!1};this.wrappedActions.push(k),this.opts.updateGraces&&this.createGracesAction(u,R,S)},_.createGracesAction=function(u,R,S){const K=e.default.copy(this.opts.transpose),B={partIdx:this.opts.partIdx,measureIdx:R,voiceIdx:this.opts.voiceIdx,noteIdx:S,transpose:K,checkLine:this.opts.checkLine,preserveColor:this.opts.preserveColor},N=null,k={action:new E.default(u,B,N),error:null,checked:!1};this.wrappedActions.push(k)},_.callPerform=function(u){u.error===null&&(u.action.cancelStack=this.cancelStack,u.checked?u.action.perform():(0,c.default)(u.action,l))};const l=function(u){return u instanceof v.default||u instanceof A.A||u instanceof M.A||u instanceof O.default};_.restoreTies=function(){const u={partIdx:this.opts.partIdx,chordsTies:this.chordsTies};new I.A(this.measuresScroller,u,this.cancelStack).perform()},(0,o.default)(h);const P=h},795510:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(31278),W=t(247739),T=t(123491),D=t(292681),v=t(104907),M=t(332417),A=t(76004),U=t(2835),O=t(898039),L=t(52275),E=t(704621),I=t(981801),g=t(831121),m=t(793317),d=t(42651);const a=function(s,i,n){this.init(s,i,n)};a.NAME="action.RemoveColorFromGracePercu",a.isNoChange=function(s){return s instanceof C.default};const r=a.prototype;r.name=a.NAME,r.initMeasureData=m.default,r.init=function(s,i,n){(0,L.default)(s,i),(0,E.default)(s,i),(0,I.default)(s,i),this.initMeasureData(s,i),this.cancelStack=n,this.opts=i,this.noteHead=null,this.voice=null,this.location=null},r.checkPreconditions=function(){this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,O.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkGraceIdx(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkGhost()},r.checkUnpitchedPart=function(){(0,g.default)(this.measureData)},r.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},r.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},r.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},r.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,U.default)(this.measureData,this.opts)},r.checkNoteAtUnpitched=function(){if(typeof this.getGraceAtUnpitched()=="undefined"){const i=D.default.copy(this.opts.unpitched),n=this.opts.staffIdx||0,e=this.measureData.getStaffDetails(n),o=v.default.getNbStaffLines(e);throw new W.A(W.A.GET,i,o)}},r.checkGhost=function(){const s=this.getGraceAtUnpitched();if(!T.default.hasColor(s))throw new C.default},r.getGraceAtUnpitched=function(){if(this.noteHead===null){const s=this.getVoice();this.noteHead=(0,A.A)(s,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched)}return this.noteHead},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const s=this.extractColor();this.removeColorFromGracePercu(),this.updateStack(s)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,graceIdx:this.opts.graceIdx,unpitched:D.default.copy(this.opts.unpitched)},n={actionName:this.name,opts:i};this.cancelStack.storeAction(n)}},r.extractColor=function(){const s=this.getGraceAtUnpitched();return T.default.getColor(s)},r.removeColorFromGracePercu=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:D.default.copy(this.opts.unpitched)};new M.A(this.measureData,s,this.cancelStack).perform()},r.updateStack=function(s){const i=this.getLocation(),n={partUuid:i.partUuid,measureUuid:i.measureUuid,voiceUuid:i.voiceUuid,divisions:i.dpq,timePos:i.timePos,graceIdx:this.opts.graceIdx,unpitched:D.default.copy(this.opts.unpitched),color:s},e={type:this.name,noDraw:!0,opts:n};this.cancelStack.push(e)},r.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),i=s.getPartUuid(this.opts.partIdx),n=s.getMeasureUuid(this.opts.measureIdx),e=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),_=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:i,measureUuid:n,voiceUuid:e,dpq:o,timePos:_,isConcertPitch:!1}}return this.location},r.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,d.default)(a);const c=a},873010:(j,x,t)=>{t.r(x),t.d(x,{default:()=>c});var C=t(153271),W=t(661e3),T=t(857552),D=t(270259),v=t(195446),M=t(443749),A=t(701387),U=t(364596),O=t(726042),L=t(714201),E=t(52275),I=t(407819),g=t(783177),m=t(640021),d=t(42651);const a=function(s,i,n){this.init(s,i,n)};a.NAME="action.SetKeySegment";const r=a.prototype;r.name=a.NAME,r.init=function(s,i,n){(0,I.default)(s,i),(0,E.default)(s,i),(0,g.default)(s,i),(0,m.default)(s,i),this.scoreData=s,this.cancelStack=n,this.opts=i,this.location=null,this.firstKey=null},r.checkPreconditions=function(){U.default.check(this.opts.key),this.checkPitchedPart(),this.checkLocation(),this.checkDifferentKey(),this.checkCurrentConsistent()},r.checkPitchedPart=function(){if(this.scoreData.isPartUnpitched(this.opts.partIdx))throw new v.default},r.checkLocation=function(){this.checkMeasureIdx(this.opts.startMeasureIdx),this.checkMeasureIdx(this.opts.stopMeasureIdx);const s=this.opts.startMeasureIdx,i=this.opts.stopMeasureIdx;if(i-s<0)throw new T.default(T.default.MEASURE,s,i);const e=this.getFirstMeasure(),o=A.default.getNbStaves(e),h=this.opts.staffIdx;if(!O.default.isInteger(h)||h<0||h>=o)throw new M.default(h,M.default.GET)},r.checkMeasureIdx=function(s){const i=this.scoreData.getNbMeasures();if(!O.default.isInteger(s)||s<0||s>=i)throw new C.default(s,C.default.GET)},r.checkDifferentKey=function(){const s=this.getFirstKey(),i=this.opts.key;if(U.default.isSame(i,s))throw new W.default(W.default.KEY,U.default.copy(s),U.default.copy(i))},r.checkCurrentConsistent=function(){const s=this.getFirstKey();for(let i=this.opts.startMeasureIdx+1;i<=this.opts.stopMeasureIdx;i++){const n=this.getKey(i);if(!U.default.isSame(n,s))throw new D.A(D.A.KEY)}},r.getFirstKey=function(){return this.firstKey===null&&(this.firstKey=this.getKey(this.opts.startMeasureIdx)),this.firstKey},r.getKey=function(s){const i=this.scoreData.getMeasure(this.opts.partIdx,s);return A.default.getWrappedKey(i).getEntry(this.opts.staffIdx)},r.getFirstMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx)},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();let s=this.getFirstKey();s=U.default.copy(s),this.setKeySegment(),this.updateStack(s)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),i=s.measureUuids.slice(),n=U.default.copy(this.opts.key),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuids:i,staffUuid:s.staffUuid,key:n}};this.cancelStack.storeAction(e)}},r.setKeySegment=function(){const s=U.default.copy(this.opts.key),i={partIdx:this.opts.partIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,staffIdx:this.opts.staffIdx,key:s};new L.A(this.scoreData,i,this.cancelStack).perform()},r.updateStack=function(s){const i=this.getLocation(),n=i.measureUuids.slice(),e=U.default.copy(this.opts.key),o={type:this.name,noDraw:!0,opts:{partUuid:i.partUuid,measureUuids:n,staffUuid:i.staffUuid,previousKey:s,newKey:e}};this.cancelStack.push(o)},r.getLocation=function(){if(this.location===null){const s=this.scoreData.getMeasureUuids(this.opts.startMeasureIdx,this.opts.stopMeasureIdx),i=this.scoreData.getPartUuid(this.opts.partIdx),n=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:i,measureUuids:s,staffUuid:n}}return this.location},(0,d.default)(a);const c=a},883740:(j,x,t)=>{t.r(x),t.d(x,{default:()=>s});var C=t(31278),W=t(247739),T=t(123491),D=t(292681),v=t(104907),M=t(760367),A=t(245817),U=t(768498),O=t(2835),L=t(898039),E=t(52275),I=t(704621),g=t(981801),m=t(831121),d=t(793317),a=t(42651);const r=function(i,n,e){this.init(i,n,e)};r.NAME="action.SetTieDirectionPercu",r.isNoChange=function(i){return i instanceof C.default};const c=r.prototype;c.name=r.NAME,c.initMeasureData=d.default,c.init=function(i,n,e){(0,E.default)(i,n),(0,I.default)(i,n),(0,g.default)(i,n),this.initMeasureData(i,n),this.cancelStack=e,this.opts=n,this.noteHead=null,this.voice=null,this.location=null},c.checkPreconditions=function(){M.A.check(this.opts.tieDirection),this.checkUnpitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtUnpitched(),this.checkNoChange()},c.checkUnpitchedPart=function(){(0,m.default)(this.measureData)},c.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},c.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},c.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts)},c.checkNoteAtUnpitched=function(){if(typeof this.getNoteAtUnpitched()=="undefined"){const n=D.default.copy(this.opts.unpitched),e=this.opts.staffIdx||0,o=this.measureData.getStaffDetails(e),h=v.default.getNbStaffLines(o);throw new W.A(W.A.GET,n,h)}},c.checkNoChange=function(){const i=this.getNoteAtUnpitched();if(T.default.getTieDirection(i)===this.opts.tieDirection)throw new C.default},c.getNoteAtUnpitched=function(){if(this.noteHead===null){const i=this.getVoice();this.noteHead=(0,U.A)(i,this.opts.noteIdx,this.opts.unpitched)}return this.noteHead},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const i=this.getPreviousData();this.setTieDirection(),this.updateStack(i)},c.storeAction=function(){if(!this.cancelStack.hasAction()){const i=this.getLocation(),n={partUuid:i.partUuid,measureUuid:i.measureUuid,voiceUuid:i.voiceUuid,divisions:i.dpq,timePos:i.timePos,unpitched:D.default.copy(this.opts.unpitched),tieDirection:this.opts.tieDirection},e={actionName:this.name,opts:n};this.cancelStack.storeAction(e)}},c.getPreviousData=function(){const i=this.getNoteAtUnpitched();return{tieDirection:T.default.getTieDirection(i)}},c.setTieDirection=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:D.default.copy(this.opts.unpitched),tieDirection:this.opts.tieDirection};new A.A(this.measureData,i,this.cancelStack).perform()},c.updateStack=function({tieDirection:i}){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,unpitched:D.default.copy(this.opts.unpitched),tieDirection:i},o={type:this.name,noDraw:!0,opts:e};this.cancelStack.push(o)},c.getLocation=function(){if(this.location===null){const i=this.measureData.getScoreData(),n=i.getPartUuid(this.opts.partIdx),e=i.getMeasureUuid(this.opts.measureIdx),o=i.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),h=this.measureData.getDpqValue(),p=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:n,measureUuid:e,voiceUuid:o,dpq:h,timePos:p,isConcertPitch:!1}}return this.location},c.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,a.default)(r);const s=r},889484:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(862790),W=t(443749),T=t(646456),D=t(701387),v=t(726042),M=t(446921),A=t(558280),U=t(544342),O=t(52275),L=t(704621),E=t(783177),I=t(316610),g=t(930109),m=t(59938),d=t(42651);const a=function(e,o,h){this.init(e,o,h)};a.NAME="action.RemoveWedgeAtTimePos";const r=a.prototype;r.name=a.NAME,r.init=function(e,o,h){(0,O.default)(e,o),(0,L.default)(e,o),(0,E.default)(e,o),this.scoreData=e,this.cancelStack=h,this.opts=o,this.localTimePos=null,this.measureData=null,this.location=null},r.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence()},r.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const e=this.getMeasure(),o=D.default.getNbStaves(e),h=this.opts.staffIdx;if(!v.default.isInteger(h)||h<0||h>=o)throw new W.default(h)},r.checkTimePos=function(){const e=this.getLocalTimePos(),o=this.getMeasure(),h=D.default.getNbDivisions(o);if(!v.default.isNumber(e)||e<0||e>=h){const _=D.default.getDpq(o);throw new T.A(e,_)}},r.checkExistence=function(){if(!this.hasWedge())throw new C.A},r.hasWedge=function(){const e=this.getLocalTimePos(),o=this.getMeasure(),h=D.default.getWedges(o,this.opts.staffIdx),_=i(o,this.opts.staffIdx);return!!((0,U.A)(_,h,e)!==null||c(h,e))};const c=function(e,o){return e.some(s,o)},s=function(e){const o=this.valueOf();return A.A.getTimePos(e)===o&&A.A.isRight(e)};r.getLocalTimePos=function(){if(this.localTimePos===null){const e=this.getMeasure();this.localTimePos=(0,I.A)(this.opts,e)}return this.localTimePos},r.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)};const i=function(e,o){return D.default.hasLeftWedge(e,o)?D.default.getLeftWedge(e,o):null};r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.removeWedge(),this.updateStack(e)},r.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,staffUuid:e.staffUuid,timePos:this.opts.timePos,dpq:this.opts.dpq}};this.cancelStack.storeAction(o)}},r.getPreviousData=function(){const e=this.getLocalTimePos(),o=this.scoreData.getPartContent(this.opts.partIdx),h=M.A.getMeasures(o),_=(0,g.A)(h,this.opts.measureIdx,this.opts.staffIdx,e),p=this.scoreData.getMeasureUuid(_.startMeasureIdx),f=this.scoreData.getMeasureUuid(_.stopMeasureIdx),l=this.scoreData.getMeasure(this.opts.partIdx,_.startMeasureIdx),P=D.default.getDpq(l),u=this.scoreData.getMeasure(this.opts.partIdx,_.stopMeasureIdx),R=D.default.getDpq(u);return{startMeasureUuid:p,startTimePos:_.startTimePos,stopTimePos:_.stopTimePos,startDpq:P,stopMeasureUuid:f,stopDpq:R,placement:_.placement,type:_.type}},r.removeWedge=function(){const e=this.getLocalTimePos(),o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:e};new m.A(this.scoreData,o,this.cancelStack).perform()},r.updateStack=function(e){const o=this.getLocation(),h={type:this.name,noDraw:!0,opts:{partUuid:o.partUuid,startMeasureUuid:e.startMeasureUuid,startTimePos:e.startTimePos,startDpq:e.startDpq,stopMeasureUuid:e.stopMeasureUuid,stopTimePos:e.stopTimePos,stopDpq:e.stopDpq,staffUuid:o.staffUuid,placement:e.placement,type:e.type}};this.cancelStack.push(h)},r.getLocation=function(){if(this.location===null){const e=this.scoreData.getPartUuid(this.opts.partIdx),o=this.scoreData.getMeasureUuid(this.opts.measureIdx),h=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:e,staffUuid:h,measureUuid:o}}return this.location},(0,d.default)(a);const n=a},909103:(j,x,t)=>{t.r(x),t.d(x,{default:()=>i});var C=t(31278),W=t(195446),T=t(748803),D=t(123491),v=t(351277),M=t(214844),A=t(578918),U=t(19405),O=t(476031),L=t(898039),E=t(52275),I=t(704621),g=t(981801),m=t(783177),d=t(287296),a=t(793317),r=t(42651);const c=function(n,e,o){this.init(n,e,o)};c.NAME="action.RemoveFingerings",c.isNoChange=function(n){return n instanceof C.default};const s=c.prototype;s.name=c.NAME,s.initMeasureData=a.default,s.init=function(n,e,o){(0,E.default)(n,e),(0,I.default)(n,e),(0,g.default)(n,e),(0,m.default)(n,e),this.initMeasureData(n,e),this.cancelStack=o,this.opts=e,this.noteHead=null,this.voice=null,this.location=null},s.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,L.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.checkValues(),this.sanitizeIfNeeded(),this.checkNoteAtPitch(),this.checkFingering()},s.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},s.checkValues=function(){(0,U.default)(this.opts)},s.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},s.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},s.sanitizeIfNeeded=function(){typeof this.opts.line!="undefined"&&(0,O.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts)},s.checkNoteAtPitch=function(){if(typeof this.getNoteAtPitch()=="undefined"){const e=v.default.copy(this.opts.pitch);throw new T.default(T.default.GET,e)}},s.checkFingering=function(){const n=this.getNoteAtPitch();if(!D.default.hasFingering(n))throw new C.default},s.getNoteAtPitch=function(){if(this.noteHead===null){const n=this.getVoice();this.noteHead=(0,A.default)(n,this.opts.noteIdx,this.opts.pitch)}return this.noteHead},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const n=this.getPreviousData();this.removeFingering(),this.updateStack(n)},s.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),e={partUuid:n.partUuid,measureUuid:n.measureUuid,voiceUuid:n.voiceUuid,divisions:n.dpq,timePos:n.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),isConcertPitch:!1},o={actionName:this.name,opts:e};this.cancelStack.storeAction(o)}},s.getPreviousData=function(){const n=this.getNoteAtPitch();return{fingering:D.default.getFingering(n)}},s.removeFingering=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)};new M.A(this.measureData,n,this.cancelStack).perform()},s.updateStack=function(n){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:v.default.copyWithoutAlter(this.opts.pitch),fingering:n.fingering},h={type:this.name,noDraw:!0,opts:o};this.cancelStack.push(h)},s.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),e=n.getPartUuid(this.opts.partIdx),o=n.getMeasureUuid(this.opts.measureIdx),h=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),_=this.measureData.getDpqValue(),f=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:o,voiceUuid:h,dpq:_,timePos:f,isConcertPitch:!1}}return this.location},s.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,r.default)(c);const i=c},925822:(j,x,t)=>{t.r(x),t.d(x,{default:()=>a});var C=t(343818),W=t(883782),T=t(123491),D=t(712947),v=t(52275),M=t(704621),A=t(898039),U=t(981801),O=t(337473),L=t(2110),E=t(739293),I=t(713735),g=t(42651);const m=function(r,c,s){this.init(r,c,s)};m.NAME="action.RemoveSlur";const d=m.prototype;d.name=m.NAME,d.init=function(r,c,s){(0,v.default)(r,c),(0,M.default)(r,c),(0,U.default)(r,c),this.measuresScroller=(0,L.A)(r,c),this.cancelStack=s,this.opts=c,this.startNoteIdx=null,this.startMeasureIdx=null,this.stopNoteIdx=null,this.stopMeasureIdx=null,this.location=null},d.checkPreconditions=function(){this.checkLocation(),this.searchSides()},d.checkLocation=function(){if(this.measuresScroller.checkMeasureIdx(this.opts.measureIdx),!this.measuresScroller.getScoreData().hasPartVoiceIdx(this.opts.partIdx,this.opts.voiceIdx))throw new W.default(this.opts.voiceIdx);const c=this.measuresScroller.getMeasureData(this.opts.measureIdx);c.hasVoice(this.opts.voiceIdx)&&((0,A.default)(c,this.opts),c.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx))},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasSide()||this.searchSides(),this.storeAction();const r={partIdx:this.opts.partIdx,startMeasureIdx:this.startMeasureIdx,stopMeasureIdx:this.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,startNoteIdx:this.startNoteIdx,stopNoteIdx:this.stopNoteIdx};new O.A(this.measuresScroller,r,this.cancelStack).perform(),this.updateStack()},d.hasSide=function(){return this.startNoteIdx!==null&&this.stopNoteIdx!==null},d.searchSides=function(){this.searchLeftSide(),this.searchRightSide()},d.searchLeftSide=function(){const r=(0,E.A)(this.measuresScroller,this.opts);if(r===null)throw new C.A;{this.startMeasureIdx=r.measureIdx,this.startNoteIdx=r.noteIdx;const i=this.measuresScroller.getMeasureData(this.startMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.startNoteIdx),n=T.default.getSlur(i);this.previousPlacement=D.default.getPlacement(n)}},d.searchRightSide=function(){const r=(0,I.A)(this.measuresScroller,this.opts);if(r===null)throw new C.A;this.stopMeasureIdx=r.measureIdx,this.stopNoteIdx=r.noteIdx},d.storeAction=function(){if(!this.cancelStack.hasAction()){const r=this.getLocation(),c={actionName:this.name,opts:{partUuid:r.partUuid,measureUuid:r.measureUuid,divisions:r.dpq,timePos:r.timePos,voiceUuid:r.voiceUuid}};this.cancelStack.storeAction(c)}},d.updateStack=function(){const r=this.getLocation(),c={type:this.name,noDraw:!0,opts:{partUuid:r.partUuid,voiceUuid:r.voiceUuid,startMeasureUuid:r.startMeasureUuid,startTimePos:r.startTimePos,startDivisions:r.startDpq,stopMeasureUuid:r.stopMeasureUuid,stopTimePos:r.stopTimePos,stopDivisions:r.stopDpq,placement:this.previousPlacement}};this.cancelStack.push(c)},d.getLocation=function(){if(this.location===null){const r=this.measuresScroller.getScoreData(),c=r.getPartUuid(this.opts.partIdx),s=r.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),i=r.getMeasureUuid(this.startMeasureIdx),n=this.measuresScroller.getMeasureData(this.startMeasureIdx),e=n.getDpqValue(),h=n.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.startNoteIdx),_=r.getMeasureUuid(this.stopMeasureIdx),p=this.measuresScroller.getMeasureData(this.stopMeasureIdx),f=p.getDpqValue(),P=p.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.stopNoteIdx),u=r.getMeasureUuid(this.opts.measureIdx),R=this.measuresScroller.getMeasureData(this.opts.measureIdx),S=R.getDpqValue();let K;R.hasVoice(this.opts.voiceIdx)?K=R.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx):K=0,this.location={partUuid:c,voiceUuid:s,startMeasureUuid:i,startDpq:e,startTimePos:h,stopMeasureUuid:_,stopDpq:f,stopTimePos:P,measureUuid:u,dpq:S,timePos:K}}return this.location},(0,g.default)(m);const a=m},933516:(j,x,t)=>{t.r(x),t.d(x,{default:()=>p});var C=t(917530),W=t(443749),T=t(646456),D=t(857552),v=t(31278),M=t(364842),A=t(701387),U=t(952818),O=t(726042),L=t(446921),E=t(377180),I=t(723631),g=t(773948),m=t(52275),d=t(704621),a=t(783177),r=t(316610),c=t(435237),s=t(886766),i=t(424863),n=t(485594),e=t(42651);const o=function(f,l,P){this.init(f,l,P)};o.NAME="action.RemoveOctaveShiftAtTimePos";const h=o.prototype;h.name=o.NAME,h.init=function(f,l,P){(0,m.default)(f,l),(0,d.default)(f,l),(0,a.default)(f,l),this.scoreData=f,this.cancelStack=P,this.opts=l,this.localTimePos=null,this.measureData=null,this.location=null,this.previousData=null,this.transposeAction=null},h.checkPreconditions=function(){this.checkLocation(),this.checkTimePos(),this.checkExistence(),this.sanitize(),this.opts.transpose&&this.checkCanTranspose()},h.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const f=this.getMeasure(),l=A.default.getNbStaves(f),P=this.opts.staffIdx;if(!O.default.isInteger(P)||P<0||P>=l)throw new W.default(P)},h.checkTimePos=function(){const f=this.getLocalTimePos(),l=this.getMeasure(),P=A.default.getNbDivisions(l);if(!O.default.isNumber(f)||f<0||f>=P){const u=A.default.getDpq(l);throw new T.A(f,u)}},h.checkExistence=function(){if(!this.hasOctaveShift())throw new C.A},h.hasOctaveShift=function(){const f=this.getLocalTimePos(),l=this.getMeasure(),P=A.default.getOctaveShifts(l,this.opts.staffIdx),u=this.extractLeftOctaveShift(l);return(0,s.A)(u,P,f)!==null},h.extractLeftOctaveShift=function(f){return A.default.hasLeftOctaveShift(f,this.opts.staffIdx)?A.default.getLeftOctaveShift(f,this.opts.staffIdx):null},h.searchOctaveShift=function(f){const l=this;return U.A.getPosTime(f)===l},h.getLocalTimePos=function(){if(this.localTimePos===null){const f=this.getMeasure();this.localTimePos=(0,r.A)(this.opts,f)}return this.localTimePos},h.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},h.sanitize=function(){typeof this.opts.transpose=="undefined"&&(this.opts.transpose=!1),typeof this.opts.preserveTies=="undefined"&&(this.opts.preserveTies=!1),typeof this.opts.updateGraces=="undefined"&&(this.opts.updateGraces=!1)},h.checkCanTranspose=function(){const f=this.getTransposeAction();try{f.checkPreconditions(),this.canTranspose=!0}catch(l){if(l instanceof D.default||l instanceof v.default)this.canTranspose=!1;else throw l}},h.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.opts.transpose&&this.canTranspose){const l=this.getTransposeAction();l.cancelStack=this.cancelStack,l.perform()}const f=this.getPreviousData();this.removeOctaveShift(),this.updateStack(f)},h.getTransposeAction=function(){if(this.transposeAction===null){const f=this.getTransposeValue(),l=this.getPreviousData(),P={partIdx:this.opts.partIdx,startMeasureIdx:l.startMeasureIdx,startTimePos:l.startTimePos,startDpq:l.startDpq,stopMeasureIdx:l.stopMeasureIdx,stopTimePos:l.stopTimePos,stopDpq:l.stopDpq,staffIdx:this.opts.staffIdx,transpose:f,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,preserveColor:this.opts.preserveColor,checkLine:!1},u=null;this.transposeAction=new n.default(this.scoreData,P,u)}return this.transposeAction},h.getTransposeValue=function(){const f=this.getPreviousData(),l=E.default.createDefault(),P=_(f.placement);let u=g.A.sizeToOctaveShift(f.size);return u*=P,E.default.setOctaveChange(l,u),l};const _=function(f){if(f===I.A.ABOVE)return-1;if(f===I.A.BELOW)return 1;throw new M.default("Unexpedted")};h.storeAction=function(){if(!this.cancelStack.hasAction()){const f=this.getLocation(),l={actionName:this.name,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,timePos:this.opts.timePos,dpq:this.opts.dpq,staffUuid:f.staffUuid,transpose:this.opts.transpose,preserveTies:this.opts.preserveTies,updateGraces:this.opts.updateGraces,preserveColor:!!this.opts.preserveColor}};this.cancelStack.storeAction(l)}},h.getPreviousData=function(){if(this.previousData===null){const f=this.getLocalTimePos(),l=this.scoreData.getPartContent(this.opts.partIdx),P=L.A.getMeasures(l),u=(0,c.A)(P,this.opts.measureIdx,this.opts.staffIdx,f),R=u.startMeasureIdx,S=this.scoreData.getMeasureUuid(R),K=u.stopMeasureIdx,B=this.scoreData.getMeasureUuid(K),N=this.scoreData.getMeasure(this.opts.partIdx,u.startMeasureIdx),y=A.default.getDpq(N),k=this.scoreData.getMeasure(this.opts.partIdx,u.stopMeasureIdx),V=A.default.getDpq(k);this.previousData={startMeasureUuid:S,startMeasureIdx:R,startTimePos:u.startTimePos,startDpq:y,stopMeasureUuid:B,stopMeasureIdx:K,stopTimePos:u.stopTimePos,stopDpq:V,placement:u.placement,type:u.type,size:u.size}}return this.previousData},h.removeOctaveShift=function(){const f=this.getLocalTimePos(),l={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:f};new i.A(this.scoreData,l,this.cancelStack).perform()},h.updateStack=function(f){const l=this.getLocation(),P={type:this.name,noDraw:!0,opts:{partUuid:l.partUuid,startMeasureUuid:f.startMeasureUuid,startTimePos:f.startTimePos,startDpq:f.startDpq,stopMeasureUuid:f.stopMeasureUuid,stopTimePos:f.stopTimePos,stopDpq:f.stopDpq,staffUuid:l.staffUuid,placement:f.placement,type:f.type,size:f.size}};this.cancelStack.push(P)},h.getLocation=function(){if(this.location===null){const f=this.scoreData.getPartUuid(this.opts.partIdx),l=this.scoreData.getMeasureUuid(this.opts.measureIdx),P=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:f,staffUuid:P,measureUuid:l}}return this.location},(0,e.default)(o);const p=o},951805:(j,x,t)=>{t.r(x),t.d(x,{default:()=>_});var C=t(31278),W=t(195446),T=t(748803),D=t(737903),v=t(123491),M=t(351277),A=t(614426),U=t(278959),O=t(762860),L=t(19405),E=t(476031),I=t(172788),g=t(898039),m=t(52275),d=t(981801),a=t(783177),r=t(704621),c=t(714898),s=t(534512),i=t(200665),n=t(793317),e=t(42651);const o=function(p,f,l){this.init(p,f,l)};o.NAME="action.AddGraceAccidental",o.isNoChange=function(p){return p instanceof C.default};const h=o.prototype;h.name=o.NAME,h.initMeasureData=n.default,h.init=function(p,f,l){(0,m.default)(p,f),(0,r.default)(p,f),(0,d.default)(p,f),(0,a.default)(p,f),this.initMeasureData(p,f),this.cancelStack=l,this.opts=f,this.sanitized=!1,this.voice=null,this.graceAtPitch=null,this.location=null},h.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,g.default)(this.measureData,this.opts),this.checkGraceIdx(),this.checkValues(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkAlterDifferent(),this.checkNotLocked()},h.checkValues=function(){(0,L.default)(this.opts),this.opts.accidental!==null&&A.default.check(this.opts.accidental)},h.checkPitch=function(){M.default.check(this.opts.pitch)},h.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},h.checkGraceIdx=function(){this.getVoice().checkGraceIdx(this.opts.noteIdx,this.opts.graceIdx)},h.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},h.checkNoteAtPitch=function(){if(typeof this.getGraceAtPitch()=="undefined"){const f=M.default.copy(this.opts.pitch);throw new T.default(T.default.GET,f)}},h.checkAlterDifferent=function(){const p=this.getCurrentAlter();if(M.default.getAlter(this.opts.pitch)===p)throw new C.default},h.checkNotLocked=function(){const p=this.getGraceAtPitch();v.default.checkNotLocked(p)},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,g.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction();const p=this.getNoteData();this.addGraceAccidental(),this.isTabStaff()&&this.setFret(),this.updateStack(p)},h.sanitizeIfNeeded=function(){if(!this.sanitized){if(typeof this.opts.line!="undefined"&&(0,E.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,c.default)(this.measureData,this.opts),this.checkNoteAtPitch(),(0,I.A)(this.measureData,this.opts),this.measureData.getScoreData().isPartTab(this.opts.partIdx)){const f=this.opts.fretData||{},l=this.getGraceAtPitch();v.default.hasString(l)&&(f.lastString=v.default.getString(l)),this.opts.fretData=f}this.sanitized=!0}},h.storeAction=function(){if(!this.cancelStack.hasAction()){const p=this.getLocation(),f={actionName:this.name,opts:{partUuid:p.partUuid,measureUuid:p.measureUuid,voiceUuid:p.voiceUuid,divisions:p.dpq,timePos:p.timePos,graceIdx:this.opts.graceIdx,pitch:M.default.copyWithoutAlter(this.opts.pitch),accidental:this.opts.accidental}};typeof this.opts.fretData!="undefined"&&typeof this.opts.fretData.string!="undefined"&&(f.opts.fretData=(0,D.default)(this.opts.fretData),delete f.opts.fretData.lastString),this.cancelStack.storeAction(f)}},h.getNoteData=function(){const p=this.getCurrentAlter(),l={accidental:M.default.alterToAccidental(p)},P=this.getGraceAtPitch();return v.default.hasFretData(P)&&(l.fretData=v.default.getFretData(P)),l},h.getCurrentAlter=function(){const p=this.getGraceAtPitch(),f=v.default.getPitch(p);return M.default.getAlter(f)},h.getGraceAtPitch=function(){if(this.graceAtPitch===null){const p=this.getVoice();this.graceAtPitch=(0,O.A)(p,this.opts.noteIdx,this.opts.graceIdx,this.opts.pitch)}return this.graceAtPitch},h.addGraceAccidental=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:M.default.copy(this.opts.pitch)};new U.A(this.measureData,p,this.cancelStack).perform()},h.isTabStaff=function(){return(0,s.default)(this.measureData,this.opts)},h.setFret=function(){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:M.default.copy(this.opts.pitch),fretData:(0,D.default)(this.opts.fretData)};new i.default(this.measureData,p,this.cancelStack).performIfPossible()},h.updateStack=function(p){const f=this.getLocation(),l={type:this.name,noDraw:!0,opts:{partUuid:f.partUuid,measureUuid:f.measureUuid,voiceUuid:f.voiceUuid,divisions:f.dpq,timePos:f.timePos,graceIdx:this.opts.graceIdx,pitch:M.default.copyWithoutAlter(this.opts.pitch),previousAccidental:p.accidental}};p.fretData&&(l.opts.fretData=(0,D.default)(p.fretData)),this.cancelStack.push(l)},h.getLocation=function(){if(this.location===null){const p=this.measureData.getScoreData(),f=p.getPartUuid(this.opts.partIdx),l=p.getMeasureUuid(this.opts.measureIdx),P=p.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),u=this.measureData.getDpqValue(),S=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:f,measureUuid:l,voiceUuid:P,dpq:u,timePos:S}}return this.location},(0,e.default)(o);const _=o},953952:(j,x,t)=>{t.r(x),t.d(x,{default:()=>P});var C=t(381642),W=t(477172),T=t(195783),D=t(326582),v=t(19551),M=t(351277),A=t(123491),U=t(316197),O=t(511890),L=t(737903),E=t(359932),I=t(129283),g=t(793317),m=t(52275),d=t(704621),a=t(981801),r=t(783177),c=t(898039),s=t(476031),i=t(578918),n=t(534512),e=t(691309),o=t(287296),h=t(714898),_=t(195446),p=t(42651);const f=function(u,R,S){this.init(u,R,S)};f.NAME="action.ChangePitch",f.copyAddOpts=function(u){const R={partIdx:u.partIdx,measureIdx:u.measureIdx,voiceIdx:u.voiceIdx,staffIdx:u.staffIdx,noteIdx:u.noteIdx,accidental:u.accidental,fretData:u.fretData,isConcertPitch:u.isConcertPitch,checkLine:u.checkLine};return typeof u.toLine!="undefined"?R.line=u.toLine:typeof u.toPitch!="undefined"&&(R.pitch=M.default.copy(u.toPitch)),R},f.copyRemoveOpts=function(u){const R={partIdx:u.partIdx,measureIdx:u.measureIdx,voiceIdx:u.voiceIdx,staffIdx:u.staffIdx,noteIdx:u.noteIdx,isConcertPitch:u.isConcertPitch};return typeof u.fromLine!="undefined"?(R.line=u.fromLine,R.staffIdx=u.staffIdx):typeof u.fromPitch!="undefined"&&(R.pitch=M.default.copy(u.fromPitch)),R};const l=f.prototype;l.name=f.NAME,l.initMeasureData=g.default,l.init=function(u,R,S){(0,m.default)(u,R),(0,d.default)(u,R),(0,a.default)(u,R),(0,r.default)(u,R),this.initMeasureData(u,R),this.cancelStack=S,this.opts=R,(0,c.default)(this.measureData,this.opts),this.addAction=null,this.removeAction=null,this.leftCrossMeasure=null,this.rightCrossMeasure=null,this.noteAtPitch=null,this.location=null,this.sanitized=!1},l.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.checkPitchedPart();const u=this.measureData.getVoice(this.opts.voiceIdx);u.checkNoteIdx(this.opts.noteIdx),u.checkNotRest(this.opts.noteIdx),this.sanitizeIfNeeded(),this.getAddAction().checkPreconditions(),this.getRemoveAction().checkPitch()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new _.default},l.sanitizeIfNeeded=function(){if(!this.sanitized){if(typeof this.opts.fromLine!="undefined"){const u={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isConcertPitch:this.opts.isConcertPitch,line:this.opts.fromLine};(0,s.default)(this.measureData,u,!0),this.opts.fromPitch=M.default.copy(u.pitch),delete this.opts.fromLine}if(typeof this.opts.toLine!="undefined"){const u={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,isConcertPitch:this.opts.isConcertPitch,line:this.opts.toLine};(0,s.default)(this.measureData,u,!0),this.opts.toPitch=M.default.copy(u.pitch),delete this.opts.toLine}if(this.opts.isConcertPitch){const u={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,isConcertPitch:this.opts.isConcertPitch,pitch:this.opts.fromPitch};(0,o.default)(this.measureData,u),this.opts.fromPitch=M.default.copy(u.pitch);const R={staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,isConcertPitch:this.opts.isConcertPitch,pitch:this.opts.toPitch,accidental:this.opts.accidental};(0,h.default)(this.measureData,R),this.opts.toPitch=M.default.copy(R.pitch),this.opts.accidental=R.accidental,this.opts.isConcertPitch=!1}if(this.isTabStaff()){const u=typeof this.opts.fretData=="undefined"?{}:(0,L.default)(this.opts.fretData),R=this.getNoteAtPitch();if(typeof R!="undefined"&&A.default.hasTechnical(R,E.default.STRING)){const S=A.default.getTechnicalContent(R,E.default.STRING);u.lastString=typeof u.lastString=="undefined"?S:u.lastString}this.opts.fretData=u}this.sanitized=!0}},l.isTabStaff=function(){return(0,n.default)(this.measureData,this.opts)},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.getActions().forEach(this.callPerform,this)},l.callPerform=function(u){u.cancelStack=this.cancelStack,u.perform()},l.getActions=function(){const u=[this.getAddAction(),this.getRemoveAction()];if(this.hasLeftGlissandos()){const R=this.getLeftGlissandoActions();Array.prototype.push.apply(u,R)}if(this.hasRightGlissandos()){const R=this.getRightGlissandoActions();Array.prototype.push.apply(u,R)}if(this.hasLeftSlides()){const R=this.getLeftSlideActions();Array.prototype.push.apply(u,R)}if(this.hasRightSlides()){const R=this.getRightSlideActions();Array.prototype.push.apply(u,R)}if(this.opts.preserveColor&&this.hasColor()){const R=this.getColorAction();u.push(R)}return u},l.getAddAction=function(){if(this.addAction===null){const u=f.copyAddOpts(this.opts);this.addAction=new C.default(this.measureData,u,this.cancelStack)}return this.addAction},l.getRemoveAction=function(){if(this.removeAction===null){const u=f.copyRemoveOpts(this.opts);this.removeAction=new W.default(this.measureData,u,this.cancelStack)}return this.removeAction},l.hasLeftGlissandos=function(){const u=this.getNoteAtPitch();return A.default.hasGlissandoType(u,I.default.STOP)},l.getLeftGlissandoActions=function(){const u=this.getNoteAtPitch(),R=A.default.getGlissandosType(u,I.default.STOP),K=this.getLeftCrossMeasure().getLeftChord(),B=[];return R.forEach(function(N){const y=U.default.getNumber(N);K.forEach(function(k){if(A.default.hasGlissando(k,I.default.START,y)){const V=A.default.getPitch(k),G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1,leftPitch:M.default.copy(V),rightPitch:M.default.copy(this.opts.toPitch),number:y},z=new T.default(this.measureData,G,this,this.cancelStack);B.push(z)}},this)},this),B},l.hasRightGlissandos=function(){const u=this.getNoteAtPitch();return A.default.hasGlissandoType(u,I.default.START)},l.getRightGlissandoActions=function(){const u=this.getNoteAtPitch(),R=A.default.getGlissandosType(u,I.default.START),K=this.getRightCrossMeasure().getRightChord(),B=[];return R.forEach(function(N){const y=U.default.getNumber(N);K.forEach(function(k){if(A.default.hasGlissando(k,I.default.STOP,y)){const V=A.default.getPitch(k),G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:M.default.copy(this.opts.toPitch),rightPitch:M.default.copy(V),number:y},z=new T.default(this.measureData,G,this,this.cancelStack);B.push(z)}},this)},this),B},l.hasLeftSlides=function(){const u=this.getNoteAtPitch();return A.default.hasSlideStop(u)},l.getLeftSlideActions=function(){const u=this.getNoteAtPitch(),R=A.default.getSlideStops(u),K=this.getLeftCrossMeasure().getLeftChord(),B=[];return R.forEach(function(N){const y=O.default.getNumber(N);K.forEach(function(k){if(A.default.hasSlideStart(k)&&O.default.getNumber(A.default.getSlideStarts(k))===y){const V=A.default.getPitch(k),G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1,leftPitch:M.default.copy(V),rightPitch:M.default.copy(this.opts.toPitch)},z=new D.default(this.measureData,G,this,this.cancelStack);B.push(z)}},this)},this),B},l.hasRightSlides=function(){const u=this.getNoteAtPitch();return A.default.hasSlideStart(u)},l.getRightSlideActions=function(){const u=this.getNoteAtPitch(),R=A.default.getSlideStarts(u),K=this.getRightCrossMeasure().getRightChord(),B=[];return R.forEach(function(N){const y=O.default.getNumber(N);K.forEach(function(k){if(A.default.hasSlideStop(k)&&O.default.getNumber(A.default.getSlideStops(k))===y){const V=A.default.getPitch(k),G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,leftPitch:M.default.copy(this.opts.toPitch),rightPitch:M.default.copy(V)},z=new D.default(this.measureData,G,this,this.cancelStack);B.push(z)}},this)},this),B},l.hasColor=function(){const u=this.getNoteAtPitch();return A.default.hasColor(u)},l.getColorAction=function(){const u=this.getNoteAtPitch(),R=A.default.getColor(u),S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:M.default.copy(this.opts.toPitch),color:R};return new v.default(this.measureData,S,this.cancelStack)},l.getRightCrossMeasure=function(){return this.rightCrossMeasure===null&&(this.rightCrossMeasure=new e.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)),this.rightCrossMeasure},l.getLeftCrossMeasure=function(){return this.leftCrossMeasure===null&&(this.leftCrossMeasure=new e.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1)),this.leftCrossMeasure},l.getNoteAtPitch=function(){if(this.noteAtPitch===null){const u=this.measureData.getVoice(this.opts.voiceIdx);this.noteAtPitch=(0,i.default)(u,this.opts.noteIdx,this.opts.fromPitch)}return this.noteAtPitch},l.storeAction=function(){if(!this.cancelStack.hasAction()){const u=this.getLocation(),R=this.getRemoveAction(),S=M.default.copyWithoutAlter(R.opts.pitch),K=this.getAddAction(),B=M.default.copyWithoutAlter(K.opts.pitch),N={partUuid:u.partUuid,measureUuid:u.measureUuid,voiceUuid:u.voiceUuid,staffUuid:u.staffUuid,timePos:u.timePos,divisions:u.dpq,accidental:this.opts.accidental,fromPitch:S,toPitch:B,checkLine:this.opts.checkLine,preserveColor:!!this.opts.preserveColor};typeof this.opts.fretData!="undefined"&&(N.fretData=(0,L.default)(this.opts.fretData));const y={actionName:this.name,opts:N};this.cancelStack.storeAction(y)}},l.getLocation=function(){if(this.location===null){const u=this.measureData.getScoreData(),R=u.getPartUuid(this.opts.partIdx),S=u.getMeasureUuid(this.opts.measureIdx),K=u.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx),B=u.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),N=this.measureData.getDpqValue(),k=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:R,measureUuid:S,staffUuid:K,voiceUuid:B,dpq:N,timePos:k}}return this.location},(0,p.default)(f);const P=f},955832:(j,x,t)=>{t.r(x),t.d(x,{default:()=>n});var C=t(31278),W=t(195446),T=t(160814),D=t(476943),v=t(737903),M=t(123491),A=t(351277),U=t(967104),O=t(322107),L=t(52275),E=t(704621),I=t(981801),g=t(783177),m=t(898039),d=t(287296),a=t(793317),r=t(575349),c=t(42651);const s=function(e,o,h){this.init(e,o,h)};s.NAME="action.RemovePreBend",s.isNoChange=function(e){return e instanceof C.default};const i=s.prototype;i.name=s.NAME,i.initMeasureData=a.default,i.init=function(e,o,h){(0,L.default)(e,o),(0,E.default)(e,o),(0,I.default)(e,o),(0,g.default)(e,o),this.initMeasureData(e,o),this.cancelStack=h,this.opts=o,this.noteHead=null,this.voice=null,this.location=null},i.checkPreconditions=function(){A.default.check(this.opts.pitch),this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,m.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),this.sanitizeIfNeeded(),this.checkNoteAtPitchFret(),this.checkHasBend()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new W.default},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.sanitizeIfNeeded=function(){this.opts.isConcertPitch&&(0,d.default)(this.measureData,this.opts)},i.checkNoteAtPitchFret=function(){if(typeof this.getNoteAtPitchFret()=="undefined"){const o=A.default.copy(this.opts.pitch),h=(0,v.default)(this.opts.fretData);throw new T.A(o,h)}},i.checkHasBend=function(){const e=this.getNoteAtPitchFret();if(!M.default.hasPreBend(e))throw new C.default},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e=this.getPreviousData();this.removePreBend(),this.updateStack(e)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),o={partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,divisions:e.dpq,timePos:e.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData),isConcertPitch:!1},h={actionName:this.name,opts:o};this.cancelStack.storeAction(h)}},i.getPreviousData=function(){const e=this.getNoteAtPitchFret(),o=M.default.getPreBend(e);return{alter:U.A.getAlter(o)}},i.getNoteAtPitchFret=function(){if(this.noteHead===null){let o=this.getVoice().getChord(this.opts.noteIdx);o=D.default.makeArray(o),this.noteHead=o.find(r.A,this.opts)}return this.noteHead},i.removePreBend=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copy(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData)};new O.A(this.measureData,e,this.cancelStack).perform()},i.updateStack=function({alter:e}){const o=this.getLocation(),h={partUuid:o.partUuid,measureUuid:o.measureUuid,voiceUuid:o.voiceUuid,divisions:o.dpq,timePos:o.timePos,pitch:A.default.copyWithoutAlter(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData),alter:e},_={type:this.name,noDraw:!0,opts:h};this.cancelStack.push(_)},i.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),o=e.getPartUuid(this.opts.partIdx),h=e.getMeasureUuid(this.opts.measureIdx),_=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),p=this.measureData.getDpqValue(),l=this.getVoice().getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:h,voiceUuid:_,dpq:p,timePos:l}}return this.location},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,c.default)(s);const n=s},985623:(j,x,t)=>{t.r(x),t.d(x,{default:()=>o});var C=t(195446),W=t(748803),T=t(632879),D=t(569445),v=t(31278),M=t(123491),A=t(351277),U=t(476943),O=t(377180),L=t(679725),E=t(898039),I=t(52275),g=t(704621),m=t(981801),d=t(519405),a=t(509319),r=t(793317),c=t(42651);const s=function(h,_,p){this.init(h,_,p)};s.NAME="action.TransposeChord";const i=s.prototype;i.name=s.NAME,i.initMeasureData=r.default,i.init=function(h,_,p){(0,I.default)(h,_),(0,g.default)(h,_),(0,m.default)(h,_),this.initMeasureData(h,_),this.cancelStack=p,this.opts=_,this.sanitized=!1,this.voice=null,this.wrappedActions=null,this.location=null},i.checkPreconditions=function(){if(this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,E.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkNotRest(),O.default.check(this.opts.transpose),this.sanitizeIfNeeded(),O.default.isIdentity(this.opts.transpose))throw new v.default;const h=this.getWrappedActions();if(!h.some(n))throw h[0].error};const n=function(h){try{h.action.checkPreconditions()}catch(_){if(e(_))return h.checked=!0,h.error=_,!1;throw _}return h.checked=!0,!0};i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new C.default},i.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},i.checkNotRest=function(){this.getVoice().checkNotRest(this.opts.noteIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),(0,E.default)(this.measureData,this.opts),this.sanitizeIfNeeded(),this.storeAction(),this.getWrappedActions().forEach(this.callPerform,this)},i.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.checkLine=="undefined"&&(this.opts.checkLine=!0),this.sanitized=!0)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const h=this.getLocation(),_=O.default.copy(this.opts.transpose),p={partUuid:h.partUuid,measureUuid:h.measureUuid,voiceUuid:h.voiceUuid,divisions:h.dpq,timePos:h.timePos,transpose:_,checkLine:this.opts.checkLine,preserveColor:!!this.opts.preserveColor},f={actionName:this.name,opts:p};this.cancelStack.storeAction(f)}},i.getLocation=function(){if(this.location===null){const h=this.measureData.getScoreData(),_=h.getPartUuid(this.opts.partIdx),p=h.getMeasureUuid(this.opts.measureIdx),f=h.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),l=this.measureData.getDpqValue(),u=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:_,measureUuid:p,voiceUuid:f,dpq:l,timePos:u}}return this.location},i.getWrappedActions=function(){return this.wrappedActions===null&&this.createWrappedActions(),this.wrappedActions},i.createWrappedActions=function(){let _=this.getVoice().getChord(this.opts.noteIdx);_=U.default.makeArray(_);let p=_.map(M.default.getPitch);p=(0,a.A)(p,this.opts.transpose),this.wrappedActions=p.map(this.createWrappedAction,this)},i.createWrappedAction=function(h){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:A.default.copyWithoutAlter(h),transpose:O.default.copy(this.opts.transpose),checkLine:this.opts.checkLine,preserveColor:this.opts.preserveColor},p=null;return{action:new L.default(this.measureData,_,p),error:null,checked:!1}},i.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},i.callPerform=function(h){h.error===null&&(h.action.cancelStack=this.cancelStack,h.checked?h.action.perform():(0,d.default)(h.action,e))};const e=function(h){return h instanceof W.default||h instanceof T.A||h instanceof D.A||h instanceof v.default};(0,c.default)(s);const o=s}}]);})();


//# debugId=911a6cf2-eb30-5269-bef0-d2e35aa0867c
