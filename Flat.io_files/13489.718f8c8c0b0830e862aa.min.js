"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="ccd39c15-7ffd-57c5-87d8-64d33eae450a")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[13489],{163266:(tt,V,f)=>{f.d(V,{A:()=>L});var U=f(669038);function L(R,F){const C=F.partUuid;if(R.hasPartUuid(C))return R.getPartIdxFromUuid(C);throw new U.A(C,U.A.GET)}},514263:(tt,V,f)=>{f.d(V,{A:()=>L});var U=f(483139);function L(R,F){const C=F.measureUuid;if(R.hasMeasureUuid(C))return R.getMeasureIdxFromUuid(C);throw new U.A(C,U.A.GET)}},614653:(tt,V,f)=>{f.r(V),f.d(V,{default:()=>v});var U=f(863023),L=f(360700),R=f(309617),F=Object.defineProperty,C=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,g=(d,T,A)=>T in d?F(d,T,{enumerable:!0,configurable:!0,writable:!0,value:A}):d[T]=A,w=(d,T)=>{for(var A in T||(T={}))j.call(T,A)&&g(d,A,T[A]);if(C)for(var A of C(T))I.call(T,A)&&g(d,A,T[A]);return d};function M(d){return R.A.isJazz(d)?U.A.isValidJazz(d):R.A.isClassic(d)?L.A.isValidClassic(d):!1}const v=w(w(w({isSupported:M},U.A),L.A),R.A)},615542:(tt,V,f)=>{f.d(V,{A:()=>L});var U=f(514263);function L(R,F){const C=(0,U.A)(R,F),j=R.getNbMeasures();return C===j-1}},627300:(tt,V,f)=>{f.r(V),f.d(V,{default:()=>v});var U=f(101561),L=f(760890),R=f(300152),F=f(985492),C=f(351277),j=f(595382),I=f(364596);const g={},w=["A","B","C","D","E","F","G"],M=I.default.createC();g.applyCapo=function(d,T){let A=g.toPitch(d);for(let Q=0;Q<T;Q++)A=j.A.shiftHalfToneUp(A,M);return d=g.fromPitch(A),d},g.hasLine=function(d){return typeof d.$line!="undefined"},g.hasTuningStep=function(d){return g.hasStep(d)},g.hasTuningOctave=function(d){return g.hasOctave(d)},g.hasTuningAlter=function(d){return g.hasAlter(d)},g.hasStep=function(d){return typeof d["tuning-step"]!="undefined"},g.hasOctave=function(d){return typeof d["tuning-octave"]!="undefined"},g.hasAlter=function(d){return typeof d["tuning-alter"]!="undefined"},g.getLine=function(d){const T=g.getLineStr(d);return parseInt(T,10)-1},g.getLineStr=function(d){return d.$line},g.getTuningStep=function(d){return g.getStep(d)},g.getTuningOctave=function(d){return g.getOctave(d)},g.getTuningAlter=function(d){return g.getAlter(d)},g.stringify=function(d){const T=g.getStep(d),A=g.getOctave(d),Q=g.getAlter(d);return`${T}/${A}/${Q}`},g.unstringify=function(d){const[T,A,Q]=d.split("/");return g.create(T,A,Q)},g.setStep=function(d,T){d["tuning-step"]=T},g.getStep=function(d){return d["tuning-step"]},g.getOctave=function(d){return parseInt(d["tuning-octave"],10)},g.setOctave=function(d,T){d["tuning-octave"]=T.toString()},g.setAlter=function(d,T){d["tuning-alter"]=T.toString()},g.getAlter=function(d){return parseInt(d["tuning-alter"],10)||0},g.setLine=function(d,T){d.$line=`${T+1}`},g.setTuningStep=function(d,T){d["tuning-step"]=T},g.setTuningOctave=function(d,T){d["tuning-octave"]=T},g.setTuningAlter=function(d,T){d["tuning-alter"]=T},g.create=function(d,T,A){const Q={"tuning-step":d,"tuning-octave":T},x=A||0;return g.setTuningAlter(Q,x),Q},g.copy=function(d){const T=g.getStep(d),A=g.getOctave(d),Q=g.getAlter(d);return g.create(T,A,Q)},g.isSame=function(d,T){return g.getStep(d)===g.getStep(T)&&g.getOctave(d)===g.getOctave(T)&&g.getAlter(d)===g.getAlter(T)},g.check=function(d){g.hasLine(d)&&g.checkLine(d),g.hasAlter(d)&&g.checkTuningAlter(d),g.checkTuningStep(d),g.checkTuningOctave(d)},g.checkTuningOctave=function(d){const T=g.getOctave(d);if(!g.isTuningOctaveValid(T))throw new R.A(T)},g.checkTuningStep=function(d){const T=g.getStep(d);if(!w.includes(T))throw new L.A(T)},g.checkLine=function(d){const T=g.getLine(d);if(!g.isLineValid(T))throw new U.A(T+1)},g.checkTuningAlter=function(d){const T=g.getAlter(d);if(!g.isTuningAlterValid(T))throw new F.A(T)},g.isTuningOctaveValid=function(d){return!Number.isNaN(d)&&d>=0&&d<=9},g.isLineValid=function(d){return!Number.isNaN(d)&&d>=0&&d<=5},g.isTuningAlterValid=function(d){return!Number.isNaN(d)&&d>=-2&&d<=2},g.toPitch=function(d){const T=g.getOctave(d),A=g.getStep(d),Q=g.getAlter(d);return C.default.create(T,A,Q)},g.fromPitch=function(d){const T=C.default.getStep(d),A=C.default.getOctave(d),Q=C.default.getAlter(d);return g.create(T,A,Q)};const v=g},743475:(tt,V,f)=>{f.r(V),f.d(V,{default:()=>I});var U=f(843678),L=f(614653),R=f(681670),F=f(351277),C=f(377180),j=f(544321);function I(A){const Q=(0,j.Ay)(A),x=g(Q);if(!L.default.hasBass(A))return x;const rt=L.default.getBass(A),nt=v(rt),S=x.findIndex(d,nt);if(S<0)return null;const D=x.slice(0,S),W=x.slice(S);return[].concat(W,D)}function g(A){const Q=U.default.toPairs(A);return Q.sort(w),Q.map(M)}function w(A,Q){const x=parseInt(A.key,10),rt=parseInt(Q.key,10);return x-rt}function M(A){return A.value}function v(A){const Q=R.A.getStep(A),x=R.A.getAlter(A);return T({step:Q,alter:x})}function d(A){const Q=this.valueOf();return T(A)===Q}function T(A){const Q=F.default.create(4,"C"),x=F.default.create(4,A.step,A.alter),rt=F.default.getTransposeDiff(x,Q);let nt=C.default.getChromatic(rt);return nt<0&&(nt+=C.default.NB_CHROMATIC),nt}},818873:(tt,V,f)=>{f.d(V,{A:()=>C});var U=f(364842),L=f(514263),R=f(963202),F=f(883325);function C(I,g,w){const M=(0,L.A)(I,g),v=(0,L.A)(I,w),d=M-v;if(d!==0)return d;const T=j(I,g),A=j(I,w);if(T>A)return 1;if(T<A)return-1;if(T===A)return 0;throw new U.default("Unreachable")}function j(I,g){const w=(0,R.A)(I,g),M=w.getDpqValue(),v=(0,F.A)(I,g);return w.getVoice(v).getRangeSpace(0,g.noteIdx)/M}},902630:(tt,V,f)=>{f.r(V),f.d(V,{default:()=>nt});var U=f(447597),L=f(752512),R=f(764644),F=f(858375),C=f(485437),j=f(564004),I=f(365340),g=f(726042),w=f(171882),M=f(843678);const v={};v.check=function(S){const D=v.getNbStrings(S);v.checkNbStrings(D);const W=v.getNbFrets(S);v.checkNbFrets(W);const Y=v.getFirstFret(S);v.checkFirstFret(Y);const ot={usedStrings:{},nbStrings:D,nbFrets:W,firstFret:Y};v.getNotes(S).forEach(d,ot)},v.checkNbStrings=function(S){if(!v.isNbStringsValid(S))throw new U.A(S)},v.isNbStringsValid=function(S){return g.default.isInteger(S)&&S>=1},v.checkNbFrets=function(S){if(!v.isNbFretsValid(S))throw new C.A(S)},v.isNbFretsValid=function(S){return g.default.isInteger(S)&&S>=1},v.checkFirstFret=function(S){if(!v.isValidFirstFret(S))throw new L.A(S)},v.isValidFirstFret=function(S){return g.default.isInteger(S)&&S>=1};function d(S){const D=this,W=w.A.getString(S);T(W,D),D.usedStrings[W]=!0;const Y=w.A.getFret(S);x(Y,D)}function T(S,D){if(!A(S,D))throw new R.A(S);if(Q(S,D))throw new F.A(S)}function A(S,D){return g.default.isInteger(S)&&S>=1&&S<=D.nbStrings}function Q(S,D){return typeof D.usedStrings[S]!="undefined"}function x(S,D){if(!rt(S,D))throw new j.A(S)}function rt(S,D){return g.default.isInteger(S)&&S+1-D.firstFret<=D.nbFrets&&S>=D.firstFret||S===0}v.isSame=function(S,D){const W=v.getNbStrings(S),Y=v.getNbStrings(D);if(W!==Y)return!1;const ot=v.getNbFrets(S),Mt=v.getNbFrets(D);if(ot!==Mt)return!1;const Ot=v.getFirstFret(S),Xt=v.getFirstFret(D);if(Ot!==Xt)return!1;const Nt=v.getNotes(S),Et=v.getNotes(D);if(Nt.length!==Et.length)return!1;const vt=M.default.fromList(Nt,w.A.getString),Dt=M.default.fromList(Et,w.A.getString);for(const Vt in vt){const Ut=vt[Vt],gt=Dt[Vt];if(typeof gt=="undefined"||!w.A.isSame(Ut,gt))return!1}return!0},v.getNbStrings=function(S){return parseInt(S["frame-strings"],10)},v.getNbFrets=function(S){return parseInt(S["frame-frets"],10)},v.getFirstFret=function(S){const D=S["first-fret"];return typeof D=="undefined"?1:I.default.hasNumberOrContent(D)?I.default.numberOrContent(D):parseInt(D,10)},v.getNotes=function(S){return I.default.getArray(S,"frame-note")},v.copy=function(S){const D=v.getNbStrings(S),W=v.getNbFrets(S),Y=v.getFirstFret(S),Mt=v.getNotes(S).map(w.A.copy);return v.create(D,W,Y,Mt)},v.create=function(S,D,W,Y){const ot={"frame-strings":S.toString(),"frame-frets":D.toString()};return W!==1&&(ot["first-fret"]=W.toString()),Y.length>0&&(ot["frame-note"]=Y),ot};const nt=v},923595:(tt,V,f)=>{f.d(V,{A:()=>C});var U=f(163266),L=f(514263),R=f(883325),F=f(832560);function C(j,I){const g=(0,U.A)(j,I),w=(0,L.A)(j,I),M=(0,R.A)(j,I),v=j.getMeasure(g,w),T=new F.A(v).getVoice(M);T.checkNoteIdx(I.noteIdx),typeof I.graceIdx!="undefined"&&T.checkGraceIdx(I.noteIdx,I.graceIdx)}},944115:(tt,V,f)=>{f.d(V,{A:()=>j});var U=f(163266),L=f(514263),R=f(883325),F=f(923595),C=f(832560);function j(I,g){(0,F.A)(I,g);const w=(0,U.A)(I,g),M=(0,L.A)(I,g),v=(0,R.A)(I,g),d=I.getMeasure(w,M),A=new C.A(d).getVoice(v);if(typeof g.graceIdx!="undefined")return!1;const Q=A.getNbNotes();return g.noteIdx===Q-1}},955154:(tt,V,f)=>{f.r(V),f.d(V,{default:()=>v});var U=f(364842),L=f(287331);const R="natural-touching",F="natural-sounding",C="artificial-base",j="artificial-touching",I=[R,F,j];function g(d){if(!w(d))throw new L.A(d)}function w(d){return I.includes(d)}function M(d){const T=`The harmonic type value: [${d}] is invalid.`;throw new U.default("BadHarmonicTypeError",T)}const v={NATURAL_TOUCHING:R,NATURAL_SOUNDING:F,ARTIFICIAL_BASE:C,ARTIFICIAL_TOUCHING:j,values:I,check:g,isValid:w,raiseError:M}},997512:(tt,V,f)=>{f.d(V,{gk:()=>$u});var U={};f.r(U),f.d(U,{default:()=>Au});function L(t,e){const r=t-e.quarterPosition;if(!e.spqAcceleration||t===e.quarterPosition)return e.time+r*e.spq;const n=e.spqAcceleration,o=e.time,{spq:a}=e;return .5*n*(r*r)+a*r+o}function R(t,e){const r=t-e.time;if(!e.spqAcceleration||t===e.time)return e.quarterPosition+r/e.spq;const n=r,o=e.spq,a=e.spqAcceleration,s=o*o+2*a*n,c=(Math.sqrt(s)-o)/a,l=e.quarterPosition;return c+l}class F{constructor(e,r){Object.defineProperty(this,"timeEntries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.timeEntries=e,this.lastTime=r}quarterToSeconds(e){const r=this.getTimeEntryAtQuarter(e);return L(e,r)}quarterDurationToSecondsAtQuarter(e,r){const n=this.quarterToSeconds(e);return this.quarterToSeconds(e+r)-n}secondsDurationToQuarterAtQuarter(e,r){const n=this.quarterToSeconds(e);return this.secondsToQuarter(n+r)-e}getTimeEntryAtQuarter(e){this.checkQuarterPosition(e);const r=this.timeEntries.findIndex(n=>n.quarterPosition>e);return r<0?this.timeEntries[this.timeEntries.length-1]:this.timeEntries[r-1]}checkQuarterPosition(e){if(e<0)throw new Error(`Invalid QuarterPosition <${e}>.`)}secondsToQuarter(e){const r=this.getTimeEntryAtSeconds(e);return R(e,r)}getTimeEntryAtSeconds(e){this.checkSecondsPosition(e);const r=this.timeEntries.findIndex(n=>n.time>e);return r<0?this.timeEntries[this.timeEntries.length-1]:this.timeEntries[r-1]}checkSecondsPosition(e){if(e<0)throw new Error(`Invalid SecondsPosition <${e}>.`)}getSecondsDuration(){return this.lastTime}}function C({tempoMapping:t,quarterMapping:e}){const r=t.getTemposList();let n=0,o;const a=r.map((c,l)=>{l>0&&(n=L(c.quarterPosition,o));const{quarterPosition:p,spq:m,spqAcceleration:h}=c,_={time:n,quarterPosition:p,spq:m};return typeof h!="undefined"&&(_.spqAcceleration=h),o=_,_}),s=a[a.length-1],i=e.getQuarterDuration(),u=L(i,s);return{timeList:a,lastTime:u}}function j(t,e){const{timeList:r,lastTime:n}=C({tempoMapping:t,quarterMapping:e});return new F(r,n)}class I{constructor(e){Object.defineProperty(this,"temposList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.temposList=e}getSpqAtQuarter(e,r=!1){const n=this.getTempoEntryAtQuarter(e);if(!r||!n.spqAcceleration)return n.spq;const o=e-n.quarterPosition;return o===0?n.spq:n.spq+n.spqAcceleration*o}getTempoEntryAtQuarter(e){this.checkQuarterPosition(e);const r=this.temposList.findIndex(n=>n.quarterPosition>e);return r<0?this.temposList[this.temposList.length-1]:this.temposList[r-1]}checkQuarterPosition(e){if(e<0)throw new Error(`Invalid QuarterPosition <${e}>.`)}getTemposList(){return this.temposList.slice()}}var g=f(110976),w=f(476943),M=f(123491),v=f(701387),d=f(515819),T=f(952818),A=f(601277),Q=f(832560),x;(function(t){t.ACCELERANDO="accelerando",t.RITARDANDO="ritardando",t.STOP_SPQ_CHANGE="stopSpqChange",t.FERMATA="fermata",t.STOP_FERMATA="stopFermata"})(x||(x={}));function rt(t,e){const r=t.getCommonContent(),n=r.getNbMeasures(),o=[],a=new Map;for(let u=0;u<n;u++){const c=r.getTempo(u),l=g.default.getQpm(c);o.push(l);const p=D(t,u);p.length&&a.set(u,p)}const s=nt(t,r,e,o),i=Mt(s,a);return{measuresQpms:o,tempoModifications:i}}function nt(t,e,r,n){const a=t.getPartMeasures(0),s=new Map;let i=null;return a.forEach((u,c)=>{const l=c>0&&n[c]!==n[c-1],p=v.default.getDpq(u),m=e.getTempoChanges(c),h=[];if(l&&i!==null){const _=i.type,y=S(c,p,x.STOP_SPQ_CHANGE,0,r,i);h.push(y);const P=S(c,p,_,0,r);h.push(P),i=P}m.length&&h.push(...m.map(_=>{let y=T.A.getTempoChangeType(_);y==="stop"&&(y=x.STOP_SPQ_CHANGE);const P=T.A.getTimePos(_),b=S(c,p,y,P,r,i);return b.type===x.STOP_SPQ_CHANGE?i=null:i=b,b})),h.length>0&&s.set(c,h)}),s}function S(t,e,r,n,o,a){var s;const i=o.getMeasuresList()[t],u=d.default.divisionsToQuarter(n,e),c=i+u;return a&&r===x.STOP_SPQ_CHANGE&&(a.duration=c-((s=a.absoluteQuarter)!=null?s:0)),{absoluteQuarter:c,relativeQuarter:u,type:r}}function D(t,e){const r=[],n=t.getNbParts();for(let s=0;s<n;s++){const i=t.getMeasure(s,e),u=new Q.A(i),c=u.getDpqValue();u.getVoicesIndexes().forEach(p=>{r.push(...W(u,c,p))})}const o=Y(r);return ot(o)}function W(t,e,r){const n=[],o=t.getVoice(r),a=o.getNbNotes();let s=0;for(let i=0;i<a;i++){let u=o.getChord(i);u=w.default.makeArray(u);const[c]=u,l=M.default.getDuration(c);if(M.default.hasNotation(c,A.default.FERMATA)){const p=d.default.divisionsToQuarter(s,e),m=d.default.divisionsToQuarter(l,e),h=p+m;n.push({fromQuarter:p,toQuarter:h})}s+=l}return n}function Y(t){if(t.length<=0)return[];const e=[];t.sort((r,n)=>r.fromQuarter-n.fromQuarter),e.push(t[0]);for(let r=1;r<t.length;r++){const n=e[e.length-1];n.toQuarter<t[r].fromQuarter?e.push(t[r]):n.toQuarter<t[r].toQuarter&&(n.toQuarter=t[r].toQuarter)}return e}function ot(t){const e=[];return t.forEach(r=>{e.push({relativeQuarter:r.fromQuarter,type:x.FERMATA},{relativeQuarter:r.toQuarter,type:x.STOP_FERMATA})}),e}function Mt(t,e){const r=[...t.entries(),...e.entries()].reduce((o,[a,s])=>{const i=Number(a);o.has(i)||o.set(i,[]);const u=o.get(i);return typeof u=="undefined"||u.push(...s),o},new Map),n=new Map;return Array.from(r).forEach(([o,a])=>{n.set(o,a.sort((s,i)=>s.relativeQuarter-i.relativeQuarter))}),n}function Ot(t){return 1/(t/60)}function Xt(t){return 1/t*60}const Nt=500,Et=1,vt=500,Dt=30;function Vt(t){return t>Nt?Nt:t<Et?Et:Math.round(t)}const Ut=Vt,gt=2,mn=1/.75,gn=.75;function hn(t,{quarterMapping:e,scoreQuarterMapping:r,playOrder:n}){const o=e.getMeasuresList(),a=e.lastQuarterPosition;let s;const i=[];return o.forEach((u,c)=>{const l=n.audioToScoreMeasureIdx(c),p=c!==0&&t.measuresQpms[l-1],m=t.measuresQpms[l],h=Ot(m);(c===0||p!==m)&&(s=h,i.push({quarterPosition:u,spq:s}));const y=t.tempoModifications.has(l)?t.tempoModifications.get(l):[];if(y.length===0)return;const P=_n(i,y,r,t,u);s=P!=null?P:s}),vn(i,a)}function _n(t,e,r,n,o){function a(i,u,c){const l=i.duration+c,p=Mn(u.spq,c,l,r,n,i.type),h=(Ot(p)-u.spq)/i.duration,_={quarterPosition:c,spq:u.spq,spqAcceleration:h};t.push(_)}const s={stopSpqChange:(i,u,c)=>{const l=te(c,u),p={quarterPosition:c,spq:l};t.push(p)},stopFermata:(i,u,c)=>{const l=te(c,u)/gt,p={quarterPosition:c,spq:l};u.spqAcceleration&&(p.spqAcceleration=u.spqAcceleration/gt),t.push(p)},fermata:(i,u,c)=>{const l=te(c,u)*gt,p={quarterPosition:c,spq:l};u.spqAcceleration&&(p.spqAcceleration=u.spqAcceleration*gt),t.push(p)},accelerando:a,ritardando:a};return e.forEach(i=>{const u=i.relativeQuarter+o;if(i.duration===0)return;const c=t[t.length-1];if(!c)throw new Error("there should be an entry beforehand at this point");const l=s[i.type];l&&l(i,c,u)}),t[t.length-1].spq}function te(t,e){const{spqAcceleration:r,spq:n}=e;if(r){const o=t-e.quarterPosition;return n+o*r}return n}function Mn(t,e,r,n,o,a){const s=n.quarterToMeasureIdx(e);let i=n.quarterToMeasureIdx(r);n.measureIdxToQuarter(i)!==r&&i!==n.getMeasuresList().length-1&&(i+=1);const c=o.measuresQpms[s],l=o.measuresQpms[i];if(c!==l&&!(l>c&&a===x.RITARDANDO)&&!(l<c&&a===x.ACCELERANDO))return l;const p=Xt(t);if(a===x.ACCELERANDO){const m=Ut(p*mn);return p>vt?p:m>vt?vt:m}if(a===x.RITARDANDO){const m=Ut(p*gn);return p<Dt?p:m<Dt?Dt:m}return p}function vn(t,e){return t.filter((r,n)=>{if(r.quarterPosition===e)return!1;if(n===t.length-1)return!0;const a=t[n+1];return r.quarterPosition!==a.quarterPosition})}function yn(t,{quarterMapping:e,scoreQuarterMapping:r,playOrder:n}){const o=rt(t,r),a=hn(o,{quarterMapping:e,scoreQuarterMapping:r,playOrder:n});return new I(a)}function Tn(t,e){let r=0;return{measuresList:e.getMeasuresList().map(o=>{const a=r,s=t.measuresQuarterDurations[o];return r+=s,a}),lastQuarterPosition:r}}class Pn{constructor(e,r){Object.defineProperty(this,"measuresList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastQuarterPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.measuresList=e,this.lastQuarterPosition=r}getRelativeQuarterPosition(e,r){const n=this.measuresList[e];return r-n}quarterToMeasureIdx(e){this.checkQuarterPosition(e);const r=this.measuresList.findIndex(n=>n>e);return r===-1?this.measuresList.length-1:r-1}measureIdxToQuarter(e){return this.checkMeasureIdx(e),this.measuresList[e]}getQuarterDuration(){return this.lastQuarterPosition}checkQuarterPosition(e){if(e<0)throw new Error(`Invalid QuarterPosition <${e}>.`)}checkMeasureIdx(e){if(e<0)throw new Error(`Invalid MeasureIndex <${e}>.`)}getMeasuresList(){return this.measuresList.slice()}}function Sn(t){return{measuresQuarterDurations:t.getPartMeasures(0).map(v.default.getQuarterDuration)}}function Oe(t,e){const r=Sn(t),{measuresList:n,lastQuarterPosition:o}=Tn(r,e);return new Pn(n,o)}class bn{constructor(e){Object.defineProperty(this,"measuresList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.measuresList=e}audioToScoreMeasureIdx(e){return this.checkAudioMeasureIdx(e),this.measuresList[e]}scoreToFirstAudioMeasureIdx(e){this.checkScoreMeasureIdx(e);const r=this.measuresList.indexOf(e);if(r===-1)throw new Error(`The ScoreMeasureIdx <${e}> is unfindable in the score.`);return r}getNbMeasures(){return this.measuresList.length}checkScoreMeasureIdx(e){if(!Number.isInteger(e)||e<0)throw new Error(`The ScoreMeasureIdx <${e}> is invalid.`)}checkAudioMeasureIdx(e){if(e<0||e>=this.measuresList.length||!Number.isInteger(e))throw new Error(`The AudioMeasureIdx <${e}> is invalid.`)}getMeasuresList(){return this.measuresList.slice()}}function Lt(t,e){const r=[];for(let n=t;n<=e;n++)r.push(n);return r}function An(t,e,r,n){for(let o=0;o<n;o++)t.push(...Lt(e,r))}function On(t,e,r,n,o){if(o){const a=Array.from(n.endings.values()).pop(),s=a[1]<=r?a[1]:r;t.push(...Lt(a[0],s));return}for(const[a,s]of n.endings){a===n.endings.keys().next().value||t.push(...Lt(e,n.startMeasureIdx-1));const u=s[1]<=r?s[1]:r;t.push(...Lt(s[0],u))}}function Ne(t,e){let r=0;for(let n=t.length-1;n>=0;n--)if(t[n]<=e){r=t[n];break}return r}function Ee(t,e,{backwardRepeats:r,forwardRepeats:n,endingsSets:o},a){const s=[];for(let i=t;i<=e;i++){if(o&&o.has(i)){const u=o.get(i);On(s,Ne(n,i),e,u,a),i=u.endMeasureIdx;continue}s.push(i),typeof r[i]!="undefined"&&!a&&An(s,Ne(n,i),i,r[i].times)}return s}function ee(t,{jumpFromMeasureIdx:e,jumpStartMeasureIdx:r,jumpEndMeasureIdx:n},o,a){const s=t.lastIndexOf(e)+1,i=t.length-s,u=n!=null?n:o.nbScoreMeasures-1,c=Ee(r,u,o,!a);t.splice(s,i),c.indexOf(r)===-1&&t.push(r),t.push(...c),n&&c.indexOf(n)===-1&&t.push(n)}function Nn(t,e,r){const{jumps:n}=e;if(n){if(n.daCapo&&t.indexOf(n.daCapo)>-1){const o={jumpFromMeasureIdx:n.daCapo,jumpStartMeasureIdx:0,jumpEndMeasureIdx:n.fine};ee(t,o,e,r)}else if(n.dalSegno&&n.segno&&t.indexOf(n.dalSegno)>-1){const o={jumpFromMeasureIdx:n.dalSegno,jumpStartMeasureIdx:n.segno,jumpEndMeasureIdx:n.fine};ee(t,o,e,r)}if(n.toCoda&&n.coda&&t.indexOf(n.toCoda)>-1){const o={jumpFromMeasureIdx:n.toCoda,jumpStartMeasureIdx:n.coda};ee(t,o,e,r)}}}function En(t,e){return t.flatMap(r=>e.has(r)?Array(e.get(r)).fill(r):[r])}function Dn(t,e){let r=[];return r.push(...Ee(0,t.nbScoreMeasures-1,t,!1)),Nn(r,t,e),t.multiMeasureRepeats&&t.multiMeasureRepeats.size&&(r=En(r,t.multiMeasureRepeats)),r}var De=f(555172),In=f(269032),yt=f(607801);function Qn(t){return new Map([...t.entries()].sort((e,r)=>e[0]-r[0]))}function Cn(t,e,r){const n=t.size>0&&Array.from(t.values())[t.size-1],o=n&&Array.from(n.endings.keys())[n.endings.size-1],a=e.getEnding(r),s=r!==0&&e.hasEnding(r-1),i=!s&&a.length===1&&o===a[0]-1;if(s||i||t.set(r,{startMeasureIdx:r,endMeasureIdx:r,endings:new Map}),i&&n){const l=n.endings.get(o);n.endings.set(o,[l[0],r-1])}const c=Array.from(t.values())[t.size-1];c.endMeasureIdx=r,a.forEach(l=>{if(!c.endings.has(l))c.endings.set(l,[r,r]);else{const m=c.endings.get(l);m[1]=r,c.endings.set(l,m)}}),c.endings=Qn(c.endings)}function wn(t){const e=v.default.getBarlines(t).find(De.A.hasRepeatBackward),r=De.A.getRepeat(e);return{times:In.A.getNbRepeat(r)}}function Rn(t){typeof t.dalSegno!=typeof t.segno&&(delete t.segno,delete t.dalSegno),typeof t.coda!=typeof t.toCoda&&(delete t.toCoda,delete t.coda),typeof t.dalSegno=="number"&&typeof t.segno=="number"&&t.segno>=t.dalSegno&&(delete t.segno,delete t.dalSegno),typeof t.coda=="number"&&typeof t.toCoda=="number"&&t.toCoda>=t.coda&&(delete t.toCoda,delete t.coda),t.dalSegno&&t.daCapo&&(delete t.dalSegno,delete t.segno)}function xn(t){const e=t.getNbMeasures(),r=t.getCommonContent(),n={},o=[],a=new Map,s={},i=new Map;for(let u=0;u<e;u++){const c=t.getMeasure(0,u);if(v.default.hasRepeatBackward(c)){const m=wn(c);n[u]=m}if(v.default.hasRepeatForward(c)&&o.push(u),r.hasMultiMeasureRest(u)){const m=r.getMultiMeasureRest(u);i.set(u,m)}r.hasEnding(u)&&Cn(a,r,u);const l=r.hasJumpCall(u)&&r.getJumpCall(u),p=r.hasJumpTag(u)&&r.getJumpTag(u);p&&p===yt.A.SEGNO&&(s.segno=u),p&&p===yt.A.CODA&&(s.coda=u),l&&l===yt.A.DALSEGNO&&(s.dalSegno=u),l&&l===yt.A.DACAPO&&(s.daCapo=u),l&&l===yt.A.FINE&&(s.fine=u),l&&l===yt.A.TOCODA&&(s.toCoda=u)}return Rn(s),{nbScoreMeasures:e,backwardRepeats:n,forwardRepeats:o,endingsSets:a,jumps:s,multiMeasureRepeats:i}}function Vn(t,e){const r=xn(t),n=Dn(r,e);return new bn(n)}var Un=f(777345);class Ln{constructor(e){Object.defineProperty(this,"swingMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.swingMap=e}hasSwingInScore(){return this.swingMap.size>0}hasSwingAtScoreMeasure(e){return this.checkScoreMeasureIdx(e),this.swingMap.has(e)}getSwingAtScoreMeasure(e){return this.checkScoreMeasureIdx(e),this.swingMap.has(e)?this.swingMap.get(e):null}checkScoreMeasureIdx(e){if(e<0)throw new Error(`Invalid ScoreMeasureIdx <${e}>.`)}}const zn={first:2,second:1,duration:.5};function Fn(t){const e=t.getNbMeasures(),r=new Map;for(let n=0;n<e;n++)if(t.hasSwing(n)){const o=t.getSwing(n);Un.default.isSwinging(o)&&r.set(n,zn)}return r}function Bn(t){const e=Fn(t);return new Ln(e)}class jn{constructor(e){Object.defineProperty(this,"measuresList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.measuresList=e}getNbMeasures(){return this.measuresList.length}getMeasuresList(){return this.measuresList.slice()}}function Gn(t){const e=t.getNbMeasures(),r=[];for(let o=0;o<e;o++)r.push(o);return new jn(r)}var Ie=f(496819),It=f(558280);const X="base",Qt="special",Ct="wedge",re={ppp:X,pp:X,p:X,mp:X,mf:X,f:X,ff:X,fff:X,pf:X,fp:Qt,rfz:Qt,sfz:Qt,crescendo:Ct,diminuendo:Ct};function wt(t,e){return`${t}-${e}`}function Yu(t){const e=t.split("-");return{partIdx:Number(e[0]),staffIdx:Number(e[1])}}var kn=Object.defineProperty,qn=Object.defineProperties,Hn=Object.getOwnPropertyDescriptors,Qe=Object.getOwnPropertySymbols,Kn=Object.prototype.hasOwnProperty,Wn=Object.prototype.propertyIsEnumerable,Ce=(t,e,r)=>e in t?kn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$n=(t,e)=>{for(var r in e||(e={}))Kn.call(e,r)&&Ce(t,r,e[r]);if(Qe)for(var r of Qe(e))Wn.call(e,r)&&Ce(t,r,e[r]);return t},Jn=(t,e)=>qn(t,Hn(e));function Yn(t,e){const r=t.getNbParts(),n=new Map;for(let o=0;o<r;o++){const a=t.getPartNbStaves(o),s=t.getPartMeasures(o);for(let i=0;i<a;i++){const u=wt(o,i),c=Zn(i,s,e);n.set(u,c)}}return n}function Zn(t,e,r){let n;return e.flatMap((a,s)=>{const i=r.getMeasuresList()[s],u=v.default.getDpq(a),c=Xn(a,t,u,i);let l;return[l,n]=to(n,a,t,u,i),[...c,...l].sort((p,m)=>{const h=p.quarter-m.quarter;return h===0&&p.type===Ct?1:h})})}function Xn(t,e,r,n){return v.default.getDynamics(t,e).map(s=>eo(s,r,n))}function to(t,e,r,n,o){const a=v.default.getWedges(e,r),s=[];return a.forEach(i=>{It.A.isLeft(i)&&!t?t=ro(i,n,o):It.A.isRight(i)&&t&&(s.push(no(t,i,n,o)),t=null)}),[s,t]}function eo(t,e,r){var n;const o=Ie.A.getStyle(t),a=Ie.A.getTimePos(t),s=d.default.divisionsToQuarter(a,e),i=r+s,u=(n=re[o])!=null?n:X;return{quarter:i,type:u,value:o}}function ro(t,e,r){var n;const o=It.A.getType(t),a=It.A.getTimePos(t),s=d.default.divisionsToQuarter(a,e),i=r+s,u=(n=re[o])!=null?n:X;return{quarter:i,type:u,value:o}}function no(t,e,r,n){const o=It.A.getTimePos(e),a=d.default.divisionsToQuarter(o,r),i=n+a-t.quarter;return Jn($n({},t),{duration:i})}const ht=50,oo=30,we={crescendo:1,diminuendo:-1},Re={ppp:9,pp:16,p:25,mp:35,mf:50,f:70,ff:99,fff:127,pf:70},ao="sfz",so=8,xe="fp",ne=[70,25],Ve="rfz",Ue=99,io=4;function uo(t,e,r){const n=t[e],o=n.value,a=Re[o];if(!a)return;const s={base:a};r.push([n.quarter,s])}const Le=uo,oe=1e-4,ae=4,ze=127;var co=Math.pow;function Tt(t){return t>ze?ze:t<ae?ae:Math.round(t)}function zt(t,e){if(e!==0){let r=lo(t);r+=e,t=po(r)}return t}function lo(t){let e=fo(t);return e<.01&&(e=.01),Math.log10(e)*20}function po(t){return mo(co(10,t/20))}function fo(t){return 90/127*t/100}function mo(t){return Math.round(t*100/(90/127))}function go(t,e,r,n){const o=t[e],a=o.value;let s=ht;if(a===xe){let i={base:ne[0]};n.push([o.quarter,i]),s=ne[1],i={base:s};const u=o.quarter+oe;if(r<u)return;n.push([u,i]);return}if(a===Ve){const i=n.length===0?ht:n[n.length-1][1].base,u={base:Ue};n.push([o.quarter,u]);const c=o.quarter+io,l=e<t.length-1?t[e+1].quarter:Number.NaN;if(c<r&&(!l||c<l)){const m={base:i};n.push([c,m])}}if(a===ao){const i=n.length===0?ht:n[n.length-1][1].base;n.push([o.quarter,{base:i,relative:zt(i,so)-i}])}}const ho=go;function _o(t,e,r){const n=t[e],o=r.length!==0&&r[r.length-1];let a=e===t.length-1;const s=o?o[1].base:ht,i=n.duration+n.quarter,u=i-n.quarter;a||Mo(t,e,i),a=e===t.length-1;const c=!a&&t[e+1].type!==Ct&&Math.abs(t[e+1].quarter-i)<=oe,l=c&&vo(t[e+1]);let m=l&&Math.sign(l-s)===Math.sign(we[n.value])?l:s+we[n.value]*oo;m=Tt(m);const h=m-s,_=h/u;if(Math.abs(_)<1)return;o&&Math.abs(o[0]-n.quarter)<=oe?o[1].changePerQuarter=_:r.push([n.quarter,{base:s,changePerQuarter:_}]),c||r.push([i,{base:s+h}])}function Mo(t,e,r){let n=0;for(let o=e+1;o<t.length&&!(t[o].quarter>=r);o++)n++;t.splice(e+1,n)}function vo(t){switch(t.type){case X:return Re[t.value];case Qt:if(t.value===Ve)return Ue;if(t.value===xe)return ne[0];break;default:return ht}return ht}function yo(t,e){const r=new Map;for(const[n,o]of t){const a=To(o,e);r.set(n,a)}return r}function To(t,e){const r=[];for(let n=0;n<t.length;n++)switch(re[t[n].value]){case X:Le(t,n,r);break;case Qt:ho(t,n,e,r);break;case Ct:_o(t,n,r);break;default:Le(t,n,r)}return r}class Po{constructor(e){Object.defineProperty(this,"velocityMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.velocityMap=e}getVelocityAtQuarter(e,r,n){this.checkPartIndex(e),this.checkStaffIndex(r);const o=wt(e,r);this.checkIfPartStaffExists(o);const a=this.velocityMap.get(o),s=this.getVelocityOptions(a,n);return s?this.getVelocityValue(s[1],s[0],n):ht}getVelocityFromTo(e,r,n,o){this.checkPartIndex(e),this.checkStaffIndex(r);const a=wt(e,r);this.checkIfPartStaffExists(a);const s=this.velocityMap.get(a),i=s.filter(([u,c],l)=>{const p=u<o,m=u>n,h=l===s.length-1,_=p&&c.changePerQuarter&&(h||s[l+1][0]>n);return m&&p||_});return i.length?i:null}getVelocityValue(e,r,n){let o=e.base;return e.changePerQuarter&&n!==r&&(o+=(n-r)*e.changePerQuarter),e.relative&&n===r&&(o+=e.relative),Tt(o)}getVelocityOptions(e,r){for(let n=0;n<e.length;n++){const o=e[n][0]===r,a=e[n][0]<r&&(n+1>=e.length||e[n+1][0]>r);if(o||a)return e[n]}return null}checkPartIndex(e){if(e<0)throw new Error(`Invalid partIndex <${e}>.`)}checkStaffIndex(e){if(e<0)throw new Error(`Invalid staffIndex <${e}>.`)}checkIfPartStaffExists(e){if(!this.velocityMap.has(e))throw new Error(`partIndex-staffIndex pair <${e}> is missing in VelocityMapping`)}}function So(t,e){const r=Yn(t,e),n=yo(r,e.lastQuarterPosition);return new Po(n)}class bo{constructor(e){Object.defineProperty(this,"keySignatureMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keySignatureMap=e}getKeySignatureAtScoreMeasure(e,r,n){this.checkScoreMeasureIdx(n),this.checkPartIndex(e),this.checkStaffIndex(r);const o=wt(e,r);return this.checkIfPartStaffExists(o),this.keySignatureMap.get(o)[n]}checkScoreMeasureIdx(e){if(e<0)throw new Error(`Invalid ScoreMeasureIdx <${e}>.`)}checkPartIndex(e){if(e<0)throw new Error(`Invalid partIndex <${e}>.`)}checkStaffIndex(e){if(e<0)throw new Error(`Invalid staffIndex <${e}>.`)}checkIfPartStaffExists(e){if(!this.keySignatureMap.has(e))throw new Error(`partIndex-staffIndex pair <${e}> is missing in VelocityMapping`)}}function Ao(t){const e=t.getNbParts(),r=new Map;for(let o=0;o<e;o++){const a=t.getPartNbStaves(o),s=t.getPartMeasures(o);for(let i=0;i<a;i++){const u=wt(o,i),c=Oo(i,s);r.set(u,c)}}return new bo(r)}function Oo(t,e){return e.flatMap(n=>v.default.getKey(n)[t])}class se{constructor(e){Object.defineProperty(this,"sustainMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sustainMap=e}getSustainEntryAtQuarter(e,r){const n=this.getSustainEntriesAtPartIdx(e);return se.findSustainEntryAtQuarter(n,r)}getSustainEntriesAtPartIdx(e){const r=this.sustainMap.get(e);return r||[]}static findSustainEntryAtQuarter(e,r){const n=e.find(o=>r>o.fromQuarter&&r<o.toQuarter);return n!=null?n:null}}const ie=se;var Ft=f(584416),Bt=f(368495);function No(t,e){const r=new Map,n=t.getNbParts();for(let o=0;o<n;o++){const a=[];if(t.isPartUnpitched(o)){r.set(o,[]);continue}const i=t.getPartNbStaves(o),u=t.getPartMeasures(o);let c=new Map,l=new Map;u.forEach((m,h)=>{const _=v.default.getDpq(m),y=e.measureIdxToQuarter(h),P=[],b=[];for(let E=0;E<i;E++)P.push(...v.default.getPedals(m,E)),b.push(...v.default.getPluckedRanges(m,E));let O=[];[c,O]=Eo(P,_,y,c),a.push(...O);let N=[];[l,N]=Do(b,_,y,l),a.push(...N)});const p=Io(a);r.set(o,p)}return r}function Eo(t,e,r,n){const o=t.flatMap(a=>{const s=Ft.A.getType(a),i=Ft.A.getStaffIdx(a);if(s==="start"&&n.set(i,d.default.divisionsToQuarter(Ft.A.getTimePos(a),e)+r),s==="stop"&&n.has(i)){const u=n.get(i),c=d.default.divisionsToQuarter(Ft.A.getTimePos(a),e)+r,l={fromQuarter:u,toQuarter:c};return n.delete(i),[l]}return[]});return[n,o]}function Do(t,e,r,n){const o="letRing",a=t.flatMap(s=>{const i=Bt.A.getType(s),u=Bt.A.getStaffIdx(s);if(i===o&&n.set(u,d.default.divisionsToQuarter(Bt.A.getTimePos(s),e)+r),i==="stop"&&n.has(u)){const c=n.get(u),l=d.default.divisionsToQuarter(Bt.A.getTimePos(s),e)+r,p={fromQuarter:c,toQuarter:l};return n.delete(u),[p]}return[]});return[n,a]}function Io(t){if(t.length<=0)return[];if(t.length===1)return t;const e=[];t.sort((r,n)=>r.fromQuarter-n.fromQuarter),e.push(t[0]);for(let r=1;r<t.length;r++){const n=e[e.length-1];n.toQuarter<=t[r].fromQuarter?e.push(t[r]):n.toQuarter=t[r].toQuarter}return e}function Qo(t,e){const r=No(t,e);return new ie(r)}const Co=Qo;var Fe=f(383279),ue=f(856219);class wo{constructor(e){Object.defineProperty(this,"instrumentMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.instrumentMap=e}getSoundIdForPartIdx(e){const r=this.instrumentMap.get(e);return r!==void 0?r:null}}function Ro(t){const e=new Map,r=t.getNbParts();for(let n=0;n<r;n++){const o=t.getPartHeader(n),a=Fe.default.getMIDIInstruments(o);if(a.length===1){const s=ue.default.getMIDIProgram(a[0]);e.set(n,String(s))}}return new wo(e)}class jt{constructor(e){Object.defineProperty(this,"modeMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modeMap=e}getModeAtQuarter(e,r){const n=this.getPartModeEntries(e);return jt.getModeForQueryTime(r,n)}getPartModeEntries(e){const r=this.modeMap.get(e);return r||[]}static getModeForQueryTime(e,r){const n=r.find(o=>e>=o.fromQuarter&&e<o.toQuarter);return n?n.type:null}}var Gt=f(536949),kt=f(447819);const ce="pizzicato",Be="mute";function xo(t,e){const r=new Map,n=t.getNbParts();for(let o=0;o<n;o++){const a=[];if(t.isPartUnpitched(o)){r.set(o,[]);continue}const i=t.getPartNbStaves(o),u=t.getPartMeasures(o);let c=new Map,l=new Map;u.forEach((m,h)=>{const _=v.default.getDpq(m),y=e.measureIdxToQuarter(h),P=[],b=[];for(let E=0;E<i;E++)P.push(...v.default.getPizzicatos(m,E)),b.push(...v.default.getMutes(m,E));let O=[];[c,O]=Vo(P,_,y,c),a.push(...O);let N=[];[l,N]=Uo(b,_,y,l),a.push(...N)}),a.push(...Lo(c,l,e.lastQuarterPosition));const p=zo(a);r.set(o,p)}return r}function Vo(t,e,r,n){const o="yes",a="no",s=t.flatMap(i=>{const u=Gt.A.getType(i),c=Gt.A.getStaffIdx(i);if(u===o&&!n.has(c)&&n.set(c,d.default.divisionsToQuarter(Gt.A.getTimePos(i),e)+r),u===a&&n.has(c)){const l=n.get(c),p=d.default.divisionsToQuarter(Gt.A.getTimePos(i),e)+r,m={type:ce,fromQuarter:l,toQuarter:p};return n.delete(c),[m]}return[]});return[n,s]}function Uo(t,e,r,n){const o="on",a="off",s=t.flatMap(i=>{const u=kt.A.getType(i),c=kt.A.getStaffIdx(i);if(u===o&&!n.has(c)&&n.set(c,d.default.divisionsToQuarter(kt.A.getTimePos(i),e)+r),u===a&&n.has(c)){const l=n.get(c),p=d.default.divisionsToQuarter(kt.A.getTimePos(i),e)+r,m={type:Be,fromQuarter:l,toQuarter:p};return n.delete(c),[m]}return[]});return[n,s]}function Lo(t,e,r){const n=[];return t.forEach(o=>{n.push({type:ce,fromQuarter:o,toQuarter:r})}),e.forEach(o=>{n.push({type:Be,fromQuarter:o,toQuarter:r})}),n}function zo(t){if(t.length<=0)return[];if(t.length===1)return t;const e=[];t.sort((r,n)=>r.fromQuarter-n.fromQuarter),e.push(t[0]);for(let r=1;r<t.length;r++){const n=e[e.length-1];n.toQuarter<=t[r].fromQuarter?e.push(t[r]):n.toQuarter=t[r].toQuarter}return e}function Fo(t,e){const r=xo(t,e);return new jt(r)}function Bo(t,e,r,n){const o=t-e;return n.measureIdxToQuarter(r)+o}const Pt=Bo;function jo(t,e,r,n,o,a,s,i,u){return o.flatMap(l=>{const p=t.getMeasureVoiceNotes(e,l.scoreMeasureIdx,n);let m=0;if(a.length){const P=l.fromQuarter+l.audioMeasureQuarterPosition,b=Pt(P,l.audioMeasureQuarterPosition,l.scoreMeasureIdx,s),O=ie.findSustainEntryAtQuarter(a,b);O!==null&&(m=b-O.fromQuarter)}const h=p.filter(P=>{const b=l.toQuarter,O=l.fromQuarter-m;return P.relativeQuarterPosition>=b?!1:P.relativeQuarterPosition>=O||P.quarterDuration+P.relativeQuarterPosition>O}),_=i.getKeySignatureAtScoreMeasure(e,r,l.scoreMeasureIdx);return h.map(P=>{const{relativeQuarterPosition:b,quarterDuration:O,hasLeftConnection:N,hasRightConnection:E,graceChords:G,notes:k,midiNotes:z,mainNote:B,midiTranspose:et,effects:q,muteModes:H,harmonicContext:at}=P,ft={quarterPosition:b+l.audioMeasureQuarterPosition,quarterDuration:O,hasLeftConnection:N,hasRightConnection:E,graceChords:G,notes:k,midiNotes:z,mainNote:B,midiTranspose:et,effects:q,keySignature:_,harmonicContext:at,muteModes:H.slice()};if(u){const it=p.indexOf(P);ft.locations=P.notes.map(K=>{if(M.default.hasPitch(K)){const mt=M.default.getPitch(K);return{partIdx:e,audioMeasureIdx:l.audioMeasureIdx,scoreMeasureIdx:l.scoreMeasureIdx,voiceIdx:n,noteIdx:it,graceIdx:null,pitch:mt}}else if(M.default.hasUnpitched(K)){const mt=M.default.getUnpitched(K);return{partIdx:e,audioMeasureIdx:l.audioMeasureIdx,scoreMeasureIdx:l.scoreMeasureIdx,voiceIdx:n,noteIdx:it,graceIdx:null,unpitched:mt}}else throw new Error("Note does not have pitch or unpitched property")})}return ft})})}function le(t,e,r,n,o,a,s){const i=e.quarterToMeasureIdx(t.from),u=e.quarterToMeasureIdx(t.to),c=e.getMeasuresList(),l=e.getQuarterDuration();let p=i;if(o&&a.length){const h=Pt(t.from,c[i],n.audioToScoreMeasureIdx(i),r),_=ie.findSustainEntryAtQuarter(a,h);if(_){const y=h-_.fromQuarter;p=e.quarterToMeasureIdx(t.from-y)}}const m=[];for(let h=p;h<=u;h++){const _=c[h],y=n.audioToScoreMeasureIdx(h),P=s&&s.getSwingAtScoreMeasure(y);let b=h>i?0:t.from-_,O=(h<u?c[h+1]:t.to)-_;P&&(b=0,O=c[h+1]?c[h+1]-_:l-_),O>0&&m.push({audioMeasureQuarterPosition:_,scoreMeasureIdx:y,audioMeasureIdx:h,fromQuarter:b,toQuarter:O})}return m}var ct=f(351277);const de=[0,2,4,5,7,9,11],Go=null,je=4,Ge=60,ke=12;function _t(t){const r=(ct.default.getOctave(t)-je)*ke+Ge,n=ct.default.getStepIdx(t),o=de[n],a=ct.default.getAlter(t);return r+o+a}function Xu(t){const e=t-Ge,r=Math.floor(e/ke)+je,n=t%12,o=de.findIndex(i=>n>=i&&n<i+2);if(o===-1)throw new Error(`Incorrect MidiPitch ${t}`);const a=Go[o],s=n-de[o];return{octave:r,step:a,alter:s}}function qe(t,e){return t===e}function ko(t,e){return t.midiProgram===e.midiProgram&&t.midiKey===e.midiKey}var pe=f(377180),qo=f(860716),fe=f(104907),Ho=f(627300),Ko=f(955154),Wo=f(579283);function $(t){return t.default&&typeof t.default=="object"&&t.default!==null&&"default"in t.default?t.default.default:t.default?t.default:t}const qt=$(pe),Z=$(M),He=$(qo),me=$(ct),$o=$(fe),Jo=$(Ho),Yo=$(Ko),Zo=$(Wo),{NATURAL_TOUCHING:Xo,NATURAL_SOUNDING:Ke,ARTIFICIAL_TOUCHING:ta}=Yo,ea=qt.createComplete(0,0,1),We=qt.createComplete(7,4,1),$e=qt.createComplete(0,0,2),ge=qt.createComplete(4,2,2),Ht=new Map([[12,ea],[7,We],[19,We],[5,$e],[17,$e],[4,ge],[9,ge],[16,ge]]);function ra(t,e){const r=[];t.notes.forEach((n,o)=>{if(!Z.hasHarmonic(n))return;const a=Z.getHarmonic(n),s=He.getType(a);s!==Ke&&(s===Xo&&na(n,e),s===ta&&oa(t.notes,o,e)&&r.unshift(o))}),r.forEach(n=>{t.notes.splice(n,1)})}function na(t,e){if(!Z.hasFretData(t))return;const{string:r,fret:n}=Z.getFretData(t);if(!n||!r)return;const o=$o.getShiftedTuningByString(e,r),a=Jo.toPitch(o);if(!Ht.has(n))return;const s=Ht.get(n),i=me.transpose(a,s);Z.setPitch(t,i)}function oa(t,e,r){const n=t[e],o=t.find(m=>aa(m,n));if(!o||!Z.hasFretData(o))return;const a=Z.getPitch(o),s=Z.getFretData(o),i=Z.getPitch(n),u=Zo(i,s.string,r);if(u===null)return;const c=u-s.fret;if(!Ht.has(c))return;const l=Ht.get(c),p=me.transpose(a,l);return Z.setPitch(o,p),Z.setHarmonic(o,He.create(Ke)),!0}function aa(t,e){if(Z.hasHarmonic(t))return!1;const r=Z.getPitch(t),n=Z.getPitch(e);return me.naiveComparePitch(n,r)>0}const sa=.125,ia=.25,ua=.25,ca=.5,la=.1,Je=t=>M.default.hasTieStop(t)||M.default.hasGlissandoStop(t)||M.default.hasSlideStop(t)||M.default.hasTremoloStop(t),Ye=t=>M.default.hasTieStart(t)||M.default.hasGlissandoStart(t)||M.default.hasSlideStart(t)||M.default.hasTremoloStart(t);var da=Object.defineProperty,pa=Object.defineProperties,fa=Object.getOwnPropertyDescriptors,Ze=Object.getOwnPropertySymbols,ma=Object.prototype.hasOwnProperty,ga=Object.prototype.propertyIsEnumerable,Xe=(t,e,r)=>e in t?da(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e)=>{for(var r in e||(e={}))ma.call(e,r)&&Xe(t,r,e[r]);if(Ze)for(var r of Ze(e))ga.call(e,r)&&Xe(t,r,e[r]);return t},St=(t,e)=>pa(t,fa(e));const tr="303";function er(t,e,r,n){return t.flatMap(a=>{const s=_a(a,e,r),i=ha(a,e,r,n);return[...s,...i]})}function ha(t,e,r,n){const{scoreQuarterPosition:o,scoreDuration:a,quarterPosition:s,quarterDuration:i,mainNote:u,midiTranspose:c,effects:l,midiNotes:p,keySignature:m,harmonicContext:h}=t,_=M.default.hasArpeggiate(u),y=t.notes.find(M.default.hasHarmonic),P=M.default.hasPitch(u);return _&&P&&(t.notes=t.notes.sort(nr)),P&&y&&n&&(t.notes=t.notes.sort(nr),ra(t,n)),t.notes.flatMap((O,N)=>{const[E,G]=rr(O,N,p,c),k=100;let z=tr;G?z=String(G.midiProgram):r&&(z=r);const B=Je(O),et=Ye(O),q={startTime:s,duration:i,hasLeftConnection:B,hasRightConnection:et,mainNote:[u],note:[O],midiTranspose:c,velocity:k,partIdx:e,soundId:z,effects:l,keySignature:m,harmonicContext:h};t.locations&&(q.location=t.locations[N]);const H=t.muteModes[N];return H&&(q.muteMode=H),M.default.hasString(O)&&(q.guitarString=M.default.getString(O)),o&&(q.scoreStartTime=o),a&&(q.scoreDuration=a),_&&Ma(q,N,t.notes.length),G?St(lt({},q),{unpitched:G}):St(lt({},q),{pitch:E,originalPitch:E})})}function _a(t,e,r){const{graceChords:n}=t;if(n.length===0)return[];const o=M.default.isSlashedGrace(n[0].notes[0]),a=o?sa:ua,s=o?ia:ca;let i=t.quarterDuration*a;i>s&&(i=s);const{midiTranspose:u,quarterPosition:c,keySignature:l}=t;t.quarterDuration-=i,t.quarterPosition+=i;const p=t.locations?t.locations[0]:void 0;return n.flatMap((m,h)=>m.notes.flatMap((_,y)=>{const P=i/n.length,b=c+h*P,[O,N]=rr(_,y,m.midiNotes,u),E=100;let G=tr;N?G=String(N.midiProgram):r&&(G=r);const k={startTime:b,duration:P,hasLeftConnection:!1,hasRightConnection:!1,mainNote:[_],note:[_],midiTranspose:u,velocity:E,partIdx:e,soundId:G,keySignature:l},z={};if(p)if(N){const B=M.default.getUnpitched(_);z.location=St(lt({},p),{unpitched:B,graceIdx:h})}else{const B=M.default.getPitch(_);z.location=St(lt({},p),{pitch:B,graceIdx:h})}return N?St(lt(lt({},k),z),{unpitched:N}):St(lt(lt({},k),z),{pitch:O,originalPitch:O})}))}function rr(t,e,r,n){const o=M.default.hasPitch(t),a=M.default.hasUnpitched(t)&&r;if(!o&&!a)throw new Error("Note has neither pitch nor unpitched.");let s;if(o){const u=M.default.getPitch(t);s=_t(u),n!==0&&(s+=n)}let i;return a&&(i=r[e]),[s,i]}function nr(t,e){const r=M.default.getPitch(t),n=_t(r),o=M.default.getPitch(e),a=_t(o);return n-a}function Ma(t,e,r){let n=la;n*r<=t.duration||(n=t.duration/r),t.duration-=e*n,t.startTime+=e*n}var J=f(724095);function va(t){var e;if((e=t==null?void 0:t.automations)!=null&&e.pitch&&t.automations.pitch.length){const r=t.automations.pitch[t.automations.pitch.length-1];return r.startTime+r.duration}return t.startTime}function ya(t){var e;return(e=t==null?void 0:t.automations)!=null&&e.pitch&&t.automations.pitch.length?t.automations.pitch[t.automations.pitch.length-1].target:t.pitch}function Ta(t,e){if(!t)return e;if(!e)return t;const r=t.pitch?t.pitch:[],n=e.pitch?e.pitch:[],o=t.velocity?t.velocity:[],a=e.velocity?e.velocity:[];return{pitch:[...r,...n],velocity:[...o,...a]}}var Pa=Object.defineProperty,Sa=Object.defineProperties,ba=Object.getOwnPropertyDescriptors,or=Object.getOwnPropertySymbols,Aa=Object.prototype.hasOwnProperty,Oa=Object.prototype.propertyIsEnumerable,ar=(t,e,r)=>e in t?Pa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sr=(t,e)=>{for(var r in e||(e={}))Aa.call(e,r)&&ar(t,r,e[r]);if(or)for(var r of or(e))Oa.call(e,r)&&ar(t,r,e[r]);return t},ir=(t,e)=>Sa(t,ba(e));const Na=1e-4;function Ea(t){const e=!!t.find(n=>M.default.hasOrnamentType(n,J.A.TREMOLO)),r=!!t.find(n=>M.default.hasOrnamentType(n,J.A.BUZZ));return e||r}function Da(t){return t.length>0&&M.default.hasTieStart(t[t.length-1])}function ur(t){return t.length>0&&M.default.hasTieStop(t[0])}function he(t){const e=[],r=t.flatMap(n=>{const o=Ia(n);if(Ea(o.note))return o;if(Da(n.note)&&!ur(n.note))return e.push(o),[];if(ur(n.note)){const a=Qa(o,e);return a?(Ca(a,o),[]):o}return o});return[...e,...r]}function Ia(t){const e={startTime:t.startTime,duration:t.duration,velocity:t.velocity,soundId:t.soundId,partIdx:t.partIdx,note:t.note,mainNote:t.mainNote,midiTranspose:t.midiTranspose,effects:[],hasLeftConnection:t.hasLeftConnection,hasRightConnection:t.hasRightConnection};return"scoreStartTime"in t&&(e.scoreStartTime=t.scoreStartTime),"scoreDuration"in t&&(e.scoreDuration=t.scoreDuration),"muteMode"in t&&(e.muteMode=t.muteMode),"effects"in t&&(e.effects=t.effects),"guitarString"in t&&(e.guitarString=t.guitarString),"automations"in t&&(e.automations=t.automations),"keySignature"in t&&(e.keySignature=t.keySignature),"harmonicContext"in t&&(e.harmonicContext=t.harmonicContext),"location"in t&&(e.location=t.location),"pitch"in t?ir(sr({},e),{pitch:t.pitch,originalPitch:t.originalPitch}):ir(sr({},e),{unpitched:t.unpitched})}function Qa(t,e){return e.find(r=>Math.abs(r.startTime+r.duration-t.startTime)<Na?"originalPitch"in r&&"originalPitch"in t?qe(r.originalPitch,t.originalPitch)||qe(ya(r),t.originalPitch):"unpitched"in r&&"unpitched"in t?ko(r.unpitched,t.unpitched):!1:!1)}function Ca(t,e){t.duration+=e.duration;const r=Ta(t.automations,e.automations);r&&(t.automations=r),t.note=[...t.note,...e.note],t.mainNote=[...t.mainNote,...e.mainNote]}const wa=1e-4;function cr(t,e){return Math.abs(t-e)<wa}function Ra(t,e,r){return!(t.length===0||!Va(t[0],e,r)||!t.every(a=>xa(a,e)))}function xa(t,e){var r;const{swingDuration:n}=e,o=(r=t.scoreDuration)!=null?r:t.quarterDuration,a=o===n,s=n%o===0,i=o%n===0;return a||s||i}function Va(t,e,r){var n,o;const{swingDuration:a}=e,s=(n=t.scoreQuarterPosition)!=null?n:t.quarterPosition,i=(o=t.scoreDuration)!=null?o:t.quarterDuration;return!!(s===r[0]&&i===a||cr(s,r[0]+a)||s<r[0]&&cr(s+i,r[0]+a))}const Ua=Ra,La=(t,e,r)=>t.filter(n=>n.quarterPosition+n.quarterDuration>e&&n.quarterPosition<r);function za(t){const e=t.duration,r=t.duration*2,n=t.first/(t.first+t.second)/e,o=t.second/(t.first+t.second)/e;return{swingDuration:e,swingBitSize:r,firstBitRatio:n,secondBitRatio:o}}function Fa(t,e,r){r.hasSwingInScore()&&e.forEach(n=>{const o=r.getSwingAtScoreMeasure(n.scoreMeasureIdx);o&&Ba(o,t,n)})}function Ba(t,e,r){const{audioMeasureQuarterPosition:n,fromQuarter:o,toQuarter:a}=r,s=t.duration*2;if(a-o<s)return;const u=n+o,c=n+a;for(let l=u;l<=c-s;l+=s)ja(za(t),La(e,l,l+s),n,[l,l+s])}function ja(t,e,r,n){if(!Ua(e,t,n))return;const{firstBitRatio:a,secondBitRatio:s,swingBitSize:i,swingDuration:u}=t;e.forEach(c=>{Ga(c);const p=(c.quarterPosition-r)%i;if(c.quarterPosition+c.quarterDuration<=n[0]+u)lr(c,n,a);else{lr(c,n,s);const h=p-u,_=u*a-u,y=h*s-h;c.quarterPosition+=_+y}})}function lr(t,e,r){const n=t.quarterDuration-Math.max(0,e[0]-t.quarterPosition)-Math.max(0,t.quarterPosition+t.quarterDuration-e[1]);t.quarterDuration=t.quarterDuration-n+n*r}function Ga(t){"scoreQuarterPosition"in t||(t.scoreQuarterPosition=t.quarterPosition),"scoreDuration"in t||(t.scoreDuration=t.quarterDuration)}const dr=Fa;var pr=f(359932);function ka(t,e,r){for(let n=0,o=0;n<t.length;n++){const a=t[n];o<e.length-1&&a.startTime>=e[o+1].audioMeasureQuarterPosition&&o++;const i=e[o];r(a,i)}}const _e=ka;function qa({quarterNotes:t,measuresList:e,modeEntries:r,scoreOrderQuarterMapping:n}){t.forEach(o=>{Ha(o.mainNote)&&(o.mode=ce)}),r.length!==0&&_e(t,e,(o,a)=>{const s=Pt(o.startTime,a.audioMeasureQuarterPosition,a.scoreMeasureIdx,n),i=jt.getModeForQueryTime(s,r);i&&(o.mode=i)})}function Ha(t){if(t.length===0)return!1;const e=!!t.find(n=>M.default.hasTechnical(n,pr.default.SNAP_PIZZICATO,{})),r=!!t.find(n=>M.default.hasTechnical(n,pr.default.STOPPED,{}));return e||r}const Ka=qa,ut={1:{id:"acoustic_grand_piano",sustainStart:.2,release:2,maxDuration:10,attenuation:.2,tremolo:"alternate",ghostNote:"quickRelease",filter:{type:"lowpass",frequency:7998},samplerv2:!1,sampleRate:44100,samples:[{notename:"D1",basenote:26,range:{start:0,end:30},loop:{start:170893,end:219499}},{notename:"Gb1",basenote:30,range:{start:27,end:30},loop:{start:160113,end:195247}},{notename:"Bb1",basenote:34,range:{start:31,end:34},loop:{start:129454,end:165045}},{notename:"D2",basenote:38,range:{start:35,end:38},loop:{start:158947,end:193111}},{notename:"Gb2",basenote:42,range:{start:39,end:42},loop:{start:120490,end:155602}},{notename:"Bb2",basenote:46,range:{start:43,end:46},loop:{start:109152,end:141103}},{notename:"D3",basenote:50,range:{start:47,end:50},loop:{start:77368,end:109543}},{notename:"Gb3",basenote:54,range:{start:51,end:54},loop:{start:55019,end:84480}},{notename:"Bb3",basenote:58,range:{start:55,end:58},loop:{start:52686,end:87542}},{notename:"D4",basenote:62,range:{start:59,end:62},loop:{start:73030,end:103885}},{notename:"Gb4",basenote:66,range:{start:63,end:66},loop:{start:62381,end:88426}},{notename:"Bb4",basenote:70,range:{start:67,end:70},loop:{start:51471,end:71088}},{notename:"D5",basenote:74,range:{start:71,end:74},loop:{start:44165,end:67047}},{notename:"Gb5",basenote:78,range:{start:75,end:78},loop:{start:47507,end:75718}},{notename:"C6",basenote:84,range:{start:79,end:84},loop:{start:43879,end:46535}},{notename:"Gb6",basenote:90,range:{start:85,end:90},loop:{start:40281,end:60328}},{notename:"Bb6",basenote:94,range:{start:91,end:94},loop:{start:40230,end:41513}},{notename:"Eb7",basenote:99,range:{start:95,end:99},loop:{start:17820,end:18113}},{notename:"Ab7",basenote:104,range:{start:100,end:104},loop:{start:13695,end:14104}},{notename:"C8",basenote:108,range:{start:105,end:127},loop:{start:12048,end:12733}}]},2:{id:"bright_acoustic_piano",sustainStart:.2,release:1.5,tremolo:"alternate",attack:.008,attenuation:.41,samplerv2:!1,sampleRate:32e3,samples:1},7:{id:"harpsichord",decay:25,sustain:1e-5,release:.45,tremolo:"alternate",filter:{type:"lowpass",frequency:8799},samplerv2:!1,sampleRate:44100,samples:[{notename:"D2",basenote:38,range:{start:0,end:39},loop:{start:167374,end:170995}},{notename:"G2",basenote:43,range:{start:40,end:44},loop:{start:82026,end:86528}},{notename:"C3",basenote:48,range:{start:45,end:48},loop:{start:99441,end:102477}},{notename:"F3",basenote:53,range:{start:49,end:54},loop:{start:47196,end:47448}},{notename:"C4",basenote:60,range:{start:55,end:61},loop:{start:91398,end:93249}},{notename:"F4",basenote:65,range:{start:62,end:65},loop:{start:36618,end:36997}},{notename:"B4",basenote:71,range:{start:66,end:71},loop:{start:37383,end:39081}},{notename:"F5",basenote:77,range:{start:72,end:77},loop:{start:30673,end:31873}},{notename:"D6",basenote:86,range:{start:78,end:86},loop:{start:30172,end:30397}},{notename:"B6",basenote:95,range:{start:87,end:95},loop:{start:20130,end:20576}},{notename:"C7",basenote:96,range:{start:96,end:127},loop:{start:35993,end:36753}}]},9:{id:"celesta",transposechromatic:12,hold:.1,decay:2,sustain:1e-5,release:3.5,attenuation:.31,tremolo:"alternate",samplerv2:!1,sampleRate:44100,samples:[{notename:"Gb3",basenote:54,range:{start:0,end:54},loop:{start:25359,end:26312}},{notename:"C4",basenote:60,range:{start:60,end:65},loop:{start:19225,end:19562}},{notename:"Gb4",basenote:66,range:{start:66,end:71},loop:{start:24481,end:24958}},{notename:"C5",basenote:72,range:{start:72,end:77},loop:{start:22571,end:23245}},{notename:"Gb5",basenote:78,range:{start:78,end:83},loop:{start:21396,end:21873}},{notename:"C6",basenote:84,range:{start:84,end:89},loop:{start:19665,end:20126}},{notename:"Gb6",basenote:90,range:{start:90,end:95},loop:{start:9497,end:9884}},{notename:"C7",basenote:96,range:{start:96,end:127},loop:{start:11684,end:11705}}]},10:{id:"glockenspiel",transposechromatic:24,release:4,tremolo:"roll"},11:{id:"music_box",release:4,tremolo:"roll"},12:{id:"vibraphone",release:4,tremolo:"roll"},13:{id:"marimba",release:2,tremolo:"roll"},14:{id:"xylophone",transposechromatic:12,release:3,tremolo:"roll"},15:{id:"tubular_bells",release:4,tremolo:"roll"},17:{id:"drawbar_organ",release:2,attenuation:.3,tremolo:"vibrato",filter:{type:"lowpass",frequency:8598},samplerv2:!1,sampleRate:32e3,samples:[{notename:"C7",basenote:96,range:{start:0,end:127},loop:{start:11297,end:49216}}]},18:{id:"percussive_organ",release:2,attenuation:.3,tremolo:"vibrato",sampleRate:44100,samplerv2:!1,samples:[{notename:"Eb2",basenote:39,range:{start:0,end:39},loop:{start:31226,end:100902}},{notename:"G2",basenote:43,range:{start:40,end:43},loop:{start:25250,end:91806}},{notename:"A2",basenote:45,range:{start:44,end:45},loop:{start:23602,end:81285}},{notename:"C3",basenote:48,range:{start:46,end:48},loop:{start:12457,end:76458}},{notename:"Db3",basenote:49,range:{start:49,end:50},loop:{start:19729,end:83951}},{notename:"E3",basenote:52,range:{start:51,end:54},loop:{start:24602,end:91436}},{notename:"Ab3",basenote:56,range:{start:55,end:59},loop:{start:46308,end:114633}},{notename:"D4",basenote:62,range:{start:60,end:65},loop:{start:12457,end:76458}},{notename:"Ab4",basenote:68,range:{start:66,end:69},loop:{start:20025,end:82645}},{notename:"C5",basenote:72,range:{start:70,end:76},loop:{start:62080,end:128769}},{notename:"Ab5",basenote:80,range:{start:77,end:80},loop:{start:37396,end:99327}},{notename:"C6",basenote:84,range:{start:81,end:87},loop:{start:19477,end:95770}},{notename:"F6",basenote:89,range:{start:88,end:89},loop:{start:57843,end:158670}},{notename:"G6",basenote:91,range:{start:90,end:127},loop:{start:33792,end:93185}}]},19:{id:"rock_organ",release:2,attenuation:.3,tremolo:"vibrato",samplerv2:!1,sampleRate:32e3,samples:[{notename:"Ab2",basenote:44,range:{start:0,end:44},loop:{start:23350,end:72007}},{notename:"B2",basenote:47,range:{start:45,end:49},loop:{start:54861,end:104311}},{notename:"E3",basenote:52,range:{start:50,end:55},loop:{start:47211,end:97269}},{notename:"A3",basenote:57,range:{start:56,end:58},loop:{start:34474,end:83056}},{notename:"C4",basenote:60,range:{start:59,end:63},loop:{start:66612,end:119553}},{notename:"F4",basenote:65,range:{start:64,end:70},loop:{start:50002,end:99845}},{notename:"Db5",basenote:73,range:{start:71,end:76},loop:{start:46895,end:94475}},{notename:"G5",basenote:79,range:{start:77,end:82},loop:{start:6688,end:77081}},{notename:"B5",basenote:83,range:{start:83,end:86},loop:{start:15126,end:62973}},{notename:"F6",basenote:89,range:{start:87,end:89},loop:{start:11787,end:61146}},{notename:"G6",basenote:91,range:{start:90,end:127},loop:{start:12309,end:60922}}]},20:{id:"church_organ",release:2.42,attenuation:.3,tremolo:"vibrato",samplerv2:!1,sampleRate:22050,samples:[{notename:"C2",basenote:36,range:{start:0,end:36},loop:{start:24522,end:61248}},{notename:"Gb2",basenote:42,range:{start:37,end:45},loop:{start:46262,end:91741}},{notename:"Eb3",basenote:51,range:{start:46,end:54},loop:{start:47046,end:97886}},{notename:"C4",basenote:60,range:{start:55,end:63},loop:{start:45472,end:90380}},{notename:"A4",basenote:69,range:{start:64,end:72},loop:{start:47913,end:78779}},{notename:"Gb5",basenote:78,range:{start:73,end:81},loop:{start:27869,end:61623}},{notename:"Eb6",basenote:87,range:{start:82,end:90},loop:{start:31911,end:71007}},{notename:"C7",basenote:96,range:{start:91,end:127},loop:{start:17894,end:51289}}]},21:{id:"reed_organ",release:2,tremolo:"vibrato",attenuation:.125,samplerv2:!1,sampleRate:44100,samples:[{notename:"Gb3",basenote:54,sampleRate:26e3,range:{start:0,end:54},loop:{start:3092,end:3373}},{notename:"C4",basenote:60,sampleRate:24e3,range:{start:55,end:60},loop:{start:1970,end:2062}},{notename:"Gb4",basenote:66,sampleRate:38e3,range:{start:61,end:66},loop:{start:3011,end:3216}},{notename:"C5",basenote:72,sampleRate:4e4,range:{start:67,end:72},loop:{start:2831,end:3137}},{notename:"Gb5",basenote:78,range:{start:73,end:78},loop:{start:3103,end:3282}},{notename:"C6",basenote:84,sampleRate:32e3,range:{start:79,end:84},loop:{start:971,end:1124}},{notename:"Gb6",basenote:90,range:{start:85,end:90},loop:{start:1457,end:1576}},{notename:"C7",basenote:96,sampleRate:38e3,range:{start:91,end:127},loop:{start:2080,end:2298}}]},22:{id:"accordion",release:1.5,tremolo:"vibrato",glissando:"slide"},23:{id:"harmonica",slur:!0,release:1.5,tremolo:"vibrato"},25:{id:"acoustic_guitar_nylon",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"acoustic_guitar_dead_notes",ghostNote:"acoustic_guitar_dead_notes"}},26:{id:"acoustic_guitar_steel",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"acoustic_guitar_dead_notes",ghostNote:"acoustic_guitar_dead_notes"}},27:{id:"electric_guitar_jazz",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_guitar_dead_notes",ghostNote:"electric_guitar_dead_notes"}},28:{id:"electric_guitar_clean",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_guitar_dead_notes",ghostNote:"electric_guitar_dead_notes"}},29:{id:"electric_guitar_muted",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_guitar_dead_notes",ghostNote:"electric_guitar_dead_notes"}},31:{id:"distortion_guitar",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_guitar_dead_notes",ghostNote:"electric_guitar_dead_notes"}},34:{id:"electric_bass_finger",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_bass_dead_notes",ghostNote:"electric_bass_dead_notes"}},35:{id:"electric_bass_pick",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_bass_dead_notes",ghostNote:"electric_bass_dead_notes"}},37:{id:"slap_bass_1",release:1.4,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"electric_bass_dead_notes",ghostNote:"electric_bass_dead_notes"}},39:{id:"synth_bass_1",release:.5,gradualVelocity:!0,children:{velocity_f:{id:"synth_bass_1_strong"}}},40:{id:"synth_bass_2",release:.5,gradualVelocity:!0,children:{velocity_f:{id:"synth_bass_2_strong"}}},41:{id:"violin",release:.6,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{pizzicato:"violin_pizz"}},42:{id:"viola",release:.6,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{pizzicato:"viola_pizz"}},43:{id:"cello",release:.7,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{pizzicato:"cello_pizz"}},44:{id:"contrabass",release:.7,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{pizzicato:"contrabass_pizz"}},46:{id:"string_ensemble_1_pizz",tremolo:"strum",release:1},47:{id:"orchestral_harp",release:6,tremolo:"strum"},48:{id:"timpani",release:6,tremolo:"roll"},49:{id:"string_ensemble_1",tremolo:"friction",release:1,glissando:"slide",gradualVelocity:!0,children:{pizzicato:"string_ensemble_1_pizz"}},53:{id:"choir_aahs",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},54:{id:"voice_oohs",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},55:{id:"synth_choir",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},57:{id:"trumpet",transposechromatic:-2,release:.3,slur:!0,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},58:{id:"trombone",release:.5,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},59:{id:"tuba",release:.5,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},61:{id:"french_horn",transposechromatic:-7,shorten:.96,release:1.2,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},62:{id:"brass_section",release:1.2,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},65:{id:"soprano_sax",transposechromatic:-2,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},66:{id:"alto_sax",transposechromatic:-9,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},67:{id:"tenor_sax",transposechromatic:-14,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},68:{id:"baritone_sax",transposechromatic:-21,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},69:{id:"oboe",release:.5,slur:!0,tremolo:"alternate",gradualVelocity:!0},70:{id:"english_horn",transposechromatic:-7,release:.6,slur:!0,tremolo:"alternate",gradualVelocity:!0},71:{id:"bassoon",release:.5,slur:!0,tremolo:"alternate",gradualVelocity:!0},72:{id:"clarinet",transposechromatic:-2,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},73:{id:"piccolo",transposechromatic:12,release:.9,slur:!0,tremolo:"alternate",gradualVelocity:!0},74:{id:"flute",release:.9,slur:!0,tremolo:"alternate",gradualVelocity:!0},75:{id:"recorder",release:.5,slur:!0,tremolo:"alternate",gradualVelocity:!0},76:{id:"pan_flute",slur:!0,release:2,tremolo:"vibrato",gradualVelocity:!0},78:{id:"shakuhachi_flute",release:1.2,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"shakuhachi_flute_soft"},velocity_f:{id:"shakuhachi_flute_strong"}}},79:{id:"whistle",release:.5,slur:!0,tremolo:"vibrato",gradualVelocity:!0},80:{id:"ocarina",slur:!0,release:2,tremolo:"vibrato",gradualVelocity:!0},81:{id:"lead_synth_vin3",release:.5,gradualVelocity:!0},82:{id:"lead_synth_mod2",release:.5,gradualVelocity:!0},83:{id:"lead_synth_vin6",release:.5,gradualVelocity:!0},84:{id:"lead_synth_vin1",release:.5,gradualVelocity:!0},85:{id:"lead_synth_mod5",release:.5,gradualVelocity:!0},86:{id:"lead_6_voice",tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},87:{id:"lead_synth_mod4",release:.5,gradualVelocity:!0},88:{id:"lead_synth_mod1",release:.5,gradualVelocity:!0},92:{id:"pad_4_choir",tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},105:{id:"sitar",release:4,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"acoustic_guitar_dead_notes",ghostNote:"acoustic_guitar_dead_notes"}},106:{id:"banjo",release:2,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"acoustic_guitar_dead_notes",ghostNote:"acoustic_guitar_dead_notes"}},107:{id:"shamisen",release:3,tremolo:"strum",glissando:"slide",children:{velocity_p:{id:"shamisen_soft"},velocity_f:{id:"shamisen_strong"}}},108:{id:"koto",release:4,tremolo:"strum",glissando:"slide",children:{velocity_p:{id:"koto_soft"},velocity_f:{id:"koto_strong"}}},110:{id:"bagpipe",transposechromatic:-2,slur:!0,release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},115:{id:"steel_drums",release:3,tremolo:"roll"},131:{id:"premium_electric_guitar_distortion",release:.3,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_electric_guitar_distortion_dead",ghostNote:"premium_electric_guitar_distortion_dead"}},139:{id:"synth_bass_3",release:.5,gradualVelocity:!0,children:{velocity_f:{id:"synth_bass_3_strong"}}},140:{id:"bassline_808_underwide",release:.5,gradualVelocity:!0},153:{id:"premium_choir_soprano_women",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},154:{id:"premium_choir_alto_women",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},155:{id:"premium_choir_tenor_men_1",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0,children:{velocity_f:{id:"premium_choir_tenor_men_1_strong"}}},156:{id:"premium_choir_bass_1",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},159:{id:"premium_tuba",release:.5,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_tuba_soft"},velocity_f:{id:"premium_tuba_strong"},mute:{id:"premium_tuba_mute",children:{velocity_p:{id:"premium_tuba_mute_soft"},velocity_f:{id:"premium_tuba_mute_strong"}}}}},161:{id:"french_horn_premium",transposechromatic:-7,release:1.2,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"french_horn_soft_premium"},velocity_f:{id:"french_horn_strong_premium"},mute:{id:"french_horn_mute_premium",children:{velocity_f:{id:"french_horn_mute_strong_premium"}}}}},165:{id:"sax_soprano_premium",transposechromatic:-2,shorten:.94,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"sax_soprano_piano_premium"},velocity_f:{id:"sax_soprano_forte_premium"}}},166:{id:"sax_alto_premium",transposechromatic:-9,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"sax_alto_piano_premium"},velocity_f:{id:"sax_alto_forte_premium"}}},167:{id:"sax_tenor_premium",transposechromatic:-14,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"sax_tenor_piano_premium"},velocity_f:{id:"sax_tenor_forte_premium"}}},168:{id:"sax_baritone_premium",transposechromatic:-21,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"sax_baritone_piano_premium"},velocity_f:{id:"sax_baritone_forte_premium"}}},171:{id:"contrabassoon",shorten:.93,release:.5,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"contrabassoon_soft"},velocity_f:{id:"contrabassoon_strong"}}},172:{id:"concert_clarinet",transposechromatic:-2,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},174:{id:"orchestral_flute",release:.9,slur:!0,tremolo:"alternate",gradualVelocity:!0},178:{id:"dizi_flute",release:1.2,slur:!0,tremolo:"alternate",gradualVelocity:!0,children:{velocity_p:{id:"dizi_flute_soft"},velocity_f:{id:"dizi_flute_strong"}}},181:{id:"lead_synth_ot4",release:.5,gradualVelocity:!0},182:{id:"lead_synth_vin4",release:.5,gradualVelocity:!0},183:{id:"lead_synth_mod7",release:.5,gradualVelocity:!0},184:{id:"lead_synth_vin2",release:.5,gradualVelocity:!0},185:{id:"lead_synth_ot3",release:.5,gradualVelocity:!0},186:{id:"lead_synth_ot1",tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},187:{id:"lead_synth_ot2",release:.5,gradualVelocity:!0},188:{id:"lead_synth_vin5",release:.5,gradualVelocity:!0},207:{id:"oud",release:3,tremolo:"strum",glissando:"slide",children:{velocity_p:{id:"oud_soft"},velocity_f:{id:"oud_strong"}}},215:{id:"steel_drums",release:3,tremolo:"roll"},224:{id:"ukulele",release:1.2,tremolo:"strum",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"acoustic_guitar_dead_notes",ghostNote:"acoustic_guitar_dead_notes"}},225:{id:"mandolin",release:1.5,tremolo:"strum",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"acoustic_guitar_dead_notes",ghostNote:"acoustic_guitar_dead_notes"}},231:{id:"premium_electric_guitar_crunch",release:.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_electric_guitar_distortion_dead",ghostNote:"premium_electric_guitar_distortion_dead"}},239:{id:"bassline_808_solide",release:.5,gradualVelocity:!0},240:{id:"bassline_808_light",release:.5,gradualVelocity:!0},241:{id:"violin_lead",release:.6,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{pizzicato:"violin_pizz"}},242:{id:"premium_viola",release:.6,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_viola_soft"},velocity_f:{id:"premium_viola_strong"},pizzicato:{id:"premium_viola_pizz",children:{velocity_p:{id:"premium_viola_pizz_soft"},velocity_f:{id:"premium_viola_pizz_strong"}}}}},243:{id:"premium_cello",release:.7,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_cello_soft"},velocity_f:{id:"premium_cello_strong"},pizzicato:{id:"premium_cello_pizz",children:{velocity_p:{id:"premium_cello_pizz_soft"},velocity_f:{id:"premium_cello_pizz_strong"}}}}},244:{id:"premium_contrabass",release:.7,slur:!0,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_contrabass_soft"},velocity_f:{id:"premium_contrabass_strong"},pizzicato:{id:"premium_contrabass_pizz",children:{velocity_p:{id:"premium_contrabass_pizz_soft"},velocity_f:{id:"premium_contrabass_pizz_strong"}}}}},253:{id:"premium_choir_soprano_girls",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_choir_soprano_girls_soft"},velocity_f:{id:"premium_choir_soprano_girls_strong"}}},254:{id:"premium_choir_alto_girls",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_choir_alto_girls_soft"}}},255:{id:"premium_choir_tenor_men_2",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},256:{id:"premium_choir_bass_2",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},257:{id:"premium_trumpet",transposechromatic:-2,release:.3,slur:!0,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_trumpet_soft"},velocity_f:{id:"premium_trumpet_strong"},mute:{id:"premium_trumpet_mute",children:{velocity_p:{id:"premium_trumpet_mute_soft"},velocity_f:{id:"premium_trumpet_mute_strong"}}}}},258:{id:"premium_trombone",release:.5,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_trombone_soft"},velocity_f:{id:"premium_trombone_strong"},mute:{id:"premium_trombone_mute",children:{velocity_p:{id:"premium_trombone_mute_soft"},velocity_f:{id:"premium_trombone_mute_strong"}}}}},268:{id:"baritone_horn",slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},269:{id:"baritone_horn",transposechromatic:-14,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},270:{id:"euphonium",slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0},271:{id:"contrabass_clarinet",transposechromatic:-26,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},272:{id:"bass_clarinet",transposechromatic:-14,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},273:{id:"alto_clarinet",transposechromatic:-9,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},274:{id:"alto_flute",transposechromatic:-5,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},281:{id:"lead_synth_mod3",release:.5,gradualVelocity:!0},282:{id:"lead_synth_mod6",release:.5,gradualVelocity:!0},286:{id:"kazoo",tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},301:{id:"premium_piano",sustainStart:.2,release:2,maxDuration:10,attenuation:.2,tremolo:"alternate",ghostNote:"quickRelease",filter:{type:"lowpass",frequency:7998},children:{velocity_p:{id:"premium_piano_soft"},velocity_f:{id:"premium_piano_strong"}},samplerv2:!1},302:{id:"piano_tight",sustainStart:.2,release:2,maxDuration:10,tremolo:"alternate",ghostNote:"quickRelease",filter:{type:"lowpass",frequency:7998},children:{velocity_p:{id:"piano_tight_soft"},velocity_f:{id:"piano_tight_strong"}},samplerv2:!1},303:{id:"piano_concert",sustainStart:.2,release:2,maxDuration:10,tremolo:"alternate",ghostNote:"quickRelease",filter:{type:"lowpass",frequency:7998},children:{velocity_p:{id:"piano_concert_soft"},velocity_f:{id:"piano_concert_strong"}},samplerv2:!1},324:{id:"premium_ukulele",release:1.2,tremolo:"strum",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_ukulele_dead",ghostNote:"premium_ukulele_dead",velocity_p:{id:"premium_ukulele_soft"},velocity_f:{id:"premium_ukulele_strong"}}},325:{id:"premium_acoustic_guitar",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_acoustic_guitar_dead",ghostNote:"premium_acoustic_guitar_dead",velocity_p:{id:"premium_acoustic_guitar_soft"},velocity_f:{id:"premium_acoustic_guitar_strong"},mute:{id:"premium_acoustic_guitar_mute"}}},328:{id:"premium_electric_guitar",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_electric_guitar_dead",ghostNote:"premium_electric_guitar_dead",velocity_p:{id:"premium_electric_guitar_soft"},velocity_f:{id:"premium_electric_guitar_strong"}}},331:{id:"premium_electric_guitar_lead",release:.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_electric_guitar_distortion_dead",ghostNote:"premium_electric_guitar_distortion_dead"}},334:{id:"premium_modern_electric_bass",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_modern_electric_bass_dead",ghostNote:"premium_modern_electric_bass_dead",velocity_p:{id:"premium_modern_electric_bass_soft"},velocity_f:{id:"premium_modern_electric_bass_strong"}}},335:{id:"premium_vintage_electric_bass",release:1.5,tremolo:"strum",glissando:"slide",deadNote:"alternativeSample",ghostNote:"alternativeSample",children:{deadNote:"premium_vintage_electric_bass_dead",ghostNote:"premium_vintage_electric_bass_dead",velocity_p:{id:"premium_vintage_electric_bass_soft"},velocity_f:{id:"premium_vintage_electric_bass_strong"}}},339:{id:"bassline_808_airbass",release:.5,gradualVelocity:!0},340:{id:"bassline_808_evolution",release:.5,gradualVelocity:!0},341:{id:"premium_violin",release:.6,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_violin_soft"},velocity_f:{id:"premium_violin_strong"},pizzicato:{id:"premium_violin_pizz",children:{velocity_f:{id:"premium_violin_pizz_strong"}}}}},353:{id:"premium_choir_soprano_boys",release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"premium_choir_soprano_boys_soft"},velocity_f:{id:"premium_choir_soprano_boys_strong"}}},354:{id:"premium_choir_countertenor_men",shorten:.92,release:1.2,tremolo:"vibrato",glissando:"slide",gradualVelocity:!0},368:{id:"baritone_horn_premium",slur:!0,tremolo:"alternate",glissando:"slide",release:1.2,gradualVelocity:!0,children:{velocity_p:{id:"baritone_horn_soft_premium"},velocity_f:{id:"baritone_horn_strong_premium"}}},369:{id:"baritone_horn_premium",transposechromatic:-14,release:1.2,slur:!0,tremolo:"alternate",glissando:"slide",gradualVelocity:!0,children:{velocity_p:{id:"baritone_horn_soft_premium"},velocity_f:{id:"baritone_horn_strong_premium"}}},372:{id:"clarinet_ensemble",transposechromatic:-2,release:.3,slur:!0,tremolo:"alternate",gradualVelocity:!0},374:{id:"traditional_flute",release:.9,slur:!0,tremolo:"alternate",gradualVelocity:!0},439:{id:"bassline_808_weekend",release:.5,gradualVelocity:!0},440:{id:"bassline_808_plucky",release:.5,gradualVelocity:!0},441:{id:"erhu",release:.5,tremolo:"friction",glissando:"slide",gradualVelocity:!0,children:{velocity_f:{id:"erhu_strong"},pizzicato:{id:"erhu_pizz",children:{velocity_f:{id:"erhu_pizz_strong"}}}}},539:{id:"bassline_808_phase",release:.5,gradualVelocity:!0},540:{id:"bassline_808_out",release:.5,gradualVelocity:!0},666:{id:"cat",tremolo:"vibrato",gradualVelocity:!0}},Rt={1:{id:"percussion_kit","midi-unpitched":!0,instruments:{36:{name:"Acoustic Bass Drum"},37:{name:"Bass Drum"},38:{name:"Side Stick"},39:{name:"Snare (Acoustic)"},40:{name:"Clapping Hands"},41:{name:"Snare (Electric)"},42:{name:"Tom 5"},43:{name:"Hi-Hat Close"},44:{name:"Tom 4"},45:{name:"Hi-Hat Pedal"},46:{name:"Tom 3"},47:{name:"Hi-Hat Open"},48:{name:"Tom 2"},49:{name:"Tom 1"},50:{name:"Crash 1"},51:{name:"Tom"},52:{name:"Ride"},53:{name:"China"},54:{name:"Ride (bell)"},55:{name:"Tambourine"},56:{name:"Splash Cymbal"},57:{name:"Cowbell"}}},2:{id:"marching_band_set","midi-unpitched":!0,instruments:{36:{name:"Bass Drum 5"},37:{name:"Bass Drum Rims"},38:{name:"Bass Drum 4"},39:{name:"Bass Drum Unison"},40:{name:"Bass Drum 3"},41:{name:"Bass Drum 2"},43:{name:"Bass Drum 1"},44:{name:"Cymbal Smash"},45:{name:"Cymbal Crash"},46:{name:"Hi Hat Choke"},47:{name:"Cymbal Crash Choke"},48:{name:"Snare Left Hand"},49:{name:"Snare Left Hand Rimshot"},50:{name:"Snare Right Hand"},51:{name:"Snare Right Hand Rimshot"},52:{name:"Snare Gok"},53:{name:"Snare Short Guz"},54:{name:"Snare Long Guz"},55:{name:"Snare Left Hand Rim"},56:{name:"Snare Right Hand Rim"},57:{name:"Snare Cross Shot"},58:{name:"Snare Stick Shot"},59:{name:"Snare Stick Click"},60:{name:"Snare Roll Short"},64:{name:"Snare Brush"},65:{name:"Tenor Drum 4"},66:{name:"Tenor Drum 4 Rimshot"},67:{name:"Tenor Drum 4 Buzz Roll"},69:{name:"Tenor Drum 3"},70:{name:"Tenor Drum 3 Rimshot"},71:{name:"Tenor Drum 3 Buzz Roll"},72:{name:"Tenor Drum 2"},73:{name:"Tenor Drum 2 Rimshot"},74:{name:"Tenor Drum 2 Buzz Roll"},76:{name:"Tenor Drum 1"},77:{name:"Tenor Drum 1 Rimshot"},78:{name:"Tenor Drum 1 Buzz Roll"},79:{name:"Tenor Drum Spock"},80:{name:"Tenor Drum Spock Rimshot"},81:{name:"Tenor Drum Hi"},82:{name:"Tenor Drum Lo"},83:{name:"Tenor Stick Click"}}},3:{id:"hip_hop_drum_set","midi-unpitched":!0,instruments:{36:{name:"Kick"},39:{name:"Snare"},40:{name:"Clap"},43:{name:"Hi Hat Closed"},47:{name:"Hi Hat Open"},50:{name:"Crash Cymbal"},57:{name:"Misc Perc. 1"},66:{name:"Misc Perc. 2"}}},4:{id:"suspended_cymbal","midi-unpitched":!0,instruments:{60:{name:"Suspended Cymbal"}}},5:{id:"finger_snap","midi-unpitched":!0,instruments:{60:{name:"Finger Snap"}}},6:{id:"gong","midi-unpitched":!0,instruments:{59:{name:"Gong Forte"},60:{name:"Gong Fortissimo"},61:{name:"Gong Short 1"},62:{name:"Gong Short 2"},63:{name:"Gong Short 3"}}},7:{id:"claves","midi-unpitched":!0,instruments:{59:{name:"Clave Piano"},60:{name:"Clave Forte"}}},8:{id:"concert-bass-drum","midi-unpitched":!0,instruments:{59:{name:"Bass Drum 1"},60:{name:"Bass Drum 2"}}},9:{id:"wind_chimes","midi-unpitched":!0,instruments:{57:{name:"Short Glissando Down"},58:{name:"Medium Glissando Down"},59:{name:"Long Glissando Down"},60:{name:"Short Glissando Up"},61:{name:"Medium Glissando Up"},62:{name:"Long Glissando Up"}}},10:{id:"nagado_drums","midi-unpitched":!0,children:{velocity_p:{id:"nagado_drums_soft"},velocity_f:{id:"nagado_drums_strong"}}},11:{id:"woodblocks","midi-unpitched":!0},80:{id:"starwars_set","midi-unpitched":!0,instruments:[{name:"Blaster",unpitched:636},{name:"Lightsaber On",unpitched:637},{name:"Lightsaber Off",unpitched:638},{name:"R2D2",unpitched:639},{name:"Vader Breath",unpitched:640},{name:"I Am Your Father",unpitched:641},{name:"Chewbacca",unpitched:642},{name:"X Wing",unpitched:643},{name:"Tie Fighter",unpitched:644},{name:"Tie Fire",unpitched:645}]},101:{id:"premium_default_drum_set","midi-unpitched":!0,children:{velocity_p:{id:"premium_default_drum_set_soft"},velocity_f:{id:"premium_default_drum_set_strong"}}},102:{id:"marching_bass_drums_hq","midi-unpitched":!0,children:{velocity_f:{id:"marching_bass_drums_hq_strong"}}},103:{id:"marching_cymbals_hq","midi-unpitched":!0,children:{velocity_f:{id:"marching_cymbals_hq_strong"}}},104:{id:"marching_snare_hq","midi-unpitched":!0,children:{velocity_p:{id:"marching_snare_hq_soft"},velocity_f:{id:"marching_snare_hq_strong"}}},105:{id:"marching_tenor_hq","midi-unpitched":!0,children:{velocity_p:{id:"marching_tenor_hq_soft"},velocity_f:{id:"marching_tenor_hq_strong"}}}};function Wa({quarterNotes:t,partIdx:e,staffIdx:r,measuresList:n,velocityMapping:o,scoreOrderQuarterMapping:a}){_e(t,n,(s,i)=>{var u,c;const l=(u=s.scoreStartTime)!=null?u:s.startTime,p=(c=s.scoreDuration)!=null?c:s.duration,m=Pt(l,i.audioMeasureQuarterPosition,i.scoreMeasureIdx,a);if(s.velocity=o.getVelocityAtQuarter(e,r,m),!(ut[s.soundId]&&ut[s.soundId].gradualVelocity))return;const _=o.getVelocityFromTo(e,r,m,m+p),y=l-m;if(_===null)return;let P=l,b=s.velocity;const O=_.flatMap(([N,E],G)=>{var k,z;const B=[],et=N>m&&E.base+((k=E.relative)!=null?k:0)!==b,q=E.changePerQuarter,H=_[G+1];if(et){const at=P,st=N+y,ft=st-at,it=Tt(E.base+((z=E.relative)!=null?z:0));b=it,P=st,B.push({startTime:at,duration:ft,target:it})}if(q){const at=Math.max(N+y,l),st=H?H[0]+y:l+p,ft=st-at,it=o.getVelocityValue(E,N+y,st);b=it,B.push({startTime:at,duration:ft,target:it})}return B});O.length!==0&&(s.automations||(s.automations={}),s.automations.velocity||(s.automations.velocity=[]),s.automations.velocity.push(...O))})}const fr=Wa,Kt="staccato",Wt="stacatissimo",mr="tenuto",Me="marcato",ve="accent",bt="non-legato",gr=[Kt,Wt,bt],$a=.05,hr=.2,Ja=.5,Ya=.4,Za=.35,Xa=.2,ts=4,es=5,rs=8,ns=1/8,ye=1;function os({quarterNotes:t,partIdx:e,measuresList:r,sustainMapping:n,scoreOrderQuarterMapping:o}){_e(t,r,(a,s)=>{var i,u,c;const l=(i=a.scoreStartTime)!=null?i:a.startTime,p=(u=a.scoreDuration)!=null?u:a.duration,m=Pt(l,s.audioMeasureQuarterPosition,s.scoreMeasureIdx,o),h=Pt(a.startTime,s.audioMeasureQuarterPosition,s.scoreMeasureIdx,o),_=n.getSustainEntryAtQuarter(e,m+p);if(_){const y=_.toQuarter-h;if(y>a.duration){a.duration=y;const b=(c=(ut[a.soundId]||Rt[a.soundId]).release)!=null?c:ye;a.release=b*ns}}})}const as=os;function ss(t,e,r=!1){const n=[mr,Wt,Kt,bt],o=[Me,ve];for(const a of t){if(!a.effects||a.effects.length===0)continue;const s=n.find(u=>a.effects.indexOf(u)>-1);s&&(s!==bt||!r)&&Mr(a,s,e);const i=o.find(u=>a.effects.indexOf(u)>-1);i&&Mr(a,i,e),a.effects=void 0}}const _r={[bt]:(t,e)=>{let r=t.duration*$a;const n=e.getTimeEntryAtQuarter(t.startTime);r*n.spq>hr&&(r=hr/n.spq),t.duration-=r},[Kt]:t=>{var e;t.duration*=Ja;const n=(e=(ut[t.soundId]||Rt[t.soundId]).release)!=null?e:ye;t.release=n*Ya},[Wt]:t=>{var e;t.duration*=Za,t.velocity=Tt(zt(t.velocity,ts));const n=(e=(ut[t.soundId]||Rt[t.soundId]).release)!=null?e:ye;t.release=n*Xa},[Me]:t=>{t.velocity=Tt(zt(t.velocity,rs))},[ve]:t=>{t.velocity=Tt(zt(t.velocity,es))}};function Mr(t,e,r){typeof _r[e]=="function"&&_r[e](t,r)}const vr=ss;var is=Object.defineProperty,us=Object.defineProperties,cs=Object.getOwnPropertyDescriptors,yr=Object.getOwnPropertySymbols,ls=Object.prototype.hasOwnProperty,ds=Object.prototype.propertyIsEnumerable,ps=Math.pow,Tr=(t,e,r)=>e in t?is(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pr=(t,e)=>{for(var r in e||(e={}))ls.call(e,r)&&Tr(t,r,e[r]);if(yr)for(var r of yr(e))ds.call(e,r)&&Tr(t,r,e[r]);return t},Sr=(t,e)=>us(t,cs(e));const Te=.047;function fs(t){const e=t.find(r=>M.default.hasOrnamentType(r,J.A.TREMOLO));return e?M.default.getOrnamentOpts(e,J.A.TREMOLO):!1}function ms(t){const e=t.find(r=>M.default.hasOrnamentType(r,J.A.BUZZ));return e?M.default.getOrnamentOpts(e,J.A.BUZZ):!1}function gs(t,e){return t.flatMap(r=>{const n=fs(r.mainNote),o=ms(r.mainNote),a=n&&"nbBeam"in n&&typeof n.nbBeam=="number",s=!!o;if(a){const i=ps(2,n.nbBeam),u=r.duration/i;return Array.from({length:i},(c,l)=>Sr(Pr({},r),{hasRightConnection:!1,hasLeftConnection:!1,duration:u,startTime:r.startTime+l*u,note:[]}))}if(s){const i=e.quarterToSeconds(r.startTime),c=e.quarterToSeconds(r.startTime+r.duration)-i,l=Math.ceil(c/Te),p=Te/e.getTimeEntryAtQuarter(r.startTime).spq,m=Array.from({length:l},(_,y)=>Sr(Pr({},r),{hasRightConnection:!1,hasLeftConnection:!1,duration:p,startTime:r.startTime+y*p,note:[]})),h=c%Te/e.getTimeEntryAtQuarter(r.startTime).spq;return h!==0&&(m[m.length-1].duration=h),m}return r})}const br="ghost",Ar="dead",hs="ghostNote",_s="deadNote",Or="quickRelease",Nr="alternativeSample";function Ms(t){t.forEach(e=>{if(!("muteMode"in e))return;let r=ut[e.soundId];r||(r=Rt[e.soundId]),r&&(e.muteMode===br&&vs(e,r),e.muteMode===Ar&&ys(e,r))})}function vs(t,e){var r;const n=(r=e[hs])!=null?r:Or;n===Or&&(delete t.muteMode,t.velocity=ae),n!==Nr&&delete t.muteMode}function ys(t,e){e[_s]!==Nr&&delete t.muteMode}const Er=1e-4;class Ts{constructor(e,r,n,o,a){Object.defineProperty(this,"scoreDataCache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scoreQuarterMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playQuarterMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partIdx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"voiceIdx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scoreDataCache=e,this.scoreQuarterMapping=r,this.playQuarterMapping=n,this.partIdx=o,this.voiceIdx=a}enrichMeasureAndNotesLists(e,r){e.length===0||r.length===0||(this.prependMeasuresAndNotesTillNoConnections(e,r),this.appendMeasuresAndNotesTillNoConnections(e,r))}prependMeasuresAndNotesTillNoConnections(e,r){const n=r[0],o=this.getScoreMeasureIdxAtQuarter(n.quarterPosition,e),a=this.scoreDataCache.getMeasureVoiceNotes(this.partIdx,o,this.voiceIdx),s=this.playQuarterMapping.quarterToMeasureIdx(n.quarterPosition),i=this.playQuarterMapping.measureIdxToQuarter(s),u=a.findIndex(y=>Math.abs(y.relativeQuarterPosition-(n.quarterPosition-i))<Er);if(u===-1)return;const c=this.scoreQuarterMapping.measureIdxToQuarter(o),l=i-c;let p=o,m=this.prevNoteIterator(o,a,u),_=e[0].audioMeasureIdx-1;for(;m;){const[y,P,b]=m;y!==p&&(this.prependMeasure(this.createMeasureEntry(y,l,_),e),_--),this.prependNote(this.createNoteEntry(P[b],y,l),r),p=y,m=this.prevNoteIterator(y,P,b)}}appendMeasuresAndNotesTillNoConnections(e,r){const n=this.scoreQuarterMapping.measuresList.length-1,o=r[r.length-1],a=this.getScoreMeasureIdxAtQuarter(o.quarterPosition,e),s=this.scoreDataCache.getMeasureVoiceNotes(this.partIdx,a,this.voiceIdx),i=this.playQuarterMapping.quarterToMeasureIdx(o.quarterPosition),u=this.playQuarterMapping.measureIdxToQuarter(i),c=s.findIndex(P=>Math.abs(P.relativeQuarterPosition-(o.quarterPosition-u))<Er);if(c===-1)return;const l=this.scoreQuarterMapping.measureIdxToQuarter(a),p=u-l;let m=a,h=this.nextNoteIterator(a,s,c,n),y=e[e.length-1].audioMeasureIdx+1;for(;h;){const[P,b,O]=h;P!==m&&(this.appendMeasure(this.createMeasureEntry(P,p,y),e),y++),this.appendNote(this.createNoteEntry(b[O],P,p),r),m=P,h=this.nextNoteIterator(P,b,O,n)}}prevNoteIterator(e,r,n){return r[n].hasLeftConnection?n>0?r[n-1].hasRightConnection?[e,r,n-1]:!1:e>0?(r=this.scoreDataCache.getMeasureVoiceNotes(this.partIdx,e-1,this.voiceIdx),r[r.length-1].hasRightConnection?[e-1,r,r.length-1]:!1):!1:!1}nextNoteIterator(e,r,n,o){return r[n].hasRightConnection?n<r.length-1?r[n+1].hasLeftConnection?[e,r,n+1]:!1:e<o?(r=this.scoreDataCache.getMeasureVoiceNotes(this.partIdx,e+1,this.voiceIdx),r[0].hasLeftConnection?[e+1,r,0]:!1):!1:!1}createMeasureEntry(e,r,n){return{audioMeasureQuarterPosition:this.scoreQuarterMapping.measureIdxToQuarter(e)+r,scoreMeasureIdx:e,audioMeasureIdx:n,fromQuarter:0,toQuarter:0}}createNoteEntry(e,r,n){const{relativeQuarterPosition:o,quarterDuration:a,hasLeftConnection:s,hasRightConnection:i,graceChords:u,notes:c,midiNotes:l,mainNote:p,midiTranspose:m,effects:h,muteModes:_}=e;return{quarterPosition:o+this.scoreQuarterMapping.measureIdxToQuarter(r)+n,quarterDuration:a,hasLeftConnection:s,hasRightConnection:i,graceChords:u,notes:c,midiNotes:l,mainNote:p,midiTranspose:m,effects:h,muteModes:_.slice()}}prependNote(e,r){r.unshift(e)}prependMeasure(e,r){r.length&&r[0].audioMeasureQuarterPosition===e.audioMeasureQuarterPosition||r.unshift(e)}appendNote(e,r){r.push(e)}appendMeasure(e,r){r.length&&r[r.length-1].audioMeasureQuarterPosition===e.audioMeasureQuarterPosition||r.push(e)}getScoreMeasureIdxAtQuarter(e,r){const n=r.findIndex(o=>o.audioMeasureQuarterPosition>e);return n<0?r[r.length-1].scoreMeasureIdx:r[n-1].scoreMeasureIdx}}function Ps(t,e,{scoreDataCache:r,scoreOrderQuarterMapping:n,playOrderQuarterMapping:o,partIdx:a,voiceIdx:s}){new Ts(r,n,o,a,s).enrichMeasureAndNotesLists(t,e)}function Dr(t,e,r){return t.filter(n=>r?n.startTime+n.duration>e.from&&n.startTime<=e.to:n.startTime>=e.from&&n.startTime<=e.to)}var Ss=Object.defineProperty,bs=Object.defineProperties,As=Object.getOwnPropertyDescriptors,Ir=Object.getOwnPropertySymbols,Os=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable,Qr=(t,e,r)=>e in t?Ss(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Es=(t,e)=>{for(var r in e||(e={}))Os.call(e,r)&&Qr(t,r,e[r]);if(Ir)for(var r of Ir(e))Ns.call(e,r)&&Qr(t,r,e[r]);return t},Ds=(t,e)=>bs(t,As(e));const Is="glissando",Qs="slide";function Cr(t){const e=[];return t.flatMap(n=>{if(Vs(n.note)&&e.length!==0){const o=e.shift(),a=ut[n.soundId]&&ut[n.soundId][Is]===Qs,s=M.default.hasSlideStop(n.note[0]);return a&&!s?(Cs(o,n),wr(n.note)&&e.push(o),[]):ws(o,n)}return wr(n.note)&&e.push(n),n})}function Cs(t,e){var r;t.automations||(t.automations={}),t.automations.pitch||(t.automations.pitch=[]);const n=va(t);t.automations.pitch.push({startTime:n,duration:e.startTime-n,target:e.pitch}),t.duration+=e.duration,t.hasRightConnection=e.hasRightConnection,t.effects=(r=t.effects)==null?void 0:r.filter(o=>gr.indexOf(o)===-1),t.note=[...t.note,...e.note],t.mainNote=[...t.mainNote,...e.mainNote]}function ws(t,e){var r;const n=Rs(t,e);if(n===null)return e;t.effects=(r=t.effects)==null?void 0:r.filter(a=>gr.indexOf(a)===-1);const o=xs(t,n);return t.duration=n.duration,[...o,e]}function Rs(t,e){const r=e.pitch-t.pitch;if(r>=-1&&r<=1)return null;const n=r>0,o=e.startTime-t.startTime,a=Math.abs(o),s=Math.abs(r)-1,i=a/(s+1);return{isPositiveDirection:n,nbGlissNotes:s,duration:i}}function xs(t,e){const{isPositiveDirection:r,nbGlissNotes:n,duration:o}=e,a=[];for(let s=1;s<=n;s++)a.push(Ds(Es({},t),{note:[],mainNote:[],duration:o,startTime:t.startTime+s*o,pitch:r?t.pitch+s:t.pitch-s}));return a}function wr(t){return t.length>0&&M.default.hasGlissandoStart(t[t.length-1])||M.default.hasSlideStart(t[t.length-1])}function Vs(t){return t.length>0&&(M.default.hasGlissandoStop(t[0])||M.default.hasSlideStop(t[0]))}var xt=f(967104),$t=f(694426);const Rr=.75;function Us(t){return t.length>0&&M.default.hasBend(t[0])}function Ls(t){return t.length>0&&M.default.hasPreBend(t[0])}function zs(t){return t.length>0&&M.default.getBend(t[0])}function Fs(t){return t.length>0&&M.default.getPreBend(t[0])}function Bs(t){return t.map(r=>(!Us(r.note)&&!Ls(r.note)||js(r),r))}function js(t){const e=zs(t.note),r=Fs(t.note);r&&Gs(t,r),e&&ks(t,e)}function Gs(t,e){if(xt.A.getType(e)!==$t.A.PRE_BEND)return;const n=xt.A.getAlter(e);t.pitch+=n}function ks(t,e){var r,n,o,a,s,i;const u=xt.A.getType(e);if(u!==$t.A.PRE_BEND)switch(u){case $t.A.BEND:{const c=xt.A.getAlter(e);t.automations=(r=t.automations)!=null?r:{},t.automations.pitch=(o=(n=t.automations)==null?void 0:n.pitch)!=null?o:[],t.automations.pitch.push({target:t.originalPitch+c,startTime:t.startTime,duration:t.duration*Rr});break}case $t.A.RELEASE:{if(t.pitch===t.originalPitch&&!t.hasLeftConnection)break;const c=xt.A.getAlter(e);t.automations=(a=t.automations)!=null?a:{},t.automations.pitch=(i=(s=t.automations)==null?void 0:s.pitch)!=null?i:[],t.automations.pitch.push({target:t.originalPitch+c,startTime:t.startTime,duration:t.duration*Rr});break}default:break}}var qs=Object.defineProperty,Hs=Object.defineProperties,Ks=Object.getOwnPropertyDescriptors,xr=Object.getOwnPropertySymbols,Ws=Object.prototype.hasOwnProperty,$s=Object.prototype.propertyIsEnumerable,Vr=(t,e,r)=>e in t?qs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Js=(t,e)=>{for(var r in e||(e={}))Ws.call(e,r)&&Vr(t,r,e[r]);if(xr)for(var r of xr(e))$s.call(e,r)&&Vr(t,r,e[r]);return t},Ys=(t,e)=>Hs(t,Ks(e));const Zs={1:.5,2:.25,3:.125,4:.0625},Xs="tremolo",ti="1";function ei(t){return t.length>0&&M.default.hasTremoloStart(t[t.length-1])}function ri(t){return t.length>0&&M.default.hasTremoloStop(t[0])}function ni(t){let e=[];return t.flatMap((r,n)=>{if(ei(r.mainNote))return Ur(r,e,"start"),[];if(ri(r.mainNote))return Ur(r,e,"stop"),n===t.length-1?Lr(e):[];const o=[];return e.length&&(o.push(...Lr(e)),e=[]),o.push(r),o})}function Ur(t,e,r){e.length===0&&e.push({tremoloStartNotes:[],tremoloStopNotes:[]});let n=e.length-1;const o=e[n].tremoloStartNotes;r==="start"&&o.length&&o[o.length-1].startTime!==t.startTime&&(e.push({tremoloStartNotes:[],tremoloStopNotes:[]}),n+=1),r==="start"&&e[n].tremoloStartNotes.push(t),r==="stop"&&e[n].tremoloStopNotes.push(t)}function Lr(t){return t.flatMap(e=>oi(e.tremoloStartNotes,e.tremoloStopNotes))}function oi(t,e){var r,n;if(t.length===0||e.length===0)return[];const o=(n=(r=M.default.getOrnamentOpts(t[0].note[t[0].note.length-1],Xs))==null?void 0:r.nbBeam)!=null?n:ti,a=Zs[o],s=t[0].startTime,i=e[0].startTime+e[0].duration,u=[];for(let c=s,l=0;c<=i-a;c+=a,l++){const p=l%2===0?t:e;u.push(...p.map(m=>Ys(Js({},m),{duration:a,startTime:c})))}return u}var Pe=f(645369),zr=f(595382);const Fr=Pe("score-reader:utils:ornamentsUtils"),ai={YES:"yes",NO:"no"},Jt={ABOVE:"above",BELOW:"below"},si={mordent:[0,1,0],lowerMordent:[0,-1,0],longMordent:[1,0,1,0,1,0,1,0],longLowerMordent:[1,0,1,0,1,0,-1,0],belowApproachMordent:[-1,0,1,0,1,0,-1,0],aboveApproachMordent:[1,0,-1,0,1,0,-1,0],belowApproachLowerMordent:[-1,0,1,0,1,0,1,0],aboveApproachLowerMordent:[1,0,-1,0,1,0,1,0],belowDepartureMordent:[1,0,1,0,1,0,-1,-2,-1,0],aboveDepartureMordent:[1,0,1,0,1,0,1,2,1,0],turn:[1,0,-1,0],lowerTurn:[-1,0,1,0]};function Br(t){const e=Object.keys(t);for(let r=0;r<e.length;r++){const n=e[r];if(J.A.isValid(n))return n}return null}function jr(t){return t.map(e=>-e)}function Gr(t,e){const r=e.transposition||0;Fr(`getOrnamentalSequence for [${t}] with options %O with a transposition of ${r}`,e);let n=[],o=[0,1];e.$long===ai.YES&&(n=[1,0,1,0,1]),(t===J.A.MORDENT||t===J.A.TURN)&&(o=jr(o)),e.$approach===Jt.ABOVE?n[2]=-1:e.$approach===Jt.BELOW&&(n[0]=-1),e.$departure===Jt.ABOVE?o=[0,-1,-2,-1]:e.$departure===Jt.BELOW&&(o=[0,1,2,1]),t===J.A.TURN?n[0]=1:t===J.A.INVERTED_TURN&&(n[0]=-1);const a=n.concat(o);return Fr("final sequence diff %o",a),a}function Se(t,e,r,n,o){const a=structuredClone(t);ct.default.shiftStepUnsafe(a,e);const s=`${a.step}${a.octave}`;return o.previousAccidentals[s]?a.alter=o.previousAccidentals[s]:n.fifths&&(a.alter=ct.default.stepToAlter(a.step,n.fifths)),_t(a)+r}function kr(t,e,r,n={currentAccidental:null,previousAccidentals:{}}){const o=e.originalPitch,a=e.transposition||0,i=Gr(t,e).map(u=>Se(o,u,a,r,n));return i.push(Se(o,0,a,r,n)),i}const tc={OrnamentSequences:si,getFirstOrnamentalSequenceName:Br,invertSequence:jr,buildOrnamentalPitchOffsetSequence:Gr,convertPitchOffsetToMIDINote:Se,getOrnamentalMIDISequence:kr},ii={tremolo:{pattern:[{durationDiff:-2e-4,attack:.015},{durationDiff:4e-4,attack:.008},{durationDiff:-3e-4,attack:.01,filters:[{type:"peaking",frequencyMultiplier:4.2,q:20,gain:20},{type:"peaking",frequencyMultiplier:4,q:10,gain:7},{type:"peaking",frequencyMultiplier:3,q:10,gain:4}]},{durationDiff:2e-4,attack:.01},{durationDiff:0,attack:.005},{durationDiff:1e-4,attack:.015,filters:[{type:"peaking",frequencyMultiplier:2.5,q:40,gain:30},{type:"peaking",frequencyMultiplier:3.2,q:30,gain:20}]},{durationDiff:1e-4,attack:.009,filters:[{type:"peaking",frequencyMultiplier:2.7,q:40,gain:25}]},{durationDiff:0,attack:.02},{durationDiff:-2e-4,attack:.005},{durationDiff:2e-4,attack:.006},{durationDiff:0,attack:.002},{durationDiff:0,attack:.002},{durationDiff:-1e-4,attack:.002},{durationDiff:3e-4,attack:.003}]}};var ui=Object.defineProperty,qr=Object.getOwnPropertySymbols,ci=Object.prototype.hasOwnProperty,li=Object.prototype.propertyIsEnumerable,di=Math.pow,Hr=(t,e,r)=>e in t?ui(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,be=(t,e)=>{for(var r in e||(e={}))ci.call(e,r)&&Hr(t,r,e[r]);if(qr)for(var r of qr(e))li.call(e,r)&&Hr(t,r,e[r]);return t};const Yt=Pe("score-reader:utils:tremoloUtils");function Kr(t,e=3){let r=di(2,e);return t>=2&&(r*=t),r>32&&(r=32),r}function pi(t,e,r){Yt(`build friction tremolo with ${e} strokes of duration ${r}`);const n=[],{velocity:o}=t,{pattern:a}=ii.tremolo;let{startTime:s}=t;for(let i=0;i<e;i++){const u=be({},t),c=a[i%a.length];u.startTime=s,u.duration=r+c.durationDiff,u.velocity=Math.max(i%2===1?o:o-2,4),n.push(u),s+=u.duration}return n}function fi(t,e,r){Yt(`build alternate tremolo with ${e} strokes of duration ${r}`);const n=[],{velocity:o}=t;let a=t.startTime;for(let s=0;s<e;s++){const i=be({},t);i.startTime=a,i.duration=Math.random()*1e-4+r-5e-5,i.velocity=Math.round(Math.random()*12)+o-12,"unpitched"in t,n.push(i),a+=i.duration}return n}function mi(t,e,r){Yt(`build vibrato tremolo with ${e} strokes of duration ${r}`);const n=1/r/2,o=[];return t.automations={velocity:[{effect:"vibrato",startTime:t.startTime,duration:t.duration,frequency:n,depth:.3,target:t.velocity}]},o.push(t),o}function gi(t,e,r){Yt(`build strum tremolo with ${e} strokes of duration ${r}`);const{velocity:n}=t;let{startTime:o}=t;const a=[];for(let s=0;s<e;s++){const i=Math.random()*.001+r-5e-4,u=Math.round(Math.random()*64)+n-64,c=be({},t);c.startTime=o,c.duration=i,c.velocity=u,a.push(c),o+=i}return a}const Zt={buildTremoloFriction:pi,buildTremoloAlternate:fi,buildTremoloVibrato:mi,buildTremoloStrum:gi},rc={findTremoloStrokesNumber:Kr,tremoloBuildingFunctions:Zt};var hi=Object.defineProperty,_i=Object.defineProperties,Mi=Object.getOwnPropertyDescriptors,Wr=Object.getOwnPropertySymbols,vi=Object.prototype.hasOwnProperty,yi=Object.prototype.propertyIsEnumerable,$r=(t,e,r)=>e in t?hi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,At=(t,e)=>{for(var r in e||(e={}))vi.call(e,r)&&$r(t,r,e[r]);if(Wr)for(var r of Wr(e))yi.call(e,r)&&$r(t,r,e[r]);return t},Ti=(t,e)=>_i(t,Mi(e));const dt=Pe("score-reader:extractVoiceQuarterNotes:expandSingleNoteOrnaments"),Pi="buildTremoloAlternate",Si=.0875,bi=.0875,Jr=4;function Ai(t,e){if(t.mainNote.length===0)return[t];const r=t.mainNote[0];if(!r.notations||!r.notations.ornaments)return[t];t.keySignature||(t.keySignature={fifths:0});const n=r.notations.ornaments,o=Object.keys(n);for(let a=0;a<o.length;a++){const s=o[a];if(J.A.isValid(s))return s===J.A.TRILLMARK?Qi(t,e):s===J.A.TREMOLO?wi(t,e):Vi(t,e)}return[t]}function Oi(t,e){let n=Math.min(bi,Si);const o=e.quarterDurationToSecondsAtQuarter(t.startTime,t.duration);return o/n<Jr&&(n=o/Jr),e.secondsDurationToQuarterAtQuarter(t.startTime,n)}function Ni(t,e,r){let n=e;return r?0:(t>=e*8&&(n=e*2),n)}function Ei(t,e,r){return Math.round((t-e)/r)+1}function Di(t){return t.duration}function Ii(t,e,r={fifths:0}){const n=zr.A.normalize(t,r),o=zr.A.shiftDiatonicUp(n,r);return _t(o)+e}function Qi(t,e){if("unpitched"in t)return[t];dt(`expand single trill note into note sequence: base pitch ${t.pitch}`);const r=t.mainNote[0],n=[],o=t.startTime,a=t.duration,s=Di(t),i=t.midiTranspose||0,u=Oi(t,e);dt(`trill stroke duration: ${u}`);const c=Ni(s,u,!1);dt(`trill intro duration: ${c}`);const l=Ei(s,c,u);dt(`trill strokes number: ${l}`);const p=Ii(r.pitch,i,t.keySignature),m=At({},t);m.duration=c,n.push(m);let h=o+c;for(let P=1;P<l-1;P++){const b=P%2===0?t.pitch:p,O=At({},t);O.startTime=h,O.duration=u,O.pitch=b,n.push(O),h+=u}const _=a-(h-o),y=At({},t);return y.startTime=h,y.duration=_,y.pitch=l%2===0?p:t.pitch,n.push(y),n}function Ci(t,e){let r=e.tremolo||"alternate";t.mode==="pizzicato"&&(r="strum");let o=`buildTremolo${r.charAt(0).toUpperCase()+r.slice(1)}`;return Zt[o]||(o=Pi),o}function wi(t,e){const r=t.mainNote[0],n=t.soundId||"1",o=ut[n]||Rt[n];if("unpitched"in t)return dt(`drum roll already handled for base note ${t.unpitched}, skipping note expansion.`),[t];if(dt(`expand single tremolo note into notes sequence: base pitch ${t.pitch}`),M.default.hasTremoloSide(r))return dt("double note tremolo already handled, skipping note expansion."),[t];const a=r.notations.ornaments,s=t.duration,i=a[J.A.TREMOLO]||a[J.A.BUZZ],u=Number.parseInt(i.content,10),c=Kr(s,u),l=s/c;if(o===void 0)throw new Error(`Unknown instrument ${n}`);const p=Ci(t,o);if(!Zt[p])throw new Error(`Unknown tremolo function ${p}`);return Zt[p](t,c,l)}function Ri(t,e,r){let{duration:n}=t;e.glissando&&(n/=2);let o=.25;for(;o*r>n;)o/=2;return o}function xi(t,e){let n=t;return e?n+=6:e&&(n-=6*2),n<12&&(n=12),n}function Vi(t,e){if("unpitched"in t)return[t];dt(`expand single note with ornaments into note sequence: base pitch ${t.pitch}`);const r=t.mainNote[0],n=[],o=r.notations.ornaments,a=t.startTime,s=t.duration,i=Br(o);if(i===null)return[t];const u=structuredClone(o[i]),c=Ti(At({},u),{originalPitch:r.pitch,transposition:t.midiTranspose}),p={currentAccidental:M.default.getAlter(r),previousAccidentals:{}};t.harmonicContext!==void 0&&t.harmonicContext.previousAccidentals!==void 0&&(p.previousAccidentals=t.harmonicContext.previousAccidentals);let m={fifths:0};t.keySignature!==void 0&&(m=t.keySignature);const h=kr(i,c,m,p),_=h.length,y=Ri(t,o,_),P=_/2;let b=0,O=a,N;for(N=0;N<_-1;N++){const k=h[N],z=At({},t);z.startTime=O,z.pitch=k,z.duration=y,z.velocity=xi(t.velocity,N>P),n.push(z),O+=y,b+=y}const E=At({},t);let G=s-b;return o.glissando&&(G=y),E.startTime=O,E.pitch=h[N],E.duration=G,n.push(E),n}function Ui(t,e,r,n,o,a){const s=a.getPlayOrderQuarterMapping(),i=a.getPlayOrder(),u=a.getScoreOrderQuarterMapping(),c=a.getVelocityMapping(),l=a.getSustainMapping(),m=a.getInstrumentMapping().getSoundIdForPartIdx(e),h=l.getSustainEntriesAtPartIdx(e),_=a.getScoreDataCache(),y=a.getModeMapping(),P=a.getSwingMapping(),b=y.getPartModeEntries(e),O=a.getKeySignatureMapping(),N=le(t,s,u,i,o.getContinuedNotes,h,P),E=jo(_,e,n,r,N,h,u,O,o.addNotesLocations);N.length&&E.length&&Ps(N,E,{scoreDataCache:_,scoreOrderQuarterMapping:u,playOrderQuarterMapping:s,partIdx:e,voiceIdx:r}),dr(E,N,P);const G=a.scoreData.getMeasure(e,0),[k]=v.default.getStaffDetails(G),z=a.getTimeMapping();let B=er(E,e,m,k);const et=B.length&&"pitch"in B[0],q=!et;et&&(B=Cr(B),B=Bs(B)),q&&(B=gs(B,a.getTimeMapping())),B=ni(B);let H=he(B);return Ka({quarterNotes:H,measuresList:N,modeEntries:b,scoreOrderQuarterMapping:u}),fr({quarterNotes:H,partIdx:e,staffIdx:n,measuresList:N,velocityMapping:c,scoreOrderQuarterMapping:u}),H=H.flatMap(st=>Ai(st,z)),vr(H,z,o.omitNonLegatoGaps),Ms(H),as({quarterNotes:H,partIdx:e,measuresList:N,sustainMapping:l,scoreOrderQuarterMapping:u}),Dr(H,t,o.getContinuedNotes)}function Li(t,e){return e.flatMap(n=>{let o=t.getMeasureMetronomeNotes(n.scoreMeasureIdx);return o=o.filter(s=>{const i=n.toQuarter,u=n.fromQuarter;return s.relativeQuarterPosition>=i?!1:s.relativeQuarterPosition>=u}),o.map(s=>{const{relativeQuarterPosition:i,quarterDuration:u,hasLeftConnection:c,hasRightConnection:l,graceChords:p,notes:m,midiNotes:h,mainNote:_,midiTranspose:y,effects:P}=s;return{quarterPosition:i+n.audioMeasureQuarterPosition,quarterDuration:u,hasLeftConnection:c,hasRightConnection:l,graceChords:p,notes:m,midiNotes:h,mainNote:_,midiTranspose:y,effects:P,muteModes:m.map(()=>null)}})})}const Yr=100,zi=60,Fi=61;function Bi(t,e){const r=e.getPlayOrderQuarterMapping(),n=e.getPlayOrder(),o=e.getScoreOrderQuarterMapping(),i=le(t,r,o,n,!1,[]),u=e.getScoreDataCache(),c=Li(u,i),l=er(c,-1,"metronome");return l.forEach(p=>{p.velocity=Yr}),he(l)}function Zr(t,e){const r=e.getPlayOrder(),n=e.getTempoMapping(),o=e.getScoreDataCache(),a=e.getPlayOrderQuarterMapping(),s=a.measureIdxToQuarter(t),i=n.getSpqAtQuarter(s),l=(ji(t,a)-s)*i,p=r.audioToScoreMeasureIdx(t),h=o.getMeasureMetronomeNotes(p).map(_=>{if(_.midiNotes===null)throw new Error("Unexpected");return{startTime:_.relativeQuarterPosition*i,duration:_.quarterDuration*i,velocity:Yr,unpitched:_.midiNotes[0],soundId:"metronome",partIdx:-1}});return{duration:l,notes:h}}function ji(t,e){return t<e.measuresList.length-1?e.measureIdxToQuarter(t+1):e.getQuarterDuration()}function Gi(t,e){const r=new Map;if(e==null){const n=t.getNbParts();for(let o=0;o<n;o++){const a=t.getPartVoicesIndexes(o);r.set(o,{voices:a})}}else e.forEach((n,o)=>{const a=t.getPartIdxFromUuid(o);if(n===!0){const s=t.getPartVoicesIndexes(a);r.set(a,{voices:s})}else{const s=new Set;n.voices.forEach(u=>{const c=t.getPartVoiceIdxFromUuid(a,u);s.add(c)}),n.staves.forEach(u=>{const c=t.getPartStaffIdxFromUuid(a,u);t.getPartStaffVoicesIndexes(a,c).forEach(p=>s.add(p))});const i=[...s.keys()];r.set(a,{voices:i})}});return r}function ki(t,e){const{getContinuedNotes:r,parts:n,includeMetronome:o,omitNonLegatoGaps:a,addNotesLocations:s}=e,i=Gi(t,n||null);return{getContinuedNotes:!!r,parts:i,includeMetronome:!!o,omitNonLegatoGaps:!!a,addNotesLocations:!!s}}var qi=f(353922);const Xr={staccato:Kt,staccatissimo:Wt,tenuto:mr,"strong-accent":Me,accent:ve};function Hi(t){const e=M.default.getArticulations(t);return Object.keys(e).flatMap(r=>Xr[r]?[Xr[r]]:[])}const Ki=Hi;function Wi(t,e){if(!t.hasGrace(e))return[];const r=[],n=t.getNbGraces(e);for(let o=0;o<n;o++){let a=t.getGraceChord(e,o);a=w.default.makeArray(a),r.push({notes:w.default.makeArray(a),midiNotes:null})}return r}const $i=Wi;function Ji(t){const r=v.default.getTranspose(t)[0],n=pe.default.getChromatic(r),o=pe.default.getOctaveChange(r);return n+o*12}const tn=Ji;function Yi(t,e){const r=[];return t.forEach(n=>{const o=M.default.getInstrumentId(n),a=Fe.default.getMIDIInstrumentById(e,o),s=Number(ue.default.getUnpitched(a)),i=Number(ue.default.getMIDIProgram(a));r.push({midiKey:s,midiProgram:i})}),r}const en=Yi;var rn=f(518558);function Zi(t,e){const n=t.getMeasure(0,e),o=v.default.getAnyTime(n),a=rn.default.getNbBeats(o),s=rn.default.getBeatType(o),i=d.default.beatTypeToQuarter(s),u=1,c=[];let l=0;for(let p=0;p<a;p++){const m=l;l+=i;const h=Xi(p),_={unpitched:{}},y={relativeQuarterPosition:m,quarterDuration:i,hasLeftConnection:!1,hasRightConnection:!1,graceChords:[],effects:[],midiTranspose:0,midiNotes:[{midiProgram:h,midiKey:u}],mainNote:_,notes:[_],muteModes:[null]};c.push(y)}return c}function Xi(t){return t===0?zi:Fi}var tu=f(668674),eu=f(209175),ru=f(759240);function nu(t,e,r){const n=t.getMeasure(e,r),o=tn(n),a=0;if(!v.default.hasSlash(n,a))return[];const s=v.default.getSlash(n,a);return tu.A.isUsingStems(s)?au(n,o):ou(n,o)}function ou(t,e){const r=v.default.getDpq(t),n=v.default.getAnyTime(t),o=d.default.getBeatQuarterDuration(n),a=d.default.quarterToDuration(o,r),s=eu.default.createDefault(),i=v.default.getNbDivisions(t),u=new ru.A(0,i,a,r,s);u.dispatch();const c=u.getDispatchedRests();let l=0;return c.map(p=>{const m=d.default.divisionsToQuarter(p,r),h={},_={relativeQuarterPosition:l,quarterDuration:m,hasLeftConnection:!1,hasRightConnection:!1,graceChords:[],effects:[],midiTranspose:e,midiNotes:null,mainNote:h,notes:[h],muteModes:[null]};return l+=m,_})}function au(t,e){let n=v.default.getNotes(t);const o=su(n,0);n=n.filter(u=>M.default.getVoiceIdx(u)===o&&!M.default.isGraceNote(u)&&!M.default.isChord(u));const a=[],s=v.default.getDpq(t);let i=0;return n.forEach(u=>{const c=M.default.getDuration(u),l=d.default.divisionsToQuarter(c,s);if(!M.default.isRest(u)){const p={};a.push({relativeQuarterPosition:i,quarterDuration:l,hasLeftConnection:!1,hasRightConnection:!1,graceChords:[],effects:[],midiTranspose:e,midiNotes:null,mainNote:p,notes:[p],muteModes:[null]})}i+=l}),a}function su(t,e){const r=t.find(n=>M.default.getStaffIdx(n)===e);if(!r)throw new Error(`Couldn't find a note with staff index ${e}`);return M.default.getVoiceIdx(r)}var iu=Object.defineProperty,uu=Object.defineProperties,cu=Object.getOwnPropertyDescriptors,nn=Object.getOwnPropertySymbols,lu=Object.prototype.hasOwnProperty,du=Object.prototype.propertyIsEnumerable,on=(t,e,r)=>e in t?iu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pu=(t,e)=>{for(var r in e||(e={}))lu.call(e,r)&&on(t,r,e[r]);if(nn)for(var r of nn(e))du.call(e,r)&&on(t,r,e[r]);return t},fu=(t,e)=>uu(t,cu(e));class pt{static createKey(e,r,n){return`${e}:${r}:${n}`}static createMetronomeKey(e){return`metronome:${e}`}static createChordKey(e,r){return`${e}:${r}:jazzChord`}constructor(e){Object.defineProperty(this,"scoreData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scoreData=e,this.cache=new Map}getMeasureChordNotes(e,r){const n=pt.createChordKey(e,r);this.cache.has(n)||this.cacheJazzMeasure(e,r);const o=this.cache.get(n);if(!o)throw new Error("Unexpected");return o}getMeasureMetronomeNotes(e){const r=pt.createMetronomeKey(e);this.cache.has(r)||this.cacheMetronomeMeasure(e);const n=this.cache.get(r);if(!n)throw new Error("Unexpected");return n}getMeasureVoiceNotes(e,r,n){const o=pt.createKey(e,r,n);this.cache.has(o)||this.cacheMeasure(e,r);const a=this.cache.get(o);if(!a)throw new Error("Unexpected");return a}cacheMetronomeMeasure(e){const r=pt.createMetronomeKey(e),n=Zi(this.scoreData,e);this.cache.set(r,n)}cacheJazzMeasure(e,r){const n=pt.createChordKey(e,r),o=nu(this.scoreData,e,r);this.cache.set(n,o)}cacheMeasure(e,r){const n=this.scoreData.getPartVoicesIndexes(e),o=this.scoreData.isPartUnpitched(e);n.forEach(a=>{const s=this.getChordsForMeasureVoice(e,r,a,o),i=pt.createKey(e,r,a);this.cache.set(i,s)})}getChordsForMeasureVoice(e,r,n,o){const a=this.scoreData.getMeasure(e,r),s=this.scoreData.getPartVoiceMainStaffIdx(e,n),i=new Q.A(a),u=i.getDpqValue();if(!i.hasVoice(n))return[];if(v.default.hasSlash(a,s))return[];if(v.default.hasMeasureRepeat(a,s)){const c=r-1;return c<0?[]:this.getMeasureVoiceNotes(e,c,n)}return this.getNotesForMeasureVoice(a,i,u,e,n,o)}getNotesForMeasureVoice(e,r,n,o,a,s){const i=[],u=r.getVoice(a);let c=v.default.hasLeftSlur(e,a);const l=tn(e),p=u.getNbNotes(),m=this.scoreData.getPartHeader(o),h={};let _=0;for(let y=0;y<p;y++){const P=u.getChord(y),b=w.default.makeArray(P),O=u.getNote(y),[N]=b,E=d.default.divisionsToQuarter(_,n),G=M.default.getDuration(N);_+=G;const k=d.default.divisionsToQuarter(G,n);if(!M.default.isRest(N)){M.default.hasSlurStart(N)&&(c=!0),M.default.hasSlurStop(N)&&(c=!1);const z=Ki(N),B=M.default.hasArpeggiate(O);!c&&!s&&!B&&z.push(bt);let et=null,q=$i(u,y);s?(et=en(b,m),q=q.map(K=>fu(pu({},K),{midiNotes:en(K.notes,m)}))):b.forEach(K=>{const mt=M.default.getPitch(K),fn=`${mt.step}${mt.octave}`,Ju=M.default.getAlter(K);h[fn]=Ju});const H=!!b.find(K=>Je(K)),at=!!b.find(K=>Ye(K)),st=b.map(K=>{const mt=M.default.getHead(K)===qi.A.X;return M.default.hasHeadParentheses(K)?br:mt?Ar:null}),ft={previousAccidentals:structuredClone(h)},it={relativeQuarterPosition:E,quarterDuration:k,hasLeftConnection:H,hasRightConnection:at,graceChords:q,notes:b,mainNote:O,midiTranspose:l,effects:z,midiNotes:et,harmonicContext:ft,muteModes:st};i.push(it)}}return i}}var mu=Object.defineProperty,gu=Object.defineProperties,hu=Object.getOwnPropertyDescriptors,an=Object.getOwnPropertySymbols,_u=Object.prototype.hasOwnProperty,Mu=Object.prototype.propertyIsEnumerable,sn=(t,e,r)=>e in t?mu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vu=(t,e)=>{for(var r in e||(e={}))_u.call(e,r)&&sn(t,r,e[r]);if(an)for(var r of an(e))Mu.call(e,r)&&sn(t,r,e[r]);return t},yu=(t,e)=>gu(t,hu(e));function un(t,e){const{startTime:r,duration:n,velocity:o,soundId:a,partIdx:s}=t,i=e.quarterToSeconds(r),c=e.quarterToSeconds(r+n)-i;let l;return"pitch"in t?l={startTime:i,duration:c,velocity:o,soundId:a,partIdx:s,pitch:t.pitch}:l={startTime:i,duration:c,velocity:o,soundId:a,partIdx:s,unpitched:t.unpitched},t.location&&(l.location=t.location),"release"in t&&(l.release=t.release),"muteMode"in t&&(l.muteMode=t.muteMode),"mode"in t&&(l.mode=t.mode),"automations"in t&&t.automations&&(l.automations=Tu(t.automations,e)),"guitarString"in t&&(l.guitarString=t.guitarString),l}function Tu(t,e){function r(n){const o=e.quarterToSeconds(n.startTime),a=e.quarterToSeconds(n.startTime+n.duration);return yu(vu({},n),{startTime:o,duration:a-o})}return{pitch:t.pitch?t.pitch.map(r):[],velocity:t.velocity?t.velocity.map(r):[]}}var cn=f(614653),Pu=f(726042),Su=f(364596),ln=f(902630),bu=f(851083);function Au(t,e,r){if(!fe.default.hasStaffTuning(e))throw new Error("The staff details should have tuning information");const o=ln.default.getNotes(t).map(a=>(0,bu.A)(a,e,r));return o.sort(ct.default.naiveComparePitch),o}var Ou=f(743475);const Nu=$(Pu),dn=$(cn),pn=$(fe),Eu=$(Su),Ae=$(ct),Du=$(ln),Iu=$(U),Qu=$(Ou),Cu=Eu.createC(),wu=48,Ru=12;function xu(t,e){if(dn.hasFrame(t)&&pn.hasStaffTuning(e)){const a=dn.getFrame(t),s=Du.getNbStrings(a),i=pn.getNbStaffLines(e);return s!==i?null:Iu(a,e,Cu).map(_t)}const r=Qu(t);if(r===null)return null;let o=Vu(r).map(_t);return o=Uu(o),o}function Vu(t){let e=0,r=null;return t.map(n=>{const o=Ae.create(e,n.step,n.alter);return r===null?(r=o,o):(Ae.naiveComparePitch(o,r)<0&&(e++,Ae.setOctave(o,e)),r=o,o)})}function Uu(t){const e=t.reduce(Nu.add)/t.length;let r=0;for(;e+r<wu;)r+=Ru;return t.map(n=>n+r)}function Lu(t,e){const r=new Map,n=t.getNbParts(),o=t.getNbMeasures();for(let a=0;a<n;a++){const s=[];r.set(a,s);const i=t.getMeasure(a,0),[u]=v.default.getStaffDetails(i);for(let c=0;c<o;c++){const l=t.getMeasure(a,c),p=v.default.getJazzHarmonies(l);if(p.length===0)continue;const m=e.measureIdxToQuarter(c),h=v.default.getDpq(l),y=p.map(P=>{const b=xu(P,u);if(b===null)return null;const O=cn.default.getTimePos(P),E=d.default.divisionsToQuarter(O,h)+m;return{pitches:b,quarterPosition:E}}).filter(P=>P!==null);s.push(...y)}}return r}class zu{constructor(e){Object.defineProperty(this,"jazzChordsMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.jazzChordsMap=e}getJazzChordForQuarterPos(e,r){const n=this.getJazzChordsAtPartIdx(e),o=n.findIndex(a=>a.quarterPosition>r);return o===0?null:o===-1?n.length===0?null:n[n.length-1]:n[o-1]}getJazzChordsAtPartIdx(e){const r=this.jazzChordsMap.get(e);return r||[]}}function Fu(t,e){const r=Lu(t,e);return new zu(r)}class Bu{constructor(e){Object.defineProperty(this,"entries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.entries=e}audioToScoreQuarter(e){const r=this.getEntryAtAudioQuarter(e),n=e-r.audioQuarter;return r.scoreQuarter+n}getEntryAtAudioQuarter(e){const r=this.entries.findIndex(n=>n.audioQuarter>e);if(r===0)throw new Error(`Invalid audio quarter <${e}>`);if(r===-1){if(this.entries.length===0)throw new Error(`Invalid audio quarter <${e}>`);return this.entries[this.entries.length-1]}return this.entries[r-1]}}function ju(t,e,r){return r.measuresList.map((n,o)=>{const a=t.audioToScoreMeasureIdx(o),s=e.measureIdxToQuarter(a);return{audioQuarter:n,scoreQuarter:s}})}function Gu(t,e,r){const n=ju(t,e,r);return new Bu(n)}function ku(t,e,r,n,o,a){return n.flatMap(i=>{const u=a.getKeySignatureAtScoreMeasure(e,r,i.scoreMeasureIdx);let c=t.getMeasureChordNotes(e,i.scoreMeasureIdx);return c=c.filter(p=>{const m=i.toQuarter,h=i.fromQuarter;return p.relativeQuarterPosition>=m?!1:!!(p.relativeQuarterPosition>=h||o&&p.quarterDuration+p.relativeQuarterPosition>h)}),c.map(p=>{const{relativeQuarterPosition:m,quarterDuration:h,hasLeftConnection:_,hasRightConnection:y,graceChords:P,notes:b,midiNotes:O,mainNote:N,midiTranspose:E,effects:G}=p;return{quarterPosition:m+i.audioMeasureQuarterPosition,quarterDuration:h,hasLeftConnection:_,hasRightConnection:y,graceChords:P,notes:b,midiNotes:O,mainNote:N,midiTranspose:E,effects:G,keySignature:u,muteModes:b.map(()=>null)}})})}const qu="303";function Hu(t,e,r,n,o){return t.flatMap(s=>Ku(s,e,r,n,o))}function Ku(t,e,r,n,o){const{quarterPosition:a,quarterDuration:s,hasLeftConnection:i,hasRightConnection:u,mainNote:c,midiTranspose:l,keySignature:p,harmonicContext:m}=t,h=o.audioToScoreQuarter(a),_=n.getJazzChordForQuarterPos(e,h);if(!_)return[];const y=100,P=r||qu;return _.pitches.map(b=>({startTime:a,duration:s,hasLeftConnection:i,hasRightConnection:u,mainNote:[c],note:[c],midiTranspose:l,velocity:y,soundId:P,partIdx:e,effects:[bt],pitch:b+l,originalPitch:b+l,keySignature:p,harmonicContext:m}))}function Wu(t,e,r,n,o){const a=o.getPlayOrderQuarterMapping(),s=o.getPlayOrder(),i=o.getScoreOrderQuarterMapping(),u=o.getVelocityMapping(),c=o.getSustainMapping(),l=o.getInstrumentMapping(),p=o.getSwingMapping(),m=l.getSoundIdForPartIdx(e),h=c.getSustainEntriesAtPartIdx(e),_=o.getScoreDataCache(),y=o.getKeySignatureMapping(),P=le(t,a,i,s,n.getContinuedNotes,h,p),b=ku(_,e,r,P,n.getContinuedNotes,y);dr(b,P,p);const O=o.getJazzChordMapping(),N=o.getAudioScoreQuarterMapping();let E=Hu(b,e,m,O,N);E.length&&"pitch"in E[0]&&(E=Cr(E));const k=he(E);fr({quarterNotes:k,partIdx:e,staffIdx:r,measuresList:P,velocityMapping:u,scoreOrderQuarterMapping:i});const z=o.getTimeMapping();return vr(k,z),Dr(k,t,n.getContinuedNotes)}class $u{constructor(e,r=!1){Object.defineProperty(this,"scoreData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tempoMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playOrderQuarterMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scoreOrderQuarterMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"velocityMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playOrder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"swingMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keySignatureMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sustainMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"instrumentMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modeMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scoreOrder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scoreDataCache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"jazzChordMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audioScoreQuarterMapping",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatsAfterJump",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scoreData=e,this.timeMapping=null,this.tempoMapping=null,this.playOrderQuarterMapping=null,this.scoreOrderQuarterMapping=null,this.playOrder=null,this.swingMapping=null,this.keySignatureMapping=null,this.scoreOrder=null,this.scoreDataCache=null,this.velocityMapping=null,this.sustainMapping=null,this.instrumentMapping=null,this.modeMapping=null,this.jazzChordMapping=null,this.audioScoreQuarterMapping=null,this.repeatsAfterJump=r}getMetronomeCountdownAtAudioMeasure(e){return Zr(e,this)}getMetronomeCountdownAtScoreMeasure(e){const n=this.getPlayOrder().scoreToFirstAudioMeasureIdx(e);return Zr(n,this)}getAudioNotesInRange(e,r={}){const n=this.secondsToQuarterRange(e),o=ki(this.scoreData,r),a=[];if(o.parts.forEach((s,i)=>{const u=this.getPartAudioNotesInRange(n,i,s,o);a.push(...u)}),r.includeMetronome){const s=this.getMetronomeNotesInRange(n);a.push(...s)}return a}secondsToQuarterRange(e){const r=this.getTimeMapping(),n=r.secondsToQuarter(e.from),o=r.secondsToQuarter(e.to);return{from:n,to:o}}scoreMeasureIdxToSeconds(e){const n=this.getPlayOrder().scoreToFirstAudioMeasureIdx(e),a=this.getPlayOrderQuarterMapping().measureIdxToQuarter(n);return this.getTimeMapping().quarterToSeconds(a)}getMetronomeNotesInRange(e){const r=this.getTimeMapping();return Bi(e,this).map(a=>un(a,r))}getPartAudioNotesInRange(e,r,n,o){const a=this.getTimeMapping(),s=n.voices.flatMap(u=>this.getVoiceQuarterNotesInRange(e,r,u,o));return s.push(...this.getJazzChordQuarterNotesInRange(e,r,o)),s.map(u=>un(u,a))}getJazzChordQuarterNotesInRange(e,r,n){return Wu(e,r,0,n,this)}getVoiceQuarterNotesInRange(e,r,n,o){const a=this.scoreData.getPartVoiceMainStaffIdx(r,n);return Ui(e,r,n,a,o,this)}getSecondsDuration(){return this.getTimeMapping().getSecondsDuration()}getTimeMapping(){if(this.timeMapping===null){const e=this.getTempoMapping(),r=this.getPlayOrderQuarterMapping();this.timeMapping=j(e,r)}return this.timeMapping}getTempoMapping(){if(this.tempoMapping===null){const e=this.getPlayOrderQuarterMapping(),r=this.getScoreOrderQuarterMapping(),n=this.getPlayOrder();this.tempoMapping=yn(this.scoreData,{quarterMapping:e,scoreQuarterMapping:r,playOrder:n})}return this.tempoMapping}getPlayOrderQuarterMapping(){if(this.playOrderQuarterMapping===null){const e=this.getPlayOrder();this.playOrderQuarterMapping=Oe(this.scoreData,e)}return this.playOrderQuarterMapping}getScoreOrderQuarterMapping(){if(this.scoreOrderQuarterMapping===null){const e=this.getScoreOrder();this.scoreOrderQuarterMapping=Oe(this.scoreData,e)}return this.scoreOrderQuarterMapping}getPlayOrder(){return this.playOrder===null&&(this.playOrder=Vn(this.scoreData,this.repeatsAfterJump)),this.playOrder}getSwingMapping(){return this.swingMapping===null&&(this.swingMapping=Bn(this.scoreData)),this.swingMapping}getKeySignatureMapping(){return this.keySignatureMapping===null&&(this.keySignatureMapping=Ao(this.scoreData)),this.keySignatureMapping}getScoreOrder(){return this.scoreOrder===null&&(this.scoreOrder=Gn(this.scoreData)),this.scoreOrder}getVelocityMapping(){if(this.velocityMapping===null){const e=this.getScoreOrderQuarterMapping();this.velocityMapping=So(this.scoreData,e)}return this.velocityMapping}getSustainMapping(){if(this.sustainMapping===null){const e=this.getScoreOrderQuarterMapping();this.sustainMapping=Co(this.scoreData,e)}return this.sustainMapping}getInstrumentMapping(){return this.instrumentMapping===null&&(this.instrumentMapping=Ro(this.scoreData)),this.instrumentMapping}getModeMapping(){if(this.modeMapping===null){const e=this.getScoreOrderQuarterMapping();this.modeMapping=Fo(this.scoreData,e)}return this.modeMapping}getScoreDataCache(){return this.scoreDataCache===null&&(this.scoreDataCache=new pt(this.scoreData)),this.scoreDataCache}getJazzChordMapping(){if(this.jazzChordMapping===null){const e=this.getScoreOrderQuarterMapping();this.jazzChordMapping=Fu(this.scoreData,e)}return this.jazzChordMapping}getAudioScoreQuarterMapping(){if(this.audioScoreQuarterMapping===null){const e=this.getPlayOrder(),r=this.getScoreOrderQuarterMapping(),n=this.getPlayOrderQuarterMapping();this.audioScoreQuarterMapping=Gu(e,r,n)}return this.audioScoreQuarterMapping}}}}]);})();


//# debugId=ccd39c15-7ffd-57c5-87d8-64d33eae450a
