
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="6fbd984a-fd96-5ae4-8608-0a5bc89dd22a")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[24651],{1807:(b,v,r)=>{"use strict";r.d(v,{A:()=>a});var f=r(721687),p=r(909696),m=r(775),i=r(130179),s=r(653154),u=r(674548),l=r(706305),d=r(115548),g=r(744056),t=(e,o,n)=>new Promise((h,_)=>{var U=E=>{try{y(n.next(E))}catch(M){_(M)}},P=E=>{try{y(n.throw(E))}catch(M){_(M)}},y=E=>E.done?h(E.value):Promise.resolve(E.value).then(U,P);y((n=n.apply(e,o)).next())});class a extends f.A{constructor({scoreId:o,revisionId:n="last",sharingKey:h,account:_,store:U,canPreloadDrawerFont:P="false",getCustomUnpitched:y=null}){super({scoreId:o,revisionId:n,sharingKey:h,account:_,store:U,logError:s.vV,canPreloadDrawerFont:P,getCustomUnpitched:y});const E=(0,l.j)();this.scoreMetas=E.scores[o]}getRevisionId(){return this.revisionId}getRevision(o){return t(this,null,function*(){const{data:n}=yield this.fetchRevision(o);return n})}loadRevision(){return t(this,arguments,function*(o="last",{autoSetReady:n=!0}={}){const h=yield this.fetchRevision(o);return this.data=(0,g.IG)(h.data),this.revisionId=h.revisionId,this.revisionDate=h.revisionDate,(0,p.q6)().setDisplayedRevision(this.revisionId),yield this.storeRevision(h),this.setData(this.data,{autoSetReady:n}),this.updatePageTitle(),this.adagioData})}updateRevisionId(o){return t(this,null,function*(){this.revisionId=o,(0,p.q6)().setDisplayedRevision(this.revisionId);const n=(0,i.I1)(),h=yield this.fetchRevision(o);this.revisionDate=h.revisionDate,yield this.storeRevision(h)})}storeRevision(o){return t(this,arguments,function*({revisionId:n,revisionDate:h,data:_,_source:U}){if(U!=="offline")try{yield(0,i.I1)().addScoreRevision(this.scoreId,n,h,_)}catch(P){(0,s.vV)(P)}})}fetchRevisionData(o){return this.loadRevision("last",o)}saveNewRevision(o,n){return t(this,arguments,function*(h,_,{autosave:U=!1,description:P,context:y,override:E,parentRevisionId:M,deviceId:L,deviceType:D,instanceId:c}={}){const A=typeof h=="string"?h:JSON.stringify(h),x=yield m.Ay.createRevision({score:this.scoreId,body:{autosave:U,data:A,history:_,description:u.MR.t(P||"flat:score.save-default-message"),context:y,override:E,parentRevisionId:M,deviceId:L,deviceType:D,instanceId:c}});return this.revision=x,this.revisionId=x.id,(0,p.q6)().setDisplayedRevision(this.revisionId),yield this.storeRevision({revisionId:x.id,revisionDate:new Date(x.date),data:JSON.parse(A)}),x})}initActions(...o){super.initActions(...o),this.scoreActions.on("redraw",()=>{this.updatePageTitle()})}fetchRevision(o){return t(this,null,function*(){const n=yield m.Ay.getRevisionData({score:this.scoreId,revision:o||this.revisionId||"last",params:{sharingKey:this.sharingKey}});return{data:n.data,revisionId:n.headers["x-flat-score-revision"],revisionDate:new Date(n.headers["x-flat-score-revision-date"]),_source:n._source}})}updatePageTitle(){this.adagioData.hasTitle()&&(0,d.A)(this.adagioData.getTitle())}}},11812:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(567099);class p{constructor({elem:i,pos:s,color:u,scoreData:l}){this.elem=i,this.type="pageBreak",i.classList[0]==="nextPageBreak"?this.pos=(0,f.A)(l,Object.assign({},s)):this.pos=s,this.color=u}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(i){i.style.fill=this.color,i.style.stroke=this.color}cleanElem(i){i.style.fill="",i.style.stroke=""}}},34432:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,color:s,svgTools:u}){this.elem=m,this.type=m.classList[0],this.color=s;const l=u.findParent(m,"measure");this.pos=Object.assign({},i),this.pos.measureUuid=l.getAttribute("data-adagio-measure-uuid")}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(m){m.style.fill=this.color}cleanElem(m){m.style.fill=""}}},44322:(b,v,r)=>{"use strict";r.d(v,{Ae:()=>E,NA:()=>D,Rg:()=>L,Wm:()=>M,q6:()=>_});var f=r(737903),p=r(476943);function m(c){return typeof c.partUuid=="string"?c.partUuid:null}function i(c,A){const x=m(c);x!==null&&(A.partUuid=x)}function s(c){return typeof c.staffUuid=="string"?c.staffUuid:null}function u(c,A){const x=s(c);x!==null&&(A.staffUuid=x)}function l(c){return typeof c.voiceUuid=="string"?c.voiceUuid:null}function d(c,A){const x=l(c);x!==null&&(A.voiceUuid=x)}function g(c,A){c.graceIdx==="number"&&(A.graceIdx=c.graceIdx)}function t(c,A){if(p.default.isObject(c.pitch)){A.pitch=(0,f.default)(c.pitch);return}if(p.default.isObject(c.toPitch)){A.pitch=(0,f.default)(c.toPitch);return}if(p.default.isObject(c.unpitched)){A.unpitched=(0,f.default)(c.unpitched);return}p.default.isObject(c.toUnpitched)&&(A.toUnpitched=(0,f.default)(c.toUnpitched))}function a(c,A){p.default.isObject(c.fretData)&&(A.string=c.fretData.string)}function e(c){return typeof c.measureUuid=="string"?c.measureUuid:p.default.isArray(c.measureUuids)?c.measureUuids[0]:typeof c.startMeasureUuid=="string"?c.startMeasureUuid:null}function o(c,A){const x=e(c);x!==null&&(A.measureUuid=x)}function n(c,A){if(typeof c.timePos=="number")A.timePos=c.timePos;else if(typeof c.startTimePos=="number")A.timePos=c.startTimePos;else return;typeof c.dpq=="number"?A.dpq=c.dpq:typeof c.divisions=="number"?A.dpq=c.divisions:typeof c.startDpq=="number"?A.dpq=c.startDpq:typeof c.startDivisions=="number"&&(A.dpq=c.startDivisions)}function h(c){return c.synchronizer.localGroups}function _(c){const A=h(c);if(A.length===0)return null;const x=A.length,R=A[x-1],{actions:I}=R,W=I.length;if(W===0)return null;const B=I[W-1].args,N={};return i(B,N),u(B,N),d(B,N),o(B,N),n(B,N),t(B,N),a(B,N),N}function U(c){return typeof c.measureUuid=="string"?c.measureUuid:p.default.isArray(c.measureUuids)?c.measureUuids[0]:typeof c.stopMeasureUuid=="string"?c.stopMeasureUuid:null}function P(c,A){const x=U(c);x!==null&&(A.measureUuid=x)}function y(c,A){if(typeof c.timePos=="number")A.timePos=c.timePos;else if(typeof c.stopTimePos=="number")A.timePos=c.stopTimePos;else return;typeof c.dpq=="number"?A.dpq=c.dpq:typeof c.divisions=="number"?A.dpq=c.divisions:typeof c.stopDpq=="number"?A.dpq=c.stopDpq:typeof c.stopDivisions=="number"&&(A.dpq=c.stopDivisions)}function E(c){const A=h(c);if(A.length===0)return null;const x=A.length,R=A[x-1],{actions:I}=R,W=I.length;if(W===0)return null;const B=I[W-1].args,N={};return i(B,N),u(B,N),d(B,N),P(B,N),y(B,N),g(B,N),t(B,N),a(B,N),N}function M(c,A){let x=null;typeof c.partUuid=="string"&&(A.hasPartUuid(c.partUuid)||(delete c.partUuid,delete c.staffUuid,delete c.voiceUuid)),typeof c.staffUuid=="string"&&(x===null&&(x=A.getPartIdxFromUuid(c.partUuid)),A.hasPartStaffUuid(x,c.staffUuid)||(delete c.staffUuid,delete c.voiceUuid)),typeof c.voiceUuid=="string"&&(x===null&&(x=A.getPartIdxFromUuid(c.partUuid)),A.hasPartVoiceUuid(x,c.voiceUuid)||delete c.voiceUuid),typeof c.measureUuid=="string"&&(A.hasMeasureUuid(c.measureUuid)||delete c.measureUuid)}function L(c,A){typeof c.partUuid=="undefined"&&(c.partIdx=A.partIdx),typeof c.staffUuid=="undefined"&&(c.staffIdx=A.staffIdx),typeof c.voiceUuid=="undefined"&&(c.voiceIdxInStaff=A.voiceIdxInStaff),typeof c.measureUuid=="undefined"&&(c.measureIdx=A.measureIdx),typeof c.timePos=="undefined"&&(c.noteIdx=A.noteIdx),typeof c.pitch=="undefined"&&typeof c.unpitched=="undefined"&&(c.line=A.line)}function D(c,A){typeof c.string=="undefined"&&typeof A.string!="undefined"&&(c.string=A.string)}},135239:(b,v,r)=>{"use strict";r.d(v,{A:()=>m});var f=r(646036),p=r(400834);class m extends p.A{constructor({elem:s,pos:u,color:l,scoreData:d,adagioCursor:g,svgTools:t,scoreActions:a,cursor:e}){super(t,u,d),this.elem=s,this.type="dynamic",this.scoreData=d,this.color=l,this.adagioCursor=g,this.scoreActions=a,this.dynamicUuid=this.elem.getAttribute("data-adagio-dynamic-uuid"),this.dynamicData=this.scoreData.getDynamicDataAtUuid({partUuid:u.partUuid,staffUuid:u.staffUuid,voiceUuid:u.voiceUuid,measureUuid:u.measureUuid,dynamicUuid:this.dynamicUuid}),this.cursor=e,this.cursor.changeFocus(this.pos),this.cursor.hideCursor(),this.rangeAutoScroll=new f.A,this.buildLocationOrigin(this.dynamicData)}clearElem(){this.cleanElem(this.elem)}highLight(){this.colorElem(this.elem)}move(s,{refAction:u,refEvent:l}){var d,g;const t=s.posX;this.checkUpDownSide(t.line),this.elem.style.visibility="hidden",this.opts=Object.assign({},t),this.opts.style=this.dynamicData.style,this.opts.placement=this.location.placement,this.opts.sound=this.dynamicData.sound;const a=this.adagioCursor.drawDynamicCursor(t,this.location.placement,this.dynamicData.style);a&&a.length>0&&this.colorElem(a[0].elem),this.rangeAutoScroll.init({refAction:u,refEvent:l,verticalViewport:(d=this.cursor)==null?void 0:d.verticalScrollableElement,horizontalViewport:(g=this.cursor)==null?void 0:g.horizontalScrollableElement,rawRangeRects:[]})}up(){this.scoreActions.executePublicAction("moveSelectedDynamic"),this.adagioCursor.removeCursor()}colorElem(s){s.style.fill=this.color}cleanElem(s){s.style.fill=""}}},168160:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(985896);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="pluckedRange-anchor",this.notationType="pluckedRange",this.anchorClass="pluckedRange-anchor",this.uuidAttribute="data-adagio-pluckedRange-uuid",this.moveAction="moveSelectedPluckedRange",this.adagioDrawMethod="drawPluckedRangeCursor",this.notation=this.svgTools.findParent(i,this.notationType),this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.pluckedRangeData=this.scoreData.getPluckedRangeDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,pluckedRangeUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.pluckedRangeData),this.buildLocationOrigin(this.pluckedRangeData),this.fixSide(),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},173240:(b,v,r)=>{"use strict";r.d(v,{A:()=>t});var f=r(269352),p=r(748803),m=r(247739),i=r(737903),s=r(351277),u=(a,e,o)=>new Promise((n,h)=>{var _=y=>{try{P(o.next(y))}catch(E){h(E)}},U=y=>{try{P(o.throw(y))}catch(E){h(E)}},P=y=>y.done?n(y.value):Promise.resolve(y.value).then(_,U);P((o=o.apply(a,e)).next())});const l="data-adagio-template-lock",d="notehead-anchor";function g(a){return Array.from(a.querySelectorAll(".staffLines > line"))[1].getAttribute("y1")}class t{constructor({elem:e,pos:o,color:n,scoreData:h,svgTools:_,scoreActions:U,cursor:P}){this.svgTools=_,this.type="note",this.color=n,this.scoreActions=U,this.scoreData=h,this.isPartUnpitched=this.scoreData.uuidIsPartUnpitched(o.partUuid),o.line=this.svgTools.getHeadLine(e,this.svgTools.findParent(e,"staff")),this.pos=o,this.anchor=null;const y=Object.assign({},o),{config:E}=P;if(y.isConcertPitch=E.get().isConcertPitch,this.noteInfo=this.scoreData.getNoteData((0,i.default)(y)),this.measureInfo=this.scoreData.getStaffMeasure(y),this.measureInfo.multiMeasureRest!==null&&(this.elem=e,this.type="mmr"),typeof o.string!="undefined"||this.measureInfo.slash!==null||this.noteInfo.isRest){this.isDragRest=!0;return}e.attributes[l]&&(this.isLocked=!0),this.dragHead=e}highLight(){}move(e){const{posX:o}=e;if(!this.isDragRest&&!this.isLocked&&s.default.MAX_LINE>o.line&&s.default.MIN_LINE<o.line&&this.samePos(this.pos,o)){const{line:n}=e.posX,h=5-n,_=this.svgTools.svg[0].node();let U=this.dragHead.transform.baseVal.getItem(0).matrix;U.f=0,U=U.translate(0,h*this.svgTools.spaceLine/this.svgTools.scaling),this.dragHead.transform.baseVal.initialize(_.createSVGTransformFromMatrix(U)),this.opts=Object.assign({},e.posX)}}up(){return u(this,null,function*(){if(!this.isDragRest&&!this.isLocked){if(this.getNoteAtLine(this.noteInfo,this.measureInfo,this.opts.line)!==null||s.default.MAX_LINE<this.opts.line||s.default.MIN_LINE>this.opts.line){this.resetElementPosition();return}this.opts.fromLine=this.pos.line,this.opts.toLine=this.opts.line;try{yield this.scoreActions.executePublicAction("changePitch",{},{canFail:!0})}catch(e){if(!(e instanceof p.default||e instanceof m.A))throw e;this.resetElementPosition()}}})}resetElementPosition(){const e=5-this.pos.line,o=this.svgTools.svg[0].node();let n=this.dragHead.transform.baseVal.getItem(0).matrix;n.f=0,n=n.translate(0,e*this.svgTools.spaceLine/this.svgTools.scaling),this.dragHead.transform.baseVal.initialize(o.createSVGTransformFromMatrix(n))}clearElem(){this.cleanAnchor()}samePos(e,o){return e.partUuid===o.partUuid&&e.staffUuid===o.staffUuid&&e.measureUuid===o.measureUuid&&e.noteIdx===o.noteIdx}getNoteAtLine(e,o,n){if(!e.isRest&&typeof n!="undefined"&&o.slash!==null){for(let h=0;h<e.lines.length;h++)if(e.lines[h]===n)return h}return null}drawAnchor(e){this.cleanAnchor();const o=this.svgTools.findParent(e,"staff"),n=g(o);let h=e.getAttribute("transform");h=`${h} translate(${n/2})`,this.anchor=new f.A("circle"),this.anchor.attr("class",d),this.anchor.attr("r",12),this.anchor.attr("style","fill: none; stroke-width: 2px; opacity: 1; stroke: var(--f-subdue)"),this.anchor.attr("transform",h),e.parentNode.appendChild(this.anchor.node())}cleanAnchor(){this.anchor&&(this.anchor.removeFromParent(),this.anchor=null)}}},181762:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(567099);class p{constructor({elem:i,pos:s,color:u,scoreData:l}){this.elem=i,this.type="systemBreak",i.classList[0]==="nextSystemBreak"?this.pos=(0,f.A)(l,Object.assign({},s)):this.pos=s,this.color=u}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(i){i.style.fill=this.color,i.style.stroke=this.color}cleanElem(i){i.style.fill="",i.style.stroke=""}}},202415:(b,v,r)=>{"use strict";r.d(v,{V:()=>i});var f=Object.defineProperty,p=(s,u,l)=>u in s?f(s,u,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[u]=l,m=(s,u,l)=>p(s,typeof u!="symbol"?u+"":u,l);class i extends Error{constructor(u){super(u),m(this,"inputParameters"),this.name="ActionInputError"}}},207006:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(884940);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="octaveShift",this.anchorClass="octave-anchor",this.uuidAttribute="data-adagio-octaveShift-uuid",this.moveAction="moveSelectedOctaveShift",this.adagioDrawMethod="drawOctaveShiftCursor",this.notation=i,this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.octaveShiftData=this.scoreData.getOctaveShiftDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,octaveShiftUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.octaveShiftData),this.buildLocationOrigin(this.octaveShiftData),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},228424:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(884940);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="slur",this.anchorClass="slur-anchor",this.uuidAttribute="data-adagio-slur-uuid",this.notation=i,this.notationUuid=this.notation.getAttribute(this.uuidAttribute);const e=g.findParent(this.notation,"staffSlurs");this.voiceUuid=e.getAttribute("data-adagio-voice-uuid"),this.slurData=this.scoreData.getSlurDataAtUuid({partUuid:s.partUuid,voiceUuid:this.voiceUuid,slurUuid:this.notationUuid}),this.buildRectOrigin(this.slurData),this.buildLocationOrigin(this.slurData),this.updateElems()}move(){}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},257053:(b,v,r)=>{"use strict";r.d(v,{M:()=>f});const f=window.performance!==void 0&&window.performance.mark!==void 0&&window.performance.measure!==void 0},274496:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor(){this.type="credits"}remove(){}highLight(){}clearElem(){}}},281925:(b,v,r)=>{"use strict";r.d(v,{A:()=>_});var f=r(273885),p=r(398738),m=r(303953),i=r(645369),s=r.n(i),u=r(833210),l=r.n(u),d=r(616877),g=r.n(d),t=r(175145),a=(U,P,y)=>new Promise((E,M)=>{var L=A=>{try{c(y.next(A))}catch(x){M(x)}},D=A=>{try{c(y.throw(A))}catch(x){M(x)}},c=A=>A.done?E(A.value):Promise.resolve(A.value).then(L,D);c((y=y.apply(U,P)).next())});const e=s()("flat:fonts"),o=m.A.fontsApiBaseUrl||"/api/v2/fonts",n=1,h=Number.POSITIVE_INFINITY;class _{constructor({scoreData:P}={}){this.scoreData=P,this.usedFonts={},this.loadedWebFonts={},this.preloadWebFonts=m.A.fontsWebPreloaded||[],this.queue=new(g())(n,h)}setScoreData(P){this.scoreData=P}waitForFonts(){return new Promise(P=>{const y=[];Object.keys(this.loadedWebFonts).forEach(E=>{this.loadedWebFonts[E].split(",").forEach(M=>{const L=new(l())(E,{weight:M.includes("bold")?700:400,style:M.includes("italic")?"italic":"normal"});y.push(L.load(null,5e3))})}),Promise.all(y).then(P).catch(E=>{e("error while loading fonts: %o",E),P()})})}updateUsedFonts(){this.usedFonts={};const y=(this.scoreData.adagioData||this.scoreData).getDefaults();return p.default.values.forEach(E=>{if(E==="global")return;const M=f.A.getTextTypeFontFamily(y,E);this.usedFonts[M]=this.usedFonts[M]||[];const L=f.A.getTextTypeFontWeight(y,E),D=f.A.getTextTypeFontStyle(y,E);let c="";L==="bold"&&(c+=L),D==="italic"&&(c+=D),c.length===0&&(c="regular"),this.usedFonts[M].includes(c)||this.usedFonts[M].push(c)}),e("used fonts: %o",this.usedFonts),this.usedFonts}injectCssFonts(){const P=this.usedFonts;Object.keys(P).forEach(y=>{const E=P[y].join(",");if(this.loadedWebFonts[y]===E||this.preloadWebFonts.includes(y))return;e("loading %s @ %s",y,E);const M=`flat-font-${y.replace(/ /g,"").toLowerCase()}`,L=document.getElementById(M);L&&L.parentNode.removeChild(L);const D=document.getElementsByTagName("head")[0],c=document.createElement("link");c.id=M,c.rel="stylesheet",c.type="text/css",c.href=`${o}/${encodeURIComponent(y)}/css?variants=${E}`,c.media="all",D.appendChild(c),this.loadedWebFonts[y]=E})}loadAllFonts(){return this.queue.add(()=>a(this,null,function*(){this.usedFonts={},this.updateUsedFonts(),this.injectCssFonts()}))}getTtfList(){const P={};return Object.keys(this.usedFonts).forEach(y=>{this.usedFonts[y].forEach(E=>{let M=y;E==="bold"?M+=" Bold":E==="italic"?M+=" Italic":E==="bolditalic"&&(M+=" Bold Italic"),t.Th[M]?P[M]=t.Th[M]:P[M]=`${o}/${encodeURIComponent(y)}/ttf?variant=${E}`})}),P}}},304567:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,scoreData:s,cursor:u}){this.elem=m,this.type=m.classList[0],this.uuid=this.elem.parentNode.getAttribute("data-adagio-harmony-uuid"),this.data=s.getJazzHarmonyDataAtUuid({partUuid:i.partUuid,staffUuid:i.staffUuid,measureUuid:i.measureUuid,voiceUuid:i.voiceUuid,isConcertPitch:u.isConcertPitch,harmonyUuid:this.uuid}),this.pos={partIdx:this.data.partIdx,partUuid:this.data.partUuid,measureIdx:this.data.measureIdx,measureUuid:this.data.measureUuid,voiceIdxInStaff:this.data.voiceIdxInStaff,voiceUuid:this.data.voiceUuid,staffUuid:this.data.staffUuid,staffIdx:this.data.staffIdx,noteIdx:this.data.noteIdx,timePos:this.data.timePos,dpq:this.data.dpq,harmonyUuid:this.uuid}}remove(){}highLight(){}clearElem(){this.cleanElem(this.elem)}cleanElem(m){let i=m.getElementsByTagName("line");i=[].slice.call(i),i.forEach(s=>{s.style.stroke=""}),m.style.fill=""}}},311856:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(985896);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="tempo-anchor",this.notationType="tempoChange",this.anchorClass="tempo-anchor",this.uuidAttribute="data-adagio-tempochange-uuid",this.moveAction="moveSelectedTempoChange",this.adagioDrawMethod="drawTempoChangeCursor",this.notation=this.svgTools.findParent(i,this.notationType),this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.tempoChangeData=this.scoreData.getTempoChangeDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,tempoChangeUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.tempoChangeData),this.buildLocationOrigin(this.tempoChangeData),this.fixSide(),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},378781:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(985896);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="slur-anchor",this.notationType="slur",this.anchorClass="slur-anchor",this.uuidAttribute="data-adagio-slur-uuid",this.moveAction="moveSelectedSlur",this.adagioDrawMethod="drawSlurCursor",this.notation=this.svgTools.findParent(i,this.notationType),this.notationUuid=this.notation.getAttribute(this.uuidAttribute);const e=g.findParent(this.notation,"staffSlurs");this.voiceUuid=e.getAttribute("data-adagio-voice-uuid"),this.pos.voiceUuid=this.voiceUuid,this.slurData=this.scoreData.getSlurDataAtUuid({partUuid:s.partUuid,voiceUuid:this.voiceUuid,slurUuid:this.notationUuid}),this.buildRectOrigin(this.slurData),this.buildLocationOrigin(this.slurData),this.fixSide(),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}move(i,{refAction:s,refEvent:u}){var l,d;const g=i.posX;if(this.pos.staffUuid===g.staffUuid&&this.pos.voiceUuid===g.voiceUuid&&this.pos.partUuid===g.partUuid&&(this.opts=this.buildOpt(g,i.isLeftOfNote),!this.left&&this.opts.stopNoteIdx>0&&this.opts.stopNoteIdx--),this.opts){this.notationElems.forEach(a=>{a.style.visibility="hidden"}),this.opts.voiceUuid=this.pos.voiceUuid;const t=this.adagioCursor[this.adagioDrawMethod](this.opts,this.location);if(t&&t.length>0){const a=t.map(o=>o.elem),e=this.getElemsFromRoots(a);this.colorLine(e),this.colorElem(e),this.bindAnchor(e)}}this.rangeAutoScroll.init({refAction:s,refEvent:u,verticalViewport:(l=this.cursor)==null?void 0:l.verticalScrollableElement,horizontalViewport:(d=this.cursor)==null?void 0:d.horizontalScrollableElement,rawRangeRects:[]})}}},384147:(b,v,r)=>{var f=r(922492);f.__esModule&&(f=f.default),typeof f=="string"&&(f=[[b.id,f,""]]),f.locals&&(b.exports=f.locals);var p=r(929234).A,m=p("6206eb32",f,!0,{})},400834:(b,v,r)=>{"use strict";r.d(v,{A:()=>s});var f=r(802525),p=r(596899),m=r(369252);function i(u){u.startMeasureUuid&&(u.measureUuid=u.startMeasureUuid),u.startNoteIdx&&(u.noteIdx=u.startNoteIdx,u.voiceUuid=u.startVoiceUuid),u.startTimePos&&(u.timePos=u.startTimePos,u.dpq=u.startDpq)}class s{constructor(l,d,g){this.right=!1,this.scoreData=g,this.svgTools=l,this.pos=d,this.rectOrigin={},i(d)}buildOpt(l,d){const{rectOrigin:g}=this,t={partUuid:this.pos.partUuid,staffUuid:this.pos.staffUuid};return this.left?(t.startMeasureUuid=l.measureUuid,t.startVoiceUuid=l.voiceUuid,t.startNoteIdx=l.noteIdx,t.stopMeasureUuid=g.posRight.measureUuid,t.stopVoiceUuid=g.posRight.voiceUuid,t.stopNoteIdx=g.posRight.noteIdx):(t.startMeasureUuid=g.posLeft.measureUuid,t.startNoteIdx=g.posLeft.noteIdx,t.startVoiceUuid=g.posLeft.voiceUuid,t.stopMeasureUuid=l.measureUuid,t.stopVoiceUuid=l.voiceUuid,d?t.stopNoteIdx=l.noteIdx:t.stopNoteIdx=l.noteIdx+1),t}buildRectOrigin(l){this.rectOrigin.posLeft={measureUuid:l.startMeasureUuid,noteIdx:l.startNoteIdx,voiceUuid:l.startVoiceUuid},this.rectOrigin.posRight={measureUuid:l.stopMeasureUuid,noteIdx:l.stopNoteIdx,voiceUuid:l.stopVoiceUuid}}checkUpDownSide(l){l<3?this.location.placement="below":this.location.placement="above"}buildLocationOrigin(l){this.location={type:l.type,placement:l.placement,size:l.size}}translatePos(l){let d,g;const t=(0,m.A)(this.scoreData,l,this.pos);return d=Object.assign({partUuid:this.pos.partUuid,staffUuid:this.pos.staffUuid},this.rectOrigin.posLeft),d=(0,f.A)(this.scoreData,d,t),g=Object.assign({partUuid:this.pos.partUuid,staffUuid:this.pos.staffUuid},this.rectOrigin.posRight),g=(0,p.A)(this.scoreData,g,t),{partUuid:this.pos.partUuid,staffUuid:this.pos.staffUuid,startMeasureUuid:d.measureUuid,startVoiceUuid:d.voiceUuid,startNoteIdx:d.noteIdx,stopMeasureUuid:g.measureUuid,stopVoiceUuid:g.voiceUuid,stopNoteIdx:g.noteIdx}}createFullPosition(l){return Object.assign({partUuid:this.pos.partUuid,staffUuid:this.pos.staffUuid},l)}isInversed(l){let d;return this.left?d=(0,m.A)(this.scoreData,this.createFullPosition(this.rectOrigin.posRight),l):d=(0,m.A)(this.scoreData,l,this.createFullPosition(this.rectOrigin.posLeft)),d.timePos<1}fixSide(){this.elem.classList.contains("left")?this.left=!0:this.left=!1}highlightAnchor(){!this.anchors||!this.anchors.length||(this.left?this.anchors[0].style("fill",this.color):this.anchors[1].style("fill",this.color))}}},472243:(b,v,r)=>{"use strict";r.d(v,{A:()=>m});var f=r(550594);const m={get(i,s){return f.A.get(`${f.A.apiv2baseurl}/scores/${i}/tracks`,{params:s})},create(i,s){return f.A.post(`${f.A.apiv2baseurl}/scores/${i}/tracks`,s)},update(i,s,u){return f.A.put(`${f.A.apiv2baseurl}/scores/${i}/tracks/${s}`,u)},delete(i,s){return f.A.delete(`${f.A.apiv2baseurl}/scores/${i}/tracks/${s}`)}}},473461:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,color:s,cursor:u}){this.elem=m,this.type=m.classList[0],this.pos=i,this.color=s,this.cursor=u,this.cursor.changeFocus(this.pos),this.cursor.hideCursor()}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(m){m.style.fill=this.color}cleanElem(m){m.style.fill="",[...m.getElementsByTagName("line")].forEach(i=>{i.removeAttribute("style")})}}},485344:(b,v,r)=>{"use strict";r.d(v,{A:()=>m});var f=r(680468),p=r(803002);class m{constructor({elem:s,pos:u,scoreData:l,cursor:d,rangeSelect:g,scoreActions:t}){this.elem=s,this.type=s.classList[0],this.uuid=this.elem.getAttribute("data-adagio-harmony-uuid"),this.data=l.getJazzHarmonyDataAtUuid({partUuid:u.partUuid,staffUuid:u.staffUuid,measureUuid:u.measureUuid,voiceUuid:u.voiceUuid,isConcertPitch:d.isConcertPitch,harmonyUuid:this.uuid}),this.pos={partIdx:this.data.partIdx,partUuid:this.data.partUuid,measureIdx:this.data.measureIdx,measureUuid:this.data.measureUuid,voiceIdxInStaff:this.data.voiceIdxInStaff,voiceUuid:this.data.voiceUuid,staffUuid:this.data.staffUuid,staffIdx:this.data.staffIdx,dpq:this.data.dpq,timePos:this.data.timePos},this.cursor=d,g.reset(),this.cursor.changeFocus(this.pos),(0,f.c)().hasNewJazzChordInput||this.cursor.hideCursor(),t.executePublicAction("enableChordMode"),this.clearElem()}refresh(){const s=this.cursor.svgTools.getMeasure(this.pos.partIdx,this.pos.measureIdx,0);return p.A.getElementsByClassName(s,"chord").forEach(l=>{l.getAttribute("data-adagio-harmony-uuid")===this.uuid&&(this.elem=l)}),null}remove(){}highLight(){}clearElem(){this.cleanElem(this.elem)}cleanElem(s){s.style.fill=""}}},494131:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(985896);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="octave-anchor",this.notationType="octaveShift",this.anchorClass="octave-anchor",this.uuidAttribute="data-adagio-octaveShift-uuid",this.moveAction="moveSelectedOctaveShift",this.adagioDrawMethod="drawOctaveShiftCursor",this.notation=this.svgTools.findParent(i,this.notationType),this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.octaveShiftData=this.scoreData.getOctaveShiftDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,octaveShiftUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.octaveShiftData),this.buildLocationOrigin(this.octaveShiftData),this.fixSide(),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},494458:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(884940);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="wedge",this.anchorClass="wedge-anchor",this.uuidAttribute="data-adagio-wedge-uuid",this.moveAction="moveSelectedWedge",this.adagioDrawMethod="drawWedgeCursor",this.notation=this.svgTools.findParent(i,this.type),this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.wedgeData=this.scoreData.getWedgeDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,wedgeUuid:this.notationUuid}),this.buildRectOrigin(this.wedgeData),this.buildLocationOrigin(this.wedgeData),this.updateElems()}}},506797:(b,v,r)=>{"use strict";r.d(v,{A:()=>l});var f=r(748803),p=r(247739),m=r(737903),i=r(351277),s=(d,g,t)=>new Promise((a,e)=>{var o=_=>{try{h(t.next(_))}catch(U){e(U)}},n=_=>{try{h(t.throw(_))}catch(U){e(U)}},h=_=>_.done?a(_.value):Promise.resolve(_.value).then(o,n);h((t=t.apply(d,g)).next())});const u="data-adagio-template-lock";class l{constructor({elem:g,pos:t,color:a,scoreData:e,svgTools:o,scoreActions:n,cursor:h}){this.svgTools=o,this.type="notehead",this.color=a,this.scoreActions=n,this.scoreData=e,this.isPartUnpitched=this.scoreData.uuidIsPartUnpitched(t.partUuid),t.line=this.svgTools.getHeadLine(g,this.svgTools.findParent(g,"staff")),this.pos=t;const _=Object.assign({},t),{config:U}=h;_.isConcertPitch=U.get().isConcertPitch,this.noteInfo=this.scoreData.getNoteData((0,m.default)(_)),this.measureInfo=this.scoreData.getStaffMeasure(_),this.dragHead=g,this.opts=Object.assign({},this.pos),this.hasMoved=!1,(this.measureInfo.multiMeasureRest!==null||typeof t.string!="undefined"||this.measureInfo.slash!==null||this.noteInfo.isRest||g.attributes[u])&&(this.isBlocked=!0)}highLight(){}move(g){if(this.isBlocked)return;const{posX:t}=g;if(t.staffUuid===this.pos.staffUuid&&i.default.MAX_LINE>t.line&&i.default.MIN_LINE<t.line){this.hasMoved=!0;const{line:a}=g.posX,e=5-a,o=this.svgTools.svg[0].node();let n=this.dragHead.transform.baseVal.getItem(0).matrix;n.f=0,n=n.translate(0,e*this.svgTools.spaceLine/this.svgTools.scaling),this.dragHead.transform.baseVal.initialize(o.createSVGTransformFromMatrix(n)),this.opts.toLine=a}}up(){return s(this,null,function*(){if(!this.isBlocked){if(!this.hasMoved||this.getNoteAtLine(this.noteInfo,this.measureInfo,this.opts.line)!==null||i.default.MAX_LINE<this.opts.toLine||i.default.MIN_LINE>this.opts.toLine){this.resetElementPosition();return}if(this.opts.fromLine=this.pos.line,this.opts.fromLine!==this.opts.toLine)try{yield this.scoreActions.executePublicAction("changePitch",{},{canFail:!0})}catch(g){if(!(g instanceof f.default||g instanceof p.A))throw g;this.resetElementPosition()}}})}resetElementPosition(){const g=5-this.pos.line,t=this.svgTools.svg[0].node();let a=this.dragHead.transform.baseVal.getItem(0).matrix;a.f=0,a=a.translate(0,g*this.svgTools.spaceLine/this.svgTools.scaling),this.dragHead.transform.baseVal.initialize(t.createSVGTransformFromMatrix(a))}clearElem(){}getNoteAtLine(g,t,a){if(!g.isRest&&typeof a!="undefined"&&t.slash!==null){for(let e=0;e<g.lines.length;e++)if(g.lines[e]===a)return e}return null}}},532285:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(803002);class p{constructor({elem:i,pos:s,scoreData:u,cursor:l,rangeSelect:d,scoreActions:g,svgTools:t}){this.elem=f.A.findParent(i,"figuredBass"),this.svgTools=t,this.type="figuredBass",this.uuid=this.extractUuid();const a={},e=i.getAttribute("data-adagio-figuredBass-figure-level");e&&(a.figureLvl=Number.parseInt(e,10)),this.scoreData=u,this.data=this.scoreData.getFiguredBassDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,isConcertPitch:l.isConcertPitch,figuredBassUuid:this.uuid}),this.pos={partIdx:this.data.partIdx,partUuid:this.data.partUuid,measureIdx:this.data.measureIdx,measureUuid:this.data.measureUuid,voiceIdxInStaff:this.data.voiceIdxInStaff,voiceUuid:this.data.voiceUuid,staffUuid:this.data.staffUuid,staffIdx:this.data.staffIdx,dpq:this.data.dpq,timePos:this.data.timePos},d.reset(),this.cursor=l,this.cursor.changeFocus(this.pos),this.cursor.hideCursor(),g.executePublicAction("enableFiguredBassMode",a),this.clearElem()}refreshData(){this.data=this.scoreData.getFiguredBassDataAtUuid({partUuid:this.pos.partUuid,staffUuid:this.pos.staffUuid,measureUuid:this.pos.measureUuid,voiceUuid:this.pos.voiceUuid,isConcertPitch:this.cursor.isConcertPitch,figuredBassUuid:this.uuid})}refresh(){const i=this.cursor.svgTools.getMeasure(this.pos.partIdx,this.pos.measureIdx,0);return f.A.getElementsByClassName(i,"figuredBass").forEach(u=>{u.getAttribute("data-adagio-figuredBass-uuid")===this.uuid&&(this.elem=u)}),null}extractUuid(){return this.svgTools.findParent(this.elem,"figuredBass").getAttribute("data-adagio-figuredBass-uuid")}remove(){}highLight(){}clearElem(){this.cleanElem(this.elem)}cleanElem(i){i.style.fill=""}}},591340:(b,v,r)=>{"use strict";r.d(v,{U:()=>u});var f=r(6645),p=r(744056),m=r(361744);const i=["editor","history","embed","ios","performance","viewer"],s={editor:["stScoreWrite","stOnline","stRtReady","stCurrentRevision"],viewer:["stNoop"],history:["stHistory"],embed:["stScoreWrite"],ios:["stScoreWrite"],performance:["stRecording"]},u=(0,f.nY)("scoreEditorRights",()=>{const l=(0,p.Kh)({stScoreWrite:!1,stOnline:!1,stRtReady:!1,stCurrentRevision:!1,stHistory:!1,stRecording:!1}),d=(0,p.KR)("editor"),g=(0,m.EW)(()=>s[d.value].map(n=>l[n]).filter(n=>!n).length===0);function t(n){i.includes(n)&&(d.value=n)}function a({key:n,value:h}){n.startsWith("st")||(n=n.charAt(0).toUpperCase()+n.slice(1),n=`st${n}`),l[n]=h}const e=(0,m.EW)(()=>d.value==="embed"),o=(0,m.EW)(()=>l.stScoreWrite);return{env:d,stScoreWrite:o,scoreWrite:g,isEmbed:e,setEnv:t,setState:a}})},596585:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,cursor:s,scoreActions:u,rangeSelect:l}){this.elem=m,this.type="lyricLine",this.pos=i,l.reset(),this.cursor=s,this.cursor.changeFocus(this.pos),this.cursor.hideCursor();const d=m.getAttribute("data-adagio-lyric-level"),g={};d&&(g.lyricLevel=Number.parseInt(d,10)),u.executePublicAction("enableLyricMode",g),this.clearElem()}remove(){}highLight(){}clearElem(){this.cleanElem(this.elem)}cleanElem(m){m.style.fill=""}}},610786:(b,v,r)=>{"use strict";r.d(v,{A:()=>a});var f=r(804338),p=Object.defineProperty,m=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(e,o,n)=>o in e?p(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,g=(e,o)=>{for(var n in o||(o={}))u.call(o,n)&&d(e,n,o[n]);if(s)for(var n of s(o))l.call(o,n)&&d(e,n,o[n]);return e},t=(e,o)=>m(e,i(o));class a extends f.A{constructor(o){super(o),this.type="range-select-anchor",this.pulledAnchor=this.elem.classList.contains("left")?"left":"right",this.rangeSelect=o.rangeSelect}move(o,n){this.rangeSelect.selectRange(o.posX,t(g({},n),{pulledAnchor:this.pulledAnchor}))}cleanElem(o){o.style.fill="none"}}},646036:(b,v,r)=>{"use strict";r.d(v,{A:()=>t});var f=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,l=(a,e,o)=>e in a?f(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,d=(a,e)=>{for(var o in e||(e={}))s.call(e,o)&&l(a,o,e[o]);if(i)for(var o of i(e))u.call(e,o)&&l(a,o,e[o]);return a},g=(a,e)=>p(a,m(e));class t{constructor(e={}){this.minEdgeDistance=e.minEdgeDistance||20,this.speedMultiplier=e.speedMultiplier||1,this.frequencyOfScrolls=e.frequencyOfScrolls||30,this.verticalViewport=null,this.horizontalViewport=null,this.mouseEventsBinded=!1,this.scrollInterval=null,this.prevRangeRects=null,this.handleContinuousScrollBinded=this.handleContinuousScroll.bind(this),this.stopContinuousScrollBinded=this.stopContinuousScroll.bind(this)}init({horizontalViewport:e,verticalViewport:o,refAction:n,refEvent:h,rawRangeRects:_}){this.horizontalViewport=e,this.verticalViewport=o;const U=this.parseRangeRects(_);if(!this.horizontalViewport||!this.verticalViewport)return;const P=["touchmove","mousemove"];n&&["rangeSelectDownPrivate","rangeSelectNextNotePrivate","rangeSelectUpPrivate","rangeSelectPrevNotePrivate"].includes(n)?this.autoscrollKeyboard(U):h&&P.includes(h.type)&&this.autoscrollMouse(h),this.cacheRangeRects(U)}cacheRangeRects(e){e&&(this.prevRangeRects=e)}autoscrollMouse(){!this.horizontalViewport||!this.verticalViewport||this.mouseEventsBinded||this.bindMouseEvents()}getCursorEdgeDistance(e){const o={x:this.horizontalViewport.getBoundingClientRect().x,y:this.verticalViewport.getBoundingClientRect().y},n=e.clientY-o.y,h=e.clientX-o.x,_=this.horizontalViewport.clientWidth-h,U=this.verticalViewport.clientHeight-n;return{top:n,left:h,right:_,bottom:U}}getScrollOptions(e){let o;const n=["top","bottom","right","left"],h={top:{positive:!1,scrollKey:"top"},bottom:{positive:!0,scrollKey:"top"},left:{positive:!1,scrollKey:"left"},right:{positive:!0,scrollKey:"left"}};return n.forEach(_=>{if(e[_]<this.minEdgeDistance){const P=(this.minEdgeDistance-e[_])*this.speedMultiplier,y=h[_];o={[y.scrollKey]:y.positive?P:-P}}}),o||!1}uniformMoveEvent(e){var o,n;return typeof e.clientX=="undefined"||typeof e.clientY=="undefined"?g(d({},e),{clientX:(o=e.changedTouches[0])==null?void 0:o.clientX,clientY:(n=e.changedTouches[0])==null?void 0:n.clientY}):e}handleContinuousScroll(e){const o=this.uniformMoveEvent(e),n=this.getCursorEdgeDistance(o),h=this.getScrollOptions(n);if(clearInterval(this.scrollInterval),h){const _=1e3/this.frequencyOfScrolls;this.scrollInterval=setInterval(()=>{h.top&&this.verticalViewport.scrollBy(h),h.left&&this.horizontalViewport.scrollBy(h)},_)}}bindMouseEvents(){this.mouseEventsBinded=!0,document.addEventListener("pointerup",this.stopContinuousScrollBinded),document.addEventListener("pointermove",this.handleContinuousScrollBinded)}stopContinuousScroll(){this.mouseEventsBinded=!1,document.removeEventListener("pointerup",this.stopContinuousScrollBinded),document.removeEventListener("pointermove",this.handleContinuousScrollBinded),this.scrollInterval&&clearInterval(this.scrollInterval)}autoscrollKeyboard(e){const o=this.getMorphedEdge(this.prevRangeRects,e);if(!o)return;const n=this.getMorphedEdgeDistance(o,e),h=this.shouldScrollKeyboard(n);if(h){const _=this.shouldDoShortScroll(o,h,e);this.doScroll(h,n,_)}}shouldScrollKeyboard(e){const o=["top","bottom","left","right"];let n=!1;return o.forEach(h=>{h in e&&e[h]<0&&(n=h)}),n}parseRangeRects(e){return e?e.map(o=>{const n=o.elem.getBoundingClientRect(),h=o.elem.getBBox().x,_=o.elem.getBBox().y;return Object.assign(n,{offsetLeft:h,offsetTop:_})}):[]}getMorphedEdge(e,o){if(!e||e.length===0)return!1;const n=e[0],h=o[0];return h.offsetTop!==n.offsetTop?"top":o.length!==e.length?"bottom":h.offsetLeft!==n.offsetLeft?"left":h.width!==n.width?"right":!1}getMorphedEdgeDistance(e,o){const n={x:this.horizontalViewport.getBoundingClientRect().x,y:this.verticalViewport.getBoundingClientRect().y},h=o[0],_=o[o.length-1];return e==="left"?{left:h.x-n.x,right:n.x+this.horizontalViewport.clientWidth-h.x}:e==="right"?{left:h.x+h.width-n.x,right:n.x+this.horizontalViewport.clientWidth-(h.x+h.width)}:e==="top"?{top:h.y-n.y,bottom:n.y+this.verticalViewport.clientHeight-(h.y+h.height)}:e==="bottom"?{top:_.y-n.y,bottom:n.y+this.verticalViewport.clientHeight-(_.y+_.height)}:!1}shouldDoShortScroll(e,o,n){const h={x:this.horizontalViewport.getBoundingClientRect().x,y:this.verticalViewport.getBoundingClientRect().y},_=n[0],U=n[n.length-1],P=e==="bottom"?U:_;return o==="bottom"?P.y<h.y+this.verticalViewport.clientHeight:o==="top"?P.y+P.height>h.y:!1}doScroll(e,o,n){const h=o[e],U={top:{positive:!1,scrollKey:"top",axis:"y"},bottom:{positive:!0,scrollKey:"top",axis:"y"},left:{positive:!1,scrollKey:"left",axis:"x"},right:{positive:!0,scrollKey:"left",axis:"x"}}[e],P=Math.abs(h),y=U.axis==="x"?this.horizontalViewport:this.verticalViewport,E=U.axis==="x"?y.clientWidth:y.clientHeight,M=n?P:P+E/2;y.scrollBy({[U.scrollKey]:U.positive?M:-M})}}},653934:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(680468);class p{constructor({elem:i,pos:s,scoreData:u,cursor:l,rangeSelect:d,scoreActions:g,color:t}){this.elem=i,this.type=i.classList[0],this.color=t,this.uuid=this.elem.getAttribute("data-adagio-harmony-uuid"),this.data=u.getClassicHarmonyDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,isConcertPitch:l.isConcertPitch,harmonyUuid:this.uuid}),this.pos={partIdx:this.data.partIdx,partUuid:this.data.partUuid,measureIdx:this.data.measureIdx,measureUuid:this.data.measureUuid,voiceIdxInStaff:this.data.voiceIdxInStaff,voiceUuid:this.data.voiceUuid,staffUuid:this.data.staffUuid,staffIdx:this.staffIdx,dpq:this.data.dpq,timePos:this.data.timePos},d.reset(),this.cursor=l,this.cursor.changeFocus(this.pos),(0,f.c)().hasNewRomanNumeralsInput||this.cursor.hideCursor(),g.executePublicAction("enableClassicChordMode"),this.clearElem()}remove(){}highLight(){this.colorElem(this.elem)}colorElem(i){i.style.fill=this.color}clearElem(){this.cleanElem(this.elem)}cleanElem(i){i.style.fill=""}}},658589:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(884940);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="tempoChange",this.anchorClass="tempo-anchor",this.uuidAttribute="data-adagio-tempochange-uuid",this.moveAction="moveSelectedTempoChange",this.adagioDrawMethod="drawTempoChangeCursor",this.notation=i,this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.tempoChangeData=this.scoreData.getTempoChangeDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,tempoChangeUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.tempoChangeData),this.buildLocationOrigin(this.tempoChangeData),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},680468:(b,v,r)=>{"use strict";r.d(v,{c:()=>l});var f=r(763939),p=r(303953),m=r(6645),i=r(361744),s=r(744056),u=r(909696);const l=(0,m.nY)("scoreEditorText",()=>{const d=(0,u.q6)(),g=(0,f.F)(),t=(0,i.EW)(()=>g.experience.includes("editor.canary")),a=(0,s.KR)(null),e=(0,s.KR)(null),o=(0,i.EW)(()=>a.value!==null?a.value:p.A.useRomanNumeralTextInput===!1?!1:!d.displayMobileEditor),n=(0,i.EW)(()=>e.value!==null?e.value:p.A.useJazzChordsTextInput===!1?!1:!d.displayMobileEditor),h=(0,i.EW)(()=>!0),_=(0,i.EW)(()=>t.value||d.displayMobileEditor),U=(0,i.EW)(()=>!0);function P(){a.value=!o.value}function y(){e.value=!n.value}return{useRomanNumeralTextInputValue:a,useJazzChordsTextInputValue:e,useRomanNumeralTextInput:o,useJazzChordsTextInput:n,hasNewRomanNumeralsInput:h,hasNewJazzChordInput:_,hasChordTextInput:U,toggleRomanNumeralInputType:P,toggleJazzChordsInputType:y}})},680772:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,color:s}){this.elem=m,this.type="clef",this.pos=i,this.color=s,this.clefUuid=m.getAttribute("data-adagio-clef-uuid");const u=m.parentElement||m.parentNode;u.classList.contains("attributes")&&(this.attributesSide=u.getAttribute("data-adagio-attributes-side"))}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(m){m.style.fill=this.color}cleanElem(m){m.style.fill=""}}},689850:(b,v,r)=>{"use strict";r.d(v,{w:()=>P});var f=r(6645),p=r(744056),m=r(361744),i=r(472243),s=r(653154),u=r(544582),l=r(459356),d=Object.defineProperty,g=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(y,E,M)=>E in y?d(y,E,{enumerable:!0,configurable:!0,writable:!0,value:M}):y[E]=M,h=(y,E)=>{for(var M in E||(E={}))e.call(E,M)&&n(y,M,E[M]);if(a)for(var M of a(E))o.call(E,M)&&n(y,M,E[M]);return y},_=(y,E)=>g(y,t(E)),U=(y,E,M)=>new Promise((L,D)=>{var c=R=>{try{x(M.next(R))}catch(I){D(I)}},A=R=>{try{x(M.throw(R))}catch(I){D(I)}},x=R=>R.done?L(R.value):Promise.resolve(R.value).then(c,A);x((M=M.apply(y,E)).next())});const P=(0,f.nY)("scoreTracks",()=>{const y=(0,l.O)(),E=(0,p.KR)([]),M=(0,p.KR)(null),L=(0,p.KR)(null),D=(0,p.KR)(null),c=(0,p.KR)(!1),A=(0,m.EW)(()=>E.value.length>0),x=(0,m.EW)(()=>E.value.find(S=>S.default)),R=(0,m.EW)(()=>{const S=(0,u.o)(),O=(0,m.EW)(()=>S.currentTrack);return O.value?E.value.find(C=>C.id===O.value):O.value}),I=(0,m.EW)(()=>E.value&&E.value.length>0?E.value.reduce((S,O)=>new Date(S.creationDate)>new Date(O.creationDate)?S:O):null);function W(){L.value=null,M.value="create"}function F(S){L.value=S,M.value="sync"}function B(){M.value=null,L.value=null}function N(S){return(0,m.EW)(()=>{const O=E.value.filter(C=>C.state==="completed"&&C.submission===S.value);return O&&O.length>0?O.reduce((C,T)=>new Date(C.creationDate).getTime()>new Date(T.creationDate).getTime()?C:T):null})}function w(S){const O=E.value.findIndex(C=>C.id===S.id);O>=0?E.value[O]=S:E.value.push(S),D.value=S}function K(S){S.forEach(O=>{w(O)})}function k(S){E.value.forEach(O=>{O.default=O.id===S})}function j(S){const O=E.value.findIndex(C=>C.id===S);O>=0&&E.value.splice(O,1)}function $(S){return U(this,arguments,function*({score:O,query:C}){const T=yield i.A.get(O.id,_(h({},C),{sharingKey:O.sharingKey}));return K(T),T})}function V(S){return U(this,arguments,function*({score:O,assignment:C,query:T}){const z=yield i.A.get(O.id,_(h({},T),{assignment:C.id}));return K(z),z})}function X(S){return U(this,arguments,function*({score:O,track:C}){try{const T=yield i.A.update(O.id,C.id,{default:!0});return k(C.id),T}catch(T){throw(0,s.vV)(T),y.displayError({error:T}),T}})}function H(S){return U(this,arguments,function*({score:O}){try{const C=E.value.find(T=>!!T.default);C&&(yield i.A.update(O.id,C.id,{default:!1})),k(null)}catch(C){throw(0,s.vV)(C),y.displayError({error:C}),C}})}function Y(S){return U(this,arguments,function*({score:O,trackObj:C}){if(C.dataEncoding="base64",!C.title){C.title="Recording - ";const T=(0,u.o)().recordTimeFormat;if(T)C.title+=`${T}`;else{const z=new Date;C.title+=`${z.getHours()}:${z.getMinutes()}:${z.getSeconds()}`}}try{const T=yield i.A.create(O.id,C);w(T)}catch(T){throw(0,s.vV)(T),y.displayError({error:T}),T}})}function J(S){return U(this,arguments,function*({score:O,track:C}){C.state="completed";try{const T=yield i.A.update(O.id,C.id,C);w(T)}catch(T){throw(0,s.vV)(T),y.displayError({error:T}),T}})}function Q(S){return U(this,arguments,function*({score:O,track:C}){try{yield i.A.delete(O.id,C.id),j(C.id)}catch(T){throw(0,s.vV)(T),y.displayError({error:T}),T}})}return{tracks:E,hasTracks:A,defaultTrack:x,trackEditStep:M,trackEditId:L,performanceTrackSaved:c,currentTrack:R,lastTrackSet:D,lastTrack:I,getCurrentSubmissionTrack:N,markDefaultTrack:X,markPlaybackDefault:H,createNewTrack:W,setTrack:w,startEdit:F,setDefaultTrack:k,closeEditor:B,saveTrack:Y,loadScoreTracks:$,loadUserAssignmentTracks:V,submitPerformanceTrack:J,deleteTrack:Q}})},721687:(b,v,r)=>{"use strict";r.d(v,{A:()=>M});var f=r(429145),p=r(701387),m=r(123491),i=r(383279),s=r(104907),u=r(377180),l=r(475672),d=r(59377),g=r(645369),t=r.n(g),a=r(744056),e=r(795450),o=r(591340),n=r(909696),h=r(83e3),_=r(443669),U=r(281925),P=r(575258),y=(L,D,c)=>new Promise((A,x)=>{var R=F=>{try{W(c.next(F))}catch(B){x(B)}},I=F=>{try{W(c.throw(F))}catch(B){x(B)}},W=F=>F.done?A(F.value):Promise.resolve(F.value).then(R,I);W((c=c.apply(L,D)).next())});const E=t()("flat:scoredata");class M{constructor({account:D,scoreId:c,revisionId:A="last",sharingKey:x,canPreloadDrawerFont:R=!1,logError:I,getCustomUnpitched:W=null}){this.isReady=!1,this.config=new _.A,this.logError=I||(F=>{throw F}),this.account=D,this.scoreId=c,this.revisionId=A,this.sharingKey=x,this.getCustomUnpitched=W,this.lastEditId="initial",this.canPreloadDrawerFont=R,(0,n.q6)().setInitialDisplayedRevision(this.revisionId)}getRevisionId(){throw new Error("Method ScoreData.getRevisionId() not implemented")}getRevision(){throw new Error("Method ScoreData.getRevision() not implemented")}loadRevision(){throw new Error("Method ScoreData.loadRevision() not implemented")}saveNewRevision(){throw new Error("Method ScoreData.saveNewRevision() not implemented")}getCurrentAdagioData(){return this.adagioData}setRt(D){this.rt=D,this.scoreActions&&this.scoreActions.setRt(this.rt)}setAudio(D,{audioAutoload:c=!1}={}){this.audio=D,this.audioAutoload=c,this.data&&this.setAudioData()}setMIDI(D){this.midi=D,this.adagioData&&D.setData(this.adagioData)}setKeyboard(D){this.keyboard=D,this.data&&this.keyboard.init()}setData(D,{autoSetReady:c=!0}={}){this.data=D;const A=!this.data["score-partwise"]["part-list"]["score-part"][0].voiceIdxToUuidMapping;this.adagioData=(0,a.IG)(new f.A(this.data)),this.cachePartMetas(),this.ensurePageSize(),this.config.initFromScoreData(this.adagioData),this.canPreloadDrawerFont&&(this.preloadDrawerMusicFont(),this.initFonts().loadAllFonts()),c&&(this.isReady=!0),this.audio&&this.setAudioData(),this.midi&&this.midi.setData(this.adagioData),this.keyboard&&this.keyboard.init();const x=(0,o.U)(),R=x.stScoreWrite,I=x.env;A&&R&&I!=="history"&&I!=="embed"&&(E("saving new score format"),this.saveNewRevision(this.adagioData.exportData(),[],{autosave:!0,description:"Upgrading file format"}))}setAudioData(){if(!this.audio)return;E("set audio data"),this.audio.setData(this.adagioData);const D=(0,o.U)().env;D!=="ios"&&this.audio.loadMetronome(),!this.audio.loaded&&this.audioAutoload?this.audio.load().catch(c=>{E("audio.load err: %o",c)}):this.audio.loaded&&D!=="ios"&&(E("reload instruments"),this.audio.reloadInstruments())}setReadyState(D){this.isReady=!!D}preloadDrawerMusicFont(){return y(this,null,function*(){E("preload drawer font bundle"),this.adagioData.getMusicFont()===l.A.PETALUMA?yield r.e(60455).then(r.bind(r,7893)):yield r.e(78877).then(r.bind(r,624740))})}initActions({cursor:D,rangeSelect:c,loadRwActions:A=!0,checkPremiumFeatures:x=!1,promiseQueue:R,i18next:I}){return this.scoreActions?this.scoreActions:(this.scoreActions=new h.A({cursor:D,rangeSelect:c,logError:this.logError,scoreData:this,loadRwActions:A,checkPremiumFeatures:x,promiseQueue:R,i18next:I}),this.scoreActions.on("structuralChange",()=>this.onStructuralChange()),this.scoreActions)}initFonts(){return this.fonts?this.fonts:(this.fonts=new U.A({scoreData:this}),this.fonts)}onStructuralChange(){const D=this.adagioData.editionId;D!==this.lastEditId&&(this.lastEditId=D,this.cachePartMetas(),this.setAudioData(),this.keyboard&&this.keyboard.init(),this.fonts&&this.fonts.loadAllFonts())}getCancelStack(){return this.scoreActions?this.scoreActions.getCancelStack():this.getLocalCancelStack()}getSoundQueue(){return this.scoreActions?this.scoreActions.getSoundQueue():this.getLocalCancelStack()}resetSoundQueue(){this.scoreActions&&this.scoreActions.resetSoundQueue()}getLocalCancelStack(){return this.localCancelStack||(E("no scoreActions, creating local cancelstack"),this.localCancelStack=new d.default),this.localCancelStack}ensurePageSize(){if(this.adagioData.hasPageSize())return!0;const D=new P.A(this.account),c=D.userPreset(),A=D.userToPreferences(c[0],c[1]);return this.adagioData.setScaling(7,40),this.adagioData.setPageSizeAsMillimeters(A.width,A.height),this.adagioData.setPageTopMarginMillimeters(D.userMargin("Top")*10,"both"),this.adagioData.setPageBottomMarginMillimeters(D.userMargin("Bottom")*10,"both"),this.adagioData.setPageLeftMarginMillimeters(D.userMargin("Left")*10,"both"),this.adagioData.setPageRightMarginMillimeters(D.userMargin("Right")*10,"both"),!0}cachePartMetas(){const D=this.adagioData;if(!D)return;const c=[],A=D.getNbParts();for(let x=0;x<A;x++){const R=JSON.parse(JSON.stringify(D.getPartHeader(x))),I={header:R,uuid:R.uuid,idx:x,name:i.default.hasName(R)&&i.default.getName(R)||void 0,abbreviation:i.default.hasAbbreviation(R)&&i.default.getAbbreviation(R)||void 0,isGroupedWithPrevious:i.default.isGroupedWithPrevious(R),isTemplateLocked:m.default.isTemplateLocked(R),metas:{}};(!I.name||I.name.length===0)&&(I.name=I.abbreviation,(!I.name||I.name.length===0)&&(I.name=`Instrument ${x+1}`,I.abbreviation="I2"));const{group:W,instrument:F,custom:B}=e.A.identifyFromPart(R);if(W)if(I.group=W,I.instrument=F,B&&R["unpitched-set-hash"])if(this.getCustomUnpitched){const w=this.getCustomUnpitched();I.metas=Object.values(w).find(K=>K.mappingHash===R["unpitched-set-hash"]),I.metas&&(I.metas.lines=I.metas.staffLines)}else I.metas=void 0;else I.metas=e.A.getMeta(W,F);if(!I.metas&&(I.metas={},i.default.hasUnpitchedMapping(I.header))){const w=D.getMeasure(x,0),[K]=p.default.getStaffDetails(w);I.metas.lines=s.default.getNbStaffLines(K)}I.metas.mainGroup&&(I.group=I.metas.mainGroup,I.listedGroup=W);const N=D.getStaffMeasure({partIdx:x,measureIdx:0,staffIdx:0});if(I.isTransposing=u.default.isIdentity(N.transpose)===!1,typeof I.metas.pitchrange!="undefined"){const w=D.getPartHeader(x);i.default.setPitchRange(w,I.metas.pitchrange)}c.push(I)}(0,n.q6)().setParts(c)}getAdagioReadyPromise(){return this.scoreActions.getAdagioReadyPromise()}}},735455:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(985896);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="wedge-anchor",this.notationType="wedge",this.anchorClass="wedge-anchor",this.uuidAttribute="data-adagio-wedge-uuid",this.moveAction="moveSelectedWedge",this.adagioDrawMethod="drawWedgeCursor",this.notation=this.svgTools.findParent(i,this.notationType),this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.wedgeData=this.scoreData.getWedgeDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,wedgeUuid:this.notationUuid}),this.buildRectOrigin(this.wedgeData),this.buildLocationOrigin(this.wedgeData),this.fixSide(),this.updateElems()}}},755551:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});function f(p,m){return Object.keys(p).every(s=>m[s]===p[s])}},758645:(b,v,r)=>{"use strict";r.d(v,{A:()=>m});var f=r(646036),p=r(400834);class m extends p.A{constructor({elem:s,pos:u,color:l,scoreData:d,adagioCursor:g,svgTools:t,scoreActions:a,cursor:e}){super(t,u,d),this.elem=s,this.type="pizzicato",this.color=l,this.adagioCursor=g,this.scoreActions=a,this.pizzicatoUuid=this.elem.getAttribute("data-adagio-pizzicato-uuid"),this.pizzicatoData=this.scoreData.getPizzicatoDataAtUuid({partUuid:u.partUuid,staffUuid:u.staffUuid,voiceUuid:u.voiceUuid,measureUuid:u.measureUuid,pizzicatoUuid:this.pizzicatoUuid}),this.cursor=e,this.cursor.changeFocus(this.pos),this.cursor.hideCursor(),this.rangeAutoScroll=new f.A,this.buildLocationOrigin(this.pizzicatoData)}clearElem(){this.cleanElem(this.elem)}highLight(){this.colorElem(this.elem)}move(s,{refAction:u,refEvent:l}){var d,g;const t=s.posX;this.checkUpDownSide(t.line),this.opts=Object.assign(t,this.location),this.elem.style.visibility="hidden";const a=this.adagioCursor.drawPizzicatoCursor(t,this.location.placement,this.location.type);a&&a.length>0&&this.colorElem(a[0].elem),this.rangeAutoScroll.init({refAction:u,refEvent:l,verticalViewport:(d=this.cursor)==null?void 0:d.verticalScrollableElement,horizontalViewport:(g=this.cursor)==null?void 0:g.horizontalScrollableElement,rawRangeRects:[]})}up(){this.scoreActions.executePublicAction("moveSelectedPizzicato"),this.adagioCursor.removeCursor()}colorElem(s){s.style.fill=this.color,s.style.stroke=this.color}cleanElem(s){s.style.fill="",s.style.stroke=""}}},782421:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,color:s,cursor:u}){this.elem=m,this.type=m.classList[0],this.pos=i,this.color=s,this.cursor=u,this.cursor.changeFocus(this.pos),this.cursor.hideCursor()}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(m){m.style.fill=this.color}cleanElem(m){m.style.fill="",[...m.getElementsByTagName("line")].forEach(i=>{i.removeAttribute("style")})}}},803002:(b,v,r)=>{"use strict";r.d(v,{A:()=>d});var f=r(480317),p=r(645369),m=r.n(p);const i=m()("flat:deprecated"),s=["page","systemContent","system-group","staff","staffLines","measure","voice","note","graceNote","head"];let u=null,l=null;class d{constructor(...t){t.length>0&&this.init(...t)}init(t,a,e,o){this.svg=t,this.info=a,this.svgContent=document.getElementsByClassName("score-content")[0],e&&(this.drawingContext=e.getDrawingContext(),this.spaceLine=this.drawingContext.getSpaceSize()*e.getScaling(),this.fontSize=this.drawingContext.getLyricsFontSize()*e.getScaling(),this.harmonySize=this.drawingContext.getHarmonyFontSize()*e.getScaling(),this.wordSize=this.drawingContext.getWordFontSize()*e.getScaling(),this.tabLine=this.drawingContext.getTabSpaceSize()*e.getScaling(),this.stringSize=this.drawingContext.getGlyph("luteItalianFret0").getWidth()*e.getScaling(),this.scaling=e.getScaling()),this.data=o,this.data&&(this.measuresHeaders=this.data.getMeasuresHeaders())}cleanup(){this.svg=null,this.info=null}getBBox(t){const a=t.getBBox();return{x:a.x*this.scaling,y:a.y*this.scaling,width:a.width*this.scaling,height:a.height*this.scaling}}setPageStructures(t){this.info=t}setSpaceSize(t){this.spaceSize=t}getPage(t){return this.svg[t]}getMeasure(t,a,e){let o;try{o=this.pageLayout.getMeasureElem(t,e,a).node()}catch(n){return null}return o}getNote(t,a){if(!this.svgContent||typeof t=="undefined"||t.partIdx===void 0&&t.partUuid===void 0||t.staffIdx===void 0&&t.staffUuid===void 0||t.measureIdx===void 0&&t.measureUuid===void 0||t.voiceIdxInStaff===void 0&&t.voiceUuid===void 0||t.noteIdx===void 0)return null;a=a||{},t.measureUuid===void 0&&(t.measureUuid=this.data.getMeasureUuid(t.measureIdx)),t.partUuid===void 0&&(t.partUuid=this.data.getPartUuid(t.partIdx)),t.staffUuid===void 0&&(t.partIdx===void 0&&(t.partIdx=this.data.getPartIdxFromUuid(t.partUuid)),t.staffUuid=this.data.getPartStaffUuid(t.partIdx,t.staffIdx)),t.voiceUuid===void 0&&(t.voiceUuid=this.data.getPartVoiceUuid(t.partIdx,this.data.getPartStaffVoiceAtIdx(t.partIdx,t.staffIdx,t.voiceIdxInStaff)));const e={},n=`g.staff${t.staffMode&&t.staffMode!=="regular"?`.${t.staffMode}-staff`:""}[data-adagio-staff-uuid="${t.staffUuid}"] > g.measure[data-adagio-measure-uuid="${t.measureUuid}"]`;if(e.mea=this.svgContent.querySelector(n),!e.mea){if(a.mayBeNotDrawn)return null;const P=new Error("Measure not found in DOM with provided pos");throw P.pos=t,P}e.staff=d.findParent(e.mea,"staff"),e.sys=d.findParent(e.staff,"systemContent");const h=d.findParent(e.sys,"page");e.pageIdx=d.getPosition(this.svgContent,h,"page"),e.voice=e.mea.querySelector(`g.voice[data-adagio-voice-uuid="${t.voiceUuid}"]`);let _;for(;(_=d.extractChild(e.voice,"note",t.noteIdx))===null&&t.noteIdx>=0;)t.noteIdx--;let U;if(typeof t.graceIdx!="undefined")for(;(U=d.extractChild(_,"graceNote",t.graceIdx))===null&&t.graceIdx>0;)t.graceIdx--;return U?_=U:delete t.graceIdx,e.note=_,e.pos=t,e}getHeadAtLine(t,a){const e=d.getElementsByClassName(t,"head");for(let o=0;o<e.length;o++){const n=this.getHeadLine(e[o]);if(a===n)return e[o]}return null}getCloserElem(t,a){let e,o=Number.POSITIVE_INFINITY,n,h,_;if(t.pageX!==void 0)h=t.pageX,_=t.pageY;else if(t.changedTouches&&t.changedTouches.length>0)h=t.changedTouches[0].pageX,_=t.changedTouches[0].pageY;else{const U=d.getEventTarget(t);h=d.getCoord(U).x,_=d.getCoord(U).y}for(let U=0;U<a.length;U++){const P=this.getBBox(a[U]),y=d.getPoint().matrixTransform(a[U].getScreenCTM()).x+P.x,E=d.getPoint().matrixTransform(a[U].getScreenCTM()).y+P.y,M={x:y+P.width/2,y:E+P.height/2},L=h-M.x,D=_-M.y;n=Math.sqrt(L*L+D*D),n<o&&(e=a[U],o=n)}return e}findNearestHeadX(t,a){const e=d.getPoint(),o=d.getElementsByClassName(a,"note");let n=Number.POSITIVE_INFINITY,h,_;if(t.type)t.pageX!==void 0?_=t.pageX:t.changedTouches&&t.changedTouches.length>0&&(_=t.changedTouches[0].pageX);else{const U=this.getBBox(t);_=e.matrixTransform(t.getScreenCTM()).x+U.x}for(let U=0;U<o.length;U++){const P=e.matrixTransform(o[U].getScreenCTM()).x,y=Math.abs(P-_);y<n&&(n=y,h=o[U])}return this.getClosestHead(t,h)}isLeftOfNote(t,a){let e;if(t.pageX!==void 0)e=t.pageX;else if(t.changedTouches&&t.changedTouches.length>0)e=t.changedTouches[0].pageX;else{const h=d.getEventTarget(t);e=d.getCoord(h).x}const n=d.getPoint().matrixTransform(a.getScreenCTM()).x;return e-n<0}findNearestNoteXWide(t,a){const e=d.getElementsByClassName(a,"note"),o=d.getPoint();let n=Number.POSITIVE_INFINITY,h,_;t.type?t.pageX!==void 0?_=t.pageX:t.changedTouches&&t.changedTouches.length>0&&(_=t.changedTouches[0].pageX):_=o.matrixTransform(t.getScreenCTM()).x+this.getBBox(t).x;for(let U=0;U<e.length;U++){const P=this.getBBox(e[U]),y=o.matrixTransform(e[U].getScreenCTM()).x+P.x,E=Math.abs(y-_);E<n&&(n=E,h=e[U])}return h}findNearestNote(t,a,e){const o=d.getEventTarget(t);let n;a||(a=d.findParent(o,"measure")),typeof e!="undefined"?n=d.extractChild(a,"voice",e):n=d.extractChild(a,"voice",0);const h=d.getElementsByClassName(n,"note");return this.getCloserElem(t,h)}isPointInsideElem(t,a,e){const o=d.getPoint(),n={x:o.matrixTransform(a.getScreenCTM()).x,y:o.matrixTransform(a.getScreenCTM()).y,bbox:this.getBBox(a)};let h,_;return t.changedTouches&&t.changedTouches.length>0?[{pageX:_,pageY:h}]=t.changedTouches:t.pageX!==void 0&&({pageX:_,pageY:h}=t),!(h<n.y+n.bbox.y-e||h>n.y+n.bbox.y+n.bbox.height+e||_<n.x+n.bbox.x-e||_>n.x+n.bbox.x+n.bbox.width+e)}isInsideElem(t,a,e){typeof e=="undefined"&&(e=0);const o=d.getPoint(),n={x:o.matrixTransform(t.getScreenCTM()).x,y:o.matrixTransform(t.getScreenCTM()).y,bbox:this.getBBox(t)},h={x:o.matrixTransform(a.getScreenCTM()).x,y:o.matrixTransform(a.getScreenCTM()).y,bbox:this.getBBox(a)};return!(n.y+n.bbox.y+n.bbox.height<h.y+h.bbox.y||n.y+n.bbox.y>h.y+h.bbox.y+h.bbox.height||n.x+n.bbox.width<h.x||n.x>h.x+h.bbox.width)}getClosestHead(t,a){const e=d.getElementsByClassName(a,"head");return e.length===1?e[0]:this.getCloserElem(t,e)}getLine(t,a){const e=t.pageY;let o=d.extractChild(a,"staffLines",0);const n=d.getPoint(),h=e-n.matrixTransform(o.getScreenCTM()).y;if(d.isTab(a)){let _=d.extractChild(a,"staffLines",0);return _=_.getElementsByTagName("line").length,o=Math.trunc(Math.round(h/this.tabLine*2)/2),Math.max(Math.min(1+o,_),1)}return o=Math.round(h/this.spaceLine*2)/2,5-o}getHeadLine(t,a){if(a||(a=d.findParent(t,"staff")),!a)return null;const e=d.getPoint(),{y:o}=e.matrixTransform(t.getScreenCTM());let n=d.extractChild(a,"staffLines",0);const h=o-e.matrixTransform(n.getScreenCTM()).y;if(d.isTab(a)){const _=n.getElementsByTagName("line").length;return n=Math.trunc(Math.round(h/this.tabLine*2)/2),Math.max(Math.min(1+n,_),1)}return n=Math.round(h/this.spaceLine*2)/2,5-n}getTopPosition(t){const a=d.findParent(t,"staff"),e=d.findParent(a,"systemContent");let o=d.getPosition(e,a,"staff");d.isTab(a)&&o--;const n=t.getAttribute("data-adagio-measure-uuid"),h=t.getAttribute("data-adagio-part-uuid");return{measureUuid:n,measureIdx:(0,f.A)(this.measuresHeaders,n),partUuid:h,partIdx:this.data.getPartIdxFromUuid(h),staffIdx:o}}findInformation(t){if(typeof t=="undefined"||!d.isStillInDom(t))return null;let a;d.getNearestParent(t.parentElement||t.parentNode)==="graceNote"&&(a=d.findParent(t,"graceNote"));const e=d.findParent(t,"note"),o=d.findParent(e,"measure"),n=o.getAttribute("data-adagio-measure-uuid"),h=d.findParent(e,"voice"),_=h.getAttribute("data-adagio-voice-uuid"),U=d.findParent(o,"staff"),P=U.getAttribute("data-adagio-staff-uuid"),E=d.findParent(U,"systemContent").getAttribute("data-adagio-part-uuid");return{measureUuid:n,staffUuid:P,partUuid:E,voiceUuid:_,noteIdx:d.getPosition(h,e,"note"),graceIdx:a&&d.getPosition(e,a,"graceNote")}}findGoodPage(t,a){i(new Error("SVGTools.findGoodPage"));for(let e=0;e<this.info.length;e++){let o=0,n;for(const h in this.info[e].shards)if(this.info[e].shards.hasOwnProperty(h)){const _=this.info[e].shards[h];if(_.startMeasureIdx<=a&&_.startMeasureIdx+_.nbMeasures>a&&(n=d.hasPart(_,t))>-1)return{pageIdx:e,shardsIdx:o,partIdx:n,nbstart:_.startMeasureIdx,nbMea:_.nbMeasures};o++}}}resolvePos(t,a,e){const o=this.info[t].shards[a];return{startMea:o.startMeasureIdx,systemIdx:o.systems[e]}}createSvgMatrix(){return this.svg.createSVGMatrix()}isCloseEnough(t,a,e){let o,n;if(t.pageX!==void 0)o=t.pageX,n=t.pageY;else if(t.changedTouches&&t.changedTouches.length>0)o=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY;else{const D=d.getEventTarget(t);o=d.getCoord(D).x,n=d.getCoord(D).y}const h=this.getBBox(a),_=d.getPoint(),U=_.matrixTransform(a.getScreenCTM()).x+h.x,P=_.matrixTransform(a.getScreenCTM()).y+h.y,y={x:U+h.width/2,y:P+h.height/2},E=o-y.x,M=n-y.y;return Math.sqrt(E*E+M*M)<=e+h.width/2}isEnoughInX(t,a,e){let o;t.pageX!==void 0?o=t.pageX:t.changedTouches&&t.changedTouches.length>0?o=t.changedTouches[0].pageX:o=d.getCoord(d.getEventTarget(t)).x;const n=this.getBBox(a),U={x:d.getPoint().matrixTransform(a.getScreenCTM()).x+n.x+n.width/2};return Math.abs(o-U.x)<=e+n.width/2}static getElementsByClassName(t,a){if(!t)return[];if(t.getElementsByClassName)return[].slice.call(t.getElementsByClassName(a));const e=[],o=new RegExp(`(^| )${a}( |$)`),n=t.getElementsByTagName("*");for(let h=0,_=n.length;h<_;h++)o.test(n[h].className.baseVal)&&e.push(n[h]);return e}getElementsByClassName(...t){return this.constructor.getElementsByClassName(...t)}static extractChild(t,a,e){if(!t)return null;a==="voice"&&([t]=d.getElementsByClassName(t,"tickableContent"));let o=0;for(let n=0;n<t.childNodes.length;n++)if(t.childNodes[n].classList.contains(a)){if(e===o)return t.childNodes[n];o++}return null}extractChild(...t){return this.constructor.extractChild(...t)}static getPosition(t,a,e){const o=d.getElementsByClassName(t,e);for(let n=0;n<o.length;n++)if(o[n]===a)return n}getPosition(...t){return this.constructor.getPosition(...t)}static isStillInDom(t){return document.body.contains(t)}isStillInDom(t){return this.constructor.isStillInDom(t)}static getPoint(){return u&&document.body.contains(l)||(l=document.createElementNS("http://www.w3.org/2000/svg","svg"),l.style.position="fixed",l.style.left="-10000px",l.style.bottom="-10000px",l.classList.add("pointer-container"),document.body.appendChild(l),u=l.createSVGPoint()),u}getPoint(){return this.constructor.getPoint()}static getCoord(t){const a=t.getScreenCTM();return a?d.getPoint().matrixTransform(a):{}}getCoord(t){return this.constructor.getCoord(t)}static getAbsCoord(t){const a=t.getCTM();return a?d.getPoint().matrixTransform(a):{}}getAbsCoord(t){return this.constructor.getAbsCoord(t)}static lookUpPlacement(t){return t<3?"below":"above"}lookUpPlacement(t){return this.constructor.lookUpPlacement(t)}static isTab(t){return t.classList.contains("tab-staff")}isTab(t){return this.constructor.isTab(t)}static correctTab(t){typeof t.string!="undefined"&&(t.staffIdx=0)}correctTab(t){return this.constructor.correctTab(t)}static getNbVoice(t){i(new Error("SVGTools.getNbVoice"));const a=d.findParent(t,"voice"),e=a.classList[1].indexOf("-");return Number.parseInt(a.classList[1].substring(e+1),10)}getNbVoice(t){return this.constructor.getNbVoice(t)}static getVoiceUuidFromHead(t){return d.findParent(t,"voice").getAttribute("data-adagio-voice-uuid")}getVoiceUuidFromHead(t){return this.constructor.getVoiceUuidFromHead(t)}static getShard(t,a){return d.getElementsByClassName(t,"scoreShard")[a]}getShard(...t){return this.constructor.getShard(...t)}static getPart(t,a){return d.getElementsByClassName(t,"systemContent")[a]}getPart(...t){return this.constructor.getPart(...t)}static hasPart(t,a){for(let e=0;e<t.systems.length;e++)if(t.systems[e]===a)return e;return-1}hasPart(...t){return this.constructor.hasPart(...t)}static getNbOccurs(t,a){a==="voice"&&([t]=d.getElementsByClassName(t,"tickableContent"));let e=0;for(let o=0;o<t.childNodes.length;o++)t.childNodes[o].classList.contains(a)&&e++;return e}getNbOccurs(...t){return this.constructor.getNbOccurs(...t)}static extractStem(t){for(let a=0;a<t.childNodes.length;a++){if(t.childNodes[a].classList.contains("stem"))return t.childNodes[a];if(t.childNodes[a].childNodes.length>0){const e=d.extractStem(t.childNodes[a]);if(e!==null)return e}}return null}extractStem(...t){return this.constructor.extractStem(...t)}static findParent(t,a){return!t||!t.classList?null:t.classList[0]===a?t:d.findParent(t.parentElement||t.parentNode,a)}findParent(...t){return this.constructor.findParent(...t)}static getNearestParent(t){return t?typeof t.classList!="undefined"&&s.indexOf(t.classList[0])===-1?d.getNearestParent(t.parentElement||t.parentNode):t.classList[0]:null}getNearestParent(t){return this.constructor.getNearestParent(t)}static getTopParent(t){return(t.parentElement||t.parentNode).classList[0]}getTopParent(t){return this.constructor.getTopParent(t)}static getEventTarget(t){return t||(t=window.event),t.srcElement||t.target}getAllEntities(t,a){const e=`g.${t}[data-adagio-${t}-uuid="${a}"]`;return this.svgContent.querySelectorAll(e)}getEntity(t,a){const e=`g.${t}[data-adagio-${t}-uuid="${a}"]`;return this.svgContent.querySelector(e)}textWidth(t,a,e,o){return this.fakeEl||(this.fakeEl=document.createElement("span"),this.fakeEl.style.position="fixed",this.fakeEl.style.top="-100000px",this.fakeEl.style.left="-100000px",this.fakeEl.style.visibility="hidden",document.body.appendChild(this.fakeEl)),this.fakeEl.style["font-size"]=a,this.fakeEl.style["font-family"]=e,this.fakeEl.style["font-style"]=o,this.fakeEl.textContent=t,this.fakeEl.offsetWidth}textHeight(t,a,e,o){return this.fakeEl||(this.fakeEl=document.createElement("span"),this.fakeEl.style.position="fixed",this.fakeEl.style.top="-100000px",this.fakeEl.style.left="-100000px",this.fakeEl.style.visibility="hidden",document.body.appendChild(this.fakeEl)),this.fakeEl.style["font-size"]=a,this.fakeEl.style["font-family"]=e,this.fakeEl.style["font-style"]=o,this.fakeEl.textContent=t,this.fakeEl.offsetHeight}}},804338:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,color:s}){this.elem=m,this.type=m.classList[0],this.pos=i,this.color=s}remove(){}highLight(){this.colorElem(this.elem)}clearElem(){this.cleanElem(this.elem)}colorElem(m){m.style.fill=this.color}cleanElem(m){m.style.fill=""}}},815e3:(b,v,r)=>{"use strict";r.d(v,{A:()=>a});var f=r(361744),p=r(538065);const m=["aria-disabled","for"],i=["id","checked","aria-checked","disabled","required","name","value","tabindex"],s=(0,f.pM)({__name:"FRadio",props:{modelValue:{default:null},value:{default:void 0},name:{default:void 0},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},id:{default:void 0}},emits:["update:modelValue","change"],setup(e,{emit:o}){const n=e,h=o,_=(0,f.EW)(()=>n.id||`radio-${Math.round(Math.random()*1e6)}`),U=(0,f.EW)(()=>n.modelValue===n.value),P=(0,f.EW)(()=>n.name||`radio-group-${_.value}`),y=(0,f.Ht)(),E=(0,f.EW)(()=>!!y.default),M=D=>{const c=D.target;h("update:modelValue",c.value)},L=D=>{const c=D.target;h("change",c.value)};return(D,c)=>((0,f.uX)(),(0,f.CE)("label",{"aria-disabled":D.disabled,for:_.value,class:(0,p.C4)([D.$style.root,D.$style["radio-wrapper"]])},[(0,f.Lk)("input",{id:_.value,checked:U.value,"aria-checked":U.value,disabled:D.disabled,required:D.required,name:P.value,value:D.value,tabindex:D.disabled?-1:0,type:"radio",onChange:L,onInput:M,class:(0,p.C4)(D.$style["radio-input"])},null,42,i),(0,f.Lk)("div",{class:(0,p.C4)(D.$style.radio)},c[0]||(c[0]=[(0,f.Lk)("span",null,null,-1)]),2),E.value?((0,f.uX)(),(0,f.CE)("span",{key:0,class:(0,p.C4)(D.$style["radio-content"])},[(0,f.RG)(D.$slots,"default")],2)):(0,f.Q3)("",!0)],10,m))}});var u=r(384147),l=r.n(u),d=r(938793);const g={};g.$style=l();const a=(0,d.A)(s,[["__cssModules",g]])},841421:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(400834);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t}){super(g,s,l),this.elem=i,this.type="mute",this.color=u,this.adagioCursor=d,this.scoreActions=t,this.muteUuid=this.elem.getAttribute("data-adagio-mute-uuid"),this.muteData=this.scoreData.getMuteDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,measureUuid:s.measureUuid,muteUuid:this.muteUuid}),this.buildLocationOrigin(this.muteData)}clearElem(){this.cleanElem(this.elem)}highLight(){this.colorElem(this.elem)}move(i){const s=i.posX;this.checkUpDownSide(s.line),this.opts=Object.assign(s,this.location),this.elem.style.visibility="hidden";const u=this.adagioCursor.drawMuteCursor(s,this.location.placement,this.location.type);u&&u.length>0&&this.colorElem(u[0].elem)}up(){this.scoreActions.executePublicAction("moveSelectedMute"),this.adagioCursor.removeCursor()}colorElem(i){i.style.fill=this.color,i.style.stroke=this.color}cleanElem(i){i.style.fill="",i.style.stroke=""}}},847700:(b,v,r)=>{"use strict";r.d(v,{A:()=>f});class f{constructor({elem:m,pos:i,scoreData:s,svgTools:u,scoreActions:l,cursor:d}){this.elem=m,this.svgTools=u,this.type=m.classList[0];const g=this.elem.getAttribute("data-adagio-word-uuid");this.data=s.getWordDataAtUuid({partUuid:i.partUuid,staffUuid:i.staffUuid,voiceUuid:i.voiceUuid,measureUuid:this.extractMeasureUuid(m),wordUuid:g}),this.pos={partIdx:this.data.partIdx,partUuid:this.data.partUuid,measureIdx:this.data.measureIdx,measureUuid:this.data.measureUuid,voiceIdxInStaff:this.data.voiceIdxInStaff,voiceUuid:this.data.voiceUuid,staffUuid:this.data.staffUuid,staffIdx:this.data.staffIdx,dpq:this.data.dpq,timePos:this.data.timePos},this.cursor=d,this.cursor.changeFocus(this.pos),this.cursor.hideCursor(),l.executePublicAction("enableAnnotationMode"),this.clearElem()}extractMeasureUuid(m){return this.svgTools.findParent(m,"measure").getAttribute("data-adagio-measure-uuid")}remove(){}highLight(){}clearElem(){this.cleanElem(this.elem)}cleanElem(m){m.style.fill=""}}},883939:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(985896);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="pedal-anchor",this.notationType="pedal",this.anchorClass="pedal-anchor",this.uuidAttribute="data-adagio-pedal-uuid",this.moveAction="moveSelectedPedal",this.adagioDrawMethod="drawPedalCursorLine",this.notation=this.svgTools.findParent(i,this.notationType),this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.pedalData=this.scoreData.getPedalDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,pedalUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.pedalData),this.buildLocationOrigin(this.pedalData),this.fixSide(),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},884940:(b,v,r)=>{"use strict";r.d(v,{A:()=>s});var f=r(269352),p=r(646036),m=r(400834);function i(u){return typeof u.startMeasureIdx!="undefined"||typeof u.startMeasureUuid!="undefined"}class s extends m.A{constructor({elem:l,pos:d,color:g,scoreData:t,adagioCursor:a,svgTools:e,scoreActions:o,cursor:n}){super(e,d,t),this.elem=l,this.color=g,this.scoreActions=o,this.adagioCursor=a,this.anchors=[],this.cursor=n,i(d)||this.cursor.changeFocus(this.pos),this.cursor.hideCursor(),this.rangeAutoScroll=new p.A,this.xMargin=5}getElemsFromRoots(l){return Array.from(l).map(d=>d.firstChild)}getFirstElement(l){return l.find(d=>d.parentElement.classList.contains("start"))}getLastElement(l){return l.find(d=>d.parentElement.classList.contains("stop"))}updateElems(){const l=this.svgTools.getAllEntities(this.type,this.notationUuid);this.elems=this.getElemsFromRoots(l)}highLight(){this.updateElems(),this.colorLine(this.elems),this.colorElem(this.elems),this.bindAnchor(this.elems)}bindAnchor(l){this.cleanAnchors();const d=this.getFirstElement(l),g=this.getLastElement(l),t=d==null?void 0:d.getBBox(),a=g==null?void 0:g.getBBox();this.anchors=[d?new f.A("circle"):null,g?new f.A("circle"):null],d&&(this.anchors[0].attr("transform",`translate(${t.x-this.xMargin}, ${t.y+t.height/2})`),this.anchors[0].attr("class",`${this.anchorClass} left`),this.anchors[0].attr("r",9),this.anchors[0].attr("style","fill: none; stroke-width: 2px; opacity: 1"),d.appendChild(this.anchors[0].node())),g&&(this.anchors[1].attr("transform",`translate(${a.x+a.width+this.xMargin}, ${a.y+a.height/2})`),this.anchors[1].attr("class",`${this.anchorClass} right`),this.anchors[1].attr("r",9),this.anchors[1].attr("style","fill: none; stroke-width: 2px; opacity: 1"),g.appendChild(this.anchors[1].node()))}move(l,{refAction:d,refEvent:g}){var t,a;const e=l.posX;let o=null;if(e.partUuid===this.pos.partUuid&&e.staffUuid===this.pos.staffUuid&&(o=this.translatePos(e),this.checkUpDownSide(e.line)),o&&(this.opts=Object.assign(o,this.location)),this.opts){Array.from(this.elems).forEach(h=>{h.style.visibility="hidden"});const n=this.adagioCursor[this.adagioDrawMethod](this.opts,this.location);if(n&&n.length>0){const h=n.map(U=>U.elem),_=this.getElemsFromRoots(h);this.colorLine(_)}}this.rangeAutoScroll.init({refAction:d,refEvent:g,verticalViewport:(t=this.cursor)==null?void 0:t.verticalScrollableElement,horizontalViewport:(a=this.cursor)==null?void 0:a.horizontalScrollableElement,rawRangeRects:[]})}up(){this.scoreActions.executePublicAction(this.moveAction),this.adagioCursor.removeCursor()}cleanAnchors(){this.anchors.forEach(l=>{var d;(d=l==null?void 0:l.elem)!=null&&d.parentNode&&l.removeFromParent()})}clearElem(){this.elems.forEach(l=>{l.style.visibility="visible";let d=l.getElementsByTagName("line");d=[].slice.call(d),d.forEach(g=>{g.style.stroke=""}),this.cleanElem(l),this.cleanAnchors()})}colorLine(l){let d=[];l.forEach(g=>{d.push(...g.getElementsByTagName("line"))}),d=[].slice.call(d),d.forEach(g=>{g.style.stroke=this.color})}colorElem(l){l.forEach(d=>{d.style.fill=this.color,d.style.stroke=this.color})}cleanElem(l){l.style.fill="",l.style.stroke=""}}},885221:(b,v,r)=>{"use strict";r.d(v,{A:()=>i});var f=r(602494),p=r(121648),m=r(591340);function i(){const s=(0,m.U)(),u=(0,p.W)(),l=s.scoreWrite&&!u.isEditionBlocked;if(!l)return{canEdit:l,canAddNoteBefore:!1};const g=u.editionMode===f.xU;return{canEdit:l,canAddNoteBefore:g}}},900269:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(884940);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="pluckedRange",this.anchorClass="pluckedRange-anchor",this.uuidAttribute="data-adagio-pluckedRange-uuid",this.moveAction="moveSelectedPluckedRange",this.adagioDrawMethod="drawPluckedRangeCursor",this.notation=this.elem,this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.pluckedRangeData=this.scoreData.getPluckedRangeDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,pluckedRangeUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.pluckedRangeData),this.buildLocationOrigin(this.pluckedRangeData),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},906158:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(884940);class p extends f.A{constructor({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}){super({elem:i,pos:s,color:u,scoreData:l,adagioCursor:d,svgTools:g,scoreActions:t,cursor:a}),this.type="pedal",this.anchorClass="pedal-anchor",this.uuidAttribute="data-adagio-pedal-uuid",this.moveAction="moveSelectedPedal",this.adagioDrawMethod="drawPedalCursorLine",this.notation=this.elem,this.notationUuid=this.notation.getAttribute(this.uuidAttribute),this.pedalData=this.scoreData.getPedalDataAtUuid({partUuid:s.partUuid,staffUuid:s.staffUuid,voiceUuid:s.voiceUuid,pedalUuid:this.notationUuid}),this.xMargin=10,this.buildRectOrigin(this.pedalData),this.buildLocationOrigin(this.pedalData),this.updateElems()}getElemsFromRoots(i){return Array.from(i)}getFirstElement(i){return i.find(s=>s.classList.contains("start"))}getLastElement(i){return i.find(s=>s.classList.contains("stop"))}}},922492:(b,v,r)=>{"use strict";r.r(v),r.d(v,{default:()=>u});var f=r(814779),p=r.n(f),m=r(927860),i=r.n(m),s=i()(p());s.push([b.id,`.root_xmz0y{--f-radio-inactive-color: var(--f-subdue);--f-radio-disabled-color: rgba(207, 216, 220, .8);--f-radio-size: 20px;--f-radio-bg-spread-size: 40px;display:flex;align-items:center}.radio-input_TzVGj{outline:none;opacity:0;position:absolute;width:0;height:0;margin:0;padding:0;font-size:0;background-color:transparent;z-index:-1}.radio-input_TzVGj:focus-visible~.radio_YFI5D:before{opacity:1;transform:translate(-50%,-50%) scale(1)}.radio-input_TzVGj:focus-visible:not(:checked)~.radio_YFI5D:before{background-color:var(--f-input-subdue-lighter)}.radio-input_TzVGj:focus-visible:checked~.radio_YFI5D:before{background-color:var(--f-input-primary-lighter)}.radio_YFI5D{position:relative;border:2px solid var(--f-radio-inactive-color);height:var(--f-radio-size);width:var(--f-radio-size);border-radius:50%;cursor:pointer;flex-shrink:0}.radio_YFI5D span{content:"";position:absolute;top:50%;left:50%;transition:all .2s ease;opacity:0;transform:translate(-50%,-50%) scale(0);box-sizing:inherit;display:inline-flex;border-radius:inherit;background-color:var(--surface-general-brand-primary);height:16px;width:16px}.radio_YFI5D:before{z-index:-1;content:"";position:absolute;top:50%;left:50%;width:var(--f-radio-bg-spread-size);height:var(--f-radio-bg-spread-size);border-radius:50%;transition:all .2s ease;transform:translate(-50%,-50%) scale(0);opacity:0}.radio_YFI5D:hover:before,.radio_YFI5D:focus:before,.radio_YFI5D:active:before,.radio_YFI5D:hover:checked:before,.radio_YFI5D:focus:checked:before,.radio_YFI5D:active:checked:before{opacity:1;transform:translate(-50%,-50%) scale(1)}.radio-content_R2U5u{margin-left:8px}.radio-input_TzVGj:disabled+.radio_YFI5D{cursor:not-allowed}.radio-input_TzVGj:disabled+.radio_YFI5D:hover:before,.radio-input_TzVGj:disabled+.radio_YFI5D:focus:before,.radio-input_TzVGj:disabled+.radio_YFI5D:active:before{display:none}.radio-input_TzVGj:disabled+.radio_YFI5D:after{background:var(--f-radio-disabled-color)}.radio-input_TzVGj:not(:checked)+.radio_YFI5D:hover:before{background-color:var(--f-input-subdue-lighter-2x)}.radio-input_TzVGj:not(:checked)+.radio_YFI5D:focus:before{background-color:var(--f-input-subdue-lighter)}.radio-input_TzVGj:not(:checked)+.radio_YFI5D:active:before{background-color:var(--f-input-subdue-light)}.radio-input_TzVGj:not(:checked):disabled+.radio_YFI5D{border-color:var(--f-grey-disabled-content)}.radio-input_TzVGj:checked+.radio_YFI5D{border-color:var(--border-brand-primary)}.radio-input_TzVGj:checked+.radio_YFI5D span{opacity:1;transform:translate(-50%,-50%) scale(.6)}.radio-input_TzVGj:checked+.radio_YFI5D:hover:before{background-color:var(--f-input-primary-lighter-2x)}.radio-input_TzVGj:checked+.radio_YFI5D:focus:before{background-color:var(--f-input-primary-lighter)}.radio-input_TzVGj:checked+.radio_YFI5D:active:before{background-color:var(--f-input-primary-light)}.radio-input_TzVGj:checked:disabled+.radio_YFI5D{border-color:var(--f-grey-disabled-content)}.radio-input_TzVGj:checked:disabled+.radio_YFI5D span{background-color:var(--f-grey-disabled-content)}
`,""]),s.locals={root:"root_xmz0y","radio-input":"radio-input_TzVGj",radio:"radio_YFI5D","radio-content":"radio-content_R2U5u"};const u=s},928830:(b,v,r)=>{"use strict";r.d(v,{A:()=>p});var f=r(803002);class p{constructor({elem:i}){this.type="part-name";const s=f.A.findParent(i,"systemHeader");s&&(this.partUuid=s.getAttribute("data-adagio-part-uuid"))}remove(){}highLight(){}clearElem(){}}},985896:(b,v,r)=>{"use strict";r.d(v,{A:()=>i});var f=r(269352),p=r(646036),m=r(400834);class i extends m.A{constructor({elem:u,pos:l,color:d,scoreData:g,adagioCursor:t,svgTools:a,scoreActions:e,cursor:o}){super(a,l,g),this.elem=u,this.pos=l,this.color=d,this.scoreActions=e,this.adagioCursor=t,this.anchors=[],this.cursor=o,this.rangeAutoScroll=new p.A,this.xMargin=5}getElemsFromRoots(u){return Array.from(u).map(l=>l.firstChild)}getFirstElement(u){return u.find(l=>l.parentElement.classList.contains("start"))}getLastElement(u){return u.find(l=>l.parentElement.classList.contains("stop"))}updateElems(){const u=this.svgTools.getAllEntities(this.notationType,this.notationUuid);this.notationElems=this.getElemsFromRoots(u)}highLight(){this.colorLine(this.notationElems),this.colorElem(this.notationElems),this.bindAnchor(this.notationElems),this.highlightAnchor()}move(u,{refAction:l,refEvent:d}){var g,t;const a=u.posX;if(this.pos.staffUuid===a.staffUuid&&this.pos.voiceUuid===a.voiceUuid&&this.pos.partUuid===a.partUuid&&!this.isInversed(a)&&(this.opts=this.buildOpt(a,u.isLeftOfNote)),this.notationElems.forEach(e=>{e.style.visibility="hidden"}),this.opts){this.opts=Object.assign(this.opts,this.location);const e=this.adagioCursor[this.adagioDrawMethod](this.opts,this.location);if(e&&e.length>0){const o=e.map(h=>h.elem),n=this.getElemsFromRoots(o);this.colorLine(n),this.colorElem(n),this.bindAnchor(n)}}this.rangeAutoScroll.init({refAction:l,refEvent:d,verticalViewport:(g=this.cursor)==null?void 0:g.verticalScrollableElement,horizontalViewport:(t=this.cursor)==null?void 0:t.horizontalScrollableElement,rawRangeRects:[]})}up(){this.scoreActions.executePublicAction(this.moveAction),this.adagioCursor.removeCursor()}bindAnchor(u){this.cleanAnchors();const l=this.getFirstElement(u),d=this.getLastElement(u),g=l==null?void 0:l.getBBox(),t=d==null?void 0:d.getBBox();this.anchors=[l?new f.A("circle"):null,d?new f.A("circle"):null],l&&(this.anchors[0].attr("transform",`translate(${g.x-this.xMargin}, ${g.y+g.height/2})`),this.anchors[0].attr("class",`${this.anchorClass} left`),this.anchors[0].attr("r",9),this.anchors[0].attr("style","fill: none; stroke-width: 2px; opacity: 1"),l.appendChild(this.anchors[0].node())),d&&(this.anchors[1].attr("transform",`translate(${t.x+t.width+this.xMargin}, ${t.y+t.height/2})`),this.anchors[1].attr("class",`${this.anchorClass} right`),this.anchors[1].attr("r",9),this.anchors[1].attr("style","fill: none; stroke-width: 2px; opacity: 1"),d.appendChild(this.anchors[1].node()))}clearElem(){this.notationElems.forEach(u=>{u.style.visibility="visible";let l=u.getElementsByTagName("line");l=[].slice.call(l),l.forEach(d=>{d.style.stroke=""}),this.cleanElem(u),this.cleanAnchors()})}colorLine(u){let l=[];u.forEach(d=>{l.push(...d.getElementsByTagName("line"))}),l=[].slice.call(l),l.forEach(d=>{d.style.stroke=this.color})}cleanAnchors(){this.anchors.forEach(u=>{var l;(l=u==null?void 0:u.elem)!=null&&l.parentNode&&u.removeFromParent()})}colorElem(u){u.forEach(l=>{l.style.fill=this.color,l.style.stroke=this.color})}cleanElem(u){u.style.fill="",u.style.stroke=""}}}}]);})();


//# debugId=6fbd984a-fd96-5ae4-8608-0a5bc89dd22a
