"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="e122798a-151d-5e2b-85e4-2109535d71d4")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[72486],{414:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(436369),v=t(657107);const M=function(r,u,c){this.init(r,u,c)};M.NAME="primitive.RemoveEnding";const f=M.prototype;f.name=M.NAME,f.init=function(r,u,c){this.commonContent=(0,v.A)(r),this.cancelStack=c,this.opts=u},f.perform=function(){const r=this.getNumbers();this.removeEnding(),this.updateStack(r)},f.getNumbers=function(){return this.commonContent.getEnding(this.opts.measureIdx)},f.removeEnding=function(){this.commonContent.removeEnding(this.opts.measureIdx)},f.updateStack=function(r){const u=this.commonContent.getScoreData(),c=u.getNbParts(),m=this.commonContent.getNbMeasures();for(let o=0;o<c;o++){r=r.slice();const s={type:this.name,opts:{partIdx:o,measureIdx:this.opts.measureIdx,removedNumbers:r}};if(this.cancelStack.push(s),this.opts.measureIdx>0){const d={type:`${this.name}-left`,opts:{measureIdx:this.opts.measureIdx-1,partIdx:o}};this.cancelStack.push(d)}if(this.opts.measureIdx+1<m){const d={type:`${this.name}-right`,opts:{measureIdx:this.opts.measureIdx+1,partIdx:o}};this.cancelStack.push(d)}}(0,g.A)(this.cancelStack,u,{measureIdx:this.opts.measureIdx}),this.opts.measureIdx>0&&(0,g.A)(this.cancelStack,u,{measureIdx:this.opts.measureIdx-1}),this.opts.measureIdx+1<m&&(0,g.A)(this.cancelStack,u,{measureIdx:this.opts.measureIdx+1})};const l=M},5520:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682);function v(f){return`Note already has Technical ${f}`}class M extends g.default{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"technicalType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="AlreadyHasTechnicalError",this.technicalType=l}}},7451:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("This operation is not possible on tab."),this.name="NotPossibleOnTabError"}}},8567:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(l){super(M(l)),Object.defineProperty(this,"quarterPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadQuarterPositionError",this.quarterPosition=l}}const M=function(f){return`The quarter position [${f}] is invalid.`}},12906:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(721247),v=t(205528),M=t(388909);const f=function(o,s,d){this.init(o,s,d)};f.NAME="composite.SetMeasuresRangeClef";const l=f.prototype;l.name=f.NAME,l.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let o=this.opts.startMeasureIdx;o<=this.opts.stopMeasureIdx;o++)this.setMeasureClef(o)},l.setMeasureClef=function(o){const s=g.default.copy(this.opts.clef),d={partIdx:this.opts.partIdx,measureIdx:o,staffIdx:this.opts.staffIdx,clef:s};new M.A(this.scoreData,d,this.cancelStack).perform()};const r=f,u=function(o,s,d){this.init(o,s,d)};u.NAME="composite.SetClefSegment";const c=u.prototype;c.name=u.NAME,c.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setClef(),this.updateOwnClef()},c.setClef=function(){const o=g.default.copy(this.opts.clef),s={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,clef:o};new r(this.scoreData,s,this.cancelStack).perform()},c.updateOwnClef=function(){const o={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new v.A(this.scoreData,o,this.cancelStack).perform()};const m=u},13421:(H,P,t)=>{t.d(P,{A:()=>I});var g=t(476943),v=t(737903),M=t(123491),f=t(351277),l=t(967104),r=t(694426),u=t(793317),c=t(575349),m=t(852363);const o=function(n,a,D){this.init(n,a,D)};o.NAME="primitive.AddPreBend";const s=o.prototype;s.name=o.NAME,s.initMeasureData=u.default,s.init=function(n,a,D){this.initMeasureData(n,a),this.cancelStack=D,this.opts=a,this.note=null},s.perform=function(){this.addPreBend(),this.updateStack(),this.isTiedWithNextMeasure()&&this.signalNextMeasure()},s.addPreBend=function(){const n=this.getNote(),a=l.A.create(r.A.PRE_BEND,this.opts.alter);M.default.setPreBend(n,a)},s.updateStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,m.default)(this.cancelStack,this.measureData,this.opts)},s.isTiedWithNextMeasure=function(){const n=this.measureData.getVoice(this.opts.voiceIdx);if(this.noteIdx+1<n.getNbNotes())return!1;const a=this.getNote();return M.default.hasTieStart(a)},s.getNote=function(){if(this.note===null){let a=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);a=g.default.makeArray(a),this.note=a.find(c.A,this.opts)}return this.note},s.signalNextMeasure=function(){const{partIdx:n}=this.opts,a=this.opts.measureIdx+1,D={type:`${this.name}-close`,opts:{partIdx:n,measureIdx:a}};this.cancelStack.push(D),(0,m.default)(this.cancelStack,this.measureData,{partIdx:n,measureIdx:a})};const d=o;var h=t(955832),e=t(679676),i=t(519405),p=t(691309);const x=function(n,a,D){this.init(n,a,D)};x.NAME="composite.AddPreBend";const S=x.prototype;S.initMeasureData=u.default,S.name=x.NAME,S.init=function(n,a,D){this.initMeasureData(n,a),this.cancelStack=D,this.opts=a,this.note=null},S.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerPreBend()&&this.removeFormerPreBend(),this.hasTie()&&this.hasBend()&&this.removeTie(),this.addBend()},S.hasFormerPreBend=function(){const n=this.getNote();return M.default.hasPreBend(n)},S.hasBend=function(){const n=this.getNote();return M.default.hasBend(n)},S.removeFormerPreBend=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.default.copy(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData)},a=new h.default(this.measureData,n,this.cancelStack);(0,i.default)(a)},S.hasTie=function(){const n=this.getNote();return M.default.hasTieStop(n)},S.removeTie=function(){const n=new p.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1),a=n.getLeftMeasureIdx(),D=n.getLeftNoteIdx(),T=n.getLeftMeasure(),N={partIdx:this.opts.partIdx,measureIdx:a,voiceIdx:this.opts.voiceIdx,noteIdx:D,step:f.default.getStep(this.opts.pitch),octave:f.default.getOctave(this.opts.pitch)},y=new e.default(T,N,this.cancelStack);(0,i.default)(y)},S.getNote=function(){if(this.note===null){let a=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);a=g.default.makeArray(a),this.note=a.find(c.A,this.opts)}return this.note},S.addBend=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.default.copy(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData),alter:this.opts.alter};new d(this.measureData,n,this.cancelStack).perform()};const I=x},15635:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(726042),v=t(244977),M=t(82028),f=t(793317);const l=function(c,m,o){this.init(c,m,o)};l.NAME="composite.SplitRestIfNeeded";const r=l.prototype;r.initMeasureData=f.default,r.name=l.NAME,r.init=function(c,m,o){this.initMeasureData(c,m),this.cancelStack=o,this.opts=m,this.optsTimePos=null,this.actualTimePos=null},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSplitRest()&&this.splitRest()},r.needSplitRest=function(){const c=this.getActualTimePos(),m=this.getOptsTimePos();return c!==m},r.getActualTimePos=function(){if(this.actualTimePos===null){const c=this.measureData.getVoice(this.opts.voiceIdx),m=this.getInternalCoeff(),o=this.getOptsTimePos(),s=(0,M.default)(c,m,o);this.actualTimePos=c.getRangeSpace(0,s)*m}return this.actualTimePos},r.getOptsTimePos=function(){if(this.optsTimePos===null){const c=this.getExternalCoeff();this.optsTimePos=this.opts.timePos*c}return this.optsTimePos},r.getExternalCoeff=function(){const c=this.measureData.getDpqValue();return g.default.lcm(this.opts.dpq,c)/this.opts.dpq},r.getInternalCoeff=function(){const c=this.measureData.getDpqValue();return g.default.lcm(this.opts.dpq,c)/c},r.splitRest=function(){const c={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:this.opts.timePos,divisions:this.opts.dpq};new v.A(this.measureData,c,this.cancelStack).perform()};const u=l},20230:(H,P,t)=>{t.d(P,{A:()=>x});var g=t(476943),v=t(123491),M=t(737296),f=t(414208),l=t(846541),r=t(45876),u=t(218371),c=t(487332),m=t(765350),o=t(901095),s=t(443923),d=t(804617),h=t(793317),e=t(519405);const i=function(S,I,n){this.init(S,I,n)};i.NAME="composite.DeleteRest";const p=i.prototype;p.name=i.NAME,p.initMeasureData=h.default,p.init=function(S,I,n){this.initMeasureData(S,I),this.cancelStack=n,this.opts=I},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.adaptDpqToTimeSignature(),this.removeTie(),this.measureData.isUnpitched()||(this.removeGlissandos(),this.removeRightSlides(),this.removeHammerOnPullOffs()),this.unlockRest();const S=this.getNote();this.deleteRest(),this.restoreSpace(S)},p.adaptDpqToTimeSignature=function(){const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new m.A(this.measureData,S,this.cancelStack).perform()},p.removeTie=function(){const S=this.getVoiceOrTuplet(),I=S.getStopNoteIdx();let n=S.getChord(I);if(n=g.default.makeArray(n),!n.some(v.default.hasTieStart))return;const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:I},D=this.measureData.isUnpitched()?l.default:f.default,T=new D(this.measureData,a,this.cancelStack);(0,e.default)(T)},p.removeGlissandos=function(){const S=this.getVoiceOrTuplet(),I=S.getStopNoteIdx();if(S.isRest(I))return;const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:I};new r.A(this.measureData,n,this.cancelStack).perform()},p.removeRightSlides=function(){const S=this.getVoiceOrTuplet(),I=S.getStopNoteIdx();if(S.isRest(I))return;const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:I};new u.A(this.measureData,n,this.cancelStack).perform()},p.removeHammerOnPullOffs=function(){const S=this.getVoiceOrTuplet(),I=S.getStopNoteIdx();let n=S.getChord(I);if(n=g.default.makeArray(n),!n.some(v.default.hasHammerOnPullOffStart))return;const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:I},D=new c.default(this.measureData,a,this.cancelStack);(0,e.default)(D)},p.getVoiceOrTuplet=function(){const S=this.opts.voiceIdx,I=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(S,I)},p.unlockRest=function(){const S=this.getNote();if(v.default.needRestLock(S)){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new s.A(this.measureData,I,this.cancelStack).perform()}},p.getNote=function(){return this.getVoice().getNote(this.opts.noteIdx)},p.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},p.deleteRest=function(){const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new d.A(this.measureData,S,this.cancelStack).perform()},p.restoreSpace=function(S){const I=v.default.getDuration(S),n=v.default.getStaffIdx(S),a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:n,noteIdx:this.opts.noteIdx,duration:I,insertMode:M.default.INSERT};new o.A(this.measureData,a,this.cancelStack).perform()};const x=i},21467:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(436369);const v=function(l,r,u){this.init(l,r,u)};v.NAME="primitive.RemovePageBreak";const M=v.prototype;M.name=v.NAME,M.init=function(l,r,u){this.scoreData=l,this.opts=r,this.cancelStack=u},M.getCommonContent=function(){return this.scoreData.getCommonContent()},M.perform=function(){this.getCommonContent().removePageBreak(this.opts.measureIdx),this.updateStack()},M.updateStack=function(){const l={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};if(this.cancelStack.push(l),(0,g.A)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0){const r={type:`${this.name}-drawPrevious`,opts:{partIdx:0,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(r),(0,g.A)(this.cancelStack,this.scoreData,{measureIdx:this.opts.measureIdx-1})}};const f=v},21591:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(701387),v=t(104907),M=t(948507),f=t(988878),l=t(123491),r=t(351277),u=t(476943),c=t(539203),m=t(287179),o=t(951805);class s{constructor(n,a,D){this.name=s.NAME,this.scoreData=n,this.cancelStack=D,this.opts=a}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.processMeasures()}processMeasures(){const n=(0,c.A)(this.scoreData,this.opts),a=this.scoreData.getNbMeasures();for(let D=0;D<a;D++){const T=n.getMeasureData(D);this.processMeasure(T,D)}}processMeasure(n,a){this.measureData=n,this.measureIdx=a,this.measureData.getVoicesIndexes().forEach(this.processVoice,this)}processVoice(n){this.voiceIdx=n;const a=this.measureData.getVoice(n);this.voice=a;const D=a.getNbNotes();for(let T=0;T<D;T++)a.isRest(T)||this.processNote(T)}processNote(n){this.noteIdx=n;let a=this.voice.getChord(n);a=u.default.makeArray(a),a=a.filter(h),a.forEach(this.convertQuarterNote,this),this.processGraces()}convertQuarterNote(n){const a=l.default.getPitch(n);let D=r.default.getAlter(a);D=r.default.normaliseAlterToHalfTone(D);const T=r.default.alterToAccidental(D),N=l.default.getStaffIdx(n),y={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:N,voiceIdx:this.voiceIdx,noteIdx:this.noteIdx,pitch:r.default.copyWithoutAlter(a),accidental:T},A=new m.default(this.measureData,y,this.cancelStack);(0,M.default)(A)}processGraces(){const n=this.voice.getNbGraces(this.noteIdx);for(let a=0;a<n;a++)this.processGrace(a)}processGrace(n){this.graceIdx=n;let a=this.voice.getGraceChord(this.noteIdx,n);a=u.default.makeArray(a),a=a.filter(h),a.forEach(this.convertQuarterGrace,this)}convertQuarterGrace(n){const a=l.default.getPitch(n);let D=r.default.getAlter(a);D=r.default.normaliseAlterToHalfTone(D);const T=r.default.alterToAccidental(D),N=l.default.getStaffIdx(n),y={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:N,voiceIdx:this.voiceIdx,noteIdx:this.noteIdx,graceIdx:this.graceIdx,pitch:r.default.copyWithoutAlter(a),accidental:T},A=new o.default(this.measureData,y,this.cancelStack);(0,M.default)(A)}}Object.defineProperty(s,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"composite.RemovePartQuarterAccidentals"});const d=s;function h(I){const n=l.default.getPitch(I);return r.default.hasQuarterToneAccidental(n)}var e=t(383279);class i{constructor(n,a,D){this.name=i.NAME,this.scoreData=n,this.cancelStack=D,this.opts=a}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setHasQuarterTone(),this.updateStack()}setHasQuarterTone(){const n=this.scoreData.getPartHeader(this.opts.partIdx);e.default.setHasQuarterTone(n,this.opts.hasQuarterTone)}updateStack(){const n=this.scoreData.getNbMeasures();for(let a=0;a<n;a++){const D={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:a}};this.cancelStack.push(D)}}}Object.defineProperty(i,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"primitive.SetHasQuarterTone"});const p=i;class x{constructor(n,a,D){this.name=x.NAME,this.scoreData=n,this.cancelStack=D,this.opts=a}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.hasQuarterTone?this.removeStaffDetailsIfNeeded():this.removePartQuarterAccidentals(),this.setHasQuarterTone()}removeStaffDetailsIfNeeded(){if(this.scoreData.getPartNbStaves(this.opts.partIdx)>1)return;const a=this.scoreData.getMeasure(this.opts.partIdx,0),T=g.default.getWrappedStaffDetailsOrDefault(a).getEntry(0);if(!v.default.hasKodaly(T)&&!v.default.hasStaffTuning(T))return;const N={partIdx:this.opts.partIdx,staffIdx:0,staffDetails:v.default.createDefault()},y=new f.default(this.scoreData,N,this.cancelStack);(0,M.default)(y)}removePartQuarterAccidentals(){const n={partIdx:this.opts.partIdx};new d(this.scoreData,n,this.cancelStack).perform()}setHasQuarterTone(){const n={partIdx:this.opts.partIdx,hasQuarterTone:this.opts.hasQuarterTone};new p(this.scoreData,n,this.cancelStack).perform()}}Object.defineProperty(x,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"composite.SetHasQuarterTone"});const S=x},22178:(H,P,t)=>{t.d(P,{A:()=>x});var g=t(519405),v=t(109049),M=t(644317),f=t(596237),l=t(324318),r=t(652394),u=t(852363),c=t(851480);const m=function(S,I,n){this.init(S,I,n)};m.NAME=c.p;const o=m.prototype;o.name=m.NAME,o.init=function(S,I,n){this.scoreData=S,this.cancelStack=n,this.opts=I},o.perform=function(){this.addMmr(),this.updateStack()},o.addMmr=function(){this.scoreData.getCommonContent().setMultiMeasureRest(this.opts.measureIdx,this.opts.nbMeasures)},o.updateStack=function(){const S=this.scoreData.getNbParts();for(let I=0;I<S;I++){const n={partIdx:I,measureIdx:this.opts.measureIdx},a={type:this.name,opts:n};this.cancelStack.push(a),(0,u.default)(this.cancelStack,this.scoreData,n)}};const s=m,d=function(S,I,n){this.init(S,I,n)};d.NAME="composite.AddMultiMeasureRest";const h=d.prototype;h.name=d.NAME,h.init=function(S,I,n){this.scoreData=S,this.cancelStack=n,this.opts=I},h.perform=function(){this.clearContent(),this.addMultiMeasureRest()},h.clearContent=function(){this.clearTempoChanges(),this.clearMeasureRepeats(),this.clearMeasureSlashes(),this.clearMeasureContent()},h.clearTempoChanges=function(){const S={measureIdx:this.opts.measureIdx,timePos:0,dpq:1};new f.A(this.scoreData,S,this.cancelStack).perform()},h.clearMeasureRepeats=function(){const S={measureIdx:this.opts.measureIdx};new l.A(this.scoreData,S,this.cancelStack).perform()},h.clearMeasureSlashes=function(){const S={measureIdx:this.opts.measureIdx};new r.A(this.scoreData,S,this.cancelStack).perform()},h.clearMeasureContent=function(){const S=this.scoreData.getNbParts();for(let I=0;I<S;I++){const n={partIdx:I,measureIdx:this.opts.measureIdx,preserveWords:!0};new M.A(this.scoreData,n,this.cancelStack).perform()}},h.addMultiMeasureRest=function(){const S={measureIdx:this.opts.measureIdx,nbMeasures:this.opts.nbMeasures};new s(this.scoreData,S,this.cancelStack).perform()};const e=d,i=function(S,I,n){this.init(S,I,n)};i.NAME="composite.AddMultiMeasureRestErase";const p=i.prototype;p.name=i.NAME,p.init=function(S,I,n){this.scoreData=S,this.cancelStack=n,this.opts=I},p.perform=function(){this.hasMultiMeasureRest()&&this.removeMultiMeasureRest(),this.addMultiMeasureRest()},p.hasMultiMeasureRest=function(){return this.scoreData.getCommonContent().hasMultiMeasureRest(this.opts.measureIdx)},p.removeMultiMeasureRest=function(){const S={measureIdx:this.opts.measureIdx},I=new v.default(this.scoreData,S,this.cancelStack);(0,g.default)(I)},p.addMultiMeasureRest=function(){const S={measureIdx:this.opts.measureIdx,nbMeasures:this.opts.nbMeasures};new e(this.scoreData,S,this.cancelStack).perform()};const x=i},22942:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(951066);function v(f){return`Barline side value ${f}is invalid.`}class M extends g.A{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"side",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadSideBarlineError",this.side=l}}},34679:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(793317),v=t(578918),M=t(852363),f=t(316197),l=t(123491),r=t(351277);const u=function(o,s,d){this.init(o,s,d)};u.NAME="primitive.AddGlissandoSide";const c=u.prototype;c.name=u.NAME,c.initMeasureData=g.default,c.init=function(o,s,d){this.initMeasureData(o,s),this.opts=s,this.cancelStack=d},c.perform=function(){const o=f.default.create(this.opts.glissandoType,this.opts.number),s=this.getNoteAtPitch();l.default.addGlissando(s,o),this.updateStack()},c.getNoteAtPitch=function(){const o=this.measureData.getVoice(this.opts.voiceIdx);return(0,v.default)(o,this.opts.noteIdx,this.opts.pitch)},c.updateStack=function(){const o={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:r.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(o),(0,M.default)(this.cancelStack,this.measureData,this.opts)};const m=u},42363:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(123491),v=t(259563),M=t(476943),f=t(793317),l=t(852363);const r=function(e,i,p){this.init(e,i,p)};r.NAME="primitive.ChangeGraceDuration";const u=r.prototype;u.name=r.NAME,u.initMeasureData=f.default,u.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeGraceDuration(),this.updateStack()},u.changeGraceDuration=function(){let i=this.measureData.getVoice(this.opts.voiceIdx).getGraceChord(this.opts.noteIdx,this.opts.graceIdx);i=M.default.makeArray(i),i.forEach(this.setHeadDuration,this)},u.setHeadDuration=function(e){g.default.setDurationType(e,this.opts.durationType)},u.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const c=r;var m=t(643569),o=t(519405);const s=function(e,i,p){this.init(e,i,p)};s.NAME="primitive.ChangeGraceDuration";const d=s.prototype;d.name=s.NAME,d.initMeasureData=f.default,d.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlashIfNeeded(),this.changeGraceDuration()},d.removeSlashIfNeeded=function(){this.needRemoveSlash()&&this.removeSlash()},d.needRemoveSlash=function(){if(this.opts.durationType===v.default.EIGHT)return!1;const i=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx);return g.default.isSlashedGrace(i)},d.removeSlash=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx},i=new m.default(this.measureData,e,this.cancelStack);(0,o.default)(i)},d.changeGraceDuration=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType};new c(this.measureData,e,this.cancelStack).perform()};const h=s},47740:(H,P,t)=>{t.d(P,{A:()=>n});var g=t(476943),v=t(123491),M=t(793317),f=t(519405),l=t(414208),r=t(705967),u=t(704588),c=t(487332),m=t(805396),o=t(473990),s=t(99448),d=t(568357),h=t(724095),e=t(852363);const i=function(a,D,T){this.init(a,D,T)};i.NAME="primitive.AddTremolo2";const p=i.prototype;p.name=i.NAME,p.initMeasureData=M.default,p.init=function(a,D,T){this.initMeasureData(a,D),this.cancelStack=T,this.opts=D},p.perform=function(){const a=this.measureData.getVoice(this.opts.voiceIdx);this.addLeftSide(a),this.addRightSide(a),this.updateStack()},p.addLeftSide=function(a){const D=a.getNote(this.opts.noteIdx),T={nbBeam:this.opts.nbBeams,type:d.A.START};v.default.addOrnament(D,h.A.TREMOLO,T)},p.addRightSide=function(a){const D=a.getNote(this.opts.noteIdx+1),T={nbBeam:this.opts.nbBeams,type:d.A.STOP};v.default.addOrnament(D,h.A.TREMOLO,T)},p.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a),(0,e.default)(this.cancelStack,this.measureData,this.opts)};const x=i,S=function(a,D,T){this.init(a,D,T)};S.NAME="composite.AddTremolo2";const I=S.prototype;I.name=S.NAME,I.init=function(a,D,T){M.default.call(this,a,D),this.cancelStack=T,this.opts=D,this.voice=null},I.perform=function(){this.removeTremolo2(),this.removeConnections(),this.removeOrnaments(),this.removeGraces(),this.addTremolo()},I.removeConnections=function(){let D=this.getVoice().getChord(this.opts.noteIdx);if(D=g.default.makeArray(D),D.some(v.default.hasTieStart)){const T=this.createLeftPosOpts(),N=new l.default(this.measureData,T,this.cancelStack);(0,f.default)(N)}if(D.some(v.default.hasGlissandoStart)){const T=this.createLeftPosOpts(),N=new r.default(this.measureData,T,this.cancelStack);(0,f.default)(N)}if(D.some(v.default.hasSlideStart)){const T=this.createLeftPosOpts(),N=new u.default(this.measureData,T,this.cancelStack);(0,f.default)(N)}if(D.some(v.default.hasHammerOnPullOffStart)){const T=this.createLeftPosOpts(),N=new c.default(this.measureData,T,this.cancelStack);(0,f.default)(N)}},I.createLeftPosOpts=function(){return{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx}},I.removeTremolo2=function(){const a=this.getVoice(),D=a.getNote(this.opts.noteIdx);if(v.default.hasTremoloStop(D)){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},y=new m.default(this.measureData,N,this.cancelStack);(0,f.default)(y)}if(v.default.hasTremoloStart(D)){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},y=new m.default(this.measureData,N,this.cancelStack);(0,f.default)(y)}const T=a.getNote(this.opts.noteIdx+1);if(v.default.hasTremoloStart(T)){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1},y=new m.default(this.measureData,N,this.cancelStack);(0,f.default)(y)}},I.removeOrnaments=function(){this.removeNoteOrnaments(this.opts.noteIdx),this.removeNoteOrnaments(this.opts.noteIdx+1)},I.removeNoteOrnaments=function(a){const T=this.getVoice().getNote(a);v.default.getOrnamentsList(T).forEach(N=>{const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:a,ornamentType:N},A=new o.default(this.measureData,y,this.cancelStack);(0,f.default)(A)})},I.removeGraces=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1};new s.A(this.measureData,a,this.cancelStack).perform()},I.addTremolo=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,nbBeams:this.opts.nbBeams};new x(this.measureData,a,this.cancelStack).perform()},I.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice};const n=S},49323:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(436369);const v=function(e,i,p){this.init(e,i,p)};v.NAME="primitive.RemoveJumpCall";const M=v.prototype;M.name=v.NAME,M.init=function(e,i,p){this.scoreData=e,this.opts=i,this.cancelStack=p},M.perform=function(){this.removeTagInCommonContent(),this.updateStack()},M.removeTagInCommonContent=function(){this.getCommonContent().removeJumpCall(this.opts.measureIdx)},M.getCommonContent=function(){return this.scoreData.getCommonContent()},M.updateStack=function(){const e=this.scoreData.getNbParts();for(let i=0;i<e;i++){const p={type:this.name,opts:{partIdx:i,measureIdx:this.opts.measureIdx}};this.cancelStack.push(p)}(0,g.A)(this.cancelStack,this.scoreData,this.opts)};const f=v;var l=t(889346),r=t(607801),u=t(701387),c=t(555172);const m="-signalBackwardJump",o=function(e,i,p){this.init(e,i,p)};o.NAME="composite.RemoveJumpCall";const s=o.prototype;s.name=o.NAME,s.init=function(e,i,p){this.scoreData=e,this.opts=i,this.cancelStack=p},s.getCommonContent=function(){return this.scoreData.getCommonContent()},s.perform=function(){const i=this.getCommonContent().getJumpCall(this.opts.measureIdx);this.removeJumpCall(),this.canClearBarline(i)&&this.clearBarline(),this.needChangeLastBarline()&&this.canChangeLastBarline(i)&&this.clearLastBarline(),d(i)&&this.signalBackwardJumps()},s.removeJumpCall=function(){const e={measureIdx:this.opts.measureIdx,type:this.opts.type};new f(this.scoreData,e,this.cancelStack).perform()},s.canClearBarline=function(e){if(e!==r.A.FINE)return!1;const p=this.scoreData.getMeasure(0,this.opts.measureIdx);return u.default.hasRightBarline(p)?!!u.default.hasFinalBarline(p):!1},s.clearBarline=function(){const e={measureIdx:this.opts.measureIdx};new l.A(this.scoreData,e,this.cancelStack).perform()},s.needChangeLastBarline=function(){const e=this.scoreData.getNbMeasures();return this.opts.measureIdx<e-1},s.canChangeLastBarline=function(e){if(e!==r.A.FINE)return!1;const p=this.scoreData.getNbMeasures()-1,S=this.scoreData.getMeasure(0,p);return u.default.hasRightBarline(S)?u.default.hasRepeatBackward(S)?!1:u.default.getRightBarlineStyle(S)===c.A.DEFAULT_STYLE:!0},s.clearLastBarline=function(){const p={measureIdx:this.scoreData.getNbMeasures()-1};new l.A(this.scoreData,p,this.cancelStack).perform()};const d=function(e){return r.A.isJumpForward(e)};s.signalBackwardJumps=function(){const e=this.scoreData.getNbMeasures();for(let i=this.opts.measureIdx+1;i<e;i++){const p=this.getCommonContent();if(p.hasJumpCall(i)){const x=p.getJumpCall(i);r.A.isJumpBackward(x)&&this.signalBackwardJump(i)}}},s.signalBackwardJump=function(e){const p={type:this.name+m,opts:{partIdx:0,measureIdx:e,type:this.opts.type}};this.cancelStack.push(p),(0,g.A)(this.cancelStack,this.scoreData,{measureIdx:e})};const h=o},57572:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(f){super(`The quarter duration [${f}] is invalid.`),Object.defineProperty(this,"quarterDuration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadQuarterDurationError",this.quarterDuration=f}}},66692:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(364842),v=t(123491),M=t(76004),f=t(343667),l=t(793317),r=t(852363);const u=function(o,s,d){this.init(o,s,d)};u.NAME="primitive.ChangeGraceHeadPercu";const c=u.prototype;c.initMeasureData=l.default,c.name=u.NAME,c.init=function(o,s,d){this.initMeasureData(o,s),this.cancelStack=d,this.opts=s},c.perform=function(){const o=this.getGraceAtUnpitched();v.default.setHead(o,this.opts.notehead);const s=this.getUnpitchedInstrumentId();v.default.setInstrumentId(o,s),this.updateStack()},c.getGraceAtUnpitched=function(){const o=this.measureData.getVoice(this.opts.voiceIdx),s=(0,M.A)(o,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);if(typeof s=="undefined")throw new g.default("NoGraceAtPitch");return s},c.getUnpitchedInstrumentId=function(){return(0,f.A)(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead)},c.updateStack=function(){const o={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(o),(0,r.default)(this.cancelStack,this.measureData,this.opts)};const m=u},70862:(H,P,t)=>{t.d(P,{A:()=>I});var g=t(217530);const v=function(n,a,D){this.init(n,a,D)};v.NAME="composite.UpdateRangeOwnSwing";const M=v.prototype;M.name=v.NAME,M.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},M.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let n=this.opts.startMeasureIdx;n<=this.opts.stopMeasureIdx;n++)this.updateMeasureSwing(n);this.hasMeasureAfter()&&this.updateMeasureSwing(this.opts.stopMeasureIdx+1)},M.hasMeasureAfter=function(){const n=this.scoreData.getNbMeasures();return this.opts.stopMeasureIdx+1<n},M.updateMeasureSwing=function(n){const a={measureIdx:n};new g.A(this.scoreData,a,this.cancelStack).perform()};const f=v;var l=t(777345),r=t(436369),u=t(657107);const c=function(n,a,D){this.init(n,a,D)};c.NAME="primitive.SetSwing";const m=c.prototype;m.name=c.NAME,m.init=function(n,a,D){this.commonContent=(0,u.A)(n),this.cancelStack=D,this.opts=a},m.perform=function(){this.setSwing(),this.updateStack()},m.setSwing=function(){this.commonContent.setSwing(this.opts.measureIdx,l.default.copy(this.opts.swing))},m.updateStack=function(){const n={type:this.name,noDraw:!0,opts:{measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,r.A)(this.cancelStack,this.commonContent.getScoreData(),this.opts)};const o=c,s=function(n,a,D){this.init(n,a,D)};s.NAME="composite.SetSwingIfNeeded";const d=s.prototype;d.name=s.NAME,d.init=function(n,a,D){this.commonContent=(0,u.A)(n,a),this.cancelStack=D,this.opts=a},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSetSwing()&&this.setSwingIfNeeded()},d.needSetSwing=function(){const n=this.commonContent.getSwing(this.opts.measureIdx);return!l.default.isSame(n,this.opts.swing)},d.setSwingIfNeeded=function(){const n={measureIdx:this.opts.measureIdx,swing:l.default.copy(this.opts.swing)};new o(this.commonContent,n,this.cancelStack).perform()};const h=s,e=function(n,a,D){this.init(n,a,D)};e.NAME="composite.SetRangeSwing";const i=e.prototype;i.name=e.NAME,i.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let n=this.opts.startMeasureIdx;n<=this.opts.stopMeasureIdx;n++)this.setSwing(n)},i.setSwing=function(n){const a={measureIdx:n,swing:l.default.copy(this.opts.swing)};new h(this.scoreData,a,this.cancelStack).perform()};const p=e,x=function(n,a,D){this.init(n,a,D)};x.NAME="composite.SetSwingSegment";const S=x.prototype;S.name=x.NAME,S.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},S.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setSwing(),this.updateOwnSwing()},S.setSwing=function(){const n={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,swing:l.default.copy(this.opts.swing)};new p(this.scoreData,n,this.cancelStack).perform()},S.updateOwnSwing=function(){const n={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new f(this.scoreData,n,this.cancelStack).perform()};const I=x},77852:(H,P,t)=>{t.d(P,{A:()=>I});var g=t(364842),v=t(726042),M=t(210888),f=t(701387),l=t(606106),r=t(788220),u=t(316610),c=t(852363);const m=function(n,a,D){this.init(n,a,D)};m.NAME="primitive.AddWord";const o=m.prototype;o.name=m.NAME,o.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a,this.measure=null,this.wordIdx=null,this.localTimePos=null},o.perform=function(){this.addWord(),this.updateStack()},o.addWord=function(){const n=this.getMeasure(),a=this.getWordIdx(),D=this.createWord(),T=f.default.getWords(n,this.opts.staffIdx);T.splice(a,0,D),f.default.setWords(n,this.opts.staffIdx,T)},o.getWordIdx=function(){return this.wordIdx===null&&this.fetchWordIdx(),this.wordIdx},o.fetchWordIdx=function(){const n=this.getMeasure(),a=f.default.getWords(n,this.opts.staffIdx);if(a.some(this.tryWordIdx,this),this.wordIdx===null){const D=a.length;this.wordIdx=D}},o.tryWordIdx=function(n,a){const D=this.getLocalTimePos(),T=r.A.getTimePos(n);if(T<D)return!1;if(T>D)return this.wordIdx=a,!0;{const N="There is already an word at this time position.";throw new g.default("TimePosCollision",N)}},o.createWord=function(){const n=this.getLocalTimePos(),a=r.A.create(this.opts.staffIdx,this.opts.placement,n,this.opts.text),D=M.default.generate();return this.cancelStack.addEntityUuid({entityType:l.A.WORD,uuid:D}),r.A.setWordUuid(a,D),a},o.getLocalTimePos=function(){if(this.localTimePos===null){const n=this.getMeasure();if(this.localTimePos=(0,u.A)(this.opts,n),!v.default.isInteger(this.localTimePos)){const a=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new g.default("IntegerExpected",a)}}return this.localTimePos},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},o.updateStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const s=m;var d=t(746822);const h=function(n,a,D){this.init(n,a,D)};h.NAME="composite.AddWord";const e=h.prototype;e.name=h.NAME,e.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},e.perform=function(){this.updateDpq(),this.addWord()},e.updateDpq=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new d.A(this.scoreData,n,this.cancelStack).perform()},e.addWord=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text};new s(this.scoreData,n,this.cancelStack).perform()};const i=h;var p=t(618496);const x=function(n,a,D){this.init(n,a,D)};x.NAME="composite.AddWordErase";const S=x.prototype;S.name=x.NAME,S.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},S.perform=function(){this.removeFormerWord(),this.addWord()},S.removeFormerWord=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new p.default(this.scoreData,n,this.cancelStack).performIfPossible()},S.addWord=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,text:this.opts.text};new i(this.scoreData,n,this.cancelStack).perform()};const I=x},86316:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("The selected rehearsal value is not `auto`."),this.name="NotAutoRehearsalError"}}},95126:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(123491),v=t(852363),M=t(793317);const f=function(s,d,h){this.init(s,d,h)};f.NAME="primitive.AddTechnical";const l=f.prototype;l.name=f.NAME,l.initMeasureData=M.default,l.init=function(s,d,h){this.initMeasureData(s,d),this.cancelStack=h,this.opts=d},l.perform=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);g.default.addTechnical(d,this.opts.technicalType,this.opts.technicalOpts),this.updateStack()},l.updateStack=function(){const s={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:this.opts.technicalType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(s),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const r=f;var u=t(246451);const c=function(s,d,h){this.init(s,d,h)};c.NAME="composite.AddTechnical";const m=c.prototype;m.name=c.NAME,m.init=function(s,d,h){this.measureData=s,this.cancelStack=h,this.opts=d},m.perform=function(){const d=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);this.hasIncompatibleTechnical(d)&&this.removeIncompatibleTechnical(d),new r(this.measureData,this.opts,this.cancelStack).perform()},m.hasIncompatibleTechnical=function(s){return g.default.hasIncompatibleTechnical(s,this.opts.technicalType,this.opts.technicalOpts)},m.removeIncompatibleTechnical=function(s){g.default.getIncompatibleTechnical(s,this.opts.technicalType,this.opts.technicalOpts).forEach(function(h){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,technicalType:h,noteIdx:this.opts.noteIdx},i=new u.default(this.measureData,e,this.cancelStack);i.checkPreconditions(),i.perform()},this)};const o=c},114714:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(123491),v=t(793317),M=t(768498),f=t(852363);const l=function(c,m,o){this.init(c,m,o)};l.NAME="primitive.AddGhostNotePercu";const r=l.prototype;r.name=l.NAME,r.initMeasureData=v.default,r.init=function(c,m,o){this.initMeasureData(c,m),this.cancelStack=o,this.opts=m},r.perform=function(){this.addGhostNotePercu(),this.updateStack()},r.addGhostNotePercu=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),m=(0,M.A)(c,this.opts.noteIdx,this.opts.unpitched);g.default.addHeadParentheses(m)},r.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,f.default)(this.cancelStack,this.measureData,this.opts)};const u=l},120055:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(366160),v=t(910748),M=t(615059);const f=function(c){c.forEach(l)},l=function(c,m,o){const s=g.A.getMaxIndex();if(c.Action=null,c.index>s)if(c.input)r(o,m),c.index=s;else{c.Action=M.default;return}const d=g.A.indexToLetter(c.index);c.value!==d&&(c.value=d,c.Action=v.default)},r=function(c,m){const o=g.A.getMaxIndex();for(m--;m>=0;m--){const s=c[m];if(s.index>=o)s.Action=M.default;else return}},u=f},123966:(H,P,t)=>{t.d(P,{A:()=>i});var g=t(737903),v=t(35802),M=t(518558),f=t(474620),l=t(966336),r=t(701387),u=t(721247),c=t(668674);const m=function(p,x,S){this.init(p,x,S)},o=m.prototype;o.init=function(p,x,S){this.data=p,this.partIdx=x,this.scoreData=S,this.measuresScroller=null},o.getMeasure=function(p){return this.data.measure[p]},o.getAroundEnv=function(p){const x={};let S;p===0?S=0:S=p-1;const I=this.data.measure[S],a=new l.A(I).getVoicesIndexes();x.voicesIndexes=a;let T=this.scoreData.getCommonContent().getDisplayedTime(S);return T=M.default.copy(T),x.attributes=typeof I.$adagio.attributes=="undefined"?{}:(0,g.default)(I.$adagio.attributes),p>0&&d(I,x.attributes),v.default.setTime(x.attributes,[T]),x.sound=typeof I.$adagio.sound=="undefined"?{}:(0,g.default)(I.$adagio.sound),s(I,x),x},o.getAroundSlashes=function(p){let x;p===0?x=0:x=p-1;const S=this.data.measure[x],I={},n=r.default.getNbStaves(S);for(let a=0;a<n;a++)if(r.default.hasSlash(S,a)){let D=r.default.getSlash(S,a);D=c.A.copy(D),I[a]=D}return I};function s(p,x){x.slash={};const S=r.default.getNbStaves(p);for(let I=0;I<S;I++)if(r.default.hasSlash(p,I)){let n=r.default.getSlash(p,I);n=c.A.copy(n),x.slash[I]=n}}function d(p,x){const S=r.default.getNbStaves(p),I=v.default.getWrappedClef(x);for(let a=0;a<S;a++){if(!r.default.hasMiddleClefs(p,a))continue;const D=r.default.getMiddleClefs(p,a),T=D[D.length-1],N=u.default.copy(T);I.setEntry(N,a)}const n=I.dumpAttribute();v.default.setClef(x,n)}o.getMeasureData=function(p){return this.getMeasuresScroller().getMeasureData(p)},o.getMeasuresScroller=function(){if(this.measuresScroller===null){const p=this.getMeasures();this.measuresScroller=new f.A(p,this.partIdx,this.scoreData)}return this.measuresScroller},o.getMeasures=function(){return this.data.measure},o.setEnv=function(p,x){const S=this.data.measure[p];S.attributes=x.attributes,typeof x.sound!="undefined"&&(S.sound=x.sound)},o.getFirstEnv=function(){const p=this.data.measure[0],x={attributes:p.attributes};return typeof p.sound!="undefined"&&(x.sound=p.sound),s(p,x),x},o.resetFirstMeasure=function(){const p=this.data.measure[0];delete p.attributes,delete p.sound},o.insertMeasure=function(p,x){this.data.measure.splice(x,0,p)},o.eraseMeasure=function(p){this.data.measure.splice(p,1)},o.getNbMeasures=function(){return this.getMeasures().length},o.getPartIdx=function(){return this.partIdx},o.getScoreData=function(){return this.scoreData};const h=m,i=function(p,x){if(p instanceof h)this.partData=p;else{const S=p.getPartContent(x.partIdx);this.partData=new h(S,x.partIdx,p)}this.opts=x}},125394:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(902630);function v(l,r){const u={minFret:null,maxFret:null};l.forEach(M,u);let c=1;u.minFret!==null&&u.minFret>=5&&(c=u.minFret);let m=4;if(u.maxFret!==null){const d=u.maxFret+1-c;m=Math.max(m,d)}const o=l.map(f);return g.default.create(r,m,c,o)}function M(l){const r=l.fret;if(r===0)return;const u=this;u.maxFret===null?u.maxFret=r:u.maxFret=Math.max(u.maxFret,r),u.minFret===null?u.minFret=r:u.minFret=Math.min(u.minFret,r)}function f(l){const r=l.string,u=l.fret;return{string:r.toString(),fret:u.toString()}}},130600:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(123491),v=t(259563),M=t(540042),f=t(364842),l=t(852363),r=t(793317);const u=function(e,i,p){this.init(e,i,p)};u.NAME="primitive.AddGraceSlash";const c=u.prototype;c.initMeasureData=r.default,c.name=u.NAME,c.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addGraceSlash(),this.updateStack()},c.addGraceSlash=function(){const i=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx);if(g.default.getDurationType(i)!==v.default.EIGHT){const x="Only eighth grace notes can be slashed.";throw new f.default("EighthExpected",x)}g.default.makeSlashedGrace(i)},c.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const m=u;var o=t(519405);const s=function(e,i,p){this.init(e,i,p)};s.NAME="primitive.AddGraceSlash";const d=s.prototype;d.initMeasureData=r.default,d.name=s.NAME,d.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeDurationIfNeeded(),this.addGraceSlash()},d.changeDurationIfNeeded=function(){this.needChangeDuration()&&this.changeDuration()},d.needChangeDuration=function(){const i=this.measureData.getVoice(this.opts.voiceIdx).getGrace(this.opts.noteIdx,this.opts.graceIdx);return g.default.getDurationType(i)!==v.default.EIGHT},d.changeDuration=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:v.default.EIGHT},i=new M.default(this.measureData,e,this.cancelStack);(0,o.default)(i)},d.addGraceSlash=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx};new m(this.measureData,e,this.cancelStack).perform()};const h=s},143482:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(842086),v=t(436369);const M=function(m,o,s){this.init(m,o,s)};M.NAME="primitive.AddJumpTag";const f=M.prototype;f.name=M.NAME,f.init=function(m,o,s){this.scoreData=m,this.opts=o,this.cancelStack=s},f.perform=function(){this.setTagInCommonContent(),this.updateStack()},f.setTagInCommonContent=function(){this.getCommonContent().setJumpTag(this.opts.measureIdx,this.opts.type)},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.updateStack=function(){const{measureIdx:m}=this.opts,o=this.scoreData.getNbParts();for(let s=0;s<o;s++){const d={type:this.name,opts:{partIdx:s,measureIdx:m}};this.cancelStack.push(d)}(0,v.A)(this.cancelStack,this.scoreData,{measureIdx:m})};const l=M,r=function(m,o,s){this.init(m,o,s)};r.NAME="composite.AddJumpTag";const u=r.prototype;u.name=r.NAME,u.init=function(m,o,s){this.scoreData=m,this.opts=o,this.cancelStack=s},u.getCommonContent=function(){return this.scoreData.getCommonContent()},u.perform=function(){this.getCommonContent().hasJumpTag(this.opts.measureIdx)&&this.removeCurrentJumpTag();const o={measureIdx:this.opts.measureIdx,type:this.opts.type};new l(this.scoreData,o,this.cancelStack).perform()},u.removeCurrentJumpTag=function(){const m={measureIdx:this.opts.measureIdx},o=new g.default(this.scoreData,m,this.cancelStack);o.checkPreconditions(),o.perform()};const c=r},146543:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(794799),v=t(606106),M=t(123491),f=t(210888),l=t(271449),r=t(650371),u=t(343818),c=t(2110),m=t(519405),o=t(925822);const s=function(I,n,a){this.init(I,n,a)};s.NAME="composite.RemoveSlursRange";const d=s.prototype;d.name=s.NAME,d.init=function(I,n,a){this.measuresScroller=(0,c.A)(I,n),this.cancelStack=a,this.opts=n},d.getVoice=function(){return this.measuresScroller.getVoice(this.opts.voiceIdx)},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlursRange()},d.removeSlursRange=function(){let I=this.opts.startNoteIdx,n=this.opts.startMeasureIdx;const a=this.opts.stopNoteIdx,D=this.opts.stopMeasureIdx;for(;e(n,D,I,a);){const T=this.measuresScroller.getMeasureData(n);if(T.hasVoice(this.opts.voiceIdx)){const N=T.getVoice(this.opts.voiceIdx),y=N.getNote(I);M.default.hasSlur(y)?this.removeSlur(n,I):this.enclosingRemove||(this.removeSlur(n,I),this.enclosingRemove=!0),I++,I===N.getNbNotes()&&(I=0,n++)}else I=0,n++}},d.removeSlur=function(I,n){const a={partIdx:this.opts.partIdx,measureIdx:I,voiceIdx:this.opts.voiceIdx,noteIdx:n},D=new o.default(this.measuresScroller,a,this.cancelStack);(0,m.default)(D,h)};function h(I){return I instanceof u.A}const e=function(I,n,a,D){return I<n?!0:I===n?a<=D:!1},i=s,p=function(I,n,a){this.init(I,n,a)};p.NAME="composite.AddSlur";const x=p.prototype;x.name=p.NAME,x.init=function(I,n,a){this.measuresScroller=(0,c.A)(I,n),this.cancelStack=a,this.opts=n,this.staffIdx=null},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.opts.overwrite&&this.removeSlursRange(),this.slurUuid=f.default.generate(),this.cancelStack.addEntityUuid({entityType:v.A.SLUR,uuid:this.slurUuid}),this.addSlurLeftSide(),this.addSlurRightSide(),this.addContinues()},x.removeSlursRange=function(){const I={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:this.opts.startMeasureIdx,startNoteIdx:this.opts.startNoteIdx,stopMeasureIdx:this.opts.stopMeasureIdx,stopNoteIdx:this.opts.stopNoteIdx,placement:this.opts.placement};new i(this.measuresScroller,I,this.cancelStack).perform()},x.addSlurLeftSide=function(){const I=this.isCrossMeasure(),n={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.startNoteIdx,type:g.A.START,isCrossMeasure:I,slurUuid:this.slurUuid,placement:this.opts.placement},a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx);new l.A(a,n,this.cancelStack).perform()},x.addSlurRightSide=function(){const I=this.isCrossMeasure(),n={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.stopNoteIdx,type:g.A.STOP,placement:this.opts.placement,isCrossMeasure:I},a=this.measuresScroller.getMeasureData(this.opts.stopMeasureIdx);new l.A(a,n,this.cancelStack).perform()},x.isCrossMeasure=function(){return this.opts.startMeasureIdx!==this.opts.stopMeasureIdx},x.addContinues=function(){const I=this.opts.startMeasureIdx,n=this.opts.stopMeasureIdx;for(let a=I;a<n;a++)this.addContinue(a)},x.addContinue=function(I){const n=this.getStaffIdx(),a={partIdx:this.opts.partIdx,measureIdx:I,voiceIdx:this.opts.voiceIdx,staffIdx:n,slurUuid:this.slurUuid,placement:this.opts.placement},D=this.measuresScroller.getScoreData();new r.A(D,a,this.cancelStack).perform()},x.getStaffIdx=function(){if(this.staffIdx===null){const a=this.measuresScroller.getMeasureData(this.opts.startMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.opts.startNoteIdx);this.staffIdx=M.default.getStaffIdx(a)}return this.staffIdx};const S=p},147507:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(369672),v=t(143146),M=t(711711),f=t(123491),l=t(925822),r=t(793317);const u=function(h,e,i){this.init(h,e,i)};u.NAME="composite.RemoveVoiceSlurs";const c=u.prototype;c.name=u.NAME,c.initMeasureData=r.default,c.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoiceSlurs()},c.removeVoiceSlurs=function(){const h=this.measureData.getVoice(this.opts.voiceIdx),e=h.size();for(let i=0;i<e;i++){const p=h.getNote(i);f.default.hasSlur(p)&&this.removeSlur(i)}},c.removeSlur=function(h){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:h};new l.default(this.measureData,e,this.cancelStack).perform()};const m=u,o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.ClearVoice";const s=o.prototype;s.initMeasureData=r.default,s.name=o.NAME,s.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoiceSlurs(),this.clearTuplets(),this.clearChords(),this.opts.removeFloating&&this.clearFloating()},s.removeVoiceSlurs=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new m(this.measureData,h,this.cancelStack).perform()},s.clearTuplets=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:0,divisions:1};new g.A(this.measureData,h,this.cancelStack).perform()},s.clearChords=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:0,divisions:1};new v.A(this.measureData,h,this.cancelStack).perform()},s.clearFloating=function(){const h=this.measureData.getScoreData(),e=h.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:e};new M.A(h,i,this.cancelStack).perform()};const d=o},149658:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(383279),v=t(448931);const M=function(o,s,d){this.init(o,s,d)};M.NAME=v.p;const f=M.prototype;f.name=M.NAME,f.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addVoice(),this.updateStack()},f.addVoice=function(){const o=this.scoreData.getPartHeader(this.opts.partIdx),s=this.opts.voiceIdx,d=this.opts.staffIdx,h=g.default.getVoiceMapping(o);h[s]=[d],g.default.setVoiceMapping(o,h);const e=g.default.getStaffMapping(o),i=e[d];i.voices.splice(this.opts.idxInStaff,0,s),this.opts.isMainVoice&&(i.mainVoiceIdx=s),g.default.setStaffMapping(o,e),g.default.recordVoiceUuid(o,s,this.opts.voiceUuid)},f.updateStack=function(){const o={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx},s={type:this.name,opts:o};this.cancelStack.push(s)};const l=M;var r=t(551303);const u=function(o,s,d){this.init(o,s,d)};u.NAME="composite.AddVoice";const c=u.prototype;c.name=u.NAME,c.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addVoice(),this.opts.show&&this.showMeasuresVoice()},c.addVoice=function(){const o={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,idxInStaff:this.opts.idxInStaff,isMainVoice:this.opts.isMainVoice,voiceUuid:this.opts.voiceUuid};new l(this.scoreData,o,this.cancelStack).perform()},c.showMeasuresVoice=function(){const o=this.scoreData.getNbMeasures();for(let s=0;s<o;s++)this.showMeasureVoice(s)},c.showMeasureVoice=function(o){const s={partIdx:this.opts.partIdx,measureIdx:o,voiceIdx:this.opts.voiceIdx};new r.default(this.scoreData,s,this.cancelStack).perform()};const m=u},152436:(H,P,t)=>{t.d(P,{A:()=>N});var g=t(515819),v=t(701387),M=t(726042),f=t(123491),l=t(209175),r=t(366274),u=t(823880),c=t(15635),m=t(405347),o=t(551303),s=t(27912),d=t(793317),h=t(519405),e=t(964039),i=t(737296);const p=function(y,A,R){this.init(y,A,R)};p.NAME="composite.AddRestIntraMeasure";const x=p.prototype;x.name=p.NAME,x.initMeasureData=d.default,x.init=function(y,A,R){this.initMeasureData(y,A),this.cancelStack=R,this.opts=A,this.quarterPosition=A.quarterPosition,this.quarterDuration=A.quarterDuration,this.noteIdx=null},x.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),!this.isVoiceDisplayed())if(this.opts.forceShowVoice)this.showVoice();else return;this.removeSpaceTuplets(),this.removeSpaceChords(),this.splitRest(),this.fetchNoteIdx(),this.changeDurations()},x.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},x.showVoice=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},A=new o.default(this.measureData,y,this.cancelStack);(0,h.default)(A)},x.removeSpaceTuplets=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new r.A(this.measureData,y,this.cancelStack).perform()},x.removeSpaceChords=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new u.A(this.measureData,y,this.cancelStack).perform()},x.splitRest=function(){const y=g.default.quarterDurationToRequiredDpq(this.quarterPosition),A=g.default.quarterToDuration(this.quarterPosition,y),R={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:A,dpq:y};new c.A(this.measureData,R,this.cancelStack).perform()},x.fetchNoteIdx=function(){const y=this.measureData.getDpqValue(),A=g.default.quarterToDuration(this.quarterPosition,y),R=this.measureData.getVoice(this.opts.voiceIdx),W=1;this.noteIdx=(0,s.A)(R,W,A)},x.changeDurations=function(){this.getQuarterDurations().forEach(this.changeDuration,this)},x.getQuarterDurations=function(){const y=g.default.quarterDurationToRequiredDpq(this.quarterPosition),A=g.default.quarterDurationToRequiredDpq(this.quarterDuration),R=M.default.lcm(y,A),W=g.default.quarterToDuration(this.quarterPosition,R),F=g.default.quarterToDuration(this.quarterDuration,R),E=this.getQuarterPerBeat(),U=g.default.quarterToDuration(E,R),Q=l.default.createDefault(),G=new e.A(W,F,U,R,Q);return G.dispatch(),G.getDispatchedRests().map(S,R)};const S=function(y){const A=this.valueOf();return g.default.divisionsToQuarter(y,A)};x.getQuarterPerBeat=function(){const y=this.measureData.getAnyTime();return g.default.getBeatQuarterDuration(y)},x.getDurationOpts=function(y){return g.default.quarterToDurationOpts(y)},x.changeDuration=function(y){const A=g.default.quarterToDurationOpts(y),W=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.noteIdx),F=this.measureData.getDpqValue(),E=f.default.getNormalQuarterDuration(W,F);if(y===E){this.noteIdx++;return}const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx,durationType:A.durationType,nbDots:A.nbDots,insertMode:i.default.REPLACE},Q=new m.default(this.measureData,U,this.cancelStack);(0,h.default)(Q),this.noteIdx++};const I=p;var n=t(526881),a=t(857579);const D=function(y,A,R){this.init(y,A,R)};D.NAME="composite.AddRestCrossMeasure";const T=D.prototype;T.name=D.NAME,T.init=function(y,A,R){this.scoreData=y,this.cancelStack=R,this.opts=A,this.measureIdx=this.opts.measureIdx,this.quarterPosition=this.opts.quarterPosition,this.quarterDuration=this.opts.quarterDuration},T.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name);this.quarterDuration>0;){const y=this.getSliceDuration();this.addRestIntraMeasure(y),this.moveForward(y),this.measureEndReached()&&this.nextMeasure()}this.storePosition()},T.getSliceDuration=function(){const A=this.getMeasureQuarterDuration()-this.quarterPosition;return Math.min(A,this.quarterDuration)},T.addRestIntraMeasure=function(y){const A={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:y,forceShowVoice:this.opts.forceShowVoice};new I(this.scoreData,A,this.cancelStack).perform()},T.moveForward=function(y){this.quarterPosition+=y,this.quarterDuration-=y},T.measureEndReached=function(){return this.getMeasureQuarterDuration()===this.quarterPosition},T.getMeasureQuarterDuration=function(){const y=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),A=v.default.getAnyTime(y);return g.default.timeToQuarter(A)},T.nextMeasure=function(){this.measureIdx++,this.quarterPosition=0;const y=this.scoreData.getNbMeasures();this.measureIdx===y&&this.addMeasure()},T.addMeasure=function(){const y={measureIdx:this.measureIdx},A=new n.default(this.scoreData,y,this.cancelStack);(0,h.default)(A)},T.storePosition=function(){const y=this.fetchNoteIdx(),A={measureIdx:this.measureIdx,noteIdx:y};this.cancelStack.storePosition(A)},T.fetchNoteIdx=function(){if(this.quarterPosition===0)return 0;const y=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),A=new a.A(y);if(!A.hasVoice(this.opts.voiceIdx))return 0;const R=A.getVoice(this.opts.voiceIdx),W=A.getDpqValue(),F=g.default.quarterToDuration(this.quarterPosition,W);return(0,s.A)(R,1,F)};const N=D},155834:(H,P,t)=>{t.d(P,{A:()=>a});var g=t(476943),v=t(123491),M=t(349386),f=t(257818),l=t(80353);const r=l.A;var u=t(414208),c=t(846541),m=t(576363),o=t(536680),s=t(487332),d=t(3771),h=t(765350),e=t(823722),i=t(145170),p=t(737296),x=t(793317),S=t(519405);const I=function(D,T,N){this.init(D,T,N)};I.NAME="composite.InsertRest";const n=I.prototype;n.name=I.NAME,n.initMeasureData=x.default,n.init=function(D,T,N){this.initMeasureData(D,T),this.cancelStack=N,this.opts=T},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.breakConnection(),this.adaptDpqToNoteDuration(),this.adaptDpqToTimeSignature(),this.unlockRests(),this.addRest(),this.consumeSpace();const D=this.measureData.getVoice(this.opts.voiceIdx);(0,f.A)(D,this.opts.noteIdx+1)},n.breakConnection=function(){this.removeLeftTie(),this.measureData.isUnpitched()||(this.removeLeftGlissandos(),this.removeLeftSlides(),this.removeLeftHammerOnPullOffs())},n.removeLeftTie=function(){let T=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);if(T=g.default.makeArray(T),!T.some(v.default.hasTieStop))return;const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},y=this.measureData.isUnpitched()?c.default:u.default,A=new y(this.measureData,N,this.cancelStack);(0,S.default)(A)},n.removeLeftGlissandos=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).isRest(this.opts.noteIdx)){const T={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new m.A(this.measureData,T,this.cancelStack).perform()}},n.removeLeftSlides=function(){if(!this.measureData.getVoice(this.opts.voiceIdx).isRest(this.opts.noteIdx)){const T={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new o.A(this.measureData,T,this.cancelStack).perform()}},n.removeLeftHammerOnPullOffs=function(){let T=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);if(T=g.default.makeArray(T),!T.some(v.default.hasHammerOnPullOffStop))return;const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},y=new s.default(this.measureData,N,this.cancelStack);(0,S.default)(y)},n.adaptDpqToNoteDuration=function(){const T=this.getVoice().getAbsoluteTimeModif(),N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,timeModif:T};new d.A(this.measureData,N,this.cancelStack).perform()},n.adaptDpqToTimeSignature=function(){const D={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx};new h.A(this.measureData,D,this.cancelStack).perform()},n.getVoice=function(){const D=this.opts.voiceIdx,T=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(D,T)},n.unlockRests=function(){const D=this.getDuration(),T={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:p.default.INSERT,duration:D};new i.A(this.measureData,T,this.cancelStack).perform()},n.addRest=function(){const D={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new r(this.measureData,D,this.cancelStack).perform()},n.consumeSpace=function(){const D=this.getDuration(),T={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,insertMode:p.default.INSERT,duration:D};new e.A(this.measureData,T,this.cancelStack).perform()},n.getDuration=function(){const D=this.measureData.getDivisionsPerQuarterValue(),T=this.opts.voiceIdx,N=this.opts.noteIdx,A=this.measureData.getVoiceOrTupletForGet(T,N).getAbsoluteTimeModif();return(0,M.default)(this.opts,D,A)};const a=I},160580:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(764173),v=t(217530),M=t(701387),f=t(518558),l=t(777345),r=t(110976),u=t(74446),c=t(737903),m=t(813263);const o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.AddCommonContentMeasure";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.scoreData=h,this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addMeasure(),this.updateOwnTempo(),this.updateOwnSwing(),this.hasInsertedAtEnd()||(this.updateNextOwnTempo(),this.updateNextOwnSwing(),this.opts.measureIdx>0&&this.updateTempoChange())},s.addMeasure=function(){const h=this.getTempo(),e=this.getSwing();let i=this.getDisplayedTime();i=f.default.copy(i);let p=this.getBeatsList();p=u.default.copy(p);const x=this.scoreData.getRestsInsideBeams(this.getSourceMeasureIdx()),S=this.scoreData.getCommonContent();S.addMeasure(this.opts.measureIdx,r.default.copy(h),l.default.copy(e)),S.setDisplayedTime(this.opts.measureIdx,i),S.setBeatsList(this.opts.measureIdx,p),S.setRestsInsideBeams(this.opts.measureIdx,x)},s.getTempo=function(){const h=this.getSourceMeasureIdx();return this.scoreData.getRealTempo(h)},s.getSwing=function(){const h=this.getSourceMeasureIdx();return this.scoreData.getSwing(h)},s.getDisplayedTime=function(){const h=this.getSourceMeasureIdx();return this.scoreData.getCommonContent().getDisplayedTime(h)},s.getBeatsList=function(){const h=this.getSourceMeasureIdx(),e=this.getLocalTime(),i=this.getSourceTime();let p;return f.default.isSame(e,i)?p=this.scoreData.getCommonContent().getBeatsList(h):p=(0,m.default)(e),p},s.getLocalTime=function(){return this.getMeasureTime(this.opts.measureIdx)},s.getSourceTime=function(){const h=this.getContentSourceMeasureIdx();return this.getMeasureTime(h)},s.getMeasureTime=function(h){const i=this.scoreData.getMeasure(0,h);return M.default.getAnyTime(i)},s.getContentSourceMeasureIdx=function(){return this.opts.measureIdx===0?1:this.opts.measureIdx-1},s.getSourceMeasureIdx=function(){return this.opts.measureIdx===0?0:this.opts.measureIdx-1},s.updateOwnTempo=function(){const h={measureIdx:this.opts.measureIdx};new g.A(this.scoreData,h,this.cancelStack).perform()},s.updateOwnSwing=function(){const h={measureIdx:this.opts.measureIdx};new v.A(this.scoreData,h,this.cancelStack).perform()},s.hasInsertedAtEnd=function(){const e=this.scoreData.getCommonContent().getNbMeasures();return this.opts.measureIdx===e-1},s.updateNextOwnTempo=function(){const h={measureIdx:this.opts.measureIdx+1};new g.A(this.scoreData,h,this.cancelStack).perform()},s.updateNextOwnSwing=function(){const h={measureIdx:this.opts.measureIdx+1};new v.A(this.scoreData,h,this.cancelStack).perform()},s.updateTempoChange=function(){const h=this.scoreData.getCommonContent();if(h.hasRightTempoChange(this.opts.measureIdx-1)){let e=h.getRightTempoChange(this.opts.measureIdx-1);e=(0,c.default)(e),h.setRightTempoChange(this.opts.measureIdx,e);let i=h.getLeftTempoChange(this.opts.measureIdx+1);i=(0,c.default)(i),h.setLeftTempoChange(this.opts.measureIdx,i)}};const d=o},192994:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(476943),v=t(123491),M=t(351277),f=t(298009),l=t(200665),r=t(519405);const u=function(s,d,h){this.init(s,d,h)},c=u.prototype;c.init=function(s,d,h){this.measureData=s,this.opts=d,this.cancelStack=h,this.actions=null},c.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},c.perform=function(){this.getUnsetFretActions().forEach(m)};function m(s){(0,r.default)(s)}c.getUnsetFretActions=function(){return this.actions===null&&(this.actions=this.getChordsActions()),this.actions},c.getChordsActions=function(){const s=this.getVoice(),d=s.getNbNotes(),h=[];for(let e=0;e<d;e++)if(!s.isRest(e)){let i=s.getChord(e);i=g.default.makeArray(i);const p=this.getChordActions(i,e);h.push(...p);const x=s.getNbGraces(e);for(let S=0;S<x;S++){let I=s.getGraceChord(e,S);I=g.default.makeArray(I);const n=this.getGraceChordActions(I,e,S);h.push(...n)}}return h},c.getChordActions=function(s,d){const h=[];return s.forEach(function(e){if(!v.default.hasFretData(e))return;const i=v.default.getPitch(e),p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:d,pitch:M.default.copy(i),fretData:null,record:!0},x=new f.default(this.measureData,p,this.cancelStack);h.push(x)},this),h},c.getGraceChordActions=function(s,d,h){const e=[];return s.forEach(function(i){if(!v.default.hasFretData(i))return;const p=v.default.getPitch(i),x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:d,graceIdx:h,pitch:M.default.copy(p),fretData:null,record:!0},S=new l.default(this.measureData,x,this.cancelStack);e.push(S)},this),e};const o=u},198100:(H,P,t)=>{t.d(P,{A:()=>I});var g=t(364842),v=t(726042),M=t(210888),f=t(701387),l=t(447819),r=t(606106),u=t(316610),c=t(852363);const m=function(n,a,D){this.init(n,a,D)};m.NAME="primitive.AddMute";const o=m.prototype;o.name=m.NAME,o.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a,this.measure=null,this.muteIdx=null,this.localTimePos=null},o.perform=function(){this.addMute(),this.updateStack()},o.addMute=function(){const n=this.getMeasure(),a=this.getMuteIdx(),D=this.createMute(),T=f.default.getMutes(n,this.opts.staffIdx);T.splice(a,0,D),f.default.setMutes(n,this.opts.staffIdx,T)},o.getMuteIdx=function(){return this.muteIdx===null&&this.fetchMuteIdx(),this.muteIdx},o.fetchMuteIdx=function(){const n=this.getMeasure(),a=f.default.getMutes(n,this.opts.staffIdx);if(a.some(this.tryMuteIdx,this),this.muteIdx===null){const D=a.length;this.muteIdx=D}},o.tryMuteIdx=function(n,a){const D=this.getLocalTimePos(),T=l.A.getTimePos(n);if(T<D)return!1;if(T>D)return this.muteIdx=a,!0;{const N="There is already an mute at this time position.";throw new g.default("TimePosCollision",N)}},o.createMute=function(){const n=this.getLocalTimePos(),a=l.A.create(this.opts.staffIdx,this.opts.placement,n,this.opts.type),D=M.default.generate();return this.cancelStack.addEntityUuid({entityType:r.A.MUTE,uuid:D}),l.A.setUuid(a,D),a},o.getLocalTimePos=function(){if(this.localTimePos===null){const n=this.getMeasure();if(this.localTimePos=(0,u.A)(this.opts,n),!v.default.isInteger(this.localTimePos)){const a=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new g.default("IntegerExpected",a)}}return this.localTimePos},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},o.updateStack=function(){const n={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const s=m;var d=t(746822);const h=function(n,a,D){this.init(n,a,D)};h.NAME="composite.AddMute";const e=h.prototype;e.name=h.NAME,e.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},e.perform=function(){this.updateDpq(),this.addMute()},e.updateDpq=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new d.A(this.scoreData,n,this.cancelStack).perform()},e.addMute=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new s(this.scoreData,n,this.cancelStack).perform()};const i=h;var p=t(656529);const x=function(n,a,D){this.init(n,a,D)};x.NAME="composite.AddMuteErase";const S=x.prototype;S.name=x.NAME,S.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},S.perform=function(){this.removeFormerMute(),this.addMute()},S.removeFormerMute=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new p.default(this.scoreData,n,this.cancelStack).performIfPossible()},S.addMute=function(){const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new i(this.scoreData,n,this.cancelStack).perform()};const I=x},205528:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(874868);const v=function(l,r,u){this.init(l,r,u)};v.NAME="composite.UpdateMeasuresRangeOwnClef";const M=v.prototype;M.name=v.NAME,M.init=function(l,r,u){this.scoreData=l,this.cancelStack=u,this.opts=r},M.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let l=this.opts.startMeasureIdx;l<=this.opts.stopMeasureIdx;l++)this.updateMeasureClef(l);this.hasMeasureAfter()&&this.updateMeasureClef(this.opts.stopMeasureIdx+1)},M.hasMeasureAfter=function(){const l=this.scoreData.getNbMeasures();return this.opts.stopMeasureIdx+1<l},M.updateMeasureClef=function(l){const r={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,measureIdx:l};new g.A(this.scoreData,r,this.cancelStack).perform()};const f=v},217530:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(657107),v=t(436369),M=t(777345);const f=function(I,n,a){this.init(I,n,a)};f.NAME="primitive.AddOwnSwing";const l=f.prototype;l.name=f.NAME,l.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},l.perform=function(){this.addSwing(),this.updateStack()},l.addSwing=function(){this.commonContent.setOwnSwing(this.opts.measureIdx,M.default.copy(this.opts.swing))},l.updateStack=function(){const I=this.commonContent.getScoreData(),n=I.getNbParts();for(let a=0;a<n;a++){const D={type:this.name,opts:{partIdx:a,measureIdx:this.opts.measureIdx}};this.cancelStack.push(D)}(0,v.A)(this.cancelStack,I,this.opts)};const r=f,u=function(I,n,a){this.init(I,n,a)};u.NAME="composite.AddOwnSwingIfNeeded";const c=u.prototype;c.name=u.NAME,c.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnSwing()&&this.addOwnSwing()},c.needAddOwnSwing=function(){return this.hasOwnSwing()?!this.hasSameSwing():!0},c.hasOwnSwing=function(){return this.commonContent.hasOwnSwing(this.opts.measureIdx)},c.hasSameSwing=function(){const I=this.commonContent.getOwnSwing(this.opts.measureIdx);return M.default.isSame(I,this.opts.swing)},c.addOwnSwing=function(){const I={measureIdx:this.opts.measureIdx,swing:M.default.copy(this.opts.swing)};new r(this.commonContent,I,this.cancelStack).perform()};const m=u,o=function(I,n,a){this.init(I,n,a)};o.NAME="primitive.RemoveOwnSwing";const s=o.prototype;s.name=o.NAME,s.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},s.perform=function(){this.removeOwnSwing(),this.updateStack()},s.removeOwnSwing=function(){this.commonContent.removeOwnSwing(this.opts.measureIdx)},s.updateStack=function(){const I=this.commonContent.getScoreData(),n=I.getNbParts();for(let a=0;a<n;a++){const D={type:this.name,opts:{partIdx:a,measureIdx:this.opts.measureIdx}};this.cancelStack.push(D)}(0,v.A)(this.cancelStack,I,this.opts)};const d=o,h=function(I,n,a){this.init(I,n,a)};h.NAME="composite.RemoveOwnSwingIfNeeded";const e=h.prototype;e.name=h.NAME,e.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnSwing()&&this.removeOwnSwing()},e.hasOwnSwing=function(){return this.commonContent.hasOwnSwing(this.opts.measureIdx)},e.removeOwnSwing=function(){const I={measureIdx:this.opts.measureIdx};new d(this.commonContent,I,this.cancelStack).perform()};const i=h,p=function(I,n,a){this.init(I,n,a)};p.NAME="composite.UpdateOwnSwing";const x=p.prototype;x.name=p.NAME,x.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnSwing()?this.addOwnSwing():this.removeOwnSwing()},x.shouldHaveOwnSwing=function(){return this.hasPreviousMeasure()?this.isPreviousSwingDifferent():!0},x.hasPreviousMeasure=function(){return this.opts.measureIdx>0},x.isPreviousSwingDifferent=function(){const I=this.getCurrentMeasureSwing(),n=this.getPreviousMeasureSwing();return!M.default.isSame(I,n)},x.getCurrentMeasureSwing=function(){return this.commonContent.getSwing(this.opts.measureIdx)},x.getPreviousMeasureSwing=function(){return this.commonContent.getSwing(this.opts.measureIdx-1)},x.addOwnSwing=function(){const I=this.getCurrentMeasureSwing(),n={measureIdx:this.opts.measureIdx,swing:M.default.copy(I)};new m(this.commonContent,n,this.cancelStack).perform()},x.removeOwnSwing=function(){const I={measureIdx:this.opts.measureIdx};new i(this.commonContent,I,this.cancelStack).perform()};const S=p},217692:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(483139),v=t(201060),M=t(243183);const f=function(c,m){typeof m.startMeasureUuid!="undefined"&&l(c,m),typeof m.stopMeasureUuid!="undefined"&&r(c,m)},l=function(c,m){if(c=(0,M.A)(c),c.hasMeasureIdxByUuid(m.startMeasureUuid))m.startMeasureIdx=(0,v.A)(c.getMeasuresHeaders(),m.startMeasureUuid),delete m.startMeasureUuid;else throw new g.A(m.startMeasureUuid,g.A.GET)},r=function(c,m){if(c=(0,M.A)(c),c.hasMeasureIdxByUuid(m.stopMeasureUuid))m.stopMeasureIdx=(0,v.A)(c.getMeasuresHeaders(),m.stopMeasureUuid),delete m.stopMeasureUuid;else throw new g.A(m.stopMeasureUuid,g.A.GET)},u=f},225254:(H,P,t)=>{t.d(P,{A:()=>n});var g=t(364842),v=t(726042),M=t(210888),f=t(701387),l=t(536949),r=t(606106),u=t(316610),c=t(852363);const m=function(a,D,T){this.init(a,D,T)};m.NAME="primitive.AddPizzicato";const o=m.prototype;o.name=m.NAME,o.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D,this.measure=null,this.pizzicatoIdx=null,this.localTimePos=null},o.perform=function(){this.addPizzicato(),this.updateStack()},o.addPizzicato=function(){const a=this.getMeasure(),D=this.getPizzicatoIdx(),T=this.createPizzicato(),N=f.default.getPizzicatos(a,this.opts.staffIdx);N.splice(D,0,T),f.default.setPizzicatos(a,this.opts.staffIdx,N)},o.getPizzicatoIdx=function(){return this.pizzicatoIdx===null&&this.fetchPizzicatoIdx(),this.pizzicatoIdx},o.fetchPizzicatoIdx=function(){const a=this.getMeasure(),D=f.default.getPizzicatos(a,this.opts.staffIdx);if(D.some(this.tryPizzicatoIdx,this),this.pizzicatoIdx===null){const T=D.length;this.pizzicatoIdx=T}},o.tryPizzicatoIdx=function(a,D){const T=this.getLocalTimePos(),N=l.A.getTimePos(a);if(N<T)return!1;if(N>T)return this.pizzicatoIdx=D,!0;{const y="There is already an pizzicato at this time position.";throw new g.default("TimePosCollision",y)}},o.createPizzicato=function(){const a=this.getLocalTimePos(),D=l.A.create(this.opts.staffIdx,this.opts.placement,a,this.opts.type),T=M.default.generate();return this.cancelStack.addEntityUuid({entityType:r.A.PIZZICATO,uuid:T}),l.A.setPizzicatoUuid(D,T),D},o.getLocalTimePos=function(){if(this.localTimePos===null){const a=this.getMeasure();if(this.localTimePos=(0,u.A)(this.opts,a),!v.default.isInteger(this.localTimePos)){const D=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new g.default("IntegerExpected",D)}}return this.localTimePos},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},o.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const s=m;var d=t(746822),h=t(379668);const e=function(a,D,T){this.init(a,D,T)};e.NAME="composite.AddPizzicato";const i=e.prototype;i.name=e.NAME,i.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},i.perform=function(){this.removeMmr(),this.updateDpq(),this.addPizzicato()},i.removeMmr=function(){(0,h.A)(this.scoreData,this.opts,this.cancelStack)},i.updateDpq=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new d.A(this.scoreData,a,this.cancelStack).perform()},i.addPizzicato=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new s(this.scoreData,a,this.cancelStack).perform()};const p=e;var x=t(24443);const S=function(a,D,T){this.init(a,D,T)};S.NAME="composite.AddPizzicatoErase";const I=S.prototype;I.name=S.NAME,I.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},I.perform=function(){this.removeFormerPizzicato(),this.addPizzicato()},I.removeFormerPizzicato=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new x.default(this.scoreData,a,this.cancelStack).performIfPossible()},I.addPizzicato=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,type:this.opts.type};new p(this.scoreData,a,this.cancelStack).perform()};const n=S},228785:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("There are already slurs in this interval."),this.name="AlreadyHasSlurError"}}},237934:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(476943),v=t(123491),M=t(109708),f=t(793317),l=t(852363);const r=function(e,i,p){this.init(e,i,p)};r.NAME="primitive.AddArpeggio";const u=r.prototype;u.name=r.NAME,u.initMeasureData=f.default,u.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addArpeggio(),this.updateStack()},u.addArpeggio=function(){let i=this.getVoice().getChord(this.opts.noteIdx);i=g.default.makeArray(i),i.forEach(this.addArpeggioToHead,this)},u.addArpeggioToHead=function(e){const i=M.A.create();v.default.setArpeggiate(e,i)},u.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},u.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const c=r;var m=t(414208),o=t(519405);const s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddArpeggio";const d=s.prototype;d.initMeasureData=f.default,d.name=s.NAME,d.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftTie(),this.addArpeggio()},d.removeLeftTie=function(){let i=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);if(i=g.default.makeArray(i),!i.some(v.default.hasTieStop))return;const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},x=new m.default(this.measureData,p,this.cancelStack);(0,o.default)(x)},d.addArpeggio=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new c(this.measureData,e,this.cancelStack).perform()};const h=s},239174:(H,P,t)=>{t.d(P,{A:()=>s});var g=t(615059),v=t(436369),M=t(657107),f=t(561248);const l=function(d,h,e){this.init(d,h,e)};l.NAME="primitive.AddRehearsal";const r=l.prototype;r.name=l.NAME,r.init=function(d,h,e){this.commonContent=(0,M.A)(d),this.cancelStack=e,this.opts=h},r.perform=function(){this.addRehearsal(),this.updateStack()},r.addRehearsal=function(){const d=f.A.create(this.opts.rehearsal,this.opts.type);this.commonContent.setRehearsal(this.opts.measureIdx,d)},r.updateStack=function(){const d=this.commonContent.getScoreData(),h=d.getNbParts();for(let e=0;e<h;e++){const i={type:this.name,opts:{partIdx:e,measureIdx:this.opts.measureIdx}};this.cancelStack.push(i)}(0,v.A)(this.cancelStack,d,this.opts)};const u=l;var c=t(519405);const m=function(d,h,e){this.init(d,h,e)};m.NAME="composite.AddRehearsal";const o=m.prototype;o.name=m.NAME,o.init=function(d,h,e){this.scoreData=d,this.opts=h,this.cancelStack=e},o.getCommonContent=function(){return this.scoreData.getCommonContent()},o.perform=function(){this.getCommonContent().hasRehearsal(this.opts.measureIdx)&&this.removeCurrentRehearsal();const h={measureIdx:this.opts.measureIdx,rehearsal:this.opts.rehearsal,type:this.opts.type};new u(this.scoreData,h,this.cancelStack).perform()},o.removeCurrentRehearsal=function(){const d={measureIdx:this.opts.measureIdx},h=new g.default(this.scoreData,d,this.cancelStack);(0,c.default)(h)};const s=m},244378:(H,P,t)=>{t.d(P,{A:()=>v});const v={BACKWARD:"backward",FORWARD:"forward"}},260962:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("This operation is not possible on kodaly."),this.name="NotPossibleOnKodalyError"}}},270912:(H,P,t)=>{t.d(P,{A:()=>G});var g=t(364842),v=t(351277),M=t(737903),f=t(123491),l=t(515819),r=t(476943),u=t(292681),c=t(244491),m=t(563276),o=t(526881),s=t(422259),d=t(296825),h=t(729400),e=t(737296),i=t(366274),p=t(823880),x=t(580668),S=t(792273),I=t(443923),n=t(793317),a=t(519405);const D=function(k,K,_){this.init(k,K,_)};D.NAME="composite.RemoveSpaceTupletChords";const T=D.prototype;T.name=D.NAME,T.initMeasureData=n.default,T.init=function(k,K,_){this.initMeasureData(k,K),this.cancelStack=_,this.opts=K,this.noteIdx=K.noteIdx,this.quarterDuration=K.quarterDuration},T.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.checkTuplet();!this.done();)this.isNote()?this.removeChord():this.unlockRest(),this.moveForward();if(this.quarterDuration>0){const k="Was not able to remove the required duration. ";throw new g.default("NotEnoughSpace",k)}},T.checkTuplet=function(){if(!this.getVoice().isTuplet()){const K="Tuplet expected.";throw new g.default("TupletExpected",K)}},T.isNote=function(){return!this.getVoice().isRest(this.noteIdx)},T.done=function(){if(this.quarterDuration<=0)return!0;const K=this.getVoice().getStopNoteIdx();return this.noteIdx>K},T.removeChord=function(){const k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx},K=this.getRemoveChordAction(this.noteIdx),_=new K(this.measureData,k,this.cancelStack);(0,a.default)(_)},T.getRemoveChordAction=function(k){const _=this.getVoice().getNote(k);if(f.default.hasUnpitched(_))return S.default;if(f.default.hasPitch(_))return x.default;throw new g.default("Unexpected")},T.unlockRest=function(){const k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx};new I.A(this.measureData,k,this.cancelStack).perform()},T.moveForward=function(){const k=this.getCurrentNoteQuarterDuration();this.quarterDuration-=k,this.noteIdx++},T.getCurrentNoteQuarterDuration=function(){const K=this.getVoice().getNote(this.noteIdx),_=this.getDpq();return f.default.getNormalQuarterDuration(K,_)},T.getVoice=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx)},T.getDpq=function(){return this.measureData.getDpqValue()};const N=D;var y=t(405347);const A=function(k,K,_){this.init(k,K,_)};A.NAME="composite.ChangeDurationErase";const R=A.prototype;R.initMeasureData=n.default,R.name=A.NAME,R.init=function(k,K,_){this.initMeasureData(k,K),this.cancelStack=_,this.opts=K},R.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const k=this.getActualQuarterDuration(),K=this.opts.quarterDuration-k;K>0&&this.erase(K),this.changeDuration()},R.getActualQuarterDuration=function(){const K=this.getVoice().getNote(this.opts.noteIdx),_=this.measureData.getDpqValue();return f.default.getNormalQuarterDuration(K,_)},R.erase=function(k){this.isTuplet()?this.eraseInTuplet(k):this.eraseInVoice(k)},R.isTuplet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx).isTuplet()},R.eraseInTuplet=function(k){const K={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1,quarterDuration:k};new N(this.measureData,K,this.cancelStack).perform()},R.eraseInVoice=function(k){const K=this.getNextQuarterPosition();this.eraseTuplets(K,k),this.eraseChords(K,k)},R.getNextQuarterPosition=function(){const K=this.getVoice().getRangeSpace(0,this.opts.noteIdx+1),_=this.measureData.getDpqValue();return l.default.divisionsToQuarter(K,_)},R.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},R.eraseTuplets=function(k,K){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:k,quarterDuration:K};new i.A(this.measureData,_,this.cancelStack).perform()},R.eraseChords=function(k,K){const _={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:k,quarterDuration:K};new p.A(this.measureData,_,this.cancelStack).perform()},R.changeDuration=function(){const k=l.default.quarterToDurationOpts(this.opts.quarterDuration),K={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:k.durationType,nbDots:k.nbDots,insertMode:e.default.REPLACE},_=new y.default(this.measureData,K,this.cancelStack);(0,a.default)(_)};const W=A,F=function(k,K,_){this.init(k,K,_)};F.NAME="composite.ChangeDurationCrossMeasure";const E=F.prototype;E.initMeasureData=n.default,E.name=F.NAME,E.init=function(k,K,_){this.initMeasureData(k,K),this.cancelStack=_,this.opts=K,this.heads=null,this.instruments=null},E.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeDurationIfNeeded(),this.hasRemainingSpace())if(this.isTuplet())this.raiseUnexpectedRemainingSpace();else if(this.fetchNextLocation(),this.isRest()||this.fetchChordData(),this.addMeasureIfNeeded(),this.isRest())this.addRest();else{if(this.heads!==null)this.addChord();else if(this.instruments!==null)this.addChordPercu();else throw new g.default("Unexpected");this.addTie()}else this.storePosition()},E.changeDurationIfNeeded=function(){this.quarterDuration=l.default.durationOptsToQuarter(this.opts);let k=this.quarterDuration;const K=this.getAvailableQuarterDuration();k=Math.min(k,K),k=l.default.extractQuarterPossibleDuration(k);const _=this.getActualQuarterDuration();k!==_&&this.changeDurationErase(k),this.quarterDuration-=k},E.changeDurationErase=function(k){const K={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,quarterDuration:k};new W(this.measureData,K,this.cancelStack).perform()},E.getAvailableQuarterDuration=function(){const k=this.getVoiceOrTupletForGet(),K=k.getAbsoluteTimeModif(),_=this.opts.noteIdx,ot=k.getSpaceFromIdx(_),dt=l.default.actualToNormal(ot,K),Mt=this.measureData.getDpqValue();return l.default.divisionsToQuarter(dt,Mt)},E.getActualQuarterDuration=function(){const K=this.getVoice().getNote(this.opts.noteIdx),_=this.measureData.getDpqValue();return f.default.getNormalQuarterDuration(K,_)},E.removedUsedSpace=function(){const K=this.getVoice().getNote(this.opts.noteIdx),_=this.measureData.getDpqValue(),ot=f.default.getNormalQuarterDuration(K,_);this.quarterDuration-=ot},E.hasRemainingSpace=function(){return this.quarterDuration>0},E.isTuplet=function(){return this.getVoiceOrTupletForGet().isTuplet()},E.isRest=function(){return this.getVoice().isRest(this.opts.noteIdx)},E.getVoiceOrTupletForGet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.opts.noteIdx)},E.raiseUnexpectedRemainingSpace=function(){const k="There should not be remaining space for a change duration of a rest or inside a tuplet. The score should still be consistent.";throw new g.default("UnexpectedRemainingSpace",k)},E.fetchNextLocation=function(){this.measureIdx=this.opts.measureIdx;const k=this.opts.noteIdx+1,K=this.getVoice(),_=K.size();if(k===_)this.quarterPosition=0,this.measureIdx++;else{const ot=K.getRangeSpace(0,k),dt=this.measureData.getDpqValue();this.quarterPosition=l.default.divisionsToQuarter(ot,dt)}},E.fetchChordData=function(){const k=this.getVoice(),K=k.getNote(this.opts.noteIdx);this.staffIdx=f.default.getStaffIdx(K);let _=k.getChord(this.opts.noteIdx);if(_=r.default.makeArray(_),f.default.hasPitch(K))this.heads=_.map(U);else if(f.default.hasUnpitched(K))this.instruments=_.map(this.extractUnpitchedInstrument,this);else throw new g.default("Unexpected")};const U=function(k){let K=f.default.getPitch(k);K=v.default.copy(K);const _={pitch:K};if(f.default.hasFretData(k)){let ot=f.default.getFretData(k);ot=(0,M.default)(ot),_.fretData=ot}return _};E.extractUnpitchedInstrument=function(k){const K=f.default.getUnpitched(k),_=f.default.getHead(k),ot=f.default.getInstrumentId(k),Mt=this.measureData.getScoreData().searchInstrumentMIDIUnpitched(this.opts.partIdx,ot);return{unpitched:u.default.copy(K),notehead:_,MIDIUnpitched:Mt}},E.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},E.addMeasureIfNeeded=function(){const k=this.measureData.getScoreData(),K=k.getNbMeasures();if(this.measureIdx===K){const _={measureIdx:K},ot=new o.default(k,_,this.cancelStack);(0,a.default)(ot)}},E.addRest=function(){const k={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterDuration:this.quarterDuration,quarterPosition:this.quarterPosition,forceShowVoice:this.opts.forceShowVoice},K=this.measureData.getScoreData(),_=new d.default(K,k,this.cancelStack);(0,a.default)(_)},E.addChord=function(){const k=this.heads.map(Q),K={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.staffIdx,voiceIdx:this.opts.voiceIdx,quarterDuration:this.quarterDuration,quarterPosition:this.quarterPosition,heads:k},_=this.measureData.getScoreData(),ot=new s.default(_,K,this.cancelStack);(0,a.default)(ot),this.refreshMeasureData()};const Q=function(k){const _={pitch:v.default.copy(k.pitch)};return typeof k.fretData!="undefined"&&(_.fretData=(0,M.default)(k.fretData)),_};E.refreshMeasureData=function(){const k=this.measureData.getScoreData();this.initMeasureData(k,this.opts)},E.addTie=function(){const k={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},K=this.measureData.isUnpitched()?m.default:c.default,_=new K(this.measureData,k,this.cancelStack);(0,a.default)(_)},E.addChordPercu=function(){const k=(0,M.default)(this.instruments),K={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.staffIdx,voiceIdx:this.opts.voiceIdx,quarterDuration:this.quarterDuration,quarterPosition:this.quarterPosition,instruments:k},_=this.measureData.getScoreData(),ot=new h.default(_,K,this.cancelStack);(0,a.default)(ot),this.refreshMeasureData()},E.storePosition=function(){const k={noteIdx:this.opts.noteIdx+1,measureIdx:this.opts.measureIdx},_=this.getVoice().getNbNotes();k.noteIdx>=_&&(k.measureIdx++,k.noteIdx=0),this.cancelStack.storePosition(k)};const G=F},271347:(H,P,t)=>{t.d(P,{A:()=>s});var g=t(474015),v=t(607682);class M extends v.default{constructor(h){super(f(h)),Object.defineProperty(this,"voiceUuid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="VoiceUuidCollisionError",this.voiceUuid=h}}const f=function(d){return`There is already a voice with the uuid [${d}].`};var l=t(323161),r=t(843678),u=t(383279);const c=function(d,h){const e={};r.default.forEach(h,m,e),r.default.forEach(h,o,d)},m=function(d,h){l.A.check(h);const e=this;if(typeof e[h]=="undefined")e[h]=!0;else throw new g.A(h)},o=function(d,h){const e=this;if(u.default.hasVoiceUuid(e,h))throw new M(h)},s=c},296440:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(174511),v=t(777345);const M=function(r,u,c){this.init(r,u,c)};M.NAME="composite.SetSwingMain";const f=M.prototype;f.name=M.NAME,f.init=function(r,u,c){this.scoreData=r,this.cancelStack=c,this.opts=u,this.swing=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const r=this.opts.startMeasureIdx,u=this.opts.stopMeasureIdx;for(let c=r;c<=u;c++){const m=this.scoreData.getSwing(c);this.addSwing(m,c)}this.finishSegment()},f.addSwing=function(r,u){this.hasOngoing()?this.isSameSwing(r)?this.continueSegment(u):(this.finishSegment(),this.startSegment(r,u)):this.startSegment(r,u)},f.hasOngoing=function(){return this.swing!==null},f.startSegment=function(r,u){this.swing=r,this.startMeasureIdx=u,this.stopMeasureIdx=u},f.isSameSwing=function(r){return v.default.isSame(this.swing,r)},f.continueSegment=function(r){this.stopMeasureIdx=r},f.finishSegment=function(){v.default.isSame(this.swing,this.opts.swing)||this.setSwingSegment(this.startMeasureIdx,this.stopMeasureIdx),this.swing=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},f.setSwingSegment=function(r,u){const c={startMeasureIdx:r,stopMeasureIdx:u,swing:v.default.copy(this.opts.swing)},m=new g.default(this.scoreData,c,this.cancelStack);m.checkPreconditions(),m.perform()};const l=M},302667:(H,P,t)=>{t.d(P,{A:()=>y});var g=t(909748),v=t(606106),M=t(364842),f=t(515819),l=t(346797),r=t(436369);const u=function(A,R,W){this.init(A,R,W)};u.NAME="primitive.AddTempoChange";const c=u.prototype;c.name=u.NAME,c.init=function(A,R,W){this.scoreData=A,this.cancelStack=W,this.opts=R,this.tempoChangeIdx=null,this.localTimePos=null},c.perform=function(){this.addTempoChange(),this.updateStack()},c.addTempoChange=function(){const A=this.getCommonContent(),R=this.getTempoChangeIdx(),W=this.createTempoChange(),F=A.getTempoChanges(this.opts.measureIdx);F.splice(R,0,W),A.setTempoChanges(this.opts.measureIdx,F)},c.getTempoChangeIdx=function(){return this.tempoChangeIdx===null&&this.fetchTempoChangeIdx(),this.tempoChangeIdx},c.fetchTempoChangeIdx=function(){const R=this.getCommonContent().getTempoChanges(this.opts.measureIdx);if(R.some(this.tryTempoChangeIdx,this),this.tempoChangeIdx===null){const W=R.length;this.tempoChangeIdx=W}},c.tryTempoChangeIdx=function(A,R){const W=f.default.divisionsToQuarter(this.opts.timePos,this.opts.dpq),F=l.A.getQuarterPos(A);if(F<W)return!1;if(F>W)return this.tempoChangeIdx=R,!0;{const E="There is already a tempo change at this time position.";throw new M.default("TimePosCollision",E)}},c.getCommonContent=function(){return this.scoreData.getCommonContent()},c.createTempoChange=function(){const A=l.A.create(this.opts.timePos,this.opts.dpq,this.opts.type);return g.A.isStart(this.opts.type)&&typeof this.opts.tempoChangeUuid!="undefined"&&(l.A.setTempoChangeUuid(A,this.opts.tempoChangeUuid),this.storeTempoChangeUuid()),A},c.storeTempoChangeUuid=function(){const A=this.scoreData.getMeasureUuid(this.opts.measureIdx),R=this.getCommonContent(),W={measureUuid:A,tempoChangeUuid:this.opts.tempoChangeUuid};R.setTempoChangeAtUuid(W)},c.updateStack=function(){const A=this.scoreData.getNbParts();for(let R=0;R<A;R++){const W={type:this.name,opts:{partIdx:R,measureIdx:this.opts.measureIdx}};this.cancelStack.push(W)}(0,r.A)(this.cancelStack,this.scoreData,this.opts)};const m=u;var o=t(332573);const s=function(A,R,W){this.init(A,R,W)};s.NAME="primitive.AddTempoChangeContinue";const d=s.prototype;d.name=s.NAME,d.init=function(A,R,W){this.scoreData=A,this.cancelStack=W,this.opts=R},d.perform=function(){this.addLeftTempoChange(),this.addRightPedal(),this.updateStack()},d.addLeftTempoChange=function(){const A=this.getCommonContent(),R=o.A.RIGHT,W=this.createTempoChange(R);A.setRightTempoChange(this.opts.measureIdx,W)},d.addRightPedal=function(){const A=this.getCommonContent(),R=o.A.LEFT,W=this.createTempoChange(R);A.setLeftTempoChange(this.opts.measureIdx+1,W)},d.createTempoChange=function(A){const F=l.A.create(null,null,g.A.CONTINUE,A);return l.A.setTempoChangeUuid(F,this.opts.tempoChangeUuid),F},d.getCommonContent=function(){return this.scoreData.getCommonContent()},d.updateStack=function(){const A=this.scoreData.getNbParts();for(let R=0;R<A;R++){const W={type:this.name,opts:{partIdx:R,measureIdx:this.opts.measureIdx}};this.cancelStack.push(W)}(0,r.A)(this.cancelStack,this.scoreData,this.opts)};const h=s;var e=t(389603),i=t(519405);const p=function(A,R,W){this.init(A,R,W)};p.NAME="composite.RemoveTempoChangesRange";const x=p.prototype;x.name=p.NAME,x.init=function(A,R,W){this.scoreData=A,this.opts=R,this.cancelStack=W,this.currentMeasureIdx=null},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftTempoChanges(),this.removeLeftMeasureTempoChanges(),this.removeMiddleMeasureTempoChanges(),this.removeRightMeasureTempoChanges()},x.removeLeftTempoChanges=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;let R=this.getCommonContent().getTempoChanges(this.currentMeasureIdx);if(R=R.filter(function(W){return this.isBeforeLimit(W,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),R.length!==0){const W=R.pop();S(W)&&this.removeFromEntry(W)}else this.hasLeftTempoChange()&&this.removeCrossMeasureTempoChange()},x.removeCrossMeasureTempoChange=function(){this.removeTempoChange(0,1,this.opts.staffIdx)},x.removeLeftMeasureTempoChanges=function(){let A=this.getTempoChangeStarts();A=A.filter(this.isWithinLimits,this),A.forEach(this.removeFromEntry,this);let R=this.getTempoChangeStops();R=R.filter(this.isWithinLimits,this),R.forEach(this.removeFromEntry,this)},x.removeMiddleMeasureTempoChanges=function(){for(let A=this.opts.startMeasureIdx+1;A<this.opts.stopMeasureIdx;A++)this.currentMeasureIdx=A,this.getTempoChangeStarts().forEach(this.removeFromEntry,this),this.getTempoChangeStops().forEach(this.removeFromEntry,this)},x.removeRightMeasureTempoChanges=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;let A=this.getTempoChangeStarts();A=A.filter(this.isWithinLimits,this),A.forEach(this.removeFromEntry,this);let R=this.getTempoChangeStops();R=R.filter(this.isWithinLimits,this),R.forEach(this.removeFromEntry,this)},x.removeFromEntry=function(A){const R=l.A.getTimePos(A),W=l.A.getDpq(A);this.removeTempoChange(R,W)},x.removeTempoChange=function(A,R){const W={partIdx:0,measureIdx:this.currentMeasureIdx,timePos:A,dpq:R},F=new e.default(this.scoreData,W,this.cancelStack);(0,i.default)(F)},x.isWithinLimits=function(A){return this.currentMeasureIdx<this.opts.startMeasureIdx||this.currentMeasureIdx>this.opts.stopMeasureIdx?!1:this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx?!0:!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(A,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)||this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(A,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))},x.isAfterLimit=function(A,R,W,F){const E=l.A.getQuarterPos(A),U=f.default.divisionsToQuarter(W,F);return!(E<U)},x.isBeforeLimit=function(A,R,W,F){const E=l.A.getQuarterPos(A),U=f.default.divisionsToQuarter(W,F);return!(E>U)},x.getTempoChangeStarts=function(){let R=this.scoreData.getCommonContent().getTempoChanges(this.currentMeasureIdx);return R=R.filter(S),R};const S=function(A){const R=l.A.getType(A);return R===g.A.ACCELERANDO||R===g.A.RITARDANDO};x.getTempoChangeStops=function(){let R=this.scoreData.getCommonContent().getTempoChanges(this.currentMeasureIdx);return R=R.filter(I),R};const I=function(A){return l.A.getType(A)===g.A.STOP};x.hasLeftTempoChange=function(){return this.getCommonContent().hasLeftTempoChange(this.currentMeasureIdx)},x.getCommonContent=function(){return this.scoreData.getCommonContent()};const n=p;var a=t(210888),D=t(379668);const T=function(A,R,W){this.init(A,R,W)};T.NAME="composite.AddTempoChange";const N=T.prototype;N.name=T.NAME,N.init=function(A,R,W){this.scoreData=A,this.cancelStack=W,this.opts=R},N.perform=function(){this.removeMmr(),this.removeExistingTempoChanges(),this.tempoChangeUuid=a.default.generate(),this.cancelStack.addEntityUuid({entityType:v.A.TEMPO_CHANGE,uuid:this.tempoChangeUuid}),this.addTempoChangeLeftSide(),this.addTempoChangeRightSide(),this.addTempoChangeContinues()},N.removeMmr=function(){(0,D.A)(this.scoreData,{measureIdx:this.opts.startMeasureIdx},this.cancelStack),(0,D.A)(this.scoreData,{measureIdx:this.opts.stopMeasureIdx},this.cancelStack)},N.removeExistingTempoChanges=function(){const A={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};new n(this.scoreData,A,this.cancelStack).perform()},N.addTempoChangeLeftSide=function(){const A={measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq,type:this.opts.type,tempoChangeUuid:this.tempoChangeUuid};new m(this.scoreData,A,this.cancelStack).perform()},N.addTempoChangeRightSide=function(){const A={measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq,type:g.A.STOP};new m(this.scoreData,A,this.cancelStack).perform()},N.addTempoChangeContinues=function(){for(let A=this.opts.startMeasureIdx;A<this.opts.stopMeasureIdx;A++)this.addTempoChangeContinue(A)},N.addTempoChangeContinue=function(A){const R={measureIdx:A,tempoChangeUuid:this.tempoChangeUuid};new h(this.scoreData,R,this.cancelStack).perform()};const y=T},303443:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682);class v extends g.default{constructor(r){super(f(r)),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="EmptyRangeError",this.type=r}}Object.defineProperty(v,"MEASURE",{enumerable:!0,configurable:!0,writable:!0,value:"measure"}),Object.defineProperty(v,"NOTE",{enumerable:!0,configurable:!0,writable:!0,value:"note"}),Object.defineProperty(v,"TIME_POS",{enumerable:!0,configurable:!0,writable:!0,value:"time position"});const M=v,f=function(l){return`The ${l} range selected is empty.`}},320731:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(951066);class v extends g.A{constructor(l){const r=M(l);super(r),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadPageBreakValueError",this.value=l}}const M=function(f){return`The following page break value: ${f} is incorrect, must be either yes or no`}},321562:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(123491),v=t(793317),M=t(578918),f=t(852363);const l=function(c,m,o){this.init(c,m,o)};l.NAME="primitive.AddCourtesyAccidental";const r=l.prototype;r.name=l.NAME,r.initMeasureData=v.default,r.init=function(c,m,o){this.initMeasureData(c,m),this.cancelStack=o,this.opts=m},r.perform=function(){this.addCourtesyAccidental(),this.updateStack()},r.addCourtesyAccidental=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),m=(0,M.default)(c,this.opts.noteIdx,this.opts.pitch);g.default.addCourtesyAccidental(m)},r.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,f.default)(this.cancelStack,this.measureData,this.opts)};const u=l},328225:(H,P,t)=>{t.d(P,{A:()=>p});var g=t(343818),v=t(712947),M=t(123491),f=t(42651),l=t(793317),r=t(852363);class u{constructor(S,I,n){Object.defineProperty(this,"initMeasureData",{enumerable:!0,configurable:!0,writable:!0,value:l.default}),this.name=u.name,this.initMeasureData(S,I),this.cancelStack=n,this.opts=I}perform(){const I=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),n=M.default.getSlur(I);v.default.setPlacement(n,this.opts.placement),this.updateStack()}updateStack(){const S={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(S),(0,r.default)(this.cancelStack,this.measureData,this.opts)}}Object.defineProperty(u,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"primitive.SetSlurPlacementSide"}),(0,f.default)(u);const c=u;var m=t(701387);class o{constructor(S,I,n){this.name=o.name,this.scoreData=S,this.cancelStack=n,this.opts=I}perform(){this.setLeftSlur(),this.setRightSlur(),this.updateStack()}setLeftSlur(){const S=this.getLeftMeasure(),I=m.default.getRightSlur(S,this.opts.voiceIdx);v.default.setPlacement(I,this.opts.placement)}getLeftMeasure(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)}setRightSlur(){const S=this.getRightMeasure(),I=m.default.getLeftSlur(S,this.opts.voiceIdx);v.default.setPlacement(I,this.opts.placement)}getRightMeasure(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)}updateStack(){const S={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(S),(0,r.default)(this.cancelStack,this.scoreData,this.opts)}}Object.defineProperty(o,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"primitive.SetSlurPlacementContinue"}),(0,f.default)(o);const s=o;var d=t(2110),h=t(739293),e=t(713735);class i{constructor(S,I,n){this.name=i.NAME,this.measuresScroller=(0,d.A)(S,I),this.cancelStack=n,this.opts=I,this.staffIdx=null,this.leftNoteIdx=null,this.leftMeasureIdx=null,this.rightNoteIdx=null,this.rightMeasureIdx=null}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasLeftSide()||this.searchLeftSide(),this.hasRightSide()||this.searchRightSide(),this.setPlacementLeftSide(),this.setPlacementRightSide(),this.setPlacementContinues()}setPlacementLeftSide(){const S=this.measuresScroller.getMeasureData(this.leftMeasureIdx),I={partIdx:this.opts.partIdx,measureIdx:this.leftMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.leftNoteIdx,placement:this.opts.placement};new c(S,I,this.cancelStack).perform()}setPlacementRightSide(){const S=this.measuresScroller.getMeasureData(this.rightMeasureIdx),I={partIdx:this.opts.partIdx,measureIdx:this.rightMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.rightNoteIdx,placement:this.opts.placement};new c(S,I,this.cancelStack).perform()}setPlacementContinues(){const S=this.leftMeasureIdx,I=this.rightMeasureIdx;for(let n=S;n<I;n+=1)this.setPlacementContinue(n)}setPlacementContinue(S){const I=this.getStaffIdx(),n={partIdx:this.opts.partIdx,measureIdx:S,voiceIdx:this.opts.voiceIdx,staffIdx:I,placement:this.opts.placement},a=this.measuresScroller.getScoreData();new s(a,n,this.cancelStack).perform()}hasLeftSide(){return this.leftNoteIdx!==null}hasRightSide(){return this.rightNoteIdx!==null}searchLeftSide(){const S=(0,h.A)(this.measuresScroller,this.opts);if(S===null)throw new g.A;this.leftMeasureIdx=S.measureIdx,this.leftNoteIdx=S.noteIdx}searchRightSide(){const S=(0,e.A)(this.measuresScroller,this.opts);if(S===null)throw new g.A;this.rightMeasureIdx=S.measureIdx,this.rightNoteIdx=S.noteIdx}getStaffIdx(){if(this.staffIdx===null){const n=this.measuresScroller.getMeasureData(this.leftMeasureIdx).getVoice(this.opts.voiceIdx).getNote(this.leftNoteIdx);this.staffIdx=M.default.getStaffIdx(n)}return this.staffIdx}}Object.defineProperty(i,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"composite.SetSlurPlacement"}),(0,f.default)(i);const p=i},339455:(H,P,t)=>{t.d(P,{A:()=>Y});var g=t(104907),v=t(701387),M=t(35802),f=t(446921),l=t(852363);const r=function(C,O,B){this.init(C,O,B)};r.NAME="primitive.SetStaffDetails";const u=r.prototype;u.name=r.NAME,u.init=function(C,O,B){this.scoreData=C,this.opts=O,this.cancelStack=B},u.perform=function(){const C=this.scoreData.getPartContent(this.opts.partIdx),O=f.A.getNbMeasures(C);for(let B=0;B<O;B++){const w=f.A.getMeasure(C,B);B===0&&this.setOwnAttributesStaffDetails(w),this.setAttributesStaffDetails(w),(0,l.default)(this.cancelStack,this.scoreData,{partIdx:this.opts.partIdx,measureIdx:B})}this.updateStack()},u.setOwnAttributesStaffDetails=function(C){const O=v.default.getOwnAttributes(C),B=v.default.getWrappedOwnStaffDetails(C),w=g.default.copy(this.opts.staffDetails);B.setEntry(w,this.opts.staffIdx),M.default.setStaffDetails(O,B.dumpAttribute())},u.setAttributesStaffDetails=function(C){const O=v.default.getAttributes(C),B=v.default.getWrappedStaffDetails(C),w=g.default.copy(this.opts.staffDetails);B.setEntry(w,this.opts.staffIdx),M.default.setStaffDetails(O,B.dumpAttribute())},u.updateStack=function(){const C={type:this.name,noDraw:!0,opts:{partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:g.default.copy(this.opts.staffDetails)}};this.cancelStack.push(C)};const c=r;var m=t(383279),o=t(377180),s=t(859418),d=t(519405),h=t(549878),e=t(283696),i=t(2110);const p=function(C,O,B){this.init(C,O,B)};p.NAME="composite.SetMeasuresFrets";const x=p.prototype;x.init=function(C,O,B){this.scoreData=C,this.opts=O,this.cancelStack=B,this.actions=null},x.perform=function(){this.getActions().forEach(this.performAction)},x.performAction=function(C){C.checkPreconditions(),C.perform()},x.getActions=function(){if(this.actions===null){const C=[],O={partIdx:this.opts.partIdx},B=(0,i.A)(this.scoreData,O),w=this.scoreData.getNbMeasures();for(let $=0;$<w;$++)if(B.getMeasureData($).hasVoice(this.opts.voiceIdx)){const at={partIdx:this.opts.partIdx,measureIdx:$,voiceIdx:this.opts.voiceIdx},st=new e.default(this.scoreData,at,this.cancelStack);C.push(st)}this.actions=C}return this.actions};const S=p;var I=t(674431);const n=function(C,O,B){this.init(C,O,B)};n.NAME="composite.UnsetMeasuresFrets";const a=n.prototype;a.init=function(C,O,B){this.scoreData=C,this.opts=O,this.cancelStack=B,this.actions=null},a.perform=function(){this.getActions().forEach(D)};const D=function(C){(0,d.default)(C)};a.getMeasures=function(){return this.scoreData.getMeasures(this.opts.partIdx)},a.getActions=function(){if(this.actions===null){const C=[],B=this.getMeasures().length,w=(0,i.A)(this.scoreData,this.opts);for(let $=0;$<B;$++){const tt=w.getMeasureData($);if(tt.hasVoice(this.opts.voiceIdx)){const at={partIdx:this.opts.partIdx,measureIdx:$,voiceIdx:this.opts.voiceIdx},st=new I.default(tt,at,this.cancelStack);C.push(st)}}this.actions=C}return this.actions};const T=n;var N=t(614653),y=t(529355),A=t(681670),R=t(359363),W=t(95627);const F=function(C,O,B){this.init(C,O,B)};F.NAME="composite.RemovePartHarmoniesFrames";const E=F.prototype;E.name=F.NAME,E.init=function(C,O,B){this.scoreData=C,this.cancelStack=B,this.opts=O},E.perform=function(){this.cancelStack=this.cancelStack.createSubstack(),this.removePartHarmoniesFrames()},E.removePartHarmoniesFrames=function(){const C=this.scoreData.getNbMeasures();for(let O=0;O<C;O++)this.removeMeasureHarmoniesFrames(O)},E.removeMeasureHarmoniesFrames=function(C){const O=this.scoreData.getMeasure(this.opts.partIdx,C);v.default.getJazzHarmonies(O).forEach(w=>{this.removeHarmonyFrame(C,w)})},E.removeHarmonyFrame=function(C,O){if(!N.default.hasFrame(O))return;const B=this.scoreData.getMeasure(this.opts.partIdx,C),w=v.default.getDpq(B),$=N.default.getTimePos(O),tt=N.default.getKindValue(O);let at=N.default.getRoot(O);at=y.A.copy(at);const st=N.default.getType(O);let ct=N.default.getDegrees(O);ct=R.A.copy(ct);const pt={partIdx:this.opts.partIdx,measureIdx:C,timePos:$,dpq:w,kind:tt,root:at,degrees:ct,type:st};if(N.default.hasBass(O)){const Dt=N.default.getBass(O);pt.bass=A.A.copy(Dt)}const gt=new W.default(this.scoreData,pt,this.cancelStack);(0,d.default)(gt)};const U=F;var Q=t(761300);const G=function(C,O,B){this.init(C,O,B)};G.NAME="composite.AddPartHarmoniesFrames";const k=G.prototype;k.name=G.NAME,k.init=function(C,O,B){this.scoreData=C,this.cancelStack=B,this.opts=O},k.perform=function(){this.cancelStack=this.cancelStack.createSubstack(),this.addPartHarmoniesFrames()},k.addPartHarmoniesFrames=function(){const C=this.scoreData.getNbMeasures();for(let O=0;O<C;O++)this.addMeasureHarmoniesFrames(O)},k.addMeasureHarmoniesFrames=function(C){const O=this.scoreData.getMeasure(this.opts.partIdx,C);v.default.getJazzHarmonies(O).forEach(w=>{this.addHarmonyFrame(C,w)})},k.addHarmonyFrame=function(C,O){if(N.default.hasFrame(O))return;const B=this.scoreData.getMeasure(this.opts.partIdx,C),tt=v.default.getWrappedStaffDetails(B).getEntry(0);if(!g.default.hasStaffTuning(tt))return;const at=(0,Q.A)(O,tt);if(at===null)return;const st=v.default.getDpq(B),ct=N.default.getTimePos(O),pt=N.default.getKindValue(O);let gt=N.default.getRoot(O);gt=y.A.copy(gt);const Dt=N.default.getType(O);let Et=N.default.getDegrees(O);Et=R.A.copy(Et);const Ct={partIdx:this.opts.partIdx,measureIdx:C,timePos:ct,dpq:st,kind:pt,root:gt,degrees:Et,type:Dt,frame:at};if(N.default.hasBass(O)){const Rt=N.default.getBass(O);Ct.bass=A.A.copy(Rt)}const Nt=new W.default(this.scoreData,Ct,this.cancelStack);(0,d.default)(Nt)};const K=G;var _=t(829329),ot=t(980845),dt=t(364596),Mt=t(595382),j=t(351277),J=t(546201),V=t(774419);const z=dt.default.createDefault();function et(C,O){new rt(C,O).update()}class rt{constructor(O,B){this.voiceData=O,this.staffDetails=B,this.pitchMapping=new Map,this.gracePitchMapping=new Map}update(){this.createTranspose(),this.voiceData.notes.forEach(this.analyzeNote,this),this.voiceData.notes.forEach(this.translateNote,this);const O=this.voiceData.ties||[];this.translateTies(O);const B=this.voiceData.slides||[];this.translateSlides(B);let w=this.voiceData.glissandos||[];w=(0,V.A)(w),this.translateGlissandos(w),this.voiceData.glissandos=(0,J.A)(w);const $=this.voiceData.hammerOnPullOffs||[];this.translateHammerOnPullOffs($),this.voiceData.attributes.staffDetails=g.default.copy(this.staffDetails)}createTranspose(){const O=g.default.getCapo(this.voiceData.attributes.staffDetails);let w=g.default.getCapo(this.staffDetails)-O;const $=w/o.default.NB_CHROMATIC;w=w%o.default.NB_CHROMATIC;const tt=s.default.getChromaticDefaultDiatonic(w);this.transpose=o.default.createComplete(w,tt,$)}analyzeNote(O,B){if(O.isRest)return;const w=O.heads.slice(),$=new Map,tt=[];for(let at=w.length-1;at>=0;at--){const st=w[at];if(!st.fretData){const ct=j.default.stringify(st.pitch);$.set(ct,{previousPitch:j.default.copy(st.pitch),newPitch:j.default.copy(st.pitch)}),w.splice(at,1)}}w.forEach(at=>{let st=this.transposePitch(at.pitch),ct=j.default.stringify(st);if($.has(ct)&&(st=Mt.A.switchEnharmonic(st,z),ct=j.default.stringify(st)),$.has(ct)){tt.push(at.pitch);return}$.set(ct,{previousPitch:j.default.copy(at.pitch),newPitch:st})}),$.forEach(({previousPitch:at,newPitch:st})=>{const ct=ht(B,at);this.pitchMapping.set(ct,st)}),tt.forEach(at=>{const st=ht(B,at);this.pitchMapping.set(st,null)}),this.analyzeGraces(O,B)}analyzeGraces(O,B){(O.graces||[]).forEach(($,tt)=>this.analyzeGrace($,B,tt))}analyzeGrace(O,B,w){const $=O.heads.slice(),tt=new Map,at=[];for(let st=$.length-1;st>=0;st--){const ct=$[st];if(!ct.fretData){const pt=j.default.stringify(ct.pitch);tt.set(pt,{previousPitch:j.default.copy(ct.pitch),newPitch:j.default.copy(ct.pitch)}),$.splice(st,1)}}$.forEach(st=>{let ct=this.transposePitch(st.pitch),pt=j.default.stringify(ct);if(tt.has(pt)&&(ct=Mt.A.switchEnharmonic(ct,z),pt=j.default.stringify(ct)),tt.has(pt)){at.push(st.pitch);return}tt.set(pt,{previousPitch:j.default.copy(st.pitch),newPitch:ct})}),tt.forEach(({previousPitch:st,newPitch:ct})=>{const pt=ft(B,w,st);this.gracePitchMapping.set(pt,ct)}),at.forEach(st=>{const ct=ft(B,w,st);this.gracePitchMapping.set(ct,null)})}transposePitch(O){return O=j.default.transpose(O,this.transpose,!0),O}translateNote(O,B){if(O.isRest)return;const{heads:w}=O;for(let $=w.length-1;$>=0;$--){const tt=w[$],at=ht(B,tt.pitch),st=this.pitchMapping.get(at);st===null?w.splice($,1):tt.pitch=j.default.copy(st)}this.translateGraces(O,B)}translateGraces(O,B){(O.graces||[]).forEach(($,tt)=>{this.translateGrace($,B,tt)})}translateGrace(O,B,w){const{heads:$}=O;for(let tt=$.length-1;tt>=0;tt--){const at=$[tt],st=ft(B,w,at.pitch),ct=this.gracePitchMapping.get(st);ct===null?$.splice(tt,1):at.pitch=j.default.copy(ct)}}translateTies(O){for(let B=O.length-1;B>=0;B--){const w=O[B],$=ht(w.noteIdx,w),tt=this.pitchMapping.get($);if(tt===null){O.splice(B,1);continue}const at=ht(w.noteIdx+1,w);if(!this.pitchMapping.has(at)){O.splice(B,1);continue}const st=this.pitchMapping.get(at);if(st===null||!j.default.isSamePitch(tt,st)){O.splice(B,1);continue}const ct=j.default.copy(tt);ct.noteIdx=w.noteIdx,O[B]=ct}}translateSlides(O){for(let B=O.length-1;B>=0;B--){const w=O[B],$=ht(w.noteIdx,w.leftPitch),tt=this.pitchMapping.get($);if(tt===null){O.splice(B,1);continue}const at=ht(w.noteIdx+1,w.rightPitch),st=this.pitchMapping.get(at);if(st===null){O.splice(B,1);continue}w.leftPitch=j.default.copy(tt),w.rightPitch=j.default.copy(st)}}translateGlissandos(O){for(let B=O.length-1;B>=0;B--){const w=O[B],$=ht(w.noteIdx,w.leftPitch),tt=this.pitchMapping.get($);if(tt===null){O.splice(B,1);continue}const at=ht(w.noteIdx+1,w.rightPitch),st=this.pitchMapping.get(at);if(st===null){O.splice(B,1);continue}w.leftPitch=j.default.copy(tt),w.rightPitch=j.default.copy(st)}}translateHammerOnPullOffs(O){for(let B=O.length-1;B>=0;B--){const w=O[B],$=ht(w.noteIdx,w.leftPitch),tt=this.pitchMapping.get($);if(tt===null){O.splice(B,1);continue}w.leftPitch=j.default.copy(tt)}}}function ht(C,O){return`${C}-${j.default.stringify(O)}`}function ft(C,O,B){return`${C}-${O}-${j.default.stringify(B)}`}var xt=t(474765),St=t(189247),Pt=t(985046);const At=function(C,O,B){this.init(C,O,B)};At.NAME="composite.SetStaffDetails";const lt=At.prototype;lt.name=At.NAME,lt.init=function(C,O,B){this.scoreData=C,this.opts=O,this.cancelStack=B,this.setMeasuresFretsActions=null,this.unsetMeasuresFretsActions=null,this.voicesContent=null,this.measuresScroller=null,this.transpose=null,this.currentStaffDetails=null},lt.perform=function(){this.removeQuarterToneIfNeeded();const C=this.isTabStaff(),O=this.hasTabFrameEnabled();this.opts.preserveFrets&&this.hasTabOpts()&&C?(this.recordContent(),this.computeTranspose()):this.opts.updateFrets&&(!this.hasTabOpts()||C)&&this.unsetMeasuresFrets(),this.setStaffDetails(),this.voicesContent!==null?(this.insertContent(),this.transposeKey()):this.opts.updateFrets&&this.hasTabOpts()&&this.setMeasuresFrets(),!g.default.hasTabFrameEnabled(this.opts.staffDetails)&&O?this.removeChordFrames():g.default.hasTabFrameEnabled(this.opts.staffDetails)&&!O&&this.addChordFrames()},lt.removeQuarterToneIfNeeded=function(){if(!g.default.hasKodaly(this.opts.staffDetails)&&!g.default.hasStaffTuning(this.opts.staffDetails))return;const C=this.scoreData.getPartHeader(this.opts.partIdx);if(m.default.hasQuarterTone(C)){const B={partIdx:this.opts.partIdx,hasQuarterTone:!1},w=new h.default(this.scoreData,B,this.cancelStack);(0,d.default)(w)}},lt.recordContent=function(){this.voicesContent=[];const C=this.scoreData.getNbMeasures(),O=this.scoreData.getMeasure(this.opts.partIdx,0),B=v.default.getDpq(O),w=C-1,$=this.scoreData.getMeasure(this.opts.partIdx,w),tt=v.default.getNbDivisions($),at=v.default.getDpq($),st=this.getMeasuresScroller();this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,0).forEach(pt=>{const gt=(0,xt.A)(st,{startMeasureIdx:0,startTimePos:0,startDpq:B,stopMeasureIdx:w,stopTimePos:tt,stopDpq:at},pt);if(gt===null)return;gt.partIdx=this.opts.partIdx,gt.voiceIdx=pt;const Dt=(0,Pt.A)(this.scoreData,gt,st);this.voicesContent.push({data:Dt,voiceIdx:pt,startMeasureIdx:gt.startMeasureIdx})})},lt.computeTranspose=function(){const C=this.getCurrentStaffDetails(),O=g.default.getCapo(C);let w=g.default.getCapo(this.opts.staffDetails)-O;const $=w/o.default.NB_CHROMATIC;w=w%o.default.NB_CHROMATIC;const tt=s.default.getChromaticDefaultDiatonic(w);this.transpose=o.default.createComplete(w,tt,$)},lt.isTabStaff=function(){const C=this.getCurrentStaffDetails();return g.default.hasStaffTuning(C)},lt.hasTabFrameEnabled=function(){const C=this.getCurrentStaffDetails();return g.default.hasTabFrameEnabled(C)},lt.getCurrentStaffDetails=function(){if(this.currentStaffDetails===null){const C=this.scoreData.getMeasure(this.opts.partIdx,0),O=v.default.getWrappedStaffDetailsOrDefault(C);this.currentStaffDetails=O.getEntry(this.opts.staffIdx)}return this.currentStaffDetails},lt.hasTabOpts=function(){return g.default.hasTab(this.opts.staffDetails)&&g.default.getStaffTuningsLength(this.opts.staffDetails)>0},lt.setStaffDetails=function(){const C={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffDetails:g.default.copy(this.opts.staffDetails)};new c(this.scoreData,C,this.cancelStack).perform()},lt.getVoiceIndexes=function(){return this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx)},lt.performAction=function(C){C.perform()},lt.setMeasuresFrets=function(){this.getSetMeasuresFretsActions().forEach(this.performAction)},lt.unsetMeasuresFrets=function(){this.getUnsetMeasuresFretsActions().forEach(this.performAction)},lt.getSetMeasuresFretsActions=function(){if(this.setMeasuresFretsActions===null){const C=[];this.getVoiceIndexes().forEach(function(B){const w={partIdx:this.opts.partIdx,voiceIdx:B},$=new S(this.scoreData,w,this.cancelStack);C.push($)},this),this.setMeasuresFretsActions=C}return this.setMeasuresFretsActions},lt.getUnsetMeasuresFretsActions=function(){if(this.unsetMeasuresFretsActions===null){const C=[];this.getVoiceIndexes().forEach(function(B){const w={partIdx:this.opts.partIdx,voiceIdx:B},$=new T(this.scoreData,w,this.cancelStack);C.push($)},this),this.unsetMeasuresFretsActions=C}return this.unsetMeasuresFretsActions},lt.removeChordFrames=function(){const C={partIdx:this.opts.partIdx};new U(this.scoreData,C,this.cancelStack).perform()},lt.addChordFrames=function(){const C={partIdx:this.opts.partIdx};new K(this.scoreData,C,this.cancelStack).perform()},lt.insertContent=function(){this.voicesContent.forEach(C=>{et(C.data,this.opts.staffDetails);const O={partIdx:this.opts.partIdx,measureIdx:C.startMeasureIdx,staffIdx:this.opts.staffIdx,voiceIdx:C.voiceIdx,timePos:0,dpq:1,restLyrics:!1,data:C.data},B=this.getMeasuresScroller();new _.A(B,O,this.cancelStack).perform()})},lt.getMeasuresScroller=function(){if(this.measuresScroller===null){const C=this.scoreData.getPartContent(this.opts.partIdx),O=f.A.getMeasures(C);this.measuresScroller=new St.A(O,this.opts.partIdx,this.scoreData)}return this.measuresScroller},lt.transposeKey=function(){const C=this.scoreData.getNbMeasures(),O={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:0,stopMeasureIdx:C-1,transpose:o.default.copy(this.transpose)};new ot.A(this.scoreData,O,this.cancelStack).perform()};const Y=At},342762:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(364842),v=t(857899),M=t(555172),f=t(701387),l=t(350357),r=t(953388),u=t(852363);const c=function(e,i,p){this.init(e,i,p)};c.NAME="primitive.AddBarline";const m=c.prototype;m.name=c.NAME,m.init=function(e,i,p){this.scoreData=e,this.cancelStack=p,this.opts=i},m.perform=function(){this.addBarline(),this.updateStack()},m.addBarline=function(){const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);this.removeFormer(e);const i=f.default.getBarlines(e),p=M.A.createBarline(this.opts.side,this.opts.style);v.A.addBarline(i,p),f.default.setBarlines(e,i)},m.removeFormer=function(e){const i=f.default.getBarlines(e);if(this.opts.side===l.A.LEFT)this.removeFormerLeft(i);else if(this.opts.side===l.A.RIGHT)this.removeFormerRight(i);else throw new g.default("Unexpected")},m.removeFormerLeft=function(e){if(v.A.hasLeft(e)){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,side:this.opts.side};new r.A(this.scoreData,i,this.cancelStack).perform()}},m.removeFormerRight=function(e){if(v.A.hasRight(e)){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,side:this.opts.side};new r.A(this.scoreData,i,this.cancelStack).perform()}},m.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,u.default)(this.cancelStack,this.scoreData,this.opts)};const o=c,s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddBarline";const d=s.prototype;d.name=s.NAME,d.init=function(e,i,p){this.scoreData=e,this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addPartsBarlines()},d.addPartsBarlines=function(){const e=this.scoreData.getNbParts();for(let i=0;i<e;i++)this.addPartBarline(i)},d.addPartBarline=function(e){const i={partIdx:e,measureIdx:this.opts.measureIdx,side:this.opts.side,style:this.opts.style};new o(this.scoreData,i,this.cancelStack).perform()};const h=s},344361:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(561248);const M=function(f,l){typeof l=="undefined"&&(l=null);const r=f.getNbMeasures(),u=[];for(let c=0;c<r;c++){const m=u.length;if(c===l||f.hasRehearsalAuto(c)){const o={measureIdx:c,index:m,value:null,input:!1};if(c===l&&(o.input=!0),f.hasRehearsalAuto(c)){const s=f.getRehearsal(c);o.value=g.A.getText(s)}u.push(o)}}return u}},350357:(H,P,t)=>{t.d(P,{A:()=>v});const v={LEFT:"left",RIGHT:"right"}},354065:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(737903),v=t(209175),M=t(515819),f=t(259563);const l=function(s){return m().extract(s)},r=function(){},u=r.prototype;u.extract=function(s){for(this.reset(s);!this.endReached();)this.processNote();const d=this.quarterDuration;return this.cleanup(),d},u.reset=function(s){this.notes=s,this.nbNotes=s.length,this.quarterDuration=0,this.noteIdx=0},u.endReached=function(){return this.noteIdx===this.nbNotes},u.processNote=function(){typeof this.notes[this.noteIdx].tuplet!="undefined"?this.processTuplet():this.processNormalNote()},u.processTuplet=function(){this.addTupletDuration(),this.skipTuplet()},u.addTupletDuration=function(){const s=this.notes[this.noteIdx],d=v.default.getNormal(s.tuplet.timeModif),h=f.default.toQuarterDuration(s.tuplet.durationType),e=d*h;this.quarterDuration+=e},u.skipTuplet=function(){const s=this.notes[this.noteIdx],d=v.default.getActual(s.tuplet.timeModif),h=f.default.toQuarterDuration(s.tuplet.durationType),e=d*h;let i=0;for(;i<e;){const p=(0,g.default)(this.notes[this.noteIdx]),x=M.default.durationOptsToQuarter(p);i+=x,this.noteIdx++}},u.processNormalNote=function(){const s=(0,g.default)(this.notes[this.noteIdx]),d=M.default.durationOptsToQuarter(s);this.quarterDuration+=d,this.noteIdx++},u.cleanup=function(){this.notes=null};let c=null;const m=function(){return c===null&&(c=new r),c},o=l},355102:(H,P,t)=>{t.d(P,{A:()=>p});var g=t(737903),v=t(476943),M=t(123491),f=t(414208),l=t(846541),r=t(793317),u=t(519405);const c=function(x,S,I){this.init(x,S,I)};c.NAME="composite.RemoveStaffMeasureLeftTies";const m=c.prototype;m.initMeasureData=r.default,m.name=c.NAME,m.init=function(x,S,I){this.initMeasureData(x,S),this.cancelStack=I,this.opts=S},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const x=(0,g.default)(this.opts);x.noteIdx=-1;let I=this.measureData.getVoice(this.opts.voiceIdx).getChord(0);if(I=v.default.makeArray(I),!I.some(M.default.hasTieStop))return;const n=this.measureData.isUnpitched()?l.default:f.default,a=new n(this.measureData,x,this.cancelStack);(0,u.default)(a)};const o=c,s=function(x,S,I){this.init(x,S,I)};s.NAME="composite.RemoveMeasureLeftTies";const d=s.prototype;d.initMeasureData=r.default,d.name=s.NAME,d.init=function(x,S,I){this.initMeasureData(x,S),this.cancelStack=I,this.opts=S},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceTies,this)},d.removeVoiceTies=function(x,S){const I=(0,g.default)(this.opts);I.voiceIdx=S,new o(this.measureData,I,this.cancelStack).perform()};const h=s,e=function(x,S,I){this.init(x,S,I)};e.NAME="composite.RemoveColumnLeftTies";const i=e.prototype;i.name=e.NAME,i.init=function(x,S,I){this.scoreData=x,this.cancelStack=I,this.opts=S},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const x=this.scoreData.getNbParts();for(let S=0;S<x;S++){const I=(0,g.default)(this.opts);I.partIdx=S,new h(this.scoreData,I,this.cancelStack).perform()}};const p=e},366160:(H,P,t)=>{t.d(P,{A:()=>e});var g=t(951066);function v(i){return`The rebearsal content [${i}] is invalid.`}class M extends g.A{constructor(p){const x=v(p);super(x),Object.defineProperty(this,"rehearsal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadRehearsalContentError",this.rehearsal=p}}var f=t(364842),l=t(726042),r=t(319731);function u(i,p){i===r.A.AUTO?o(p):i===r.A.MEASURE_NUMBER||(i===r.A.CUSTOM?m(p):r.A.raiseError(i))}const c=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function m(i){if(!s(i))throw new M(i)}function o(i){if(!s(i))throw new M(i)}function s(i){return typeof i=="string"&&i.trim()!==""}function d(){return c.length-1}function h(i){if(!l.default.isInteger(i)||i<0||i>=c.length){const p=`The rehearsal index [${i}] is invalid.`;throw new f.default("InvalidRehearsalIndex",p)}else return c[i]}const e={check:u,checkCustom:m,checkAuto:o,isValid:s,getMaxIndex:d,indexToLetter:h}},366274:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(123491),v=t(515819),M=t(407304),f=t(82028),l=t(793317),r=t(519405);const u=function(o,s,d){this.init(o,s,d)};u.NAME="composite.RemoveSpaceTuplets";const c=u.prototype;c.name=u.NAME,c.initMeasureData=l.default,c.init=function(o,s,d){this.initMeasureData(o,s),this.cancelStack=d,this.opts=s,this.measure=null,this.noteIdx=null,this.quarterPos=null},c.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),!!this.measureData.hasVoice(this.opts.voiceIdx))for(this.fetchNoteIdx(),this.isTuplet()&&this.fetchTupletStart(),this.fetchQuarterPos();!this.done();)this.isTuplet()&&this.removeTuplet(),this.moveForward()},c.fetchNoteIdx=function(){const o=this.getDpq(),s=v.default.quarterToDuration(this.opts.quarterPosition,o),d=this.getVoice(),h=1;this.noteIdx=(0,f.default)(d,h,s)},c.isTuplet=function(){const s=this.getVoiceOrTuplet().isTuplet();return s||this.clearTupletCache(),s},c.fetchTupletStart=function(){const o=this.getVoiceOrTuplet();this.noteIdx=o.getStartNoteIdx()},c.getVoiceOrTuplet=function(){return this.measureData.getVoiceOrTupletForGet(this.opts.voiceIdx,this.noteIdx)},c.fetchQuarterPos=function(){const o=this.getTimePos(),s=this.getDpq();this.quarterPos=v.default.divisionsToQuarter(o,s)},c.getTimePos=function(){let o=0;const s=this.getVoice();for(let d=0;d<this.noteIdx;d++){const h=s.getNote(d),e=g.default.getDuration(h);o+=e}return o},c.done=function(){const s=this.getVoice().size();if(this.noteIdx>=s)return!0;const d=this.getEndQuarterPos();return this.quarterPos>=d},c.getEndQuarterPos=function(){return this.opts.quarterPosition+this.opts.quarterDuration},c.getDpq=function(){return this.measureData.getDpqValue()},c.removeTuplet=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx},s=new M.default(this.measureData,o,this.cancelStack);(0,r.default)(s),this.clearTupletCache()},c.clearTupletCache=function(){this.measureData.clearTupletCache(this.opts.voiceIdx)},c.moveForward=function(){const o=this.getCurrentNoteQuarterDuration();this.quarterPos+=o,this.noteIdx++},c.getCurrentNoteQuarterDuration=function(){const s=this.getVoice().getNote(this.noteIdx),d=this.getDpq();return g.default.getQuarterDuration(s,d)},c.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)};const m=u},371706:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(607682);class v extends g.default{constructor(r){super(`There is already a voice linked to the following UUID ${r}`),Object.defineProperty(this,"voiceUuid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="AlreadyHasVoiceUuidError",this.voiceUuid=r}}const f=function(l,r){if(l.hasPartVoiceUuid(r.partIdx,r.voiceUuid))throw new v(r.voiceUuid)}},377443:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(264843),v=t(383279);const f=function(l,r,u){let c;if(r!==null&&v.default.hasStaffUuid(l,r))return c=v.default.getStaffIdxFromUuid(l,r),c+1;if(u!==null&&v.default.hasStaffUuid(l,u))return v.default.getStaffIdxFromUuid(l,u);if(r===null)return 0;if(u===null)return v.default.getStaffNbVoices(l);throw new g.A(r,u)}},388909:(H,P,t)=>{t.d(P,{A:()=>r});var g=t(701387),v=t(721247),M=t(852363);const f=function(u,c,m){this.init(u,c,m)};f.NAME="primitive.SetClef";const l=f.prototype;l.name=f.NAME,l.init=function(u,c,m){this.scoreData=u,this.cancelStack=m,this.opts=c},l.perform=function(){const u=this.setClef();this.updateStack(u)},l.setClef=function(){const u=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),c=g.default.getWrappedClef(u),m=this.opts.staffIdx;let o=c.getEntry(m);o=v.default.copy(o);const s=v.default.copy(this.opts.clef);c.setEntry(s,m);const d=c.dumpAttribute();return g.default.setClef(u,d),o},l.updateStack=function(u){const c=v.default.copy(this.opts.clef),m={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,previousClef:u,newClef:c}};this.cancelStack.push(m),(0,M.default)(this.cancelStack,this.scoreData,this.opts)};const r=f},392725:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682),v=t(987901);class M extends g.default{constructor(){const l=`There cannot be more than [${v.A.MAX_NB_VOICES_PER_STAFF}] voices per staff.`;super(l),this.name="MaxNbVoicesPerStaffError"}}},405563:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("There is no Jump Tag to delete"),this.name="NoJumpTagToRemove"}}},408143:(H,P,t)=>{t.d(P,{A:()=>p});var g=t(701387),v=t(668674),M=t(852363);const f=function(x,S,I){this.init(x,S,I)};f.NAME="primitive.AddMeasureSlash";const l=f.prototype;l.name=f.NAME,l.init=function(x,S,I){this.scoreData=x,this.cancelStack=I,this.opts=S,this.measure=null},l.perform=function(){this.addMeasureSlash(),this.updateStack()},l.addMeasureSlash=function(){const x=this.getMeasure(),S=this.createSlash();g.default.setSlash(x,this.opts.staffIdx,S)},l.createSlash=function(){return v.A.create(this.opts.isUsingStems)},l.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},l.updateStack=function(){const x={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(x),(0,M.default)(this.cancelStack,this.scoreData,this.opts)};const r=f;var u=t(991868),c=t(519405),m=t(750026),o=t(379668),s=t(726271),d=t(712844),h=t(288572);const e=function(x,S,I){this.init(x,S,I)};e.NAME="composite.AddMeasureSlash";const i=e.prototype;i.name=e.NAME,i.init=function(x,S,I){this.scoreData=x,this.cancelStack=I,this.opts=S},i.perform=function(){this.removeMmr(),this.removeMeasureRepeat(),this.removeSlash(),this.opts.isUsingStems||(this.clearStaffVoices(),this.formatRests()),this.addMeasureSlash()},i.removeMmr=function(){(0,o.A)(this.scoreData,this.opts,this.cancelStack)},i.removeMeasureRepeat=function(){const x=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(g.default.hasMeasureRepeat(x,this.opts.staffIdx)){const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx},I=new s.default(this.scoreData,S,this.cancelStack);(0,c.default)(I)}},i.removeSlash=function(){const x=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(g.default.hasSlash(x,this.opts.staffIdx)){const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx},I=new d.A(this.scoreData,S,this.cancelStack);(0,c.default)(I)}},i.clearStaffVoices=function(){const x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx},S=new u.default(this.scoreData,x,this.cancelStack);(0,c.default)(S)},i.formatRests=function(){const x=(0,m.A)(this.scoreData,this.opts.partIdx,this.opts.measureIdx);let S=this.scoreData.getPartStaffVoicesIndexes(this.opts.partIdx,this.opts.staffIdx);S=S.filter(x.hasVoice,x),S.forEach(I=>{const n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:I,noteIdx:0},a=new h.default(x,n,this.cancelStack);(0,c.default)(a)})},i.addMeasureSlash=function(){const x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,isUsingStems:this.opts.isUsingStems};new r(this.scoreData,x,this.cancelStack).perform()};const p=e},411365:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(130412),v=t(476943),M=t(123491),f=t(351277),l=t(200665),r=t(793317);const u=function(e,i,p){this.init(e,i,p)},c=u.prototype;c.initMeasureData=r.default,c.init=function(e,i,p){this.initMeasureData(e,i),this.opts=i,this.cancelStack=p,this.actions=null},c.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},c.perform=function(){this.getSetGraceFretActions().forEach(this.performActionIfPossible)},c.performActionIfPossible=function(e){e.performIfPossible()},c.getSetGraceFretActions=function(){return this.actions===null&&(this.actions=this.getChordsActions()),this.actions},c.getChordsActions=function(){const e=this.getVoice(),i=this.opts.noteIdx;if(!e.isRest(i)){let p=e.getGraceChord(i,this.opts.graceIdx);return p=v.default.makeArray(p),this.getChordActions(p)}return[]},c.getChordActions=function(e){const i=[];return e.forEach(function(p){if(!M.default.hasFretData(p)){const x=M.default.getPitch(p),S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:f.default.copy(x),record:!0},I=new l.default(this.measureData,S,this.cancelStack);i.push(I)}},this),i.sort(m),i};function m(e,i){const p=e.opts.pitch,x=i.opts.pitch;return-f.default.naiveComparePitch(p,x)}const o=u,s=function(e,i,p){this.init(e,i,p)},d=s.prototype;d.init=function(e,i,p){this.measureData=e,this.opts=i,this.cancelStack=p,this.actions=null},d.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},d.perform=function(){this.getActions().forEach(this.performAction)},d.performAction=function(e){e.perform()},d.getActions=function(){return this.actions===null&&(this.actions=this.createActions()),this.actions},d.createActions=function(){const e=this.getVoice(),i=e.getNbNotes(),p=[];for(let x=0;x<i;x++){if(e.isRest(x))continue;const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:x},I=new g.A(this.measureData,S,this.cancelStack);p.push(I);const n=e.getNbGraces(x);for(let a=0;a<n;a++){const D={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:x,graceIdx:a},T=new o(this.measureData,D,this.cancelStack);p.push(T)}}return p};const h=s},411782:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(264843),v=t(210888);const M=function(c,m){if(!f(c,m))throw new g.A(m.previousUuid,m.nextUuid)},f=function(c,m){return l(c,m.previousUuid)||l(c,m.nextUuid)||r(m.previousUuid)&&m.nextUuid===null?!0:!!(r(m.nextUuid)&&m.previousUuid===null)},l=function(c,m){return r(m)&&c.hasMeasureIdxByUuid(m)},r=function(c){return typeof c=="string"&&v.default.isValid(c)},u=M},416821:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("There is already a tuplet at this location."),this.name="AlreadyTupletError"}}},427842:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(123491),v=t(292681),M=t(793317),f=t(76004),l=t(852363);const r=function(e,i,p){this.init(e,i,p)};r.NAME="primitive.AddColorToGracePercu";const u=r.prototype;u.name=r.NAME,u.initMeasureData=M.default,u.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},u.perform=function(){this.addColorToGracePercu(),this.updateStack()},u.addColorToGracePercu=function(){const e=this.measureData.getVoice(this.opts.voiceIdx),i=(0,f.A)(e,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);g.default.setColor(i,this.opts.color)},u.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const c=r;var m=t(795510),o=t(519405);const s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddColorToGracePercu";const d=s.prototype;d.initMeasureData=M.default,d.name=s.NAME,d.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerColor()&&this.removeFormerColor(),this.addColorToGracePercu()},d.hasFormerColor=function(){const e=this.measureData.getVoice(this.opts.voiceIdx),i=(0,f.A)(e,this.opts.noteIdx,this.opts.graceIdx,this.opts.unpitched);return g.default.hasColor(i)},d.removeFormerColor=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:v.default.copy(this.opts.unpitched)},i=new m.default(this.measureData,e,this.cancelStack);(0,o.default)(i)},d.addColorToGracePercu=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,unpitched:v.default.copy(this.opts.unpitched),color:this.opts.color};new c(this.measureData,e,this.cancelStack).perform()};const h=s},430318:(H,P,t)=>{t.d(P,{A:()=>T});var g=t(515819),v=t(701387),M=t(292681),f=t(123491),l=t(366274),r=t(823880),u=t(15635),c=t(492380),m=t(563276),o=t(551303),s=t(27912),d=t(793317),h=t(519405);const e=function(N,y,A){this.init(N,y,A)};e.NAME="composite.AddChordPercuIntraMeasure";const i=e.prototype;i.name=e.NAME,i.initMeasureData=d.default,i.init=function(N,y,A){this.initMeasureData(N,y),this.cancelStack=A,this.opts=y,this.firstChord=!0,this.quarterPosition=y.quarterPosition,this.quarterDuration=y.quarterDuration,this.noteIdx=null},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.isVoiceDisplayed()?(this.removeSpaceTuplets(),this.removeSpaceChords()):this.displayVoice(),this.splitRest(),this.fetchNoteIdx(),this.addChords()},i.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},i.removeSpaceTuplets=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new l.A(this.measureData,N,this.cancelStack).perform()},i.removeSpaceChords=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new r.A(this.measureData,N,this.cancelStack).perform()},i.displayVoice=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},y=new o.default(this.measureData,N,this.cancelStack);(0,h.default)(y)},i.splitRest=function(){const N=g.default.quarterDurationToRequiredDpq(this.quarterPosition),y=g.default.quarterToDuration(this.quarterPosition,N),A={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:y,dpq:N};new u.A(this.measureData,A,this.cancelStack).perform()},i.fetchNoteIdx=function(){const N=this.measureData.getDpqValue(),y=g.default.quarterToDuration(this.quarterPosition,N),A=this.measureData.getVoice(this.opts.voiceIdx),R=1;this.noteIdx=(0,s.A)(A,R,y)},i.addChords=function(){for(;this.quarterDuration>0;){const N=this.getDurationOpts();this.addChord(N),this.isFirstChord()||this.tieWithPrevious(),this.moveForward()}},i.getDurationOpts=function(){const N=g.default.extractQuarterPossibleDuration(this.quarterDuration);return g.default.quarterToDurationOpts(N)},i.addChord=function(N){const y=this.opts.instruments.map(p),A={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.noteIdx,instruments:y,durationType:N.durationType,nbDots:N.nbDots},R=new c.default(this.measureData,A,this.cancelStack);(0,h.default)(R)};const p=function(N){return{unpitched:M.default.copy(N.unpitched),notehead:N.notehead}};i.isFirstChord=function(){return this.firstChord},i.tieWithPrevious=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx-1},y=new m.default(this.measureData,N,this.cancelStack);(0,h.default)(y)},i.moveForward=function(){this.firstChord=!1;const N=this.getCurrentQuarterDuration();this.quarterDuration-=N,this.noteIdx++},i.getCurrentQuarterDuration=function(){const N=this.measureData.getDpqValue(),A=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.noteIdx);return f.default.getQuarterDuration(A,N)};const x=e;var S=t(526881),I=t(857579);const n=function(N,y,A){this.init(N,y,A)};n.NAME="composite.AddChordPercuCrossMeasure";const a=n.prototype;a.name=n.NAME,a.init=function(N,y,A){this.scoreData=N,this.cancelStack=A,this.opts=y,this.measureIdx=this.opts.measureIdx,this.quarterPosition=this.opts.quarterPosition,this.quarterDuration=this.opts.quarterDuration},a.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name);this.quarterDuration>0;){const N=this.getSliceDuration();this.addChordIntraMeasure(N),this.isFirstMeasure()||this.tieWithPrevious(),this.moveForward(N),this.measureEndReached()&&this.nextMeasure()}this.storePosition()},a.isFirstMeasure=function(){return this.measureIdx===this.opts.measureIdx},a.tieWithPrevious=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:-1},y=new m.default(this.scoreData,N,this.cancelStack);(0,h.default)(y)},a.getSliceDuration=function(){const y=this.getMeasureQuarterDuration()-this.quarterPosition;return Math.min(y,this.quarterDuration)},a.addChordIntraMeasure=function(N){const y=this.opts.instruments.map(D),A={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:N,instruments:y};new x(this.scoreData,A,this.cancelStack).perform()};const D=function(N){return{unpitched:M.default.copy(N.unpitched),notehead:N.notehead}};a.moveForward=function(N){this.quarterPosition+=N,this.quarterDuration-=N},a.measureEndReached=function(){return this.getMeasureQuarterDuration()===this.quarterPosition},a.getMeasureQuarterDuration=function(){const N=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),y=v.default.getAnyTime(N);return g.default.timeToQuarter(y)},a.nextMeasure=function(){this.measureIdx++,this.quarterPosition=0;const N=this.scoreData.getNbMeasures();this.measureIdx===N&&this.addMeasure()},a.addMeasure=function(){const N={measureIdx:this.measureIdx},y=new S.default(this.scoreData,N,this.cancelStack);(0,h.default)(y)},a.storePosition=function(){const N=this.fetchNoteIdx(),y={measureIdx:this.measureIdx,noteIdx:N};this.cancelStack.storePosition(y)},a.fetchNoteIdx=function(){if(this.quarterPosition===0)return 0;const N=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),y=new I.A(N),A=y.getVoice(this.opts.voiceIdx),R=y.getDpqValue(),W=g.default.quarterToDuration(this.quarterPosition,R);return(0,s.A)(A,1,W)};const T=n},430411:(H,P,t)=>{t.d(P,{A:()=>lt});var g=t(661e3),v=t(383279),M=t(843678),f=t(726042);const l=function(Y,C,O,B){let w=v.default.getVoiceMapping(Y);w=M.default.map(w,r,C);const $={mapping:w,staffIdx:C};O.voices.forEach(c,$),v.default.setVoiceMapping(Y,w),v.default.getStaffMapping(Y).splice(C,0,O),M.default.forEach(B,m,Y)},r=function(Y,C){const O=this.valueOf();return C=C.map(u,O),C},u=function(Y){const C=this.valueOf();return Y>=C?Y+1:Y},c=function(Y){const C=this;C.mapping[Y]=[C.staffIdx]},m=function(Y,C){const O=this;Y=f.default.intPart(Y),v.default.recordVoiceUuid(O,Y,C)},o=l;var s=t(701387),d=t(123491);const h=function(Y,C){s.default.getNotes(Y).forEach(e,C)},e=function(Y){const C=this.valueOf(),O=d.default.getStaffIdx(Y);O>=C&&d.default.setStaffIdx(Y,O+1)},i=h;var p=t(952818),x=t(494815),S=t(473723);const I=function(Y,C){const O=s.default.getNbStaves(Y),B=s.default.getStaffContentMap(Y);n(B,O,C),a(B,O,C),s.default.setStaffContentMap(Y,B);const w=s.default.getLeftStaffMap(Y);n(w,O,C),D(w,O,C),s.default.setLeftStaffMap(Y,w);const $=s.default.getRightStaffMap(Y);n($,O,C),D($,O,C),s.default.setRightStaffMap(Y,$)},n=function(Y,C,O){for(let B=C-1;B>=O;B--)if(typeof Y[B]!="undefined"){const w=Y[B];delete Y[B],Y[B+1]=w}},a=function(Y,C,O){for(let B=O+1;B<C+1;B++)if(typeof Y[B]!="undefined"){const w=Y[B];x.A.getDynamics(w).forEach(T,B),x.A.getPizzicatos(w).forEach(T,B),x.A.getWords(w).forEach(T,B),x.A.getPedals(w).forEach(T,B),x.A.getOctaveShifts(w).forEach(T,B),x.A.getWedges(w).forEach(T,B)}},D=function(Y,C,O){for(let B=O+1;B<C+1;B++)if(typeof Y[B]!="undefined"){const w=Y[B];if(S.A.hasWedge(w)){const $=S.A.getWedge(w);N($,B)}if(S.A.hasPedal(w)){const $=S.A.getPedal(w);N($,B)}if(S.A.hasOctaveShift(w)){const $=S.A.getOctaveShift(w);N($,B)}}},T=function(Y){const C=this.valueOf();N(Y,C)},N=function(Y,C){p.A.setStaffIdx(Y,C)},y=I;var A=t(35802),R=t(104907),W=t(721247),F=t(364596),E=t(518558),U=t(377180);const Q=function(Y,C){const O=s.default.getNbStaves(Y),B=s.default.getAttributes(Y);G(B,O,C),s.default.setAttributes(Y,B);const w=s.default.getOwnAttributes(Y);G(w,O,C),s.default.setOwnAttributes(Y,w)},G=function(Y,C,O){const B=K(O),w=A.default.getWrappedStaffDetails(Y,C);let $=w.getEntry(B);$=k($,R.default),w.insertEntry($,O);const tt=w.dumpAttribute();A.default.setStaffDetails(Y,tt);const at=A.default.getWrappedClef(Y,C);let st=at.getEntry(B);st=k(st,W.default),at.insertEntry(st,O);const ct=at.dumpAttribute();A.default.setClef(Y,ct);const pt=A.default.getWrappedKey(Y,C);let gt=pt.getEntry(B);gt=k(gt,F.default),pt.insertEntry(gt,O);const Dt=pt.dumpAttribute();A.default.setKey(Y,Dt);const Et=A.default.getWrappedTime(Y,C);let Ct=Et.getEntry(B);Ct=k(Ct,E.default),Et.insertEntry(Ct,O);const Nt=Et.dumpAttribute();A.default.setTime(Y,Nt);const Rt=A.default.getWrappedTranspose(Y,C);let yt=Rt.getEntry(B);yt=k(yt,U.default),Rt.insertEntry(yt,O);const Tt=Rt.dumpAttribute();A.default.setTranspose(Y,Tt),A.default.setNbStaves(Y,C+1)},k=function(Y,C){return Y===null||(Y=C.copy(Y)),Y},K=function(Y){return Y===0?0:Y-1},_=Q,dt=function(Y,C){i(Y,C),y(Y,C),_(Y,C)};var Mt=t(857579),j=t(276265),J=t(737903),V=t(446921);const z=function(Y,C,O){this.init(Y,C,O)};z.NAME="primitive.AddStaff";const et=z.prototype;et.name=z.NAME,et.init=function(Y,C,O){this.scoreData=Y,this.cancelStack=O,this.opts=C},et.perform=function(){this.addStaffInPartHeader(),this.addStaffInMeasures(),this.addMeasuresVoices()},et.addStaffInPartHeader=function(){const Y=this.scoreData.getPartHeader(this.opts.partIdx),C=(0,J.default)(this.opts.voicesData);C.staffUuid=this.opts.staffUuid;const O=(0,J.default)(this.opts.voiceIdxToUuidMapping);o(Y,this.opts.staffIdx,C,O)},et.addStaffInMeasures=function(){const Y=this.scoreData.getPartContent(this.opts.partIdx);V.A.getMeasures(Y).forEach(this.addStaffInMeasure,this)},et.addStaffInMeasure=function(Y){dt(Y,this.opts.staffIdx)},et.addMeasuresVoices=function(){const Y=this.scoreData.getPartContent(this.opts.partIdx);V.A.getMeasures(Y).forEach(this.addMeasureVoices,this)},et.addMeasureVoices=function(Y,C){this.measureIdx=C,this.measureData=new Mt.A(Y),this.opts.voicesData.voices.forEach(this.addMeasureVoice,this)},et.addMeasureVoice=function(Y){this.measureData.getVoicesList().insertVoice(Y);const O={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:Y,staffIdx:this.opts.staffIdx};new j.A(this.measureData,O).perform()};const rt=z;var ht=t(329578),ft=t(519405),xt=t(59377);const St=function(Y,C,O){this.init(Y,C,O)};St.NAME="action.AddStaff";const Pt=St.prototype;Pt.name=St.NAME,Pt.init=function(Y,C,O){this.scoreData=Y,this.cancelStack=O,this.opts=C},Pt.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addStaff(),this.setClef()},Pt.addStaff=function(){const Y={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,staffUuid:this.opts.staffUuid,voicesData:this.opts.voicesData,voiceIdxToUuidMapping:this.opts.voiceIdxToUuidMapping};new rt(this.scoreData,Y,this.cancelStack).perform()},Pt.setClef=function(){const Y=this.scoreData.getNbMeasures(),C=new xt.default,O={partIdx:this.opts.partIdx,startMeasureIdx:0,stopMeasureIdx:Y-1,staffIdx:this.opts.staffIdx,clef:W.default.copy(this.opts.clef)},B=new ht.default(this.scoreData,O,C);(0,ft.default)(B,At)};const At=function(Y){return Y instanceof g.default&&Y.type===g.default.CLEF},lt=St},441756:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(364842),v=t(551303),M=t(569860),f=t(793317),l=t(519405);const r=function(m,o,s){this.init(m,o,s)};r.NAME="composite.ForceHideMeasureVoice";const u=r.prototype;u.name=r.NAME,u.initMeasureData=f.default,u.init=function(m,o,s){this.initMeasureData(m,o),this.cancelStack=s,this.opts=o},u.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.showOtherVoiceIfNeeded(),this.hideVoice()},u.showOtherVoiceIfNeeded=function(){if(this.needShowOtherVoice()){const m=this.getOtherVoiceIdx();this.showVoice(m)}},u.needShowOtherVoice=function(){const m=this.getStaffIdx();return this.measureData.getStaffNbVoices(m)<2},u.getOtherVoiceIdx=function(){const m=this.getStaffIdx(),d=this.measureData.getScoreData().getPartStaffMapping(this.opts.partIdx)[m],h=d.voices.length;for(let e=0;e<h;e++){const i=d.voices[e];if(i!==this.opts.voiceIdx)return i}throw new g.default("Unexpected")},u.getStaffIdx=function(){return this.measureData.getScoreData().getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx)},u.showVoice=function(m){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:m},s=new v.default(this.measureData,o,this.cancelStack);(0,l.default)(s)},u.hideVoice=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},o=new M.default(this.measureData,m,this.cancelStack);(0,l.default)(o)};const c=r},443061:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("There is no repeat ending at this location."),this.name="NoEndingError"}}},447472:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(951066),v=t(882934);function M(l){return`The value [${l}] is invalid. It must be a positive float between [0 and ${v.A.MAX_DYNAMIC}].`}class f extends g.A{constructor(r){const u=M(r);super(u),Object.defineProperty(this,"dynamic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadSoundDynamicError",this.dynamic=r}}},449455:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(59153),v=t(852363),M=t(793317);const f=function(o,s,d){this.init(o,s,d)};f.NAME="composite.HideMeasureEmptyVoice";const l=f.prototype;l.name=f.NAME,l.initMeasureData=M.default,l.init=function(o,s,d){this.initMeasureData(o,s),this.cancelStack=d,this.opts=s},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeVoice(),this.updateStack()},l.removeVoice=function(){this.measureData.removeVoice(this.opts.voiceIdx)},l.updateStack=function(){const o={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(o),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const r=f,u=function(o,s,d){this.init(o,s,d)};u.NAME="composite.HideMeasureVoice";const c=u.prototype;c.name=u.NAME,c.initMeasureData=M.default,c.init=function(o,s,d){this.initMeasureData(o,s),this.cancelStack=d,this.opts=s},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearVoice(),this.removeVoice()},c.clearVoice=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,removeFloating:!1};new g.default(this.measureData,o,this.cancelStack).perform()},c.removeVoice=function(){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx};new r(this.measureData,o,this.cancelStack).perform()};const m=u},457147:(H,P,t)=>{t.d(P,{A:()=>y});var g=t(691309),v=t(793317),M=t(2110),f=t(739293),l=t(713735),r=t(519405),u=t(369790),c=t(359932),m=t(123491),o=t(724926),s=t(726042),d=t(351277),h=t(476943),e=t(852363);const i=function(A,R,W){this.init(A,R,W)};i.NAME="primitive.AddHammerOnPullOffSide";const p=i.prototype;p.name=i.NAME,p.initMeasureData=v.default,p.init=function(A,R,W){this.initMeasureData(A,R),this.opts=R,this.cancelStack=W},p.perform=function(){let R=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);R=h.default.makeArray(R);const W=R.find(this.pitchPredicate,this);m.default.addTechnical(W,this.opts.technicalType,this.opts.technicalOpts),this.updateStack()},p.pitchPredicate=function(A){const R=m.default.getPitch(A);return d.default.isSameLine(R,this.opts.pitch)},p.updateStack=function(){const A={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:d.default.copy(this.opts.pitch)}};this.cancelStack.push(A),(0,e.default)(this.cancelStack,this.measureData,this.opts)};const x=i;var S=t(925822),I=t(432456),n=t(460547),a=t(652413),D=t(805396);const T=function(A,R,W){this.init(A,R,W)};T.NAME="composite.AddHammerOnPullOff";const N=T.prototype;N.name=T.NAME,N.initMeasureData=v.default,N.init=function(A,R,W){this.initMeasureData(A,R),this.opts=R,this.cancelStack=W,this.leftNote=null,this.rightNote=null,this.crossMeasure=new g.default(this.measureData,R.voiceIdx,R.noteIdx)},N.perform=function(){this.removeTremolo(),this.opts.noSlur||this.extendOrCreateSlur(),this.addStartHammerOnPullOff(),this.addStopHammerOnPullOff()},N.removeTremolo=function(){const[A]=this.crossMeasure.getLeftChord();if(m.default.hasTremoloStart(A)){const R={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()},W=this.crossMeasure.getRightMeasure(),F=new D.default(W,R,this.cancelStack);(0,r.default)(F)}},N.extendOrCreateSlur=function(){const A=this.crossMeasure.getLeftMeasure(),R=this.getSlurEdges(A,{partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()}),W=this.crossMeasure.getRightMeasure(),F=this.getSlurEdges(W,{partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx()});F!==null&&R!==null?(this.isSameEdges(R,F)||this.removeSlur(W,F),this.extendSlur({startMeasureIdx:s.default.min2(R.startMeasureIdx,F.startMeasureIdx),startNoteIdx:s.default.min2(R.startNoteIdx,F.startNoteIdx),stopMeasureIdx:s.default.max2(R.stopMeasureIdx,F.stopMeasureIdx),stopNoteIdx:s.default.max2(R.stopNoteIdx,F.stopNoteIdx)})):F!==null||R!==null?this.extendSlur(F||R):this.addSlur(this.crossMeasure.getLeftMeasure(),{startMeasureIdx:this.crossMeasure.getLeftMeasureIdx(),startNoteIdx:this.crossMeasure.getLeftNoteIdx(),stopMeasureIdx:this.crossMeasure.getRightMeasureIdx(),stopNoteIdx:this.crossMeasure.getRightNoteIdx()})},N.getSlurEdges=function(A,R){const W=(0,M.A)(A,this.opts),F=(0,f.A)(W,R),E=(0,l.A)(W,R);return F===null||E===null?null:{startMeasureIdx:F.measureIdx,startNoteIdx:F.noteIdx,stopMeasureIdx:E.measureIdx,stopNoteIdx:E.noteIdx}},N.isSameEdges=function(A,R){return A.startMeasureIdx===R.startMeasureIdx&&A.startNoteIdx===R.startNoteIdx&&A.stopMeasureIdx===R.stopMeasureIdx&&A.stopNoteIdx===R.stopNoteIdx},N.removeSlur=function(A,R){const W={partIdx:this.opts.partIdx,measureIdx:R.startMeasureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:R.startNoteIdx},F=new S.default(A,W,this.cancelStack);F.checkPreconditions(),F.perform()},N.extendSlur=function(A){this.crossMeasure.getLeftMeasureIdx()<=A.startMeasureIdx&&this.crossMeasure.getLeftNoteIdx()<A.startNoteIdx&&this.extendSlurSide(this.crossMeasure.getLeftMeasure(),{oldMeasureIdx:A.startMeasureIdx,oldNoteIdx:A.startNoteIdx,newNoteIdx:this.crossMeasure.getLeftNoteIdx(),newMeasureIdx:this.crossMeasure.getLeftMeasureIdx()}),this.crossMeasure.getRightMeasureIdx()>=A.stopMeasureIdx&&this.crossMeasure.getRightNoteIdx()>A.stopNoteIdx&&this.extendSlurSide(this.crossMeasure.getRightMeasure(),{oldMeasureIdx:A.stopMeasureIdx,oldNoteIdx:A.stopNoteIdx,newNoteIdx:this.crossMeasure.getRightNoteIdx(),newMeasureIdx:this.crossMeasure.getRightMeasureIdx()})},N.extendSlurSide=function(A,R){const W={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,oldMeasureIdx:R.oldMeasureIdx,oldNoteIdx:R.oldNoteIdx,newNoteIdx:R.newNoteIdx,newMeasureIdx:R.newMeasureIdx},F=new I.default(A,W,this.cancelStack);F.checkPreconditions(),F.perform()},N.addSlur=function(A,R){const W={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:R.startMeasureIdx,startNoteIdx:R.startNoteIdx,stopMeasureIdx:R.stopMeasureIdx,stopNoteIdx:R.stopNoteIdx},F=new n.default(A,W,this.cancelStack);F.checkPreconditions(),F.perform()},N.addStartHammerOnPullOff=function(){const A=this.getLeftNote(),R=this.getTechnicalOpts(u.A.START);this.hasPrevious(A,R)&&this.removePrevious(A,R);const W=m.default.getPitch(A),F={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:R,pitch:d.default.copy(W)};new x(this.crossMeasure.getLeftMeasure(),F,this.cancelStack).perform()},N.hasPrevious=function(A,R){return m.default.hasTechnical(A,c.default.HAMMER_ON,R)||m.default.hasTechnical(A,c.default.PULL_OFF,R)},N.removePrevious=function(A){let R=m.default.getPitch(A);R=d.default.copy(R);const W={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),pitch:R},F=this.crossMeasure.getLeftMeasure(),E=new a.default(F,W,this.cancelStack);(0,r.default)(E)},N.addStopHammerOnPullOff=function(){const A=this.getRightNote(),R=this.getTechnicalOpts(u.A.STOP),W=m.default.getPitch(A),F={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getRightMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getRightNoteIdx(),technicalType:this.opts.technicalType,technicalOpts:R,pitch:d.default.copy(W)};new x(this.crossMeasure.getRightMeasure(),F,this.cancelStack).perform()},N.getRightNote=function(){if(this.rightNote===null){const A=this.getLeftNote(),R=this.crossMeasure.getRightChord(),W=m.default.getFretData(A);this.rightNote=R.find(this.stringPredicate,W)}return this.rightNote},N.getLeftNote=function(){if(this.leftNote===null){const A=this.crossMeasure.getLeftChord();this.leftNote=A.find(this.pitchPredicate,this)}return this.leftNote},N.pitchPredicate=function(A){const R=m.default.getPitch(A);return d.default.isSameLine(R,this.opts.pitch)},N.stringPredicate=function(A){const R=m.default.getFretData(A),W=this;return R.string===W.string},N.getTechnicalOpts=function(A){return{hammerOnPullOff:o.A.create(A)}};const y=T},458670:(H,P,t)=>{t.d(P,{A:()=>F});var g=t(746822),v=t(316610),M=t(379668),f=t(97324),l=t(606106),r=t(701387),u=t(210888),c=t(852363),m=t(364842),o=t(446921),s=t(368495);const d=function(E,U,Q){this.init(E,U,Q)};d.NAME="primitive.AddPluckedRangeSide";const h=d.prototype;h.name=d.NAME,h.init=function(E,U,Q){this.scoreData=E,this.cancelStack=Q,this.opts=U,this.pluckedRangeIdx=null,this.localTimePos=null},h.perform=function(){this.addPluckedRangeSide(),this.updateStack()},h.addPluckedRangeSide=function(){const E=this.getMeasure(),U=this.getPluckedRangeIdx(),Q=this.createPluckedRange(),G=r.default.getPluckedRanges(E,this.opts.staffIdx);G.splice(U,0,Q),r.default.setPluckedRanges(E,this.opts.staffIdx,G)},h.getPluckedRangeIdx=function(){return this.pluckedRangeIdx===null&&this.fetchPluckedRangeIdx(),this.pluckedRangeIdx},h.fetchPluckedRangeIdx=function(){const E=this.getMeasure(),U=r.default.getPluckedRanges(E,this.opts.staffIdx);if(U.some(this.tryPluckedRangeIdx,this),this.pluckedRangeIdx===null){const Q=U.length;this.pluckedRangeIdx=Q}},h.tryPluckedRangeIdx=function(E,U){const Q=this.opts.timePos,G=s.A.getTimePos(E);if(G<Q)return!1;if(G>Q)return this.pluckedRangeIdx=U,!0;{const k="There is already a octave shift at this time position.";throw new m.default("TimePosCollision",k)}},h.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},h.createPluckedRange=function(){const E=s.A.create(this.opts.staffIdx,this.opts.placement,this.opts.timePos,this.opts.type);return f.A.isStart(this.opts.type)&&typeof this.opts.pluckedRangeUuid!="undefined"&&(s.A.setPluckedRangeUuid(E,this.opts.pluckedRangeUuid),this.storePluckedRangeUuid()),E},h.storePluckedRangeUuid=function(){const E=this.scoreData.getMeasureUuid(this.opts.measureIdx),U=this.scoreData.getPartContent(this.opts.partIdx),Q={measureUuid:E,pluckedRangeUuid:this.opts.pluckedRangeUuid};o.A.addPluckedRange(U,Q)},h.updateStack=function(){const E={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(E),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const e=d;var i=t(231189);const p=function(E,U,Q){this.init(E,U,Q)};p.NAME="primitive.AddPluckedRangeContinue";const x=p.prototype;x.name=p.NAME,x.init=function(E,U,Q){this.scoreData=E,this.cancelStack=Q,this.opts=U},x.perform=function(){this.addLeftPluckedRange(),this.addRightPluckedRange(),this.updateStack()},x.addLeftPluckedRange=function(){const E=this.getLeftMeasure(),U=i.A.RIGHT,Q=this.createDirection(U);r.default.setRightPluckedRange(E,this.opts.staffIdx,Q)},x.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},x.addRightPluckedRange=function(){const E=this.getRightMeasure(),U=i.A.LEFT,Q=this.createDirection(U);r.default.setLeftPluckedRange(E,this.opts.staffIdx,Q)},x.createDirection=function(E){const U=s.A.create(this.opts.staffIdx,this.opts.placement,0,this.opts.type,E);return s.A.setPluckedRangeUuid(U,this.opts.pluckedRangeUuid),U},x.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},x.updateStack=function(){const E={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(E),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const S=p;var I=t(726042),n=t(253941),a=t(519405);const D=function(E,U,Q){this.init(E,U,Q)};D.NAME="composite.RemovePluckedRangesRange";const T=D.prototype;T.name=D.NAME,T.init=function(E,U,Q){this.scoreData=E,this.opts=U,this.cancelStack=Q,this.currentMeasureIdx=null},T.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftPluckedRanges(),this.removeLeftMeasurePluckedRanges(),this.removeMiddleMeasurePluckedRanges(),this.removeRightMeasurePluckedRanges()},T.removeLeftPluckedRanges=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;const E=this.getMeasure(this.currentMeasureIdx);let U=r.default.getPluckedRanges(E,this.opts.staffIdx);if(U=U.filter(function(Q){return this.isBeforeLimit(Q,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),U.length!==0){const Q=U.pop();N(Q)&&this.removeFromEntry(Q)}else this.hasLeftPluckedRange()&&this.removeCrossMeasurePluckedRange()},T.removeCrossMeasurePluckedRange=function(){this.removePluckedRange(0,1,this.opts.staffIdx)},T.removeLeftMeasurePluckedRanges=function(){let E=this.getPluckedRangeStarts();E=E.filter(this.isWithinLimits,this),E.forEach(this.removeFromEntry,this);let U=this.getPluckedRangesStops();U=U.filter(this.isWithinLimits,this),U.forEach(this.removeFromEntry,this)},T.removeMiddleMeasurePluckedRanges=function(){for(let E=this.opts.startMeasureIdx+1;E<this.opts.stopMeasureIdx;E++)this.currentMeasureIdx=E,this.getPluckedRangeStarts().forEach(this.removeFromEntry,this),this.getPluckedRangesStops().forEach(this.removeFromEntry,this)},T.removeRightMeasurePluckedRanges=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;let E=this.getPluckedRangeStarts();E=E.filter(this.isWithinLimits,this),E.forEach(this.removeFromEntry,this);let U=this.getPluckedRangesStops();U=U.filter(this.isWithinLimits,this),U.forEach(this.removeFromEntry,this)},T.removeFromEntry=function(E){const U=s.A.getTimePos(E),Q=s.A.getStaffIdx(E),G=this.getMeasure(this.currentMeasureIdx),k=r.default.getDpq(G);this.removePluckedRange(U,k,Q)},T.removePluckedRange=function(E,U,Q){const G={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:E,dpq:U,staffIdx:Q},k=new n.default(this.scoreData,G,this.cancelStack);(0,a.default)(k)},T.isWithinLimits=function(E){return this.currentMeasureIdx<this.opts.startMeasureIdx||this.currentMeasureIdx>this.opts.stopMeasureIdx?!1:this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx?!0:!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(E,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)||this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(E,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))},T.isAfterLimit=function(E,U,Q,G){const k=this.getMeasure(U),K=r.default.getDpq(k),_=I.default.lcm(K,G),ot=s.A.getTimePos(E)*_/K,dt=Q*_/G;return!(ot<dt)},T.isBeforeLimit=function(E,U,Q,G){const k=this.getMeasure(U),K=r.default.getDpq(k),_=I.default.lcm(K,G),ot=s.A.getTimePos(E)*_/K,dt=Q*_/G;return!(ot>dt)},T.getPluckedRangeStarts=function(){const E=this.getMeasure(this.currentMeasureIdx);let U=r.default.getPluckedRanges(E,this.opts.staffIdx);return U=U.filter(N),U};const N=function(E){const U=s.A.getType(E);return f.A.isStart(U)};T.getPluckedRangesStops=function(){const E=this.getMeasure(this.currentMeasureIdx);let U=r.default.getPluckedRanges(E,this.opts.staffIdx);return U=U.filter(y),U};const y=function(E){const U=s.A.getType(E);return f.A.isStop(U)};T.getMeasure=function(E){return this.scoreData.getMeasure(this.opts.partIdx,E)},T.hasLeftPluckedRange=function(){const E=this.getMeasure(this.currentMeasureIdx);return r.default.hasLeftPluckedRange(E,this.opts.staffIdx)};const A=D,R=function(E,U,Q){this.init(E,U,Q)};R.NAME="composite.AddPluckedRange";const W=R.prototype;W.name=R.NAME,W.init=function(E,U,Q){this.scoreData=E,this.cancelStack=Q,this.opts=U},W.perform=function(){this.removeMmr(),this.updateStartDpq(),this.updateStopDpq(),this.removeExistingPluckedRanges(),this.pluckedRangeUuid=u.default.generate(),this.cancelStack.addEntityUuid({entityType:l.A.PLUCKED_RANGE,uuid:this.pluckedRangeUuid}),this.addPluckedRangeLeftSide(),this.addPluckedRangeRightSide(),this.addPluckedRangeContinues()},W.removeMmr=function(){(0,M.A)(this.scoreData,{measureIdx:this.opts.startMeasureIdx},this.cancelStack),(0,M.A)(this.scoreData,{measureIdx:this.opts.stopMeasureIdx},this.cancelStack)},W.updateStartDpq=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new g.A(this.scoreData,E,this.cancelStack).perform();const Q=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),G={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,v.A)(G,Q),this.opts.startDpq=r.default.getDpq(Q)},W.updateStopDpq=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new g.A(this.scoreData,E,this.cancelStack).perform();const Q=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),G={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};if(this.opts.stopTimePos=(0,v.A)(G,Q),this.opts.stopDpq=r.default.getDpq(Q),this.opts.startMeasureIdx===this.opts.stopMeasureIdx){const k={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,v.A)(k,Q),this.opts.startDpq=r.default.getDpq(Q)}},W.removeExistingPluckedRanges=function(){const E={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};new A(this.scoreData,E,this.cancelStack).perform()},W.addPluckedRangeLeftSide=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size,pluckedRangeUuid:this.pluckedRangeUuid};new e(this.scoreData,E,this.cancelStack).perform()},W.addPluckedRangeRightSide=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:f.A.STOP,size:this.opts.size};new e(this.scoreData,E,this.cancelStack).perform()},W.addPluckedRangeContinues=function(){for(let E=this.opts.startMeasureIdx;E<this.opts.stopMeasureIdx;E++)this.addPluckedRangeContinue(E)},W.addPluckedRangeContinue=function(E){const U={partIdx:this.opts.partIdx,measureIdx:E,placement:this.opts.placement,staffIdx:this.opts.staffIdx,type:this.opts.type,size:this.opts.size,pluckedRangeUuid:this.pluckedRangeUuid};new S(this.scoreData,U,this.cancelStack).perform()};const F=R},465439:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(951066);function v(f){return`Ornament option ${f} is invalid.`}class M extends g.A{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadOrnamentsOptsError",this.type=l}}},470118:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(951066);function v(f){return`The value for "tempoMarkVisibility" ${f} is invalid. 
  It must be a boolean.`}class M extends g.A{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadTempoMarkVisibilityError",this.value=l}}},474620:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(189247);const v=g.A},481741:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(123491),v=t(351277),M=t(852363),f=t(578918),l=t(793317);const r=function(e,i,p){this.init(e,i,p)};r.NAME="primitive.AddFingering";const u=r.prototype;u.initMeasureData=l.default,u.name=r.NAME,u.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},u.perform=function(){this.addFingering(),this.updateStack()},u.addFingering=function(){const e=this.measureData.getVoice(this.opts.voiceIdx),i=(0,f.default)(e,this.opts.noteIdx,this.opts.pitch);g.default.setFingering(i,this.opts.fingering)},u.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,M.default)(this.cancelStack,this.measureData,this.opts)};const c=r;var m=t(909103),o=t(519405);const s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddFingering";const d=s.prototype;d.initMeasureData=l.default,d.name=s.NAME,d.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerFingering()&&this.removeFormerFingering(),this.addFingering()},d.hasFormerFingering=function(){const e=this.measureData.getVoice(this.opts.voiceIdx),i=(0,f.default)(e,this.opts.noteIdx,this.opts.pitch);return g.default.hasFingering(i)},d.removeFormerFingering=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)},i=new m.default(this.measureData,e,this.cancelStack);(0,o.default)(i)},d.addFingering=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),fingering:this.opts.fingering};new c(this.measureData,e,this.cancelStack).perform()};const h=s},483701:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("There are already glissando notations at this location."),this.name="AlreadyHasGlissandoError"}}},501167:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(436369),v=t(657107);const M=function(o,s,d){this.init(o,s,d)};M.NAME="primitive.AddEnding";const f=M.prototype;f.name=M.NAME,f.init=function(o,s,d){this.commonContent=(0,v.A)(o),this.cancelStack=d,this.opts=s},f.perform=function(){this.addEnding(),this.updateStack()},f.addEnding=function(){const o=this.opts.numbers.slice();this.commonContent.setEnding(this.opts.measureIdx,o)},f.updateStack=function(){const o=this.commonContent.getScoreData(),s=o.getNbParts(),d=this.commonContent.getNbMeasures();for(let h=0;h<s;h++){const e=this.opts.numbers.slice(),i={type:this.name,opts:{measureIdx:this.opts.measureIdx,partIdx:h,numbers:e}};if(this.cancelStack.push(i),this.opts.measureIdx>0){const p={type:`${this.name}-left`,opts:{measureIdx:this.opts.measureIdx-1,partIdx:h}};this.cancelStack.push(p)}if(this.opts.measureIdx+1<d){const p={type:`${this.name}-right`,opts:{measureIdx:this.opts.measureIdx+1,partIdx:h}};this.cancelStack.push(p)}}(0,g.A)(this.cancelStack,o,{measureIdx:this.opts.measureIdx}),this.opts.measureIdx>0&&(0,g.A)(this.cancelStack,o,{measureIdx:this.opts.measureIdx-1}),this.opts.measureIdx+1<d&&(0,g.A)(this.cancelStack,o,{measureIdx:this.opts.measureIdx+1})};const l=M;var r=t(341259);const u=function(o,s,d){this.init(o,s,d)};u.NAME="composite.AddEnding";const c=u.prototype;c.name=u.NAME,c.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerEnding()&&this.removeFormerEnding(),this.addEnding()},c.hasFormerEnding=function(){return this.scoreData.getCommonContent().hasEnding(this.opts.measureIdx)},c.removeFormerEnding=function(){const o={measureIdx:this.opts.measureIdx};new r.default(this.scoreData,o,this.cancelStack).perform()},c.addEnding=function(){const o=this.opts.numbers.slice(),s={measureIdx:this.opts.measureIdx,numbers:o};new l(this.scoreData,s,this.cancelStack).perform()};const m=u},512386:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(951066);function v(r){return`The word text [${r}] is invalid.`}class M extends g.A{constructor(u){const c=v(u);super(c),Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadDirectionWordError",this.text=u}}const f={};f.check=function(r){if(!f.isValid(r))throw new M(r)},f.isValid=function(r){return r=f.trim(r),r!==""},f.trim=function(r){return r.trim()};const l=f},513488:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(951066);function v(f){return`Barline direction value ${f} is invalid.`}class M extends g.A{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadDirectionBarlineError",this.direction=l}}},522665:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(436369);const v=function(l,r,u){this.init(l,r,u)};v.NAME="primitive.RemoveJumpTag";const M=v.prototype;M.name=v.NAME,M.init=function(l,r,u){this.scoreData=l,this.opts=r,this.cancelStack=u},M.perform=function(){this.removeTagInCommonContent(),this.updateStack()},M.removeTagInCommonContent=function(){this.getCommonContent().removeJumpTag(this.opts.measureIdx)},M.getCommonContent=function(){return this.scoreData.getCommonContent()},M.updateStack=function(){const l=this.scoreData.getNbParts();for(let r=0;r<l;r++){const u={type:this.name,opts:{partIdx:r,measureIdx:this.opts.measureIdx}};this.cancelStack.push(u)}(0,g.A)(this.cancelStack,this.scoreData,this.opts)};const f=v},526377:(H,P,t)=>{t.d(P,{A:()=>Y});var g=t(59153),v=t(711711),M=t(2110),f=t(519405);const l=function(C,O,B){this.init(C,O,B)};l.NAME="composite.ClearStaffContent";const r=l.prototype;r.name=l.NAME,r.init=function(C,O,B){this.scoreData=C,this.cancelStack=B,this.opts=O,this.measuresScroller=null},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearVoices(),this.clearFloatting()},r.clearVoices=function(){const C=this.opts.partIdx,O=this.opts.staffIdx;this.scoreData.getPartStaffVoicesIndexes(C,O).forEach(this.clearVoice,this)},r.clearVoice=function(C){const O=this.scoreData.getNbMeasures();for(let B=0;B<O;B++)this.getMeasureData(B).hasVoice(C)&&this.clearMeasureVoice(C,B)},r.clearMeasureVoice=function(C,O){const B=this.getMeasureData(O),w={partIdx:this.opts.partIdx,measureIdx:O,voiceIdx:C},$=new g.default(B,w,this.cancelStack);(0,f.default)($)},r.getMeasureData=function(C){return this.getMeasuresScroller().getMeasureData(C)},r.getMeasuresScroller=function(){if(this.measuresScroller===null){const C={partIdx:this.opts.partIdx};this.measuresScroller=(0,M.A)(this.scoreData,C)}return this.measuresScroller},r.clearFloatting=function(){const C=this.scoreData.getNbMeasures();for(let O=0;O<C;O++)this.clearMeasureFloatting(O)},r.clearMeasureFloatting=function(C){const O={partIdx:this.opts.partIdx,measureIdx:C,staffIdx:this.opts.staffIdx};new v.A(this.scoreData,O,this.cancelStack).perform()};const u=l;var c=t(446921),m=t(383279),o=t(843678);const s=function(C,O){const B=m.default.getStaffMapping(C);B[O].voices.forEach(p,C),B.splice(O,1);let $=m.default.getVoiceMapping(C);o.default.forEach($,d,O),$=o.default.map($,h,O),m.default.setVoiceMapping(C,$)},d=function(C,O,B){const w=this.valueOf();O[0]===w&&delete B[C]},h=function(C,O){const B=this.valueOf();return O=O.filter(e,B),O=O.map(i,B),O},e=function(C){const O=this.valueOf();return C!==O},i=function(C){const O=this.valueOf();return C>O?C-1:C},p=function(C){const O=this;m.default.eraseVoiceUuid(O,C)},x=s;var S=t(701387),I=t(123491);const n=function(C,O){let B=S.default.getNotes(C);B=B.filter(a,O),S.default.setNotes(C,B),B.forEach(D,O)},a=function(C){const O=this.valueOf();return I.default.getStaffIdx(C)!==O},D=function(C){const O=this.valueOf();let B=I.default.getStaffIdx(C);B>O&&(B--,I.default.setStaffIdx(C,B))},T=n;var N=t(952818),y=t(494815),A=t(473723);const R=function(C,O){const B=S.default.getNbStaves(C),w=S.default.getStaffContentMap(C);W(w,B,O),F(w,B,O),S.default.setStaffContentMap(C,w);const $=S.default.getLeftStaffMap(C);W($,B,O),E($,B,O),S.default.setLeftStaffMap(C,$);const tt=S.default.getRightStaffMap(C);W(tt,B,O),E(tt,B,O),S.default.setRightStaffMap(C,tt)},W=function(C,O,B){delete C[B];for(let w=B+1;w<O;w++)if(typeof C[w]!="undefined"){const $=C[w];delete C[w],C[w-1]=$}},F=function(C,O,B){for(let w=B;w<O-1;w++)if(typeof C[w]!="undefined"){const $=C[w];y.A.getDynamics($).forEach(U,w),y.A.getPizzicatos($).forEach(U,w),y.A.getWords($).forEach(U,w),y.A.getPedals($).forEach(U,w),y.A.getOctaveShifts($).forEach(U,w),y.A.getWedges($).forEach(U,w),y.A.getMutes($).forEach(U,w),y.A.getPluckedRanges($).forEach(U,w),y.A.getMiddleClefs($).forEach(U,w)}},E=function(C,O,B){for(let w=B;w<O-1;w++)if(typeof C[w]!="undefined"){const $=C[w];if(A.A.hasWedge($)){const tt=A.A.getWedge($);Q(tt,w)}if(A.A.hasPedal($)){const tt=A.A.getPedal($);Q(tt,w)}if(A.A.hasOctaveShift($)){const tt=A.A.getOctaveShift($);Q(tt,w)}if(A.A.hasPluckedRange($)){const tt=A.A.getPluckedRange($);Q(tt,w)}}},U=function(C){const O=this.valueOf();Q(C,O)},Q=function(C,O){N.A.setStaffIdx(C,O)},G=R;var k=t(35802);const K=function(C,O){const B=S.default.getNbStaves(C),w=S.default.getAttributes(C);_(w,B,O),S.default.setAttributes(C,w);const $=S.default.getOwnAttributes(C);_($,B,O),S.default.setOwnAttributes(C,$)},_=function(C,O,B){const w=k.default.getWrappedStaffDetails(C,O);w.removeEntry(B);const $=w.dumpAttribute();k.default.setStaffDetails(C,$);const tt=k.default.getWrappedClef(C,O);tt.removeEntry(B);const at=tt.dumpAttribute();k.default.setClef(C,at);const st=k.default.getWrappedKey(C,O);st.removeEntry(B);const ct=st.dumpAttribute();k.default.setKey(C,ct);const pt=k.default.getWrappedTime(C,O);pt.removeEntry(B);const gt=pt.dumpAttribute();k.default.setTime(C,gt);const Dt=k.default.getWrappedTranspose(C,O);Dt.removeEntry(B);const Et=Dt.dumpAttribute();k.default.setTranspose(C,Et),k.default.hasNbStaves(C)&&k.default.setNbStaves(C,O-1)},ot=K,Mt=function(C,O){T(C,O),G(C,O),ot(C,O)},j=function(C,O,B){this.init(C,O,B)};j.NAME="primitive.RemoveStaff";const J=j.prototype;J.name=j.NAME,J.init=function(C,O,B){this.scoreData=C,this.cancelStack=B,this.opts=O},J.perform=function(){this.removeStaffInPartHeader(),this.removeStaffInMeasures()},J.removeStaffInPartHeader=function(){const C=this.scoreData.getPartHeader(this.opts.partIdx);x(C,this.opts.staffIdx)},J.removeStaffInMeasures=function(){const C=this.scoreData.getPartContent(this.opts.partIdx);c.A.getMeasures(C).forEach(this.removeStaffInMeasure,this)},J.removeStaffInMeasure=function(C){Mt(C,this.opts.staffIdx)};const V=j;var z=t(721247),et=t(364596),rt=t(698649),ht=t(873010);const ft=function(C,O,B,w){xt(C,O,B,w),St(C,O,B,w)},xt=function(C,O,B,w){const $=C.getPartUuid(B),tt=C.getNbMeasures();for(let at=0;at<tt;at++){const st=C.getMeasure(B,at);let pt=S.default.getWrappedClef(st).getEntry(w);pt=z.default.copy(pt);const gt=C.getMeasureUuids(at,at),Dt={type:rt.default.NAME,noDraw:!0,opts:{partUuid:$,measureUuids:gt,staffIdx:w,previousClef:pt,newClef:null}};O.push(Dt)}},St=function(C,O,B,w){const $=C.getPartUuid(B),tt=C.getNbMeasures();for(let at=0;at<tt;at++){const st=C.getMeasure(B,at);let pt=S.default.getWrappedKey(st).getEntry(w);pt=et.default.copy(pt);const gt=C.getMeasureUuids(at,at),Dt={type:ht.default.NAME,noDraw:!0,opts:{partUuid:$,measureUuids:gt,staffIdx:w,previousKey:pt,newKey:null}};O.push(Dt)}},Pt=ft,At=function(C,O,B){this.init(C,O,B)};At.NAME="action.RemoveStaff";const lt=At.prototype;lt.name=At.NAME,lt.init=function(C,O,B){this.scoreData=C,this.cancelStack=B,this.opts=O},lt.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearStaffContent(),this.logStaffAttributes(),this.removeStaff()},lt.clearStaffContent=function(){const C={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx};new u(this.scoreData,C,this.cancelStack).perform()},lt.logStaffAttributes=function(){const C=this.opts.partIdx,O=this.opts.staffIdx;Pt(this.scoreData,this.cancelStack,C,O)},lt.removeStaff=function(){const C={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx};new V(this.scoreData,C,this.cancelStack).perform()};const Y=At},546201:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(129283),v=t(351277);function M(l){const r=l.map(f);return[].concat(...r)}function f(l){const r=v.default.copyWithoutAlter(l.leftPitch);r.noteIdx=l.noteIdx,r.number=l.number,r.glissandoType=g.default.START;const u=v.default.copyWithoutAlter(l.rightPitch);return u.noteIdx=l.noteIdx+1,u.number=l.number,u.glissandoType=g.default.STOP,[r,u]}},550006:(H,P,t)=>{t.d(P,{A:()=>p});var g=t(123491),v=t(351277),M=t(860716),f=t(793317),l=t(578918),r=t(852363);const u=function(x,S,I){this.init(x,S,I)};u.NAME="primitive.AddHarmonic";const c=u.prototype;c.name=u.NAME,c.initMeasureData=f.default,c.init=function(x,S,I){this.initMeasureData(x,S),this.cancelStack=I,this.opts=S},c.perform=function(){this.addHarmonic(),this.updateStack()},c.addHarmonic=function(){const x=this.measureData.getVoice(this.opts.voiceIdx),S=(0,l.default)(x,this.opts.noteIdx,this.opts.pitch),I=M.default.create(this.opts.type);g.default.setHarmonic(S,I)},c.updateStack=function(){const x={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(x),(0,r.default)(this.cancelStack,this.measureData,this.opts)};const m=u;var o=t(165259),s=t(298009),d=t(519405),h=t(955154);const e=function(x,S,I){this.init(x,S,I)};e.NAME="composite.AddHarmonic";const i=e.prototype;i.initMeasureData=f.default,i.name=e.NAME,i.init=function(x,S,I){this.initMeasureData(x,S),this.cancelStack=I,this.opts=S},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerHarmonic()&&this.removeFormerHarmonic(),this.hasTab()&&(this.opts.type===h.default.ARTIFICIAL_TOUCHING||this.opts.type===h.default.NATURAL_SOUNDING)&&this.removeTabData(),this.addHarmonic()},i.hasFormerHarmonic=function(){const x=this.measureData.getVoice(this.opts.voiceIdx),S=(0,l.default)(x,this.opts.noteIdx,this.opts.pitch);return g.default.hasHarmonic(S)},i.removeFormerHarmonic=function(){const x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch)},S=new o.default(this.measureData,x,this.cancelStack);(0,d.default)(S)},i.hasTab=function(){const x=this.measureData.getVoice(this.opts.voiceIdx),S=(0,l.default)(x,this.opts.noteIdx,this.opts.pitch);return g.default.hasFretData(S)},i.removeTabData=function(){const x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),fretData:null,record:!0},S=new s.default(this.measureData,x,this.cancelStack);(0,d.default)(S)},i.addHarmonic=function(){const x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:v.default.copy(this.opts.pitch),type:this.opts.type};new m(this.measureData,x,this.cancelStack).perform()};const p=e},554097:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(632879),v=t(476943),M=t(351277),f=t(123491);const l=function(m,o,s){const d=m.getNbNotes();for(let h=0;h<d;h++){const e=r(m,h);u(e,o,s)}},r=function(m,o){if(m.isRest(o))return[];{const s=m.getChord(o);return v.default.makeArray(s)}},u=function(m,o,s){const h=m.map(f.default.getPitch).find(function(e){return M.default.willOverflow(e,o,s)});if(typeof h!="undefined")throw new g.A(h,o)},c=l},556595:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(764150),v=t(110976);const M=function(r,u,c){this.init(r,u,c)};M.NAME="composite.SetTempoMain";const f=M.prototype;f.name=M.NAME,f.init=function(r,u,c){this.scoreData=r,this.cancelStack=c,this.opts=u,this.tempo=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const r=this.opts.startMeasureIdx,u=this.opts.stopMeasureIdx;for(let c=r;c<=u;c++){const m=this.scoreData.getRealTempo(c);this.addTempo(m,c)}this.finishSegment()},f.addTempo=function(r,u){this.hasOngoing()?this.isSameTempo(r)?this.continueSegment(u):(this.finishSegment(),this.startSegment(r,u)):this.startSegment(r,u)},f.hasOngoing=function(){return this.tempo!==null},f.startSegment=function(r,u){this.tempo=r,this.startMeasureIdx=u,this.stopMeasureIdx=u},f.isSameTempo=function(r){return v.default.isSame(this.tempo,r)},f.continueSegment=function(r){this.stopMeasureIdx=r},f.finishSegment=function(){v.default.isSame(this.tempo,this.opts.tempo)||this.setTempoSegment(this.startMeasureIdx,this.stopMeasureIdx),this.tempo=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},f.setTempoSegment=function(r,u){const c=v.default.copy(this.opts.tempo),m={startMeasureIdx:r,stopMeasureIdx:u,tempo:c},o=new g.default(this.scoreData,m,this.cancelStack);o.checkPreconditions(),o.perform()};const l=M},564748:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(377180),v=t(351277);const M=function(r,u){return g.default.isIdentity(u)||(u=g.default.getReverse(u),u=g.default.getReverse(u),r=r.map(f,u)),r},f=function(r){const u=this;return v.default.transpose(r,u,!0)},l=M},566178:(H,P,t)=>{t.d(P,{A:()=>I});var g=t(764173);const v=function(n,a,D){this.init(n,a,D)};v.NAME="composite.UpdateRangeOwnTempo";const M=v.prototype;M.name=v.NAME,M.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},M.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let n=this.opts.startMeasureIdx;n<=this.opts.stopMeasureIdx;n++)this.updateMeasureTempo(n);this.hasMeasureAfter()&&this.updateMeasureTempo(this.opts.stopMeasureIdx+1)},M.hasMeasureAfter=function(){const n=this.scoreData.getNbMeasures();return this.opts.stopMeasureIdx+1<n},M.updateMeasureTempo=function(n){const a={measureIdx:n};new g.A(this.scoreData,a,this.cancelStack).perform()};const f=v;var l=t(110976),r=t(436369),u=t(657107);const c=function(n,a,D){this.init(n,a,D)};c.NAME="primitive.SetTempo";const m=c.prototype;m.name=c.NAME,m.init=function(n,a,D){this.commonContent=(0,u.A)(n),this.cancelStack=D,this.opts=a},m.perform=function(){this.setTempo(),this.updateStack()},m.setTempo=function(){const n=l.default.copy(this.opts.tempo);this.commonContent.setTempo(this.opts.measureIdx,n)},m.updateStack=function(){const n={type:this.name,noDraw:!0,opts:{measureIdx:this.opts.measureIdx}};this.cancelStack.push(n),(0,r.A)(this.cancelStack,this.commonContent.getScoreData(),this.opts)};const o=c,s=function(n,a,D){this.init(n,a,D)};s.NAME="composite.SetTempoIfNeeded";const d=s.prototype;d.name=s.NAME,d.init=function(n,a,D){this.commonContent=(0,u.A)(n,a),this.cancelStack=D,this.opts=a},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needSetTempo()&&this.setTempo()},d.needSetTempo=function(){const n=this.commonContent.getTempo(this.opts.measureIdx);return!l.default.isSame(n,this.opts.tempo)},d.setTempo=function(){const n={measureIdx:this.opts.measureIdx,tempo:l.default.copy(this.opts.tempo)};new o(this.commonContent,n,this.cancelStack).perform()};const h=s,e=function(n,a,D){this.init(n,a,D)};e.NAME="composite.SetRangeTempo";const i=e.prototype;i.name=e.NAME,i.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);for(let n=this.opts.startMeasureIdx;n<=this.opts.stopMeasureIdx;n++)this.setTempo(n)},i.setTempo=function(n){const a=l.default.copy(this.opts.tempo),D={measureIdx:n,tempo:a};new h(this.scoreData,D,this.cancelStack).perform()};const p=e,x=function(n,a,D){this.init(n,a,D)};x.NAME="composite.SetTempoSegment";const S=x.prototype;S.name=x.NAME,S.init=function(n,a,D){this.scoreData=n,this.cancelStack=D,this.opts=a},S.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.setTempo(),this.updateOwnTempo()},S.setTempo=function(){const n=l.default.copy(this.opts.tempo),a={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,tempo:n};new p(this.scoreData,a,this.cancelStack).perform()},S.updateOwnTempo=function(){const n={startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx};new f(this.scoreData,n,this.cancelStack).perform()};const I=x},567198:(H,P,t)=>{t.d(P,{A:()=>F});var g=t(746822),v=t(316610),M=t(379668),f=t(372585),l=t(606106),r=t(701387),u=t(210888),c=t(364842),m=t(446921),o=t(345912),s=t(852363);const d=function(E,U,Q){this.init(E,U,Q)};d.NAME="primitive.AddOctaveShift";const h=d.prototype;h.name=d.NAME,h.init=function(E,U,Q){this.scoreData=E,this.cancelStack=Q,this.opts=U,this.octaveShiftIdx=null,this.localTimePos=null},h.perform=function(){this.addOctaveShift(),this.updateStack()},h.addOctaveShift=function(){const E=this.getMeasure();this.insertedOctaveShift=this.createOctaveShift();const U=this.getOctaveShiftIdx(),Q=r.default.getOctaveShifts(E,this.opts.staffIdx);Q.splice(U,0,this.insertedOctaveShift),r.default.setOctaveShifts(E,this.opts.staffIdx,Q)},h.getOctaveShiftIdx=function(){return this.octaveShiftIdx===null&&this.fetchOctaveShiftIdx(),this.octaveShiftIdx},h.fetchOctaveShiftIdx=function(){const E=this.getMeasure(),U=r.default.getOctaveShifts(E,this.opts.staffIdx);if(U.some(this.tryOctaveShiftIdx,this),this.octaveShiftIdx===null){const Q=U.length;this.octaveShiftIdx=Q}},h.tryOctaveShiftIdx=function(E,U){const Q=o.A.compare(this.insertedOctaveShift,E);if(Q<0)return this.octaveShiftIdx=U,!0;if(Q>0)return!1;if(Q===0){const G="There is already a octave shift at this time position.";throw new c.default("TimePosCollision",G)}else throw new c.default("Unexpected")},h.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},h.createOctaveShift=function(){const E=o.A.create(this.opts.staffIdx,this.opts.placement,this.opts.timePos,this.opts.type,this.opts.size);return f.A.isStart(this.opts.type)&&typeof this.opts.octaveShiftUuid!="undefined"&&(o.A.setOctaveShiftUuid(E,this.opts.octaveShiftUuid),this.storeOctaveShiftUuid()),E},h.storeOctaveShiftUuid=function(){const E=this.scoreData.getMeasureUuid(this.opts.measureIdx),U=this.scoreData.getPartContent(this.opts.partIdx),Q={measureUuid:E,octaveShiftUuid:this.opts.octaveShiftUuid};m.A.addOctaveShift(U,Q)},h.updateStack=function(){const E=this.getMeasure(),U=r.default.getDivisions(E),Q={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:U,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size}};this.cancelStack.push(Q),(0,s.default)(this.cancelStack,this.scoreData,this.opts)};const e=d;var i=t(258780);const p=function(E,U,Q){this.init(E,U,Q)};p.NAME="primitive.AddOctaveShiftContinue";const x=p.prototype;x.name=p.NAME,x.init=function(E,U,Q){this.scoreData=E,this.cancelStack=Q,this.opts=U},x.perform=function(){this.addLeftOctaveShift(),this.addRightOctaveShift(),this.updateStack()},x.addLeftOctaveShift=function(){const E=this.getLeftMeasure(),U=i.A.RIGHT,Q=this.createDirection(U);r.default.setRightOctaveShift(E,this.opts.staffIdx,Q)},x.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},x.addRightOctaveShift=function(){const E=this.getRightMeasure(),U=i.A.LEFT,Q=this.createDirection(U);r.default.setLeftOctaveShift(E,this.opts.staffIdx,Q)},x.createDirection=function(E){const U=o.A.create(this.opts.staffIdx,this.opts.placement,0,this.opts.type,this.opts.size,E);return o.A.setOctaveShiftUuid(U,this.opts.octaveShiftUuid),U},x.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},x.updateStack=function(){const E={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size}};this.cancelStack.push(E),(0,s.default)(this.cancelStack,this.scoreData,this.opts)};const S=p;var I=t(726042),n=t(933516),a=t(519405);const D=function(E,U,Q){this.init(E,U,Q)};D.NAME="composite.RemoveOctaveShiftsRange";const T=D.prototype;T.name=D.NAME,T.init=function(E,U,Q){this.scoreData=E,this.opts=U,this.cancelStack=Q,this.currentMeasureIdx=null},T.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftOctaveShifts(),this.removeLeftMeasureOctaveShifts(),this.removeMiddleMeasureOctaveShifts(),this.removeRightMeasureOctaveShifts()},T.removeLeftOctaveShifts=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;const E=this.getMeasure(this.currentMeasureIdx);let U=r.default.getOctaveShifts(E,this.opts.staffIdx);if(U=U.filter(function(Q){return this.isBeforeLimit(Q,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),U.length!==0){const Q=U.pop();N(Q)&&this.removeFromEntry(Q)}else this.hasLeftOctaveShift()&&this.removeCrossMeasureOctaveShift()},T.removeCrossMeasureOctaveShift=function(){this.removeOctaveShift(0,1,this.opts.staffIdx)},T.removeLeftMeasureOctaveShifts=function(){let E=this.getOctaveShiftStarts();E=E.filter(this.isWithinLimits,this),E.forEach(this.removeFromEntry,this);let U=this.getOctaveShiftsStops();U=U.filter(this.isWithinLimits,this),U.forEach(this.removeFromEntry,this)},T.removeMiddleMeasureOctaveShifts=function(){for(let E=this.opts.startMeasureIdx+1;E<this.opts.stopMeasureIdx;E++)this.currentMeasureIdx=E,this.getOctaveShiftStarts().forEach(this.removeFromEntry,this),this.getOctaveShiftsStops().forEach(this.removeFromEntry,this)},T.removeRightMeasureOctaveShifts=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;let E=this.getOctaveShiftStarts();E=E.filter(this.isWithinLimits,this),E.forEach(this.removeFromEntry,this);let U=this.getOctaveShiftsStops();U=U.filter(this.isWithinLimits,this),U.forEach(this.removeFromEntry,this)},T.removeFromEntry=function(E){const U=o.A.getTimePos(E),Q=o.A.getStaffIdx(E),G=this.getMeasure(this.currentMeasureIdx),k=r.default.getDpq(G);this.removeOctaveShift(U,k,Q)},T.removeOctaveShift=function(E,U,Q){const G={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:E,dpq:U,staffIdx:Q,transpose:this.opts.transposeOverrided,preserveTies:this.opts.preserveOverridedTies,updateGraces:this.opts.updateOverridedGraces,preserveColor:this.opts.preserveColor},k=new n.default(this.scoreData,G,this.cancelStack);(0,a.default)(k)},T.isWithinLimits=function(E){return this.currentMeasureIdx<this.opts.startMeasureIdx||this.currentMeasureIdx>this.opts.stopMeasureIdx?!1:this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx?!0:!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(E,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)||this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(E,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))},T.isAfterLimit=function(E,U,Q,G){const k=this.getMeasure(U),K=r.default.getDpq(k),_=I.default.lcm(K,G),ot=o.A.getTimePos(E)*_/K,dt=Q*_/G;return!(ot<dt||ot===dt&&o.A.isStop(E))},T.isBeforeLimit=function(E,U,Q,G){const k=this.getMeasure(U),K=r.default.getDpq(k),_=I.default.lcm(K,G),ot=o.A.getTimePos(E)*_/K,dt=Q*_/G;return!(ot>dt||ot===dt&&o.A.isStart(E))},T.getOctaveShiftStarts=function(){const E=this.getMeasure(this.currentMeasureIdx);let U=r.default.getOctaveShifts(E,this.opts.staffIdx);return U=U.filter(N),U};const N=function(E){const U=o.A.getType(E);return U===f.A.UP||U===f.A.DOWN};T.getOctaveShiftsStops=function(){const E=this.getMeasure(this.currentMeasureIdx);let U=r.default.getOctaveShifts(E,this.opts.staffIdx);return U=U.filter(y),U};const y=function(E){return o.A.getType(E)===f.A.STOP};T.getMeasure=function(E){return this.scoreData.getMeasure(this.opts.partIdx,E)},T.hasLeftOctaveShift=function(){const E=this.getMeasure(this.currentMeasureIdx);return r.default.hasLeftOctaveShift(E,this.opts.staffIdx)};const A=D,R=function(E,U,Q){this.init(E,U,Q)};R.NAME="composite.AddOctaveShift";const W=R.prototype;W.name=R.NAME,W.init=function(E,U,Q){this.scoreData=E,this.cancelStack=Q,this.opts=U},W.perform=function(){this.removeMmr(),this.updateStartDpq(),this.updateStopDpq(),this.removeExistingOctaveShifts(),this.octaveShiftUuid=u.default.generate(),this.cancelStack.addEntityUuid({entityType:l.A.OCTAVE_SHIFT,uuid:this.octaveShiftUuid}),this.addOctaveShiftLeftSide(),this.addOctaveShiftRightSide(),this.addOctaveShiftContinues()},W.removeMmr=function(){(0,M.A)(this.scoreData,{measureIdx:this.opts.startMeasureIdx},this.cancelStack),(0,M.A)(this.scoreData,{measureIdx:this.opts.stopMeasureIdx},this.cancelStack)},W.updateStartDpq=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new g.A(this.scoreData,E,this.cancelStack).perform();const Q=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),G={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,v.A)(G,Q),this.opts.startDpq=r.default.getDpq(Q)},W.updateStopDpq=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new g.A(this.scoreData,E,this.cancelStack).perform();const Q=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),G={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};if(this.opts.stopTimePos=(0,v.A)(G,Q),this.opts.stopDpq=r.default.getDpq(Q),this.opts.startMeasureIdx===this.opts.stopMeasureIdx){const k={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,v.A)(k,Q),this.opts.startDpq=r.default.getDpq(Q)}},W.removeExistingOctaveShifts=function(){const E={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq,transposeOverrided:this.opts.transposeOverrided,preserveOverridedTies:this.opts.preserveOverridedTies,updateOverridedGraces:this.opts.updateOverridedGraces,preserveColor:this.opts.preserveColor};new A(this.scoreData,E,this.cancelStack).perform()},W.addOctaveShiftLeftSide=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type,size:this.opts.size,octaveShiftUuid:this.octaveShiftUuid};new e(this.scoreData,E,this.cancelStack).perform()},W.addOctaveShiftRightSide=function(){const E={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:f.A.STOP,size:this.opts.size};new e(this.scoreData,E,this.cancelStack).perform()},W.addOctaveShiftContinues=function(){for(let E=this.opts.startMeasureIdx;E<this.opts.stopMeasureIdx;E++)this.addOctaveShiftContinue(E)},W.addOctaveShiftContinue=function(E){const U={partIdx:this.opts.partIdx,measureIdx:E,placement:this.opts.placement,staffIdx:this.opts.staffIdx,type:this.opts.type,size:this.opts.size,octaveShiftUuid:this.octaveShiftUuid};new S(this.scoreData,U,this.cancelStack).perform()};const F=R},574023:(H,P,t)=>{t.d(P,{A:()=>n});var g=t(364842),v=t(726042),M=t(210888),f=t(701387),l=t(606106),r=t(496819),u=t(316610),c=t(852363);const m=function(a,D,T){this.init(a,D,T)};m.NAME="primitive.AddDynamic";const o=m.prototype;o.name=m.NAME,o.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D,this.measure=null,this.dynamicIdx=null,this.localTimePos=null},o.perform=function(){this.addDynamic(),this.updateStack()},o.addDynamic=function(){const a=this.getMeasure(),D=this.getDynamicIdx(),T=this.createDynamic(),N=f.default.getDynamics(a,this.opts.staffIdx);N.splice(D,0,T),f.default.setDynamics(a,this.opts.staffIdx,N)},o.getDynamicIdx=function(){return this.dynamicIdx===null&&this.fetchDynamicIdx(),this.dynamicIdx},o.fetchDynamicIdx=function(){const a=this.getMeasure(),D=f.default.getDynamics(a,this.opts.staffIdx);if(D.some(this.tryDynamicIdx,this),this.dynamicIdx===null){const T=D.length;this.dynamicIdx=T}},o.tryDynamicIdx=function(a,D){const T=this.getLocalTimePos(),N=r.A.getTimePos(a);if(N<T)return!1;if(N>T)return this.dynamicIdx=D,!0;{const y="There is already an dynamic at this time position.";throw new g.default("TimePosCollision",y)}},o.createDynamic=function(){const a=this.getLocalTimePos(),D=r.A.create(this.opts.staffIdx,this.opts.placement,a,this.opts.style,this.opts.sound),T=M.default.generate();return this.cancelStack.addEntityUuid({entityType:l.A.DYNAMICS,uuid:T}),r.A.setDynamicUuid(D,T),D},o.getLocalTimePos=function(){if(this.localTimePos===null){const a=this.getMeasure();if(this.localTimePos=(0,u.A)(this.opts,a),!v.default.isInteger(this.localTimePos)){const D=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new g.default("IntegerExpected",D)}}return this.localTimePos},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},o.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const s=m;var d=t(746822),h=t(379668);const e=function(a,D,T){this.init(a,D,T)};e.NAME="composite.AddDynamic";const i=e.prototype;i.name=e.NAME,i.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},i.perform=function(){this.removeMmr(),this.updateDpq(),this.addDynamic()},i.removeMmr=function(){(0,h.A)(this.scoreData,this.opts,this.cancelStack)},i.updateDpq=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new d.A(this.scoreData,a,this.cancelStack).perform()},i.addDynamic=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:this.opts.sound};new s(this.scoreData,a,this.cancelStack).perform()};const p=e;var x=t(275225);const S=function(a,D,T){this.init(a,D,T)};S.NAME="composite.AddDynamicErase";const I=S.prototype;I.name=S.NAME,I.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},I.perform=function(){this.removeFormerDynamic(),this.addDynamic()},I.removeFormerDynamic=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new x.default(this.scoreData,a,this.cancelStack).performIfPossible()},I.addDynamic=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,style:this.opts.style,sound:this.opts.sound};new p(this.scoreData,a,this.cancelStack).perform()};const n=S},582711:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(951066);class v extends g.A{constructor(l){const r=M(l);super(r),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BadGlissandoNumberError"}),Object.defineProperty(this,"number",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.number=l}}const M=function(f){return`The glissando number value [${f}] is invalid and should be a number greater than 0.`}},583443:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(569445),v=t(476943),M=t(351277),f=t(123491);const l=function(m,o,s,d){const h=m.getNbNotes();for(let e=0;e<h;e++){const i=r(m,e);u(i,o,s,d)}},r=function(m,o){if(m.isRest(o))return[];{const s=m.getChord(o);return v.default.makeArray(s)}},u=function(m,o,s,d){m.forEach(function(h){const e=f.default.getStaffIdx(h),i=s.getEntry(e),p=f.default.getPitch(h),x=M.default.transpose(p,o,d),S=M.default.pitchToLine(x,i);if(S<M.default.MIN_LINE||S>M.default.MAX_LINE)throw new g.A(S)})},c=l},586142:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(476943),v=t(123491),M=t(351277),f=t(852363),l=t(793317);const r=function(I,n,a){this.init(I,n,a)};r.NAME="primitive.InsertGraceNote";const u=r.prototype;u.name=r.NAME,u.initMeasureData=l.default,u.init=function(I,n,a){this.initMeasureData(I,n),this.cancelStack=a,this.opts=n},u.perform=function(){const I=this.getVoice(),n=this.createNote(I);I.insertGrace(n,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},u.getVoice=function(){const I=this.opts.voiceIdx;return this.measureData.getVoice(I)},u.createNote=function(I){const n={};v.default.makeGrace(n),v.default.setStaffIdx(n,this.opts.staffIdx),v.default.setVoiceIdx(n,this.opts.voiceIdx),v.default.setDurationType(n,this.opts.durationType);const a=M.default.copy(this.opts.pitch);v.default.setPitch(n,a),this.opts.accidental!==null&&v.default.setAccidental(n,this.opts.accidental);const D=I.getRangeSpace(0,this.opts.noteIdx);return v.default.setTimePos(n,D),n},u.updateStack=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},n={type:this.name,opts:I};this.cancelStack.push(n),(0,f.default)(this.cancelStack,this.measureData,this.opts)};const c=r;var m=t(414208),o=t(200665),s=t(561262),d=t(536680),h=t(576363),e=t(519405),i=t(534512);const p=function(I,n,a){this.init(I,n,a)};p.NAME="composite.InsertGraceNote";const x=p.prototype;x.name=p.NAME,x.initMeasureData=l.default,x.init=function(I,n,a){this.initMeasureData(I,n),this.cancelStack=a,this.opts=n},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeTie(),this.removeLeftSlides(),this.opts.removeGlissandos&&this.removeLeftGlissandos(),this.insertGraceNote(),this.isTabStaff()&&this.setFretAction(),this.updateAccidental()},x.removeTie=function(){let n=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);if(n=g.default.makeArray(n),!n.some(v.default.hasTieStop))return;const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},D=new m.default(this.measureData,a,this.cancelStack);(0,e.default)(D)},x.removeLeftSlides=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new d.A(this.measureData,I,this.cancelStack).perform()},x.removeLeftGlissandos=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new h.A(this.measureData,I,this.cancelStack).perform()},x.insertGraceNote=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,durationType:this.opts.durationType,pitch:M.default.copy(this.opts.pitch),accidental:null};new c(this.measureData,I,this.cancelStack).perform()},x.isTabStaff=function(){return(0,i.default)(this.measureData,this.opts)},x.setFretAction=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:M.default.copy(this.opts.pitch),fretData:this.opts.fretData,sameStringAsPreviousNotes:this.opts.sameStringAsPreviousNotes};new o.default(this.measureData,I,this.cancelStack).performIfPossible()},x.updateAccidental=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.opts.noteIdx,graceIdx:this.opts.graceIdx,pitch:M.default.copy(this.opts.pitch)};new s.A(this.measureData,I,this.cancelStack).perform()};const S=p},597003:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(364842),v=t(726042),M=t(123491),f=t(209175),l=t(726800),r=t(27912);const u=function(s,d){new c(s,d).process()},c=function(s,d){this.init(s,d)},m=c.prototype;m.init=function(s,d){this.measureData=s,this.opts=d,this.coeff=null},m.process=function(){this.hasTimePos()&&(this.checkHasTimeModif(),this.checkHasDivisions(),this.adaptTimePos(),this.hasTimePosExactNoteIdx()&&(this.convertTimePosToNoteIdx(),this.shouldInitTuplet()&&this.initTupletCache()))},m.hasTimePos=function(){return typeof this.opts.timePos!="undefined"},m.checkHasTimeModif=function(){if(typeof this.opts.timeModif=="undefined"){const s="There should be a timeModif when there is a timePos value.";throw new g.default("Unexpected",s)}},m.checkHasDivisions=function(){if(typeof this.opts.divisions=="undefined"){const s="There should be a divisions value when there is a timePos value.";throw new g.default("Unexpected",s)}},m.adaptTimePos=function(){const s=this.measureData.getDivisions().getDivisions(),d=v.default.lcm(s,this.opts.divisions),h=d/s,e=d/this.opts.divisions;this.opts.timePos*=e,this.opts.divisions*=e,this.coeff=h},m.hasTimePosExactNoteIdx=function(){const s=this.getVoice();return(0,l.A)(s,this.coeff,this.opts.timePos)},m.convertTimePosToNoteIdx=function(){const s=this.getVoice();this.opts.noteIdx=(0,r.A)(s,this.coeff,this.opts.timePos),delete this.opts.timePos,delete this.opts.divisions},m.shouldInitTuplet=function(){const d=this.getVoice().getNote(this.opts.noteIdx);return M.default.hasTupletStart(d)&&f.default.isNormal(this.opts.timeModif)},m.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},m.initTupletCache=function(){this.measureData.initTupletCacheWithVoice(this.opts.voiceIdx)};const o=u},604021:(H,P,t)=>{t.d(P,{A:()=>T});var g=t(737903),v=t(364842),M=t(701387),f=t(589501),l=t(726042),r=t(210888),u=t(606106),c=t(316610),m=t(852363);const o=function(N,y,A){this.init(N,y,A)};o.NAME="primitive.AddFiguredBass";const s=o.prototype;s.name=o.NAME,s.init=function(N,y,A){this.scoreData=N,this.cancelStack=A,this.opts=y,this.measure=null,this.figuredBassIdx=null,this.localTimePos=null},s.perform=function(){const N=this.getFiguredBassIdx(),y=this.createFiguredBass();this.addFiguredBass(y,N),this.updateStack()},s.getFiguredBassIdx=function(){return this.figuredBassIdx===null&&this.fetchFiguredBassIdx(),this.figuredBassIdx},s.fetchFiguredBassIdx=function(){const N=this.getMeasure(),y=M.default.getFiguredBasses(N);if(y.some(this.tryFiguredBassIdx,this),this.figuredBassIdx===null){const A=y.length;this.figuredBassIdx=A}},s.tryFiguredBassIdx=function(N,y){const A=this.getLocalTimePos(),R=f.A.getTimePos(N);if(R<A)return!1;if(R>A)return this.figuredBassIdx=y,!0;{const W="There is already a figured bass at this time position.";throw new v.default("TimePosCollision",W)}},s.createFiguredBass=function(){const N=f.A.create(this.opts.figuresData),y=this.getLocalTimePos();f.A.setTimePos(N,y);const A=this.getUuid();return this.cancelStack.addEntityUuid({entityType:u.A.FIGURED_BASS,uuid:A}),f.A.setUuid(N,A),N},s.getUuid=function(){return typeof this.opts.uuid=="string"&&r.default.isValid(this.opts.uuid)?this.opts.uuid:r.default.generate()},s.addFiguredBass=function(N,y){const A=this.getMeasure(),R=M.default.getFiguredBasses(A);R.splice(y,0,N),M.default.setFiguredBasses(A,R)},s.updateStack=function(){const N={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(N),(0,m.default)(this.cancelStack,this.scoreData,this.opts)},s.getDpq=function(){const N=this.getMeasure();return M.default.getDpq(N)},s.getLocalTimePos=function(){if(this.localTimePos===null){const N=this.getMeasure();if(this.localTimePos=(0,c.A)(this.opts,N),!l.default.isInteger(this.localTimePos)){const y=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new v.default("IntegerExpected",y)}}return this.localTimePos},s.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const d=o;var h=t(746822),e=t(379668);const i=function(N,y,A){this.init(N,y,A)};i.NAME="composite.AddFiguredBass";const p=i.prototype;p.name=i.NAME,p.init=function(N,y,A){this.scoreData=N,this.cancelStack=A,this.opts=y},p.perform=function(){this.removeMmr(),this.updateDpq(),this.addFiguredBass()},p.removeMmr=function(){(0,e.A)(this.scoreData,this.opts,this.cancelStack)},p.updateDpq=function(){const N={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new h.A(this.scoreData,N,this.cancelStack).perform()},p.addFiguredBass=function(){const N=(0,g.default)(this.opts.figuresData),y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,figuresData:N,uuid:this.opts.uuid};new d(this.scoreData,y,this.cancelStack).perform()};const x=i;var S=t(886723),I=t(519405);const n=function(N,y,A){this.init(N,y,A)};n.NAME="composite.AddFiguredBassErase";const a=n.prototype;a.name=n.NAME,a.init=function(N,y,A){this.scoreData=N,this.cancelStack=A,this.opts=y,this.uuid=null},a.perform=function(){this.removeFormerFiguredBass(),this.addFiguredBass()},a.removeFormerFiguredBass=function(){const N=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),y=M.default.getFiguredBasses(N),A=(0,c.A)(this.opts,N),R=y.find(D,A);if(R){this.uuid=f.A.getUuid(R);const W={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},F=new S.default(this.scoreData,W,this.cancelStack);(0,I.default)(F)}};function D(N){const y=this.valueOf();return f.A.getTimePos(N)===y}a.addFiguredBass=function(){const N=(0,g.default)(this.opts.figuresData),y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,figuresData:N};this.uuid!==null&&(y.uuid=this.uuid),new x(this.scoreData,y,this.cancelStack).perform()};const T=n},604088:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(476943),v=t(737903),M=t(123491),f=t(351277),l=t(967104),r=t(793317),u=t(575349),c=t(852363);const m=function(I,n,a){this.init(I,n,a)};m.NAME="primitive.AddBend";const o=m.prototype;o.name=m.NAME,o.initMeasureData=r.default,o.init=function(I,n,a){this.initMeasureData(I,n),this.cancelStack=a,this.opts=n,this.note=null},o.perform=function(){this.addBend(),this.updateStack(),this.isTiedWithNextMeasure()&&this.signalNextMeasure()},o.addBend=function(){const I=this.getNote(),n=l.A.create(this.opts.type,this.opts.alter);M.default.setBend(I,n)},o.updateStack=function(){const I={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(I),(0,c.default)(this.cancelStack,this.measureData,this.opts)},o.isTiedWithNextMeasure=function(){const I=this.measureData.getVoice(this.opts.voiceIdx);if(this.opts.noteIdx+1<I.getNbNotes())return!1;const n=this.getNote();return M.default.hasTieStart(n)},o.getNote=function(){if(this.note===null){let n=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);n=g.default.makeArray(n),this.note=n.find(u.A,this.opts)}return this.note},o.signalNextMeasure=function(){const I=this.opts.measureIdx+1,n={type:`${this.name}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:I}};this.cancelStack.push(n),(0,c.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:I})};const s=m;var d=t(330179),h=t(679676),e=t(519405),i=t(691309);const p=function(I,n,a){this.init(I,n,a)};p.NAME="composite.AddBend";const x=p.prototype;x.initMeasureData=r.default,x.name=p.NAME,x.init=function(I,n,a){this.initMeasureData(I,n),this.cancelStack=a,this.opts=n,this.note=null},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerBend()&&this.removeFormerBend(),this.hasTie()&&this.hasPreBend()&&this.removeTie(),this.addBend()},x.hasFormerBend=function(){const I=this.getNote();return M.default.hasBend(I)},x.getNote=function(){if(this.note===null){let n=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);n=g.default.makeArray(n),this.note=n.find(u.A,this.opts)}return this.note},x.removeFormerBend=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.default.copy(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData)},n=new d.default(this.measureData,I,this.cancelStack);(0,e.default)(n)},x.hasPreBend=function(){const I=this.getNote();return M.default.hasPreBend(I)},x.hasTie=function(){const I=this.getNote();return M.default.hasTieStop(I)},x.removeTie=function(){const I=new i.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx-1),n=I.getLeftMeasureIdx(),a=I.getLeftNoteIdx(),D=I.getLeftMeasure(),T={partIdx:this.opts.partIdx,measureIdx:n,voiceIdx:this.opts.voiceIdx,noteIdx:a,step:f.default.getStep(this.opts.pitch),octave:f.default.getOctave(this.opts.pitch)},N=new h.default(D,T,this.cancelStack);(0,e.default)(N)},x.addBend=function(){const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:f.default.copy(this.opts.pitch),fretData:(0,v.default)(this.opts.fretData),type:this.opts.type,alter:this.opts.alter};new s(this.measureData,I,this.cancelStack).perform()};const S=p},609260:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(123491),v=t(852363),M=t(793317);const f=function(h,e,i){this.init(h,e,i)};f.NAME="primitive.AddOrnament";const l=f.prototype;l.name=f.NAME,l.initMeasureData=M.default,l.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},l.perform=function(){const e=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);g.default.addOrnament(e,this.opts.ornamentType,this.opts.ornamentsOpts),this.updateStack()},l.updateStack=function(){const h={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,ornamentType:this.opts.ornamentType}};this.cancelStack.push(h),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const r=f;var u=t(805396),c=t(473990),m=t(519405);const o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.AddOrnament";const s=o.prototype;s.name=o.NAME,s.initMeasureData=M.default,s.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},s.perform=function(){const e=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);this.removeTremolo2(e),this.removeIncompatibleOrnaments(e),new r(this.measureData,this.opts,this.cancelStack).perform()},s.removeTremolo2=function(h){if(g.default.hasTremoloStart(h)){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx},i=new u.default(this.measureData,e,this.cancelStack);(0,m.default)(i)}if(g.default.hasTremoloStop(h)){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx-1},i=new u.default(this.measureData,e,this.cancelStack);(0,m.default)(i)}},s.removeIncompatibleOrnaments=function(h){g.default.getIncompatibleOrnaments(h,this.opts.ornamentType).forEach(this.removeIncompatibleOrnament,this)},s.removeIncompatibleOrnament=function(h){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,ornamentType:h,noteIdx:this.opts.noteIdx},i=new c.default(this.measureData,e,this.cancelStack);(0,m.default)(i)};const d=o},624539:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(701387),v=t(721247),M=t(698649),f=t(777501);const l=function(c,m,o){this.init(c,m,o)};l.NAME="composite.SetClef";const r=l.prototype;r.name=l.NAME,r.init=function(c,m,o){this.scoreData=c,this.cancelStack=o,this.opts=m,this.clef=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},r.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const c=this.opts.startMeasureIdx,m=this.opts.stopMeasureIdx;for(let o=c;o<=m;o++){this.clearMiddleMeasureClefs(o);const s=this.getClef(o);this.addClef(s,o)}this.finishSegment()},r.clearMiddleMeasureClefs=function(c){const m={partIdx:this.opts.partIdx,measureIdx:c,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new f.A(this.scoreData,m,this.cancelStack).perform()},r.getClef=function(c){const m=this.scoreData.getMeasure(this.opts.partIdx,c);return g.default.getWrappedClef(m).getEntry(this.opts.staffIdx)},r.addClef=function(c,m){this.hasOngoing()?this.isSameClef(c)?this.continueSegment(m):(this.finishSegment(),this.startSegment(c,m)):this.startSegment(c,m)},r.hasOngoing=function(){return this.clef!==null},r.startSegment=function(c,m){this.clef=v.default.copy(c),this.startMeasureIdx=m,this.stopMeasureIdx=m},r.isSameClef=function(c){return v.default.isSame(c,this.clef)},r.continueSegment=function(c){this.stopMeasureIdx=c},r.finishSegment=function(){v.default.isSame(this.clef,this.opts.clef)||this.setClefSegment(this.startMeasureIdx,this.stopMeasureIdx),this.clef=null,this.startMeasureIdx=null,this.stopMeasureIdx=null},r.setClefSegment=function(c,m){const o=v.default.copy(this.opts.clef),s={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:c,stopMeasureIdx:m,clef:o},d=new M.default(this.scoreData,s,this.cancelStack);d.checkPreconditions(),d.perform()};const u=l},644317:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(59633),v=t(18935),M=t(737202),f=t(59153),l=t(711711),r=t(793317),u=t(519405);const c=function(s,d,h){this.init(s,d,h)};c.NAME="composite.ClearPartMeasure";const m=c.prototype;m.initMeasureData=r.default,m.name=c.NAME,m.init=function(s,d,h){this.initMeasureData(s,d),this.cancelStack=h,this.opts=d},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearHarmonies(),this.clearClassicHarmonies(),this.clearFiguredBassesFrom(),this.clearVoices(),this.clearStavesFloatings()},m.clearHarmonies=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:0,dpq:1},d=this.measureData.getScoreData();new g.A(d,s,this.cancelStack).perform()},m.clearClassicHarmonies=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:0,dpq:1},d=this.measureData.getScoreData();new v.A(d,s,this.cancelStack).perform()},m.clearFiguredBassesFrom=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:0,dpq:1},d=this.measureData.getScoreData();new M.A(d,s,this.cancelStack).perform()},m.clearVoices=function(){this.measureData.forEachVoice(this.clearVoice,this)},m.clearVoice=function(s,d){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:d,removeFloating:!1},e=new f.default(this.measureData,h,this.cancelStack);(0,u.default)(e)},m.clearStavesFloatings=function(){const s=this.measureData.getNbStaves();for(let d=0;d<s;d++)this.clearStaffFloatings(d)},m.clearStaffFloatings=function(s){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:s,preserveWords:this.opts.preserveWords},h=this.measureData.getScoreData();new l.A(h,d,this.cancelStack).perform()};const o=c},652394:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(701387),v=t(519405),M=t(712844);const f=function(o,s,d){this.init(o,s,d)};f.NAME="composite.RemovePartMeasureSlash";const l=f.prototype;l.name=f.NAME,l.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePartMeasureSlash()},l.removePartMeasureSlash=function(){const o=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),s=g.default.getNbStaves(o);for(let d=0;d<s;d++)g.default.hasSlash(o,d)&&this.removeMeasureSlash(d)},l.removeMeasureSlash=function(o){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:o},d=new M.A(this.scoreData,s,this.cancelStack);(0,v.default)(d)};const r=f,u=function(o,s,d){this.init(o,s,d)};u.NAME="composite.RemoveColumnMeasureSlash";const c=u.prototype;c.name=u.NAME,c.init=function(o,s,d){this.scoreData=o,this.cancelStack=d,this.opts=s},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeColumnMeasureSlash()},c.removeColumnMeasureSlash=function(){const o=this.scoreData.getNbParts();for(let s=0;s<o;s++)this.removePartMeasureSlash(s)},c.removePartMeasureSlash=function(o){const s={partIdx:o,measureIdx:this.opts.measureIdx};new r(this.scoreData,s,this.cancelStack).perform()};const m=u},657107:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(512476);const v=g.A},658098:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(607682);class v extends g.default{constructor(r){super(`There is already a staff linked to the following UUID ${r}`),Object.defineProperty(this,"staffUuid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="AlreadyHasStaffUuidError",this.staffUuid=r}}const f=function(l,r){if(l.hasPartStaffUuid(r.partIdx,r.staffUuid))throw new v(r.staffUuid)}},666363:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(364842),v=t(123491),M=t(925822),f=t(245826),l=t(2110),r=t(698716);class u{constructor(o,s,d){this.name=u.NAME,this.measuresScroller=(0,l.A)(o,s),this.cancelStack=d,this.opts=s}perform(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeSlursOnTheWay(),this.moveSlurSide()}removeSlursOnTheWay(){const o=r.A.create(this.opts.oldMeasureIdx,this.opts.oldNoteIdx);o.voiceIdx=this.opts.voiceIdx;const s=r.A.create(this.opts.newMeasureIdx,this.opts.newNoteIdx);if(r.A.isEqual(o,s))throw new g.default("Should not happen");r.A.isGreater(s,o)?this.eraseSlursOnTheRight(o,s):r.A.isLower(s,o)&&this.eraseSlursOnTheLeft(o,s)}eraseSlursOnTheRight(o,s){let d=null;for(let h=o.measureIdx;h<=s.measureIdx;h++){const e=this.measuresScroller.getMeasureData(h);if(!e.hasVoice(o.voiceIdx))continue;const i=e.getVoice(o.voiceIdx);d===null?d=o.noteIdx:d=0;const p=i.getNbNotes();for(;d<p;d++){const x=r.A.create(h,d);if(r.A.isEqual(x,o))continue;const S=i.getNote(d);if(v.default.hasSlur(S)&&this.removeSlur(x),r.A.isEqual(x,s))return}}throw new g.default("Should not happen")}eraseSlursOnTheLeft(o,s){let d=null;for(let h=o.measureIdx;h>=s.measureIdx;h--){const e=this.measuresScroller.getMeasureData(h);if(!e.hasVoice(o.voiceIdx))continue;const i=e.getVoice(o.voiceIdx);for(d===null?d=o.noteIdx:d=i.getNbNotes()-1;d>=0;d--){const p=r.A.create(h,d);if(r.A.isEqual(p,o))continue;const x=i.getNote(d);if(v.default.hasSlur(x)&&this.removeSlur(p),r.A.isEqual(p,s))return}}throw new g.default("Should not happen")}removeSlur(o){const s={partIdx:this.opts.partIdx,measureIdx:o.measureIdx,noteIdx:o.noteIdx,voiceIdx:this.opts.voiceIdx},d=this.measuresScroller.getMeasureData(s.measureIdx);new M.default(d,s,this.cancelStack).perform()}moveSlurSide(){const o={partIdx:this.opts.partIdx,oldMeasureIdx:this.opts.oldMeasureIdx,newMeasureIdx:this.opts.newMeasureIdx,voiceIdx:this.opts.voiceIdx,oldNoteIdx:this.opts.oldNoteIdx,newNoteIdx:this.opts.newNoteIdx};new f.A(this.measuresScroller,o,this.cancelStack).perform()}}Object.defineProperty(u,"NAME",{enumerable:!0,configurable:!0,writable:!0,value:"composite.MoveSlurSideErase"});const c=u},680875:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682);function v(f){return`Note already has Notation ${f}`}class M extends g.default{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"notationType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="AlreadyHasNotationError",this.notationType=l}}},687565:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(951066);function v(f){return`The following break line value: ${f} is incorrect, must be either yes or no`}class M extends g.A{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadSystemBreakValueError",this.value=l}}},694816:(H,P,t)=>{t.d(P,{A:()=>i});var g=t(276265),v=t(857579),M=t(364842);const f=function(p){this.init(p)},l=f.prototype;l.init=function(p){this.partIdx=p},l.registerMeasureData=function(){},l.getPartIdx=function(){return this.partIdx},l.getMeasureData=function(){throw new M.default("NotImplemented","The method `getMeasureData` is not implemented in `FakeMeasuresScroller`")};const r=f;var u=t(123966),c=t(843678),m=t(737903),o=t(701387),s=t(668674),d=t(869773);const h=function(p,x,S){this.init(p,x,S)};h.NAME=d.p;const e=h.prototype;e.name=h.NAME,e.initPartData=u.A,e.init=function(p,x,S){this.initPartData(p,x),this.cancelStack=S,this.opts=x},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const p=this.opts.measureIdx,x=this.partData.getAroundEnv(p);this.measure=this.buildMeasure(x,p);const S=this.partData.getScoreData(),I=new r(this.opts.partIdx);this.measureData=new v.A(this.measure,p,I,S),this.partData.insertMeasure(this.measure,p),this.updateStack(),this.insertVoicesRests(x),this.updateCrossMeasure(x)},e.buildMeasure=function(p,x){const S=this.partData.getAroundSlashes(x),I=this.createMeasure(p,S);if(x===0){const n=this.partData.getFirstEnv();this.partData.resetFirstMeasure(),I.attributes=n.attributes,n.sound&&(I.sound=n.sound)}return I},e.createMeasure=function(p,x){const S={$adagio:p,note:[]};return c.default.forEach(x,function(I,n){I=parseInt(I,10),n=s.A.copy(n),o.default.setSlash(S,I,n)}),S},e.updateStack=function(){const p={type:this.name,opts:{measureIdx:this.opts.measureIdx,partIdx:this.opts.partIdx}};this.cancelStack.push(p)},e.insertVoicesRests=function(p){p.voicesIndexes.forEach(this.insertVoiceRests,this)},e.insertVoiceRests=function(p){this.measureData.getVoicesList().insertVoice(p);const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:p};new g.A(this.measureData,S).perform()},e.updateCrossMeasure=function(p){this.updatePedals(),this.updateWedges(),this.updateOctaveShifts(),this.updatePluckedRanges(),this.updateVoicesSlurs(p)},e.updatePedals=function(){const p=o.default.getNbStaves(this.measure);for(let x=0;x<p;x++){if(this.hasLeftPedal(x)){let S=this.getLeftPedal(x);S=(0,m.default)(S),o.default.setLeftPedal(this.measure,x,S)}if(this.hasRightPedal(x)){let S=this.getRightPedal(x);S=(0,m.default)(S),o.default.setRightPedal(this.measure,x,S)}}},e.hasLeftPedal=function(p){if(!this.hasRightMeasure())return!1;const x=this.getRightMeasure();return o.default.hasLeftPedal(x,p)},e.hasRightPedal=function(p){if(!this.hasLeftMeasure())return!1;const x=this.getLeftMeasure();return o.default.hasRightPedal(x,p)},e.getLeftPedal=function(p){const x=this.getRightMeasure();return o.default.getLeftPedal(x,p)},e.getRightPedal=function(p){const x=this.getLeftMeasure();return o.default.getRightPedal(x,p)},e.updateOctaveShifts=function(){const p=o.default.getNbStaves(this.measure);for(let x=0;x<p;x++){if(this.hasLeftOctaveShift(x)){let S=this.getLeftOctaveShift(x);S=(0,m.default)(S),o.default.setLeftOctaveShift(this.measure,x,S)}if(this.hasRightOctaveShift(x)){let S=this.getRightOctaveShift(x);S=(0,m.default)(S),o.default.setRightOctaveShift(this.measure,x,S)}}},e.hasLeftOctaveShift=function(p){if(!this.hasRightMeasure())return!1;const x=this.getRightMeasure();return o.default.hasLeftOctaveShift(x,p)},e.hasRightOctaveShift=function(p){if(!this.hasLeftMeasure())return!1;const x=this.getLeftMeasure();return o.default.hasRightOctaveShift(x,p)},e.getLeftOctaveShift=function(p){const x=this.getRightMeasure();return o.default.getLeftOctaveShift(x,p)},e.getRightOctaveShift=function(p){const x=this.getLeftMeasure();return o.default.getRightOctaveShift(x,p)},e.updatePluckedRanges=function(){const p=o.default.getNbStaves(this.measure);for(let x=0;x<p;x++){if(this.hasLeftPluckedRange(x)){let S=this.getLeftPluckedRange(x);S=(0,m.default)(S),o.default.setLeftPluckedRange(this.measure,x,S)}if(this.hasRightPluckedRange(x)){let S=this.getRightPluckedRange(x);S=(0,m.default)(S),o.default.setRightPluckedRange(this.measure,x,S)}}},e.hasLeftPluckedRange=function(p){if(!this.hasRightMeasure())return!1;const x=this.getRightMeasure();return o.default.hasLeftPluckedRange(x,p)},e.hasRightPluckedRange=function(p){if(!this.hasLeftMeasure())return!1;const x=this.getLeftMeasure();return o.default.hasRightPluckedRange(x,p)},e.getLeftPluckedRange=function(p){const x=this.getRightMeasure();return o.default.getLeftPluckedRange(x,p)},e.getRightPluckedRange=function(p){const x=this.getLeftMeasure();return o.default.getRightPluckedRange(x,p)},e.updateWedges=function(){const p=o.default.getNbStaves(this.measure);for(let x=0;x<p;x++){if(this.hasLeftWedge(x)){let S=this.getLeftWedge(x);S=(0,m.default)(S),o.default.setLeftWedge(this.measure,x,S)}if(this.hasRightWedge(x)){let S=this.getRightWedge(x);S=(0,m.default)(S),o.default.setRightWedge(this.measure,x,S)}}},e.hasLeftWedge=function(p){if(!this.hasRightMeasure())return!1;const x=this.getRightMeasure();return o.default.hasLeftWedge(x,p)},e.hasRightWedge=function(p){if(!this.hasLeftMeasure())return!1;const x=this.getLeftMeasure();return o.default.hasRightWedge(x,p)},e.getLeftWedge=function(p){const x=this.getRightMeasure();return o.default.getLeftWedge(x,p)},e.getRightWedge=function(p){const x=this.getLeftMeasure();return o.default.getRightWedge(x,p)},e.updateVoicesSlurs=function(p){p.voicesIndexes.forEach(this.updateVoiceSlur,this)},e.updateVoiceSlur=function(p){if(this.hasLeftSlur(p)){let x=this.getLeftSlur(p);x=(0,m.default)(x),o.default.setLeftSlur(this.measure,p,x)}if(this.hasRightSlur(p)){let x=this.getRightSlur(p);x=(0,m.default)(x),o.default.setRightSlur(this.measure,p,x)}},e.hasLeftSlur=function(p){if(!this.hasRightMeasure())return!1;const x=this.getRightMeasure();return o.default.hasLeftSlur(x,p)},e.hasRightSlur=function(p){if(!this.hasLeftMeasure())return!1;const x=this.getLeftMeasure();return o.default.hasRightSlur(x,p)},e.getLeftSlur=function(p){const x=this.getRightMeasure();return o.default.getLeftSlur(x,p)},e.getRightSlur=function(p){const x=this.getLeftMeasure();return o.default.getRightSlur(x,p)},e.hasLeftMeasure=function(){return this.opts.measureIdx>0},e.getLeftMeasure=function(){return this.partData.getMeasure(this.opts.measureIdx-1)},e.hasRightMeasure=function(){const p=this.partData.getNbMeasures();return this.opts.measureIdx+1<p},e.getRightMeasure=function(){return this.partData.getMeasure(this.opts.measureIdx+1)};const i=h},701643:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(607682),v=t(123491),M=t(737296),f=t(349386),l=t(19850),r=t(59377),u=t(405347);const m=function(o,s){if(typeof s.timePos!="undefined"){(0,l.default)(o,s);const h=o.getVoice(s.voiceIdx).getNote(s.noteIdx),e=o.getDpqValue(),i=v.default.getTimeModif(h),p=(0,f.default)(s,e,i),x=v.default.getDuration(h);if(p===x)return;if(!v.default.isRest(h)){const a="Cannot adjust duration of a non rest.";throw new g.default(a,"NonRestDurationAdjust")}const S={partIdx:s.partIdx,measureIdx:s.measureIdx,voiceIdx:s.voiceIdx,noteIdx:s.noteIdx,insertMode:M.default.REPLACE,formatRests:!1,durationType:s.durationType,nbDots:s.nbDots,record:!1},I=new r.default,n=new u.default(o,S,I);n.checkPreconditions(),n.perform()}}},704275:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(737903),v=t(536680),M=t(793317);const f=function(h,e,i){this.init(h,e,i)};f.NAME="composite.RemoveStaffMeasureLeftSlides";const l=f.prototype;l.initMeasureData=M.default,l.name=f.NAME,l.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=(0,g.default)(this.opts);h.noteIdx=0,this.measureData.getVoice(h.voiceIdx).isRest(h.noteIdx)||new v.A(this.measureData,h,this.cancelStack).perform()};const r=f,u=function(h,e,i){this.init(h,e,i)};u.NAME="composite.RemoveMeasureLeftSlides";const c=u.prototype;c.initMeasureData=M.default,c.name=u.NAME,c.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceSlides,this)},c.removeVoiceSlides=function(h,e){const i=(0,g.default)(this.opts);i.voiceIdx=e,new r(this.measureData,i,this.cancelStack).perform()};const m=u,o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.RemoveColumnLeftSlides";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.scoreData=h,this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=this.scoreData.getNbParts();for(let e=0;e<h;e++)if(!this.scoreData.isPartUnpitched(e)){const i=(0,g.default)(this.opts);i.partIdx=e,new m(this.scoreData,i,this.cancelStack).perform()}};const d=o},711333:(H,P,t)=>{t.d(P,{A:()=>N});var g=t(31278),v=t(364842),M=t(726042),f=t(701387),l=t(721247),r=t(210888),u=t(606106),c=t(316610),m=t(852363);const o=function(y,A,R){this.init(y,A,R)};o.NAME="primitive.AddMiddleMeasureClef";const s=o.prototype;s.name=o.NAME,s.init=function(y,A,R){this.scoreData=y,this.cancelStack=R,this.opts=A,this.measure=null,this.clefIdx=null,this.localTimePos=null},s.perform=function(){this.addMiddleMeasureClef(),this.updateStack()},s.addMiddleMeasureClef=function(){const y=this.getMeasure(),A=this.getClefIdx(),R=this.createClef(),W=f.default.getMiddleClefs(y,this.opts.staffIdx);W.splice(A,0,R),f.default.setMiddleClefs(y,this.opts.staffIdx,W)},s.getClefIdx=function(){return this.clefIdx===null&&this.fetchClefIdx(),this.clefIdx},s.fetchClefIdx=function(){const y=this.getMeasure(),A=f.default.getMiddleClefs(y,this.opts.staffIdx);if(A.some(this.tryClefIdx,this),this.clefIdx===null){const R=A.length;this.clefIdx=R}},s.tryClefIdx=function(y,A){const R=this.getLocalTimePos(),W=l.default.getTimePos(y);if(W<R)return!1;if(W>R)return this.clefIdx=A,!0;{const F="There is already an clef at this time position.";throw new v.default("TimePosCollision",F)}},s.createClef=function(){const y=this.getLocalTimePos(),A=l.default.copy(this.opts.clef),R=r.default.generate();return l.default.setTimePos(A,y),l.default.setClefUuid(A,R),this.cancelStack.addEntityUuid({entityType:u.A.MIDDLE_MEASURE_CLEF,uuid:R}),A},s.getLocalTimePos=function(){if(this.localTimePos===null){const y=this.getMeasure();if(this.localTimePos=(0,c.A)(this.opts,y),!M.default.isInteger(this.localTimePos)){const A=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new v.default("IntegerExpected",A)}}return this.localTimePos},s.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},s.updateStack=function(){const y={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(y),(0,m.default)(this.cancelStack,this.scoreData,this.opts)};const d=o;var h=t(746822),e=t(874868),i=t(919973);const p=function(y,A,R){this.init(y,A,R)};p.NAME="composite.AddMiddleMeasureClef";const x=p.prototype;x.name=p.NAME,x.init=function(y,A,R){this.scoreData=y,this.cancelStack=R,this.opts=A},x.perform=function(){this.updateDpq(),this.addMiddleMeasureClef(),this.isLastClef()&&!this.isLastMeasure()&&this.updateNextOwnClef()},x.updateDpq=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new h.A(this.scoreData,y,this.cancelStack).perform()},x.addMiddleMeasureClef=function(){const y=l.default.copy(this.opts.clef),A={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,clef:y};new d(this.scoreData,A,this.cancelStack).perform()},x.isLastClef=function(){const y=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx),A=f.default.getMiddleClefs(y,this.opts.staffIdx),R=f.default.getDpq(y),W=A[A.length-1],F=l.default.getTimePos(W),E=i.A.create(this.opts.timePos,this.opts.dpq),U=i.A.create(F,R);return i.A.isEquivalent(E,U)},x.isLastMeasure=function(){return this.opts.measureIdx===this.scoreData.getNbMeasures()-1},x.updateNextOwnClef=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx+1,staffIdx:this.opts.staffIdx};new e.A(this.scoreData,y,this.cancelStack).perform()};const S=p;var I=t(703447),n=t(519405);const a=function(y,A,R){this.init(y,A,R)};a.NAME="composite.AddMiddleMeasureClefErase";const D=a.prototype;D.name=a.NAME,D.init=function(y,A,R){this.scoreData=y,this.cancelStack=R,this.opts=A},D.perform=function(){this.removeFormer(),this.addMiddleMeasureClef()},D.removeFormer=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:this.opts.timePos,dpq:this.opts.dpq},A=new I.default(this.scoreData,y,this.cancelStack);(0,n.default)(A,T)};function T(y){return y instanceof g.default}D.addMiddleMeasureClef=function(){const y=l.default.copy(this.opts.clef),A={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,timePos:this.opts.timePos,dpq:this.opts.dpq,clef:y};new S(this.scoreData,A,this.cancelStack).perform()};const N=a},711711:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(377706),v=t(557830),M=t(827303),f=t(731725),l=t(928025),r=t(701932),u=t(777501),c=t(447770),m=t(406765);const o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.ClearMeasureStaffFloatings";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.scoreData=h,this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearDynamics(),this.clearPizzicatos(),this.clearMutes(),this.opts.preserveWords||this.clearWords(),this.clearClefs(),this.clearWedges(),this.clearPedals(),this.clearOctaveShifts(),this.clearPluckedRanges()},s.clearPizzicatos=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new f.A(this.scoreData,h,this.cancelStack).perform()},s.clearMutes=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new l.A(this.scoreData,h,this.cancelStack).perform()},s.clearWords=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new r.A(this.scoreData,h,this.cancelStack).perform()},s.clearClefs=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new u.A(this.scoreData,h,this.cancelStack).perform()},s.clearDynamics=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new M.A(this.scoreData,h,this.cancelStack).perform()},s.clearWedges=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new g.A(this.scoreData,h,this.cancelStack).perform()},s.clearPedals=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new v.A(this.scoreData,h,this.cancelStack).perform()},s.clearOctaveShifts=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new c.A(this.scoreData,h,this.cancelStack).perform()},s.clearPluckedRanges=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,timePos:0,dpq:1};new m.A(this.scoreData,h,this.cancelStack).perform()};const d=o},712844:(H,P,t)=>{t.d(P,{A:()=>p});var g=t(443749),v=t(31278),M=t(701387),f=t(726042),l=t(52275),r=t(704621),u=t(783177),c=t(852363);const m=function(x,S,I){this.init(x,S,I)};m.NAME="primitive.RemoveMeasureSlash";const o=m.prototype;o.name=m.NAME,o.init=function(x,S,I){this.scoreData=x,this.cancelStack=I,this.opts=S,this.measure=null},o.perform=function(){this.removeMeasureSlash(),this.updateStack()},o.removeMeasureSlash=function(){const x=this.getMeasure();M.default.removeSlash(x,this.opts.staffIdx)},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},o.updateStack=function(){const x={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(x),(0,c.default)(this.cancelStack,this.scoreData,this.opts)};const s=m;var d=t(42651),h=t(668674);const e=function(x,S,I){this.init(x,S,I)};e.NAME="action.RemoveMeasureSlash";const i=e.prototype;i.name=e.NAME,i.init=function(x,S,I){(0,l.default)(x,S),(0,r.default)(x,S),(0,u.default)(x,S),this.scoreData=x,this.cancelStack=I,this.opts=S,this.localTimePos=null,this.clefIdx=null,this.location=null},i.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},i.checkLocation=function(){this.scoreData.checkPartIdx(this.opts.partIdx),this.scoreData.checkMeasureIdx(this.opts.measureIdx);const x=this.getMeasure(),S=M.default.getNbStaves(x),I=this.opts.staffIdx;if(!f.default.isInteger(I)||I<0||I>=S)throw new g.default(this.opts.staffIdx)},i.checkExistence=function(){const x=this.getMeasure();if(!M.default.hasSlash(x,this.opts.staffIdx))throw new v.default},i.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const x=this.getPreviousData();this.removeMeasureSlash(),this.updateStack(x)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const x=this.getLocation(),S={actionName:this.name,opts:{partUuid:x.partUuid,measureUuid:x.measureUuid,staffUuid:x.staffUuid}};this.cancelStack.storeAction(S)}},i.getPreviousData=function(){const x=this.getMeasure(),S=M.default.getSlash(x,this.opts.staffIdx);return{isUsingStems:h.A.isUsingStems(S)}},i.removeMeasureSlash=function(){const x={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx};new s(this.scoreData,x,this.cancelStack).perform()},i.updateStack=function(x){const S=this.getLocation(),I={type:this.name,noDraw:!0,opts:{partUuid:S.partUuid,measureUuid:S.measureUuid,staffUuid:S.staffUuid,isUsingStems:x.isUsingStems}};this.cancelStack.push(I)},i.getLocation=function(){if(this.location===null){const x=this.scoreData.getPartUuid(this.opts.partIdx),S=this.scoreData.getMeasureUuid(this.opts.measureIdx),I=this.scoreData.getPartStaffUuid(this.opts.partIdx,this.opts.staffIdx);this.location={partUuid:x,measureUuid:S,staffUuid:I}}return this.location},(0,d.default)(e);const p=e},714742:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(867734),v=t(436369);const M=function(s,d,h){this.init(s,d,h)};M.NAME="primitive.AddSystemBreak";const f=M.prototype;f.name=M.NAME,f.init=function(s,d,h){this.scoreData=s,this.opts=d,this.cancelStack=h},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.perform=function(){this.getCommonContent().setSystemBreak(this.opts.measureIdx,this.opts.value),this.updateStack()},f.updateStack=function(){const s={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};if(this.cancelStack.push(s),(0,v.A)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0){const d={type:`${this.name}-drawPrevious`,opts:{partIdx:0,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(d),(0,v.A)(this.cancelStack,this.scoreData,{measureIdx:this.opts.measureIdx-1})}};const l=M;var r=t(519405),u=t(429240);const c=function(s,d,h){this.init(s,d,h)};c.NAME="action.AddSystemBreak";const m=c.prototype;m.name=c.NAME,m.init=function(s,d,h){this.scoreData=s,this.opts=d,this.cancelStack=h},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeFormerSystemBreak(),this.removeFormerPageBreak(),this.addSystemBreak()},m.removeFormerSystemBreak=function(){if(!this.scoreData.getCommonContent().hasSystemBreak(this.opts.measureIdx))return;const d=new g.default(this.scoreData,this.opts,this.cancelStack);(0,r.default)(d)},m.removeFormerPageBreak=function(){this.scoreData.getCommonContent().hasPageBreak(this.opts.measureIdx)&&new u.default(this.scoreData,this.opts,this.cancelStack).perform()},m.addSystemBreak=function(){const s={measureIdx:this.opts.measureIdx,value:this.opts.value};new l(this.scoreData,s,this.cancelStack).perform()};const o=c},728451:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(123491),v=t(292681),M=t(793317),f=t(768498),l=t(852363);const r=function(e,i,p){this.init(e,i,p)};r.NAME="primitive.AddColorToNotePercu";const u=r.prototype;u.name=r.NAME,u.initMeasureData=M.default,u.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},u.perform=function(){this.addColorToNotePercu(),this.updateStack()},u.addColorToNotePercu=function(){const e=this.measureData.getVoice(this.opts.voiceIdx),i=(0,f.A)(e,this.opts.noteIdx,this.opts.unpitched);g.default.setColor(i,this.opts.color)},u.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const c=r;var m=t(278572),o=t(519405);const s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddColorToNotePercu";const d=s.prototype;d.initMeasureData=M.default,d.name=s.NAME,d.init=function(e,i,p){this.initMeasureData(e,i),this.cancelStack=p,this.opts=i},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasFormerColor()&&this.removeFormerColor(),this.addColorToNotePercu()},d.hasFormerColor=function(){const e=this.measureData.getVoice(this.opts.voiceIdx),i=(0,f.A)(e,this.opts.noteIdx,this.opts.unpitched);return g.default.hasColor(i)},d.removeFormerColor=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:v.default.copy(this.opts.unpitched)},i=new m.default(this.measureData,e,this.cancelStack);(0,o.default)(i)},d.addColorToNotePercu=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,unpitched:v.default.copy(this.opts.unpitched),color:this.opts.color};new c(this.measureData,e,this.cancelStack).perform()};const h=s},733291:(H,P,t)=>{t.d(P,{A:()=>N});var g=t(737903),v=t(515819),M=t(701387),f=t(351277),l=t(123491),r=t(366274),u=t(823880),c=t(15635),m=t(627931),o=t(244491),s=t(551303),d=t(27912),h=t(793317),e=t(519405);const i=function(y,A,R){this.init(y,A,R)};i.NAME="composite.AddChordIntraMeasure";const p=i.prototype;p.name=i.NAME,p.initMeasureData=h.default,p.init=function(y,A,R){this.initMeasureData(y,A),this.cancelStack=R,this.opts=A,this.firstChord=!0,this.quarterPosition=A.quarterPosition,this.quarterDuration=A.quarterDuration,this.noteIdx=null},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.isVoiceDisplayed()?(this.removeSpaceTuplets(),this.removeSpaceChords()):this.displayVoice(),this.splitRest(),this.fetchNoteIdx(),this.addChords()},p.isVoiceDisplayed=function(){return this.measureData.hasVoice(this.opts.voiceIdx)},p.removeSpaceTuplets=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new r.A(this.measureData,y,this.cancelStack).perform()},p.removeSpaceChords=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.opts.quarterPosition,quarterDuration:this.opts.quarterDuration};new u.A(this.measureData,y,this.cancelStack).perform()},p.displayVoice=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx},A=new s.default(this.measureData,y,this.cancelStack);(0,e.default)(A)},p.splitRest=function(){const y=v.default.quarterDurationToRequiredDpq(this.quarterPosition),A=v.default.quarterToDuration(this.quarterPosition,y),R={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:A,dpq:y};new c.A(this.measureData,R,this.cancelStack).perform()},p.fetchNoteIdx=function(){const y=this.measureData.getDpqValue(),A=v.default.quarterToDuration(this.quarterPosition,y),R=this.measureData.getVoice(this.opts.voiceIdx),W=1;this.noteIdx=(0,d.A)(R,W,A)},p.addChords=function(){for(;this.quarterDuration>0;){const y=this.getDurationOpts();this.addChord(y),this.isFirstChord()||this.tieWithPrevious(),this.moveForward()}},p.getDurationOpts=function(){const y=v.default.extractQuarterPossibleDuration(this.quarterDuration);return v.default.quarterToDurationOpts(y)},p.addChord=function(y){const A=this.opts.heads.map(x),R={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,staffIdx:this.opts.staffIdx,noteIdx:this.noteIdx,heads:A,durationType:y.durationType,nbDots:y.nbDots,checkLine:!1},W=new m.default(this.measureData,R,this.cancelStack);(0,e.default)(W)};const x=function(y){const R={pitch:f.default.copy(y.pitch)};return typeof y.fretData!="undefined"&&(R.fretData=(0,g.default)(y.fretData)),R};p.isFirstChord=function(){return this.firstChord},p.tieWithPrevious=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx-1},A=new o.default(this.measureData,y,this.cancelStack);(0,e.default)(A)},p.moveForward=function(){this.firstChord=!1;const y=this.getCurrentQuarterDuration();this.quarterDuration-=y,this.noteIdx++},p.getCurrentQuarterDuration=function(){const y=this.measureData.getDpqValue(),R=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.noteIdx);return l.default.getQuarterDuration(R,y)};const S=i;var I=t(526881),n=t(857579);const a=function(y,A,R){this.init(y,A,R)};a.NAME="composite.AddChordCrossMeasure";const D=a.prototype;D.name=a.NAME,D.init=function(y,A,R){this.scoreData=y,this.cancelStack=R,this.opts=A,this.measureIdx=this.opts.measureIdx,this.quarterPosition=this.opts.quarterPosition,this.quarterDuration=this.opts.quarterDuration},D.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name);this.quarterDuration>0;){const y=this.getSliceDuration();this.addChordIntraMeasure(y),this.isFirstMeasure()||this.tieWithPrevious(),this.moveForward(y),this.measureEndReached()&&this.nextMeasure()}this.storePosition()},D.isFirstMeasure=function(){return this.measureIdx===this.opts.measureIdx},D.tieWithPrevious=function(){const y={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:-1},A=new o.default(this.scoreData,y,this.cancelStack);(0,e.default)(A)},D.getSliceDuration=function(){const A=this.getMeasureQuarterDuration()-this.quarterPosition;return Math.min(A,this.quarterDuration)},D.addChordIntraMeasure=function(y){const A=this.opts.heads.map(T),R={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,staffIdx:this.opts.staffIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:y,heads:A};new S(this.scoreData,R,this.cancelStack).perform()};const T=function(y){const R={pitch:f.default.copy(y.pitch)};return typeof y.fretData!="undefined"&&(R.fretData=(0,g.default)(y.fretData)),R};D.moveForward=function(y){this.quarterPosition+=y,this.quarterDuration-=y},D.measureEndReached=function(){return this.getMeasureQuarterDuration()===this.quarterPosition},D.getMeasureQuarterDuration=function(){const y=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),A=M.default.getAnyTime(y);return v.default.timeToQuarter(A)},D.nextMeasure=function(){this.measureIdx++,this.quarterPosition=0;const y=this.scoreData.getNbMeasures();this.measureIdx===y&&this.addMeasure()},D.addMeasure=function(){const y={measureIdx:this.measureIdx},A=new I.default(this.scoreData,y,this.cancelStack);(0,e.default)(A)},D.storePosition=function(){const y=this.fetchNoteIdx(),A={measureIdx:this.measureIdx,noteIdx:y};this.cancelStack.storePosition(A)},D.fetchNoteIdx=function(){if(this.quarterPosition===0)return 0;const y=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),A=new n.A(y),R=A.getVoice(this.opts.voiceIdx),W=A.getDpqValue(),F=v.default.quarterToDuration(this.quarterPosition,W);return(0,d.A)(R,1,F)};const N=a},739253:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(737903),v=t(487332),M=t(793317);const f=function(h,e,i){this.init(h,e,i)};f.NAME="composite.RemoveStaffMeasureLeftHammerOnPullOffs";const l=f.prototype;l.initMeasureData=M.default,l.name=f.NAME,l.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=(0,g.default)(this.opts);h.noteIdx=-1,new v.default(this.measureData,h,this.cancelStack).performIfPossible()};const r=f,u=function(h,e,i){this.init(h,e,i)};u.NAME="composite.RemoveMeasureLeftHammerOnPullOffs";const c=u.prototype;c.initMeasureData=M.default,c.name=u.NAME,c.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceHammerOnPullOffs,this)},c.removeVoiceHammerOnPullOffs=function(h,e){const i=(0,g.default)(this.opts);i.voiceIdx=e,new r(this.measureData,i,this.cancelStack).perform()};const m=u,o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.RemoveColumnLeftHammerOnPullOffs";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.scoreData=h,this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=this.scoreData.getNbParts();for(let e=0;e<h;e++){const i=(0,g.default)(this.opts);i.partIdx=e,new m(this.scoreData,i,this.cancelStack).perform()}};const d=o},744163:(H,P,t)=>{t.d(P,{A:()=>n});var g=t(364842),v=t(701387),M=t(614653),f=t(726042),l=t(210888),r=t(606106),u=t(316610),c=t(852363);const m=function(a,D,T){this.init(a,D,T)};m.NAME="primitive.AddClassicHarmony";const o=m.prototype;o.name=m.NAME,o.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D,this.measure=null,this.harmonyIdx=null,this.localTimePos=null},o.perform=function(){const a=this.getHarmonyIdx(),D=this.createHarmony();this.addHarmony(D,a),this.updateStack()},o.getHarmonyIdx=function(){return this.harmonyIdx===null&&this.fetchHarmonyIdx(),this.harmonyIdx},o.fetchHarmonyIdx=function(){const a=this.getMeasure(),D=v.default.getClassicHarmonies(a);if(D.some(this.tryHarmonyIdx,this),this.harmonyIdx===null){const T=D.length;this.harmonyIdx=T}},o.tryHarmonyIdx=function(a,D){const T=this.getLocalTimePos(),N=M.default.getTimePos(a);if(N<T)return!1;if(N>T)return this.harmonyIdx=D,!0;{const y="There is already an harmony at this time position.";throw new g.default("TimePosCollision",y)}},o.createHarmony=function(){const a=M.default.createClassic(this.opts.chordFunction,this.opts.kind,this.opts.inversion);M.default.setAlter(a,this.opts.alter),this.opts.secondaryFunction&&(M.default.setSecondaryFunction(a,this.opts.secondaryFunction),M.default.setSecondaryAlter(a,this.opts.secondaryAlter),M.default.setSecondaryKind(a,this.opts.secondaryKind),M.default.setSecondaryInversion(a,this.opts.secondaryInversion));const D=this.getLocalTimePos();M.default.setTimePos(a,D);const T=l.default.generate();return this.cancelStack.addEntityUuid({entityType:r.A.CLASSIC_HARMONY,uuid:T}),M.default.setHarmonyUuid(a,T),a},o.addHarmony=function(a,D){const T=this.getMeasure(),N=v.default.getClassicHarmonies(T);N.splice(D,0,a),v.default.setClassicHarmonies(T,N)},o.updateStack=function(){const a={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(a),(0,c.default)(this.cancelStack,this.scoreData,this.opts)},o.getDpq=function(){const a=this.getMeasure();return v.default.getDpq(a)},o.getLocalTimePos=function(){if(this.localTimePos===null){const a=this.getMeasure();if(this.localTimePos=(0,u.A)(this.opts,a),!f.default.isInteger(this.localTimePos)){const D=`At the point, the time position [${this.localTimePos}] should be an integer.`;throw new g.default("IntegerExpected",D)}}return this.localTimePos},o.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure};const s=m;var d=t(746822),h=t(379668);const e=function(a,D,T){this.init(a,D,T)};e.NAME="composite.AddClassicHarmony";const i=e.prototype;i.name=e.NAME,i.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},i.perform=function(){this.removeMmr(),this.updateDpq(),this.addClassicHarmony()},i.removeMmr=function(){(0,h.A)(this.scoreData,this.opts,this.cancelStack)},i.updateDpq=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new d.A(this.scoreData,a,this.cancelStack).perform()},i.addClassicHarmony=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,chordFunction:this.opts.chordFunction,alter:this.opts.alter,kind:this.opts.kind,inversion:this.opts.inversion};this.opts.secondaryFunction&&(a.secondaryFunction=this.opts.secondaryFunction,a.secondaryAlter=this.opts.secondaryAlter,a.secondaryKind=this.opts.secondaryKind,a.secondaryInversion=this.opts.secondaryInversion),new s(this.scoreData,a,this.cancelStack).perform()};const p=e;var x=t(64994);const S=function(a,D,T){this.init(a,D,T)};S.NAME="composite.AddClassicHarmonyErase";const I=S.prototype;I.name=S.NAME,I.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},I.perform=function(){this.removeFormerHarmony(),this.addClassicHarmony()},I.removeFormerHarmony=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq};new x.default(this.scoreData,a,this.cancelStack).performIfPossible()},I.addClassicHarmony=function(){const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,dpq:this.opts.dpq,chordFunction:this.opts.chordFunction,alter:this.opts.alter,kind:this.opts.kind,inversion:this.opts.inversion};this.opts.secondaryFunction&&(a.secondaryFunction=this.opts.secondaryFunction,a.secondaryAlter=this.opts.secondaryAlter,a.secondaryKind=this.opts.secondaryKind,a.secondaryInversion=this.opts.secondaryInversion),new p(this.scoreData,a,this.cancelStack).perform()};const n=S},744572:(H,P,t)=>{t.d(P,{A:()=>n});var g=t(441756),v=t(793317);const M=function(a,D,T){this.init(a,D,T)};M.NAME="composite.ForceHidePartVoice";const f=M.prototype;f.name=M.NAME,f.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.forceHidePartVoice()},f.forceHidePartVoice=function(){const a=this.scoreData.getNbMeasures();for(let D=0;D<a;D++)this.forceHideMeasureVoiceIfNeeded(D)},f.forceHideMeasureVoiceIfNeeded=function(a){const D=this.getMeasureData(a);D.hasVoice(this.opts.voiceIdx)&&this.forceHideMeasureVoice(D,a)},f.getMeasureData=function(a){const D={partIdx:this.opts.partIdx,measureIdx:a},T={};return v.default.call(T,this.scoreData,D),T.measureData},f.forceHideMeasureVoice=function(a,D){const T={partIdx:this.opts.partIdx,measureIdx:D,voiceIdx:this.opts.voiceIdx};new g.A(a,T,this.cancelStack).perform()};const l=M;var r=t(364842);const u=function(a,D,T){this.init(a,D,T)};u.NAME="primitive.ChangeMainVoice";const c=u.prototype;c.name=u.NAME,c.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.changeMainVoice()},c.changeMainVoice=function(){const a=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.mainVoiceIdx),T=this.scoreData.getPartStaffMapping(this.opts.partIdx)[a];T.mainVoiceIdx=this.opts.mainVoiceIdx};const m=u,o=function(a,D,T){this.init(a,D,T)};o.NAME="primitive.ChooseOtherMainVoice";const s=o.prototype;s.name=o.NAME,s.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.chooseOtherMainVoice()},s.chooseOtherMainVoice=function(){const a=this.getMainVoiceIdx();this.changeMainVoice(a)},s.getMainVoiceIdx=function(){const a=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.formerMainVoiceIdx),T=this.scoreData.getPartStaffMapping(this.opts.partIdx)[a];if(T.mainVoiceIdx!==this.opts.formerMainVoiceIdx)throw new r.default("NoMainVoice");if(T.voices.length<2)throw new r.default("SingleVoice");return T.voices.includes(this.opts.candidateMainVoiceIdx)&&this.opts.candidateMainVoiceIdx!==T.mainVoiceIdx?this.opts.candidateMainVoiceIdx:d(T)};const d=function(a){const D=a.voices.length;for(let T=0;T<D;T++){const N=a.voices[T];if(N!==a.mainVoiceIdx)return N}throw new r.default("Unexpected")};s.changeMainVoice=function(a){const D={partIdx:this.opts.partIdx,mainVoiceIdx:a};new m(this.scoreData,D,this.cancelStack).perform()};const h=o;var e=t(383279);const i=function(a,D,T){this.init(a,D,T)};i.NAME="primitive.RemoveVoice";const p=i.prototype;p.name=i.NAME,p.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addVoice()},p.addVoice=function(){const a=this.scoreData.getPartHeader(this.opts.partIdx),D=this.opts.voiceIdx,T=e.default.getVoiceMapping(a),N=T[D];delete T[D],e.default.setVoiceMapping(a,T),e.default.eraseVoiceUuid(a,D),N.forEach(this.removeInStaffMapping,this)},p.removeInStaffMapping=function(a){const T=this.scoreData.getPartStaffMapping(this.opts.partIdx)[a];if(T.mainVoiceIdx===this.opts.voiceIdx){const y="Cannot remove the main voice.";throw new r.default("MainVoice",y)}const N=T.voices.indexOf(this.opts.voiceIdx);if(N===-1)throw new r.default("Unexpected");T.voices.splice(N,1)};const x=i,S=function(a,D,T){this.init(a,D,T)};S.NAME="composite.RemoveVoice";const I=S.prototype;I.name=S.NAME,I.init=function(a,D,T){this.scoreData=a,this.cancelStack=T,this.opts=D},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.forceHidePartVoice(),this.isMainVoice()&&this.chooseOtherMainVoice(),this.removeVoice()},I.forceHidePartVoice=function(){const a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx};new l(this.scoreData,a,this.cancelStack).perform()},I.isMainVoice=function(){const a=this.scoreData.getPartVoiceMainStaffIdx(this.opts.partIdx,this.opts.voiceIdx),D=this.scoreData.getPartStaffMainVoiceIdx(this.opts.partIdx,a);return this.opts.voiceIdx===D},I.chooseOtherMainVoice=function(){const a={partIdx:this.opts.partIdx,formerMainVoiceIdx:this.opts.voiceIdx,candidateMainVoiceIdx:this.opts.candidateMainVoiceIdx};new h(this.scoreData,a,this.cancelStack).perform()},I.removeVoice=function(){const a={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx};new x(this.scoreData,a,this.cancelStack).perform()};const n=S},753932:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("You must provide at least one pitch."),this.name="NoPitchesError"}}},761300:(H,P,t)=>{t.d(P,{A:()=>dt});var g=t(843678),v=t(104907),M=t(902630),f=t(125394),l=t(743475),r=t(627300),u=t(351277),c=t(377180);function m(V){const z=v.default.getCapo(V),rt=v.default.getStaffTunings(V).map(o,z);return rt.sort(s),rt}function o(V,z,et){const rt=et.length,ht=this.valueOf(),ft=r.default.getOctave(V),xt=r.default.getAlter(V),St=r.default.getStep(V),Pt=u.default.stepToChromatic(St),lt=ft*c.default.NB_CHROMATIC+Pt+xt+ht;let Y=(z+1).toString();return r.default.hasLine(V)&&(Y=r.default.getLineStr(V)),Y=rt+1-Y,{chromatic:lt,string:Y}}function s(V,z){return V.chromatic-z.chromatic}function d(V){return V.map(h)}function h({alter:V,step:z}){return u.default.stepToChromatic(z)+V}const e=20;function i(V,z){const et={};let rt=z.shift();const[ht]=V;rt=p(rt,ht.chromatic);let ft;do if(ft=x(V,rt),ft.length>=z.length){const xt=[];et[rt]=xt,I(rt,ft,z,{combinations:xt}),rt+=c.default.NB_CHROMATIC}while(ft.length>z.length);return et}function p(V,z){for(;V<z;)V+=c.default.NB_CHROMATIC;return V}function x(V,z){const et=V.findIndex(S,z);return et<0?[]:V.slice(et)}function S(V){const et=this.valueOf()-V.chromatic;return et>=0&&et<=e}function I(V,z,et,rt){const ht=z.length-(et.length+1);for(let ft=0;ft<=ht;ft++){const xt=z.slice(ft),[St]=xt;if(!S.call(V,St))return;n(V,xt,et,rt)}}function n(V,z,et,rt){let ht=rt.currentConbination||[];ht=ht.slice();const[ft]=z,xt={string:ft.string,fret:V-ft.chromatic};if(ht.push(xt),et.length===0){rt.combinations.push(ht);return}let[St]=et;et=et.slice(1),St=a(V,St),z=z.slice(1),I(St,z,et,{currentConbination:ht,combinations:rt.combinations})}function a(V,z){for(;z<=V;)z+=c.default.NB_CHROMATIC;return z}const D=5;function T(V){return V=V.filter(N),V}function N(V){return!(!y(V)||!R(V))}function y(V){const[z]=V,et={maxString:z.string,minString:z.string};return V.forEach(A,et),et.maxString-et.minString===V.length-1}function A(V){const z=this;z.maxString=Math.max(z.maxString,V.string),z.minString=Math.min(z.minString,V.string)}function R(V){const z={maxFret:null,minFret:null};return V.forEach(W,z),z.maxFret===null||z.minFret===null?!0:z.maxFret-z.minFret<=D}function W(V){if(V.fret===0)return;const z=this;z.maxFret===null?z.maxFret=V.fret:z.maxFret=Math.max(z.maxFret,V.fret),z.minFret===null?z.minFret=V.fret:z.minFret=Math.min(z.minFret,V.fret)}function F(V){let z=0;const et=E(V);Q(et),z+=et.fretSpread,z-=et.nbOpenStrings,z-=et.nbOccurences,V.score=z}function E(V){const z={nbOpenStrings:0,minFret:null,maxFret:null,nbOccurences:0,fretCount:{}};return V.forEach(U,z),z}function U({fret:V}){const z=this;V===0?z.nbOpenStrings++:z.minFret===null?(z.minFret=V,z.maxFret=V):(z.minFret=Math.min(z.minFret,V),z.maxFret=Math.max(z.maxFret,V)),typeof z.fretCount[V]=="undefined"?z.fretCount[V]=1:z.fretCount[V]++}function Q(V){V.fretSpread=V.maxFret-V.minFret,g.default.getValues(V.fretCount).forEach(et=>{V.nbOccurences+=et-1})}function G(V){V.sort(k)}function k(V,z){return V.score-z.score}function K(V,z){const et=m(z),rt=(0,l.default)(V);if(rt===null)return null;const ht=d(rt);let ft=i(et,ht);return ft=g.default.map(ft,_),ft}function _(V,z){return z=T(z),z.forEach(F),G(z),z}const ot=3;function dt(V,z){const et=K(V,z),rt=v.default.getNbStaffLines(z);if(et===null)return J(rt);const ht=Mt(et);return ht===null?J(rt):(0,f.A)(ht,rt)}function Mt(V){if(V=g.default.filter(V,j),g.default.isEmpty(V))return null;let z=g.default.getKeys(V);z=z.map(ft=>parseInt(ft,10));const et=Math.min.apply(null,z),rt=V[et],[ht]=rt;return ht}function j(V,z){return z.length>0}function J(V){const z=[];return M.default.create(V,ot,1,z)}},764173:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(657107),v=t(436369),M=t(110976);const f=function(I,n,a){this.init(I,n,a)};f.NAME="primitive.AddOwnTempo";const l=f.prototype;l.name=f.NAME,l.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},l.perform=function(){this.addTempo(),this.updateStack()},l.addTempo=function(){const I=M.default.copy(this.opts.tempo);this.commonContent.setOwnTempo(this.opts.measureIdx,I)},l.updateStack=function(){const I=this.commonContent.getScoreData(),n=I.getNbParts();for(let a=0;a<n;a++){const D={type:this.name,opts:{partIdx:a,measureIdx:this.opts.measureIdx}};this.cancelStack.push(D)}(0,v.A)(this.cancelStack,I,this.opts)};const r=f,u=function(I,n,a){this.init(I,n,a)};u.NAME="composite.AddOwnTempoIfNeeded";const c=u.prototype;c.name=u.NAME,c.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.needAddOwnTempo()&&this.addOwnTempo()},c.needAddOwnTempo=function(){return this.hasOwnTempo()?!this.hasSameTempo():!0},c.hasOwnTempo=function(){return this.commonContent.hasOwnTempo(this.opts.measureIdx)},c.hasSameTempo=function(){const I=this.commonContent.getOwnTempo(this.opts.measureIdx);return M.default.isSame(I,this.opts.tempo)},c.addOwnTempo=function(){const I=M.default.copy(this.opts.tempo),n={measureIdx:this.opts.measureIdx,tempo:I};new r(this.commonContent,n,this.cancelStack).perform()};const m=u,o=function(I,n,a){this.init(I,n,a)};o.NAME="primitive.RemoveOwnTempo";const s=o.prototype;s.name=o.NAME,s.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},s.perform=function(){this.removeOwnTempo(),this.updateStack()},s.removeOwnTempo=function(){this.commonContent.removeOwnTempo(this.opts.measureIdx)},s.updateStack=function(){const I=this.commonContent.getScoreData(),n=I.getNbParts();for(let a=0;a<n;a++){const D={type:this.name,opts:{partIdx:a,measureIdx:this.opts.measureIdx}};this.cancelStack.push(D)}(0,v.A)(this.cancelStack,I,this.opts)};const d=o,h=function(I,n,a){this.init(I,n,a)};h.NAME="composite.RemoveOwnTempoIfNeeded";const e=h.prototype;e.name=h.NAME,e.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.hasOwnTempo()&&this.removeOwnTempo()},e.hasOwnTempo=function(){return this.commonContent.hasOwnTempo(this.opts.measureIdx)},e.removeOwnTempo=function(){const I={measureIdx:this.opts.measureIdx};new d(this.commonContent,I,this.cancelStack).perform()};const i=h,p=function(I,n,a){this.init(I,n,a)};p.NAME="composite.UpdateOwnTempo";const x=p.prototype;x.name=p.NAME,x.init=function(I,n,a){this.commonContent=(0,g.A)(I),this.cancelStack=a,this.opts=n},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.shouldHaveOwnTempo()?this.addOwnTempo():this.removeOwnTempo()},x.shouldHaveOwnTempo=function(){return this.hasPreviousMeasure()?this.isPreviousTempoDifferent():!0},x.hasPreviousMeasure=function(){return this.opts.measureIdx>0},x.isPreviousTempoDifferent=function(){const I=this.getCurrentMeasureTempo(),n=this.getPreviousMeasureTempo();return!M.default.isSame(I,n)},x.getCurrentMeasureTempo=function(){return this.commonContent.getTempo(this.opts.measureIdx)},x.getPreviousMeasureTempo=function(){return this.commonContent.getTempo(this.opts.measureIdx-1)},x.addOwnTempo=function(){let I=this.getCurrentMeasureTempo();I=M.default.copy(I);const n={measureIdx:this.opts.measureIdx,tempo:I};new m(this.commonContent,n,this.cancelStack).perform()},x.removeOwnTempo=function(){const I={measureIdx:this.opts.measureIdx};new i(this.commonContent,I,this.cancelStack).perform()};const S=p},764591:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(764173),v=t(217530);const M=function(r,u,c){this.init(r,u,c)};M.NAME="composite.RemoveCommonContentMeasure";const f=M.prototype;f.name=M.NAME,f.init=function(r,u,c){this.scoreData=r,this.cancelStack=c,this.opts=u},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMeasure(),this.hasRemovedAtEnd()||(this.updateOwnTempo(),this.updateOwnSwing())},f.removeMeasure=function(){this.scoreData.getCommonContent().removeMeasure(this.opts.measureIdx)},f.hasRemovedAtEnd=function(){const u=this.scoreData.getCommonContent().getNbMeasures();return this.opts.measureIdx===u},f.updateOwnTempo=function(){const r={measureIdx:this.opts.measureIdx};new g.A(this.scoreData,r,this.cancelStack).perform()},f.updateOwnSwing=function(){const r={measureIdx:this.opts.measureIdx};new v.A(this.scoreData,r,this.cancelStack).perform()};const l=M},764994:(H,P,t)=>{t.d(P,{A:()=>r});var g=t(515819),v=t(366274),M=t(793317);const f=function(u,c,m){this.init(u,c,m)};f.NAME="composite.RemoveSpaceTupletsCrossMeasure";const l=f.prototype;l.name=f.NAME,l.initMeasureData=M.default,l.init=function(u,c,m){this.initMeasureData(u,c),this.cancelStack=m,this.opts=c,this.measure=null,this.quarterPosition=null,this.quarterDuration=null,this.endReached=!1},l.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.quarterPosition=this.opts.quarterPosition,this.measureIdx=this.opts.measureIdx,this.quarterDuration=this.opts.quarterDuration;!this.isDone();)this.removeSpaceTuplets(),this.moveForward()},l.isDone=function(){return this.quarterDuration===0||this.endReached},l.removeSpaceTuplets=function(){const u=this.getSegmentDuration(),c={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:u};new v.A(this.measureData,c,this.cancelStack).perform(),this.quarterDuration-=u},l.getSegmentDuration=function(){const c=this.getMeasureDuration()-this.quarterPosition;return Math.min(c,this.quarterDuration)},l.getMeasureDuration=function(){const u=this.measureData.getAnyTime();return g.default.timeToQuarter(u)},l.moveForward=function(){this.measureData.hasNextMeasure()?(this.measureData=this.measureData.getNextMeasure(),this.measureIdx++,this.quarterPosition=0):this.endReached=!0};const r=f},767260:(H,P,t)=>{t.d(P,{A:()=>W});var g=t(746822),v=t(316610),M=t(868743),f=t(606106),l=t(701387),r=t(210888),u=t(364842),c=t(446921),m=t(584416),o=t(852363);const s=function(F,E,U){this.init(F,E,U)};s.NAME="primitive.AddPedal";const d=s.prototype;d.name=s.NAME,d.init=function(F,E,U){this.scoreData=F,this.cancelStack=U,this.opts=E,this.pedalIdx=null,this.localTimePos=null},d.perform=function(){this.addPedal(),this.updateStack()},d.addPedal=function(){const F=this.getMeasure();this.insertedPedal=this.createPedal();const E=this.getPedalIdx(),U=l.default.getPedals(F,this.opts.staffIdx);U.splice(E,0,this.insertedPedal),l.default.setPedals(F,this.opts.staffIdx,U)},d.getPedalIdx=function(){return this.pedalIdx===null&&this.fetchPedalIdx(),this.pedalIdx},d.fetchPedalIdx=function(){const F=this.getMeasure(),E=l.default.getPedals(F,this.opts.staffIdx);if(E.some(this.tryPedalIdx,this),this.pedalIdx===null){const U=E.length;this.pedalIdx=U}},d.tryPedalIdx=function(F,E){const U=m.A.compare(this.insertedPedal,F);if(U>0)return!1;if(U<0)return this.pedalIdx=E,!0;if(U===0){const Q="There is already a pedal at this time position.";throw new u.default("TimePosCollision",Q)}else throw new u.default("Unexpected")},d.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},d.createPedal=function(){const F=m.A.create(this.opts.staffIdx,this.opts.placement,this.opts.timePos,this.opts.type);return m.A.isStart(F)&&typeof this.opts.pedalUuid!="undefined"&&(m.A.setPedalUuid(F,this.opts.pedalUuid),this.storePedalUuid()),F},d.storePedalUuid=function(){const F=this.scoreData.getMeasureUuid(this.opts.measureIdx),E=this.scoreData.getPartContent(this.opts.partIdx),U={measureUuid:F,pedalUuid:this.opts.pedalUuid};c.A.addPedal(E,U)},d.updateStack=function(){const F=this.getMeasure(),E=l.default.getDivisions(F),U={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,timePos:this.opts.timePos,divisions:E,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.push(U),(0,o.default)(this.cancelStack,this.scoreData,this.opts)};const h=s;var e=t(468852);const i=function(F,E,U){this.init(F,E,U)};i.NAME="primitive.AddPedalContinue";const p=i.prototype;p.name=i.NAME,p.init=function(F,E,U){this.scoreData=F,this.cancelStack=U,this.opts=E},p.perform=function(){this.addLeftPedal(),this.addRightPedal(),this.updateStack()},p.addLeftPedal=function(){const F=this.getLeftMeasure(),E=this.createDirection(e.A.RIGHT);l.default.setRightPedal(F,this.opts.staffIdx,E)},p.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},p.addRightPedal=function(){const F=this.getRightMeasure(),E=this.createDirection(e.A.LEFT);l.default.setLeftPedal(F,this.opts.staffIdx,E)},p.createDirection=function(F){const E=m.A.create(this.opts.staffIdx,this.opts.placement,0,M.A.CONTINUE,F);return m.A.setPedalUuid(E,this.opts.pedalUuid),E},p.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},p.updateStack=function(){const F={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement}};this.cancelStack.push(F),(0,o.default)(this.cancelStack,this.scoreData,this.opts)};const x=i;var S=t(726042),I=t(605268),n=t(519405);const a=function(F,E,U){this.init(F,E,U)};a.NAME="composite.RemovePedalsRange";const D=a.prototype;D.name=a.NAME,D.init=function(F,E,U){this.scoreData=F,this.opts=E,this.cancelStack=U,this.currentMeasureIdx=null},D.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftPedals(),this.removeLeftMeasurePedals(),this.removeMiddleMeasurePedals(),this.removeRightMeasurePedals()},D.removeLeftPedals=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;const F=this.getMeasure(this.currentMeasureIdx);let E=l.default.getPedals(F,this.opts.staffIdx);if(E=E.filter(function(U){return this.isBeforeLimit(U,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),E.length!==0){const U=E.pop();T(U)&&this.removeFromEntry(U)}else this.hasLeftPedal()&&this.removeCrossMeasurePedal()},D.removeCrossMeasurePedal=function(){this.removePedal(0,1,this.opts.staffIdx)},D.removeLeftMeasurePedals=function(){let F=this.getPedalStarts();F=F.filter(this.isWithinLimits,this),F.forEach(this.removeFromEntry,this);let E=this.getPedalsStops();E=E.filter(this.isWithinLimits,this),E.forEach(this.removeFromEntry,this)},D.removeMiddleMeasurePedals=function(){for(let F=this.opts.startMeasureIdx+1;F<this.opts.stopMeasureIdx;F++)this.currentMeasureIdx=F,this.getPedalStarts().forEach(this.removeFromEntry,this),this.getPedalsStops().forEach(this.removeFromEntry,this)},D.removeRightMeasurePedals=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;let F=this.getPedalStarts();F=F.filter(this.isWithinLimits,this),F.forEach(this.removeFromEntry,this);let E=this.getPedalsStops();E=E.filter(this.isWithinLimits,this),E.forEach(this.removeFromEntry,this)},D.removeFromEntry=function(F){const E=m.A.getTimePos(F),U=m.A.getStaffIdx(F),Q=this.getMeasure(this.currentMeasureIdx),G=l.default.getDpq(Q);this.removePedal(E,G,U)},D.removePedal=function(F,E,U){const Q={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:F,dpq:E,staffIdx:U},G=new I.default(this.scoreData,Q,this.cancelStack);(0,n.default)(G)},D.isWithinLimits=function(F){return this.currentMeasureIdx<this.opts.startMeasureIdx||this.currentMeasureIdx>this.opts.stopMeasureIdx?!1:this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx?!0:!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(F,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)||this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(F,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))},D.isAfterLimit=function(F,E,U,Q){const G=this.getMeasure(E),k=l.default.getDpq(G),K=S.default.lcm(k,Q),_=m.A.getTimePos(F)*K/k,ot=U*K/Q;return!(_<ot||_===ot&&m.A.isStop(F))},D.isBeforeLimit=function(F,E,U,Q){const G=this.getMeasure(E),k=l.default.getDpq(G),K=S.default.lcm(k,Q),_=m.A.getTimePos(F)*K/k,ot=U*K/Q;return!(_>ot||_===ot&&m.A.isStart(F))},D.getPedalStarts=function(){const F=this.getMeasure(this.currentMeasureIdx);let E=l.default.getPedals(F,this.opts.staffIdx);return E=E.filter(T),E};const T=function(F){return m.A.getType(F)===M.A.START};D.getPedalsStops=function(){const F=this.getMeasure(this.currentMeasureIdx);let E=l.default.getPedals(F,this.opts.staffIdx);return E=E.filter(N),E};const N=function(F){return m.A.getType(F)===M.A.STOP};D.getMeasure=function(F){return this.scoreData.getMeasure(this.opts.partIdx,F)},D.hasLeftPedal=function(){const F=this.getMeasure(this.currentMeasureIdx);return l.default.hasLeftPedal(F,this.opts.staffIdx)};const y=a,A=function(F,E,U){this.init(F,E,U)};A.NAME="composite.AddPedal";const R=A.prototype;R.name=A.NAME,R.init=function(F,E,U){this.scoreData=F,this.cancelStack=U,this.opts=E},R.perform=function(){this.updateStartDpq(),this.updateStopDpq(),this.removeExistingPedals(),this.pedalUuid=r.default.generate(),this.cancelStack.addEntityUuid({entityType:f.A.PEDAL,uuid:this.pedalUuid}),this.addPedalLeftSide(),this.addPedalRightSide(),this.addPedalContinues()},R.updateStartDpq=function(){const F={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new g.A(this.scoreData,F,this.cancelStack).perform();const U=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),Q={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,v.A)(Q,U),this.opts.startDpq=l.default.getDpq(U)},R.updateStopDpq=function(){const F={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new g.A(this.scoreData,F,this.cancelStack).perform();const U=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),Q={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};if(this.opts.stopTimePos=(0,v.A)(Q,U),this.opts.stopDpq=l.default.getDpq(U),this.opts.startMeasureIdx===this.opts.stopMeasureIdx){const G={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,v.A)(G,U),this.opts.startDpq=l.default.getDpq(U)}},R.removeExistingPedals=function(){const F={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,startDpq:this.opts.startDpq,stopTimePos:this.opts.stopTimePos,stopDpq:this.opts.stopDpq};new y(this.scoreData,F,this.cancelStack).perform()},R.addPedalLeftSide=function(){const F={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,placement:this.opts.placement,type:M.A.START,staffIdx:this.opts.staffIdx,pedalUuid:this.pedalUuid};new h(this.scoreData,F,this.cancelStack).perform()},R.addPedalRightSide=function(){const F={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,placement:this.opts.placement,type:M.A.STOP,staffIdx:this.opts.staffIdx};new h(this.scoreData,F,this.cancelStack).perform()},R.addPedalContinues=function(){for(let F=this.opts.startMeasureIdx;F<this.opts.stopMeasureIdx;F++)this.addPedalContinue(F)},R.addPedalContinue=function(F){const E={partIdx:this.opts.partIdx,measureIdx:F,placement:this.opts.placement,staffIdx:this.opts.staffIdx,pedalUuid:this.pedalUuid};new x(this.scoreData,E,this.cancelStack).perform()};const W=A},768268:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(123491),v=t(292681),M=t(793317),f=t(343667),l=t(852363);const r=function(m,o,s){this.init(m,o,s)};r.NAME="primitive.AddGraceToChordPercu";const u=r.prototype;u.name=r.NAME,u.initMeasureData=M.default,u.init=function(m,o,s){this.initMeasureData(m,o),this.cancelStack=s,this.opts=o},u.perform=function(){const m=this.getVoice(),o=m.getGrace(this.opts.noteIdx,this.opts.graceIdx),s=this.createNote(o,m);m.addGraceToChord(s,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},u.getVoice=function(){const m=this.opts.voiceIdx;return this.measureData.getVoice(m)},u.createNote=function(m,o){const s=g.default.getDurationType(m),d={};g.default.makeGrace(d),g.default.setStaffIdx(d,this.opts.staffIdx),g.default.setVoiceIdx(d,this.opts.voiceIdx),g.default.setDurationType(d,s);const h=v.default.copy(this.opts.unpitched);g.default.setUnpitched(d,h),g.default.setHead(d,this.opts.notehead);const e=this.getUnpitchedInstrumentId();g.default.setInstrumentId(d,e);const i=o.getRangeSpace(0,this.opts.noteIdx);return g.default.setTimePos(d,i),d},u.getUnpitchedInstrumentId=function(){return(0,f.A)(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead)},u.updateStack=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},o={type:this.name,opts:m};this.cancelStack.push(o),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const c=r},774419:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(843678),v=t(129283),M=t(351277);function f(s){const d={};s.forEach(l,d);let h=g.default.getValues(d);return h=h.filter(o),h}function l(s){const d=this,h=r(s);let e;typeof d[h]=="undefined"?(e=u(s),d[h]=e):e=d[h],m(e,s)}function r(s){const d=c(s),{number:h}=s;return`${d}-${h}`}function u(s){return{noteIdx:c(s),number:s.number,leftPitch:null,rightPitch:null}}function c({glissandoType:s,noteIdx:d}){return s===v.default.STOP?d--:s===v.default.START||v.default.raiseError(s),d}function m(s,d){const{glissandoType:h}=d;h===v.default.START?s.leftPitch=M.default.copy(d):h===v.default.STOP?s.rightPitch=M.default.copy(d):v.default.raiseError(h)}function o({leftPitch:s,rightPitch:d}){return s!==null&&d!==null}},785440:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(701387),v=t(838603),M=t(852363);const f=function(e,i,p){this.init(e,i,p)};f.NAME="primitive.AddMeasureRepeat";const l=f.prototype;l.name=f.NAME,l.init=function(e,i,p){this.scoreData=e,this.cancelStack=p,this.opts=i,this.measure=null},l.perform=function(){this.addMeasureRepeat(),this.updateStack()},l.addMeasureRepeat=function(){const e=this.getMeasure(),i=this.createMeasureRepeat();g.default.setMeasureRepeat(e,this.opts.staffIdx,i)},l.createMeasureRepeat=function(){const e=v.A.create(this.opts.patternNbMeasures,this.opts.nbSlashes);return v.A.setPatternMeasureIdx(e,this.opts.patternMeasureIdx),e},l.getMeasure=function(){return this.measure===null&&(this.measure=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)),this.measure},l.updateStack=function(){const e={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(e),(0,M.default)(this.cancelStack,this.scoreData,this.opts)};const r=f;var u=t(991868),c=t(712844),m=t(519405),o=t(379668);const s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddMeasureRepeat";const d=s.prototype;d.name=s.NAME,d.init=function(e,i,p){this.scoreData=e,this.cancelStack=p,this.opts=i},d.perform=function(){this.removeMmr(),this.removeMeasureSlash(),this.clearStaffVoices(),this.addMeasureRepeat()},d.removeMmr=function(){(0,o.A)(this.scoreData,this.opts,this.cancelStack)},d.removeMeasureSlash=function(){const e=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(g.default.hasSlash(e,this.opts.staffIdx)){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx},p=new c.A(this.scoreData,i,this.cancelStack);(0,m.default)(p)}},d.clearStaffVoices=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,removeFloating:!1},i=new u.default(this.scoreData,e,this.cancelStack);(0,m.default)(i)},d.addMeasureRepeat=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,patternMeasureIdx:this.opts.patternMeasureIdx,patternNbMeasures:this.opts.patternNbMeasures,nbSlashes:this.opts.nbSlashes};new r(this.scoreData,e,this.cancelStack).perform()};const h=s},795639:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(123491),v=t(793317),M=t(852363);const f=function(h,e,i){this.init(h,e,i)};f.NAME="primitive.AddArticulation";const l=f.prototype;l.name=f.NAME,l.initMeasureData=v.default,l.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},l.perform=function(){const e=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);g.default.addArticulation(e,this.opts.articulationType),this.updateStack()},l.updateStack=function(){const h={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:this.opts.articulationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(h),(0,M.default)(this.cancelStack,this.measureData,this.opts)};const r=f;var u=t(379097),c=t(638908),m=t(601277);const o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.AddArticulation";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.measureData=h,this.opts=e,this.cancelStack=i},s.perform=function(){const e=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);this.hasIncompatibleArticulations(e)&&this.removeIncompatibleArticulations(e),this.hasIncompatibleNotations(e)&&this.removeIncompatibleNotations(),new r(this.measureData,this.opts,this.cancelStack).perform()},s.hasIncompatibleNotations=function(h){return g.default.hasNotation(h,m.default.FERMATA)&&g.default.isArticulationCompatibleWithNotation(h,this.opts.articulationType)},s.hasIncompatibleArticulations=function(h){return g.default.hasIncompatibleArticulations(h,this.opts.articulationType)},s.removeIncompatibleArticulations=function(h){g.default.getIncompatibleArticulations(h,this.opts.articulationType).forEach(function(i){const p={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:i,noteIdx:this.opts.noteIdx},x=new u.default(this.measureData,p,this.cancelStack);x.checkPreconditions(),x.perform()},this)},s.removeIncompatibleNotations=function(){const h={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:m.default.FERMATA,noteIdx:this.opts.noteIdx},e=new c.default(this.measureData,h,this.cancelStack);e.checkPreconditions(),e.perform()};const d=o},796851:(H,P,t)=>{t.d(P,{A:()=>Q});var g=t(612040),v=t(606106),M=t(701387),f=t(210888),l=t(746822),r=t(364842),u=t(558280),c=t(446921),m=t(852363);const o=function(G,k,K){this.init(G,k,K)};o.NAME="primitive.AddWedgeSide";const s=o.prototype;s.name=o.NAME,s.init=function(G,k,K){this.scoreData=G,this.cancelStack=K,this.opts=k,this.wedgeIdx=null},s.perform=function(){const G=this.getMeasure();this.insertedWedge=this.createWedge();const k=this.getWedgeIdx(),K=M.default.getWedges(G,this.opts.staffIdx);K.splice(k,0,this.insertedWedge),M.default.setWedges(G,this.opts.staffIdx,K),this.updateStack(G)},s.getWedgeIdx=function(){return this.wedgeIdx===null&&this.fetchWedgeIdx(),this.wedgeIdx},s.fetchWedgeIdx=function(){const G=this.getMeasure(),k=M.default.getWedges(G,this.opts.staffIdx);if(k.some(this.tryWedgeIdx,this),this.wedgeIdx===null){const K=k.length;this.wedgeIdx=K}},s.tryWedgeIdx=function(G,k){const K=u.A.compare(this.insertedWedge,G);if(K<0)return this.wedgeIdx=k,!0;if(K>0)return!1;if(K===0){const _="There is already a wedge at this time position.";throw new r.default("TimePosCollision",_)}else throw new r.default("Unexpected")},s.getMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},s.createWedge=function(){const G=this.opts.staffIdx,k=this.opts.placement,K=this.opts.timePos,_=this.opts.type;if(this.opts.location===g.A.LEFT){const ot=u.A.createStart(G,k,K,_,this.opts.nbNotes);return typeof this.opts.wedgeUuid!="undefined"&&(u.A.setWedgeUuid(ot,this.opts.wedgeUuid),this.storeWedgeUuid()),ot}else{if(this.opts.location===g.A.RIGHT&&this.opts.nbNotes===null)return u.A.createStop(G,k,K,_);throw new r.default("Unexpected")}},s.storeWedgeUuid=function(){const G=this.scoreData.getMeasureUuid(this.opts.measureIdx),k=this.scoreData.getPartContent(this.opts.partIdx),K={measureUuid:G,wedgeUuid:this.opts.wedgeUuid};c.A.addWedge(k,K)},s.updateStack=function(){const G={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(G),(0,m.default)(this.cancelStack,this.scoreData,this.opts)};const d=o;var h=t(952818),e=t(782615),i=t(717434);const p=function(G,k,K){this.init(G,k,K)};p.NAME="primitive.AddWedgeContinue";const x=p.prototype;x.name=p.NAME,x.init=function(G,k,K){this.scoreData=G,this.cancelStack=K,this.opts=k},x.perform=function(){this.addLeftWedge(),this.addRightWedge(),this.updateStack()},x.addLeftWedge=function(){const G=this.getLeftMeasure(),k=this.createLeftDirection();M.default.setRightWedge(G,this.opts.staffIdx,k)},x.getLeftMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx)},x.createLeftDirection=function(){return this.createDirection(g.A.RIGHT_CONTINUE)},x.addRightWedge=function(){const G=this.getRightMeasure(),k=this.createRightDirection();M.default.setLeftWedge(G,this.opts.staffIdx,k)},x.getRightMeasure=function(){return this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx+1)},x.createRightDirection=function(){return this.createDirection(g.A.LEFT_CONTINUE)},x.createDirection=function(G){const k={};h.A.setStaffIdx(k,this.opts.staffIdx),h.A.setPlacement(k,this.opts.placement);const K=e.A.create(G,this.opts.type),_=i.A.createWedge(K);return h.A.setEntry(k,_),u.A.setWedgeUuid(k,this.opts.wedgeUuid),k},x.updateStack=function(){const G={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:this.opts.staffIdx,placement:this.opts.placement,type:this.opts.type}};this.cancelStack.push(G),(0,m.default)(this.cancelStack,this.scoreData,this.opts)};const S=p;var I=t(889600);const n=I.A;var a=t(474620),D=t(316610),T=t(379668),N=t(726042),y=t(889484),A=t(519405);const R=function(G,k,K){this.init(G,k,K)};R.NAME="composite.RemoveWedgesRange";const W=R.prototype;W.name=R.NAME,W.init=function(G,k,K){this.scoreData=G,this.opts=k,this.cancelStack=K,this.currentMeasureIdx=null},W.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeLeftWedges(),this.removeLeftMeasureWedges(),this.removeMiddleMeasureWedges(),this.removeRightMeasureWedges()},W.removeLeftWedges=function(){this.currentMeasureIdx=this.opts.startMeasureIdx;const G=this.getMeasure(this.currentMeasureIdx);let k=this.getWedges(G);if(k=k.filter(function(K){return this.isBeforeLimit(K,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)},this),k.length!==0){const K=k.pop();u.A.isLeft(K)&&this.removeFromEntry(K)}else this.hasLeftWedge()&&this.removeCrossMeasureWedge()},W.removeCrossMeasureWedge=function(){this.removeWedge(0,1,this.opts.staffIdx)},W.removeLeftMeasureWedges=function(){let G=this.getWedgesStarts();G=G.filter(this.isWithinLimits,this),G.forEach(this.removeFromEntry,this);let k=this.getWedgesStops();k=k.filter(this.isWithinLimits,this),k.forEach(this.removeFromEntry,this)},W.removeMiddleMeasureWedges=function(){for(let G=this.opts.startMeasureIdx+1;G<this.opts.stopMeasureIdx;G++)this.currentMeasureIdx=G,this.getWedgesStarts().forEach(this.removeFromEntry,this),this.getWedgesStops().forEach(this.removeFromEntry,this)},W.removeRightMeasureWedges=function(){this.currentMeasureIdx=this.opts.stopMeasureIdx;let G=this.getWedgesStarts();G=G.filter(this.isWithinLimits,this),G.forEach(this.removeFromEntry,this);let k=this.getWedgesStops();k=k.filter(this.isWithinLimits,this),k.forEach(this.removeFromEntry,this)},W.removeFromEntry=function(G){const k=u.A.getTimePos(G),K=u.A.getStaffIdx(G),_=this.getMeasure(this.currentMeasureIdx),ot=M.default.getDpq(_);this.removeWedge(k,ot,K)},W.removeWedge=function(G,k,K){const _={partIdx:this.opts.partIdx,measureIdx:this.currentMeasureIdx,timePos:G,dpq:k,staffIdx:K},ot=new y.default(this.scoreData,_,this.cancelStack);(0,A.default)(ot)},W.isWithinLimits=function(G){return this.currentMeasureIdx<this.opts.startMeasureIdx||this.currentMeasureIdx>this.opts.stopMeasureIdx?!1:this.currentMeasureIdx>this.opts.startMeasureIdx&&this.currentMeasureIdx<this.opts.stopMeasureIdx?!0:!(this.currentMeasureIdx===this.opts.startMeasureIdx&&!this.isAfterLimit(G,this.opts.startMeasureIdx,this.opts.startTimePos,this.opts.startDpq)||this.currentMeasureIdx===this.opts.stopMeasureIdx&&!this.isBeforeLimit(G,this.opts.stopMeasureIdx,this.opts.stopTimePos,this.opts.stopDpq))},W.isAfterLimit=function(G,k,K,_){const ot=this.getMeasure(k),dt=M.default.getDpq(ot),Mt=N.default.lcm(dt,_),j=u.A.getTimePos(G)*Mt/dt,J=K*Mt/_;return!(j<J||j===J&&u.A.isRight(G))},W.isBeforeLimit=function(G,k,K,_){const ot=this.getMeasure(k),dt=M.default.getDpq(ot),Mt=N.default.lcm(dt,_),j=u.A.getTimePos(G)*Mt/dt,J=K*Mt/_;return!(j>J||j===J&&u.A.isLeft(G))},W.getWedgesStarts=function(){const G=this.getMeasure(this.currentMeasureIdx);let k=this.getWedges(G);return k=k.filter(u.A.isLeft),k},W.getWedgesStops=function(){const G=this.getMeasure(this.currentMeasureIdx);let k=this.getWedges(G);return k=k.filter(u.A.isRight),k},W.getWedges=function(G){return M.default.getWedges(G,this.opts.staffIdx)},W.getMeasure=function(G){return this.scoreData.getMeasure(this.opts.partIdx,G)},W.hasLeftWedge=function(){const G=this.getMeasure(this.currentMeasureIdx);return M.default.hasLeftWedge(G,this.opts.staffIdx)};const F=R,E=function(G,k,K){this.init(G,k,K)};E.NAME="composite.AddWedge";const U=E.prototype;U.name=E.NAME,U.init=function(G,k,K){this.scoreData=G,this.cancelStack=K,this.opts=k},U.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMmr(),this.updateStartDpq(),this.updateStopDpq(),this.removeExistingWedges(),this.wedgeUuid=f.default.generate(),this.cancelStack.addEntityUuid({entityType:v.A.WEDGE,uuid:this.wedgeUuid}),this.addWedgeLeftSide(),this.addWedgeRightSide(),this.addWedgeContinues()},U.removeMmr=function(){(0,T.A)(this.scoreData,{measureIdx:this.opts.startMeasureIdx},this.cancelStack),(0,T.A)(this.scoreData,{measureIdx:this.opts.stopMeasureIdx},this.cancelStack)},U.updateStartDpq=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,dpq:this.opts.startDpq};new l.A(this.scoreData,G,this.cancelStack).perform();const K=this.scoreData.getMeasure(this.opts.partIdx,this.opts.startMeasureIdx),_={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,D.A)(_,K),this.opts.startDpq=M.default.getDpq(K)},U.updateStopDpq=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};new l.A(this.scoreData,G,this.cancelStack).perform();const K=this.scoreData.getMeasure(this.opts.partIdx,this.opts.stopMeasureIdx),_={timePos:this.opts.stopTimePos,dpq:this.opts.stopDpq};if(this.opts.stopTimePos=(0,D.A)(_,K),this.opts.stopDpq=M.default.getDpq(K),this.opts.startMeasureIdx===this.opts.stopMeasureIdx){const ot={timePos:this.opts.startTimePos,dpq:this.opts.startDpq};this.opts.startTimePos=(0,D.A)(ot,K),this.opts.startDpq=M.default.getDpq(K)}},U.removeExistingWedges=function(){const G={partIdx:this.opts.partIdx,staffIdx:this.opts.staffIdx,startMeasureIdx:this.opts.startMeasureIdx,stopMeasureIdx:this.opts.stopMeasureIdx,startTimePos:this.opts.startTimePos,stopTimePos:this.opts.stopTimePos,startDpq:this.opts.startDpq,stopDpq:this.opts.stopDpq};new F(this.scoreData,G,this.cancelStack).perform()},U.addWedgeLeftSide=function(){const G=this.getNbNotesInWedge(),k={partIdx:this.opts.partIdx,measureIdx:this.opts.startMeasureIdx,timePos:this.opts.startTimePos,placement:this.opts.placement,type:this.opts.type,location:g.A.LEFT,staffIdx:this.opts.staffIdx,nbNotes:G,wedgeUuid:this.wedgeUuid};new d(this.scoreData,k,this.cancelStack).perform()},U.getNbNotesInWedge=function(){const G=this.scoreData.getPartMeasures(this.opts.partIdx),k=new a.A(G,this.opts.partIdx,this.scoreData);return n(k,this.opts)},U.addWedgeRightSide=function(){const G={partIdx:this.opts.partIdx,measureIdx:this.opts.stopMeasureIdx,timePos:this.opts.stopTimePos,placement:this.opts.placement,type:this.opts.type,location:g.A.RIGHT,staffIdx:this.opts.staffIdx,nbNotes:null};new d(this.scoreData,G,this.cancelStack).perform()},U.addWedgeContinues=function(){for(let G=this.opts.startMeasureIdx;G<this.opts.stopMeasureIdx;G++)this.addWedgeContinue(G)},U.addWedgeContinue=function(G){const k={partIdx:this.opts.partIdx,measureIdx:G,placement:this.opts.placement,type:this.opts.type,staffIdx:this.opts.staffIdx,wedgeUuid:this.wedgeUuid};new S(this.scoreData,k,this.cancelStack).perform()};const Q=E},798459:(H,P,t)=>{t.d(P,{A:()=>r});var g=t(294148),v=t(640231),M=t(96410),f=t(351692);const r=function(u){g.A.check(u.chordFunction),v.A.check(u.kind);const c=v.A.getNbNotes(u.kind);if(M.A.check(u.inversion,c),f.A.check(u.alter),u.secondaryFunction){g.A.check(u.secondaryFunction),v.A.check(u.secondaryKind);const m=v.A.getNbNotes(u.secondaryKind);M.A.check(u.secondaryInversion,m),f.A.check(u.secondaryAlter)}}},798656:(H,P,t)=>{t.d(P,{A:()=>x});var g=t(209175),v=t(870437),M=t(515819),f=t(123491),l=t(476943),r=t(702868),u=t(259563),c=t(975924),m=t(3771),o=t(582458),s=t(737296),d=t(793317);const h=function(S,I,n){this.init(S,I,n)};h.NAME="composite.AddTuplet";const e=h.prototype;e.name=h.NAME,e.initMeasureData=d.default,e.init=function(S,I,n){this.initMeasureData(S,I),this.cancelStack=n,this.opts=I},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.gatherData(),this.increaseDivisionsIfNeeded(),this.createTuplet(),this.clearTupletCache(),this.resizeNotes()},e.gatherData=function(){const S=this.getUpperTimeModif();this.localTimeModif=r.A.getTimeModif(this.opts.tupletType),this.subTimeModif=g.default.combine(S,this.localTimeModif);const I=this.getUpperDurationType(),n=g.default.getShiftToShardDurationType(this.localTimeModif);this.subDurationType=I+n;const a=this.getUpperTupletLevel();this.subTupletLevel=a+1},e.getUpperDurationType=function(){const I=this.getVoice().getNote(this.opts.noteIdx),n=this.measureData.getDivisionsPerQuarterValue();return(0,c.default)(I,n)},e.getUpperTimeModif=function(){return this.getVoice().getAbsoluteTimeModif()},e.getUpperTupletLevel=function(){return this.getVoice().getTupletLevel()},e.increaseDivisionsIfNeeded=function(){const S=this.subTimeModif,I=this.subDurationType,n={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,durationType:I,nbDots:0,timeModif:g.default.copy(S)};new m.A(this.measureData,n,this.cancelStack).perform()},e.createTuplet=function(){const S=this.getVoice(),I=this.subTupletLevel,n=this.localTimeModif,a=this.subDurationType,D=v.A.createStart(I,n,a),T=v.A.createStop(I),N=S.getNote(this.opts.noteIdx),y=[D,T];f.default.addTupletBounds(N,y),p(S,this.opts.noteIdx).forEach(i,this.subTimeModif)};const i=function(S){let I=this;I=g.default.copy(I),f.default.setTimeModif(S,I)},p=function(S,I){return S.isRest(I)?[S.getNote(I)]:l.default.makeArray(S.getChord(I))};e.getVoice=function(){const S=this.opts.voiceIdx,I=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(S,I)},e.clearTupletCache=function(){this.measureData.clearTupletCache(this.opts.voiceIdx)},e.resizeNotes=function(){const S=this.getVoice(),I=this.getShardDuration(),n=S.getStartNoteIdx();for(let a=n;a<=S.getStopNoteIdx();a++){const D=S.getNote(a);f.default.getDuration(D)>I&&this.resizeNote(a)}},e.resizeNote=function(S){const n=this.getVoice().getDurationType(),a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:S,insertMode:s.default.REPLACE,durationType:n,nbDots:0,record:!1};new o.default(this.measureData,a,this.cancelStack).perform()},e.getShardDuration=function(){const S=this.getVoice(),I=this.measureData.getDivisionsPerQuarterValue(),n=S.getAbsoluteTimeModif(),a=S.getDurationType(),D=u.default.toQuarterDuration(a),T=M.default.quarterToDuration(D,I);return M.default.normalToActual(T,n)};const x=h},803562:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("The two notes must have the same duration."),this.name="DifferentDurationError"}}},809577:(H,P,t)=>{t.d(P,{A:()=>r});var g=t(39584);const v=function(u,c){typeof c.startTimePos!="undefined"&&typeof c.stopTimePos!="undefined"&&(M(u,c),f(u,c))},M=function(u,c){const m=u.getMeasureData(c.startMeasureIdx),o={voiceIdx:c.voiceIdx,divisions:c.startDivisions,timePos:c.startTimePos};(0,g.A)(m,o),delete c.startTimePos,c.startNoteIdx=o.noteIdx},f=function(u,c){const m=u.getMeasureData(c.stopMeasureIdx),o={voiceIdx:c.voiceIdx,divisions:c.stopDivisions,timePos:c.stopTimePos};(0,g.A)(m,o),delete c.stopTimePos,c.stopNoteIdx=o.noteIdx},r=v},815749:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(123491),v=t(793317),M=t(578918),f=t(852363);const l=function(c,m,o){this.init(c,m,o)};l.NAME="primitive.AddGhostNote";const r=l.prototype;r.name=l.NAME,r.initMeasureData=v.default,r.init=function(c,m,o){this.initMeasureData(c,m),this.cancelStack=o,this.opts=m},r.perform=function(){this.addGhostNote(),this.updateStack()},r.addGhostNote=function(){const c=this.measureData.getVoice(this.opts.voiceIdx),m=(0,M.default)(c,this.opts.noteIdx,this.opts.pitch);g.default.addHeadParentheses(m)},r.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,f.default)(this.cancelStack,this.measureData,this.opts)};const u=l},820023:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("This operation is not possible on whole."),this.name="NotPossibleOnWholeError"}}},823880:(H,P,t)=>{t.d(P,{A:()=>s});var g=t(123491),v=t(515819),M=t(580668),f=t(792273),l=t(443923),r=t(82028),u=t(793317),c=t(519405);const m=function(d,h,e){this.init(d,h,e)};m.NAME="composite.RemoveSpaceChordsQuarter";const o=m.prototype;o.name=m.NAME,o.initMeasureData=u.default,o.init=function(d,h,e){this.initMeasureData(d,h),this.cancelStack=e,this.opts=h,this.measure=null,this.noteIdx=null,this.quarterPos=null},o.perform=function(){if(this.cancelStack=this.cancelStack.createSubstack(this.name),!!this.measureData.hasVoice(this.opts.voiceIdx))for(this.fetchNoteIdx(),this.fetchQuarterPos();!this.done();)this.isNote()?this.removeChord():this.unlockRest(),this.moveForward()},o.fetchNoteIdx=function(){const d=this.getDpq(),h=v.default.quarterToDuration(this.opts.quarterPosition,d),e=this.getVoice(),i=1;this.noteIdx=(0,r.default)(e,i,h)},o.isNote=function(){return!this.getVoice().isRest(this.noteIdx)},o.fetchQuarterPos=function(){const d=this.getTimePos(),h=this.getDpq();this.quarterPos=v.default.divisionsToQuarter(d,h)},o.getTimePos=function(){let d=0;const h=this.getVoice();for(let e=0;e<this.noteIdx;e++){const i=h.getNote(e),p=g.default.getDuration(i);d+=p}return d},o.done=function(){const h=this.getVoice().size();if(this.noteIdx>=h)return!0;const e=this.getEndQuarterPos();return this.quarterPos>=e},o.getEndQuarterPos=function(){return this.opts.quarterPosition+this.opts.quarterDuration},o.getDpq=function(){return this.measureData.getDpqValue()},o.removeChord=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx},h=this.getAction(),e=new h(this.measureData,d,this.cancelStack);(0,c.default)(e)},o.getAction=function(){return this.measureData.isUnpitched()?f.default:M.default},o.unlockRest=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx};new l.A(this.measureData,d,this.cancelStack).perform()},o.moveForward=function(){const d=this.getCurrentNoteQuarterDuration();this.quarterPos+=d,this.noteIdx++},o.getCurrentNoteQuarterDuration=function(){const h=this.getVoice().getNote(this.noteIdx),e=this.getDpq();return g.default.getQuarterDuration(h,e)},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)};const s=m},826557:(H,P,t)=>{t.d(P,{A:()=>c});var g=t(123491),v=t(292681),M=t(793317),f=t(343667),l=t(852363);const r=function(m,o,s){this.init(m,o,s)};r.NAME="primitive.InsertGraceNotePercu";const u=r.prototype;u.name=r.NAME,u.initMeasureData=M.default,u.init=function(m,o,s){this.initMeasureData(m,o),this.cancelStack=s,this.opts=o},u.perform=function(){const m=this.getVoice(),o=this.createNote(m);m.insertGrace(o,this.opts.noteIdx,this.opts.graceIdx),this.updateStack()},u.getVoice=function(){const m=this.opts.voiceIdx;return this.measureData.getVoice(m)},u.createNote=function(m){const o={};g.default.makeGrace(o),g.default.setStaffIdx(o,this.opts.staffIdx),g.default.setVoiceIdx(o,this.opts.voiceIdx),g.default.setDurationType(o,this.opts.durationType);const s=v.default.copy(this.opts.unpitched);g.default.setUnpitched(o,s),g.default.setHead(o,this.opts.notehead);const d=this.getUnpitchedInstrumentId();g.default.setInstrumentId(o,d);const h=m.getRangeSpace(0,this.opts.noteIdx);return g.default.setTimePos(o,h),o},u.getUnpitchedInstrumentId=function(){return(0,f.A)(this.measureData,this.opts.partIdx,this.opts.unpitched,this.opts.notehead)},u.updateStack=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx},o={type:this.name,opts:m};this.cancelStack.push(o),(0,l.default)(this.cancelStack,this.measureData,this.opts)};const c=r},829329:(H,P,t)=>{t.d(P,{A:()=>oe});var g=t(364842),v=t(607682),M=t(505657),f=t(623671),l=t(735696),r=t(847051),u=t(803562),c=t(954546),m=t(748803),o=t(727867),s=t(702868),d=t(601277),h=t(474976),e=t(359932),i=t(724095),p=t(737903),x=t(726042),S=t(843678),I=t(123491),n=t(351277),a=t(515819),D=t(209175),T=t(701387),N=t(292681),y=t(526881),A=t(907893),R=t(405347),W=t(551303),F=t(974106),E=t(296825),U=t(744731),Q=t(412502),G=t(516e3),k=t(684592),K=t(149851),_=t(902224),ot=t(321875),dt=t(504005),Mt=t(946330),j=t(310107),J=t(883740),V=t(460547),z=t(195783),et=t(326582),rt=t(417843),ht=t(674212),ft=t(974116),xt=t(908617),St=t(684705),Pt=t(111262),At=t(652804),lt=t(663273),Y=t(19551),C=t(258392),O=t(320725),B=t(744264),w=t(534250),$=t(233113),tt=t(678366),at=t(540781),st=t(934013),ct=t(742253),pt=t(554657),gt=t(594306),Dt=t(515561),Et=t(757785),Ct=t(15635),Nt=t(823880),Rt=t(793317);const yt=function(L,b,X){this.init(L,b,X)};yt.NAME="composite.RemoveSpaceChordsQuarterCrossMeasure";const Tt=yt.prototype;Tt.name=yt.NAME,Tt.initMeasureData=Rt.default,Tt.init=function(L,b,X){this.initMeasureData(L,b),this.cancelStack=X,this.opts=b,this.measure=null,this.quarterPosition=null,this.quarterDuration=null,this.endReached=!1},Tt.perform=function(){for(this.cancelStack=this.cancelStack.createSubstack(this.name),this.quarterPosition=this.opts.quarterPosition,this.measureIdx=this.opts.measureIdx,this.quarterDuration=this.opts.quarterDuration;!this.isDone();)this.removeSpaceChords(),this.moveForward()},Tt.isDone=function(){return this.quarterDuration===0||this.endReached},Tt.removeSpaceChords=function(){const L=this.getSegmentDuration(),b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:this.quarterPosition,quarterDuration:L};new Nt.A(this.measureData,b,this.cancelStack).perform(),this.quarterDuration-=L},Tt.getSegmentDuration=function(){const b=this.getMeasureDuration()-this.quarterPosition;return Math.min(b,this.quarterDuration)},Tt.getMeasureDuration=function(){const L=this.measureData.getAnyTime();return a.default.timeToQuarter(L)},Tt.moveForward=function(){this.measureData.hasNextMeasure()?(this.measureData=this.measureData.getNextMeasure(),this.measureIdx++,this.quarterPosition=0):this.endReached=!0};const Ht=yt;var Gt=t(764994),jt=t(27912),ut=t(519405),Qt=t(750026),bt=t(354065),zt=t(2110),Jt=t(774419),Ut=t(691309),Lt=t(737296),Xt=t(353922),Bt=t(760367),$t=t(435808);const kt=function(L,b,X){this.init(L,b,X)};kt.NAME="action.InsertVoiceContentCrossMeasure";const q=kt.prototype;q.name=kt.NAME,q.init=function(L,b,X){this.measuresScroller=(0,zt.A)(L,b),this.scoreData=this.measuresScroller.getScoreData(),this.cancelStack=X,this.opts=b,this.notesQuarterDuration=null,this.quarterPos=null,this.noteIdx=null,this.measureIdx=null,this.measuresScroller=null,this.locationsMap={}},q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureIdx=this.opts.measureIdx,this.timePos=this.opts.timePos,this.dpq=this.opts.dpq,this.clearSpace(),this.insertNotes(),this.storePosition(),this.insertTies(),this.insertSlurs(),this.insertGlissandos(),this.insertSlides(),this.insertTremolos(),this.insertHammerOnPullOffs()},q.clearSpace=function(){this.removeSpaceTuplets(),this.removeSpaceChords()},q.removeSpaceTuplets=function(){const L=this.getQuarterPos(),b=this.getNotesQuarterDuration(),X={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:L,quarterDuration:b},Z=this.getMeasureData();new Gt.A(Z,X,this.cancelStack).perform()},q.removeSpaceChords=function(){const L=this.getQuarterPos(),b=this.getNotesQuarterDuration(),X={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:L,quarterDuration:b},Z=this.getMeasureData();new Ht(Z,X,this.cancelStack).perform()},q.getQuarterPos=function(){return this.quarterPos===null&&(this.quarterPos=a.default.divisionsToQuarter(this.opts.timePos,this.opts.dpq)),this.quarterPos},q.getNotesQuarterDuration=function(){return this.notesQuarterDuration===null&&(this.notesQuarterDuration=(0,bt.A)(this.opts.data.notes)),this.notesQuarterDuration},q.insertNotes=function(){this.opts.data.notes.forEach(this.insertNote,this)},q.insertNote=function(L,b){this.needAddMeasure()&&this.addMeasure(),this.noteData=L,this.relativeNoteIdx=b,typeof L.tuplet!="undefined"&&this.insertTuplet(),L.isRest?(this.resizeRest(),this.noteData.color&&this.addRestColor(),this.opts.restLyrics&&(this.addLyrics(),this.addRestArticulations())):(this.insertChord(),this.insertGraces(),this.addChordAttributes()),this.recordLocation(),this.moveForward()},q.needAddMeasure=function(){const L=this.scoreData.getNbMeasures();if(this.measureIdx<L)return!1;if(this.measureIdx===L)return!0;throw new g.default("Unexpected")},q.addMeasure=function(){const L={measureIdx:this.measureIdx},b=new y.default(this.scoreData,L,this.cancelStack);(0,ut.default)(b),this.measuresScroller=null},q.insertTuplet=function(){this.showVoiceIfNeeded();const L=this.noteData.tuplet.timeModif,b=D.default.getWholeNbDots(L),X=D.default.getShiftToWholeDurationType(L),Z=this.noteData.tuplet.durationType+X,it=this.getNoteLocation();it.insertMode=Lt.default.REPLACE,it.durationType=Z,it.nbDots=b,it.formatRests=!1;const nt=this.getMeasureData(),mt=nt.getDpqValue(),vt=nt.getVoice(this.opts.voiceIdx).getNote(it.noteIdx),Ot=I.default.getNormalQuarterDuration(vt,mt);if(a.default.durationOptsToQuarter(it)!==Ot){const ne=new R.default(nt,it,this.cancelStack);(0,ut.default)(ne)}const ae=s.A.fromTimeModif(L),Kt=this.getNoteLocation();Kt.tupletType=ae;const ie=new A.default(nt,Kt,this.cancelStack);(0,ut.default)(ie),nt.clearTupletCache(this.opts.voiceIdx)},q.resizeRest=function(){this.hasVoiceDisplayed()?this.changeRestDuration():this.isRestHoldingData()?(this.showVoice(),this.changeRestDuration()):this.addRestCrossMeasure()},q.isRestHoldingData=function(){return this.noteData.lyrics&&this.noteData.lyrics.length>0&&this.opts.restLyrics||this.noteData.articulations&&this.noteData.articulations[d.default.FERMATA]||this.noteData.color},q.addRestColor=function(){const L=this.getNoteLocation();L.color=this.noteData.color;const b=this.getMeasureData(),X=new $.default(b,L,this.cancelStack);(0,ut.default)(X)},q.changeRestDuration=function(){const L=this.getNoteLocation();L.durationType=this.noteData.durationType,L.nbDots=this.noteData.nbDots,L.formatRests=!1,L.insertMode=Lt.default.REPLACE;const b=this.getMeasureData();if(b.hasVoice(this.opts.voiceIdx)){const Z=b.getDpqValue(),nt=b.getVoice(this.opts.voiceIdx).getNote(L.noteIdx),mt=I.default.getNormalQuarterDuration(nt,Z);if(a.default.durationOptsToQuarter(L)===mt){this.measuresScroller=null;return}}L.forceShowVoice=!!this.noteData.color;const X=new F.default(b,L,this.cancelStack);(0,ut.default)(X),this.measuresScroller=null},q.addRestCrossMeasure=function(){const L=this.getQuarterLocation(),b={durationType:this.noteData.durationType,nbDots:this.noteData.nbDots};L.quarterDuration=a.default.durationOptsToQuarter(b);const X=new E.default(this.scoreData,L,this.cancelStack);(0,ut.default)(X),this.measuresScroller=null},q.insertChord=function(){if(this.showVoiceIfNeeded(),typeof this.noteData.heads!="undefined")this.insertPitchedChord(),this.addChordGhost(),this.addChordColor(),this.addChordHarmonic(),this.addChordDead(),this.addChordFingering(),this.addChordCourtesyAccidentals();else if(typeof this.noteData.instruments!="undefined")this.insertUnpitchedChord(),this.addChordGhostsPercu(),this.addChordColorsPercu();else throw new g.default("Unexpected")},q.showVoiceIfNeeded=function(){this.hasVoiceDisplayed()||this.showVoice()},q.showVoice=function(){const L=this.getMeasureData(),b={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx},X=new W.default(L,b,this.cancelStack);(0,ut.default)(X)},q.insertPitchedChord=function(){const L=this.getNoteLocation(),b=this.noteData.heads.map(_t);L.staffIdx=this.opts.staffIdx,L.durationType=this.noteData.durationType,L.nbDots=this.noteData.nbDots,L.heads=b,L.checkLine=!1;const X=this.getMeasureData(),Z=new U.default(X,L,this.cancelStack);(0,ut.default)(Z),this.measuresScroller=null};const _t=function(L){const X={pitch:n.default.copy(L.pitch)};return typeof L.fretData!="undefined"&&(X.fretData=(0,p.default)(L.fretData)),X};q.addChordGhost=function(){this.noteData.heads.filter(Ft).forEach(this.addHeadGhost,this)},q.addHeadGhost=function(L){const b=this.getNoteLocation();b.pitch=n.default.copy(L.pitch);const X=this.getMeasureData(),Z=new At.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.addChordDead=function(){this.noteData.heads.filter(Yt).forEach(this.addHeadDead,this)};function Yt({notehead:L}){return L&&L!==Xt.A.NORMAL}q.addHeadDead=function({pitch:L,notehead:b}){const X=this.getNoteLocation();X.pitch=n.default.copy(L),X.notehead=b;const Z=this.getMeasureData(),it=new at.default(Z,X,this.cancelStack);(0,ut.default)(it)},q.addChordColor=function(){this.noteData.heads.filter(Wt).forEach(this.addHeadColor,this)},q.addHeadColor=function(L){const b=this.getNoteLocation();b.pitch=n.default.copy(L.pitch),b.color=L.color;const X=this.getMeasureData(),Z=new Y.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.addChordFingering=function(){this.noteData.heads.filter(Zt).forEach(this.addHeadFingering,this)};function Zt(L){return typeof L.fingering!="undefined"}q.addHeadFingering=function(L){const b=this.getNoteLocation();b.pitch=n.default.copy(L.pitch),b.fingering=L.fingering;const X=this.getMeasureData(),Z=new C.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.addChordCourtesyAccidentals=function(){this.noteData.heads.filter(qt).forEach(this.addHeadCourtesyAccidental,this)};function qt(L){return L.hasCourtesyAccidental===!0}q.addHeadCourtesyAccidental=function(L){const b=this.getNoteLocation();b.pitch=n.default.copy(L.pitch);const X=this.getMeasureData(),Z=new Dt.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.addChordHarmonic=function(){this.noteData.heads.filter(te).forEach(this.addHeadHarmonic,this)};function te(L){return!!L.harmonic}q.addHeadHarmonic=function(L){const b=this.getNoteLocation();b.pitch=n.default.copy(L.pitch),b.type=L.harmonic;const X=this.getMeasureData(),Z=new tt.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.insertUnpitchedChord=function(){const L=this.getNoteLocation(),b=(0,p.default)(this.noteData.instruments);L.staffIdx=this.opts.staffIdx,L.durationType=this.noteData.durationType,L.nbDots=this.noteData.nbDots,L.instruments=b;const X=this.getMeasureData(),Z=new Q.default(X,L,this.cancelStack);(0,ut.default)(Z),this.measuresScroller=null},q.addChordGhostsPercu=function(){this.noteData.instruments.filter(Ft).forEach(this.addHeadGhostPercu,this)};const Ft=function(L){return L.isGhost};q.addHeadGhostPercu=function(L){const b=this.getNoteLocation();b.unpitched=N.default.copy(L.unpitched);const X=this.getMeasureData(),Z=new lt.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.addChordColorsPercu=function(){this.noteData.instruments.filter(Wt).forEach(this.addHeadColorPercu,this)};const Wt=function(L){return!!L.color};q.addHeadColorPercu=function(L){const b=this.getNoteLocation();b.unpitched=N.default.copy(L.unpitched),b.color=L.color;const X=this.getMeasureData(),Z=new B.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.insertGraces=function(){const L=this.noteData.graces;if(typeof L!="undefined")if(typeof this.noteData.heads!="undefined")L.forEach(this.insertPitchedGraces,this);else if(typeof this.noteData.instruments!="undefined")L.forEach(this.insertUnpitchedGraces,this);else throw new g.default("Unexpected")},q.insertPitchedGraces=function(L,b){(L.heads||[]).forEach(function(Z,it){const nt=this.getNoteLocation();nt.staffIdx=this.opts.staffIdx,nt.graceIdx=b,nt.durationType=L.durationType,nt.pitch=(0,p.default)(Z.pitch);const mt=n.default.getAlter(Z.pitch);nt.accidental=n.default.alterToAccidental(mt);const It=this.getMeasureData();typeof Z.fretData!="undefined"&&(nt.fretData=(0,p.default)(Z.fretData));let vt;it>0?vt=ht.default:L.isSlashed?vt=St.default:vt=rt.default;const Ot=new vt(It,nt,this.cancelStack);(0,ut.default)(Ot),Z.color&&this.addGraceColor(Z,b)},this)},q.addGraceColor=function(L,b){const X=this.getNoteLocation();X.staffIdx=this.opts.staffIdx,X.graceIdx=b,X.pitch=(0,p.default)(L.pitch),X.color=L.color;const Z=this.getMeasureData(),it=new O.default(Z,X,this.cancelStack);(0,ut.default)(it)},q.insertUnpitchedGraces=function(L,b){(L.heads||[]).forEach(function(Z,it){const nt=this.getNoteLocation();nt.staffIdx=this.opts.staffIdx,nt.graceIdx=b,nt.durationType=L.durationType,nt.unpitched=(0,p.default)(Z.unpitched),nt.notehead=Z.notehead;const mt=this.getMeasureData();let It;it>0?It=xt.default:L.isSlashed?It=Pt.default:It=ft.default;const vt=new It(mt,nt,this.cancelStack);(0,ut.default)(vt),Z.color&&this.addGraceColorPercu(Z,b)},this)},q.addGraceColorPercu=function(L,b){const X=this.getNoteLocation();X.staffIdx=this.opts.staffIdx,X.graceIdx=b,X.unpitched=(0,p.default)(L.unpitched),X.color=L.color;const Z=this.getMeasureData(),it=new w.default(Z,X,this.cancelStack);(0,ut.default)(it)},q.addChordAttributes=function(){this.addLyrics();const L=this.noteData.articulations||{};S.default.forEach(L,this.addArticulation,this);const b=this.noteData.technicals||{};S.default.forEach(b,this.addTechnical,this);const X=this.noteData.ornaments||{};S.default.forEach(X,this.addOrnament,this),this.noteData.arpeggiate&&this.addArpeggiate(),this.noteData.beamStatus&&this.addBeamStatus(),this.noteData.hasGraceSlur&&this.addGraceSlur()},q.addArpeggiate=function(){const L=this.getNoteLocation(),b=this.getMeasureData(),X=new st.default(b,L,this.cancelStack);(0,ut.default)(X)},q.addBeamStatus=function(){const L=this.getNoteLocation();L.beamStatus=this.noteData.beamStatus;const b=this.getMeasureData(),X=new ct.default(b,L,this.cancelStack);(0,ut.default)(X),this.measuresScroller=null},q.addGraceSlur=function(){const L=this.getNoteLocation();L.beamStatus=this.noteData.beamStatus;const b=this.getMeasureData(),X=new Et.default(b,L,this.cancelStack);(0,ut.default)(X),this.measuresScroller=null},q.addRestArticulations=function(){const L=this.noteData.articulations||{};for(const b in L)if(b===d.default.FERMATA){const X=L[b];this.addArticulation(b,X)}},q.addLyrics=function(){(this.noteData.lyrics||[]).forEach(this.addLyric,this)},q.addLyric=function(L){const b=this.getNoteLocation();b.level=L.level,L.isMelisma?b.isMelisma=!0:(b.lyric=L.text,b.hasRightConnection=L.hasRightConnection);const X=this.getMeasureData(),Z=new G.default(X,b,this.cancelStack);(0,ut.default)(Z)},q.addArticulation=function(L){const b=this.getNoteLocation();let X;const Z=this.getMeasureData();if(d.default.isValid(L))b.notationType=L,X=new k.default(Z,b,this.cancelStack),(0,ut.default)(X);else if(h.default.isValid(L))b.articulationType=L,X=new K.default(Z,b,this.cancelStack),(0,ut.default)(X);else throw new M.A(L)},q.addTechnical=function(L){if(e.default.isCommonValid(L)){const b=this.getNoteLocation();b.technicalType=L;const X=this.getMeasureData(),Z=new _.default(X,b,this.cancelStack);(0,ut.default)(Z)}else if(!e.default.isValid)throw new f.A(L)},q.addOrnament=function(L,b){if(i.A.isValid(L)){const X=this.getNoteLocation();X.ornamentType=L,X.ornamentsOpts=b;const Z=this.getMeasureData(),it=new ot.default(Z,X,this.cancelStack);(0,ut.default)(it)}else throw new l.A(L)},q.recordLocation=function(){if(this.noteIdx!==null){const L={noteIdx:this.noteIdx,measureIdx:this.measureIdx};this.locationsMap[this.relativeNoteIdx]=L}},q.moveForward=function(){const L=this.getCurrentTimeModif(),b={durationType:this.noteData.durationType,nbDots:this.noteData.nbDots};let X=a.default.durationOptsToQuarter(b);for(;X>0;)this.hasVoiceDisplayed()?(X=this.moveForwardOnDisplayedVoice(X,L),X>0&&this.applyDataToContinuedNote()):X=this.moveForwardOnHiddenVoice(X,L)},q.moveForwardOnDisplayedVoice=function(L,b){const X=this.getMeasureData(),Z=X.getVoice(this.opts.voiceIdx),it=Z.getNote(this.noteIdx),nt=I.default.getTimeModif(it);if(!D.default.isSame(nt,b))throw new g.default("Unexpected");const mt=X.getDpqValue(),It=I.default.getNormalQuarterDuration(it,mt);L-=It,this.noteIdx++;const vt=I.default.getDuration(it);return this.moveTimePosForward(vt,mt),this.noteIdx>=Z.getNbNotes()&&(this.noteIdx=0,this.measureIdx++,this.timePos=0),L},q.moveForwardOnHiddenVoice=function(L,b){if(this.noteIdx=null,!D.default.isNormal(b))throw new g.default("Unexpected","A normal time modif is expoected.");const X=this.scoreData.getMeasure(this.opts.partIdx,this.measureIdx),Z=T.default.getQuarterDuration(X),it=this.getQuarterPosition();let nt=Z-it;const mt=Math.min(nt,L);nt-=mt,L-=mt;const It=a.default.quarterDurationToRequiredDpq(mt),vt=a.default.quarterToDivisions(mt,It);return this.moveTimePosForward(vt,It),nt===0&&(this.noteIdx=0,this.measureIdx++,this.timePos=0),L},q.moveTimePosForward=function(L,b){const X=x.default.lcm(this.dpq,b);this.timePos*=X/this.dpq,L*=X/b,this.timePos+=L,this.dpq=X},q.getCurrentTimeModif=function(){if(this.hasVoiceDisplayed()){const X=this.getMeasureData().getVoice(this.opts.voiceIdx).getNote(this.noteIdx);return I.default.getTimeModif(X)}else return D.default.createDefault()},q.hasVoiceDisplayed=function(){return this.getMeasureData().hasVoice(this.opts.voiceIdx)},q.applyDataToContinuedNote=function(){this.noteData.isRest?(!this.hasVoiceDisplayed()&&this.noteData.color&&this.showVoice(),this.noteData.color&&this.addRestColor()):this.noteData.heads?(this.addChordColor(),this.addChordHarmonic()):this.noteData.instruments&&this.addChordColorsPercu()},q.getMeasureData=function(){let L;return this.measuresScroller===null?(L=(0,Qt.A)(this.scoreData,this.opts.partIdx,this.measureIdx),this.measuresScroller=L.getMeasuresScroller()):L=this.measuresScroller.getMeasureData(this.measureIdx),L},q.storePosition=function(){const L={measureIdx:this.measureIdx,noteIdx:this.noteIdx};this.cancelStack.storePosition(L)},q.insertTies=function(){this.opts.data.ties.forEach(this.insertTie,this)},q.insertTie=function(L){this.opts.data.isUnpitched?this.insertUnpitchedTie(L):this.insertPitchedTie(L)},q.insertPitchedTie=function(L){const b=L.noteIdx+1,X=this.locationsMap[b];let Z=X.measureIdx,it=X.noteIdx-1,nt=this.measuresScroller.getMeasureData(Z);const mt={partIdx:this.opts.partIdx,measureIdx:Z,voiceIdx:this.opts.voiceIdx,noteIdx:it,step:L.step,octave:L.octave},It=new dt.default(nt,mt,this.cancelStack);if((0,ut.default)(It),L.tieDirection===Bt.A.FLIPPED){it<0&&(Z--,nt=this.measuresScroller.getMeasureData(Z),it=nt.getVoice(this.opts.voiceIdx).getNbNotes()-1);const vt={partIdx:this.opts.partIdx,measureIdx:Z,voiceIdx:this.opts.voiceIdx,noteIdx:it,pitch:n.default.copy(L),tieDirection:L.tieDirection},Ot=new j.default(nt,vt,this.cancelStack);(0,ut.default)(Ot)}},q.insertUnpitchedTie=function(L){const b=L.noteIdx+1,X=this.locationsMap[b];let Z=X.measureIdx,it=X.noteIdx-1,nt=this.measuresScroller.getMeasureData(Z);const mt={partIdx:this.opts.partIdx,measureIdx:Z,voiceIdx:this.opts.voiceIdx,noteIdx:it,"display-step":L["display-step"],"display-octave":L["display-octave"]},It=new Mt.default(nt,mt,this.cancelStack);if((0,ut.default)(It),L.tieDirection===Bt.A.FLIPPED){it<0&&(Z--,nt=this.measuresScroller.getMeasureData(Z),it=nt.getVoice(this.opts.voiceIdx).getNbNotes()-1);const vt={partIdx:this.opts.partIdx,measureIdx:Z,voiceIdx:this.opts.voiceIdx,noteIdx:it,unpitched:N.default.copy(L),tieDirection:L.tieDirection},Ot=new J.default(nt,vt,this.cancelStack);(0,ut.default)(Ot)}},q.insertSlurs=function(){this.opts.data.slurs.forEach(this.insertSlur,this)},q.insertSlur=function(L){var b;const X=this.locationsMap[L.startNoteIdx],Z=this.locationsMap[L.stopNoteIdx],it=(b=L.placement)!=null?b:$t.A.DEFAULT,nt={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,startMeasureIdx:X.measureIdx,startNoteIdx:X.noteIdx,stopMeasureIdx:Z.measureIdx,stopNoteIdx:Z.noteIdx,placement:it},mt=new V.default(this.measuresScroller,nt,this.cancelStack);(0,ut.default)(mt,Vt)},q.insertGlissandos=function(){const L=this.opts.data.glissandos||[];(0,Jt.A)(L).forEach(this.insertGlissando,this)},q.insertGlissando=function(L){const b=this.locationsMap[L.noteIdx+1],X=this.measuresScroller.getMeasureData(b.measureIdx),Z=new Ut.default(X,this.opts.voiceIdx,b.noteIdx-1),it=Z.getLeftMeasure(),nt=Z.getLeftMeasureIdx(),mt=Z.getLeftNoteIdx(),It={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:nt,noteIdx:mt,leftPitch:n.default.copyWithoutAlter(L.leftPitch),rightPitch:n.default.copyWithoutAlter(L.rightPitch)},vt=new z.default(it,It,this.cancelStack);(0,ut.default)(vt,Vt)},q.insertSlides=function(){(this.opts.data.slides||[]).forEach(this.insertSlide,this)},q.insertSlide=function(L){const b=this.locationsMap[L.noteIdx+1],X=this.measuresScroller.getMeasureData(b.measureIdx),Z=new Ut.default(X,this.opts.voiceIdx,b.noteIdx-1),it=Z.getLeftMeasure(),nt=Z.getLeftMeasureIdx(),mt=Z.getLeftNoteIdx(),It={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:nt,noteIdx:mt,leftPitch:n.default.copyWithoutAlter(L.leftPitch),rightPitch:n.default.copyWithoutAlter(L.rightPitch)},vt=new et.default(it,It,this.cancelStack);(0,ut.default)(vt)},q.insertHammerOnPullOffs=function(){(this.opts.data.hammerOnPullOffs||[]).forEach(this.insertHammerOnPullOff,this)},q.insertHammerOnPullOff=function(L){const b=this.locationsMap[L.noteIdx+1],X=this.measuresScroller.getMeasureData(b.measureIdx),Z=new Ut.default(X,this.opts.voiceIdx,b.noteIdx-1),it=Z.getLeftMeasure(),nt=Z.getLeftMeasureIdx(),mt=Z.getLeftNoteIdx(),It={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:nt,noteIdx:mt,pitch:n.default.copyWithoutAlter(L.leftPitch),noSlur:!0},vt=new gt.default(it,It,this.cancelStack);(0,ut.default)(vt,ee)};function ee(L){return L instanceof m.default||L instanceof o.A}q.insertTremolos=function(){(this.opts.data.tremolos||[]).forEach(this.insertTremolo,this)},q.insertTremolo=function(L){const b=this.locationsMap[L.noteIdx+1],X=this.measuresScroller.getMeasureData(b.measureIdx),Z=new Ut.default(X,this.opts.voiceIdx,b.noteIdx-1),it=Z.getLeftMeasure(),nt=Z.getLeftMeasureIdx(),mt=Z.getLeftNoteIdx(),It={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:nt,noteIdx:mt,nbBeams:L.nbBeams},vt=new pt.default(it,It,this.cancelStack);(0,ut.default)(vt,se)};function se(L){return L instanceof r.A||L instanceof u.A||L instanceof c.A}const Vt=function(L){return L instanceof v.default};q.getQuarterLocation=function(){const L=this.getQuarterPosition();return{partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,quarterPosition:L}},q.getQuarterPosition=function(){const L=a.default.divisionsToQuarter(this.timePos,this.dpq);if(!a.default.isValidQuarter(L))throw new g.default("Unexpected");return L},q.getNoteLocation=function(){return this.noteIdx===null&&(this.splitRest(),this.fetchNoteIdx()),{partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.noteIdx}},q.splitRest=function(){const L={partIdx:this.opts.partIdx,measureIdx:this.measureIdx,voiceIdx:this.opts.voiceIdx,timePos:this.timePos,dpq:this.dpq},b=this.getMeasureData();new Ct.A(b,L,this.cancelStack).perform()},q.fetchNoteIdx=function(){const L=this.getMeasureData(),b=L.getDpqValue(),X=x.default.lcm(b,this.dpq),Z=X/this.dpq,it=this.timePos*Z,nt=X/b,mt=L.getVoice(this.opts.voiceIdx);this.noteIdx=(0,jt.A)(mt,nt,it),this.startNoteIdx=this.noteIdx};const oe=kt},837283:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(951066);function v(f){return`The quarter position [${f}] is invalid.`}class M extends g.A{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"quarterPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadQuarterPositionError",this.quarterPosition=l}}},842328:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(436369),v=t(657107);const M=function(r,u,c){this.init(r,u,c)};M.NAME="primitive.RemoveRehearsal";const f=M.prototype;f.name=M.NAME,f.init=function(r,u,c){this.commonContent=(0,v.A)(r),this.cancelStack=c,this.opts=u},f.perform=function(){this.removeRehearsal(),this.updateStack()},f.removeRehearsal=function(){this.commonContent.removeRehearsal(this.opts.measureIdx)},f.updateStack=function(){const r=this.commonContent.getScoreData(),u=r.getNbParts();for(let c=0;c<u;c++){const m={type:this.name,opts:{partIdx:c,measureIdx:this.opts.measureIdx}};this.cancelStack.push(m)}(0,g.A)(this.cancelStack,r,this.opts)};const l=M},846181:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(737903),v=t(576363),M=t(793317);const f=function(h,e,i){this.init(h,e,i)};f.NAME="composite.RemoveStaffMeasureLeftGlissandos";const l=f.prototype;l.initMeasureData=M.default,l.name=f.NAME,l.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=(0,g.default)(this.opts);h.noteIdx=0,this.measureData.getVoice(h.voiceIdx).isRest(h.noteIdx)||new v.A(this.measureData,h,this.cancelStack).perform()};const r=f,u=function(h,e,i){this.init(h,e,i)};u.NAME="composite.RemoveMeasureLeftGlissandos";const c=u.prototype;c.initMeasureData=M.default,c.name=u.NAME,c.init=function(h,e,i){this.initMeasureData(h,e),this.cancelStack=i,this.opts=e},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.measureData.forEachVoice(this.removeVoiceGlissandos,this)},c.removeVoiceGlissandos=function(h,e){const i=(0,g.default)(this.opts);i.voiceIdx=e,new r(this.measureData,i,this.cancelStack).perform()};const m=u,o=function(h,e,i){this.init(h,e,i)};o.NAME="composite.RemoveColumnLeftGlissandos";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.scoreData=h,this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=this.scoreData.getNbParts();for(let e=0;e<h;e++)if(!this.scoreData.isPartUnpitched(e)){const i=(0,g.default)(this.opts);i.partIdx=e,new m(this.scoreData,i,this.cancelStack).perform()}};const d=o},860137:(H,P,t)=>{t.d(P,{A:()=>h});var g=t(13302),v=t(436369);const M=function(e,i,p){this.init(e,i,p)};M.NAME="primitive.AddJumpCall";const f=M.prototype;f.name=M.NAME,f.init=function(e,i,p){this.scoreData=e,this.opts=i,this.cancelStack=p},f.perform=function(){this.setTagInCommonContent(),this.updateStack()},f.setTagInCommonContent=function(){this.getCommonContent().setJumpCall(this.opts.measureIdx,this.opts.type)},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.updateStack=function(){const{measureIdx:e}=this.opts,i=this.scoreData.getNbParts();for(let p=0;p<i;p++){const x={type:this.name,opts:{partIdx:p,measureIdx:e}};this.cancelStack.push(x)}(0,v.A)(this.cancelStack,this.scoreData,{measureIdx:e})};const l=M;var r=t(889346),u=t(607801),c=t(701387),m=t(555172);const o="-signalBackwardJump",s=function(e,i,p){this.init(e,i,p)};s.NAME="composite.AddJumpCall";const d=s.prototype;d.name=s.NAME,d.init=function(e,i,p){this.scoreData=e,this.opts=i,this.cancelStack=p},d.getCommonContent=function(){return this.scoreData.getCommonContent()},d.perform=function(){this.getCommonContent().hasJumpCall(this.opts.measureIdx)&&this.removeCurrentJumpCall(),this.addJumpCall(),this.canClearBarline()&&this.clearBarline(),this.needChangeLastBarline()&&this.canChangeLastBarline()&&this.clearLastBarline(),this.isAddingForwardJump()&&this.signalBackwardJumps()},d.removeCurrentJumpCall=function(){const e={measureIdx:this.opts.measureIdx},i=new g.default(this.scoreData,e,this.cancelStack);i.checkPreconditions(),i.perform()},d.addJumpCall=function(){const e={measureIdx:this.opts.measureIdx,type:this.opts.type};new l(this.scoreData,e,this.cancelStack).perform()},d.canClearBarline=function(){if(this.opts.type!==u.A.FINE)return!1;const i=this.scoreData.getMeasure(0,this.opts.measureIdx);return!c.default.hasRightBarline(i)||c.default.getRightBarlineStyle(i)===m.A.DEFAULT_STYLE},d.clearBarline=function(){const e={measureIdx:this.opts.measureIdx};new r.A(this.scoreData,e,this.cancelStack).perform()},d.needChangeLastBarline=function(){const e=this.scoreData.getNbMeasures();return this.opts.measureIdx<e-1},d.canChangeLastBarline=function(){if(this.opts.type!==u.A.FINE)return!1;const i=this.scoreData.getNbMeasures()-1,x=this.scoreData.getMeasure(0,i);return!!(!c.default.hasRightBarline(x)||c.default.hasFinalBarline(x))},d.clearLastBarline=function(){const p={measureIdx:this.scoreData.getNbMeasures()-1};new r.A(this.scoreData,p,this.cancelStack).perform()},d.isAddingForwardJump=function(){return u.A.isJumpForward(this.opts.type)},d.signalBackwardJumps=function(){const e=this.scoreData.getNbMeasures();for(let i=this.opts.measureIdx+1;i<e;i++){const p=this.getCommonContent();if(p.hasJumpCall(i)){const x=p.getJumpCall(i);u.A.isJumpBackward(x)&&this.signalBackwardJump(i)}}},d.signalBackwardJump=function(e){const p={type:this.name+o,opts:{partIdx:0,measureIdx:e,type:this.opts.type}};this.cancelStack.push(p),(0,v.A)(this.cancelStack,this.scoreData,{measureIdx:e})};const h=s},860301:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(383279);const M=function(f,l){const r={};return f.forEach(function(u){const c=g.default.getVoiceUuid(l,u);r[u]=c}),r}},867346:(H,P,t)=>{t.d(P,{A:()=>m});var g=t(852363),v=t(793317),M=t(578918),f=t(316197),l=t(123491),r=t(351277);const u=function(o,s,d){this.init(o,s,d)};u.NAME="primitive.RemoveGlissandoSide";const c=u.prototype;c.name=u.NAME,c.initMeasureData=v.default,c.init=function(o,s,d){this.initMeasureData(o,s),this.opts=s,this.cancelStack=d},c.perform=function(){const o=this.getNoteAtPitch();if(l.default.hasGlissando(o,this.opts.glissandoType,this.opts.number)){const s=f.default.create(this.opts.glissandoType,this.opts.number);l.default.removeGlissando(o,s)}this.updateStack()},c.getNoteAtPitch=function(){const o=this.measureData.getVoice(this.opts.voiceIdx);return(0,M.default)(o,this.opts.noteIdx,this.opts.pitch)},c.updateStack=function(){const o={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,pitch:r.default.copy(this.opts.pitch),glissandoType:this.opts.glissandoType,number:this.opts.number}};this.cancelStack.push(o),(0,g.default)(this.cancelStack,this.measureData,this.opts)};const m=u},876338:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("Cannot insert this tuplet type on this note."),this.name="IncompatibleTupletError"}}},881540:(H,P,t)=>{t.d(P,{A:()=>r});var g=t(123491),v=t(852363),M=t(793317);const f=function(u,c,m){this.init(u,c,m)};f.NAME="primitive.AddGraceSlur";const l=f.prototype;l.initMeasureData=M.default,l.name=f.NAME,l.init=function(u,c,m){this.initMeasureData(u,c),this.cancelStack=m,this.opts=c},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.addGraceSlur(),this.updateStack()},l.addGraceSlur=function(){const c=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);g.default.setGraceSlur(c,!0)},l.updateStack=function(){const u={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(u),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const r=f},889346:(H,P,t)=>{t.d(P,{A:()=>d});var g=t(364842),v=t(342762),M=t(918926),f=t(350357),l=t(555172),r=t(607801);const u=function(h,e){const i=h.getNbMeasures();return h.hasJumpCall(e)&&h.getJumpCall(e)===r.A.FINE?l.A.FINAL:e===i-1?c(h)?l.A.DEFAULT_STYLE:l.A.FINAL:l.A.DEFAULT_STYLE};function c(h){const e=h.getNbMeasures();for(let i=0;i<e;i++)if(h.hasJumpCall(i)&&h.getJumpCall(i)===r.A.FINE)return!0;return!1}const m=u,o=function(h,e,i){this.init(h,e,i)};o.NAME="action.ClearRightBarline";const s=o.prototype;s.name=o.NAME,s.init=function(h,e,i){this.scoreData=h,this.cancelStack=i,this.opts=e},s.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const h=this.getNormalRightBarlineStyle();if(h===l.A.FINAL)this.addFinalBarline();else if(h===l.A.DEFAULT_STYLE)this.removeBarline();else throw new g.default("Unexpected")},s.getNormalRightBarlineStyle=function(){const h=this.scoreData.getCommonContent();return m(h,this.opts.measureIdx)},s.addFinalBarline=function(){const h={measureIdx:this.opts.measureIdx,side:f.A.RIGHT,style:"light-heavy"};new v.A(this.scoreData,h,this.cancelStack).perform()},s.removeBarline=function(){const h={measureIdx:this.opts.measureIdx,side:f.A.RIGHT};new M.A(this.scoreData,h,this.cancelStack).perform()};const d=o},904719:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682);const v=function(){return"There is no Jump Call to delete"};class M extends g.default{constructor(){const l=v();super(l),this.name="NoJumpCallToRemove"}}},908969:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(364842);const v={UNPITCHED:"unpitched",NORMAL:"normal"};v.raiseError=function(f){const l=`The part type: [${f}] is invalid`;throw new g.default("BadPartTypeValue",l)};const M=v},912858:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(951066);class v extends g.A{constructor(){super(`Cannot keep fret/string information. The new tuning must match the previous one. 
Only the capo is allowed to change.`),this.name="CannotKeepFretError"}}},918926:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(953388);const v=function(l,r,u){this.init(l,r,u)};v.NAME="composite.RemoveBarline";const M=v.prototype;M.name=v.NAME,M.init=function(l,r,u){this.scoreData=l,this.cancelStack=u,this.opts=r},M.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removePartsBarlines()},M.removePartsBarlines=function(){const l=this.scoreData.getNbParts();for(let r=0;r<l;r++)this.removePartBarline(r)},M.removePartBarline=function(l){const r={partIdx:l,measureIdx:this.opts.measureIdx,side:this.opts.side};new g.A(this.scoreData,r,this.cancelStack).perform()};const f=v},922816:(H,P,t)=>{t.d(P,{A:()=>o});var g=t(429240),v=t(436369);const M=function(s,d,h){this.init(s,d,h)};M.NAME="primitive.AddPageBreak";const f=M.prototype;f.name=M.NAME,f.init=function(s,d,h){this.scoreData=s,this.opts=d,this.cancelStack=h},f.getCommonContent=function(){return this.scoreData.getCommonContent()},f.perform=function(){this.getCommonContent().setPageBreak(this.opts.measureIdx,this.opts.value),this.updateStack()},f.updateStack=function(){const s={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};if(this.cancelStack.push(s),(0,v.A)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0){const d={type:`${this.name}-drawPrevious`,opts:{partIdx:0,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(d),(0,v.A)(this.cancelStack,this.scoreData,{measureIdx:this.opts.measureIdx-1})}};const l=M;var r=t(519405),u=t(867734);const c=function(s,d,h){this.init(s,d,h)};c.NAME="action.AddPageBreak";const m=c.prototype;m.name=c.NAME,m.init=function(s,d,h){this.scoreData=s,this.opts=d,this.cancelStack=h},m.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeFormerPageBreak(),this.removeFormerSytemBreak(),this.addPageBreak()},m.removeFormerPageBreak=function(){if(!this.scoreData.getCommonContent().hasPageBreak(this.opts.measureIdx))return;const d=new g.default(this.scoreData,this.opts,this.cancelStack);(0,r.default)(d)},m.removeFormerSytemBreak=function(){this.scoreData.getCommonContent().hasSystemBreak(this.opts.measureIdx)&&new u.default(this.scoreData,this.opts,this.cancelStack).perform()},m.addPageBreak=function(){const s={measureIdx:this.opts.measureIdx,value:this.opts.value};new l(this.scoreData,s,this.cancelStack).perform()};const o=c},925301:(H,P,t)=>{t.d(P,{A:()=>l});var g=t(123966),v=t(456582);const M=function(r,u,c){this.init(r,u,c)};M.NAME=v.p;const f=M.prototype;f.name=M.NAME,f.initPartData=g.A,f.init=function(r,u,c){this.initPartData(r,u),this.cancelStack=c,this.opts=u},f.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.updateStack(),this.erase(this.opts.measureIdx)},f.updateStack=function(){const r={type:this.name,opts:{measureIdx:this.opts.measureIdx,partIdx:this.opts.partIdx}};this.cancelStack.push(r)},f.erase=function(r){if(r===0){const u=this.partData.getFirstEnv();this.partData.setEnv(1,u)}this.partData.eraseMeasure(r)};const l=M},926089:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682);function v(){return"There are not glissando notations at this location."}class M extends g.default{constructor(){const l=v();super(l),this.name="NoGlissandoToRemove"}}},953388:(H,P,t)=>{t.d(P,{A:()=>u});var g=t(364842),v=t(701387),M=t(350357),f=t(852363);const l=function(c,m,o){this.init(c,m,o)};l.NAME="primitive.RemoveBarline";const r=l.prototype;r.name=l.NAME,r.init=function(c,m,o){this.scoreData=c,this.opts=m,this.cancelStack=o},r.perform=function(){this.removeBarline(),this.updateStack()},r.removeBarline=function(){const c=this.scoreData.getMeasure(this.opts.partIdx,this.opts.measureIdx);if(this.opts.side===M.A.LEFT)v.default.removeLeftBarline(c);else if(this.opts.side===M.A.RIGHT)v.default.removeRightBarline(c);else throw new g.default("Unexpected")},r.updateStack=function(){const c={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx}};this.cancelStack.push(c),(0,f.default)(this.cancelStack,this.scoreData,this.opts)};const u=l},954546:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(607682);class v extends g.default{constructor(){super("The two notes must be from the same tuplet type."),this.name="DifferentTimeModifDurationError"}}},954939:(H,P,t)=>{t.d(P,{A:()=>Mt});var g=t(377180),v=t(737903),M=t(476943),f=t(123491),l=t(414208),r=t(846541),u=t(793317),c=t(519405);const m=function(j,J,V){this.init(j,J,V)};m.NAME="composite.RemoveStaffMeasureRightTies";const o=m.prototype;o.initMeasureData=u.default,o.name=m.NAME,o.init=function(j,J,V){this.initMeasureData(j,J),this.cancelStack=V,this.opts=J},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const j=this.measureData.getVoice(this.opts.voiceIdx),J=j.size()-1;let V=j.getChord(J);if(V=M.default.makeArray(V),!V.some(f.default.hasTieStart))return;const z=(0,v.default)(this.opts);z.noteIdx=J;const et=this.measureData.isUnpitched()?r.default:l.default,rt=new et(this.measureData,z,this.cancelStack);(0,c.default)(rt)};const s=m;var d=t(351277),h=t(446625);const e=function(j,J,V){this.init(j,J,V)};e.create=function(j,J){const V=g.default.copy(J.transpose);let et=j.getVoice(J.voiceIdx).getChord(J.noteIdx);et=M.default.makeArray(et);const rt=et.map(f.default.getPitch);return g.default.isUpward(V)?rt.sort(i):rt.sort(p),new e(rt,V,J.allowDoubleAccidentals)};const i=function(j,J){return-p(j,J)},p=function(j,J){return d.default.naiveComparePitch(j,J)},x=e.prototype;x.init=function(j,J,V){this.pitches=j,this.transposedPitches=null,this.transpose=J,this.allowDoubleAccidentals=V},x.getNbHeads=function(){return this.pitches.length},x.getTransposedPitch=function(j){return this.getTransposedPitches()[j]},x.getTransposedPitches=function(){return this.transposedPitches===null&&(this.transposedPitches=this.pitches.map(this.transposePitch,this)),this.transposedPitches},x.transposePitch=function(j){return d.default.transpose(j,this.transpose,this.allowDoubleAccidentals)},x.getPitch=function(j){return this.pitches[j]},x.hasPreviousOnSameLine=function(j){return this.hasPrevious(j)?this.isPreviousOnSameLine(j):!1},x.hasPrevious=function(j){return j>0},x.isPreviousOnSameLine=function(j){const J=this.getTransposedPitch(j),V=this.getTransposedPitch(j-1);return d.default.isSameLine(J,V)};const S=e,I=function(j,J,V){this.init(j,J,V)};I.NAME="composite.RemoveTransposedCollidingHeadsFromChord";const n=I.prototype;n.name=I.NAME,n.initMeasureData=u.default,n.init=function(j,J,V){this.initMeasureData(j,J),this.cancelStack=V,this.opts=J,this.wrappedPitches=null},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const j=this.getNbHeads();for(let J=0;J<j;J++)this.updateChordHead(J)},n.getNbHeads=function(){return this.getWrappedPitches().getNbHeads()},n.updateChordHead=function(j){this.hasPreviousOnSameLine(j)&&this.removeHead(j)},n.hasPreviousOnSameLine=function(j){return this.getWrappedPitches().hasPreviousOnSameLine(j)},n.removeHead=function(j){const J=this.getPitch(j),V=(0,v.default)(this.opts);V.pitch=d.default.copy(J),new h.A(this.measureData,V,this.cancelStack).perform()},n.getPitch=function(j){return this.getWrappedPitches().getPitch(j)},n.getWrappedPitches=function(){return this.wrappedPitches===null&&(this.wrappedPitches=S.create(this.measureData,this.opts)),this.wrappedPitches};const a=I,D=function(j,J,V){this.init(j,J,V)};D.NAME="composite.RemoveTransposedCollidingHeadsFromStaffMeasure";const T=D.prototype;T.name=D.NAME,T.initMeasureData=u.default,T.init=function(j,J,V){this.initMeasureData(j,J),this.cancelStack=V,this.opts=J,this.wrappedPitches=null},T.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const j=this.measureData.getVoice(this.opts.voiceIdx),J=j.size();for(let V=0;V<J;V++)j.isRest(V)||this.removeCollidingHeadsFromChord(V)},T.removeCollidingHeadsFromChord=function(j){const J=(0,v.default)(this.opts);J.noteIdx=j,new a(this.measureData,J,this.cancelStack).perform()};const N=D;var y=t(364842),A=t(922679),R=t(852363);const W=function(j,J,V){this.init(j,J,V)};W.NAME="primitive.ChangePitch";const F=W.prototype;F.name=W.NAME,F.initMeasureData=u.default,F.getVoice=A.A,F.init=function(j,J,V){this.initMeasureData(j,J),this.cancelStack=V},F.perform=function(){let J=this.getVoice().getChord(this.opts.noteIdx);J=M.default.makeArray(J);const V=J.find(this.pitchPredicate,this),z=d.default.copy(f.default.getPitch(V)),et=d.default.copy(this.opts.toPitch);f.default.setPitch(V,et),this.updateStack(z)},F.pitchPredicate=function(j){const J=f.default.getPitch(j);return d.default.isSameLine(J,this.opts.fromPitch)},F.updateStack=function(j){const J={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,previousPitch:d.default.copy(j),newPitch:d.default.copy(this.opts.toPitch)}};this.cancelStack.push(J),(0,R.default)(this.cancelStack,this.measureData,this.opts)};const E=W,U=function(j,J,V){this.init(j,J,V)};U.NAME="composite.TransposeChord";const Q=U.prototype;Q.initMeasureData=u.default,Q.name=U.NAME,Q.init=function(j,J,V){this.initMeasureData(j,J),this.cancelStack=V,this.opts=J,this.wrappedPitches=null},Q.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const j=this.getNbHeads();for(let J=0;J<j;J++)this.updateChordHead(J)},Q.getNbHeads=function(){return this.getWrappedPitches().getNbHeads()},Q.hasPreviousOnSameLine=function(j){return this.getWrappedPitches().hasPreviousOnSameLine(j)},Q.updateChordHead=function(j){this.hasPreviousOnSameLine(j)?this.raiseWTF(j):this.changeHead(j)},Q.getPitch=function(j){return this.getWrappedPitches().getPitch(j)},Q.getWrappedPitches=function(){return this.wrappedPitches===null&&(this.wrappedPitches=S.create(this.measureData,this.opts)),this.wrappedPitches},Q.raiseWTF=function(j){const J=this.opts.partIdx,V=this.opts.measureIdx,z=this.opts.voiceIdx,et=this.opts.noteIdx,rt=this.getPitch(j),ht=d.default.stringify(rt),ft=`The note that would collide once transposed should be removed. part[${J}] measure[${V}] voice[${z}] note[${et}] pitch[${ht}].`,xt=new y.default("HeadNotRemoved",ft);throw xt.partIdx=J,xt.measureIdx=V,xt.voiceIdx=z,xt.noteIdx=et,xt.pitch=d.default.copy(rt),xt},Q.changeHead=function(j){const J=this.getPitch(j),V=this.getTransposedPitch(j),z=(0,v.default)(this.opts);z.fromPitch=d.default.copy(J),z.toPitch=d.default.copy(V),new E(this.measureData,z,this.cancelStack).perform()},Q.getTransposedPitch=function(j){return this.getWrappedPitches().getTransposedPitch(j)};const G=U,k=function(j,J,V){this.init(j,J,V)};k.NAME="composite.TransposeStaffMeasure";const K=k.prototype;K.initMeasureData=u.default,K.name=k.NAME,K.init=function(j,J,V){this.initMeasureData(j,J),this.cancelStack=V,this.opts=J},K.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const j=this.measureData.getVoice(this.opts.voiceIdx),J=j.size();for(let V=0;V<J;V++)j.isRest(V)||this.transposeChord(V)},K.transposeChord=function(j){const J=(0,v.default)(this.opts);J.noteIdx=j,new G(this.measureData,J,this.cancelStack).perform()};const _=k,ot=function(j,J,V){this.init(j,J,V)};ot.NAME="composite.TransposeForPitchShift";const dt=ot.prototype;dt.name=ot.NAME,dt.init=function(j,J,V){this.scoreData=j,this.cancelStack=V,this.opts=J,this.measures=null},dt.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.untieEdgeMeasures(),this.processMeasures()},dt.untieEdgeMeasures=function(){this.hasPreviousMeasure()&&this.untieFromPreviousMeasure(),this.hasNextMeasure()&&this.untieFromNextMeasure()},dt.hasPreviousMeasure=function(){return this.opts.firstMeasureIdx>0},dt.untieFromPreviousMeasure=function(){const j={partIdx:this.opts.partIdx,measureIdx:this.opts.firstMeasureIdx-1,voiceIdx:this.opts.voiceIdx};new s(this.scoreData,j,this.cancelStack).perform()},dt.hasNextMeasure=function(){const j=this.getNbMeasures();return this.lastMeasureIdx<j-1},dt.getNbMeasures=function(){return this.getMeasures().length},dt.getMeasures=function(){return this.scoreData.getPartContent(this.opts.partIdx).measure},dt.untieFromNextMeasure=function(){const j={partIdx:this.opts.partIdx,measureIdx:this.opts.lastMeasureIdx,voiceIdx:this.opts.voiceIdx};new s(this.scoreData,j,this.cancelStack).perform()},dt.processMeasures=function(){const j=this.opts.firstMeasureIdx,J=this.opts.lastMeasureIdx;for(let V=j;V<=J;V++)this.processMeasure(V)},dt.processMeasure=function(j){const J={},V={partIdx:this.opts.partIdx,measureIdx:j};u.default.call(J,this.scoreData,V);const z=J.measureData;z.hasVoice(this.opts.voiceIdx)&&(this.removeCollidingFromStaffMeasure(z,j),this.transposeMeasure(z,j))},dt.removeCollidingFromStaffMeasure=function(j,J){const V={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:J,transpose:g.default.copy(this.opts.transpose),allowDoubleAccidentals:this.opts.allowDoubleAccidentals};new N(j,V,this.cancelStack).perform()},dt.transposeMeasure=function(j,J){const V={partIdx:this.opts.partIdx,voiceIdx:this.opts.voiceIdx,measureIdx:J,transpose:g.default.copy(this.opts.transpose),allowDoubleAccidentals:this.opts.allowDoubleAccidentals};new _(j,V,this.cancelStack).perform()};const Mt=ot},961770:(H,P,t)=>{t.d(P,{A:()=>S});var g=t(31278),v=t(701387),M=t(857899),f=t(842086),l=t(13302),r=t(223628),u=t(556055),c=t(867734),m=t(644317),o=t(596237),s=t(324318),d=t(652394),h=t(519405),e=t(350357);const i=function(I,n,a){this.init(I,n,a)};i.NAME="composite.ClearMeasureColumn";const p=i.prototype;p.name=i.NAME,p.init=function(I,n,a){this.scoreData=I,this.cancelStack=a,this.opts=n},p.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.clearPartsMeasure(),this.removeJumps(),this.removeTempoChanges(),this.removeRehearsal(),this.removeSystemBreak(),this.removeMeasureRepeat(),this.removeMeasureSlash(),this.opts.clearBarlines&&this.removeBarlines()},p.clearPartsMeasure=function(){const I=this.scoreData.getNbParts();for(let n=0;n<I;n++)this.clearPartMeasure(n)},p.clearPartMeasure=function(I){const n={partIdx:I,measureIdx:this.opts.measureIdx};new m.A(this.scoreData,n,this.cancelStack).perform()},p.removeJumps=function(){const I=this.scoreData.getCommonContent();I.hasJumpTag(this.opts.measureIdx)&&this.removeJumpTag(),I.hasJumpCall(this.opts.measureIdx)&&this.removeJumpCall()},p.removeJumpTag=function(){const I={measureIdx:this.opts.measureIdx},n=new f.default(this.scoreData,I,this.cancelStack);(0,h.default)(n)},p.removeJumpCall=function(){const I={measureIdx:this.opts.measureIdx},n=new l.default(this.scoreData,I,this.cancelStack);(0,h.default)(n)},p.removeSystemBreak=function(){if(this.scoreData.getCommonContent().hasSystemBreak(this.opts.measureIdx)){const n={measureIdx:this.opts.measureIdx},a=new c.default(this.scoreData,n,this.cancelStack);(0,h.default)(a)}},p.removeMeasureRepeat=function(){const I={measureIdx:this.opts.measureIdx};new s.A(this.scoreData,I,this.cancelStack).perform()},p.removeMeasureSlash=function(){const I={measureIdx:this.opts.measureIdx};new d.A(this.scoreData,I,this.cancelStack).perform()},p.removeTempoChanges=function(){const I={measureIdx:this.opts.measureIdx,timePos:0,dpq:1};new o.A(this.scoreData,I,this.cancelStack).perform()},p.removeRehearsal=function(){if(this.scoreData.getCommonContent().hasRehearsal(this.opts.measureIdx)){const n={measureIdx:this.opts.measureIdx},a=new r.default(this.scoreData,n,this.cancelStack);(0,h.default)(a)}},p.removeBarlines=function(){this.removeLeftBarline(),this.removeRightBarline()},p.removeLeftBarline=function(){const n=this.scoreData.getMeasure(0,this.opts.measureIdx),a=v.default.getBarlines(n);if(!M.A.hasRepeatForward(a))return;const D={measureIdx:this.opts.measureIdx,side:e.A.LEFT},T=new u.default(this.scoreData,D,this.cancelStack);(0,h.default)(T)},p.removeRightBarline=function(){const I={measureIdx:this.opts.measureIdx,side:e.A.RIGHT},n=new u.default(this.scoreData,I,this.cancelStack);(0,h.default)(n,x)};const x=function(I){return I instanceof g.default},S=i},986084:(H,P,t)=>{t.d(P,{A:()=>M});var g=t(607682);function v(f){return`There is already a measure linked the following UUID ${f}`}class M extends g.default{constructor(l){const r=v(l);super(r),Object.defineProperty(this,"measureUuid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="AlreadyHasMeasureUuidError",this.measureUuid=l}}},986925:(H,P,t)=>{t.d(P,{A:()=>f});var g=t(436369);const v=function(l,r,u){this.init(l,r,u)};v.NAME="primitive.RemoveSystemBreak";const M=v.prototype;M.name=v.NAME,M.init=function(l,r,u){this.scoreData=l,this.opts=r,this.cancelStack=u},M.getCommonContent=function(){return this.scoreData.getCommonContent()},M.perform=function(){this.getCommonContent().removeSystemBreak(this.opts.measureIdx),this.updateStack()},M.updateStack=function(){const l={type:this.name,opts:{partIdx:0,measureIdx:this.opts.measureIdx}};if(this.cancelStack.push(l),(0,g.A)(this.cancelStack,this.scoreData,this.opts),this.opts.measureIdx>0){const r={type:`${this.name}-drawPrevious`,opts:{partIdx:0,measureIdx:this.opts.measureIdx-1}};this.cancelStack.push(r),(0,g.A)(this.cancelStack,this.scoreData,{measureIdx:this.opts.measureIdx-1})}};const f=v},988756:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(951066);class v extends g.A{constructor(f){const l=`Invalid value ${f} for the number repeats.`;super(l),Object.defineProperty(this,"times",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadBarlineRepeatTimes",this.times=f}}},993581:(H,P,t)=>{t.d(P,{A:()=>e});var g=t(123491),v=t(852363),M=t(793317);const f=function(i,p,x){this.init(i,p,x)};f.NAME="primitive.AddNotation";const l=f.prototype;l.name=f.NAME,l.initMeasureData=M.default,l.init=function(i,p,x){this.initMeasureData(i,p),this.cancelStack=x,this.opts=p},l.perform=function(){const p=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);g.default.addNotation(p,this.opts.notationType),this.updateStack()},l.updateStack=function(){const i={type:this.name,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx}};this.cancelStack.push(i),(0,v.default)(this.cancelStack,this.measureData,this.opts)};const r=f;var u=t(379097),c=t(726271),m=t(519405),o=t(379668),s=t(701387);const d=function(i,p,x){this.init(i,p,x)};d.NAME="composite.AddNotation";const h=d.prototype;h.initMeasureData=M.default,h.name=d.NAME,h.init=function(i,p,x){this.initMeasureData(i,p),this.cancelStack=x,this.opts=p},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.removeMmr(),this.removeMeasureRepeat(),this.removeIncompatibleArticulationsIfNeeded(),this.addNotation()},h.removeMmr=function(){(0,o.A)(this.measureData,this.opts,this.cancelStack)},h.removeMeasureRepeat=function(){const p=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),x=g.default.getStaffIdx(p),S=this.measureData.getMeasure();if(!s.default.hasMeasureRepeat(S,x))return;const I={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,staffIdx:x},n=this.measureData.getScoreData(),a=new c.default(n,I,this.cancelStack);(0,m.default)(a)},h.removeIncompatibleArticulationsIfNeeded=function(){const p=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);g.default.hasNotationIncompatibleArticulations(p)&&this.removeIncompatibleArticulations(p)},h.removeIncompatibleArticulations=function(i){g.default.getNotationIncompatibleArticulations(i).forEach(function(x){const S={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,articulationType:x,noteIdx:this.opts.noteIdx},I=new u.default(this.measureData,S,this.cancelStack);I.checkPreconditions(),I.perform()},this)},h.addNotation=function(){const i={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx};new r(this.measureData,i,this.cancelStack).perform()};const e=d},993608:(H,P,t)=>{t.d(P,{A:()=>v});var g=t(951066);class v extends g.A{constructor(l){const r=M(l);super(r),Object.defineProperty(this,"quarterDuration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="BadQuarterDurationError",this.quarterDuration=l}}const M=function(f){return`The quarter duration [${f}] is invalid.`}}}]);})();


//# debugId=e122798a-151d-5e2b-85e4-2109535d71d4
