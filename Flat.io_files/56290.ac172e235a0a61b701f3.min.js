"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0835bdd7-833c-59e4-a330-ab00122a6be0")}catch(e){}}();
(()=>{/*! Copyright (c) 2025 Tutteo Ltd. */(self.webpackChunk_flat_flat=self.webpackChunk_flat_flat||[]).push([[56290],{115866:(y,v,t)=>{t.r(v),t.d(v,{default:()=>E});var g=t(31278),O=t(702544),T=t(153271),C=t(883782),D=t(847051),P=t(123491),B=t(50060),m=t(402315),M=t(42651),p=t(793317),A=t(52275),I=t(704621),x=t(981801),d=t(898039);const _=function(h,o,l){this.init(h,o,l)};_.NAME="action.RemoveLyrics",_.isAuthorizedException=function(h){return h instanceof O.default||h instanceof T.default||h instanceof C.default||h instanceof g.default||h instanceof D.A};const a=_.prototype;a.initMeasureData=p.default,a.name=_.NAME,a.init=function(h,o,l){(0,A.default)(h,o),(0,I.default)(h,o),(0,x.default)(h,o),this.initMeasureData(h,o),this.cancelStack=l,this.opts=o,(0,d.default)(this.measureData,o),this.location=null,this.sanitized=!1},a.performIfPossible=function(){this.isPossible()&&this.perform()},a.isPossible=function(){let h=!0;try{this.checkPreconditions()}catch(o){if(_.isAuthorizedException(o))h=!1;else throw o}return h},a.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkLocation(),this.checkExistence()},a.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},a.checkExistence=function(){const o=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!P.default.hasLyrics(o)){const l="There is no lyric at this location.";throw new g.default(l)}},a.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction(),this.removeLyrics()},a.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.level=="undefined"&&(this.opts.level=0),this.sanitized=!0)},a.storeAction=function(){if(!this.cancelStack.hasAction()){const h=this.getLocation(),o={actionName:this.name,opts:{partUuid:h.partUuid,measureUuid:h.measureUuid,voiceUuid:h.voiceUuid,divisions:h.dpq,timePos:h.timePos}};this.cancelStack.storeAction(o)}},a.removeLyrics=function(){const o=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);P.default.getLyrics(o).map(B.default.getLevel).forEach(this.removeLyric,this)},a.removeLyric=function(h){const o={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:h};new m.default(this.measureData,o,this.cancelStack).perform()},a.getLocation=function(){if(this.location===null){const h=this.measureData.getScoreData(),o=h.getPartUuid(this.opts.partIdx),l=h.getMeasureUuid(this.opts.measureIdx),s=h.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),e=this.measureData.getDpqValue(),c=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:o,measureUuid:l,voiceUuid:s,dpq:e,timePos:c}}return this.location},(0,M.default)(_);const E=_},160965:(y,v,t)=>{t.r(v),t.d(v,{default:()=>x});var g=t(31278),O=t(123491),T=t(209175),C=t(644370),D=t(898039),P=t(52275),B=t(704621),m=t(981801),M=t(793317),p=t(42651);const A=function(d,_,a){this.init(d,_,a)};A.NAME="action.RemoveColorFromRest",A.isNoChange=function(d){return d instanceof g.default};const I=A.prototype;I.name=A.NAME,I.initMeasureData=M.default,I.init=function(d,_,a){(0,P.default)(d,_),(0,B.default)(d,_),(0,m.default)(d,_),this.initMeasureData(d,_),this.cancelStack=a,this.opts=_,this.noteHead=null,this.voice=null,this.location=null},I.checkPreconditions=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),(0,D.default)(this.measureData,this.opts),this.checkNoteIdx(),this.checkRest(),this.checkColor()},I.checkNoteIdx=function(){this.getVoice().checkNoteIdx(this.opts.noteIdx)},I.checkRest=function(){this.getVoice().checkRest(this.opts.noteIdx)},I.checkColor=function(){const d=this.getNote();if(!O.default.hasColor(d))throw new g.default},I.getNote=function(){if(this.noteHead===null){const d=this.getVoice();this.noteHead=d.getNote(this.opts.noteIdx)}return this.noteHead},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const d=this.extractColor();this.removeColorFromRest(),this.updateStack(d)},I.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),_={partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,divisions:d.dpq,timePos:d.timePos},a={actionName:this.name,opts:_};this.cancelStack.storeAction(a)}},I.extractColor=function(){const d=this.getNote();return O.default.getColor(d)},I.removeColorFromRest=function(){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new C.A(this.measureData,d,this.cancelStack).perform()},I.updateStack=function(d){const _=this.getLocation(),a=T.default.copy(_.timeModif),E={partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,divisions:_.dpq,timePos:_.timePos,color:d,timeModif:a},h={type:this.name,noDraw:!0,opts:E};this.cancelStack.push(h)},I.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),_=d.getPartUuid(this.opts.partIdx),a=d.getMeasureUuid(this.opts.measureIdx),E=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),h=this.measureData.getDpqValue(),o=this.getVoice(),l=o.getRangeSpace(0,this.opts.noteIdx),s=o.getNote(this.opts.noteIdx);let e=O.default.getTimeModif(s);e=T.default.copy(e),this.location={partUuid:_,measureUuid:a,voiceUuid:E,dpq:h,timePos:l,timeModif:e}}return this.location},I.getVoice=function(){return this.voice===null&&(this.voice=this.measureData.getVoice(this.opts.voiceIdx)),this.voice},(0,p.default)(A);const x=A},288572:(y,v,t)=>{t.r(v),t.d(v,{default:()=>B});var g=t(854746),O=t(32381),T=t(793317),C=t(42651);const D=function(m,M,p){this.init(m,M,p)};D.NAME="action.FormatRests",D.isAuthorizedException=function(m){return m instanceof g.A};const P=D.prototype;P.name=D.NAME,P.initMeasureData=T.default,P.init=function(m,M,p){this.initMeasureData(m,M),this.cancelStack=p,this.opts=M},P.performIfPossible=function(){this.isPossible()&&this.perform()},P.isPossible=function(){let m=!0;try{this.checkPreconditions()}catch(M){if(D.isAuthorizedException(M))m=!1;else throw M}return m},P.checkPreconditions=function(){this.checkLocation()},P.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const m=this.measureData.getVoice(this.opts.voiceIdx);m.checkNoteIdx(this.opts.noteIdx),m.checkRest(this.opts.noteIdx)},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.formatRests()},P.formatRests=function(){const m={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new O.A(this.measureData,m,this.cancelStack).perform()},(0,C.default)(D);const B=D},402315:(y,v,t)=>{t.r(v),t.d(v,{default:()=>o});var g=t(31278),O=t(702544),T=t(153271),C=t(883782),D=t(847051),P=t(123491),B=t(50060),m=t(209175),M=t(797698),p=t(890294),A=t(42651),I=t(793317),x=t(52275),d=t(704621),_=t(981801),a=t(898039);const E=function(l,s,e){this.init(l,s,e)};E.NAME="action.RemoveLyric",E.isAuthorizedException=function(l){return l instanceof O.default||l instanceof T.default||l instanceof C.default||l instanceof g.default||l instanceof D.A};const h=E.prototype;h.initMeasureData=I.default,h.name=E.NAME,h.init=function(l,s,e){(0,x.default)(l,s),(0,d.default)(l,s),(0,_.default)(l,s),this.initMeasureData(l,s),this.cancelStack=e,this.opts=s,(0,a.default)(this.measureData,s),this.location=null,this.sanitized=!1},h.performIfPossible=function(){this.isPossible()&&this.perform()},h.isPossible=function(){let l=!0;try{this.checkPreconditions()}catch(s){if(E.isAuthorizedException(s))l=!1;else throw s}return l},h.checkPreconditions=function(){this.sanitizeIfNeeded(),this.checkLocation(),this.checkExistence()},h.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},h.checkExistence=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!P.default.hasLyricAtLevel(s,this.opts.level)){const e="There is no lyric at this location.";throw new g.default(e)}},h.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.sanitizeIfNeeded(),this.storeAction();const l=this.getPreviousData();this.removeLyric(l),this.updateStack(l)},h.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.level=="undefined"&&(this.opts.level=0),this.sanitized=!0)},h.storeAction=function(){if(!this.cancelStack.hasAction()){const l=this.getLocation(),s={actionName:this.name,opts:{partUuid:l.partUuid,measureUuid:l.measureUuid,voiceUuid:l.voiceUuid,divisions:l.dpq,timePos:l.timePos,level:this.opts.level}};this.cancelStack.storeAction(s)}},h.getPreviousData=function(){const s=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),e=P.default.getLyricAtLevel(s,this.opts.level);if(B.default.hasLeftMelisma(e))return{isMelisma:!0};{const i=B.default.getText(e),c=B.default.hasRightConnection(e);return{text:i,hasRightConnection:c}}},h.removeLyric=function(l){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,level:this.opts.level};let e;l.isMelisma?e=new p.A(this.measureData,s,this.cancelStack):e=new M.A(this.measureData,s,this.cancelStack),e.perform()},h.updateStack=function(l){const s=this.getLocation(),e=m.default.copy(s.timeModif),i={partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timeModif:e,timePos:s.timePos,level:this.opts.level};l.isMelisma?i.isMelisma=!0:(i.hasRightConnection=l.hasRightConnection,i.lyric=l.text);const c={type:this.name,noDraw:!0,opts:i};this.cancelStack.push(c)},h.getLocation=function(){if(this.location===null){const l=this.measureData.getScoreData(),s=l.getPartUuid(this.opts.partIdx),e=l.getMeasureUuid(this.opts.measureIdx),i=l.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),c=this.measureData.getDpqValue(),n=this.measureData.getVoice(this.opts.voiceIdx),u=n.getRangeSpace(0,this.opts.noteIdx),r=n.getNote(this.opts.noteIdx);let f=P.default.getTimeModif(r);f=m.default.copy(f),this.location={partUuid:s,measureUuid:e,voiceUuid:i,dpq:c,timePos:u,timeModif:f}}return this.location},(0,A.default)(E);const o=E},405347:(y,v,t)=>{t.r(v),t.d(v,{default:()=>x});var g=t(123491),O=t(582458),T=t(288572),C=t(42651),D=t(898039),P=t(793317),B=t(52275),m=t(704621),M=t(981801),p=t(519405);const A=function(d,_,a){this.init(d,_,a)};A.NAME="action.ChangeDurationFormat",A.isNoChange=O.default.isNoChange;const I=A.prototype;I.initMeasureData=P.default,I.name=A.NAME,I.init=function(d,_,a){(0,B.default)(d,_),(0,m.default)(d,_),(0,M.default)(d,_),this.initMeasureData(d,_),this.cancelStack=a,this.opts=_,(0,D.default)(this.measureData,this.opts),this.action=null,this.location=null},I.checkPreconditions=function(){this.getAction().checkPreconditions()},I.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.changeDuration(),this.opts.formatRests&&this.formatRests()},I.changeDuration=function(){const d=this.getAction();d.cancelStack=this.cancelStack,d.perform()},I.getAction=function(){if(this.action===null){const d={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:this.opts.insertMode,record:this.opts.record};this.action=new O.default(this.measureData,d,this.cancelStack)}return this.action},I.formatRests=function(){const d=this.getVoiceOrTupletForGet();if(this.opts.noteIdx===d.getStopNoteIdx())return;const _=d.getNote(this.opts.noteIdx+1);if(g.default.hasTupletStart(_)||!g.default.isRest(_))return;const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx+1},E=new T.default(this.measureData,a,this.cancelStack);(0,p.default)(E)},I.getVoiceOrTupletForGet=function(){const d=this.opts.voiceIdx,_=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(d,_)},I.storeAction=function(){if(!this.cancelStack.hasAction()){const d=this.getLocation(),_={actionName:this.name,opts:{partUuid:d.partUuid,measureUuid:d.measureUuid,voiceUuid:d.voiceUuid,timePos:d.timePos,divisions:d.dpq,durationType:this.opts.durationType,nbDots:this.opts.nbDots,insertMode:this.opts.insertMode,formatRests:this.opts.formatRests||!1}};this.cancelStack.storeAction(_)}},I.getLocation=function(){if(this.location===null){const d=this.measureData.getScoreData(),_=d.getPartUuid(this.opts.partIdx),a=d.getMeasureUuid(this.opts.measureIdx),E=d.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),h=this.measureData.getDpqValue(),l=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:_,measureUuid:a,voiceUuid:E,dpq:h,timePos:l}}return this.location},(0,C.default)(A);const x=A},414208:(y,v,t)=>{t.r(v),t.d(v,{default:()=>c});var g=t(278243),O=t(807205),T=t(702544),C=t(153271),D=t(847051),P=t(195446),B=t(883782),m=t(123491),M=t(351277),p=t(742735),A=t(679676),I=t(645166),x=t(42651),d=t(691309),_=t(325600),a=t(52275),E=t(704621),h=t(981801),o=t(898039),l=t(852363),s=t(793317);const e=function(n,u,r){this.init(n,u,r)};e.NAME="action.RemoveTie",e.isAuthorizedException=function(n){return n instanceof T.default||n instanceof C.default||n instanceof O.A||n instanceof g.A||n instanceof D.A||n instanceof P.default||n instanceof B.default};const i=e.prototype;i.name=e.NAME,i.initMeasureData=s.default,i.init=function(n,u,r){(0,a.default)(n,u),(0,E.default)(n,u),(0,h.default)(n,u),this.initMeasureData(n,u),this.cancelStack=r,this.opts=u,(0,o.default)(this.measureData,u),this.crossMeasure=new d.default(this.measureData,u.voiceIdx,u.noteIdx),this.location=null},i.performIfPossible=function(){let n=!0;try{this.checkPreconditions()}catch(u){if(e.isAuthorizedException(u))n=!1;else throw u}n&&this.perform()},i.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanUntie()},i.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new P.default},i.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},i.isLeftRest=function(){return this.crossMeasure.isLeftRest()},i.isRightRest=function(){return this.crossMeasure.isRightRest()},i.checkCanUntie=function(){const n=this.getLeftChord(),u=this.getRightChord();if(!p.A.canUntieChords(n,u))throw new O.A(this.name,"nothing can be tied")},i.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const n=this.getLeftChord(),u=n.filter(m.default.hasTieStart).map(m.default.getPitch),r=this.getRightChord(),f=r.filter(m.default.hasTieStop);p.A.untieChords(n,r),this.isLastOfMeasure()&&this.updateRightAccidentals(f),this.updateStack(u)},i.storeAction=function(){if(!this.cancelStack.hasAction()){const n=this.getLocation(),u={actionName:this.name,opts:{partUuid:n.partUuid,measureUuid:n.measureUuid,divisions:n.dpq,timePos:n.timePos,voiceUuid:n.voiceUuid}};this.cancelStack.storeAction(u)}},i.getLeftChord=function(){return this.crossMeasure.getLeftChord()},i.getRightChord=function(){return this.crossMeasure.getRightChord()},i.isLastOfMeasure=function(){const r=this.crossMeasure.getLeftMeasure().getVoice(this.opts.voiceIdx).getNbNotes();return this.opts.noteIdx===r-1},i.updateRightAccidentals=function(n){n.forEach(u=>{let r=m.default.getPitch(u);const f=m.default.getStaffIdx(u),L=this.crossMeasure.getRightMeasure(),N=this.crossMeasure.getRightMeasureIdx(),j=this.crossMeasure.getRightNoteIdx();r=M.default.copy(r);const K={partIdx:this.opts.partIdx,measureIdx:N,voiceIdx:this.opts.voiceIdx,staffIdx:f,noteIdx:j,pitch:r};new I.A(L,K,this.cancelStack).perform()})},i.updateStack=function(n){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const u=this.getLocation();n.forEach(function(r){const f={type:A.default.NAME,opts:{partIdx:this.opts.partIdx,partUuid:u.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:u.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:u.timePos,divisions:u.dpq,voiceUuid:u.voiceUuid,pitch:M.default.copy(r)}};this.cancelStack.push(f),(0,l.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const L={type:`${A.default.NAME}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:M.default.copy(r)}};this.cancelStack.push(L),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,l.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},this)},i.getLocation=function(){if(this.location===null){const n=this.measureData.getScoreData(),u=n.getPartUuid(this.opts.partIdx),r=this.crossMeasure.getLeftMeasureIdx(),f=n.getMeasureUuid(r),L=n.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),N=this.crossMeasure.getLeftMeasure().getDpqValue(),j=this.crossMeasure.getLeftVoice(),K=this.crossMeasure.getLeftNoteIdx(),W=(0,_.A)(j,K);this.location={partUuid:u,measureUuid:f,voiceUuid:L,dpq:N,timePos:W}}return this.location},(0,x.default)(e);const c=e},417477:(y,v,t)=>{t.r(v),t.d(v,{default:()=>s});var g=t(278243),O=t(748803),T=t(195446),C=t(123491),D=t(351277),P=t(691309),B=t(898039),m=t(325600),M=t(52275),p=t(704621),A=t(981801),I=t(445330),x=t(607512),d=t(793317),_=t(313499),a=t(42651),E=t(31278);const h=function(e,i,c){this.init(e,i,c)};h.NAME="action.RemoveSlide";const o=h.prototype;o.name=h.NAME,o.initMeasureData=d.default,o.lineToDestPitch=_.A,o.init=function(e,i,c){(0,M.default)(e,i),(0,p.default)(e,i),(0,A.default)(e,i),this.initMeasureData(e,i),this.cancelStack=c,this.opts=i,(0,B.default)(this.measureData,i),this.crossMeasure=new P.default(this.measureData,i.voiceIdx,i.noteIdx),this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},o.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},o.isLeftRest=function(){return this.crossMeasure.isLeftRest()},o.isRightRest=function(){return this.crossMeasure.isRightRest()},o.checkPitch=function(){let e;const i=this.getLeftChord(),c=this.getRightChord();if(typeof i.find(l,this.opts.leftPitch)=="undefined")throw e={msgPrefix:"there is no left note"},new O.default(e,this.opts.leftPitch);if(typeof c.find(l,this.opts.rightPitch)=="undefined")throw e={msgPrefix:"there is no right note"},new O.default(e,this.opts.rightPitch);if(!(0,I.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch))throw new E.default};function l(e){const i=this,c=C.default.getPitch(e);return D.default.isSameLine(c,i)}o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeSlide(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,divisions:e.dpq,timePos:e.timePos,voiceUuid:e.voiceUuid,leftPitch:D.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:D.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.storeAction(i)}},o.getLeftChord=function(){return this.crossMeasure.getLeftChord()},o.getRightChord=function(){return this.crossMeasure.getRightChord()},o.removeSlide=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),leftPitch:D.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:D.default.copyWithoutAlter(this.opts.rightPitch)},i=this.crossMeasure.getLeftMeasure();new x.A(i,e,this.cancelStack).perform()},o.updateStack=function(){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const e=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:e.timePos,divisions:e.dpq,voiceUuid:e.voiceUuid,leftPitch:D.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:D.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.push(i)},o.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),i=e.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),n=e.getMeasureUuid(c),u=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),r=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),L=this.crossMeasure.getLeftNoteIdx(),N=(0,m.A)(f,L);this.location={partUuid:i,measureUuid:n,voiceUuid:u,dpq:r,timePos:N}}return this.location},(0,a.default)(h);const s=h},487332:(y,v,t)=>{t.r(v),t.d(v,{default:()=>s});var g=t(793317),O=t(52275),T=t(704621),C=t(981801),D=t(898039),P=t(927403),B=t(325600),m=t(195446),M=t(821828),p=t(278243),A=t(123491),I=t(724926),x=t(359932),d=t(369790),_=t(524795),a=t(652413),E=t(42651),h=t(691309);const o=function(e,i,c){this.init(e,i,c)};o.NAME="action.RemoveHammerOnPullOffs";const l=o.prototype;l.name=o.NAME,l.initMeasureData=g.default,l.init=function(e,i,c){(0,O.default)(e,i),(0,T.default)(e,i),(0,C.default)(e,i),this.initMeasureData(e,i),this.opts=i,this.cancelStack=c,this.location=null,(0,D.default)(this.measureData,i),this.crossMeasure=new h.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},l.performIfPossible=function(){let e=!0;try{this.checkPreconditions()}catch(i){if(a.default.isAuthorizedException(i))e=!1;else throw i}e&&this.perform()},l.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkTabPart(),this.checkExistence()},l.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new m.default},l.checkNotRest=function(){if(this.crossMeasure.isLeftRest()||this.crossMeasure.isRightRest())throw new p.A},l.checkTabPart=function(){(0,P.A)(this.measureData,this.opts)},l.checkExistence=function(){const e=this.crossMeasure.getLeftChord(),i=this.getTechnicalOpts(d.A.START);if(!e.some(function(c){return A.default.hasTechnical(c,x.default.HAMMER_ON,i)||A.default.hasTechnical(c,x.default.PULL_OFF,i)}))throw new M.A},l.getTechnicalOpts=function(e){return{hammerOnPullOff:I.A.create(e)}},l.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const e={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx()};new _.A(this.crossMeasure.getLeftMeasure(),e,this.cancelStack).perform()},l.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,voiceUuid:e.voiceUuid,timePos:e.timePos,divisions:e.dpq}};this.cancelStack.storeAction(i)}},l.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),i=e.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),n=e.getMeasureUuid(c),u=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),r=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),L=this.crossMeasure.getLeftNoteIdx(),N=(0,B.A)(f,L);this.location={partUuid:i,measureUuid:n,voiceUuid:u,dpq:r,timePos:N}}return this.location},(0,E.default)(o);const s=o},575269:(y,v,t)=>{t.r(v),t.d(v,{default:()=>B});var g=t(31278),O=t(911066),T=t(42651),C=t(519405);const D=function(m,M,p){this.init(m,M,p)};D.NAME="action.SetDisplayMode";const P=D.prototype;P.name=D.NAME,P.init=function(m,M,p){this.scoreData=m,this.cancelStack=p,this.opts=M},P.checkPreconditions=function(){if(O.A.check(this.opts.displayModeType),this.scoreData.isDisplayModeEnabled(this.opts.displayModeType)===this.opts.enabled)throw new g.default},P.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const m=this.getPreviousData();this.removeConflictingModes(),this.setDisplayMode(),this.updateStack(m)},P.storeAction=function(){if(!this.cancelStack.hasAction()){const m={actionName:this.name,opts:{displayModeType:this.opts.displayModeType,enabled:this.opts.enabled}};this.cancelStack.storeAction(m)}},P.getPreviousData=function(){return{enabled:this.scoreData.isDisplayModeEnabled(this.opts.displayModeType)}},P.removeConflictingModes=function(){this.opts.enabled&&O.A.noteheadValues.includes(this.opts.displayModeType)&&O.A.noteheadValues.forEach(m=>{this.scoreData.isDisplayModeEnabled(m)&&this.disableDisplayMode(m)})},P.disableDisplayMode=function(m){const M={enabled:!1,displayModeType:m},p=new D(this.scoreData,M,this.cancelStack);(0,C.default)(p)},P.setDisplayMode=function(){this.scoreData.setDisplayMode(this.opts.displayModeType,!!this.opts.enabled)},P.updateStack=function(m){const M={type:this.name,noDraw:!0,opts:{displayModeType:this.opts.displayModeType,enabled:m.enabled}};this.cancelStack.push(M),this.cancelStack.stateNeedCompleteRedraw()},(0,T.default)(D);const B=D},582458:(y,v,t)=>{t.r(v),t.d(v,{default:()=>l});var g=t(364842),O=t(279140),T=t(31278),C=t(123491),D=t(209175),P=t(737296),B=t(898039),m=t(975924),M=t(52275),p=t(704621),A=t(981801),I=t(349386),x=t(972913),d=t(788705),_=t(42651),a=t(793317),E=t(543371);const h=function(s,e,i){this.init(s,e,i)};h.NAME="action.ChangeDuration",h.isNoChange=function(s){return s instanceof T.default};const o=h.prototype;o.initMeasureData=a.default,o.name=h.NAME,o.init=function(s,e,i){(0,M.default)(s,e),(0,p.default)(s,e),(0,A.default)(s,e),this.initMeasureData(s,e),this.cancelStack=i,this.opts=e,(0,B.default)(this.measureData,this.opts),this.previousDurationType=null,this.previousNbDots=null,this.location=null},o.checkPreconditions=function(){(0,x.default)(this.opts),this.checkLocation(),this.checkAvailableSpace()},o.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},o.checkAvailableSpace=function(){let s=this.getRequiredDuration();const e=this.getActualDuration();if(e>s)return;if(e===s)throw new T.default;s-=e;const i=this.getAvailableSpace();i<s&&this.raiseNotEnoughSpace(s,i)},o.getRequiredDuration=function(){const s=this.measureData.getDpqValue(),e=this.getTimeModif();return(0,I.default)(this.opts,s,e)},o.getTimeModif=function(){return this.getVoiceOrTupletForGet().getAbsoluteTimeModif()},o.getActualDuration=function(){const e=this.getVoice().getNote(this.opts.noteIdx);return C.default.getDuration(e)},o.getAvailableSpace=function(){const s=this.getVoiceOrTupletForGet(),e=this.opts.noteIdx+1;let i;if(this.opts.insertMode===P.default.REPLACE)i=s.getAvailableSpaceAtIdx(e);else if(this.opts.insertMode===P.default.INSERT)i=s.getAvailableSpaceAtEnd(e);else{const c=`The insertion mode value [${this.opts.insertMode}] is invalid. `;throw new g.default("BadInsertMode",c)}return i},o.raiseNotEnoughSpace=function(s,e){const i=this.getVoiceOrTupletForGet(),c=this.measureData.getDpqValue(),n=i.getAbsoluteTimeModif();throw new O.default(s,e,c,n)},o.getVoiceOrTupletForGet=function(){const s=this.opts.voiceIdx,e=this.opts.noteIdx;return this.measureData.getVoiceOrTupletForGet(s,e)},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),typeof this.opts.record=="undefined"&&(this.opts.record=!0),this.opts.record&&this.recordPreviousDuration(),this.storeAction(),this.changeDuration(),this.opts.record&&this.updateStack()},o.recordPreviousDuration=function(){const e=this.getVoice().getNote(this.opts.noteIdx),i=this.measureData.getDpqValue();this.previousDurationType=(0,m.default)(e,i),this.previousNbDots=C.default.getNbDots(e)},o.changeDuration=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,insertMode:this.opts.insertMode,durationType:this.opts.durationType,nbDots:this.opts.nbDots};new d.default(this.measureData,s,this.cancelStack).perform()},o.updateStack=function(){const s=this.getLocation(),e={type:this.name,noDraw:!0,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,previousNbDots:this.previousNbDots,previousDurationType:this.previousDurationType,insertMode:this.opts.insertMode}},i=this.getVoice();if(i.isRest(this.opts.noteIdx)&&this.opts.insertMode===P.default.REPLACE){e.type=E.default.NAME;const c=i.getNote(this.opts.noteIdx);let n=C.default.getTimeModif(c);n=D.default.copy(n),e.opts.timeModif=n}this.cancelStack.push(e)},o.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,voiceUuid:s.voiceUuid,divisions:s.dpq,timePos:s.timePos,nbDots:this.opts.nbDots,durationType:this.opts.durationType,insertMode:this.opts.insertMode}};this.cancelStack.storeAction(e)}},o.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),e=s.getPartUuid(this.opts.partIdx),i=s.getMeasureUuid(this.opts.measureIdx),c=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),r=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:i,voiceUuid:c,dpq:n,timePos:r}}return this.location},o.getVoice=function(){return this.measureData.getVoice(this.opts.voiceIdx)},(0,_.default)(h);const l=h},638908:(y,v,t)=>{t.r(v),t.d(v,{default:()=>_});var g=t(817490),O=t(363258),T=t(123491),C=t(209175),D=t(601277),P=t(793317),B=t(898039),m=t(52275),M=t(704621),p=t(981801),A=t(284269),I=t(42651);const x=function(a,E,h){this.init(a,E,h)};x.NAME="action.RemoveNotation";const d=x.prototype;d.initMeasureData=P.default,d.name=x.NAME,d.init=function(a,E,h){(0,m.default)(a,E),(0,M.default)(a,E),(0,p.default)(a,E),this.initMeasureData(a,E),this.cancelStack=h,this.opts=E,this.location=null,(0,B.default)(this.measureData,this.opts)},d.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},d.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx),this.measureData.getVoice(this.opts.voiceIdx).checkNoteIdx(this.opts.noteIdx)},d.checkExistence=function(){if(!D.default.isValid(this.opts.notationType))throw new g.A(this.opts.notationType);const E=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!T.default.hasNotation(E,this.opts.notationType))throw new O.A(this.opts.notationType)},d.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,notationType:this.opts.notationType,noteIdx:this.opts.noteIdx};new A.A(this.measureData,a,this.cancelStack).perform(),this.updateStack()},d.updateStack=function(){const a=this.getLocation(),E=C.default.copy(a.timeModif),h={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,notationType:this.opts.notationType,timePos:a.timePos,divisions:a.dpq,timeModif:E}};this.cancelStack.push(h)},d.storeAction=function(){if(!this.cancelStack.hasAction()){const a=this.getLocation(),E={actionName:this.name,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,notationType:this.opts.notationType,timePos:a.timePos,divisions:a.dpq}};this.cancelStack.storeAction(E)}},d.getLocation=function(){if(this.location===null){const a=this.measureData.getScoreData(),E=a.getPartUuid(this.opts.partIdx),h=a.getMeasureUuid(this.opts.measureIdx),o=a.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),l=this.measureData.getDpqValue(),s=this.measureData.getVoice(this.opts.voiceIdx),e=s.getRangeSpace(0,this.opts.noteIdx),i=s.getNote(this.opts.noteIdx);let c=T.default.getTimeModif(i);c=C.default.copy(c),this.location={partUuid:E,measureUuid:h,voiceUuid:o,dpq:l,timePos:e,timeModif:c}}return this.location},(0,I.default)(x);const _=x},652413:(y,v,t)=>{t.r(v),t.d(v,{default:()=>V});var g=t(793317),O=t(52275),T=t(704621),C=t(981801),D=t(783177),P=t(898039),B=t(927403),m=t(325600),M=t(476031),p=t(287296),A=t(766457),I=t(691309),x=t(364842),d=t(195446),_=t(278243),a=t(821828),E=t(702544),h=t(153271),o=t(847051),l=t(883782),s=t(800946),e=t(748803),i=t(727867),c=t(737903),n=t(123491),u=t(724926),r=t(351277),f=t(359932),L=t(369790),N=t(810663),j=t(42651);const K=function(U,R,S){this.init(U,R,S)};K.NAME="action.RemoveHammerOnPullOff",K.isAuthorizedException=function(U){return U instanceof E.default||U instanceof h.default||U instanceof o.A||U instanceof l.default||U instanceof _.A||U instanceof d.default||U instanceof a.A||U instanceof s.A||U instanceof e.default||U instanceof i.A};const W=K.prototype;W.name=K.NAME,W.initMeasureData=g.default,W.init=function(U,R,S){(0,O.default)(U,R),(0,T.default)(U,R),(0,C.default)(U,R),(0,D.default)(U,R),this.initMeasureData(U,R),this.opts=R,this.cancelStack=S,this.location=null,this.leftNote=null,this.rightNote=null,this.sanitized=!1,(0,P.default)(this.measureData,R),this.crossMeasure=new I.default(this.measureData,this.opts.voiceIdx,this.opts.noteIdx)},W.performIfPossible=function(){let U=!0;try{this.checkPreconditions()}catch(R){if(K.isAuthorizedException(R))U=!1;else throw R}U&&this.perform()},W.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkTabPart(),this.sanitizeIfNeeded(),this.checkPitch(),this.checkNoteAtPitch(),this.checkFretData(),this.checkExistence()},W.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new d.default},W.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new _.A},W.isLeftRest=function(){return this.crossMeasure.isLeftRest()},W.isRightRest=function(){return this.crossMeasure.isRightRest()},W.checkTabPart=function(){(0,B.A)(this.measureData,this.opts)},W.sanitizeIfNeeded=function(){this.sanitized||(typeof this.opts.line!="undefined"&&(0,M.default)(this.measureData,this.opts,!0),this.opts.isConcertPitch&&(0,p.default)(this.measureData,this.opts),typeof this.opts.fretData!="undefined"&&this.convertExistingFretToPitch(),this.sanitized=!0)},W.convertExistingFretToPitch=function(){const U={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,fretData:(0,c.default)(this.opts.fretData)};this.opts.pitch=(0,A.A)(this.measureData,U)},W.checkPitch=function(){r.default.check(this.opts.pitch)},W.checkNoteAtPitch=function(){if(typeof this.getLeftNote()=="undefined"){const R=r.default.copy(this.opts.pitch);throw new e.default(e.default.GET,R)}},W.checkFretData=function(){const U=this.getLeftNote();if(!n.default.hasFretData(U))throw new i.A(this.opts.pitch)},W.checkExistence=function(){const U=this.getLeftNote(),R=this.getRightNote(),S=this.getTechnicalOpts(L.A.START),G=this.getTechnicalOpts(L.A.STOP);if(!n.default.hasTechnical(U,f.default.HAMMER_ON,S)&&!n.default.hasTechnical(U,f.default.PULL_OFF,S))throw new a.A;if(!R||!n.default.hasTechnical(R,f.default.HAMMER_ON,G)&&!n.default.hasTechnical(R,f.default.PULL_OFF,G))throw new a.A},W.getTechnicalOpts=function(U){return{hammerOnPullOff:u.A.create(U)}},W.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const U=this.getTechnicalType(),R=this.getLeftNote(),S=n.default.getPitch(R);this.storeAction(S);const G={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx,technicalType:U,pitch:r.default.copy(S)};new N.A(this.measureData,G,this.cancelStack).perform(),this.updateStack(S)},W.getTechnicalType=function(){const U=this.getLeftNote(),R=this.getTechnicalOpts(L.A.START);if(n.default.hasTechnical(U,f.default.HAMMER_ON,R))return f.default.HAMMER_ON;if(n.default.hasTechnical(U,f.default.PULL_OFF,R))return f.default.PULL_OFF;throw new x.default("Unexpected")},W.getLeftNote=function(){if(this.leftNote===null){const U=this.crossMeasure.getLeftChord();this.leftNote=U.find(this.pitchPredicate,this)}return this.leftNote},W.pitchPredicate=function(U){const R=n.default.getPitch(U);return r.default.isSameLine(R,this.opts.pitch)},W.getRightNote=function(){if(this.rightNote===null){const U=this.getLeftNote(),R=this.crossMeasure.getRightChord(),S=n.default.getFretData(U);this.rightNote=R.find(this.stringPredicate,S)}return this.rightNote},W.stringPredicate=function(U){const R=this;return n.default.hasFretData(U)?n.default.getFretData(U).string===R.string:!1},W.storeAction=function(U){if(!this.cancelStack.hasAction()){const R=this.getLocation(),S={actionName:this.name,opts:{partUuid:R.partUuid,measureUuid:R.measureUuid,voiceUuid:R.voiceUuid,timePos:R.timePos,divisions:R.dpq,pitch:r.default.copy(U)}};this.cancelStack.storeAction(S)}},W.updateStack=function(U){const R=this.getLocation(),S={type:this.name,noDraw:!0,opts:{partUuid:R.partUuid,measureUuid:R.measureUuid,voiceUuid:R.voiceUuid,timePos:R.timePos,divisions:R.dpq,pitch:r.default.copy(U)}};this.cancelStack.push(S)},W.getLocation=function(){if(this.location===null){const U=this.measureData.getScoreData(),R=U.getPartUuid(this.opts.partIdx),S=this.crossMeasure.getLeftMeasureIdx(),G=U.getMeasureUuid(S),F=U.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),k=this.crossMeasure.getLeftMeasure().getDpqValue(),z=this.crossMeasure.getLeftVoice(),H=this.crossMeasure.getLeftNoteIdx(),X=(0,m.A)(z,H);this.location={partUuid:R,measureUuid:G,voiceUuid:F,dpq:k,timePos:X}}return this.location},(0,j.default)(K);const V=K},669208:(y,v,t)=>{t.r(v),t.d(v,{default:()=>s});var g=t(278243),O=t(748803),T=t(195446),C=t(123491),D=t(351277),P=t(691309),B=t(898039),m=t(325600),M=t(52275),p=t(704621),A=t(981801),I=t(103219),x=t(577811),d=t(793317),_=t(313499),a=t(42651),E=t(31278);const h=function(e,i,c){this.init(e,i,c)};h.NAME="action.RemoveGlissando";const o=h.prototype;o.name=h.NAME,o.initMeasureData=d.default,o.lineToDestPitch=_.A,o.init=function(e,i,c){(0,M.default)(e,i),(0,p.default)(e,i),(0,A.default)(e,i),this.initMeasureData(e,i),this.cancelStack=c,this.opts=i,(0,B.default)(this.measureData,i),this.crossMeasure=new P.default(this.measureData,i.voiceIdx,i.noteIdx),this.location=null},o.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new T.default},o.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},o.isLeftRest=function(){return this.crossMeasure.isLeftRest()},o.isRightRest=function(){return this.crossMeasure.isRightRest()},o.checkPitch=function(){let e;const i=this.getLeftChord(),c=this.getRightChord();if(typeof i.find(l,this.opts.leftPitch)=="undefined")throw e={msgPrefix:"there is no left note"},new O.default(e,this.opts.leftPitch);if(typeof c.find(l,this.opts.rightPitch)=="undefined")throw e={msgPrefix:"there is no right note"},new O.default(e,this.opts.rightPitch);if(!(0,I.A)(this.crossMeasure,this.opts.leftPitch,this.opts.rightPitch))throw new E.default};function l(e){const i=this,c=C.default.getPitch(e);return D.default.isSameLine(c,i)}o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeGlissando(),this.updateStack()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const e=this.getLocation(),i={actionName:this.name,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,divisions:e.dpq,timePos:e.timePos,voiceUuid:e.voiceUuid,leftPitch:D.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:D.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.storeAction(i)}},o.getLeftChord=function(){return this.crossMeasure.getLeftChord()},o.getRightChord=function(){return this.crossMeasure.getRightChord()},o.removeGlissando=function(){const e={partIdx:this.opts.partIdx,measureIdx:this.crossMeasure.getLeftMeasureIdx(),voiceIdx:this.opts.voiceIdx,noteIdx:this.crossMeasure.getLeftNoteIdx(),leftPitch:D.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:D.default.copyWithoutAlter(this.opts.rightPitch)},i=this.crossMeasure.getLeftMeasure();new x.A(i,e,this.cancelStack).perform()},o.updateStack=function(){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const e=this.getLocation(),i={type:this.name,noDraw:!0,opts:{partUuid:e.partUuid,measureUuid:e.measureUuid,timePos:e.timePos,divisions:e.dpq,voiceUuid:e.voiceUuid,leftPitch:D.default.copyWithoutAlter(this.opts.leftPitch),rightPitch:D.default.copyWithoutAlter(this.opts.rightPitch)}};this.cancelStack.push(i)},o.getLocation=function(){if(this.location===null){const e=this.measureData.getScoreData(),i=e.getPartUuid(this.opts.partIdx),c=this.crossMeasure.getLeftMeasureIdx(),n=e.getMeasureUuid(c),u=e.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),r=this.crossMeasure.getLeftMeasure().getDpqValue(),f=this.crossMeasure.getLeftVoice(),L=this.crossMeasure.getLeftNoteIdx(),N=(0,m.A)(f,L);this.location={partUuid:i,measureUuid:n,voiceUuid:u,dpq:r,timePos:N}}return this.location},(0,a.default)(h);const s=h},679676:(y,v,t)=>{t.r(v),t.d(v,{default:()=>u});var g=t(278243),O=t(748803),T=t(807205),C=t(702544),D=t(153271),P=t(883782),B=t(847051),m=t(195446),M=t(123491),p=t(351277),A=t(742735),I=t(691309),x=t(898039),d=t(325600),_=t(52275),a=t(704621),E=t(981801),h=t(287296),o=t(852363),l=t(793317),s=t(313499),e=t(645166),i=t(42651);const c=function(r,f,L){this.init(r,f,L)};c.NAME="action.RemoveTieArc",c.isAuthorizedException=function(r){return r instanceof C.default||r instanceof D.default||r instanceof P.default||r instanceof B.A||r instanceof T.A||r instanceof g.A||r instanceof O.default||r instanceof m.default};const n=c.prototype;n.name=c.NAME,n.initMeasureData=l.default,n.lineToDestPitch=s.A,n.init=function(r,f,L){(0,_.default)(r,f),(0,a.default)(r,f),(0,E.default)(r,f),this.initMeasureData(r,f),this.cancelStack=L,this.opts=f,(0,x.default)(this.measureData,f),this.lineToDestPitch(),this.opts.isConcertPitch&&(this.opts.pitch=p.default.copy(this.opts),(0,h.default)(this.measureData,this.opts),this.opts.octave=p.default.getOctave(this.opts.pitch),this.opts.step=p.default.getStep(this.opts.pitch)),this.crossMeasure=new I.default(this.measureData,f.voiceIdx,f.noteIdx),this.location=null},n.checkPreconditions=function(){this.checkPitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkPitch()},n.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new m.default},n.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},n.isLeftRest=function(){return this.crossMeasure.isLeftRest()},n.isRightRest=function(){return this.crossMeasure.isRightRest()},n.checkPitch=function(){let r;const f=this.getLeftChord(),L=this.getRightChord(),N=f.find(this.pitchPredicate,this);if(typeof N=="undefined")throw r={msgPrefix:"there is no left note"},new O.default(r,this.opts);const j=L.find(this.pitchPredicate,this);if(typeof j=="undefined")throw r={msgPrefix:"there is no right note"},new O.default(r,this.opts);const K=M.default.getPitch(N),W=M.default.getPitch(j);if(!p.default.isSamePitch(K,W))throw new T.A(this.name,"notes must have the same pitch");if(!A.A.areNotesTied(N,j))throw new T.A(this.name,"notes are not tied")},n.pitchPredicate=function(r){const f=M.default.getPitch(r);return p.default.isSameLine(f,this.opts)},n.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const f=this.getLeftChord().find(this.pitchPredicate,this),L=M.default.getPitch(f),j=this.getRightChord().find(this.pitchPredicate,this);A.A.untieNotes(f,j),this.isLastOfMeasure()&&this.updateRightAccidental(j),this.updateStack(L)},n.storeAction=function(){if(!this.cancelStack.hasAction()){const r=this.getLocation(),f={actionName:this.name,opts:{partUuid:r.partUuid,measureUuid:r.measureUuid,divisions:r.dpq,timePos:r.timePos,voiceUuid:r.voiceUuid,octave:this.opts.octave,step:this.opts.step}};this.cancelStack.storeAction(f)}},n.getLeftChord=function(){return this.crossMeasure.getLeftChord()},n.getRightChord=function(){return this.crossMeasure.getRightChord()},n.isLastOfMeasure=function(){const L=this.crossMeasure.getLeftMeasure().getVoice(this.opts.voiceIdx).getNbNotes();return this.opts.noteIdx===L-1},n.updateRightAccidental=function(r){let f=M.default.getPitch(r);const L=M.default.getStaffIdx(r),N=this.crossMeasure.getRightMeasure(),j=this.crossMeasure.getRightMeasureIdx(),K=this.crossMeasure.getRightNoteIdx();f=p.default.copy(f);const W={partIdx:this.opts.partIdx,measureIdx:j,voiceIdx:this.opts.voiceIdx,staffIdx:L,noteIdx:K,pitch:f};new e.A(N,W,this.cancelStack).perform()},n.updateStack=function(r){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const f=this.getLocation(),L={type:this.name,opts:{partIdx:this.opts.partIdx,partUuid:f.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:f.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:f.timePos,divisions:f.dpq,voiceUuid:f.voiceUuid,pitch:p.default.copy(r)}};this.cancelStack.push(L),(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const N={type:`${this.name}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,pitch:p.default.copy(r)}};this.cancelStack.push(N),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},n.getLocation=function(){if(this.location===null){const r=this.measureData.getScoreData(),f=r.getPartUuid(this.opts.partIdx),L=this.crossMeasure.getLeftMeasureIdx(),N=r.getMeasureUuid(L),j=r.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),K=this.crossMeasure.getLeftMeasure().getDpqValue(),W=this.crossMeasure.getLeftVoice(),V=this.crossMeasure.getLeftNoteIdx(),U=(0,d.A)(W,V);this.location={partUuid:f,measureUuid:N,voiceUuid:j,dpq:K,timePos:U}}return this.location},(0,i.default)(c);const u=c},704588:(y,v,t)=>{t.r(v),t.d(v,{default:()=>l});var g=t(31278),O=t(195446),T=t(278243),C=t(883782),D=t(847051),P=t(702544),B=t(153271),m=t(898039),M=t(52275),p=t(704621),A=t(981801),I=t(793317),x=t(313499),d=t(42651),_=t(218371),a=t(476943),E=t(123491);const h=function(s,e,i){this.init(s,e,i)};h.NAME="action.RemoveChordRightSlides",h.isAuthorizedException=function(s){return s instanceof O.default||s instanceof T.A||s instanceof C.default||s instanceof D.A||s instanceof g.default||s instanceof P.default||s instanceof B.default};const o=h.prototype;o.name=h.NAME,o.initMeasureData=I.default,o.lineToDestPitch=x.A,o.init=function(s,e,i){(0,M.default)(s,e),(0,p.default)(s,e),(0,A.default)(s,e),this.initMeasureData(s,e),this.cancelStack=i,this.opts=e,(0,m.default)(this.measureData,e),this.location=null},o.isPossible=function(){try{this.checkPreconditions()}catch(s){if(h.isAuthorizedException(s))return!1;throw s}return!0},o.performIfPossible=function(){this.isPossible()&&this.perform()},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const s=this.measureData.getVoice(this.opts.voiceIdx);s.checkNoteIdx(this.opts.noteIdx),s.checkNotRest(this.opts.noteIdx),this.checkSlideStart()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},o.checkSlideStart=function(){let e=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);if(e=a.default.makeArray(e),!e.some(E.default.hasSlideStart))throw new g.default},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeChordRightSlides()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,divisions:s.dpq,timePos:s.timePos,voiceUuid:s.voiceUuid}};this.cancelStack.storeAction(e)}},o.removeChordRightSlides=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new _.A(this.measureData,s,this.cancelStack).perform()},o.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),e=s.getPartUuid(this.opts.partIdx),i=s.getMeasureUuid(this.opts.measureIdx),c=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),r=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:i,voiceUuid:c,dpq:n,timePos:r}}return this.location},(0,d.default)(h);const l=h},705967:(y,v,t)=>{t.r(v),t.d(v,{default:()=>l});var g=t(31278),O=t(195446),T=t(278243),C=t(883782),D=t(847051),P=t(702544),B=t(153271),m=t(898039),M=t(52275),p=t(704621),A=t(981801),I=t(793317),x=t(313499),d=t(42651),_=t(45876),a=t(476943),E=t(123491);const h=function(s,e,i){this.init(s,e,i)};h.NAME="action.RemoveChordRightGlissandos",h.isAuthorizedException=function(s){return s instanceof O.default||s instanceof T.A||s instanceof C.default||s instanceof D.A||s instanceof g.default||s instanceof P.default||s instanceof B.default};const o=h.prototype;o.name=h.NAME,o.initMeasureData=I.default,o.lineToDestPitch=x.A,o.init=function(s,e,i){(0,M.default)(s,e),(0,p.default)(s,e),(0,A.default)(s,e),this.initMeasureData(s,e),this.cancelStack=i,this.opts=e,(0,m.default)(this.measureData,e),this.location=null},o.isPossible=function(){try{this.checkPreconditions()}catch(s){if(h.isAuthorizedException(s))return!1;throw s}return!0},o.performIfPossible=function(){this.isPossible()&&this.perform()},o.checkPreconditions=function(){this.checkPitchedPart(),this.measureData.checkVoiceIdx(this.opts.voiceIdx);const s=this.measureData.getVoice(this.opts.voiceIdx);s.checkNoteIdx(this.opts.noteIdx),s.checkNotRest(this.opts.noteIdx),this.checkGlissandoStart()},o.checkPitchedPart=function(){if(this.measureData.isUnpitched())throw new O.default},o.checkGlissandoStart=function(){let e=this.measureData.getVoice(this.opts.voiceIdx).getChord(this.opts.noteIdx);if(e=a.default.makeArray(e),!e.some(E.default.hasGlissandoStart))throw new g.default},o.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction(),this.removeChordRightGlissandos()},o.storeAction=function(){if(!this.cancelStack.hasAction()){const s=this.getLocation(),e={actionName:this.name,opts:{partUuid:s.partUuid,measureUuid:s.measureUuid,divisions:s.dpq,timePos:s.timePos,voiceUuid:s.voiceUuid}};this.cancelStack.storeAction(e)}},o.removeChordRightGlissandos=function(){const s={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new _.A(this.measureData,s,this.cancelStack).perform()},o.getLocation=function(){if(this.location===null){const s=this.measureData.getScoreData(),e=s.getPartUuid(this.opts.partIdx),i=s.getMeasureUuid(this.opts.measureIdx),c=s.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),n=this.measureData.getDpqValue(),r=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:e,measureUuid:i,voiceUuid:c,dpq:n,timePos:r}}return this.location},(0,d.default)(h);const l=h},805396:(y,v,t)=>{t.r(v),t.d(v,{default:()=>d});var g=t(31278),O=t(737903),T=t(123491),C=t(793317),D=t(898039),P=t(52275),B=t(704621),m=t(981801),M=t(724095),p=t(599888),A=t(42651);const I=function(_,a,E){this.init(_,a,E)};I.NAME="action.RemoveTremolo2";const x=I.prototype;x.initMeasureData=C.default,x.name=I.NAME,x.init=function(_,a,E){(0,P.default)(_,a),(0,B.default)(_,a),(0,m.default)(_,a),this.initMeasureData(_,a),this.cancelStack=E,this.opts=(0,O.default)(a),this.location=null,(0,D.default)(this.measureData,this.opts)},x.checkPreconditions=function(){this.checkLocation(),this.checkExistence()},x.checkLocation=function(){this.measureData.checkVoiceIdx(this.opts.voiceIdx);const _=this.measureData.getVoice(this.opts.voiceIdx);_.checkNoteIdx(this.opts.noteIdx),_.checkNotRest(this.opts.noteIdx)},x.checkExistence=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx);if(!T.default.hasTremoloStart(a))throw new g.default},x.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name);const _=this.extractNbBeams();this.storeAction();const a={partIdx:this.opts.partIdx,measureIdx:this.opts.measureIdx,voiceIdx:this.opts.voiceIdx,noteIdx:this.opts.noteIdx};new p.A(this.measureData,a,this.cancelStack).perform(),this.updateStack(_)},x.extractNbBeams=function(){const a=this.measureData.getVoice(this.opts.voiceIdx).getNote(this.opts.noteIdx),{nbBeam:E}=T.default.getOrnamentOpts(a,M.A.TREMOLO);return E},x.updateStack=function(_){const a=this.getLocation(),E={type:this.name,noDraw:!0,opts:{partUuid:a.partUuid,measureUuid:a.measureUuid,voiceUuid:a.voiceUuid,timePos:a.timePos,divisions:a.dpq,nbBeams:_}};this.cancelStack.push(E)},x.storeAction=function(){if(!this.cancelStack.hasAction()){const _=this.getLocation(),a={actionName:this.name,opts:{partUuid:_.partUuid,measureUuid:_.measureUuid,voiceUuid:_.voiceUuid,timePos:_.timePos,divisions:_.dpq}};this.cancelStack.storeAction(a)}},x.getLocation=function(){if(this.location===null){const _=this.measureData.getScoreData(),a=_.getPartUuid(this.opts.partIdx),E=_.getMeasureUuid(this.opts.measureIdx),h=_.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),o=this.measureData.getDpqValue(),s=this.measureData.getVoice(this.opts.voiceIdx).getRangeSpace(0,this.opts.noteIdx);this.location={partUuid:a,measureUuid:E,voiceUuid:h,dpq:o,timePos:s}}return this.location},(0,A.default)(I);const d=I},846541:(y,v,t)=>{t.r(v),t.d(v,{default:()=>i});var g=t(278243),O=t(807205),T=t(702544),C=t(153271),D=t(847051),P=t(99923),B=t(883782),m=t(123491),M=t(292681),p=t(742735),A=t(934462),I=t(42651),x=t(691309),d=t(325600),_=t(52275),a=t(704621),E=t(981801),h=t(898039),o=t(852363),l=t(793317);const s=function(c,n,u){this.init(c,n,u)};s.NAME="action.RemoveTiePercu",s.isAuthorizedException=function(c){return c instanceof T.default||c instanceof C.default||c instanceof O.A||c instanceof g.A||c instanceof D.A||c instanceof P.A||c instanceof B.default};const e=s.prototype;e.name=s.NAME,e.initMeasureData=l.default,e.init=function(c,n,u){(0,_.default)(c,n),(0,a.default)(c,n),(0,E.default)(c,n),this.initMeasureData(c,n),this.cancelStack=u,this.opts=n,(0,h.default)(this.measureData,n),this.crossMeasure=new x.default(this.measureData,n.voiceIdx,n.noteIdx),this.location=null},e.performIfPossible=function(){let c=!0;try{this.checkPreconditions()}catch(n){if(s.isAuthorizedException(n))c=!1;else throw n}c&&this.perform()},e.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.checkCanUntie()},e.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new P.A},e.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},e.isLeftRest=function(){return this.crossMeasure.isLeftRest()},e.isRightRest=function(){return this.crossMeasure.isRightRest()},e.checkCanUntie=function(){const c=this.getLeftChord(),n=this.getRightChord();if(!p.A.canUntieChords(c,n,!0))throw new O.A(this.name,"nothing can be tied")},e.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const c=this.getLeftChord(),n=c.filter(m.default.hasTieStart).map(m.default.getUnpitched),u=this.getRightChord();p.A.untieChords(c,u,!0),this.updateStack(n)},e.storeAction=function(){if(!this.cancelStack.hasAction()){const c=this.getLocation(),n={actionName:this.name,opts:{partUuid:c.partUuid,measureUuid:c.measureUuid,divisions:c.dpq,timePos:c.timePos,voiceUuid:c.voiceUuid}};this.cancelStack.storeAction(n)}},e.getLeftChord=function(){return this.crossMeasure.getLeftChord()},e.getRightChord=function(){return this.crossMeasure.getRightChord()},e.updateStack=function(c){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const n=this.getLocation();c.forEach(function(u){const r={type:A.default.NAME,opts:{partIdx:this.opts.partIdx,partUuid:n.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:n.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:n.timePos,divisions:n.dpq,voiceUuid:n.voiceUuid,unpitched:M.default.copy(u)}};this.cancelStack.push(r),(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const f={type:`${A.default.NAME}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:M.default.copy(u)}};this.cancelStack.push(f),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,o.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},this)},e.getLocation=function(){if(this.location===null){const c=this.measureData.getScoreData(),n=c.getPartUuid(this.opts.partIdx),u=this.crossMeasure.getLeftMeasureIdx(),r=c.getMeasureUuid(u),f=c.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),L=this.crossMeasure.getLeftMeasure().getDpqValue(),N=this.crossMeasure.getLeftVoice(),j=this.crossMeasure.getLeftNoteIdx(),K=(0,d.A)(N,j);this.location={partUuid:n,measureUuid:r,voiceUuid:f,dpq:L,timePos:K}}return this.location},(0,I.default)(s);const i=s},934462:(y,v,t)=>{t.r(v),t.d(v,{default:()=>n});var g=t(278243),O=t(247739),T=t(807205),C=t(702544),D=t(153271),P=t(883782),B=t(847051),m=t(99923),M=t(123491),p=t(292681),A=t(742735),I=t(691309),x=t(898039),d=t(325600),_=t(52275),a=t(704621),E=t(981801),h=t(852363),o=t(793317),l=t(831250),s=t(803192),e=t(42651);const i=function(u,r,f){this.init(u,r,f)};i.NAME="action.RemoveTieArcPercu",i.isAuthorizedException=function(u){return u instanceof C.default||u instanceof D.default||u instanceof P.default||u instanceof B.A||u instanceof T.A||u instanceof g.A||u instanceof O.A||u instanceof m.A};const c=i.prototype;c.name=i.NAME,c.initMeasureData=o.default,c.lineToDestUnpitched=l.A,c.init=function(u,r,f){(0,_.default)(u,r),(0,a.default)(u,r),(0,E.default)(u,r),this.initMeasureData(u,r),this.cancelStack=f,this.opts=r,(0,x.default)(this.measureData,r),this.crossMeasure=new I.default(this.measureData,r.voiceIdx,r.noteIdx),this.location=null},c.checkPreconditions=function(){this.checkUnpitchedPart(),this.crossMeasure.checkVoiceIdx(),this.crossMeasure.checkNoteIdx(),this.checkNotRest(),this.lineToDestUnpitched(),this.checkUnpitched()},c.checkUnpitchedPart=function(){if(!this.measureData.isUnpitched())throw new m.A},c.checkNotRest=function(){if(this.isLeftRest()||this.isRightRest())throw new g.A},c.isLeftRest=function(){return this.crossMeasure.isLeftRest()},c.isRightRest=function(){return this.crossMeasure.isRightRest()},c.checkUnpitched=function(){const u=(0,s.A)(this.measureData,this.opts),r=this.getLeftChord(),f=this.getRightChord(),L=r.find(this.unpitchedPredicate,this);if(typeof L=="undefined")throw new O.A(O.A.GET,this.opts,u);const N=f.find(this.unpitchedPredicate,this);if(typeof N=="undefined")throw new O.A(O.A.GET,this.opts,u);const j=M.default.getUnpitched(L),K=M.default.getUnpitched(N);if(!p.default.isSame(j,K))throw new T.A(this.name,"notes must have the same pitch");if(!A.A.areNotesTied(L,N))throw new T.A(this.name,"notes are not tied")},c.perform=function(){this.cancelStack=this.cancelStack.createSubstack(this.name),this.storeAction();const r=this.getLeftChord().find(this.unpitchedPredicate,this),f=M.default.getUnpitched(r),N=this.getRightChord().find(this.unpitchedPredicate,this);A.A.untieNotes(r,N),this.updateStack(f)},c.unpitchedPredicate=function(u){const r=M.default.getUnpitched(u);return p.default.isSameLine(r,this.opts)},c.storeAction=function(){if(!this.cancelStack.hasAction()){const u=this.getLocation(),r={actionName:this.name,opts:{partUuid:u.partUuid,measureUuid:u.measureUuid,divisions:u.dpq,timePos:u.timePos,voiceUuid:u.voiceUuid,"display-octave":this.opts["display-octave"],"display-step":this.opts["display-step"]}};this.cancelStack.storeAction(r)}},c.getLeftChord=function(){return this.crossMeasure.getLeftChord()},c.getRightChord=function(){return this.crossMeasure.getRightChord()},c.updateStack=function(u){this.opts.leftNoteIdx=this.crossMeasure.getLeftNoteIdx(),this.opts.leftMeasureIdx=this.crossMeasure.getLeftMeasureIdx(),this.opts.rightNoteIdx=this.crossMeasure.getRightNoteIdx(),this.opts.rightMeasureIdx=this.crossMeasure.getRightMeasureIdx();const r=this.getLocation(),f={type:this.name,opts:{partIdx:this.opts.partIdx,partUuid:r.partUuid,measureIdx:this.opts.leftMeasureIdx,measureUuid:r.measureUuid,noteIdx:this.opts.leftNoteIdx,timePos:r.timePos,divisions:r.dpq,voiceUuid:r.voiceUuid,unpitched:p.default.copy(u)}};this.cancelStack.push(f),(0,h.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.leftMeasureIdx});const L={type:`${this.name}-close`,opts:{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx,noteIdx:this.opts.rightNoteIdx,voiceIdx:this.opts.voiceIdx,unpitched:p.default.copy(u)}};this.cancelStack.push(L),this.opts.rightMeasureIdx!==this.opts.leftMeasureIdx&&(0,h.default)(this.cancelStack,this.measureData,{partIdx:this.opts.partIdx,measureIdx:this.opts.rightMeasureIdx})},c.getLocation=function(){if(this.location===null){const u=this.measureData.getScoreData(),r=u.getPartUuid(this.opts.partIdx),f=this.crossMeasure.getLeftMeasureIdx(),L=u.getMeasureUuid(f),N=u.getPartVoiceUuid(this.opts.partIdx,this.opts.voiceIdx),j=this.crossMeasure.getLeftMeasure().getDpqValue(),K=this.crossMeasure.getLeftVoice(),W=this.crossMeasure.getLeftNoteIdx(),V=(0,d.A)(K,W);this.location={partUuid:r,measureUuid:L,voiceUuid:N,dpq:j,timePos:V}}return this.location},(0,e.default)(i);const n=i}}]);})();


//# debugId=0835bdd7-833c-59e4-a330-ab00122a6be0
